{"pages":[{"title":"","text":"JAVAè¿›åŒ–è®º JAVAè¿›é˜¶ç¯‡ NIOåŸºç¡€æ•™ç¨‹","link":"/course/index.html"},{"title":"","text":"ä¸ªäººç®€ä»‹ 93å¹´ç”Ÿäººï¼Œä»äº‹javaæœåŠ¡ç«¯å¼€å‘å·¥ä½œ4å¹´ï¼Œç°å±…ä¸Šæµ· Icarus ä¸»é¢˜ä»¥ç™½è‰²çš„ç®€æ´ä¸ºä¸»ï¼Œä½†æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›åœ¨æ–‡ç« ä¸­ç”¨ç‰¹åˆ«çš„æ ·å¼æ³¨æ˜ä¸€äº›å†…å®¹ï¼Œmarkdown è¯­æ³•å°±ä¸å¤Ÿç”¨äº†ï¼Œæ‰€ä»¥åœ¨æ­¤åˆ†äº«ä¸€ä¸‹æˆ‘çš„é«˜çº§ç©æ³•ã€‚","link":"/about/index.html"},{"title":"","text":"è½½å…¥ä¸­... $.getScript(\"/js/gitalk_self.min.js\", function () { var gitalk = new Gitalk({ clientID: '17297b562584b5cec3d7', clientSecret: '46c7652ed4f09fb1d847d15df81500a5a2ceeae8', id: '233', repo: 'exceting.github.io', owner: 'exceting', admin: \"exceting\", createIssueManually: true, distractionFreeMode: false }); gitalk.render('comment-container1'); });","link":"/timeline/index.html"},{"title":"","text":"","link":"/message/index.html"}],"posts":[{"title":"è¯¦è§£JDBCçš„Loadbalanceæ¨¡å¼","text":"åŸºäºä¾èµ–ç¨‹åºçš„ç‰ˆæœ¬ä¿¡æ¯ï¼š ä¸€ã€è®¤è¯†loadbalanceæ¨¡å¼é¦–å…ˆå›å¿†ä¸‹jdbcåè®®å¤´éƒ½æœ‰å“ªäº›ï¼Œä¸‹é¢æ€»ç»“ä¸‹ï¼š é€šè¿‡è¡¨1ï¼Œå¯ä»¥çŸ¥é“åœ¨loadblanceæ¨¡å¼ä¸‹å…è®¸é…ç½®å¤šä¸ªmysqlèŠ‚ç‚¹ä¿¡æ¯ï¼Œè€Œæˆ‘ä»¬æ¯æ¬¡å»ºè¿æ—¶ï¼Œé©±åŠ¨ç¨‹åºå°±ä¼šæŒ‰ç…§é…ç½®çš„èŠ‚ç‚¹ï¼Œé€‰ä¸­ä¸€ä¸ªï¼Œç„¶åå®Œæˆè¿æ¥çš„åˆ›å»ºï¼Œä¸‹é¢æˆ‘ä»¬æ¥æ¢ç´¢ä¸‹å®ƒçš„å®ç°ã€‚ äºŒã€åŸºæœ¬ä½¿ç”¨å®ƒçš„åŸºæœ¬ç”¨æ³•è·Ÿå…¶ä»–æ¨¡å¼æ²¡æœ‰åŒºåˆ«ï¼š ä»£ç å—11234567891011121314151617public static void main(String[] args) throws Exception { String url = \"jdbc:mysql:loadbalance://127.0.0.1:3306,127.0.0.2:3306,127.0.0.3:3306/mydb\"; LoadBalancedConnection connection = (LoadBalancedConnection) DriverManager.getConnection(url, \"root\", \"123456\"); Statement statement = connection.createStatement(); ResultSet rs = null; try { if (statement.execute(\"select * from t_season\")) { rs = statement.getResultSet(); } } finally { if (rs != null) { rs.close(); } statement.close(); connection.close(); }} ä¸‰ã€é©±åŠ¨åŠ è½½æµç¨‹jdbcæ˜¯å¦‚ä½•çŸ¥é“æˆ‘ä»¬å¯ç”¨äº†loadbalanceæ¨¡å¼çš„ï¼Ÿå…ˆæ¥äº†è§£ä¸‹DriverManagerçš„getConnectionæ–¹æ³•ï¼Œæ³¨æ„è¿™é‡Œçš„DriverManageråœ¨java.sqlåŒ…å†…ï¼Œå®ƒå±äºjdkè‡ªå¸¦çš„ç±»ï¼Œç›®çš„æ˜¯æ‰«ææ‰€æœ‰å®ç°äº†java.sql.Driverçš„ç±»ï¼Œè€Œæˆ‘ä»¬æ‰€ä½¿ç”¨çš„mysql-connector-javaç¨‹åºå°±å®ç°äº†Driveræ¥å£ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“è¢«DriverManagerè½½å…¥ï¼Œä¸‹é¢æ¥çœ‹å®ƒæ˜¯å¦‚ä½•å®Œæˆé©±åŠ¨ç¨‹åºæ‰«æä¸åŠ è½½çš„ï¼š ä»£ç å—21234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798@CallerSensitivepublic static Connection getConnection(String url, String user, String password) throws SQLException { java.util.Properties info = new java.util.Properties(); if (user != null) { info.put(\"user\", user); } if (password != null) { info.put(\"password\", password); } //è¯´æ˜ï¼šReflection.getCallerClass()æ˜¯ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œä¼šè¿”å›è°ƒç”¨å½“å‰è¿™ä¸ªæ–¹æ³•çš„é‚£ä¸ªç±»çš„åå­—ï¼ˆåç»­æˆ‘ä»¬ç§°å…¶ä¸ºcallerClassï¼‰ return (getConnection(url, info, Reflection.getCallerClass()));} private static Connection getConnection( String url, java.util.Properties info, Class&lt;?&gt; caller) throws SQLException { //è·å–callerClassçš„ç±»åŠ è½½å™¨ ClassLoader callerCL = caller != null ? caller.getClassLoader() : null; if (callerCL == null) { //è‹¥æ‰¾ä¸åˆ°å¯¹åº”çš„ç±»åŠ è½½å™¨ï¼Œåˆ™é»˜è®¤ä¸ºå½“å‰çº¿ç¨‹çš„ç±»åŠ è½½å™¨ callerCL = Thread.currentThread().getContextClassLoader(); } if (url == null) { throw new SQLException(\"The url cannot be null\", \"08001\"); } println(\"DriverManager.getConnection(\\\"\" + url + \"\\\")\"); //è¿™ä¸ªæ–¹æ³•ä¼šé€šè¿‡SPIæœºåˆ¶åŠ è½½å¯ä»¥åŠ è½½çš„å®ç°äº†JDBCåè®®çš„é©±åŠ¨ç¨‹åºï¼Œæˆ‘ä»¬é€šå¸¸ç”¨çš„æ˜¯mysql-connector-javaé‡Œçš„é©±åŠ¨ç±»ï¼ŒæŸäº›è¿æ¥æ± æŠ€æœ¯ä¹Ÿä¼šæä¸€ä¸ªè‡ªå·±çš„é©±åŠ¨ç±»ï¼ˆæ¯”å¦‚Druidçš„DruidDriverï¼‰ //åœ¨é‡Œé¢ä¼šå®ŒæˆDriverå®ç°ç±»çš„ç±»åŠ è½½ï¼Œè€Œé©±åŠ¨ç¨‹åºåªéœ€è¦åœ¨é™æ€å—é‡Œå°†è‡ªå·±çš„å®ä¾‹newå‡ºæ¥ï¼Œæ³¨å†Œåˆ°DriverManageré‡Œå³å¯ï¼ˆå¯ä»¥å»mysql-connector-javaçš„Driverç±»é‡Œç¡®è®¤æ˜¯å¦æœ‰è¯¥é€»è¾‘ï¼‰ //æ‰€ä»¥ç°åœ¨æˆ‘ä»¬æ ¹æœ¬ä¸éœ€è¦è·Ÿä»¥å‰å†™jdbcç¨‹åºé‚£æ ·å†™ä¸€æ¬¡Class.forNameçš„ä»£ç ï¼Œè¿™ä¸ªæ–¹æ³•å·²ç»å¸®æˆ‘ä»¬åšäº†ï¼ˆå‚è€ƒå›¾1ï¼Œé©±åŠ¨ç¨‹åºå·²ç»æ»¡è¶³SPIåŠ è½½é…ç½®çš„æ¡ä»¶ï¼‰ ensureDriversInitialized(); // Walk through the loaded registeredDrivers attempting to make a connection. // Remember the first exception that gets raised so we can reraise it. SQLException reason = null; for (DriverInfo aDriver : registeredDrivers) { //å¾ªç¯å·²ç»æˆåŠŸåŠ è½½åˆ°çš„é©±åŠ¨å®ç° // If the caller does not have permission to load the driver then // skip it. if (isDriverAllowed(aDriver.driver, callerCL)) { //è¿™ä¸ªè§£é‡Šåœ¨ä¸‹é¢å¯¹åº”çš„æ–¹æ³•é‡Œï¼Œè¿˜æ˜¯æŒºæœ‰æ„æ€çš„ä¸€ä¸ªæ–¹æ³• try { println(\" trying \" + aDriver.driver.getClass().getName()); //è¿™é‡Œæ˜¯åˆ©ç”¨é©±åŠ¨ç¨‹åºè·å–åˆ°ä¸€ä¸ªConnectionå¯¹è±¡ï¼Œåé¢ä¼šè¯¦ç»†è®² Connection con = aDriver.driver.connect(url, info); if (con != null) { // Success! println(\"getConnection returning \" + aDriver.driver.getClass().getName()); return (con); } } catch (SQLException ex) { if (reason == null) { reason = ex; } } } else { println(\" skipping: \" + aDriver.getClass().getName()); } } // if we got here nobody could connect. if (reason != null) { println(\"getConnection failed: \" + reason); throw reason; } println(\"getConnection: no suitable driver found for \"+ url); throw new SQLException(\"No suitable driver found for \"+ url, \"08001\");} private static boolean isDriverAllowed(Driver driver, Class&lt;?&gt; caller) { ClassLoader callerCL = caller != null ? caller.getClassLoader() : null; return isDriverAllowed(driver, callerCL);} //è¯¥æ–¹æ³•ä¸»è¦ç”¨æ¥åšé©±åŠ¨åŠ è½½ï¼Œä»¥åŠåˆ¤æ–­åŠ è½½äº†é©±åŠ¨Driverå¯¹è±¡çš„ç±»åŠ è½½å™¨è·ŸcallerClassçš„ç±»åŠ è½½å™¨æ˜¯å¦ä¸€è‡´ï¼Œè‹¥ä¸€è‡´æ‰è¿”å›trueï¼Œåä¹‹ä¸ºfalseprivate static boolean isDriverAllowed(Driver driver, ClassLoader classLoader) { boolean result = false; if (driver != null) { Class&lt;?&gt; aClass = null; try { //è¿™é‡Œç®—æ˜¯ç»™é©±åŠ¨ç±»è°ƒæ•´äº†ç±»åŠ è½½å™¨ï¼Œå°†ç¬¬ä¸€æ¬¡è¿›è¡Œç±»åŠ è½½æ—¶åŠ è½½åˆ°çš„Classå¯¹è±¡é‡Œçš„ç±»åŠ è½½å™¨ç»Ÿä¸€æˆcallerClassçš„ aClass = Class.forName(driver.getClass().getName(), true, classLoader); } catch (Exception ex) { result = false; } //è¿™é‡Œä¼šå†ç¡®è®¤ä¸€æ¬¡driverå¯¹è±¡æ­¤æ—¶å¯¹åº”çš„Classæ˜¯å¦è·Ÿè¢«è°ƒæ•´äº†ç±»åŠ è½½å™¨çš„Classä¸€è‡´ï¼ˆå¦‚æœä¸å‡ºæ„å¤–ï¼Œè¿™é‡Œåº”è¯¥æ˜¯ä¸€è‡´çš„ï¼‰ result = ( aClass == driver.getClass() ) ? true : false; } return result;} é©±åŠ¨ç¨‹åºçš„SPIæ”¯æŒï¼š é€šè¿‡ä¸Šè¿°ä»£ç ï¼Œå¯ä»¥ç¡®è®¤æœ€ç»ˆæ˜¯é€šè¿‡é©±åŠ¨ç¨‹åºDriverå®ç°ç±»çš„connectæ–¹æ³•äº§ç”Ÿçš„Connectionå¯¹è±¡ï¼Œä¸‹é¢æ¥çœ‹ä¸‹é©±åŠ¨ç¨‹åºDriveré‡Œçš„å®ç°ï¼š ä»£ç å—312345678910111213141516171819202122232425262728293031323334353637383940414243//ä»£ç æ‰€å±ç±»ï¼šcom.mysql.cj.jdbc.NonRegisteringDriver@Overridepublic java.sql.Connection connect(String url, Properties info) throws SQLException { try { //éªŒè¯ä¼ å…¥çš„urlæ˜¯å¦ç¬¦åˆjdbcè¿æ¥è§„èŒƒ if (!ConnectionUrl.acceptsUrl(url)) { /* * According to JDBC spec: * The driver should return \"null\" if it realizes it is the wrong kind of driver to connect to the given URL. This will be common, as when the * JDBC driver manager is asked to connect to a given URL it passes the URL to each loaded driver in turn. */ return null; } //æ ¹æ®ä¼ å…¥çš„ä¿¡æ¯ï¼Œè·å¾—ä¸€ä¸ªåŒ…è£…äº†è¿æ¥ä¿¡æ¯çš„å¯¹è±¡ ConnectionUrl conStr = ConnectionUrl.getConnectionUrlInstance(url, info); switch (conStr.getType()) { //è¿™ä¸ªTypeæ˜¯æ ¹æ®jdbcåè®®å¤´åˆ†æå‡ºæ¥çš„ï¼Œåº”è¯¥ç»™ä¸€ä¸ªå¯¹åº”åè®®å¤´ç±»å‹çš„Connectionå®ä¾‹ case SINGLE_CONNECTION: //jdbc:mysql:å¼€å¤´çš„urlä¼šå‘½ä¸­ä¸‹æ–¹é€»è¾‘ return com.mysql.cj.jdbc.ConnectionImpl.getInstance(conStr.getMainHost()); case LOADBALANCE_CONNECTION: //jdbc:mysql:loadbalance:å¼€å¤´çš„urlä¼šå‘½ä¸­ä¸‹æ–¹é€»è¾‘ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰ï¼Œä¹Ÿæ˜¯æœ¬èŠ‚è¦è®²çš„é‡ç‚¹ return LoadBalancedConnectionProxy.createProxyInstance((LoadbalanceConnectionUrl) conStr); case FAILOVER_CONNECTION: //jdbc:mysql:å¼€å¤´ä¸”é…ç½®äº†å¤šä¸ªèŠ‚ç‚¹çš„æƒ…å†µä¼šå‘½ä¸­ä¸‹æ–¹é€»è¾‘ï¼ˆæ•…éšœè½¬ç§»ï¼‰ return FailoverConnectionProxy.createProxyInstance(conStr); case REPLICATION_CONNECTION: //jdbc:mysql:replication:å¼€å¤´çš„urlä¼šå‘½ä¸­ä¸‹æ–¹é€»è¾‘ï¼ˆä¸»ä»ï¼‰ return ReplicationConnectionProxy.createProxyInstance((ReplicationConnectionUrl) conStr); default: return null; } } catch (UnsupportedConnectionStringException e) { // when Connector/J can't handle this connection string the Driver must return null return null; } catch (CJException ex) { throw ExceptionFactory.createException(UnableToConnectException.class, Messages.getString(\"NonRegisteringDriver.17\", new Object[] { ex.toString() }), ex); }} åˆ°è¿™é‡Œï¼Œå¯ä»¥çœ‹åˆ°é©±åŠ¨ç¨‹åºä¹‹æ‰€ä»¥ä¼šçŸ¥é“æˆ‘ä»¬å¯ç”¨äº†loadbalanceæ¨¡å¼ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬æ‰€é…ç½®çš„jdbcè¿æ¥åè®®å¤´ï¼Œæ ¹æ®åè®®å¤´çš„ä¸åŒï¼Œä¼šè¢«è·¯ç”±è¿›ä¸åŒçš„Connectionå®ç°ï¼Œç„¶åæœ€ç»ˆå°†Connectionå¯¹è±¡è¿”å›ç»™ç”¨æˆ·ã€‚ å››ã€é©±åŠ¨ç¨‹åºå¯¹LoadBalanceçš„æ”¯æŒä¸‹é¢é‡ç‚¹çœ‹ä¸‹å‘½ä¸­LOADBALANCE_CONNECTIONæ¡ä»¶çš„LoadBalancedConnectionProxy.createProxyInstanceçš„å†…éƒ¨é€»è¾‘ï¼š ä»£ç å—4123456//åˆ›å»ºLoadBalancedConnectionå¯¹è±¡ï¼Œå¹¶ä¸ºå…¶åŠ ä¸ŠåŠ¨æ€ä»£ç†public static LoadBalancedConnection createProxyInstance(LoadbalanceConnectionUrl connectionUrl) throws SQLException { LoadBalancedConnectionProxy connProxy = new LoadBalancedConnectionProxy(connectionUrl); //è¿”å›çš„æ˜¯ä¸€ä¸ªè¢«LoadBalancedConnectionProxyä»£ç†äº†çš„LoadBalancedConnectionå¯¹è±¡ return (LoadBalancedConnection) java.lang.reflect.Proxy.newProxyInstance(LoadBalancedConnection.class.getClassLoader(), INTERFACES_TO_PROXY, connProxy);} 4.1ï¼šLoadBalanceæ¨¡å¼ç›¸å…³çš„ç±»å…³ç³»å›¾åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»è¿›å…¥äº†loadblanceæ¨¡å¼å†…éƒ¨ï¼Œè¿™é‡Œè¿”å›çš„æ˜¯ä¸€ä¸ªè¢«ä»£ç†äº†çš„LoadBalancedConnectionå¯¹è±¡ï¼Œä¸‹é¢æ¥æ¢³ç†ä¸‹å®ƒä»¬çš„ç»§æ‰¿å’Œä»£ç†å…³ç³»ï¼ˆä¹‹åé‡ç‚¹åˆ†æçš„å­—æ®µå’Œæ–¹æ³•å­—ä½“å‡å·²æ ‡çº¢ï¼‰ï¼š ç†æ¸…å…³ç³»åï¼Œæ¥çœ‹ä¸‹æœ€ä¸»è¦çš„å‡ ä¸ªå±æ€§å’Œæ–¹æ³•çš„å®ç°ã€‚ ä»£ç å—4é‡Œç›´æ¥newå‡ºäº†LoadBalancedConnectionProxyç±»ï¼Œå¹¶ä¸”ä»£ç†çš„ç›®æ ‡ç±»ä¸ºLoadBalancedConnectionï¼Œé€šè¿‡ä¸Šå›¾ï¼Œå¯ä»¥çŸ¥é“å°±æ˜¯æœ€ç»ˆè¿”å›ç»™ç”¨æˆ·çš„é‚£ä¸ªConnectionå¯¹è±¡ï¼Œæ„å‘³ç€ç”¨æˆ·æ‹¿ç€è¿™ä¸ªConnectionåšä»»ä½•æ“ä½œéƒ½ä¼šè§¦å‘LoadBalancedConnectionProxyçš„invokeMoreæ–¹æ³•ï¼ˆé€šè¿‡å›¾ä¸­å±•ç¤ºï¼Œå…¶çˆ¶ç±»å®ç°äº†InvocationHandleræ¥å£ï¼Œå…¶invokeä¼šè§¦å‘invokeMoreæ–¹æ³•ï¼Œè€ŒinvokeMoreæ–¹æ³•çš„å®ç°åœ¨LoadBalancedConnectionProxyé‡Œï¼‰ 4.2ï¼šLoadBalancedConnectionProxy.balancerå±æ€§è¿™æ˜¯ä¸ªå±æ€§ï¼Œå®ƒåŒ…è£…äº†ä¸€ä¸ªBalancerå¯¹è±¡ï¼Œå†…éƒ¨æœ‰è‡ªå·±çš„LBç®—æ³•ï¼Œå®ƒçš„åˆå§‹åŒ–å¦‚ä¸‹ï¼š ä»£ç å—4123456789101112131415161718192021//æ‹¿åˆ°æŒ‡å®šçš„LBç®—æ³•ï¼Œä¸é…ç½®çš„è¯é»˜è®¤æ˜¯randomï¼Œå¦‚æœä½ æƒ³è¦æŒ‡å®šï¼Œå¯ä»¥åœ¨jdbcè¿æ¥åé¢è¿½åŠ haLoadBalanceStrategyå‚æ•°ï¼Œè®©å…¶ç­‰äºä½ æŒ‡å®šçš„LBç®—æ³•ç±»å‹å³å¯//LBç®—æ³•ç±»å‹å¯é€‰å€¼åœ¨ä¸‹é¢çš„switchå†…éƒ¨ï¼Œå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ï¼Œè‡ªå®šä¹‰çš„è¯å°±éœ€è¦ä¼ å®ç°ç±»çš„è·¯å¾„ç»™è¿™ä¸ªå‚æ•°äº†String strategy = props.getProperty(PropertyKey.ha_loadBalanceStrategy.getKeyName(), \"random\"); try { switch (strategy) { case \"random\": this.balancer = new RandomBalanceStrategy(); //randomç®—æ³•çš„å®ç°ç±»ï¼Œé»˜è®¤ç®—æ³• break; case \"bestResponseTime\": this.balancer = new BestResponseTimeBalanceStrategy(); break; case \"serverAffinity\": this.balancer = new ServerAffinityStrategy(props.getProperty(PropertyKey.serverAffinityOrder.getKeyName(), null)); break; default: //ä½ å¯ä»¥æŒ‰éœ€è‡ªå®šä¹‰LBç®—æ³•ï¼Œè¿™é‡Œæ˜¯é€šè¿‡åå°„çš„æ–¹å¼åˆå§‹åŒ–ä½ ç»™å®šçš„LBç®—æ³•ç±»çš„ this.balancer = (BalanceStrategy) Class.forName(strategy).newInstance(); }} catch (Throwable t) { throw SQLError.createSQLException(Messages.getString(\"InvalidLoadBalanceStrategy\", new Object[] { strategy }), MysqlErrorNumbers.SQL_STATE_ILLEGAL_ARGUMENT, t, null);} æˆ‘ä»¬åªå…³æ³¨Randomå³å¯ï¼Œå®ƒçš„å†…éƒ¨å®ç°å°±æ˜¯ç®€å•çš„ä»LoadBalancedConnectionProxy.liveConnectionsé‡Œéšæœºé€‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç„¶åè¿”å›å‡ºå»ï¼Œä¸ºäº†æ›´åŠ æ¸…æ™°ï¼Œä¸å†è´´ä»£ç ï¼Œå¤§è‡´æµç¨‹å¦‚ä¸‹ï¼ˆç»¿è‰²æ¡†é€»è¾‘éƒ½å±äºRandomBalanceræœ¬èº«çš„é€»è¾‘ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå›¾ä¸­æ ‡æ³¨äº†hostListå±æ€§çš„æ•°æ®æ¥æºï¼‰ï¼š å®ƒçš„è§¦å‘ç‚¹å°±æ˜¯åœ¨LoadBalancedConnectionProxy.pickNewConnectionæ–¹æ³•ï¼ˆå‚è€ƒä¸‹æ–¹4.3ï¼‰ï¼Œå³å‘ç”Ÿåœ¨é€‰å–èŠ‚ç‚¹æ—¶ã€‚ 4.3ï¼šLoadBalancedConnectionProxy.pickNewConnectionæ–¹æ³•è¿™ä¸ªæ–¹æ³•æ˜¯éå¸¸æ ¸å¿ƒçš„åŠŸèƒ½ï¼Œæ¯æ¬¡å˜æ¢èŠ‚ç‚¹æ—¶éƒ½ä¼šè§¦å‘çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä¸‹é¢æ¥çœ‹ä¸‹å…¶å†…éƒ¨é€»è¾‘ï¼š ä»£ç å—512345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455//pickèŠ‚ç‚¹æ ¸å¿ƒæ–¹æ³•ï¼Œåˆ©ç”¨balancerå¯¹è±¡åˆ·æ–°currentConnectionçš„å€¼public synchronized void pickNewConnection() throws SQLException { if (this.isClosed &amp;&amp; this.closedExplicitly) { return; } List&lt;String&gt; hostPortList = Collections.unmodifiableList(this.hostsList.stream().map(hi -&gt; hi.getHostPortPair()).collect(Collectors.toList())); if (this.currentConnection == null) { // startup //å¦‚æœcurrentConnectionä¸ºç©ºï¼Œåˆ™å¼€å§‹åˆ©ç”¨balanceré€‰å–èŠ‚ç‚¹ this.currentConnection = this.balancer.pickConnection(this, hostPortList, Collections.unmodifiableMap(this.liveConnections), this.responseTimes.clone(), this.retriesAllDown); return; //ç»ˆæ­¢ } if (this.currentConnection.isClosed()) { invalidateCurrentConnection(); //è‹¥å‘ç°å½“å‰è¿æ¥å·²ç»è¢«å…³é—­äº†ï¼Œåˆ™æŠ›å¼ƒè¿™ä¸ªè¿æ¥ } int pingTimeout = this.currentConnection.getPropertySet().getIntegerProperty(PropertyKey.loadBalancePingTimeout).getValue(); boolean pingBeforeReturn = this.currentConnection.getPropertySet().getBooleanProperty(PropertyKey.loadBalanceValidateConnectionOnSwapServer).getValue(); //é‡è¯•é€»è¾‘ï¼Œè‹¥pickä¸æˆåŠŸï¼Œåˆ™åœ¨æœ‰é™çš„æ¬¡æ•°å†…é‡è¯•ï¼ˆè¿™ä¸ªæ¬¡æ•°å°±æ˜¯hostsListçš„sizeï¼‰ for (int hostsTried = 0, hostsToTry = this.hostsList.size(); hostsTried &lt; hostsToTry; hostsTried++) { ConnectionImpl newConn = null; try { //pickèŠ‚ç‚¹ newConn = (ConnectionImpl) this.balancer.pickConnection(this, hostPortList, Collections.unmodifiableMap(this.liveConnections), this.responseTimes.clone(), this.retriesAllDown); if (this.currentConnection != null) { if (pingBeforeReturn) { //pingæ£€æŸ¥ï¼Œæ£€æŸ¥å¤±è´¥ä¼šæŠ›SQLExceptionï¼Œä¸‹æ–¹å¼‚å¸¸å¤„ç†é‡Œä¼šæŠŠå®ƒæŠ›å¼ƒæ‰ newConn.pingInternal(true, pingTimeout); } //åŒæ­¥æ—§currentConnectionèŠ‚ç‚¹çš„å±æ€§ç»™è¿™ä¸ªæ–°pickå‡ºæ¥çš„èŠ‚ç‚¹ï¼Œæ¯”å¦‚read-onlyã€auto-commitä»€ä¹ˆçš„ syncSessionState(this.currentConnection, newConn); } //åˆ·æ–°currentConnectionçš„å€¼ä¸ºæ–°pickå‡ºæ¥çš„è¿™ä¸ªè¿æ¥ this.currentConnection = newConn; return; //ç»ˆæ­¢ } catch (SQLException e) { if (shouldExceptionTriggerConnectionSwitch(e) &amp;&amp; newConn != null) { // connection error, close up shop on current connection invalidateConnection(newConn); } } } // no hosts available to swap connection to, close up. this.isClosed = true; //å¦‚æœå°†hostsListé›†åˆpickäº†ä¸€ééƒ½æ²¡æœ‰æ‰¾åˆ°å¯ç”¨çš„è¿æ¥ï¼Œåˆ™è®¤ä¸ºpickå¤±è´¥ï¼Œæ ‡è®°isClosedä¸ºtrue this.closedReason = \"Connection closed after inability to pick valid new connection during load-balance.\";} 4.4ï¼šMultiHostConnectionProxy.invokeæ–¹æ³•è¿™æ˜¯MultiHostConnectionProxyå¯¹InvocationHandleræ¥å£çš„å®ç°ï¼Œé€šè¿‡å›¾2å¯ä»¥çŸ¥é“ï¼Œå®ƒçš„å­ç±»LoadBalancedConnectionProxyæ˜¯è¿”å›ç»™ç”¨æˆ·çš„LoadBalancedConnectionçš„ä»£ç†ç±»ï¼Œæ„å‘³ç€ç”¨æˆ·åˆ©ç”¨Connectionåšçš„æ¯ä¸€æ­¥æ“ä½œï¼Œéƒ½ä¼šå‘½ä¸­è¿™ä¸ªinvokeæ–¹æ³•çš„è°ƒç”¨ï¼Œä¸‹é¢æ¥çœ‹ä¸‹è¿™ä¸ªæ–¹æ³•çš„å®ç°ï¼š ä»£ç å—6123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566public synchronized Object invoke(Object proxy, Method method, Object[] args) throws Throwable { String methodName = method.getName(); //è‹¥è¢«è°ƒç”¨çš„æ–¹æ³•æ˜¯getMultiHostSafeProxyï¼Œåˆ™ç›´æ¥è¿”å›ä»£ç†å¯¹è±¡æœ¬èº«ï¼ˆä¹Ÿå³æ˜¯ç”¨æˆ·æ­£åœ¨ä½¿ç”¨çš„é‚£ä¸ªConnectionå¯¹è±¡ï¼‰ if (METHOD_GET_MULTI_HOST_SAFE_PROXY.equals(methodName)) { return this.thisAsConnection; } //è¢«è°ƒç”¨çš„æ–¹æ³•æ˜¯equalsæ‰€æ‰§è¡Œçš„é€»è¾‘ if (METHOD_EQUALS.equals(methodName)) { // Let args[0] \"unwrap\" to its InvocationHandler if it is a proxy. return args[0].equals(this); } //è¢«è°ƒç”¨çš„æ–¹æ³•æ˜¯hashCodeæ‰€æ‰§è¡Œçš„é€»è¾‘ if (METHOD_HASH_CODE.equals(methodName)) { return this.hashCode(); } //è‹¥è¢«è°ƒç”¨çš„æ–¹æ³•æ˜¯closeï¼Œåˆ™å…³é—­å¹¶æ¸…ç†æ‰æ‰€æœ‰çš„è¿æ¥ï¼ˆliveConnections.clearï¼‰ if (METHOD_CLOSE.equals(methodName)) { doClose(); this.isClosed = true; //æ ‡è®°isClosedä¸ºtrue this.closedReason = \"Connection explicitly closed.\"; this.closedExplicitly = true; //æ ‡è®°closedExplicitlyä¸ºtrueï¼Œæ„æ€æ˜¯è¯´è¿™æ˜¯ç”±ç”¨æˆ·\"æ˜¾å¼å…³é—­\"çš„ return null; } //è¢«è°ƒç”¨çš„æ–¹æ³•æ˜¯abortInternalæ‰€æ‰§è¡Œçš„é€»è¾‘ if (METHOD_ABORT_INTERNAL.equals(methodName)) { doAbortInternal(); this.currentConnection.abortInternal(); this.isClosed = true; this.closedReason = \"Connection explicitly closed.\"; return null; } //è¢«è°ƒç”¨çš„æ–¹æ³•æ˜¯abortæ‰€æ‰§è¡Œçš„é€»è¾‘ if (METHOD_ABORT.equals(methodName) &amp;&amp; args.length == 1) { doAbort((Executor) args[0]); this.isClosed = true; this.closedReason = \"Connection explicitly closed.\"; return null; } //è¢«è°ƒç”¨çš„æ–¹æ³•æ˜¯isClosedæ‰€æ‰§è¡Œçš„é€»è¾‘ if (METHOD_IS_CLOSED.equals(methodName)) { return this.isClosed; } try { //è‹¥è°ƒç”¨çš„æ–¹æ³•ä¸æ˜¯ä¸Šé¢çš„ä»»æ„ä¸€ç§ï¼Œåˆ™ç›´æ¥è§¦å‘å…¶å­ç±»çš„invokeMoreæ–¹æ³•ï¼ˆä¸‹é¢åˆ†æï¼‰ return invokeMore(proxy, method, args); } catch (InvocationTargetException e) { throw e.getCause() != null ? e.getCause() : e; } catch (Exception e) { // Check if the captured exception must be wrapped by an unchecked exception. Class&lt;?&gt;[] declaredException = method.getExceptionTypes(); for (Class&lt;?&gt; declEx : declaredException) { if (declEx.isAssignableFrom(e.getClass())) { throw e; } } throw new IllegalStateException(e.getMessage(), e); }} 4.5ï¼šLoadBalancedConnectionProxy.invokeMoreæ–¹æ³•ç´§æ¥ç€ä¸Šé¢çš„ä»£ç æ¥çœ‹ï¼Œäº†è§£ä¸‹invokMoreæ–¹æ³•ï¼ˆæ ¹æ®å›¾2å¯çŸ¥ï¼Œæ­¤æ–¹æ³•ä¸ºæŠ½è±¡æ–¹æ³•ï¼Œç”±å­ç±»å®ç°ï¼Œæ‰€ä»¥å®ƒçš„å®ç°é€»è¾‘åœ¨LoadBalancedConnectionProxyé‡Œï¼‰ ä»£ç å—7123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778@Overridepublic synchronized Object invokeMore(Object proxy, Method method, Object[] args) throws Throwable { String methodName = method.getName(); //é‡è¿æœºåˆ¶åˆ¤æ–­ï¼Œå¦‚æœå½“å‰è¿æ¥çŠ¶æ€å·²è¢«å…³é—­ï¼Œè¿™é‡Œçš„å…³é—­æ˜¯æŒ‡currentConnectionçš„isClosedä¸ºtrueï¼Œè€Œä½¿isClosedä¸ºtrueçš„åœ°æ–¹ä¸ºï¼š //â‘  ç”¨æˆ·æ‰‹åŠ¨è°ƒç”¨Connection.closeï¼Œè¿™ç§è¢«ç§°ä¸º\"æ˜¾å¼å…³é—­\"ï¼Œè¿™ç§å…³é—­æ–¹å¼è¿åŒclosedExplicitlyä¹Ÿä¼šè¢«ç½®ä¸ºtrue //â‘¡ abortè¿æ¥ã€pingæ£€æŸ¥å¤±è´¥ã€pickNewConnectionæ—¶pickä¸å‡ºå¯ç”¨èŠ‚ç‚¹ï¼Œéƒ½ä¼šä½¿isClosedä¸ºtrueï¼Œä½†closedExplicitlyä¾ç„¶ä¸ºfalse if (this.isClosed &amp;&amp; !allowedOnClosedConnection(method) &amp;&amp; method.getExceptionTypes().length &gt; 0) { // TODO remove method.getExceptionTypes().length ? //ç»“åˆä¸Šæ–¹è¯´çš„â‘¡ï¼Œå¦‚æœä½ è®¾ç½®äº†autoReconnectæœºåˆ¶ï¼ˆè‡ªåŠ¨é‡è¿ï¼‰ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨ä»»æ„\"éæ˜¾å¼\"closeçš„æƒ…å†µä¸‹ï¼Œåˆ·æ–°currentConnectionçš„å€¼ï¼Œä½¿å…¶å¯ç”¨ if (this.autoReconnect &amp;&amp; !this.closedExplicitly) { this.currentConnection = null; pickNewConnection(); //åœ¨è‡ªåŠ¨é‡è¿å¼€å¯çš„æƒ…å†µä¸‹ï¼Œå½“ä½ çš„è¿æ¥è¢«éæ­£å¸¸å…³é—­åï¼Œä¼šå°è¯•é‡æ–°pickèŠ‚ç‚¹ï¼Œç¡®ä¿å…¶å¯ç”¨ this.isClosed = false; this.closedReason = null; } else { //å¦‚æœæ²¡æœ‰å¼€å¯é‡è¿æ¨¡å¼ï¼Œé‚£ä¹ˆåœ¨isCloseä¸ºtrueæ—¶ï¼Œå°±ç›´æ¥æŠ›å‡ºé”™è¯¯ String reason = \"No operations allowed after connection closed.\"; if (this.closedReason != null) { reason += \" \" + this.closedReason; } for (Class&lt;?&gt; excls : method.getExceptionTypes()) { if (SQLException.class.isAssignableFrom(excls)) { throw SQLError.createSQLException(reason, MysqlErrorNumbers.SQL_STATE_CONNECTION_NOT_OPEN, null /* no access to an interceptor here... */); } } throw ExceptionFactory.createException(CJCommunicationsException.class, reason); } } if (!this.inTransaction) { this.inTransaction = true; this.transactionStartTime = System.nanoTime(); this.transactionCount++; } Object result = null; try { //è§¦å‘å®é™…çš„æ–¹æ³•é€»è¾‘ result = method.invoke(this.thisAsConnection, args); if (result != null) { if (result instanceof com.mysql.cj.jdbc.JdbcStatement) { ((com.mysql.cj.jdbc.JdbcStatement) result).setPingTarget(this); } //è¿™é‡Œæ˜¯ç»™æ–¹æ³•è¿”å›çš„å¯¹è±¡åŠ ä¸€å±‚ä»£ç†ï¼ˆè·Ÿæœ¬æ¬¡é‡ç‚¹æ— å…³ï¼Œä¸å†è¯¦è¿°ï¼‰ result = proxyIfReturnTypeIsJdbcInterface(method.getReturnType(), result); } } catch (InvocationTargetException e) { dealWithInvocationException(e); } finally { //é‡ç‚¹æ˜¯ï¼Œå½“å‘ç°è§¦å‘çš„æ–¹æ³•æ˜¯commitæˆ–rollbackæ—¶ï¼Œä¼šåˆ·æ–°ä¸€ä¸‹currentConnectionçš„å€¼ï¼Œé‡æ–°pickå‡ºä¸€ä¸ª if (\"commit\".equals(methodName) || \"rollback\".equals(methodName)) { this.inTransaction = false; // Update stats String host = this.connectionsToHostsMap.get(this.currentConnection); // avoid NPE if the connection has already been removed from connectionsToHostsMap in invalidateCurrenctConnection() if (host != null) { synchronized (this.responseTimes) { Integer hostIndex = (this.hostsToListIndexMap.get(host)); if (hostIndex != null &amp;&amp; hostIndex &lt; this.responseTimes.length) { //æ›´æ–°å¯¹åº”èŠ‚ç‚¹æ‰§è¡Œäº‹åŠ¡æ‰€èŠ±è´¹çš„æ—¶é—´ this.responseTimes[hostIndex] = System.nanoTime() - this.transactionStartTime; } } } //åˆ·æ–°currentConnectionçš„å€¼ pickNewConnection(); } } return result;} é€šè¿‡è¿™å—ä»£ç å¯ä»¥çŸ¥é“ï¼Œä¸€ä¸ªLoadBalanceæ¨¡å¼ä¸‹çš„è¿æ¥è¢«åˆ›å»ºå‡ºæ¥åï¼Œé™¤éæ˜¯commitæˆ–rollbackäº‹åŠ¡ï¼Œå¦åˆ™è¯¥Connectionå¯¹è±¡é‡Œçš„currentConnectionæ°¸è¿œéƒ½ä¸ä¼šå˜ï¼Œå½“ç„¶ï¼Œé€šè¿‡ä¸Šè¿°ä»£ç çœ‹ï¼Œè¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ä¼šå˜çš„ï¼Œé‚£å°±æ˜¯å½“å‰è¿æ¥åæ‰ï¼Œç„¶åpingæ£€æŸ¥å¤±è´¥isCloseè¢«æ ‡è®°ä¸ºtrueï¼Œä½ çš„é…ç½®é‡Œæ°å¥½åˆå¼€å¯äº†autoReconnectï¼Œè¿™æ—¶æ‰ä¼šé‡æ–°pickæ–°çš„èŠ‚ç‚¹ã€‚ äº”ã€çŒœæƒ³é€šè¿‡å¯¹å…¶ä»£ç å®ç°çš„åˆ†æï¼Œå¯ä»¥å¾—å‡ºå¦‚ä¸‹çŒœæƒ³ï¼š ä¸é…autoReconnectçš„æƒ…å†µä¸‹ï¼Œåªæœ‰åœ¨åˆ©ç”¨è¯¥è¿æ¥å¯¹è±¡æäº¤ã€å›æ»šäº‹åŠ¡æ—¶æ‰ä¼špickæ–°çš„èŠ‚ç‚¹ã€‚ é…ç½®autoReconnectçš„æƒ…å†µä¸‹ï¼Œåœ¨èŠ‚ç‚¹åæ‰åï¼Œä¼špickä¸€æ¬¡èŠ‚ç‚¹ï¼Œäº‹åŠ¡æäº¤ã€å›æ»šä¸€æ ·ä¼špickèŠ‚ç‚¹ã€‚ ç»¼ä¸Šï¼Œå¦‚æœæˆ‘è¦å®ç°ä¸€ä¸ªselectæŸ¥è¯¢ä¹Ÿéœ€è¦pickèŠ‚ç‚¹å®ç°è´Ÿè½½å‡è¡¡çš„æƒ…å†µä¸‹ï¼Œä¸å¯ä»¥ç”¨å•ä¾‹Connectionï¼Œå› ä¸ºæ™®é€šselectå¹¶ä¸ä¼šè§¦å‘pickæ“ä½œã€‚ ç»¼åˆ3ï¼Œæƒ³è¦å®ç°å…¨éƒ¨æ„ä¹‰çš„LBï¼Œå¿…é¡»è¦ä½¿ç”¨å¤šå®ä¾‹æ¨¡å¼ï¼Œè¿™æ ·è™½ç„¶å®ç°äº†æˆ‘æƒ³è¦çš„LBæ•ˆæœï¼Œä½†ä»£ä»·æ˜¯å·¨å¤§çš„ï¼Œå› ä¸ºæ¯æ¬¡éƒ½ä¼šå»ºè¿ã€‚ åˆ©ç”¨è¿æ¥æ± å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šè§£å†³è¿™ç§é—®é¢˜ï¼Œè¿æ¥æ± å¯ä»¥é¢„å…ˆå»ºè¿ä¸€å †Connectionå¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å¦‚æœåœ¨åˆ›å»ºæ—¶å¯ç”¨jdbc LoadBalanceæ¨¡å¼ï¼Œé‚£ä¹ˆæ„å‘³ç€æ¯ä¸ªè¿æ¥éƒ½æ˜¯éšæœºèŠ‚ç‚¹ã€‚ å…­ã€éªŒè¯ä¸ºäº†éªŒè¯ç¬¬äº”èŠ‚çš„ç»“è®ºï¼Œæˆ‘ä»¬ç®€å•åšä¸ªè¯•éªŒéªŒè¯ä¸‹ã€‚ 6.1ï¼šå•ä¾‹æ¨¡å¼ä¸‹çš„Queryæ“ä½œä»£ç å—812345678910111213141516171819202122232425262728293031323334public class Test { public static void main(String[] args) throws Exception { String url = \"jdbc:mysql:loadbalance://172.22.119.38:4000,172.22.119.8:4000,172.22.119.30:4000/tidb_test\"; LoadBalancedConnection connection = (LoadBalancedConnection) DriverManager.getConnection(url, \"tidb_test\", \"lPoK3QMSWY1BhSa3WCT1IWOXYkMc3Aqd\"); Test test = new Test(); for (int i = 0; i &lt; 100; i++) { //åˆ©ç”¨åŒä¸€ä¸ªconnectionå¯¹è±¡æ‰§è¡Œ100æ¬¡æŸ¥è¯¢æ“ä½œ try { test.triggerQuery(connection); } finally { //ä¸ºäº†ä¿è¯æ˜¯å•ä¾‹æ¨¡å¼ï¼Œè¿™é‡Œä¸å†close //connection.close(); } } } private void triggerQuery(LoadBalancedConnection connection) throws Exception { Statement statement = connection.createStatement(); ResultSet rs = null; try { //è¿™é‡Œæ‰“å°ä¸‹å½“å‰å‚ä¸æ‰§è¡Œsqlçš„è¿æ¥host System.out.println(\"current conn host: \" + connection.getHost()); if (statement.execute(\"select * from t_student where id = 1\")) { rs = statement.getResultSet(); } } finally { if (rs != null) { rs.close(); } statement.close(); } }} è¿™æ®µä»£ç è¿è¡Œç»“æœæ‰“å°å¦‚ä¸‹ï¼š ä»£ç å—912345678current conn host: 172.22.119.30current conn host: 172.22.119.30current conn host: 172.22.119.30current conn host: 172.22.119.30current conn host: 172.22.119.30current conn host: 172.22.119.30current conn host: 172.22.119.30...çœç•¥ï¼Œå…±100æ¡... å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœä¸€ç›´ç”¨åŒä¸€ä¸ªConnectionå¯¹è±¡å»createStatementï¼Œç„¶åæ‰§è¡ŒQueryï¼Œé‚£ä¹ˆèŠ‚ç‚¹å§‹ç»ˆæ˜¯ä¸€å¼€å§‹pickå¥½çš„é‚£ä¸ªï¼Œä¸”æ°¸è¿œä¸ä¼šå˜ã€‚ 6.2ï¼šå¤šå®ä¾‹ä¸‹çš„Queryæ“ä½œè¿™ä¸ªå…¶å®æ ¹æœ¬æ²¡æœ‰æµ‹è¯•çš„å¿…è¦ï¼Œå¤šå®ä¾‹æ„å‘³ç€æ¯æ¬¡Queryå‰éƒ½ä¼šæ–°å»ºä¸€ä¸ªè¿æ¥å¯¹è±¡ï¼Œæ–°å»ºä¸€ä¸ªæ„å‘³ç€ä¼špickä¸€æ¬¡ï¼Œé‚£è‚¯å®šæ˜¯randomçš„ï¼Œæˆ‘ä»¬æ”¹ä¸‹mainæ–¹æ³•çš„ä»£ç ï¼š ä»£ç å—10123456789101112131415public static void main(String[] args) throws Exception { String url = \"jdbc:mysql:loadbalance://172.22.119.38:4000,172.22.119.8:4000,172.22.119.30:4000/tidb_test\"; Test test = new Test(); for (int i = 0; i &lt; 100; i++) { //å°†åˆ›å»ºconnectionè¿æ¥æ”¾åˆ°å¾ªç¯ä½“é‡Œé¢ï¼Œä½¿æ¯æ¬¡ä¼ ç»™triggerQueryæ–¹æ³•çš„éƒ½æ˜¯ä¸åŒçš„Connectionå¯¹è±¡ LoadBalancedConnection connection = (LoadBalancedConnection) DriverManager.getConnection(url, \"tidb_test\", \"lPoK3QMSWY1BhSa3WCT1IWOXYkMc3Aqd\"); try { test.triggerQuery(connection); } finally { //åˆ«å¿˜äº†closeèµ„æº connection.close(); } }} è¿™æ¬¡è¿è¡Œç»“æœå¦‚ä¸‹ï¼š ä»£ç å—1112345678910current conn host: 172.22.119.8current conn host: 172.22.119.8current conn host: 172.22.119.8current conn host: 172.22.119.38current conn host: 172.22.119.30current conn host: 172.22.119.38current conn host: 172.22.119.8current conn host: 172.22.119.8current conn host: 172.22.119.38...çœç•¥ï¼Œå…±100æ¡... å¯ä»¥çœ‹åˆ°ï¼Œå·²ç»è§¦å‘äº†LBç®—æ³•äº†ï¼ˆè¿™æ˜¯é¢„æ–™ä¹‹ä¸­çš„ï¼‰ã€‚ ä½ å¯èƒ½ä¼šé—®ï¼Œå¦‚æœè°ƒç”¨äº†closeå‘¢ï¼Ÿä¼šä¸ä¼šcloseä¸æ˜¯çœŸçš„closeï¼Œè€Œæ˜¯è§¦å‘pickå‘¢ï¼Ÿæ­£å¸¸æƒ…å†µä¸‹è‚¯å®šä¼šè¿™æ ·å®ç°çš„å§ï¼Ÿå…¶å®å¹¶ä¸ä¼šï¼Œcloseçš„é€»è¾‘æ˜¯æŠŠé‡Œé¢æ‰€æœ‰çš„liveConnectionsæ¸…ç©ºï¼Œç„¶åcloseä¸€éï¼Œæ‰€ä»¥ä¸‹é¢çš„ä»£ç ä¼šæŠ¥é”™ï¼š ä»£ç å—121234567891011121314public static void main(String[] args) throws Exception { String url = \"jdbc:mysql:loadbalance://172.22.119.38:4000,172.22.119.8:4000,172.22.119.30:4000/tidb_test\"; //ä»ç„¶æ˜¯å•ä¾‹çš„Connectionå¯¹è±¡ LoadBalancedConnection connection = (LoadBalancedConnection) DriverManager.getConnection(url, \"tidb_test\", \"lPoK3QMSWY1BhSa3WCT1IWOXYkMc3Aqd\"); Test test = new Test(); for (int i = 0; i &lt; 100; i++) { try { test.triggerQuery(connection); } finally { connection.close(); //è¿™é‡Œcloseæ‰ } }} æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š æ˜¯çš„ã€‚ã€‚å®ƒç›´æ¥æŠ¥é”™äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨selectè¿™ç§è¯­å¥çš„æ‰§è¡Œä¸‹ï¼Œè¦ä¹ˆä½ ç”¨å¤šå®ä¾‹ï¼Œæ¯æ¬¡éƒ½å»ºè¿ï¼Œå®ç°ä½ å¿ƒç›®ä¸­çš„LBï¼Œè¦ä¹ˆä½ å°±ç”¨å•ä¾‹ï¼Œç„¶åä¸€ä¸ªè¿æ¥ç”¨åˆ°åº•ï¼Œè¿™åˆ°åº•ç®—å“ªé—¨å­çš„LoadBalanceå•Šã€‚ã€‚ğŸ˜“ ä½†æ˜¯å®ƒå¹¶éä¸€æ— æ˜¯å¤„ï¼Œæ¯”å¦‚ï¼Œä½ å¯ä»¥ç»“åˆè¿æ¥æ± æ¥ç”¨å®ƒï¼Œè¿™æ ·æ—¢å¯ä»¥ä¿è¯è¿æ¥å¤ç”¨ï¼Œä¹Ÿå¯ä»¥ä¿è¯æ± å†…æ¯ä¸ªè¿æ¥å¯¹è±¡çš„hoståœ¨æœ€å¤§é™åº¦ä¸Šä¸æ˜¯åŒä¸€ä¸ªã€‚ 6.3ï¼šå•ä¾‹æ¨¡å¼ä¸‹çš„äº‹åŠ¡æ“ä½œæŒ‰ç…§æºç ä¸Šçš„ç†è§£ï¼Œç†è®ºä¸Šå³ä¾¿æ˜¯å•ä¾‹ï¼Œå¼€å¯äº‹åŠ¡å¹¶æäº¤çš„æ—¶å€™ä¹Ÿä¼šåˆ‡æ¢ä¸€æ¬¡hostï¼Œç°åœ¨å°†å‰é¢çš„æµ‹è¯•ä»£ç æ”¹æˆä¸‹é¢è¿™æ ·ï¼š ä»£ç å—131234567891011121314151617181920212223242526272829303132333435public static void main(String[] args) throws Exception { String url = \"jdbc:mysql:loadbalance://172.22.119.38:4000,172.22.119.8:4000,172.22.119.30:4000/tidb_test\"; //ä»ç„¶æ˜¯å•ä¾‹çš„Connectionå¯¹è±¡ LoadBalancedConnection connection = (LoadBalancedConnection) DriverManager.getConnection(url, \"tidb_test\", \"lPoK3QMSWY1BhSa3WCT1IWOXYkMc3Aqd\"); Test test = new Test(); for (int i = 0; i &lt; 100; i++) { try { test.triggerTransaction(connection); } finally { //ä¸ºäº†ä¿è¯æ˜¯å•ä¾‹æ¨¡å¼ï¼Œè¿™é‡Œä¸å†close //connection.close(); } }} //å¼€å¯äº‹åŠ¡çš„æ–¹æ³•private void triggerTransaction(LoadBalancedConnection connection) throws Exception { connection.setAutoCommit(false); //å…³é—­è‡ªåŠ¨æäº¤ Statement statement = connection.createStatement(); ResultSet rs = null; try { //è¿™é‡Œæ‰“å°ä¸‹å½“å‰å‚ä¸æ‰§è¡Œsqlçš„è¿æ¥host System.out.println(\"current conn host: \" + connection.getHost()); if (statement.execute(\"select * from t_student where id = 1\")) { rs = statement.getResultSet(); } connection.commit(); //äº‹åŠ¡æäº¤ } finally { if (rs != null) { rs.close(); } statement.close(); }} æ‰“å°ç»“æœå¦‚ä¸‹ï¼š ä»£ç å—141234567891011current conn host: 172.22.119.8current conn host: 172.22.119.30current conn host: 172.22.119.8current conn host: 172.22.119.30current conn host: 172.22.119.38current conn host: 172.22.119.30current conn host: 172.22.119.38current conn host: 172.22.119.30current conn host: 172.22.119.8current conn host: 172.22.119.30...çœç•¥ï¼Œå…±100æ¡... è¿™æ˜¯ç¬¦åˆé¢„æœŸçš„ï¼Œå› ä¸ºå³ä¾¿æ˜¯å•å®ä¾‹ï¼Œæ¯æ¬¡å¤„ç†äº‹åŠ¡çš„èŠ‚ç‚¹ä¹Ÿå‘ç”Ÿäº†å˜æ¢ã€‚ å¤šå®ä¾‹å°±ä¸å†è¯•äº†ï¼Œæ²¡æœ‰å¿…è¦ã€‚ 6.4ï¼šå¼€å¯autoReconnectæ—¶ï¼Œå•ä¾‹æ‰§è¡ŒQueryæ“ä½œæŒ‰ç…§æˆ‘ä»¬çš„ç»“è®ºï¼Œè¿™ä¸ªåªæœ‰åœ¨èŠ‚ç‚¹åæ‰æ—¶æ‰ä¼šé‡æ–°pickèŠ‚ç‚¹ï¼Œä»¥ä¿è¯å¯ç”¨æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨æ¥å¼€å¯å®ƒï¼Œç„¶åä¾ç„¶ç”¨å•ä¾‹æ¨¡å¼æ“ä½œQueryï¼Œä»£ç æ”¹å†™å¦‚ä¸‹ï¼š ä»£ç å—15123456789101112131415public static void main(String[] args) throws Exception { String url = \"jdbc:mysql:loadbalance://172.22.119.38:4000,172.22.119.8:4000,172.22.119.30:4000/tidb_test?autoReconnect=true\"; //å¸¦ä¸ŠautoReconnectå‚æ•°ï¼Œä½¿å…¶ä¸ºtrue //ä»ç„¶æ˜¯å•ä¾‹çš„Connectionå¯¹è±¡ LoadBalancedConnection connection = (LoadBalancedConnection) DriverManager.getConnection(url, \"tidb_test\", \"lPoK3QMSWY1BhSa3WCT1IWOXYkMc3Aqd\"); Test test = new Test(); for (int i = 0; i &lt; 100; i++) { try { test.triggerQuery(connection); } finally { //ä¸ºäº†ä¿è¯æ˜¯å•ä¾‹æ¨¡å¼ï¼Œè¿™é‡Œä¸å†close //connection.close(); } }} è¿è¡Œç»“æœæ‰“å°å¦‚ä¸‹ï¼š ä»£ç å—1612345678current conn host: 172.22.119.8current conn host: 172.22.119.8current conn host: 172.22.119.8current conn host: 172.22.119.8current conn host: 172.22.119.8current conn host: 172.22.119.8current conn host: 172.22.119.8...çœç•¥ï¼Œå…±100æ¡... ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸï¼Œå› ä¸ºå®ƒçš„ä½œç”¨ä¸æ˜¯å¹²è¿™ä¸ªçš„ã€‚ ä¸ƒã€ç»“è®ºJDBCé©±åŠ¨ç¨‹åºçš„LoadBalanceæ¨¡å¼ï¼Œæ˜¯é’ˆå¯¹æ¯ä¸€ä¸ªè¢«æ–°å»ºå‡ºæ¥çš„Connectionå¯¹è±¡çš„LBï¼Œå®ƒå¹¶éå¾ˆå¤šäººç¬¬ä¸€çœ¼çœ‹åˆ°å®ƒåè®®å¤´æ—¶æ‰€ç†è§£çš„é‚£ç§å°†jdbcè¿æ¥é‡Œé…ç½®çš„æ‰€æœ‰èŠ‚ç‚¹è§†ä½œä¸€ä¸ªæ•´ä½“ï¼Œæ¯æ¬¡åˆ©ç”¨Connectionå¯¹è±¡åšä¸€äº›æ“ä½œæ—¶éƒ½ä¼špickå‡ºæ¥ä¸€ä¸ªèŠ‚ç‚¹ä½¿ç”¨ï¼Œä»¥è¾¾åˆ°æŸç§æ„ä¹‰ä¸Šçš„è´Ÿè½½å‡è¡¡ï¼Œè€Œæ˜¯æ¯æ¬¡æ–°å»ºConnectionå¯¹è±¡æ—¶ï¼Œä»é‚£å †hosté‡Œpickå‡ºæ¥å…¶ä¸­ä¸€ä¸ªï¼Œåˆ›å»ºå¯¹åº”çš„Connectionå¯¹è±¡ï¼Œè¿™è·Ÿæˆ‘ä»¬ç¬¬ä¸€çœ¼çœ‹åˆ°å®ƒçš„æ„Ÿè§‰ä¸å¤ªä¸€æ ·ï¼Œä½†æ˜¯å®ç°ä¸Šç¡®å®æ²¡ä»€ä¹ˆå¤ªå¤§çš„é—®é¢˜ï¼Œå› ä¸ºå•çº¯ä½¿ç”¨JDBCæ—¶æœ¬å°±ä¸æå€¡Connectionå•ä¾‹å¤ç”¨ï¼Œè‹¥æƒ³è¦å¤ç”¨ï¼Œéœ€è¦ç»“åˆå„ç±»è¿æ¥æ± ä¸€èµ·ä½¿ç”¨ï¼Œé€šè¿‡å¯¹JDBCçš„LBæ¨¡å¼çš„äº†è§£å¯ä»¥çŸ¥é“ï¼Œç»“åˆæŸç§è¿æ¥æ± æŠ€æœ¯æ¥æ”¯æ’‘ï¼Œå°±å¯ä»¥è¾¾åˆ°æˆ‘ä»¬æƒ³è±¡ä¸­çš„LBæ•ˆæœï¼Œå› ä¸ºæ± å†…æ¯ä¸€ä¸ªConnectionå¯¹è±¡åœ¨åˆ›å»ºæ—¶ï¼Œæ€»ä¼šè§¦å‘JDBCçš„LBç­–ç•¥ã€‚","link":"/2020/06/02/%E8%AF%A6%E8%A7%A3JDBC%E7%9A%84Loadbalance%E6%A8%A1%E5%BC%8F/"},{"title":"JAVAæœ‰å…³ä½è¿ç®—çš„å…¨å¥—æ¢³ç†","text":"ä¸€ã€åœ¨è®¡ç®—æœºä¸­æ•°æ®æ˜¯å¦‚ä½•è¿›è¡Œè®¡ç®—çš„ï¼Ÿ1.1ï¼šjavaä¸­çš„byteå‹æ•°æ®å–å€¼èŒƒå›´æˆ‘ä»¬æœ€å¼€å§‹å­¦ä¹ javaçš„æ—¶å€™çŸ¥é“ï¼Œbyteç±»å‹çš„æ•°æ®å äº†8ä¸ªbitä½ï¼Œæ¯ä¸ªä½ä¸Šæˆ–0æˆ–1ï¼Œå·¦è¾¹ç¬¬ä¸€ä½è¡¨ç¤ºç¬¦å·ä½ï¼Œç¬¦å·ä½å¦‚æœä¸º1è¡¨ç¤ºè´Ÿæ•°ï¼Œä¸º0åˆ™è¡¨ç¤ºæ­£æ•°ï¼Œå› æ­¤è¦æ¨ç®—byteçš„å–å€¼èŒƒå›´ï¼Œåªéœ€è¦è®©æ•°å€¼ä½æ¯ä¸€ä½ä¸Šéƒ½ç­‰äº1å³å¯ã€‚æˆ‘ä»¬æ¥ç”¨æˆ‘ä»¬çš„å¸¸è§„æ€ç»´æ¥åˆ†æä¸‹byteç±»å‹çš„å–å€¼èŒƒå›´ï¼š å¦‚æœæŒ‰ç…§è¿™ç§æ€è·¯æ¥æ¨ç®—ï¼Œä¸ƒä¸ª1çš„äºŒè¿›åˆ¶æ•°è½¬æ¢ä¸ºåè¿›åˆ¶æ˜¯127ï¼Œç®—ä¸Šç¬¦å·ä½ï¼Œå–å€¼èŒƒå›´åº”ä¸ºï¼š-127~127ï¼Œä½†äº‹å®ä¸Šæˆ‘ä»¬çŸ¥é“ï¼Œbyteçš„å–å€¼èŒƒå›´æ˜¯-128~127ï¼Œè¿™é‡Œå…ˆæ‰“ä¸ªé—®å·ï¼Œæ¥ç€å¾€ä¸‹çœ‹ã€‚ç°åœ¨è®©æˆ‘ä»¬è®¡ç®—ä¸‹byteç±»å‹çš„7åŠ ä¸Šbyteç±»å‹çš„-2æ˜¯å¤šå°‘ï¼š è¯¶ï¼Ÿè·Ÿæˆ‘ä»¬é¢„æƒ³çš„ä¸ä¸€æ ·ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯çŸ¥é“7å’Œ-2çš„å’Œåº”è¯¥æ˜¯5æ‰å¯¹ï¼Œç»“æœåº”è¯¥è¡¨ç¤ºä¸ºï¼š00000101ï¼Œä½†äº‹å®ä¸Šé€šè¿‡å›¾2çš„ç»“æœæ¥çœ‹ç¡®å®è·Ÿé¢„æƒ³çš„ä¸ä¸€æ ·ï¼Œæ‰€ä»¥è®¡ç®—æœºåœ¨åšè®¡ç®—çš„æ—¶å€™ï¼Œè‚¯å®šä¸æ˜¯è¡¨é¢ä¸Šçš„ç¬¦å·ä½+æ•°å€¼ä½çš„æ–¹å¼è¿›è¡Œçš„è®¡ç®—çš„ã€‚ 1.2ï¼šåŸç ï¼Œåç ï¼Œè¡¥ç æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹å®šä¹‰ï¼š ğŸ‘‰ åŸç å®šä¹‰ï¼šç¬¦å·ä½åŠ åé¢çš„æ•°å€¼ï¼Œæ¯”å¦‚å›¾2é‡Œçš„00000111å’Œ10000010éƒ½æ˜¯åŸç ï¼ŒåŸç æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨ä¸Šé¢å•çº¯ç†è§£ä¸Šçš„åŸå€¼ã€‚ ğŸ‘‰ åç å®šä¹‰ï¼šæ­£æ•°çš„åç å°±æ˜¯å®ƒçš„åŸç ï¼Œè´Ÿæ•°çš„åç ç¬¦å·ä½ä¸å˜ï¼Œå…¶ä½™æ•°å€¼ä½å…¨éƒ¨æŒ‰ä½å–åï¼Œä¾‹å¦‚ï¼š 00000111çš„åç ï¼š00000111 10000010çš„åç ï¼š11111101 ğŸ‘‰ è¡¥ç å®šä¹‰ï¼šåŒæ ·çš„ï¼Œæ­£æ•°çš„è¡¥ç ä»ç„¶ç­‰äºå®ƒçš„åŸç æœ¬èº«ï¼Œè´Ÿæ•°çš„è¡¥ç ç­‰äºå®ƒè‡ªå·±çš„åç +1ï¼Œä¾‹å¦‚ï¼š 00000111çš„è¡¥ç ï¼š00000111 10000010çš„è¡¥ç ï¼š11111110 ğŸŒ´ æ€»ç»“ï¼šæ­£æ•°çš„åŸç ã€åç ã€è¡¥ç å®Œå…¨ä¸€è‡´ï¼Œè´Ÿæ•°çš„åç ç­‰äºå®ƒåŸç çš„æ•°å€¼ä½æŒ‰ä½å–åï¼Œè´Ÿæ•°çš„è¡¥ç ç­‰äºå®ƒçš„åç +1 ç°åœ¨è®©æˆ‘ä»¬ç”¨åç çš„æ–¹å¼æ¥è®¡ç®—ä¸‹å›¾2ä¸­çš„å¼å­ï¼š åˆ©ç”¨æ•°å€¼çš„åç è®¡ç®—å‡ºçš„ç»“æœå·²ç»å¾ˆæ¥è¿‘æ­£ç¡®ç­”æ¡ˆäº†ï¼Œ+4çš„åç ç­‰äºå®ƒçš„åŸç ï¼Œç°åœ¨åªéœ€è¦è®©å®ƒ+1å°±æ˜¯æ­£ç¡®ç­”æ¡ˆï¼Œè¿˜è®°å¾—è¡¥ç çš„å®šä¹‰å—ï¼Ÿè´Ÿæ•°çš„è¡¥ç ç­‰äºå®ƒçš„åç +1ï¼Œé‚£ç°åœ¨è®©æˆ‘ä»¬ç”¨è¡¥ç åšä¸‹è®¡ç®—è¯•è¯•ï¼Ÿ okï¼Œæˆ‘ä»¬å‘ç°ï¼Œç”¨å®ƒä»¬çš„è¡¥ç åšåŠ æ³•ï¼Œå¾—åˆ°çš„æ•°å€¼å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ­£ç¡®ç­”æ¡ˆï¼Œäº‹å®ä¸Šï¼Œè®¡ç®—æœºå¹¶æ²¡æœ‰å‡æ³•è¿ç®—å™¨ï¼Œæ‰€æœ‰çš„å‡æ³•è¿ç®—ï¼Œéƒ½æ˜¯ä»¥ä¸€ä¸ªæ­£æ•°åŠ ä¸Šä¸€ä¸ªè´Ÿæ•°çš„å½¢å¼æ¥äº¤ç»™åŠ æ³•è¿ç®—å™¨è®¡ç®—çš„ï¼Œç”±äºè´Ÿæ•°çš„ç¬¦å·ä½ä¸º1ï¼Œè™½ç„¶æˆ‘ä»¬äººæ˜¯çŸ¥é“å®ƒçš„å«ä¹‰ï¼Œä½†æ˜¯ä½œä¸ºè®¡ç®—æœºï¼Œå®ƒæ˜¯ä¸çŸ¥é“ç¬¬ä¸€ä½æ˜¯ç¬¦å·ä½çš„ï¼Œå®ƒè¦åšçš„å°±ä»…ä»…æ˜¯è®©ä¸¤ä¸ªæ•°ç›¸åŠ è€Œå·²ï¼Œæ­£æ˜¯å› ä¸ºå¦‚æ­¤ï¼Œæˆ‘ä»¬æ‰ä¸èƒ½ç®€ç®€å•å•ä¿å­˜è´Ÿæ•°ï¼Œé€šè¿‡å›¾4æˆ‘ä»¬çŸ¥é“ï¼Œä¸¤ä¸ªæ•°çš„è¡¥ç ç›¸åŠ ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªå‡†ç¡®çš„æ•°å€¼ã€‚ å†ä¸¾ä¸ªç›¸åŠ ç»“æœä¸ºè´Ÿæ•°çš„ä¾‹å­ï¼Œè®©ä¸¤ä¸ªè´Ÿæ•°ç›¸åŠ ï¼š å¦‚æœç»“æœä¸ºè´Ÿæ•°çš„è¯ï¼Œä¹Ÿæ˜¯é€‚ç”¨çš„ï¼Œåªæ˜¯å®ƒä»ç„¶æ˜¯ä»¥è¡¥ç çš„å½¢å¼å­˜æ”¾çš„ï¼Œéœ€è¦è½¬æˆåŸç æ‰ç¬¦åˆæˆ‘ä»¬äººçš„ç†è§£æ–¹å¼ã€‚ ç°åœ¨å›åˆ°ä¸Šé¢ç•™ä¸‹çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆbyteçš„å–å€¼èŒƒå›´æ˜¯-128~127å‘¢ï¼Ÿ æˆ‘ä»¬ä¹‹å‰æŒ‰ç…§å›¾1é‡Œçš„ç†è§£ï¼Œç†æ‰€åº”å½“çš„ä»¥ä¸ºå®ƒåº”è¯¥æ˜¯-127~127çš„èŒƒå›´ï¼Œé‚£æ˜¯å› ä¸ºæˆ‘ä»¬æŒ‰ç…§å›¾1çš„ç†è§£æ–¹å¼ï¼Œæ•°å€¼å°±æ˜¯ä»¥ç¬¦å·ä½+æ•°å€¼ä½çš„æ–¹å¼ç†è§£çš„ï¼ˆä¹Ÿå°±æ˜¯æŒ‰ç…§åŸç çš„æ–¹å¼ç†è§£çš„ï¼‰ï¼Œä½†æ˜¯ä½ å¯ä»¥æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæŒ‰ç…§å›¾1é‚£ç§ç†è§£æ–¹å¼ï¼Œæ˜¯ä¸æ˜¯ä¼šå­˜åœ¨ä¸¤ä¸ª0å€¼å‘¢ï¼Ÿ å³ï¼š10000000å’Œ00000000ï¼Œ+0å’Œ-0ï¼› å…¶æ¬¡å¦‚æœç«™åœ¨æœºå™¨è§’åº¦ä¸Šæ¥è¯´ï¼Œæ‰€æœ‰çš„è´Ÿæ•°éƒ½å¾ˆå¤§ï¼Œè‡³å°‘è¦æ¯”æ‰€æœ‰æ­£æ•°å¤§ï¼Œå› ä¸ºè´Ÿæ•°çš„æœ€é«˜ä½ä¹Ÿå°±æ˜¯ç¬¦å·ä½éƒ½æ˜¯1ï¼Œæ˜¾ç„¶è¿™æ˜¯ä¸å¯¹çš„ï¼Œé€šè¿‡æœ¬èŠ‚æˆ‘ä»¬çŸ¥é“äº†ï¼Œæ‰€æœ‰çš„æ•°å‡é€šè¿‡è‡ªå·±çš„è¡¥ç å®Œæˆè®¡ç®—ï¼Œå¦‚æœå°†æœ€åå¾—åˆ°çš„ç»“æœè½¬æˆåŸç ï¼Œå°±æ˜¯æˆ‘ä»¬äººçœ¼å¯ä»¥ç†è§£çš„æœ€ç»ˆå€¼ï¼ˆç¬¦å·ä½+æ•°å€¼ä½ï¼‰ï¼Œå¦‚æœç°åœ¨åˆ©ç”¨è¡¥ç çš„æ–¹å¼åšç†è§£ï¼Œç¬¦å·ä½ä¸º0çš„æ•°æ²¡å•¥å¥½è¯´çš„ï¼Œè‡ªç„¶å–å€¼åŒºé—´ä¸ºï¼š0~127ï¼Œä½†æ˜¯ç¬¦å·ä½ä¸º1çš„è´Ÿæ•°å‘¢ï¼Ÿè´Ÿæ•°å°±å­˜åœ¨ä¸€ä¸ªç‰¹æ®Šå€¼ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¹‹å‰ç‰‡é¢ç†è§£çš„-0ï¼‰ï¼š10000000ï¼Œå¦‚æœæŒ‰ç…§åŸç ç†è§£å®ƒæ˜¯-0ï¼Œä½†æˆ‘ä»¬å‰é¢è¯´è¿‡ï¼Œè®¡ç®—æœºé‡Œæ‰€æœ‰æ•°å­—ï¼Œéƒ½æ˜¯ä»¥è¡¥ç çš„æ–¹å¼å‚ä¸è¿ç®—çš„ï¼Œè€Œè´Ÿæ•°çš„è¡¥ç ä¸ç­‰äºå…¶åŸç ï¼Œè¿™ä¸ª10000000åœ¨è®¡ç®—æœºé‡Œæ˜¾ç„¶æ˜¯æŸä¸ªè´Ÿæ•°çš„è¡¥ç ï¼Œé‚£ä¹ˆé—®é¢˜å°±å˜çš„ç®€å•å¤šäº†ï¼Œå³10000000æ˜¯è°çš„è¡¥ç å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼š-128ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè´Ÿæ•°çš„å–å€¼èŒƒå›´ä¼šæ¯”æ­£æ•°å¤šä¸€ä¸ªçš„åŸå› ï¼Œbyteç±»å‹å¦‚æ­¤ï¼Œå…¶å®ƒç±»å‹ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæ¯”å¦‚intå‹çš„è´Ÿæ•°å–å€¼ä¹Ÿæ¯”æ­£æ•°å¤š1ã€‚ è¿™ä¸€å—çš„å®šä¹‰è¦æ¸…æ™°ï¼Œå¯¹ç†è§£åé¢çš„ä½è¿ç®—ä¼šæœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚ äºŒã€javaä¸­çš„ä½è¿ç®—2.1ï¼šä¸è¿ç®—ä¸è¿ç®—ç¬¦å·ï¼š&amp; ä¸è¿ç®—ç‰¹ç‚¹ï¼š1&amp;1=1ã€1&amp;0=0ã€0&amp;1=0ã€0&amp;0=0 ç°åœ¨æˆ‘ä»¬æ¥ä¸¾ä¸€ä¸ªä¾‹å­ï¼š è®©æˆ‘ä»¬å†æ¥è¯•è¯•è´Ÿæ•°ï¼š 2.2ï¼šæˆ–ã€å¼‚æˆ–è·Ÿä¸è¿ç®—çš„è¿ç®—æ–¹å¼ä¸€è‡´ï¼Œåªä¸è¿‡è§„åˆ™ä¸å¤ªä¸€æ ·ï¼š æˆ–è¿ç®—ç¬¦å·ï¼š| æˆ–è¿ç®—è§„åˆ™ï¼š1|1=1ã€1|0=1ã€0|1=1ã€0|0=0 å¼‚æˆ–è¿ç®—ç¬¦å·ï¼š^ å¼‚æˆ–è¿ç®—è§„åˆ™ï¼š1^1=0ã€1^0=1ã€0^1=1ã€0^0=0 2.3ï¼šæŒ‰ä½å–åå–åç¬¦å·ï¼š~ å³ä¸€ä¸ªæ•°å¯¹è‡ªå·±å–åï¼Œä¾‹å¦‚ï¼š æŸä¸ªæ•°å­—açš„äºŒè¿›åˆ¶ä¸ºï¼š 1010110ï¼Œåˆ™~aä¸ºï¼š 0101001 2.4ï¼šå·¦ç§»è¿ç®—å·¦ç§»è¿ç®—ç¬¦ï¼š&lt;&lt; ä¾‹å¦‚ï¼š ä½è¿ç®—è¶Šç•Œ&amp;æ•°ä½æŠ›å¼ƒï¼š å›¾8ä¸­çš„116çš„äºŒè¿›åˆ¶æ•°çš„æ•°å€¼ä½ä¸º7ä½ï¼Œç¬¦å·ä½ä¸º0ï¼Œæ­¤æ—¶å¦‚æœå·¦ç§»è¶…è¿‡24ä½ï¼Œå°±ä¼šå‡ºç°è´Ÿæ•°ï¼Œä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿå› ä¸ºjavaä¸­çš„ä½ç§»è¶Šç•Œæ—¶ï¼Œjavaä¼šæŠ›å¼ƒé«˜ä½è¶Šç•Œéƒ¨åˆ†ï¼Œæˆ‘ä»¬çŸ¥é“javaé‡Œintç±»å‹çš„ç¬¬ä¸€ä½æ˜¯ç¬¦å·ä½ï¼Œå¦‚æœç¬¦å·ä½æ˜¯1ï¼Œåˆ™è¡¨ç¤ºå…¶ä¸ºè´Ÿæ•°ï¼Œç°åœ¨å°†æ•°å€¼ä½å 7bitç¬¦å·ä½ä¸º0çš„116å·¦ç§»24ä½ï¼Œå°±ä¼šå‡ºç°ä¸‹æ–¹ç»“æœï¼š 01110100000000000000000000000000 æ­£å¥½31ä½å å…¨ï¼Œé¡¶è‡³ç¬¦å·ä½ï¼Œä½ä½è¡¥0ï¼Œæˆ‘ä»¬ç§°24ä¸º116çš„ä¸è¶Šç•Œçš„æœ€å¤§å·¦ç§»å€¼ï¼Œè‹¥è¶…å‡ºè¿™ä¸ªå€¼ï¼Œå°±ä¼šè¶Šç•Œï¼Œæ¯”å¦‚å·¦ç§»25ä½ï¼š 11101000000000000000000000000000 æ˜¾ç„¶å·¦ç§»25ä½åä¼šæŠŠæ•°å€¼ä½çš„1ç§»åŠ¨åˆ°ç¬¦å·ä½ï¼Œè¿™æ—¶å®ƒè¡¨ç¤ºä¸ºä¸€ä¸ªè´Ÿæ•°çš„è¡¥ç ã€‚æ ¹æ®è¿™ä¸ªè§„åˆ™ï¼Œæˆ‘ä»¬å¦‚æœè®©å…¶å·¦ç§»28ä½ï¼Œåˆ™å€¼ä¸ºï¼š 01000000000000000000000000000000 ä¹Ÿå°±æ˜¯åè¿›åˆ¶çš„1073741824ï¼Œå³ï¼š116 &lt;&lt; 28 = 1073741824ï¼Œé‚£å¦‚æœè¶Šç•Œè¿‡å¤šå‘¢ï¼Ÿæ¯”å¦‚intå‹çš„æ•°æ®ï¼Œå·¦ç§»32ä½ï¼š116 &lt;&lt; 32 = 116 ä¼šå‘ç°ï¼Œå¦‚æœå·¦ç§»è‡ªå·±ä½æ•°ä¸€æ ·å¤šçš„ä½æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å°±ç­‰äºå®ƒæœ¬èº«ï¼Œå› æ­¤è¿ç®—ç¬¦åˆä»¥ä¸‹è§„åˆ™ï¼š è®¾xä¸ºè¢«ä½ç§»å€¼ï¼Œyä¸ºæœ¬æ¬¡ä½ç§»çš„ä½æ•°ï¼Œzä¸ºxæ‰€å±ç±»å‹çš„æœ€å¤§å­˜å‚¨ä½æ•°ï¼š x &lt;&lt; y = x &lt;&lt; (y%z) å¦‚æœæ˜¯intå‹ï¼ˆ32ä½ï¼Œlongå‹å°±ç”¨64ä»£å…¥è®¡ç®—ï¼‰ï¼Œç¬¦åˆå¦‚ä¸‹è§„åˆ™ï¼š 116 &lt;&lt; 4 = 116 &lt;&lt; (4%32) = 116 &lt;&lt; 4 = 1856 116 &lt;&lt; 32 = 116 &lt;&lt; (32%32) = 116 &lt;&lt; 0 = 116 116 &lt;&lt; 36 = 116 &lt;&lt; (36%32) = 116 &lt;&lt; 4 = 1856 2.5ï¼šæœ‰ç¬¦å·å³ç§»è¿ç®—&amp;æ— ç¬¦å·å³ç§»è¿ç®—æœ‰ç¬¦å·å³ç§»è¿ç®—ç¬¦ï¼š&gt;&gt; æ— ç¬¦å·å³ç§»è¿ç®—ç¬¦ï¼š&gt;&gt;&gt; ä¾‹å¦‚ï¼ša &gt;&gt; bè¡¨ç¤ºaå³ç§»bä½ï¼Œè·Ÿä¸Šé¢çš„å·¦ç§»ä¾‹å­ä¸€æ ·ï¼Œå³ç§»ä¹Ÿä¼šæœ‰è¶Šç•Œé—®é¢˜ï¼Œåªæ˜¯å³ç§»è¶Šç•Œæ˜¯ä»å³è¾¹å¼€å§‹æŠ›å¼ƒè¶Šç•Œéƒ¨åˆ†çš„ï¼Œå³ç§»æ“ä½œæœ‰ç¬¦å·ä½å¹²æ‰°ï¼Œå¦‚æœæ˜¯æ­£æ•°å³ç§»ï¼Œæ— æ­¤å¹²æ‰°é¡¹ï¼Œå› ä¸ºç¬¦å·ä½æœ¬å°±æ˜¯0å³ç§»ä¸ä¼šå½±å“å€¼çš„å‡†ç¡®æ€§ï¼Œä½†å¦‚æœæ˜¯è´Ÿæ•°ï¼Œç¬¬ä¸€ä½æ˜¯ç¬¦å·ä½ï¼Œä¸”å€¼ä¸º1ï¼Œå³ç§»å°±æœ‰å½±å“äº†ï¼Œç°åœ¨ä»ç„¶ä»¥116ä¸ºä¾‹ï¼š æ­£æ•°å³ç§»ï¼š ä¸Šè¿°æ˜¯æ­£æ•°ï¼Œå³ç§»æ— å½±å“ï¼Œä½†æ˜¯è´Ÿæ•°ï¼Œè¿™é‡Œä»¥-116ä¸ºä¾‹ï¼Œæˆ‘ä»¬çŸ¥é“è´Ÿæ•°åœ¨è®¡ç®—æœºé‡Œæ˜¯ä»¥è¡¥ç çš„å½¢å¼å­˜å‚¨çš„ï¼Œæ‰€ä»¥å›¾é‡Œç›´æ¥ç”¨-116çš„è¡¥ç åšè¿ç®—ï¼Œä½ç§»è¿‡ç¨‹å¦‚ä¸‹ï¼š ä½ ä¼šå‘ç°å³ç§»è·Ÿå·¦ç§»ä¸ä¸€æ ·ï¼Œå·¦ç§»æ˜¯ä¸ç”¨æ‹…å¿ƒè‡ªå·±ç¬¦å·ä½å­˜åœ¨â€œè¡¥ä½â€é—®é¢˜çš„ï¼Œä½†æ˜¯å³ç§»å­˜åœ¨ï¼Œå¦‚å›¾ä¸­-116å³ç§»4ä½åï¼Œå·¦è¾¹ç¬¬ä¸€ä½ï¼Œä¹Ÿå°±æ˜¯ç¬¦å·ä½ï¼Œå°±é¢ä¸´ç€è¡¥ä½çš„é—®é¢˜ï¼Œé‚£æˆ‘ç°åœ¨æ˜¯è¯¥è¡¥1å‘¢ï¼Œè¿˜æ˜¯è¡¥0å‘¢ï¼Ÿè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå³ç§»æ“ä½œä¼šå­˜åœ¨æœ‰ç¬¦å·å³ç§»å’Œæ— ç¬¦å·å³ç§»ä¸¤ç§ç§»åŠ¨æ–¹å¼ï¼š â˜˜ï¸ æœ‰ç¬¦å·å³ç§»ï¼šä¾ç…§åŸç¬¦å·ä½ï¼Œå¦‚æœåŸç¬¦å·ä½æ˜¯1ï¼Œé‚£ä¹ˆå›¾4é‡Œéœ€è¦è¡¥ä½çš„ç©ºä½å…¨éƒ¨è¡¥1ï¼Œå¦‚æœåŸç¬¦å·ä½ä¸º0ï¼Œåˆ™å…¨éƒ¨è¡¥0 â˜˜ï¸ æ— ç¬¦å·å³ç§»ï¼šæ— è§†åŸç¬¦å·ä½ï¼Œå…¨éƒ¨è¡¥0 ç°åœ¨è®©æˆ‘ä»¬ç”¨æœ‰ç¬¦å·çš„æ–¹å¼å°†-116å³ç§»4ä½ï¼Œå³-116 &gt;&gt; 4ï¼ŒæŒ‰ç…§æœ‰ç¬¦å·çš„è§„åˆ™ï¼Œè¡¥ä½ç¬¦åˆåŸç¬¦å·ä½ï¼Œåˆ™å³è¾¹4ä½å…¨éƒ¨è¡¥1ï¼š å¾—åˆ°çš„ä»ç„¶æ˜¯ä¸ªè´Ÿæ•°ï¼Œå®ƒä»ç„¶æ˜¯ä¸€ä¸ªè¡¥ç ï¼Œå›¾é‡Œå±•ç¤ºä¸å¼€ï¼Œå®ƒçš„ç»“æœä¸ºï¼š11111111111111111111111111111000ï¼Œç»è½¬æ¢å¯çŸ¥å®ƒæ˜¯-8çš„è¡¥ç ï¼Œå³ï¼š-116 &gt;&gt; 4 = -8 ç°åœ¨å†è¯•è¯•ç”¨æ— ç¬¦å·å³ç§»ï¼Œæ ¹æ®æ— ç¬¦å·çš„ç‰¹ç‚¹ï¼Œå³ç§»åçš„å‰å››ä½æ— è„‘è¡¥0ï¼š å›¾é‡Œå±•ç¤ºä¸å¼€ï¼Œå®ƒçš„ç»“æœä¸ºï¼š00001111111111111111111111111000 å¯è§å®ƒæ˜¯ä¸ªæ­£æ•°ï¼Œè½¬æ¢æˆåè¿›åˆ¶ä¸ºï¼š268435448ï¼Œå³ï¼š-116 &gt;&gt;&gt; 4 = 268435448 æœ€åè¯´ä¸€ä¸‹ï¼Œè·Ÿå·¦ç§»ä¸€æ ·ï¼Œå³ç§»é‡Œä¸ç®¡æ˜¯æœ‰ç¬¦å·è¿˜æ˜¯æ— ç¬¦å·ï¼Œä¹Ÿç¬¦åˆå–ä½™çš„æ–¹å¼ï¼Œè®¡ç®—å‡ºä½ç§»çš„æœ€ç»ˆä½æ•°ï¼š -116 &gt;&gt; 4 = -116 &gt;&gt; (4%32) = -116 &gt;&gt; 4 = -8 -116 &gt;&gt; 32 = -116 &gt;&gt; (32%32) = -116 &gt;&gt; 0 = -116 -116 &gt;&gt; 36 = -116 &gt;&gt; (36%32) = -116 &gt;&gt; 4 = -8 2.6ï¼šç±»å‹è½¬æ¢æº¢å‡ºäº†è§£å®Œä½è¿ç®—ï¼Œæ¥çœ‹ä¸€ä¸ªæ¯”è¾ƒå®é™…çš„é—®é¢˜ï¼Œçœ‹ä¸‹é¢çš„ä»£ç ï¼š 12long a = 8934567890233345621L;int b = (int) a; //bçš„å€¼ä¸º-1493678507 æœ€ç»ˆbçš„å€¼æ˜¯ä¸€ä¸ªè´Ÿæ•°ï¼Œè¿™æ˜¯ç”±äºlongå‹64ä½ï¼Œè®©intå‹å¼ºè¡Œæ¥æ”¶ï¼Œä¼šå‡ºç°ä½æº¢å‡ºçš„é—®é¢˜ï¼Œè¿™ä¸ªæµç¨‹å¦‚ä¸‹ï¼š ä¸‰ã€ä½è¿ç®—åœ¨å®é™…é¡¹ç›®ä¸­çš„è¿ç”¨ä½è¿ç®—çš„æ€§èƒ½æ˜¯éå¸¸å¥½çš„ï¼Œç›¸æ¯”è¿ç®—æµç¨‹ï¼Œè®¡ç®—æœºæ›´å–œæ¬¢è¿™ç§çº¯ç²¹çš„é€»è¾‘é—¨å’Œç§»åŠ¨ä½ç½®çš„è¿ç®—ï¼Œä½†ä½è¿ç®—åœ¨å¹³å¸¸çš„ä¸šåŠ¡ä»£ç é‡Œå¹¶ä¸å¤ªå¸¸è§ï¼Œå› ä¸ºå®ƒçš„å¯è¯»æ€§ä¸å¤ªå¥½ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶å¯ä»¥åˆ©ç”¨ä½è¿ç®—æ¥è§£å†³ä¸€äº›å®é™…é¡¹ç›®é‡Œçš„é—®é¢˜ã€‚ æ¯”å¦‚ç”¨æ¥è¡¨ç¤ºå¼€å…³çš„åŠŸèƒ½ï¼Œæ¯”å¦‚éœ€æ±‚é‡Œç»å¸¸æœ‰è¿™ç§å­—æ®µï¼šæ˜¯å¦å…è®¸xxï¼ˆ0ä¸å…è®¸ï¼Œ1å…è®¸ï¼‰ï¼Œæ˜¯å¦æœ‰yyæƒé™ï¼ˆ0æ²¡æœ‰ï¼Œ1æœ‰ï¼‰ï¼Œæ˜¯å¦å­˜åœ¨zzï¼ˆ0ä¸å­˜åœ¨ï¼Œ1å­˜åœ¨ï¼‰ ä¸Šé¢åªæ˜¯ä¸¾ä¾‹ï¼Œç±»ä¼¼è¿™ç§åªæœ‰ä¸¤ç§å–å€¼çŠ¶æ€çš„å±æ€§ï¼Œå¦‚æœå½“æˆæ•°æ®åº“å­—æ®µæ”¾è¿›å»çš„è¯ï¼Œå¤ªè¿‡æµªè´¹ï¼Œå¦‚æœä¹‹ååˆæœ‰ç±»ä¼¼çš„å­—æ®µï¼Œåˆå¾—æ–°å¢æ•°æ®åº“å­—æ®µï¼Œä¸ºäº†åªæœ‰ä¸¤ç§å–å€¼çš„å­—æ®µï¼Œå®åœ¨æ˜¯ä¸å¤ªå€¼å¾—ã€‚ è¿™ä¸ªæ—¶å€™ä½•ä¸ç”¨ä¸€ä¸ªå­—æ®µæ¥è¡¨ç¤ºè¿™äº›å­—æ®µå‘¢ï¼Ÿä½ å¯èƒ½å·²ç»çŒœåˆ°è¦æ€ä¹ˆåšäº†ï¼š é¡¶ä¸€ä¸ªintå‹æˆ–è€…longå‹çš„å­—æ®µï¼Œè®©å®ƒçš„æ¯ä¸€ä¸ªäºŒè¿›åˆ¶ä½æ‹¥æœ‰ç‰¹æ®Šå«ä¹‰å³å¯ï¼Œç„¶åæŒ‰ç…§ä½è¿ç®—å°†å…¶å¯¹åº”çš„ä½ç½®ä¸Šçš„æ•°å€¼å˜æˆ0æˆ–1ï¼Œé‚£å¦‚ä½•å°†æŸä¸ªæ•°çš„äºŒè¿›åˆ¶ä½ç¬¬xä½ä¸Šçš„æ•°å€¼å˜æˆ1æˆ–0å‘¢ï¼Ÿå…¶å®è¿™åœ¨ä½å›¾ç»“æ„é‡Œç»å¸¸ç”¨åˆ°ï¼Œå°±æ˜¯åˆ©ç”¨1è¿™ä¸ªç‰¹æ®Šçš„å€¼ä½œä½ç§»è¿ç®—åå†ä¸åŸå€¼è¿›è¡Œä½è¿ç®—ï¼Œè®©æˆ‘ä»¬çœ‹ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼š æŠŠä¸€ä¸ªæ•°çš„ç¬¬2ä½çš„å­—ç¬¦å˜æˆ1ï¼Œç°åœ¨å‡è®¾è¿™ä¸ªæ•°åˆå§‹åŒ–ä¸º0ï¼Œintå‹ï¼Œæˆ‘ä»¬æŠŠå®ƒå½“æˆäºŒè¿›åˆ¶å±•ç¤ºå‡ºæ¥ï¼š ç°åœ¨å¦‚ä½•æŠŠè¿™ä¸ªæ•°çš„ç¬¬äºŒä½å˜æˆ1å‘¢ï¼Ÿç›®å‰æ˜¯è¿™æ ·åšçš„ï¼š 10 | 1 &lt;&lt; 1 å³åŸå€¼è·Ÿ1å·¦ç§»1ä½åçš„å€¼ä½œæˆ–è¿ç®—ï¼Œå…ˆæ¥çœ‹çœ‹1 &lt;&lt; 1çš„ç»“æœï¼š ç„¶åæ‹¿ç€å›¾16çš„ç»“æœï¼Œè·ŸåŸæ•°ï¼ˆä¹Ÿå°±æ˜¯0ï¼‰è¿›è¡Œæˆ–è¿ç®—ï¼š å¯ä»¥çœ‹åˆ°ï¼ŒåŸæ•°çš„ç¬¬äºŒä½å·²ç»è¢«ç½®ä¸º1äº†ï¼Œå®ƒçš„åè¿›åˆ¶å¯¹åº”2ï¼Œå…¶å®ƒä½çš„æ•°ç½®ä¸º1ä¹Ÿå¤§åŒå°å¼‚ï¼Œä¾‹å¦‚ï¼Œç°åœ¨è®©ç¬¬6ä½ä¹Ÿå˜æˆ1åªéœ€è¦ï¼š 12 | 1 &lt;&lt; 5 å³æ‹¿ç€åŸå€¼ï¼ˆç°åœ¨ä¸º2ï¼‰è·Ÿ1å·¦ç§»5ä½åçš„æ•°åšæˆ–è¿ç®—ï¼Œè¿™ä¸ªæµç¨‹å¦‚ä¸‹ï¼š çœ‹å®Œäº†æŠŠæŸä¸ªä½ç½®çš„æ•°å€¼ç½®ä¸º1ï¼Œé‚£å¦‚ä½•æŠŠæŸä½è®¾ç½®ä¸º0å‘¢ï¼Ÿæˆ‘ä»¬ç°åœ¨æŠŠå›¾18é‡Œçš„ç»“æœçš„ç¬¬6ä½é‡æ–°ç½®å›0ï¼Œç›®å‰çš„åšæ³•ä¸ºï¼š 134 &amp; ~(1 &lt;&lt; 5) å³æ‹¿ç€åŸå€¼ï¼ˆç»è¿‡ä¸Šé¢å‡ æ­¥çš„è¿ç®—ï¼Œç°åœ¨å€¼ä¸º34ï¼‰è·Ÿ1å·¦ç§»5ä½æŒ‰ä½å–ååçš„æ•°åšä¸è¿ç®—ï¼Œæ¥çœ‹ä¸‹è¿™ä¸ªæµç¨‹ï¼š ç»è¿‡ä¸Šé¢çš„æµç¨‹ï¼Œå°±å¯ä»¥æŠŠåŸå€¼çš„ç¬¬6ä½å˜æˆ0äº†ã€‚ é‚£ä¹ˆæˆ‘ä»¬çŸ¥é“äº†è®©ä¸€ä¸ªæ•°çš„äºŒè¿›åˆ¶ä½çš„æŸä½å˜æˆ0æˆ–1çš„æ–¹æ³•ï¼Œé‚£å¦‚ä½•çŸ¥é“ä¸€ä¸ªæ•°çš„æŸä½ä¸Šç©¶ç«Ÿæ˜¯0è¿˜æ˜¯1å‘¢ï¼Ÿæ¯•ç«Ÿæˆ‘ä»¬ä¸šåŠ¡ä»£ç éœ€è¦çŸ¥é“ç¬¬å‡ ä½ä»£è¡¨ä»€ä¹ˆæ„æ€å¹¶ä¸”è·å–åˆ°å¯¹åº”ä½ç½®ä¸Šçš„å€¼ã€‚ å‡å¦‚æˆ‘ç°åœ¨æƒ³çŸ¥é“åè¿›åˆ¶intå‹æ•°34çš„ç¬¬6ä½æ˜¯0è¿˜æ˜¯1ï¼Œå†™æ³•å¦‚ä¸‹ï¼š 134 &gt;&gt; 5 &amp; 1 å³è®©åŸå€¼ï¼ˆ34ï¼‰å³ç§»5ä½åè·Ÿ1åšä¸è¿ç®—ï¼Œæ¥çœ‹ä¸‹è¿™ä¸ªæµç¨‹ï¼š ç”±å›¾å¯ä»¥çœ‹å‡ºï¼Œæƒ³è¦çŸ¥é“ä¸€ä¸ªæ•°çš„ç¬¬å‡ ä½æ˜¯1è¿˜æ˜¯0ï¼Œåªéœ€è¦å°†å…¶å¯¹åº”ä½ç½®ä¸Šçš„å€¼â€œé€¼â€åˆ°æœ€åä¸€ä½ï¼Œç„¶åè·Ÿ1ç›¸ä¸å³å¯ï¼Œå¦‚æœå¯¹åº”ä½ç½®ä¸Šçš„å€¼æ˜¯0ï¼Œé‚£ä¹ˆä¸1ç›¸ä¸åçš„ç»“æœä¸€å®šä¸º0ï¼Œåä¹‹ä¸€å®šä¸º1. â˜˜ï¸ æ€»ç»“ åˆ°è¿™é‡Œå·²ç»è¯´å®Œäº†ä¸ºä»€ä¹ˆè¦ç”¨ä¸€ä¸ªæ•°è¡¨ç¤ºé‚£ä¹ˆå¤šå¼€å…³ï¼Œä»¥åŠå¦‚ä½•ç»™ä¸€ä¸ªå¼€å…³ä½è®¾ç½®å¯¹åº”çš„å¼€å…³å€¼ï¼Œä»¥åŠå¦‚ä½•æ‰¾åˆ°å¯¹åº”å¼€å…³ä½çš„å€¼ï¼Œæœ‰äº†è¿™äº›æ“ä½œï¼Œæˆ‘ä»¬å†ä¹Ÿä¸éœ€è¦ä¸ºè¿™ç§åªæœ‰0å’Œ1å–å€¼çš„å­—æ®µæ–°å¢æ•°æ®åº“å­—æ®µäº†ï¼Œå› ä¸ºä¸€ä¸ªintå‹çš„æ•°å­—ï¼Œå°±å¯ä»¥è¡¨è¾¾32ä¸ªå¼€å…³å±æ€§ï¼Œå¦‚æœè¶…äº†ï¼Œè¿˜å¯ä»¥æ‰©æˆ64ä½çš„longå‹~","link":"/2020/03/10/JAVA%E6%9C%89%E5%85%B3%E4%BD%8D%E8%BF%90%E7%AE%97%E7%9A%84%E5%85%A8%E5%A5%97%E6%A2%B3%E7%90%86/"},{"title":"IDEAæ’ä»¶å¼€å‘ï¼ˆä¸€ï¼‰ä¸€ä¸ªç®€å•çš„è¡¨å•demo","text":"ğŸœ ç‰ˆæœ¬ä¿¡æ¯ï¼š&nbsp;&nbsp; ğŸ æ’ä»¶é¡¹ç›®åŸºäºgradleæ„å»ºã€‚ ğŸ¦Ÿ çŸ¥è¯†èƒŒæ™¯ï¼šswing ğŸ¦‡ å‚è€ƒæ–‡æ¡£ï¼š http://www.jetbrains.org/intellij/sdk/docs/tutorials/build_system/prerequisites.html http://www.jetbrains.org/intellij/sdk/docs/user_interface_components/tool_windows.html http://www.jetbrains.org/intellij/sdk/docs/user_interface_components/dialog_wrapper.html https://intellij-support.jetbrains.com/hc/en-us/community/posts/360003338799-Build-compatible-plugin ç›®æ ‡æœ¬å®ä¾‹å®ç°ä¸€ä¸ªIdeaçš„æ’ä»¶ï¼Œå¼¹å‡ºä¸€ä¸ªè¡¨å•Dialogï¼Œç„¶åç‚¹å‡»æŒ‰é’®ï¼Œè·å–è¡¨å•é‡Œè¾“å…¥çš„å†…å®¹ï¼Œç„¶åå°†å†…å®¹æ‰“å°åœ¨è¡¨å•çš„ä¸Šæ–¹ã€‚ æˆå“å›¾å±•ç¤ºï¼š ä¸€ã€é¡¹ç›®åˆå§‹åŒ–æ–°å»ºä¸€ä¸ªgradleé¡¹ç›®ï¼Œä¿®æ”¹å…¶build.gradleæ–‡ä»¶ï¼š ä»£ç å—112345678910111213141516171819202122232425262728293031323334353637383940plugins { id 'java' id 'org.jetbrains.intellij' version '0.4.14' //å¼•å…¥intellijçš„gradleæ’ä»¶} group 'org.example'version '1.0' //å®šä¹‰jaråŒ…/zipåŒ…çš„ç‰ˆæœ¬å· sourceCompatibility = 1.8 //é™åˆ¶jdkçš„ä½¿ç”¨ç‰ˆæœ¬å·ï¼Œè¿™é‡Œé™åˆ¶åˆ°8ï¼Œè¡¨ç¤ºç”Ÿæˆçš„ideaæ’ä»¶åªèƒ½è¿è¡Œåœ¨jdk8ä»¥ä¸Šçš„ç¯å¢ƒä¸­ repositories { mavenCentral() //è¿œç¨‹ä»“åº“} dependencies { //è¿™é‡Œå¼•åˆ«çš„ä¾èµ–åŒ… testCompile group: 'junit', name: 'junit', version: '4.12'} // See https://github.com/JetBrains/gradle-intellij-plugin/intellij { // è¿™é‡Œæ˜¯æŒ‡æ‰“æ’ä»¶åŒ…çš„æ—¶å€™ç”¨ideaä»€ä¹ˆç‰ˆæœ¬çš„ä¾èµ–åŒ…æ‰“ // æ¯”å¦‚è¿™é‡Œç”¨2019.3æ‰“åŒ…ï¼Œå¦‚æœä½ çš„æ’ä»¶å®ç°æºç é‡Œç”¨äº†2019.3ä¸å­˜åœ¨çš„ä¾èµ–åŒ…æˆ–ç±»ï¼Œå°±ä¼šæŠ¥é”™ // ä¸€èˆ¬å°±å¡«å½“å‰IDEAçš„ç‰ˆæœ¬å·å³å¯ version \"2019.3\"} patchPluginXml { //changeNotesé‡Œçš„å†…å®¹å±•ç¤ºä½ç½®å‚è€ƒå›¾14 changeNotes \"\"\" 1.0ç‰ˆæœ¬. ç¬¬1.0ç‰ˆæœ¬ï¼šåˆå§‹åŒ–è¿™ä¸ªæµ‹è¯•æ’ä»¶é¡¹ç›®\"\"\" // è¿™ä¸ªæ„æ€æ˜¯è¯´å½“å‰å®šä¹‰çš„è¿™ä¸ªæ’ä»¶æœ€æ—©æ”¯æŒåˆ°ä»€ä¹ˆç‰ˆæœ¬çš„IDEA // è¿™é‡Œé…ç½®sinceBuild=191ï¼Œè¡¨ç¤ºæ’ä»¶åªèƒ½è¢«ç‰ˆæœ¬å·å¤§äºç­‰äº2019.1ç‰ˆæœ¬çš„IDEAå®‰è£…ï¼Œä½äºè¿™ä¸ªç‰ˆæœ¬çš„å°†æŠ›æ— æ³•å…¼å®¹çš„é”™è¯¯ // â†‘ä¸Šæ–¹å‚è€ƒè¿™ç¯‡é—®ç­”ï¼šhttps://intellij-support.jetbrains.com/hc/en-us/community/posts/360003338799-Build-compatible-plugin sinceBuild \"191\"} ç„¶åIdeaçš„å³è¾¹æ gradleå°†ä¼šå¤šå‡ºintellijé€‰é¡¹ï¼š è¿™é‡Œè¯´ä¸‹runIdeï¼Œå®ƒç”¨æ¥è°ƒè¯•æ’ä»¶ï¼Œè¿è¡Œå®ƒä¼šå†æ¬¡å¯åŠ¨ä¸€ä¸ªIdeaï¼Œè¿™ä¸ªIdeaä¼šè‡ªåŠ¨å®‰è£…ä¸Šä½ å½“å‰å®šä¹‰çš„æ’ä»¶åŒ…ï¼Œè®©ä½ ç”¨æ¥è°ƒè¯•ã€‚ äºŒã€æ–°å¢plugin.xmlè¿™ä¸ªæ–‡ä»¶éå¸¸é‡è¦ï¼Œå®ƒå¯ä»¥æŒ‡å®šä½ å®šä¹‰çš„æ’ä»¶å‡ºç°åœ¨IDEAçš„å“ªä¸ªä½ç½®ï¼Œå¯ä»¥æŒ‡å®šå…·ä½“çš„å¤„ç†é€»è¾‘ï¼Œè¿˜å¯ä»¥å®šä¹‰æ’ä»¶åç§°ã€å­åç§°ç­‰ç­‰ã€‚ è¿™ä¸ªæ–‡ä»¶ä½äºMATE-INFä¸‹ï¼š é…ç½®å†…å®¹ä¸ºï¼š ä»£ç å—2123456789101112131415161718192021222324252627282930313233343536&lt;idea-plugin&gt; &lt;!--æ’ä»¶çš„idï¼Œæ³¨æ„ä¸è¦è·Ÿå…¶ä»–æ’ä»¶é‡å¤ï¼Œè¿™ä¸ªidå…¨å±€å”¯ä¸€ï¼Œå°½å¯èƒ½å¤æ‚äº›--&gt; &lt;id&gt;plugin.test&lt;/id&gt; &lt;!--æ’ä»¶çš„åç§°--&gt; &lt;name&gt;PluginTest&lt;/name&gt; &lt;vendor email=\"xxxx@qq.com\" url=\"http://www.bilibili.com\"&gt;ä½ å…¬å¸çš„åå­—&lt;/vendor&gt; &lt;!--æ’ä»¶çš„æè¿°ä¿¡æ¯ï¼Œæ”¯æŒhtmlï¼Œå±•ç¤ºçš„ä½ç½®å‚è€ƒå›¾14--&gt; &lt;description&gt;&lt;![CDATA[ Plugin Test&lt;br&gt; ç¬¬ä¸€è¡Œï¼šå•çº¯åªæ˜¯ä¸ªæµ‹è¯•&lt;br&gt; ç¬¬äºŒè¡Œï¼šéƒ½è¯´äº†åªæ˜¯ä¸ªæµ‹è¯•(â—ï¿£(ï½´)ï¿£â—)&lt;br&gt; &lt;a href='https://www.bilibili.com'&gt;ä½ çŒœçŒœè¿™æ˜¯å“ªä¸ªç½‘ç«™ï¼Ÿ&lt;/a&gt; &lt;em&gt;v1.0&lt;/em&gt; ]]&gt;&lt;/description&gt; &lt;extensions defaultExtensionNs=\"com.intellij\"&gt; &lt;!-- Add your extensions here --&gt; &lt;/extensions&gt; &lt;!--è·Ÿbuild.gradleé‡Œçš„sinceBuildä¸€è‡´å³å¯ï¼Œæ„ä¹‰ç›¸åŒï¼Œå¿…é¡»é…ç½®--&gt; &lt;idea-version since-build=\"191\"/&gt; &lt;actions&gt; &lt;!--ä¸‹é¢çš„groupæ˜¯åˆ†ç»„ï¼Œåˆ†ç»„éœ€è¦æœ‰ä¸€ä¸ªå”¯ä¸€çš„idæ ‡è¯†ï¼Œtextç”¨æ¥æ§åˆ¶åˆ†ç»„å‡ºç°åœ¨IDEAæ—¶å‘ˆç°çš„æ–‡æ¡ˆï¼Œdescriptionæ˜¯æè¿°ï¼Œä¸ä¼šå±•ç°å‡ºæ¥ï¼Œç®€å•æè¿°ä¸‹åˆ†ç»„å°±è¡Œ--&gt; &lt;group id=\"PluginTest\" text=\"æ’ä»¶æµ‹è¯•ç»„\" description=\"æ’ä»¶æµ‹è¯•æè¿°\"&gt; &lt;!--add-to-groupæ§åˆ¶æŠŠè¯¥åˆ†ç»„åŠ åˆ°IDEAé‡Œï¼Œgroup-idç”¨æ¥æè¿°åŠ åœ¨å“ªä¸ªä½ç½®ï¼ŒMainMenuè¡¨ç¤ºåŠ åœ¨IDEAä¸Šæ–¹çš„ä¸»èœå•æ é‡Œï¼Œ anchorè¡¨ç¤ºé¡ºåºï¼Œlastè¡¨ç¤ºæœ€åä¸€ä¸ªï¼Œæ‰€ä»¥ä¸‹é¢çš„é…ç½®å¯ä»¥æè¿°ä¸ºï¼šå°†è¯¥æ’ä»¶åŠ åˆ°IDEAä¸Šæ–¹ä¸»èœå•æ çš„æœ€åä¸€ä½--&gt; &lt;add-to-group group-id=\"MainMenu\" anchor=\"last\"/&gt; &lt;!--è¿™ä¸ªç”¨æ¥æŒ‡å®šä¸€ä¸ªåˆ†ç»„ä¸‹çš„è§¦å‘åŠ¨ä½œï¼ŒåŒæ ·çš„éœ€è¦ä¸€ä¸ªidï¼Œè‡ªå®šä¹‰ï¼›classå°±æ˜¯ç”¨æ¥å¤„ç†è¿™ä¸ªåŠ¨ä½œçš„é€»è¾‘ç±»ï¼Œå…·ä½“çš„æ’ä»¶é€»è¾‘éƒ½ä¼šå†™åˆ°å¯¹åº”çš„actionç±»é‡Œï¼Œtextç”¨æ¥æ§åˆ¶æ–‡æ¡ˆï¼Œdescriptionä¸ºæè¿°--&gt; &lt;action id=\"Plugin.Test.Action\" class=\"plugin.test.FromAction\" text=\"è¡¨å•æµ‹è¯•\" description=\"è¡¨å•æµ‹è¯•æè¿°\"/&gt; &lt;/group&gt; &lt;/actions&gt;&lt;/idea-plugin&gt; ç„¶åå®šä¹‰ä¸€ä¸ªActionç±»ï¼Œè®°ä¸ºFormActionï¼Œç»§æ‰¿AnActionï¼Œå®ç°å…¶æŠ½è±¡æ–¹æ³•actionPerformedå³å¯ï¼š ä»£ç å—3123456public class FromAction extends AnAction { @Override public void actionPerformed(@NotNull AnActionEvent e) { //TODO è¿™é‡Œæ”¾æ’ä»¶é€»è¾‘ }} ä¸‰ã€å¯åŠ¨ç°åœ¨åŒå‡»runIdeå³å¯è°ƒå‡ºå¦å¤–ä¸€ä¸ªå®‰è£…äº†è¿™ä¸ªæ’ä»¶çš„IDEAç•Œé¢ï¼Œç„¶åå¯ä»¥çœ‹è¿è¡Œç»“æœè¿›è¡Œè°ƒè¯•ã€‚ runIdeè¿˜æ”¯æŒdebugæ¨¡å¼ï¼Œä¸è¿‡è¿è¡Œæ—¶è¦å³å‡»é€‰æ‹©ï¼š æ¥çœ‹ä¸‹è°ƒè¯•IDEAçš„ç•Œé¢è¿è¡Œæ•ˆæœï¼š å››ã€å®šä¹‰Action4.1ï¼šå®šä¹‰ä¼šè¯æ¡†ç±»ç»è¿‡ä¸Šé¢ä¸‰æ­¥çš„é…ç½®ï¼Œæ’ä»¶çš„åŸºæœ¬æ ·å¼å·²ç»å±•ç¤ºå‡ºæ¥ï¼Œä½†æ˜¯ç‚¹å‡»ä¸‹æ–¹â€œè¡¨å•æµ‹è¯•â€çš„actionï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œå› ä¸ºå…¶ç»‘å®šçš„FormActionç±»é‡Œæ²¡æœ‰ä»»ä½•æœ‰æ„ä¹‰çš„å®ç°ã€‚ç°åœ¨æ¥å®ç°å¼€å§‹çš„ç›®æ ‡ï¼Œç‚¹å‡»â€œè¡¨å•æµ‹è¯•â€åï¼Œå¼¹å‡ºä¸€ä¸ªè‡ªå®šä¹‰çš„è¡¨å•ä¼šè¯æ¡†ï¼Œç„¶åç‚¹å‡»æŒ‰é’®ï¼Œè·å–è¡¨å•å†…å®¹åæ‰“å°åœ¨ä¼šè¯æ¡†å†…ã€‚ ä¼šè¯æ¡†ï¼ˆDialogï¼‰éœ€è¦å®šä¹‰ä¸€ä¸ªç»§æ‰¿äº†IDEAçš„DialogWrapperæŠ½è±¡ç±»çš„å­ç±»ï¼Œè¿™ä¸ªå­ç±»å°±æ˜¯è‡ªå®šä¹‰çš„ä¼šè¯æ¡†å®ç°ï¼Œæ‰€æœ‰çš„æ ·å¼å®šä¹‰ã€åŠŸèƒ½è§¦å‘éƒ½æ˜¯æ”¾åˆ°è¿™ä¸ªå­ç±»é‡Œçš„ï¼Œç°å®šäºå¦‚ä¸‹å­ç±»ï¼š ä»£ç å—412345678910111213141516171819202122232425262728293031public class FormTestDialog extends DialogWrapper { private String projectName; //å‡å¦‚éœ€è¦è·å–åˆ°é¡¹ç›®åï¼Œä½œä¸ºè¯¥ç±»çš„å±æ€§æ”¾è¿›æ¥ // DialogWrapperæ²¡æœ‰é»˜è®¤çš„æ— å‚æ„é€ æ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦é‡å†™æ„é€ æ–¹æ³•ï¼Œå®ƒæä¾›äº†å¾ˆå¤šé‡è½½æ„é€ æ–¹æ³•ï¼Œ // è¿™é‡Œä½¿ç”¨ä¼ projectç±»å‹å‚æ•°çš„é‚£ä¸ªï¼Œé€šè¿‡Projectå¯¹è±¡å¯ä»¥è·å–å½“å‰IDEAå†…æ‰“å¼€çš„é¡¹ç›®çš„ä¸€äº›å±æ€§ï¼Œ // æ¯”å¦‚é¡¹ç›®åï¼Œé¡¹ç›®è·¯å¾„ç­‰ public FormTestDialog(@Nullable Project project) { super(project); setTitle(\"è¡¨å•æµ‹è¯•~~\"); // è®¾ç½®ä¼šè¯æ¡†æ ‡é¢˜ this.projectName = project.getName(); } // é‡å†™ä¸‹é¢çš„æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªè‡ªå®šä¹‰çš„swingæ ·å¼ï¼Œè¯¥æ ·å¼ä¼šå±•ç¤ºåœ¨ä¼šè¯æ¡†çš„æœ€ä¸Šæ–¹çš„ä½ç½® @Override protected JComponent createNorthPanel() { return null; } // é‡å†™ä¸‹é¢çš„æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªè‡ªå®šä¹‰çš„swingæ ·å¼ï¼Œè¯¥æ ·å¼ä¼šå±•ç¤ºåœ¨ä¼šè¯æ¡†çš„æœ€ä¸‹æ–¹çš„ä½ç½® @Override protected JComponent createSouthPanel() { return null; } // é‡å†™ä¸‹é¢çš„æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªè‡ªå®šä¹‰çš„swingæ ·å¼ï¼Œè¯¥æ ·å¼ä¼šå±•ç¤ºåœ¨ä¼šè¯æ¡†çš„ä¸­å¤®ä½ç½® @Override protected JComponent createCenterPanel() { return null; }} 4.2ï¼šä¼šè¯æ¡†æ¨¡å—&amp;ç±»å…ƒç´ å¯¹ç…§æ‰¾ä¸ªå®é™…çš„ä¼šè¯æ¡†ä¸ºä¾‹ï¼Œé’ˆå¯¹ä¸Šè¿°ä¸­å‡ ä¸ªæ–¹æ³•æ‰€æ§åˆ¶çš„ä¼šè¯æ¡†é‡Œçš„å…ƒç´ å¦‚ä¸‹ï¼š 4.3ï¼šè‡ªå®šä¹‰ä¼šè¯æ¡†å…ƒç´ 4.3.1ï¼šä¼šè¯æ¡†æ–¹æ³•é‡å®šä¹‰æŒ‰ç…§æœ¬æ–‡çš„å®ç°ç›®æ ‡ï¼Œè‡ªå®šä¹‰çš„è¡¨å•ä¸»ä½“éƒ¨åˆ†å¯ä»¥ä½äºcreateCenterPanelé‡Œï¼Œç„¶åè¡¨å•çš„å¤§æ ‡é¢˜å¯ä»¥æ”¾åˆ°createNorthPanelé‡Œï¼Œæäº¤æŒ‰é’®å¯ä»¥æ”¾åˆ°createSouthPanelé‡Œï¼Œç°åœ¨æ”¹å†™å¦‚ä¸‹ï¼š ä»£ç å—512345678910111213141516171819202122232425262728293031public class FormTestDialog extends DialogWrapper { private String projectName; //swingæ ·å¼ç±»ï¼Œå®šä¹‰åœ¨4.3.2 private FormTestSwing formTestSwing = new FormTestSwing(); public FormTestDialog(@Nullable Project project) { super(true); setTitle(\"è¡¨å•æµ‹è¯•~~\"); //è®¾ç½®ä¼šè¯æ¡†æ ‡é¢˜ this.projectName = project.getName(); //è·å–åˆ°å½“å‰é¡¹ç›®çš„åç§° init(); //è§¦å‘ä¸€ä¸‹initæ–¹æ³•ï¼Œå¦åˆ™swingæ ·å¼å°†æ— æ³•å±•ç¤ºåœ¨ä¼šè¯æ¡† } @Override protected JComponent createNorthPanel() { return formTestSwing.initNorth(); //è¿”å›ä½äºä¼šè¯æ¡†northä½ç½®çš„swingæ ·å¼ } // ç‰¹åˆ«è¯´æ˜ï¼šä¸éœ€è¦å±•ç¤ºSouthPanelè¦é‡å†™è¿”å›nullï¼Œå¦åˆ™IDEAå°†å±•ç¤ºé»˜è®¤çš„\"Cancel\"å’Œ\"OK\"æŒ‰é’® @Override protected JComponent createSouthPanel() { return formTestSwing.initSouth(); } @Override protected JComponent createCenterPanel() { //å®šä¹‰è¡¨å•çš„ä¸»é¢˜ï¼Œæ”¾ç½®åˆ°IDEAä¼šè¯æ¡†çš„ä¸­å¤®ä½ç½® return formTestSwing.initCenter(); }} 4.3.2ï¼šè‡ªå®šä¹‰swingæ ·å¼ä¸‹é¢æ˜¯æ”¾ç½®swingæ ·å¼çš„ç±»ï¼š ä»£ç å—612345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667public class FormTestSwing { private JPanel north = new JPanel(); private JPanel center = new JPanel(); private JPanel south = new JPanel(); //ä¸ºäº†è®©ä½äºåº•éƒ¨çš„æŒ‰é’®å¯ä»¥æ‹¿åˆ°ç»„ä»¶å†…å®¹ï¼Œè¿™é‡ŒæŠŠè¡¨å•ç»„ä»¶åšæˆç±»å±æ€§ private JLabel r1 = new JLabel(\"è¾“å‡ºï¼š\"); private JLabel r2 = new JLabel(\"NULL\"); private JLabel name = new JLabel(\"å§“åï¼š\"); private JTextField nameContent = new JTextField(); private JLabel age = new JLabel(\"å¹´é¾„ï¼š\"); private JTextField ageContent = new JTextField(); public JPanel initNorth() { //å®šä¹‰è¡¨å•çš„æ ‡é¢˜éƒ¨åˆ†ï¼Œæ”¾ç½®åˆ°IDEAä¼šè¯æ¡†çš„é¡¶éƒ¨ä½ç½® JLabel title = new JLabel(\"è¡¨å•æ ‡é¢˜\"); title.setFont(new Font(\"å¾®è½¯é›…é»‘\", Font.PLAIN, 26)); //å­—ä½“æ ·å¼ title.setHorizontalAlignment(SwingConstants.CENTER); //æ°´å¹³å±…ä¸­ title.setVerticalAlignment(SwingConstants.CENTER); //å‚ç›´å±…ä¸­ north.add(title); return north; } public JPanel initCenter() { //å®šä¹‰è¡¨å•çš„ä¸»ä½“éƒ¨åˆ†ï¼Œæ”¾ç½®åˆ°IDEAä¼šè¯æ¡†çš„ä¸­å¤®ä½ç½® //ä¸€ä¸ªç®€å•çš„3è¡Œ2åˆ—çš„è¡¨æ ¼å¸ƒå±€ center.setLayout(new GridLayout(3, 2)); //row1ï¼šæŒ‰é’®äº‹ä»¶è§¦å‘åå°†ç»“æœæ‰“å°åœ¨è¿™é‡Œ r1.setForeground(new Color(255, 47, 93)); //è®¾ç½®å­—ä½“é¢œè‰² center.add(r1); r2.setForeground(new Color(139, 181, 20)); //è®¾ç½®å­—ä½“é¢œè‰² center.add(r2); //row2ï¼šå§“å+æ–‡æœ¬æ¡† center.add(name); center.add(nameContent); //row3ï¼šå¹´é¾„+æ–‡æœ¬æ¡† center.add(age); center.add(ageContent); return center; } public JPanel initSouth() { //å®šä¹‰è¡¨å•çš„æäº¤æŒ‰é’®ï¼Œæ”¾ç½®åˆ°IDEAä¼šè¯æ¡†çš„åº•éƒ¨ä½ç½® JButton submit = new JButton(\"æäº¤\"); submit.setHorizontalAlignment(SwingConstants.CENTER); //æ°´å¹³å±…ä¸­ submit.setVerticalAlignment(SwingConstants.CENTER); //å‚ç›´å±…ä¸­ south.add(submit); return south; }} ç°åœ¨ç‚¹å‡»ä¸‹runIdeæŒ‰é’®ï¼ŒåŒæ ·çš„ï¼Œåœ¨è°ƒè¯•IDEé‡Œç‚¹å‡»â€œè¡¨å•æµ‹è¯•â€ï¼Œç„¶åå°±ä¼šå¼¹å‡ºå¦‚ä¸‹è¡¨å•æ¡†ï¼š ğŸŒ¿ é™¤éæœ‰ç‰¹æ®Šæƒ…å†µéœ€è¦è‡ªå®šä¹‰swingæ ·å¼ï¼Œå¦åˆ™å»ºè®®ä¸åŠ ä»»ä½•swingæ ·å¼ï¼Œè¿™æ ·è‡ªå®šä¹‰çš„swingç•Œé¢æ˜¯ä¼šéšç€IDEAçš„ä¸»é¢˜æ”¹å˜è€Œå»è‡ªé€‚åº”çš„ï¼Œæ¯”å¦‚å°†å›¾7ä¸­çš„è°ƒè¯•IDEçš„ä¸»é¢˜è®¾ç½®æˆDarculaï¼Œè‡ªå®šä¹‰çš„è¡¨å•ä¹Ÿä¼šè‡ªé€‚åº”çš„å˜æˆé»‘è‰²èƒŒæ™¯ï¼š 4.3.3ï¼šäº‹ä»¶ç»‘å®šå®šä¹‰å¥½äº†æ ·å¼ï¼Œç°åœ¨ç»™â€œæäº¤â€æŒ‰é’®ç»‘å®šä¸€ä¸ªäº‹ä»¶ï¼Œç°åœ¨æ”¹å†™ä¸‹FormTestSwing.initSouthæ–¹æ³•ï¼š ä»£ç å—71234567891011121314151617181920public JPanel initSouth() { //å®šä¹‰è¡¨å•çš„æäº¤æŒ‰é’®ï¼Œæ”¾ç½®åˆ°IDEAä¼šè¯æ¡†çš„åº•éƒ¨ä½ç½® JButton submit = new JButton(\"æäº¤\"); submit.setHorizontalAlignment(SwingConstants.CENTER); //æ°´å¹³å±…ä¸­ submit.setVerticalAlignment(SwingConstants.CENTER); //å‚ç›´å±…ä¸­ south.add(submit); //æŒ‰é’®äº‹ä»¶ç»‘å®š submit.addActionListener(e -&gt; { //è·å–åˆ°nameå’Œage String name = nameContent.getText(); String age = ageContent.getText(); //åˆ·æ–°r2æ ‡ç­¾é‡Œçš„å†…å®¹ï¼Œæ›¿æ¢ä¸ºnameå’Œage r2.setText(String.format(\"name:%s, age:%s\", name, age)); }); return south;} ç°åœ¨å†æ¥ç‚¹å‡»ä¸‹â€œæäº¤â€æŒ‰é’®ï¼Œå°±å¯ä»¥è¾“å‡ºè¡¨å•å†…å®¹äº†ï¼š 4.4ï¼šæ’ä»¶ç»‘å®šç±»ï¼šFormActionä¹‹å‰è®²è¿‡ï¼Œè¿™ä¸ªç±»æ˜¯æ’ä»¶çš„å…¥å£ï¼Œç»“åˆä¸Šé¢å®šä¹‰å¥½çš„è¡¨å•Dialogï¼Œæ¥çœ‹ä¸‹å®ƒæ˜¯æ€ä¹ˆå†™çš„ï¼š ä»£ç å—812345678public class FromAction extends AnAction { @Override public void actionPerformed(@NotNull AnActionEvent e) { FormTestDialog formTestDialog = new FormTestDialog(e.getProject()); formTestDialog.setResizable(true); //æ˜¯å¦å…è®¸ç”¨æˆ·é€šè¿‡æ‹–æ‹½çš„æ–¹å¼æ‰©å¤§æˆ–ç¼©å°ä½ çš„è¡¨å•æ¡†ï¼Œæˆ‘è¿™é‡Œå®šä¹‰ä¸ºtrueï¼Œè¡¨ç¤ºå…è®¸ formTestDialog.show(); }} äº”ã€æ’ä»¶çš„æ‰“åŒ…&amp;å®‰è£…æˆªæ­¢åˆ°ç¬¬å››æ­¥ï¼Œéƒ½åªæ˜¯åœ¨è°ƒè¯•IDEé‡ŒæŸ¥çœ‹æ•ˆæœï¼Œå¦‚æœä¸€ä¸ªæ’ä»¶å¼€å‘å®Œæˆåï¼Œéœ€è¦è¢«å®é™…çš„IDEAå®‰è£…ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å€ŸåŠ©æ‰“åŒ…é€‰é¡¹æ¥æ‰“åŒ…ä½ çš„æ’ä»¶ï¼Œç‚¹å‡»ä¸‹é¢çš„é€‰é¡¹æ„å»ºæ’ä»¶ï¼š æ„å»ºå®Œæˆåï¼ŒæŸ¥çœ‹buildåŒ…ä¸‹çš„distributionsç›®å½•ï¼Œé‡Œé¢çš„zipåŒ…å°±å¯ä»¥ç›´æ¥å®‰è£…è¿›ä½ çš„IDEAï¼š ç„¶åé€‰æ‹©IDEAçš„Preferencesä¸‹çš„pluginsé€‰é¡¹ï¼Œå¼¹å‡ºå¦‚ä¸‹æ¡†ï¼ŒæŒ‰ç…§å›¾é‡Œçš„æŒ‡ç¤ºé€‰æ‹©zipåŒ…å®‰è£…å³å¯ï¼š ç„¶åå®‰è£…å®Œæˆï¼Œé‡å¯IDEAå³å¯ï¼š å„ä¸ªå±•ç¤ºæ¨¡å—å¯¹åº”æ’ä»¶é¡¹ç›®é‡Œé…ç½®çš„æ¥æºå‚è€ƒä¸‹å›¾ï¼š é‡å¯åå‡ºç°äº†è·Ÿè°ƒè¯•IDEAé‡Œä¸€æ ·çš„èœå•æ ï¼Œé€‰ä¸­åè¿è¡ŒæˆåŠŸï¼š å†™åœ¨æœ€åæˆªæ­¢åˆ°è¿™é‡Œï¼Œä¸€ä¸ªæ’ä»¶çš„å¼€å‘ã€è°ƒè¯•ã€å®‰è£…å°±å®Œæˆäº†ï¼Œç†è®ºä¸Šé€šè¿‡è¿™ä¸ªç®€å•çš„ä¾‹å­å°±å¯ä»¥å®ç°ä¸€äº›å®é™…çš„åŠŸèƒ½äº†ï¼Œå› ä¸ºå…¶å®Œæ•´å±•ç¤ºäº†æ•°æ®è¾“å…¥åˆ°æ•°æ®è·å–æ•´ä¸ªè¿‡ç¨‹ã€‚ å› ä¸ºå·¥ä½œå½“ä¸­éœ€è¦å†™ä¸€ä¸ªä»£ç ç”Ÿæˆå™¨ï¼Œæƒ³è¦ä»¥ä¸€ä¸ªIDEAæ’ä»¶çš„æ–¹å¼æä¾›æœåŠ¡ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œåšä¸ªè®°å½•ï¼Œé˜²æ­¢ä»¥åå†æ¬¡ç”¨åˆ°æ—¶ä»é›¶å¼€å§‹ã€‚ã€‚ è¦æœ‰ä¸€å®šçš„swingåŸºç¡€ï¼Œæˆ‘åœ¨å¼€å‘ä»£ç ç”Ÿæˆå™¨çš„æ—¶å€™ï¼Œå°±æ˜¯å› ä¸ºswingåŸºç¡€å¤ªå·®ï¼Œå¸ƒå±€èŠ±äº†éå¸¸å¤šçš„æ—¶é—´ã€‚ ğŸ’ ä¹‹åä¸ä¼šæ·±å…¥å»ç ”ç©¶æ’ä»¶çš„å¼€å‘ï¼Œå¦‚æœåç»­å·¥ä½œä¸­æœ‰ç”¨åˆ°æ’ä»¶å¼€å‘çš„å…¶ä»–çš„åŠŸèƒ½ç‚¹ï¼Œä¼šæ›´æ–°åœ¨è¿™ä¸ªç³»åˆ—é‡Œï¼Œå¦‚æœæƒ³æ·±å…¥æIDEAæ’ä»¶å¼€å‘ï¼Œå»ºè®®çœ‹IDEAçš„å®˜æ–¹æ–‡æ¡£ï¼Œå®˜æ–¹æ–‡æ¡£æœ‰ç‚¹ä¹±ï¼Œæœ‰å¾ˆå¤šåªæ˜¯ç®€å•ä»‹ç»å‡ å¥ç”šè‡³æ²¡æœ‰ç¤ºä¾‹ï¼Œå¥½åœ¨ä»–ä»¬æœ‰ä¸ªé—®ç­”ç¤¾åŒºï¼Œå»ºè®®æœç´¢æ—¶ç”¨googleæœè‹±æ–‡å…³é”®è¯ï¼ˆgoogleå¯¹è‹±æ–‡æœç´¢æ”¯æŒå¼ºå¤§ï¼Œæ²¡è¯•è¿‡åº¦å¨˜ï¼Œåº”è¯¥ä¹Ÿå¯ä»¥æœåˆ°ï¼‰ï¼Œé‡Œé¢ä¼šæœ‰äººæé—®ï¼Œæ¯”å¦‚ç‰ˆæœ¬å…¼å®¹çš„é—®é¢˜å°±æ˜¯googleå‡ºæ¥çš„ï¼Œç¤¾åŒºé‡Œæ­£å¥½æœ‰ä¸€ç¯‡é—®ç­”ã€‚ï¼ˆé“¾æ¥æ”¾åˆ°å¼€å¤´é‡Œäº†ï¼‰","link":"/2019/12/13/IDEA%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%80%EF%BC%89%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E8%A1%A8%E5%8D%95demo/"},{"title":"Resilience4jç†”æ–­å™¨-ä½¿ç”¨ä¸æºç è§£æ","text":"ğŸŒ ç¯å¢ƒï¼š&nbsp;&nbsp; ğŸŒ¾ ä¾èµ–ç‰ˆæœ¬ï¼š ğŸƒ çŸ¥è¯†ä¾èµ–ï¼šJUCï¼Œä½å›¾ ä¸€ã€ä»€ä¹ˆæ˜¯ç†”æ–­åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå„æœåŠ¡é—´çš„ç›¸äº’è°ƒç”¨æ›´åŠ é¢‘ç¹ï¼Œä¸Šä¸‹æ¸¸è°ƒç”¨ä¸­å……æ»¡äº†å¯èƒ½æ€§ï¼Œä¸€ä¸ªæœåŠ¡å¯èƒ½ä¼šè¢«å¾ˆå¤šå…¶ä»–æœåŠ¡ä¾èµ–å¹¶è°ƒç”¨ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¦‚æœæŸä¸ªæœåŠ¡ç”±äºæŸç§åŸå› å‡ºé”™ï¼ˆä¸šåŠ¡å‡ºé”™ã€è´Ÿè½½è¿‡é«˜ï¼‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªåˆ†å¸ƒå¼è°ƒç”¨é“¾è·¯å¤±è´¥ï¼š ä¸Šé¢è¿™ä¸ªè¿‡ç¨‹æœ€ç»ˆå¯èƒ½ä¼šå¯¼è‡´å…¨é“¾è·¯ç˜«ç—ªï¼ˆæœåŠ¡é›ªå´©ï¼‰ï¼Œæ­¤æ—¶éœ€è¦ä¸€ç§å¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜çš„ç­–ç•¥ï¼Œæ­¤ç­–ç•¥è®¾è®¡ç›®æ ‡ä¸ºï¼š åœ¨å‘ç°æœ‰æœåŠ¡è°ƒç”¨å¤±è´¥åï¼ŒåŠæ—¶è®¡ç®—å¤±è´¥ç‡ å¤±è´¥ç‡è¾¾åˆ°æŸç§é˜ˆå€¼æ—¶ï¼Œåˆ‡æ–­ä¸è¯¥æœåŠ¡çš„æ‰€æœ‰äº¤äº’ï¼ŒæœåŠ¡èµ°åˆ‡æ–­åçš„è‡ªå®šä¹‰é€»è¾‘ åˆ‡æ–­å¹¶ä¸”ä¸å†è°ƒç”¨è¯¥æœåŠ¡åä¸»åŠ¨ç›‘å¬è¢«åˆ‡æ–­çš„æœåŠ¡æ˜¯å¦å·²ç»æ¢å¤äº†å¤„ç†èƒ½åŠ›ï¼Œè‹¥æ¢å¤ï¼Œåˆ™ç»§ç»­è®©å…¶æä¾›æœåŠ¡ è¿™ä¸ªç­–ç•¥è¢«æ”¾è¿›å›¾1ä¸­ï¼Œå°±å˜æˆäº†ä¸‹é¢è¿™æ ·ï¼š è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒCæœåŠ¡åœ¨è‡ªå·±å‡ºé—®é¢˜çš„æƒ…å†µä¸‹ï¼Œå¹¶ä¸ä¼šåƒå›¾1é‡Œé‚£æ ·ä»ç„¶æœ‰å¤§é‡æµé‡æ‰“è¿›æ¥ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°ä¸Šæ¸¸æœåŠ¡ï¼Œè¿™ä¸ªç»“æœè®©è°ƒç”¨é“¾çœ‹èµ·æ¥æ¯”å›¾1æ›´åŠ çš„ç¨³å®šï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«ç†”æ–­ã€‚ é’ˆå¯¹è¿™ä¸ªè¿‡ç¨‹ï¼Œå¯ä»¥çœ‹åˆ°åœ¨Cä¸å¯ç”¨æ—¶ï¼ŒBèµ°äº†ç†”æ–­åçš„é™çº§é€»è¾‘ï¼Œè¿™ä¸ªé€»è¾‘å¯ä»¥è‡ªå®šä¹‰ï¼Œå¦‚æœCåœ¨æ•´ä¸ªè°ƒç”¨é“¾é‡Œå±äºé‚£ç§å¿…é¡»è¦æˆåŠŸçš„æœåŠ¡ï¼Œé‚£ä¹ˆè¿™é‡Œçš„é€»è¾‘å°±å¯ä»¥æ˜¯ç›´æ¥æŠ›é”™ï¼Œå¦‚æœCå±äºé‚£ç§å¤±è´¥äº†ä¹Ÿæ— æ‰€è°“ï¼Œä¸å½±å“æ•´ä¸ªä¸šåŠ¡å¤„ç†ï¼Œé‚£ä¹ˆé™çº§é€»è¾‘é‡Œå°±å¯ä»¥ä¸åšå¤„ç†ï¼Œä¾‹å¦‚ä¸‹é¢çš„åœºæ™¯ï¼š ç±»ä¼¼è¿™ç§æ¥å£ï¼Œé™çº§ç­–ç•¥å¾ˆé€‚åˆä¸åšå¤„ç†ï¼Œè¿”å›ç©ºä¿¡æ¯å³å¯ï¼Œè¿™æ ·æœ€åçš„æƒ…å†µå°±æ˜¯é¡µé¢å°‘äº†æŸä¸ªæ¿å—çš„ä¿¡æ¯ï¼Œå¯èƒ½ä¼šå¯¹ç”¨æˆ·é€ æˆä¸å¤ªå¥½çš„ä½“éªŒï¼Œä½†æ˜¯ä¸å½±å“å…¶å¯¹å¤–æœåŠ¡ï¼Œè¢«ç†”æ–­çš„æœåŠ¡æ¢å¤åé¡µé¢ä¹Ÿä¼šé‡æ–°å›å½’æ­£å¸¸ã€‚ç†”æ–­åçš„é™çº§å¤„ç†æ–¹å¼æ˜¯ä»¶å€¼å¾—æ€è€ƒçš„äº‹æƒ…ï¼Œç†”æ–­å’Œé™çº§æ˜¯ç›¸äº’ç‹¬ç«‹çš„æ¦‚å¿µï¼Œç†”æ–­åå¿…ç„¶ä¼šæœ‰é™çº§æ“ä½œï¼ˆå“ªæ€•ç›´æ¥æŠ›å¼‚å¸¸ä¹Ÿæ˜¯ä¸€ç§é™çº§ç­–ç•¥ï¼‰ï¼Œè¿™ä¸ªé™çº§æ“ä½œæ˜¯ç†”æ–­è¿™ä¸ªåŠ¨ä½œå¯¼è‡´çš„ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™ä¼šæŠŠç†”æ–­å’Œé™çº§æ”¾åœ¨ä¸€èµ·è¯´ï¼Œå…¶å®é™çº§è¿˜å¯ä»¥ç”±å…¶ä»–åŠ¨ä½œè§¦å‘ï¼Œæ¯”å¦‚é™æµåæŠ›å‡ºâ€œç³»ç»Ÿç¹å¿™â€ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§é™çº§ç­–ç•¥ï¼Œåªä¸è¿‡å®ƒæ˜¯ç”±é™æµè§¦å‘çš„ï¼Œå†æ¯”å¦‚é€šè¿‡å¼€å…³åŸ‹ç‚¹åœ¨ç³»ç»Ÿè´Ÿè½½è¿‡é«˜æ—¶ä¸»åŠ¨å…³åœä¸€äº›æ¬¡è¦æœåŠ¡æ¥æå‡æ ¸å¿ƒåŠŸèƒ½çš„å“åº”é€Ÿåº¦ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§é™çº§ç­–ç•¥ï¼Œé™çº§æ˜¯æœ€ç»ˆäº§ç‰©ï¼Œè€Œäº§ç”Ÿå®ƒçš„æ–¹å¼æœ‰å¾ˆå¤šç§ã€‚ äºŒã€Resilience4jä¸­çš„ç†”æ–­å™¨2.1ï¼šResilience4jæ˜¯ä»€ä¹ˆï¼Ÿå®ƒæ˜¯ä¸€ä¸ªè½»é‡ã€æ˜“ç”¨ã€å¯ç»„è£…çš„é«˜å¯ç”¨æ¡†æ¶ï¼Œæ”¯æŒç†”æ–­ã€é«˜é¢‘æ§åˆ¶ã€éš”ç¦»ã€é™æµã€é™æ—¶ã€é‡è¯•ç­‰å¤šç§é«˜å¯ç”¨æœºåˆ¶ã€‚æœ¬ç¯‡æ–‡ç« åªå…³æ³¨å…¶ç†”æ–­éƒ¨åˆ†ã€‚ 2.2ï¼šå¦‚ä½•ä½¿ç”¨ï¼Ÿé€šè¿‡ç¬¬ä¸€éƒ¨åˆ†çš„ä»‹ç»ï¼Œå¯ä»¥è®¤ä¸ºä¸€ä¸ªç†”æ–­å™¨å¿…é¡»è¦å…·å¤‡ç»Ÿè®¡å•ä½è¯·æ±‚å†…çš„é”™è¯¯ç‡ã€å…¨ç†”æ–­ã€åŠç†”æ–­æ”¾é‡ã€æ¢å¤è¿™å‡ ä¸ªæµç¨‹ï¼Œå¸¦ç€è¿™ä¸ªæµç¨‹ï¼Œä¸‹é¢æ¥ä»‹ç»ä¸‹Resilience4jé‡Œç†”æ–­å™¨çš„ç”¨æ³•ã€‚ é€šè¿‡å›¾2é‡ŒæœåŠ¡Bè°ƒç”¨æœåŠ¡Cçš„ä¾‹å­ï¼Œç°åœ¨åˆ©ç”¨javaç±»æ¥è¿›è¡Œç®€å•æ¨¡æ‹Ÿä¸‹è¿™ä¸ªæµç¨‹ã€‚ é¦–å…ˆå®šä¹‰ServerCç±»ï¼Œç”¨äºæ¨¡æ‹ŸæœåŠ¡Cï¼š ä»£ç å—1123456789public class ServerC { //ä½¿ç”¨è¯¥æ–¹æ³•æ¨¡æ‹ŸæœåŠ¡Cè·å–Cä¿¡æ¯çš„æ–¹æ³•ï¼Œå‡è®¾ç°åœ¨æœåŠ¡Cçš„getCInfoæ–¹æ³•é‡Œæœ‰ä¸ªbugï¼Œå½“è¾“å…¥çš„idä¸º0æ—¶æŠ¥é”™ï¼Œå…¶ä»–æƒ…å†µæ­£å¸¸ public String getCInfo(int id) { if (id == 0) { throw new RuntimeException(\"è¾“å…¥0å¼‚å¸¸\"); } return \"id=\" + id + \"çš„Cä¿¡æ¯\"; }} å†å®šä¹‰ServerBç±»ï¼Œç”¨äºæ¨¡æ‹ŸæœåŠ¡Bï¼Œè¿™é‡Œç»™æœåŠ¡Bè°ƒç”¨æœåŠ¡Cæ–¹æ³•é‚£é‡ŒåŠ ä¸Šç†”æ–­å™¨å¤„ç†ï¼Œæ³¨æ„è¿™ä¸ªç±»é‡Œçš„æ³¨é‡Šï¼Œä¼šè¯¦ç»†è¯´æ˜ç†”æ–­å™¨çš„ä¸»è¦é…ç½®é¡¹ä»¥åŠå…¶ä½¿ç”¨æ–¹æ³•ï¼š ä»£ç å—2123456789101112131415161718192021222324252627282930313233343536public class ServerB { private CircuitBreakerRegistry breakerRegistry; private ServerC serverC = new ServerC(); //è®©æœåŠ¡BæŒæœ‰ä¸€ä¸ªæœåŠ¡Cçš„å¼•ç”¨ï¼Œç”¨æ¥è¡¨ç¤ºæ­£å¸¸æœåŠ¡é—´è°ƒç”¨é‡Œçš„ä¸€ä¸ªè¿æ¥å¼•ç”¨ ServerB() { //åˆå§‹åŒ–breakeræ³¨å†Œå™¨ï¼Œå¯ä»¥åˆ©ç”¨è¯¥å¯¹è±¡ç”Ÿäº§å„ç§breakerå¯¹è±¡ï¼ˆæ³¨ï¼šå‡¡æ˜¯ç”¨åŒä¸€ä¸ªæ³¨å†Œå™¨ç”Ÿäº§å‡ºæ¥çš„breakerï¼Œéƒ½ä¼šç»§æ‰¿æ³¨å†Œå™¨çš„é…ç½®å±æ€§ï¼‰ breakerRegistry = CircuitBreakerRegistry.of(CircuitBreakerConfig.custom() //ofæ–¹æ³•é‡Œé¢æ”¾çš„å°±æ˜¯breakerçš„é…ç½®å±æ€§å¯¹è±¡ .enableAutomaticTransitionFromOpenToHalfOpen() //å¼€å¯ä»å…¨å¼€çŠ¶æ€ç»è¿‡ä¸‹é¢çš„waitDurationInOpenStateæ—¶é—´åè‡ªåŠ¨åˆ‡æ¢åˆ°åŠå¼€çŠ¶æ€ .failureRateThreshold(50) //ç†”æ–­å™¨é—­åˆçŠ¶æ€ä¸‹çš„é”™è¯¯ç‡é˜ˆå€¼ï¼Œ50è¡¨ç¤º50%ï¼Œå¦‚æœé”™è¯¯ç‡è¾¾åˆ°è¿™ä¸ªé˜ˆå€¼ï¼Œé‚£ä¹ˆç†”æ–­å™¨å°†è¿›å…¥å…¨ç†”æ–­çŠ¶æ€ .ringBufferSizeInClosedState(100) //ç†”æ–­å™¨é—­åˆçŠ¶æ€ä¸‹ï¼Œä»¥è¯¥å€¼ä¸ºå•ä½è¯·æ±‚æ•°ï¼Œè®¡ç®—é”™è¯¯ç‡ï¼Œè·Ÿä¸Šé¢é”™è¯¯ç‡é˜ˆå€¼ç»¼åˆç†è§£ï¼Œè¿™ä¸ªå€¼è¡¨ç¤ºè‡³å°‘æœ‰100ä¸ªè¯·æ±‚ï¼Œä¸”é”™è¯¯50ä¸ªä»¥ä¸Šæ‰ä¼šè§¦å‘å…¨ç†”æ–­ .ringBufferSizeInHalfOpenState(10) //ç†”æ–­å™¨åŠç†”æ–­çŠ¶æ€ä¸‹ï¼Œä»¥è¯¥å€¼ä¸ºå•ä½è¯·æ±‚æ•°ï¼Œè®¡ç®—é”™è¯¯ç‡ï¼Œè·Ÿä¸Šé¢é”™è¯¯ç‡é˜ˆå€¼ç»¼åˆç†è§£ï¼Œè¿™ä¸ªå€¼è¡¨ç¤ºè‡³å°‘æœ‰10ä¸ªè¯·æ±‚ï¼Œä¸”é”™è¯¯5ä¸ªä»¥ä¸Šä¼šå†æ¬¡è§¦å‘å…¨ç†”æ–­ï¼Œç›¸æ¯”é—­åˆçŠ¶æ€ï¼ŒåŠç†”æ–­çŠ¶æ€ä¸‹æ›´å®¹æ˜“å†æ¬¡è¿›å…¥å…¨ç†”æ–­çŠ¶æ€ .waitDurationInOpenState(Duration.ofMillis(1000L)) //ç†”æ–­å™¨å…¨ç†”æ–­çŠ¶æ€æŒç»­çš„æ—¶é—´ï¼Œå…¨ç†”æ–­åç»è¿‡è¯¥æ—¶é—´åè¿›å…¥åŠç†”æ–­çŠ¶æ€ .build()); } //æœåŠ¡Bé€šè¿‡æœåŠ¡Cæ¥è·å–åˆ°Cçš„infoä¿¡æ¯ï¼Œè¯¥æ–¹æ³•å°±æ˜¯ç”¨æ¥å¹²è¿™ä¸ªçš„ï¼Œå®ƒä¼šå‘èµ·å¯¹æœåŠ¡Cçš„è°ƒç”¨ public String getCInfo(int id) { //breakerå¯¹è±¡æ˜¯æŒ‰ç…§nameåˆ’åˆ†å…¨å±€å•ä¾‹çš„ CircuitBreaker breaker = breakerRegistry.circuitBreaker(\"getCInfo\"); //è¿™é‡Œç»™ç†”æ–­å™¨å–ä¸ªåï¼Œä¸€èˆ¬æƒ…å†µå°±æ˜¯ä¸€ä¸ªæœåŠ¡çš„pathæˆ–æ–¹æ³•å try { return breaker.executeCallable(() -&gt; serverC.getCInfo(id)); } catch (CircuitBreakerOpenException e) { //ä¸€æ—¦æŠ›å‡ºè¯¥å¼‚å¸¸è¯´æ˜å·²ç»è¿›å…¥å…¨ç†”æ–­çŠ¶æ€ //è¢«ç†”æ–­åçš„é™çº§é€»è¾‘ return \"æœåŠ¡Cå‡ºé”™ï¼Œè§¦å‘æœåŠ¡Bçš„é™çº§é€»è¾‘\"; } catch (Exception e) { //ç†”æ–­å…³é—­æˆ–è€…åŠç†”æ–­çŠ¶æ€ä¸‹ï¼ŒCæŠ›å‡ºçš„é”™è¯¯ä¼šè¢«catchåˆ°è¿™é‡Œ return \"è°ƒç”¨æœåŠ¡Cå‡ºé”™\"; } } public CircuitBreaker getBreaker() { return breakerRegistry.circuitBreaker(\"getCInfo\"); //ä¸ºäº†æ–¹ä¾¿åšæµ‹è¯•ï¼Œè¿™é‡Œè¿”å›å¯¹åº”çš„breakerå¯¹è±¡ }} ä¸Šè¿°é…ç½®çš„ç†”æ–­å™¨è§£é‡Šå¦‚ä¸‹ï¼š åœ¨ç†”æ–­å™¨é—­åˆçš„æƒ…å†µä¸‹ï¼ˆä¹Ÿå³æ˜¯æ­£å¸¸æƒ…å†µä¸‹ï¼‰ï¼Œä»¥100ä¸ªè¯·æ±‚ä¸ºå•ä½çª—å£è®¡ç®—é”™è¯¯ç‡ï¼Œä¸€æ—¦é”™è¯¯ç‡è¾¾åˆ°50%ï¼Œç«‹åˆ»è¿›å…¥å…¨ç†”æ–­çŠ¶æ€ï¼Œè¯¥çŠ¶æ€ä¸‹æœåŠ¡Bä¸ä¼šå†å‘ç”Ÿå¯¹æœåŠ¡Cçš„è°ƒç”¨ï¼Œç›´æ¥èµ°è‡ªå·±çš„é™çº§é€»è¾‘ï¼Œç»è¿‡1000msåæ¢å¤ä¸ºåŠç†”æ–­çŠ¶æ€ï¼Œæ­¤æ—¶æµé‡å¼€å§‹æ‰“è¿›æœåŠ¡Cï¼Œæ­¤æ—¶ä»ç„¶ä¼šè®¡ç®—é”™è¯¯ç‡ï¼Œåªæ˜¯åŠç†”æ–­çŠ¶æ€ä¸‹ï¼Œæ˜¯ä»¥10ä¸ªè¯·æ±‚ä¸ºå•ä½çª—å£è®¡ç®—çš„é”™è¯¯ç‡ï¼Œè¿™ä¸ªå¯ä»¥ä¿è¯åœ¨æœåŠ¡Cæ²¡æœ‰æ¢å¤æ­£å¸¸çš„æƒ…å†µä¸‹å¯ä»¥æ›´å¿«é€Ÿçš„è¿›å…¥å…¨ç†”æ–­çŠ¶æ€ã€‚ 2.3ï¼šæµ‹è¯•-ç†”æ–­å™¨çŠ¶æ€åˆ‡æ¢ç„¶åå¼€å§‹ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼Œä¸‹é¢ä¼šé€šè¿‡æµ‹è¯•æ–¹æ³•æ¥è¯¦ç»†è§£æè¯¥ç†”æ–­å™¨çš„çŠ¶æ€å˜è¿ï¼š ä»£ç å—3123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657public void testBreak() throws Exception { //æŒ‰ç…§BæœåŠ¡é‡Œç†”æ–­å™¨çš„é…ç½®ï¼Œå¦‚æœè¿›è¡Œ100æ¬¡è¯·æ±‚ï¼Œæœ‰50æ¬¡å¤±è´¥äº†ï¼Œåˆ™å¯¹ServerCçš„è°ƒç”¨è¿›å…¥å…¨ç†”æ–­çŠ¶æ€ //1000msåæ¢å¤ä¸ºåŠç†”æ–­çŠ¶æ€ï¼ŒåŠç†”æ–­çŠ¶æ€ä¸‹è¿›è¡Œ10æ¬¡è¯·æ±‚ï¼Œå¦‚æœæœ‰5æ¬¡ä¾ç„¶å¤±è´¥ï¼Œåˆ™å†æ¬¡è¿›å…¥å…¨ç†”æ–­çŠ¶æ€ for (int i = 0; i &lt; 100; i++) { if (i &lt; 50) { serverB.getCInfo(0); //å‰50æ¬¡å…¨éƒ¨æŠ¥é”™ } else { serverB.getCInfo(1); //å50æ¬¡å…¨éƒ¨æˆåŠŸ } } //æ–­è¨€ï¼šæ­¤æ—¶ç†”æ–­å™¨ä¸ºå…¨ç†”æ–­çŠ¶æ€ System.out.println(serverB.getBreaker().getState().equals(CircuitBreaker.State.OPEN)); //å…¨ç†”æ–­çŠ¶æ€ä¸‹å¹¶ä¸ä¼šå®é™…è°ƒç”¨Cï¼Œè€Œæ˜¯ä¼šèµ°æœåŠ¡Bçš„é™çº§é€»è¾‘ï¼Œå³ä¾¿æˆ‘ä»¬è¾“å…¥çš„å‚æ•°æ˜¯å¯¹çš„ï¼Œä¹Ÿä¸€æ ·ä¼šè¢«é™çº§ System.out.println(serverB.getCInfo(1)); Thread.sleep(500L); //æ–­è¨€ï¼šç”±äºå…¨ç†”æ–­çŠ¶æ€é…ç½®çš„æŒç»­æ—¶é—´æ—¶1000msï¼Œæ‰€ä»¥500msè¿‡å»åï¼Œä»ç„¶æ˜¯å…¨ç†”æ–­çŠ¶æ€ System.out.println(serverB.getBreaker().getState().equals(CircuitBreaker.State.OPEN)); Thread.sleep(500L); //æ–­è¨€ï¼š1000msè¿‡åï¼Œç†”æ–­å™¨å¤„äºåŠç†”æ–­çŠ¶æ€ System.out.println(serverB.getBreaker().getState().equals(CircuitBreaker.State.HALF_OPEN)); //åŠç†”æ–­çŠ¶æ€ä¸‹ä¼šå°è¯•æ¢å¤ï¼Œæ‰€ä»¥ä¼šå®é™…è°ƒç”¨Cï¼Œåˆ†åˆ«è¾“å…¥æ­£ç¡®å’Œé”™è¯¯çš„å‚æ•°è¿›è¡Œæµ‹è¯• System.out.println(serverB.getCInfo(1)); System.out.println(serverB.getCInfo(0)); //åŠç†”æ–­çŠ¶æ€ä¸‹ï¼Œåªéœ€è¦è¯·æ±‚10æ¬¡ï¼Œæœ‰5æ¬¡å‡ºé”™å³å¯å†æ¬¡è¿›å…¥å…¨ç†”æ–­çŠ¶æ€ for (int i = 0; i &lt; 10; i++) { if (i &lt; 4) { //å› ä¸ºä¸Šé¢ä¼ è¿‡ä¸€æ¬¡0äº†ï¼Œæ‰€ä»¥è¿™é‡Œåªéœ€è¦4æ¬¡ä¾¿å¯ä»¥é‡æ–°å›åˆ°å…¨å¼€çŠ¶æ€ serverB.getCInfo(0); //å‰5æ¬¡å…¨éƒ¨æŠ¥é”™ } else { serverB.getCInfo(1); //å5æ¬¡å…¨éƒ¨æˆåŠŸ } } //æ–­è¨€ï¼šæ­¤æ—¶ç†”æ–­å™¨ä¸ºå…¨ç†”æ–­çŠ¶æ€ System.out.println(serverB.getBreaker().getState().equals(CircuitBreaker.State.OPEN)); //åŒæ ·çš„ï¼Œå…¨ç†”æ–­çŠ¶æ€ä¸‹å¹¶ä¸ä¼šå®é™…è°ƒç”¨Cï¼Œè€Œæ˜¯ä¼šèµ°æœåŠ¡Bçš„é™çº§é€»è¾‘ System.out.println(serverB.getCInfo(1)); //è¿™æ—¶é™å¾…1000msï¼Œå†æ¬¡è¿›å…¥åŠç†”æ–­çŠ¶æ€ï¼Œæˆ‘ä»¬å°è¯•æ¢å¤æœåŠ¡Cçš„è°ƒç”¨ Thread.sleep(1000L); //è¿™æ—¶æˆ‘ä»¬è®©å…¶10æ¬¡è¯·æ±‚é‡Œæœ‰6æ¬¡æˆåŠŸ for (int i = 0; i &lt; 10; i++) { if (i &lt; 6) { //å‰6æ¬¡æˆåŠŸ serverB.getCInfo(1); } else { //å4æ¬¡å¤±è´¥ serverB.getCInfo(0); } } //ç”±äº10æ¬¡è¯·æ±‚é‡Œåªå¤±è´¥äº†4æ¬¡ï¼Œè¾¾ä¸åˆ°50%çš„å…¨å¼€é˜ˆå€¼ï¼Œæ‰€ä»¥æ­¤æ—¶ä¼šæ¢å¤ //æ–­è¨€ï¼šæ­¤æ—¶ç†”æ–­å™¨ä¸ºé—­åˆçŠ¶æ€ System.out.println(serverB.getBreaker().getState().equals(CircuitBreaker.State.CLOSED)); System.out.println(serverB.getCInfo(1)); //æ­£å¸¸è¾“å‡º System.out.println(serverB.getCInfo(0)); //èµ°æ™®é€šå¼‚å¸¸é€»è¾‘ } æœ€ç»ˆè¾“å‡ºå¦‚ä¸‹ï¼š 1234567891011trueæœåŠ¡Cå‡ºé”™ï¼Œè§¦å‘æœåŠ¡Bçš„é™çº§é€»è¾‘truetrueid=1çš„Cä¿¡æ¯è°ƒç”¨æœåŠ¡Cå‡ºé”™trueæœåŠ¡Cå‡ºé”™ï¼Œè§¦å‘æœåŠ¡Bçš„é™çº§é€»è¾‘trueid=1çš„Cä¿¡æ¯è°ƒç”¨æœåŠ¡Cå‡ºé”™ å¯ä»¥çœ‹åˆ°ï¼Œå•ä½è¯·æ±‚å†…è¾¾åˆ°é”™è¯¯ç‡é˜ˆå€¼åç†”æ–­å™¨ä¼šè¿›å…¥å…¨å¼€çŠ¶æ€ï¼ˆå…¨ç†”æ–­ï¼‰ï¼Œå…¨å¼€çŠ¶æ€ä¸‹èµ°é™çº§é€»è¾‘ï¼Œæ­¤æ—¶ä¸å†ä¼šå®é™…è¯·æ±‚æœåŠ¡Cï¼Œä¸€æ®µæ—¶é—´åï¼ˆå…¨å¼€æŒç»­æ—¶é—´ï¼‰ï¼Œè¿›å…¥åŠå¼€çŠ¶æ€ï¼ˆåŠç†”æ–­ï¼‰ï¼ŒåŠå¼€æ—¶ä»ç„¶æ­£å¸¸æ‰“å…¥æœåŠ¡Cï¼Œåªæ˜¯ç”±äºå•ä½è¯·æ±‚é‡ç›¸æ¯”é—­åˆæ—¶æ›´å°ï¼Œè‹¥æœåŠ¡è¿˜æ²¡æ¢å¤ï¼Œè®¡ç®—é”™è¯¯ç‡ä¼šæ›´å¿«è¾¾åˆ°é”™è¯¯ç‡é˜ˆå€¼è€Œè¿…é€Ÿè¿›å…¥å…¨å¼€çŠ¶æ€ï¼Œä»¥æ­¤ç±»æ¨ã€‚å¦‚æœæœåŠ¡å·²ç»æ¢å¤ï¼Œé‚£ä¹ˆå°†ä¼šä»åŠå¼€çŠ¶æ€è¿›å…¥é—­åˆçŠ¶æ€ã€‚ 2.4ï¼šæµ‹è¯•-é”™è¯¯ç‡ç»Ÿè®¡æ–¹å¼é€šè¿‡ä¸Šé¢çš„æµ‹è¯•ç”¨ä¾‹å¯ä»¥çŸ¥é“è§¦å‘ç†”æ–­å™¨çŠ¶æ€åˆ‡æ¢çš„æ—¶æœºï¼Œè€Œä¸”é—­åˆçŠ¶æ€ä¸‹å’ŒåŠç†”æ–­çŠ¶æ€ä¸‹ç»Ÿè®¡é”™è¯¯ç‡çš„å•ä½è¯·æ±‚æ•°ä¸ç›¸åŒï¼Œé‚£ä¹ˆè¿™ä¸ªè¯·æ±‚æ•°é‡åˆæ˜¯æ€ä¹ˆç»Ÿè®¡çš„å‘¢ï¼Ÿå¦‚æœä¸€ä¸ªè¯·æ±‚å…ˆé”™è¯¯äº†49æ¬¡ï¼Œç„¶ååœ¨ç¬¬101æ¬¡è¯·æ±‚çš„æ—¶å€™å†é”™è¯¯1æ¬¡æ˜¯å¦å¯ä»¥æˆåŠŸè§¦å‘ç†”æ–­å™¨å…¨å¼€ï¼Ÿå¦‚æœæŠŠè¿™49æ¬¡å¤±è´¥å¾€åæŒªä¸€ä½å‘¢ï¼Ÿç°åœ¨å†æ¥æŒ‰ç…§è®¾æƒ³æµ‹è¯•ä¸‹å…¶é”™è¯¯ç‡çš„ç»Ÿè®¡æ–¹å¼ï¼š ä»£ç å—412345678910111213141516public void testRate() { //é¦–å…ˆé—­åˆçŠ¶æ€ä¸‹å•ä½è¯·æ±‚ä»ç„¶æ˜¯100ï¼Œç°åœ¨è®©å‰49æ¬¡å…¨éƒ¨å¤±è´¥ for (int i = 0; i &lt; 100; i++) { if (i &lt; 49) { serverB.getCInfo(0); } else { serverB.getCInfo(1); } } //æ–­è¨€ï¼šè™½ç„¶è¯·æ±‚äº†100æ¬¡ï¼Œä½†æ˜¯é”™è¯¯ç‡å¹¶æ²¡æœ‰è¾¾åˆ°é˜ˆå€¼ï¼ˆ50%ï¼‰ï¼Œæ‰€ä»¥è¿™é‡Œä»ç„¶æ˜¯é—­åˆçŠ¶æ€çš„ System.out.println(serverB.getBreaker().getState().equals(CircuitBreaker.State.CLOSED)); //è¿™é‡Œå†è®©å…¶å¤±è´¥ä¸€æ¬¡ serverB.getCInfo(0); //æ–­è¨€ï¼šè¿™é‡Œåº”è¯¥è¿˜æ˜¯é—­åˆçŠ¶æ€çš„ï¼ŒæŒ‰ç…§100æ¬¡å•ä½è¯·æ±‚æ¥çœ‹ï¼Œç¬¬ä¸€æ¬¡å¤±è´¥çš„é‚£ä¸ªè¯·æ±‚ä¼šè¢«è¿™æ¬¡å¤±è´¥è¿™ä¸ªè¯·æ±‚é¡¶æ›¿æ‰ï¼ˆè¿™é‡Œä¸ç†è§£æ²¡å…³ç³»ï¼Œä¸‹é¢æœ‰å›¾ï¼‰ System.out.println(serverB.getBreaker().getState().equals(CircuitBreaker.State.CLOSED)); } è¾“å‡ºç»“æœä¸ºï¼š 12truetrue ç„¶åæˆ‘ä»¬è®©ç¬¬ä¸€æ¬¡å¤±è´¥çš„é‚£æ¬¡è¯·æ±‚å’Œå…¶åé¢å‡ºé”™çš„è¯·æ±‚åç§»ä¸€ä½ï¼š ä»£ç å—512345678910111213141516public void testRate() { //é¦–å…ˆé—­åˆçŠ¶æ€ä¸‹å•ä½è¯·æ±‚ä»ç„¶æ˜¯100ï¼Œä»ç„¶è®©å…¶é”™è¯¯49æ¬¡ï¼Œä½†ç°åœ¨è®©ç¬¬2~50æ¬¡å¤±è´¥ for (int i = 0; i &lt; 100; i++) { if (i != 0 &amp;&amp; i &lt; 50) { //ç¬¬2~50æ¬¡è¯·æ±‚å¤±è´¥ï¼Œæ€»è®¡å¤±è´¥49æ¬¡ serverB.getCInfo(0); } else { serverB.getCInfo(1); } } //æ–­è¨€ï¼šè·Ÿä¸Šé¢ä¾‹å­ä¸€æ ·ï¼Œé”™è¯¯ç‡å¹¶æ²¡æœ‰è¾¾åˆ°é˜ˆå€¼ï¼Œä»ç„¶æ˜¯é—­åˆçŠ¶æ€ System.out.println(serverB.getBreaker().getState().equals(CircuitBreaker.State.CLOSED)); //è¿™é‡Œå†è®©å…¶å¤±è´¥ä¸€æ¬¡ serverB.getCInfo(0); //æ–­è¨€ï¼šè¿™é‡Œåº”è¯¥æ˜¯å…¨å¼€çŠ¶æ€ï¼ŒæŒ‰ç…§100æ¬¡å•ä½è¯·æ±‚æ¥çœ‹ï¼Œç¬¬ä¸€æ¬¡æˆåŠŸçš„é‚£ä¸ªè¯·æ±‚ä¼šè¢«è¿™æ¬¡å¤±è´¥è¿™ä¸ªè¯·æ±‚é¡¶æ›¿æ‰ï¼Œç„¶åå‡‘å¤Ÿ50æ¬¡å¤±è´¥è¯·æ±‚ï¼ˆå‚è€ƒå›¾4ï¼‰ System.out.println(serverB.getBreaker().getState().equals(CircuitBreaker.State.OPEN)); } è¾“å‡ºç»“æœä¸ºï¼š 12truetrue ç”¨å›¾æ¥æè¿°ä¸‹å¯¼è‡´è¿™ä¸¤ç§æƒ…å†µå‘ç”Ÿçš„æµç¨‹ï¼š æ‰€ä»¥Resilience4jåœ¨è®¡ç®—å¤±è´¥ç‡çš„æ—¶å€™ï¼Œæ˜¯ä¼šå‘ç”Ÿæ»‘åŠ¨çš„ï¼Œé”™è¯¯ç‡æ˜¯æ ¹æ®å½“å‰æ»‘åŠ¨çª—å£å†…çš„è¯·æ±‚è¿›è¡Œè®¡ç®—å¾—å‡ºçš„ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šå¯¼è‡´çª—å£ç§»åŠ¨ï¼Œéƒ½ä¼šé‡æ–°è®¡ç®—å½“å‰å¤±è´¥ç‡ï¼Œè¿™ä¸ªåœ¨æºç è§£æé‡Œä¼šè¯´æ˜è¿™æ˜¯æ€æ ·çš„ä¸€ç§ç»“æ„ï¼Œè¿™é‡Œç®€å•äº†è§£å³å¯ã€‚ ä¸‰ã€æºç è§£æ3.1ï¼šæ³¨å†Œå™¨å…¥å£é€šè¿‡ä¸Šé¢ServerBç±»é‡Œçš„ä½¿ç”¨ï¼Œé¦–å…ˆä¼šé€šè¿‡CircuitBreakerRegistry.ofç”Ÿæˆä¸€ä¸ªæ³¨å†Œå™¨å¯¹è±¡ï¼Œç„¶ååˆ©ç”¨æ³¨å†Œå™¨å¯¹è±¡çš„circuitBreakeræ–¹æ³•æ¥ç”Ÿæˆä¸€ä¸ªå®é™…çš„breakerå¯¹è±¡ï¼Œä»£ç å¦‚ä¸‹ï¼š ä»£ç å—6123456public interface CircuitBreakerRegistry { //é™æ€æ–¹æ³•è¿”å›äº†InMemoryCircuitBreakerRegistryçš„å®ä¾‹ static CircuitBreakerRegistry of(CircuitBreakerConfig circuitBreakerConfig) { return new InMemoryCircuitBreakerRegistry(circuitBreakerConfig); }} InMemoryCircuitBreakerRegistryç±»ä»£ç å¦‚ä¸‹ï¼ˆå·²ç®€åŒ–å¤„ç†ï¼Œåªå±•ç¤ºæµç¨‹ç›¸å…³ä»£ç ï¼‰ï¼š ä»£ç å—71234567891011121314151617public final class InMemoryCircuitBreakerRegistry implements CircuitBreakerRegistry { //æ‰€æœ‰çš„breakerè¢«å­˜æ–¹åœ¨è¿™ä¸ªmapé‡Œï¼ŒbreakeræŒ‰ç…§nameä¸åŒè€Œä¸åŒï¼Œæ¯ä¸ªbreakeré‡Œéƒ½æœ‰è‡ªå·±çš„ä¸€ä»½é”™è¯¯ç‡ç»Ÿè®¡æ•°æ® private final ConcurrentMap&lt;String, CircuitBreaker&gt; circuitBreakers; private final CircuitBreakerConfig defaultCircuitBreakerConfig; //å¼€å§‹çš„é…ç½®å¯¹è±¡ï¼Œé—­åˆçŠ¶æ€å•ä½è¯·æ±‚é‡ã€åŠå¼€çŠ¶æ€å•ä½è¯·æ±‚é‡ã€é”™è¯¯ç‡é˜ˆå€¼ç­‰éƒ½ä¼šæ”¾åœ¨è¿™é‡Œé¢ public InMemoryCircuitBreakerRegistry(CircuitBreakerConfig defaultCircuitBreakerConfig) { this.defaultCircuitBreakerConfig = Objects.requireNonNull(defaultCircuitBreakerConfig, \"CircuitBreakerConfig must not be null\"); this.circuitBreakers = new ConcurrentHashMap&lt;&gt;(); } @Override public CircuitBreaker circuitBreaker(String name) { //æ·»åŠ ä¸€ä¸ªbreakerï¼Œè‹¥å­˜åœ¨ï¼Œç›´æ¥è¿”å› return circuitBreakers.computeIfAbsent(Objects.requireNonNull(name, \"Name must not be null\"), (k) -&gt; CircuitBreaker.of(name, defaultCircuitBreakerConfig)); }} è¿™ä¸ªæµç¨‹å¾ˆç®€å•ï¼Œå°±æ˜¯ç”¨ä¸€ä¸ªmapæ¥ç»´æŠ¤æ‰€æœ‰breakerçš„ï¼Œæ‰€ä»¥éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‘½åbreakerçš„æ—¶å€™ï¼Œä¸è¦æºå¸¦ä¸€äº›idä¹‹ç±»çš„å­—æ®µï¼Œå¾ˆå®¹æ˜“æŠŠmapæ’‘çˆ†ã€‚ 3.2ï¼šBreakerå®ä½“-CircuitBreakeræ‹¿åˆ°breakerå®ä½“åé¦–å…ˆä¼šé€šè¿‡å…¶executeCallableæ–¹æ³•æ‰§è¡Œéœ€è¦è¢«ç†”æ–­çš„é€»è¾‘å—ï¼Œä¹‹å‰æåˆ°çš„æ‰€æœ‰çš„é”™è¯¯ç‡ç»Ÿè®¡ã€çŠ¶æ€åˆ‡æ¢éƒ½å‘ç”Ÿåœ¨è¿™ä¸ªå®ä½“å†…ã€‚ ä»£ç å—8123456789101112131415161718192021222324252627public interface CircuitBreaker { default T executeCallable(Callable callable) throws Exception{ return decorateCallable(this, callable).call(); //åŒ…è£…åŸå§‹çš„callable } //æ–¹æ³•åŒ…è£…ï¼Œè¿”å›ä¸€ä¸ªCallableå¯¹è±¡ï¼ŒçœŸæ­£çš„ä¸šåŠ¡é€»è¾‘callableåœ¨è¿™é‡Œè¢«æ‰§è¡Œ static Callable decorateCallable(CircuitBreaker circuitBreaker, Callable callable){ return () -&gt; { //å…¨ç†”æ–­çŠ¶æ€ä¸‹ï¼Œè¿™é‡Œè¿”å›falseï¼Œä¼šæŠ›å‡ºCircuitBreakerOpenExceptionç±»å‹çš„å¼‚å¸¸ï¼ŒServerBé‡Œåˆ¤å®šæ˜¯å¦èµ°é™çº§é€»è¾‘å°±æ˜¯é€šè¿‡catchè¯¥å¼‚å¸¸æ¥å†³å®šçš„ if(!circuitBreaker.isCallPermitted()) { throw new CircuitBreakerOpenException(String.format(\"CircuitBreaker '%s' is open\", circuitBreaker.getName())); } //éå…¨ç†”æ–­çŠ¶æ€è§¦å‘ä¸‹é¢çš„é€»è¾‘ long start = System.nanoTime(); try { T returnValue = callable.call(); //æ‰§è¡Œå®é™…çš„ä¸šåŠ¡é€»è¾‘ long durationInNanos = System.nanoTime() - start; circuitBreaker.onSuccess(durationInNanos); //éå¸¸å…³é”®çš„æ–¹æ³•ï¼Œç”¨æ¥ç´¯è®¡æ‰§è¡ŒæˆåŠŸçš„æ•°é‡ï¼Œè®¡ç®—é”™è¯¯ç‡ return returnValue; } catch (Throwable throwable) { //æ‰§è¡Œå¼‚å¸¸ï¼Œè°ƒç”¨onErrorç´¯è®¡å‡ºé”™æ•° long durationInNanos = System.nanoTime() - start; circuitBreaker.onError(durationInNanos, throwable); //éå¸¸å…³é”®çš„æ–¹æ³•ï¼Œç”¨æ¥ç´¯è®¡æ‰§è¡Œå¤±è´¥çš„æ•°é‡ï¼Œè®¡ç®—é”™è¯¯ç‡ throw throwable; } }; }} CircuitBreakeræ˜¯ä¸€ä¸ªæ¥å£ï¼ŒCircuitBreakerStateMachineæ˜¯å®ƒçš„å®ç°ç±»ï¼Œä¸Šè¿°ä»£ç é‡Œæ¯”è¾ƒå…³é”®çš„isCallPermittedã€onSuccessã€onErroréƒ½æ˜¯åœ¨è¿™ä¸ªCircuitBreakerStateMachineç±»é‡Œå®ç°çš„ã€‚ CircuitBreakerStateMachineç±»æ¯”è¾ƒå¤æ‚ï¼Œç‰µæ‰¯åˆ°æ•´ä¸ªç†”æ–­å™¨çš„çŠ¶æ€åˆ‡æ¢ã€é”™è¯¯ç»Ÿè®¡è§¦å‘ç­‰ï¼Œç²¾ç®€ä¸€ä¸‹è¯¥ç±»ï¼Œåªå…³æ³¨æ ¸å¿ƒéƒ¨åˆ†ï¼š ä»£ç å—912345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394public final class CircuitBreakerStateMachine implements CircuitBreaker { //ç†”æ–­å™¨çš„åç§° private final String name; /** * éå¸¸éå¸¸å…³é”®çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼•ç”¨å¯¹è±¡ï¼ŒCircuitBreakerStateä¸€å…±æœ‰ä»¥ä¸‹å­ç±»ï¼šClosedStateã€HalfOpenStateã€OpenStateã€DisabledStateã€ForcedOpenState * ç†”æ–­å™¨æ¯æ¬¡å‘ç”ŸçŠ¶æ€åˆ‡æ¢ï¼Œéƒ½ä¼šnewå‡ºä¸€ä¸ªæ–°çš„XXStateå¯¹è±¡ï¼Œè®©ä¸‹é¢çš„å¼•ç”¨æŒ‡å‘æ–°çš„çŠ¶æ€å¯¹è±¡ */ private final AtomicReference stateReference; //å¼€å§‹è®¾ç½®çš„ç†”æ–­å™¨é…ç½®ï¼Œé€šè¿‡è¯¥å¯¹è±¡å¯ä»¥æ‹¿åˆ°é”™è¯¯ç‡é˜ˆå€¼ã€å…¨ç†”æ–­æŒç»­çŠ¶æ€ç­‰ä¿¡æ¯ private final CircuitBreakerConfig circuitBreakerConfig; //&amp;&amp;&amp; äº‹ä»¶å¤„ç†å™¨ï¼Œè¿™é‡Œä¸æ˜¯é‡ç‚¹ï¼Œæ”¾åˆ°ç¬¬å››éƒ¨åˆ†è¯´ï¼Œå¯ä»¥å…ˆå¿½ç•¥ private final CircuitBreakerEventProcessor eventProcessor; //æ„é€ å™¨ public CircuitBreakerStateMachine(String name, CircuitBreakerConfig circuitBreakerConfig) { this.name = name; this.circuitBreakerConfig = circuitBreakerConfig; this.stateReference = new AtomicReference&lt;&gt;(new ClosedState(this)); //åˆå§‹åŒ–çš„æ—¶å€™ï¼Œç†”æ–­å™¨çŠ¶æ€éƒ½æ˜¯é—­åˆçŠ¶æ€ï¼Œæ‰€ä»¥é¦–å…ˆnewä¸€ä¸ªClosedStateå¹¶è®©stateReferenceæŒ‡å‘å®ƒ this.eventProcessor = new CircuitBreakerEventProcessor(); } //åˆ‡æ¢åˆ°é—­åˆçŠ¶æ€ï¼Œnew ClosedStateï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ªXXStateå¯¹è±¡éƒ½æŒæœ‰å½“å‰CircuitBreakerStateMachineå¯¹è±¡ @Override public void transitionToClosedState() { stateTransition(CLOSED, currentState -&gt; new ClosedState(this, currentState.getMetrics())); } //åˆ‡æ¢åˆ°å…¨ç†”æ–­çŠ¶æ€ï¼Œnew OpenStateï¼Œ @Override public void transitionToOpenState() { stateTransition(OPEN, currentState -&gt; new OpenState(this, currentState.getMetrics())); } //åˆ‡æ¢åˆ°åŠç†”æ–­çŠ¶æ€ï¼Œnew HalfOpenStateï¼Œ @Override public void transitionToHalfOpenState() { stateTransition(HALF_OPEN, currentState -&gt; new HalfOpenState(this)); } //çŠ¶æ€åˆ‡æ¢æ–¹æ³•ï¼ˆä¹Ÿå³æ˜¯XXStateå¯¹è±¡åˆ‡æ¢çš„åœ°æ–¹ï¼‰ private void stateTransition(State newState, Function&lt;CircuitBreakerState, CircuitBreakerState&gt; newStateGenerator) { //å¼•ç”¨æŒ‡å‘æ–°çš„XXStateå¯¹è±¡ CircuitBreakerState previousState = stateReference.getAndUpdate(currentState -&gt; { if (currentState.getState() == newState) { return currentState; } return newStateGenerator.apply(currentState); }); if (previousState.getState() != newState) { //&amp;&amp;&amp; çŠ¶æ€åˆ‡æ¢äº‹ä»¶å‘å¸ƒï¼Œæœ¬éƒ¨åˆ†å¿½ç•¥ï¼Œå‚è€ƒç¬¬å››éƒ¨åˆ† publishStateTransitionEvent(StateTransition.transitionBetween(previousState.getState(), newState)); } } //ä»£ç å—8é‡Œçš„isCallPermittedæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å†³å®šäº†æ˜¯å¦æŠ›å‡º\"å·²ç†”æ–­\"å¼‚å¸¸ @Override public boolean isCallPermitted() { //å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªè§£å†³å–å†³äºå¯¹åº”XXStateé‡ŒisCallPermittedæ–¹æ³•çš„è¿”å›ç»“æœ boolean callPermitted = stateReference.get().isCallPermitted(); if (!callPermitted) { //&amp;&amp;&amp; å·²ç†”æ–­å¼‚å¸¸äº‹ä»¶å‘å¸ƒï¼Œæœ¬éƒ¨åˆ†å¿½ç•¥ï¼Œå‚è€ƒç¬¬å››éƒ¨åˆ† publishCallNotPermittedEvent(); } return callPermitted; } //ä»£ç å—8é‡Œçš„onErroræ–¹æ³•ï¼Œä¸šåŠ¡å¤„ç†é”™è¯¯åä¼šè§¦å‘è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨ @Override public void onError(long durationInNanos, Throwable throwable) { //è¿™ä¸ªåˆ¤æ–­æ˜¯è¿‡æ»¤éœ€è¦å¿½ç•¥çš„å¼‚å¸¸å¤„ç†ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ²¡é…ç½®çš„è¯æ‰€æœ‰å¼‚å¸¸éƒ½ä¼šèµ°ä¸‹é¢å®é™…çš„onErroré€»è¾‘ if (circuitBreakerConfig.getRecordFailurePredicate().test(throwable)) { //&amp;&amp;&amp; å¤„ç†é”™è¯¯äº‹ä»¶å‘å¸ƒï¼Œå‚è€ƒç¬¬å››éƒ¨åˆ† publishCircuitErrorEvent(name, durationInNanos, throwable); //å¯ä»¥çœ‹åˆ°ï¼Œå®é™…ä¸ŠonErrorä¹Ÿæ˜¯è°ƒç”¨çš„XXStateé‡Œçš„onErroræ–¹æ³• stateReference.get().onError(throwable); } else { //&amp;&amp;&amp; å‘½ä¸­äº†å¯å¿½ç•¥çš„å¼‚å¸¸ï¼Œå¿½ç•¥é”™è¯¯äº‹ä»¶å‘å¸ƒï¼Œæœ¬éƒ¨åˆ†å¿½ç•¥ï¼Œå‚è€ƒç¬¬å››éƒ¨åˆ† publishCircuitIgnoredErrorEvent(name, durationInNanos, throwable); } } //ä»£ç å—8é‡Œçš„onSuccessæ–¹æ³•ï¼Œä¸šåŠ¡å¤„ç†æ­£å¸¸ä¼šè§¦å‘è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨ @Override public void onSuccess(long durationInNanos) { //&amp;&amp;&amp; å¤„ç†æ­£å¸¸äº‹ä»¶å‘å¸ƒï¼Œæœ¬éƒ¨åˆ†å¿½ç•¥ï¼Œå‚è€ƒç¬¬å››éƒ¨åˆ† publishSuccessEvent(durationInNanos); //åŒæ ·çš„ï¼ŒonSuccessä¹Ÿæ˜¯è°ƒç”¨çš„XXStateé‡Œçš„onErroræ–¹æ³• stateReference.get().onSuccess(); }} 3.3ï¼šçŠ¶æ€ç±»é€šè¿‡ä¸Šé¢çš„ä»£ç å¯ä»¥çŸ¥é“isCallPermittedã€onSuccessã€onErrorè¿™ä¸‰ä¸ªæ–¹æ³•å®é™…ä¸Šéƒ½æ˜¯è°ƒç”¨å¯¹åº”XXStateå¯¹è±¡é‡Œçš„æ–¹æ³•ï¼Œä¸‹é¢æ¥çœ‹ä¸‹ClosedStateã€OpenStateã€HalfOpenStateè¿™ä¸‰ä¸ªçŠ¶æ€å¯¹è±¡é‡Œæœ‰å…³è¿™ä¸‰ä¸ªæ–¹æ³•çš„å®ç°ï¼ˆå› ä¸ºä¸Šé¢çš„æµ‹è¯•ç”¨ä¾‹åªæ¶‰åŠè¿™ä¸‰ç§çŠ¶æ€çš„äº’è½¬ï¼Œå®é™…ä¸Šè¿™ä¸‰ç§çŠ¶æ€ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ï¼Œæ‰€ä»¥ä¸ºäº†é¿å…æ··ä¹±ï¼Œåªå±•ç¤ºè¿™ä¸‰ç§ï¼Œæ‰€æœ‰çŠ¶æ€ç±»å‡ç»§æ‰¿è‡ªCircuitBreakerStateæŠ½è±¡ç±»ï¼‰ 3.3.1ï¼šClosedStateé—­åˆçŠ¶æ€æ—¶åˆå§‹çŠ¶æ€ï¼Œä¸­é€”åªä¼šç”±åŠç†”æ–­çŠ¶æ€åˆ‡æ¢è€Œæ¥ï¼Œæ­£å¸¸æƒ…å†µä¸‹éƒ½æ˜¯é—­åˆçŠ¶æ€ï¼Œä»£ç å¦‚ä¸‹ï¼š ä»£ç å—101234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556final class ClosedState extends CircuitBreakerState { //ç”¨æ¥åº¦é‡é”™è¯¯ç‡çš„å¯¹è±¡ private final CircuitBreakerMetrics circuitBreakerMetrics; //å°±æ˜¯é…ç½®é‡Œçš„failureRateThresholdå±æ€§ï¼Œé—­åˆçŠ¶æ€æ—¶çš„é”™è¯¯ç‡é˜ˆå€¼ï¼ˆç¬¬äºŒéƒ¨åˆ†çš„æµ‹è¯•ç”¨ä¾‹ä¸­æ˜¯50ï¼‰ private final float failureRateThreshold; //å‚è€ƒä»£ç å—9çš„CircuitBreakerStateMachineæ„é€ å™¨ä¸­åˆå§‹åŒ–stateReferenceæ—¶ï¼Œåˆå§‹æ€éƒ½æ˜¯é—­åˆçŠ¶æ€ï¼Œæœ€åˆéƒ½æ˜¯é€šè¿‡è¯¥æ–¹æ³•å®Œæˆåˆå§‹åŒ–çš„ ClosedState(CircuitBreakerStateMachine stateMachine) { this(stateMachine, null); } //è¿™ä¸ªæ„é€ å™¨æ˜¯çŠ¶æ€è½¬æ¢æ—¶è§¦å‘çš„ï¼Œå‚è€ƒä»£ç å—9é‡Œçš„transitionToClosedStateæ–¹æ³• ClosedState(CircuitBreakerStateMachine stateMachine, CircuitBreakerMetrics circuitBreakerMetrics) { super(stateMachine); //æ‹¿åˆ°ç†”æ–­å™¨çš„é…ç½® CircuitBreakerConfig circuitBreakerConfig = stateMachine.getCircuitBreakerConfig(); if(circuitBreakerMetrics == null){ //åˆå§‹åŒ–metricså¯¹è±¡ï¼Œä¼ è¿›å»çš„æ˜¯é—­åˆçŠ¶æ€æ—¶è®¡ç®—é”™è¯¯ç‡çš„å•ä½è¯·æ±‚æ•°ï¼ˆç¬¬äºŒéƒ¨åˆ†çš„æµ‹è¯•ç”¨ä¾‹ä¸­æ˜¯100ï¼‰ this.circuitBreakerMetrics = new CircuitBreakerMetrics( circuitBreakerConfig.getRingBufferSizeInClosedState()); }else{ //ä¸­é€”è¿›è¡ŒçŠ¶æ€è½¬æ¢ï¼Œè°ƒç”¨çš„éƒ½æ˜¯è¿™é‡Œçš„é€»è¾‘ï¼Œåˆ©ç”¨circuitBreakerMetricsçš„copyæ–¹æ³•ï¼Œé‡æ–°èµ‹å€¼ç»™circuitBreakerMetricså±æ€§ï¼Œæš‚æ—¶å¿½ç•¥ï¼Œå‚è€ƒç¬¬3.4éƒ¨åˆ† this.circuitBreakerMetrics = circuitBreakerMetrics.copy(circuitBreakerConfig.getRingBufferSizeInClosedState()); } //èµ‹å€¼é”™è¯¯ç‡é˜ˆå€¼ this.failureRateThreshold = stateMachine.getCircuitBreakerConfig().getFailureRateThreshold(); } @Override boolean isCallPermitted() { //é—­åˆçŠ¶æ€ä¸‹è¿”å›trueï¼Œä¸ä¼šè§¦å‘é™çº§é€»è¾‘ï¼ˆpsï¼šåªæœ‰åœ¨å…¨ç†”æ–­çŠ¶æ€ä¸‹æ‰ä¼šè¿”å›trueï¼‰ return true; } @Override void onError(Throwable throwable) { // é—­åˆçŠ¶æ€ä¸‹ï¼Œonerroréœ€è¦è®°å½•é”™è¯¯ç‡ï¼Œæ³¨ï¼šcircuitBreakerMetricsçš„onErroræ–¹æ³•ä¼šè®°å½•ä¸€ç¬”é”™è¯¯çš„è®°å½•ï¼Œå¹¶æŠŠå½“å‰çš„é”™è¯¯ç‡è¿”å› checkFailureRate(circuitBreakerMetrics.onError()); } @Override void onSuccess() { // é—­åˆçŠ¶æ€ä¸‹ï¼Œonerroréœ€è¦è®°å½•æˆåŠŸæ•°ï¼Œæ³¨ï¼šcircuitBreakerMetricsçš„onSuccessæ–¹æ³•ä¼šè®°å½•ä¸€ç¬”æ­£ç¡®çš„è®°å½•ï¼Œå¹¶æŠŠå½“å‰çš„é”™è¯¯ç‡è¿”å› checkFailureRate(circuitBreakerMetrics.onSuccess()); } //æ ¹æ®å½“å‰çš„é”™è¯¯ç‡ï¼Œå†³å®šæ˜¯å¦åˆ‡åˆ°åŠç†”æ–­çŠ¶æ€ private void checkFailureRate(float currentFailureRate) { if (currentFailureRate &gt;= failureRateThreshold) { //è¿™é‡Œåˆ¤æ–­å½“å‰é”™è¯¯ç‡æ˜¯å¦è¶…è¿‡é˜ˆå€¼ // åˆ©ç”¨CircuitBreakerStateMachineçš„transitionToOpenStateæ–¹æ³•ï¼Œå°†çŠ¶æ€å¯¹è±¡è½¬æ¢æˆOpenState stateMachine.transitionToOpenState(); } }} 3.3.2ï¼šOpenStateä¸€èˆ¬å…¨ç†”æ–­çŠ¶æ€ä¼šä»é—­åˆæˆ–è€…åŠç†”æ–­çŠ¶æ€é‡Œåˆ‡æ¢è€Œæ¥ï¼Œå®ƒçš„ä»£ç å¦‚ä¸‹ï¼š ä»£ç å—111234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253final class OpenState extends CircuitBreakerState { //æ ¹æ®å…¨ç†”æ–­æŒç»­æ—¶é—´æ¨å‡ºçš„è¿›å…¥åŠç†”æ–­çŠ¶æ€çš„æ—¶é—´ private final Instant retryAfterWaitDuration; //åŒæ ·æ˜¯ç”¨æ¥åº¦é‡é”™è¯¯ç‡çš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å°±æ˜¯ä¸Šä¸€ä¸ªStateå¯¹è±¡é‡Œçš„Metricså¯¹è±¡ private final CircuitBreakerMetrics circuitBreakerMetrics; OpenState(CircuitBreakerStateMachine stateMachine, CircuitBreakerMetrics circuitBreakerMetrics) { super(stateMachine); //å°±æ˜¯é…ç½®é‡Œçš„waitDurationInOpenStateå±æ€§ï¼Œå…¨ç†”æ–­æŒç»­æ—¶é—´ï¼ˆç¬¬äºŒéƒ¨åˆ†çš„æµ‹è¯•ç”¨ä¾‹ä¸­æ˜¯100msï¼‰ final Duration waitDurationInOpenState = stateMachine.getCircuitBreakerConfig().getWaitDurationInOpenState(); //å½“å‰æ—¶é—´åŠ ä¸ŠæŒç»­æ—¶é—´ï¼Œå°±æ˜¯åˆ‡æ¢è‡³åŠç†”æ–­çŠ¶æ€çš„æ—¶æœº this.retryAfterWaitDuration = Instant.now().plus(waitDurationInOpenState); //ç›´æ¥ç”¨ä¹‹å‰çš„circuitBreakerMetricså¯¹è±¡ this.circuitBreakerMetrics = circuitBreakerMetrics; //å¦‚æœé…ç½®äº†è‡ªåŠ¨åˆ‡æ¢åŠç†”æ–­çŠ¶æ€çš„å¼€å…³ä¸ºtrueï¼Œåˆ™ä¼šå‘èµ·ä¸€ä¸ªå»¶æ—¶ä»»åŠ¡ï¼Œç”¨æ¥ä¸»åŠ¨åˆ‡æ¢çŠ¶æ€ if (stateMachine.getCircuitBreakerConfig().isAutomaticTransitionFromOpenToHalfOpenEnabled()) { AutoTransitioner.scheduleAutoTransition(stateMachine::transitionToHalfOpenState, waitDurationInOpenState); } } @Override boolean isCallPermitted() { // å¦‚æœå…¨ç†”æ–­çŠ¶æ€æŒç»­æ—¶é—´è¶…å‡ºç›®æ ‡èŒƒå›´ï¼Œåˆ™è®¤ä¸ºç°åœ¨å¯ä»¥åˆ‡æ¢ä¸ºåŠç†”æ–­çŠ¶æ€ï¼Œç„¶åè¿”å›true if (Instant.now().isAfter(retryAfterWaitDuration)) { stateMachine.transitionToHalfOpenState(); return true; } circuitBreakerMetrics.onCallNotPermitted(); //è®°å½•ä¸€æ¬¡NotPermittedï¼ˆç®€å•çš„ç´¯åŠ ï¼‰ return false; //å…¨ç†”æ–­çŠ¶æ€ï¼Œç›´æ¥è¿”å›falseï¼Œè¡¨ç¤ºå·²è¢«ç†”æ–­ï¼Œè®©è°ƒç”¨æ–¹æŠ›å‡ºCircuitBreakerOpenExceptionå¼‚å¸¸ } @Override void onError(Throwable throwable) { //ç†è®ºä¸Šå¤„äºå…¨ç†”æ–­çŠ¶æ€ï¼ŒisCallPermittedè¿”å›falseï¼ŒonErrorä¸ä¼šè¢«è§¦å‘ï¼ˆå‚è€ƒä»£ç å—8é‡Œçš„decorateCallableæ–¹æ³•ï¼‰ //ä½†æ˜¯å­˜åœ¨ä¸€ç§ç‰¹æ®Šçš„æƒ…å†µï¼Œå‡è®¾æœ‰ä¿©çº¿ç¨‹ï¼Œçº¿ç¨‹1æ‰§è¡Œçš„æ—¶å€™è¿˜æ˜¯é—­åˆçŠ¶æ€ï¼ŒisCallPermittedè¿”å›trueï¼Œè¿™æ—¶çº¿ç¨‹2é‡Œè§¦å‘äº†ç†”æ–­é˜ˆå€¼ //çº¿ç¨‹2æŠŠstateReferenceçš„æŒ‡å‘ç½®ä¸ºOpenStateï¼Œè¿™æ—¶çº¿ç¨‹1ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œè§¦å‘çš„onErrorå…¶å®æ˜¯OpenStateé‡Œçš„onErrorï¼ˆä¹Ÿå³æ˜¯æœ¬ä¾‹ä¸­çš„è¿™ä¸ªæ–¹æ³•ï¼‰ //å…¨ç†”æ–­çŠ¶æ€ä¸‹å³ä¾¿æ˜¯ä¸Šé¢è¿™ç§ä¸´ç•Œæƒ…å†µå‘ç”Ÿï¼Œè¿™æ¬¡å¤±è´¥ä¹Ÿä¼šè¢«ç»Ÿè®¡ä¸Šå» circuitBreakerMetrics.onError(); } /** * Should never be called when isCallPermitted returns false. */ @Override void onSuccess() { //è·ŸonErrorä¸€æ ·ï¼Œæœ‰æ¦‚ç‡ä¼šè®¿é—®åˆ° circuitBreakerMetrics.onSuccess(); }} 3.3.3ï¼šHalfOpenStateåŠç†”æ–­çŠ¶æ€ä¸€å®šæ˜¯ç”±å…¨ç†”æ–­åˆ‡æ¢å‡ºæ¥çš„ï¼Œæ¥çœ‹ä¸‹å®ƒçš„ä»£ç ï¼š ä»£ç å—1212345678910111213141516171819202122232425262728293031323334353637383940414243444546474849final class HalfOpenState extends CircuitBreakerState { //åŒæ ·æ˜¯ç”¨æ¥åº¦é‡é”™è¯¯ç‡çš„å¯¹è±¡ private CircuitBreakerMetrics circuitBreakerMetrics; //åŒæ ·æ˜¯é…ç½®é‡Œçš„failureRateThresholdå±æ€§ private final float failureRateThreshold; HalfOpenState(CircuitBreakerStateMachine stateMachine) { super(stateMachine); CircuitBreakerConfig circuitBreakerConfig = stateMachine.getCircuitBreakerConfig(); //åˆå§‹åŒ–åº¦é‡å¯¹è±¡ï¼Œç›¸æ¯”é—­åˆçŠ¶æ€ï¼Œè¿™é‡Œä¼ å…¥çš„æ˜¯ringBufferSizeInHalfOpenStateï¼ˆç¬¬äºŒéƒ¨åˆ†çš„æµ‹è¯•ç”¨ä¾‹ä¸­æ˜¯10ï¼‰ this.circuitBreakerMetrics = new CircuitBreakerMetrics( circuitBreakerConfig.getRingBufferSizeInHalfOpenState()); //é—­åˆçŠ¶æ€å’ŒåŠå¼€çŠ¶æ€å…±ç”¨åŒä¸€ä¸ªé”™è¯¯ç‡é˜ˆå€¼ï¼ˆç¬¬äºŒéƒ¨åˆ†çš„æµ‹è¯•ç”¨ä¾‹ä¸­æ˜¯50ï¼‰ this.failureRateThreshold = stateMachine.getCircuitBreakerConfig().getFailureRateThreshold(); } @Override boolean isCallPermitted() { //è·Ÿé—­åˆçŠ¶æ€ä¸€æ ·ï¼Œè¿”å›true return true; } @Override void onError(Throwable throwable) { // è·Ÿé—­åˆçŠ¶æ€ä¸€æ ·ï¼Œè¦è®°å½•å’Œåˆ¤æ–­å½“å‰çš„é”™è¯¯ç‡ï¼ˆæ¥å†³å®šæ˜¯æ¢å¤é—­åˆçŠ¶æ€è¿˜æ˜¯è¿›å…¥å…¨ç†”æ–­çŠ¶æ€ï¼‰ checkFailureRate(circuitBreakerMetrics.onError()); } @Override void onSuccess() { // åŒä¸Š checkFailureRate(circuitBreakerMetrics.onSuccess()); } //é€šè¿‡è¯¥æ–¹æ³•ï¼Œåˆ¤æ–­é”™è¯¯ç‡ï¼Œå†³å®šæ˜¯å¦æ¢å¤ä¸ºé—­åˆçŠ¶æ€æˆ–è€…å†æ¬¡è¿›å…¥å…¨ç†”æ–­çŠ¶æ€ private void checkFailureRate(float currentFailureRate) { //Metricsè¿”å›-1è¡¨ç¤ºè¯·æ±‚é‡è¡¨ç¤ºè¿˜æ²¡æœ‰è¾¾åˆ°å•ä½è¯·æ±‚é‡ï¼ˆringBufferSizeInHalfOpenStateï¼‰ //ä¸‹é¢çš„é€»è¾‘å¯ä»¥çœ‹å‡ºï¼Œåœ¨åŠç†”æ–­çŠ¶æ€ä¸‹ï¼Œç»è¿‡ringBufferSizeInHalfOpenStateæ¬¡è¯·æ±‚åæ ¹æ®é”™è¯¯ç‡åˆ¤æ–­ï¼Œå°±å¯ä»¥å†³å®šå‡ºä¸‹ä¸€æ­¥åˆ‡æ¢åˆ°å“ªä¸ªçŠ¶æ€äº† if (currentFailureRate != -1) { //å½“å‰é”™è¯¯ç‡å¦‚æœå†æ¬¡è¶…å‡ºé˜ˆå€¼ï¼Œåˆ™å†æ¬¡è¿›å…¥å…¨ç†”æ–­çŠ¶æ€ if (currentFailureRate &gt;= failureRateThreshold) { stateMachine.transitionToOpenState(); } else { //å¦åˆ™æ¢å¤ä¸ºé—­åˆçŠ¶æ€ stateMachine.transitionToClosedState(); } } }} 3.3.4ï¼šçŠ¶æ€é—´çš„åˆ‡æ¢å…³ç³»ä¸Šé¢ä¸‰ç§çŠ¶æ€çš„åˆ‡æ¢å…³ç³»å¦‚ä¸‹ï¼š åœ¨è¿™äº›çŠ¶æ€ä¸­ï¼Œæœ€åˆä¸ºç†”æ–­é—­åˆçŠ¶æ€ï¼ŒServerBçš„æ‰€æœ‰è¯·æ±‚æ­£å¸¸è®¿é—®ServerCï¼ŒServerCæŠ¥é”™ï¼Œé”™è¯¯ç‡ç´¯è®¡è¾¾åˆ°50%åè§¦å‘ç†”æ–­å…¨å¼€çŠ¶æ€ï¼Œæ­¤æ—¶Serverå¯¹ServerCå‘å‡ºçš„è¯·æ±‚å°†èµ°ServerBçš„é™çº§é€»è¾‘ï¼Œä¸å†å®é™…è®¿é—®ServerCçš„æ–¹æ³•ï¼Œè¿™ä¸ªçŠ¶æ€ä¼šæŒç»­waitDurationInOpenStateè¿™ä¹ˆä¹…ï¼ˆæµ‹è¯•ç”¨ä¾‹ä¸­æ˜¯1000msï¼‰ï¼Œç„¶åè¿›å…¥ç†”æ–­åŠå¼€çŠ¶æ€ï¼Œæ­¤æ—¶è·Ÿé—­åˆçŠ¶æ€ä¸€æ ·ï¼ŒServerBçš„æ‰€æœ‰è¯·æ±‚ä»ä¼šæ­£å¸¸è®¿é—®ServerCï¼Œä¸åŒçš„æ˜¯åŠå¼€çŠ¶æ€ä¸‹åªéœ€è¦æ»¡è¶³ringBufferSizeInHalfOpenStateæ¬¡è°ƒç”¨ï¼ˆæµ‹è¯•ç”¨ä¾‹ä¸­æ˜¯10æ¬¡ï¼‰ï¼Œå°±å¯ä»¥ç›´æ¥åˆ¤æ–­é”™è¯¯ç‡æ˜¯å¦è¾¾åˆ°é˜ˆå€¼ï¼Œè¿™ç‚¹å¯ä»¥åœ¨ä»£ç å—12é‡Œçš„checkFailureRateæ–¹æ³•ä½“ç°ï¼Œå›¾5ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæœªè¾¾åˆ°é”™è¯¯é˜ˆå€¼è¡¨ç¤ºServerCå·²æ¢å¤ï¼Œåˆ™å¯ä»¥å…³é—­ç†”æ–­ï¼Œå¦åˆ™å†æ¬¡è¿›å…¥å…¨ç†”æ–­çŠ¶æ€ã€‚ 3.3.5ï¼šåº¦é‡å¯¹è±¡ï¼ˆCircuitBreakerMetricsï¼‰çš„ä¼ é€’è¿™ä¸ªå¯¹è±¡åœ¨3.4ä¸­ä¼šè¯¦ç»†è¯´æ˜ï¼Œç›®å‰åªéœ€è¦çŸ¥é“è¯¥ç±»ç”¨äºåšé”™è¯¯ç»Ÿè®¡ç”¨ï¼Œé”™è¯¯ç‡è®¡ç®—çš„æ ¸å¿ƒï¼Œæ ¸å¿ƒæ–¹æ³•ä¸ºonErrorå’ŒonSuccessï¼Œè¿™ä¿©æ–¹æ³•ç”¨äºé”™è¯¯/æ­£ç¡®è¯·æ±‚çš„è§¦å‘ç‚¹ï¼Œç”¨äºè§¦å‘CircuitBreakerMetricså¯¹è±¡å¯¹é”™è¯¯ç‡çš„ç»Ÿè®¡ã€‚ é€šè¿‡ä»£ç å—10ã€11ã€12å¯ä»¥çœ‹åˆ°CircuitBreakerMetricså¯¹è±¡çš„æµå‘ï¼Œé¦–å…ˆåˆå§‹åŒ–çš„æ—¶å€™æ˜¯è°ƒç”¨ClosedStateç¬¬ä¸€ä¸ªæ„é€ å™¨è§¦å‘ç¬¬äºŒä¸ªæ„é€ å™¨ï¼Œç¬¬äºŒä¸ªæ„é€ å™¨ä¼šnewä¸€ä¸ªCircuitBreakerMetricsï¼Œä¼ è¿‡å»çš„sizeä¸ºringBufferSizeInClosedStateï¼Œç„¶åç”±ClosedStateåˆ‡æ¢è‡³OpenStateçŠ¶æ€æ—¶ï¼Œå…¶CircuitBreakerMetricsä¼šè¢«ä¼ é€’ç»™OpenStateå¯¹è±¡ï¼Œæ ¹æ®ä»£ç å—11å¯ä»¥çŸ¥é“ï¼ŒOpenStateåˆ©ç”¨è¯¥å¯¹è±¡ç»Ÿè®¡ç†”æ–­æœŸé—´è¢«ç†”æ–­çš„æ¬¡æ•°ï¼Œç„¶åOpenStateåˆ‡æ¢è‡³HalfOpenStateæ—¶ï¼ŒHalfOpenStateæ²¡æœ‰æ¥å—CircuitBreakerMetricså¯¹è±¡çš„æ„é€ å™¨ï¼Œä¸ç®¡ç”±è°åˆ‡æ¢åˆ°åŠå¼€çŠ¶æ€ï¼ŒCircuitBreakerMetricså¯¹è±¡éƒ½æ˜¯å…¨æ–°çš„ï¼Œç”±ä»£ç å—12å¯çŸ¥ï¼Œåˆå§‹åŒ–CircuitBreakerMetricså¯¹è±¡æ—¶ä¼ è¿‡å»çš„sizeå°±æ˜¯ringBufferSizeInHalfOpenStateã€‚ CircuitBreakerMetricså¯¹è±¡çš„ä¼ é€’ä»¥åŠä¼ é€’ååœ¨Stateå¯¹è±¡é‡Œæ‰€åšçš„æ“ä½œï¼š å›¾6æ ¹æ®ä»£ç å—10ã€11ã€12ç”»å‡ºï¼Œç®€å•ä½“ç°äº†Metricså¯¹è±¡çš„ç”Ÿæˆä»¥åŠæµå‘ï¼Œä»¥åŠè¿™ä¸ªå¯¹è±¡åœ¨å„Stateå¯¹è±¡é‡Œæ‰€åšçš„ä¸»è¦æ“ä½œã€‚é€šè¿‡å›¾6å¯ä»¥çœ‹å‡ºå®é™…äº§ç”Ÿæ–°çš„Metricså¯¹è±¡çš„åœ°æ–¹ä¸ºé—­åˆæ€å’ŒåŠå¼€æ€ï¼Œå› ä¸ºè¿™ä¿©åœ°æ–¹æ˜¯éœ€è¦åšé”™è¯¯ç»Ÿè®¡çš„ï¼Œéœ€è¦å…¨æ–°çš„Metricå¯¹è±¡ï¼Œå…¨å¼€æ€ä¸‹ä»…æ¥æ”¶å‰ä¸€çŠ¶æ€çš„Metricså¯¹è±¡ï¼Œåœ¨å‘½ä¸­ç†”æ–­åå¯¹å…¶å†…éƒ¨numberOfNotPermittedCallsï¼ˆä¸æ˜¯å¾ˆæ‡‚è¿™ä¸ªå±æ€§ï¼Œç®€å•çš„ç´¯åŠ ï¼Œè¿ç”¨åˆ°çš„åœ°æ–¹éƒ½æ²¡ï¼Œå¯èƒ½ä»…ä»…æ˜¯åšä¸ªç†”æ–­æ•°ç»Ÿè®¡è®©ä¸šåŠ¡æ–¹è·å–çš„å§ï¼Œåšç›‘æ§å¯ä»¥ç”¨ï¼‰ï¼Œåœ¨åŠå¼€æ€å†æ¬¡è¿›å…¥é—­åˆæ€æ—¶ï¼Œå…¶Metricsä»ç„¶è¢«ä¼ é€’ç»™äº†é—­åˆæ€ï¼Œç”±ä»£ç å—10å¯çŸ¥ï¼Œå¦‚æœä¼ äº†Metricså¯¹è±¡ï¼Œé—­åˆæ€åœ¨äº§ç”Ÿæ–°çš„Metricså¯¹è±¡æ—¶ï¼Œä¼šé€šè¿‡copyæ–¹æ³•æ¥äº§ç”Ÿï¼Œè¿™ä¸ªæ–¹æ³•åœ¨3.4ä¼šè¯¦ç»†è¯´æ˜ï¼Œç®€å•æ¥è¯´å°±æ˜¯æŠŠå‰ä¸€ä¸ªçŠ¶æ€ï¼ˆåªå¯èƒ½æ˜¯åŠå¼€æ€ï¼‰çš„Metricsé‡Œçš„è¯·æ±‚è®¡æ•°åŒæ­¥åˆ°å®ƒè‡ªå·±çš„Metricsé‡Œï¼Œè¿™æ ·åšæœ‰ä¸€ä¸ªå¥½å¤„ï¼Œå°±æ˜¯æ–°çš„é—­åˆæ€ä¸ç”¨é‡æ–°ç´¯è®¡é”™è¯¯ç‡äº†ï¼Œä»¥å•å…ƒæµ‹è¯•æ‰€é…çš„å‚æ•°è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœåœ¨åŠå¼€æ€ä¸‹ï¼Œè¿›è¡Œäº†10æ¬¡è¯·æ±‚ï¼Œå‘ç”Ÿäº†4æ¬¡é”™è¯¯ï¼Œæ­¤æ—¶ä¼šåˆ‡å›é—­åˆæ€ï¼Œé—­åˆæ€copyäº†è¿™10æ¬¡è¯·æ±‚çš„æ•°æ®ï¼Œé‚£ä¹ˆåªéœ€è¦å†ç»è¿‡90æ¬¡è¯·æ±‚å’Œ46æ¬¡é”™è¯¯ä¾¿å¯ä»¥å†æ¬¡è¿›å…¥å…¨ç†”æ–­çŠ¶æ€ï¼ˆå…¶å®å°±æ˜¯ä¿è¯äº†çŠ¶æ€çš„å¹³æ»‘åˆ‡æ¢ï¼Œä¸ä¸¢å¤±ä¹‹å‰å·²ç»ç»Ÿè®¡äº†çš„æ•°æ®ï¼‰ã€‚ 3.4ï¼šé”™è¯¯ç»Ÿè®¡3.4.1ï¼šCircuitBreakerMetricsé€šè¿‡3.3çš„äº†è§£ï¼Œé—­åˆå’ŒåŠå¼€æ—¶çš„è¯·æ±‚çŠ¶æ€è®¡æ•°éƒ½æ˜¯é€šè¿‡CircuitBreakerMetricså¯¹è±¡æ¥å®Œæˆçš„ï¼Œç°åœ¨æ¥çœ‹ä¸‹è¿™ä¸ªç±»é‡Œéƒ½å¹²äº†äº›ä»€ä¹ˆï¼š ä»£ç å—1312345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485class CircuitBreakerMetrics implements CircuitBreaker.Metrics { //é€šè¿‡3.3çš„ä»£ç å—å¯çŸ¥ï¼Œè¯¥å€¼å°±æ˜¯é—­åˆæˆ–è€…åŠå¼€çŠ¶æ€ä¸‹è®¾ç½®çš„ringBufferSizeInClosedStateå’ŒringBufferSizeInHalfOpenState //è¡¨ç¤ºä¸€æ¬¡è¯·æ±‚çª—å£çš„å¤§å°ï¼Œæµ‹è¯•ç”¨ä¾‹ä¸­å°±æ˜¯é—­åˆæ—¶çš„100ä»¥åŠåŠå¼€æ—¶çš„10ï¼Œé€šè¿‡å›¾4å’Œä¸‹æ–¹çš„getFailureRateæ–¹æ³•å¯ä»¥çŸ¥é“ï¼Œ //è‡³å°‘è¦ç´¯è®¡å®Œæˆä¸€ä¸ªè¯·æ±‚çª—å£çš„è¯·æ±‚é‡åæ‰ä¼šå®é™…è®¡ç®—é”™è¯¯ç‡ private final int ringBufferSize; //å®é™…ç”¨æ¥è®°å½•ä¸€ä¸ªè¯·æ±‚çª—å£çš„è¯·æ±‚ç»Ÿè®¡æ•°æ®çš„ç»“æ„ï¼Œæœ¬èŠ‚ä¸æ·±ç©¶ï¼Œè¯¦ç»†å‚è€ƒ3.4.2 private final RingBitSet ringBitSet; //å…¨å¼€çŠ¶æ€ä¸‹ç´¯è®¡è¢«ç†”æ–­çš„è¯·æ±‚ä¸ªæ•°ï¼Œè§¦å‘ç‚¹å‚è€ƒå›¾6ä»¥åŠä»£ç å—11 private final LongAdder numberOfNotPermittedCalls; //æ„é€ å™¨1ï¼Œå‚è€ƒå›¾6ï¼Œåœ¨æœ€å¼€å§‹çš„é—­åˆçŠ¶æ€ä»¥åŠåç»­çš„åŠå¼€çŠ¶æ€ä¸‹åˆå§‹åŒ–Metricså¯¹è±¡ç”¨çš„å°±æ˜¯è¯¥æ„é€ å™¨ CircuitBreakerMetrics(int ringBufferSize) { this(ringBufferSize, null); } //å‚è€ƒå›¾6ï¼Œç”±åŠå¼€è½¬åˆ°é—­åˆæ€çš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡è¯¥æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–çš„ public CircuitBreakerMetrics copy(int targetRingBufferSize) { return new CircuitBreakerMetrics(targetRingBufferSize, this.ringBitSet); //è¿™é‡Œä¼šæŠŠå½“å‰Metricså¯¹è±¡é‡Œçš„ringBitSetä¼ é€’ä¸‹å» } //æ„é€ å™¨2 CircuitBreakerMetrics(int ringBufferSize, RingBitSet sourceSet) { this.ringBufferSize = ringBufferSize; if(sourceSet != null) { //é€šè¿‡copyåˆå§‹åŒ–ä¼šèµ°è¿™é‡Œï¼ˆæ¯æ¬¡çš„åŠå¼€æ€è½¬é—­åˆæ€ï¼‰ï¼Œå°†åŸæ¥Metricså¯¹è±¡é‡Œçš„ringBitSetä¼ é€’ä¸‹å»ï¼ˆç”¨æ¥åˆå§‹åŒ–æ–°çš„è¯·æ±‚çª—å£ï¼‰ this.ringBitSet = new RingBitSet(this.ringBufferSize, sourceSet); }else{ //écopyæ–°å»ºMetricså¯¹è±¡ï¼ˆæ¯æ¬¡çš„åŠå¼€æ€å’Œæœ€åˆçš„é—­åˆæ€ï¼‰ this.ringBitSet = new RingBitSet(this.ringBufferSize); } this.numberOfNotPermittedCalls = new LongAdder(); } //onErrorå’ŒonSuccessçš„è§¦å‘ç‚¹å‚è€ƒ3.3é‡Œçš„Stateç±» //å½“è¯·æ±‚å‘ç”Ÿé”™è¯¯æ—¶è§¦å‘è¯¥æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºè®°ä¸€æ¬¡å¤±è´¥ï¼Œç„¶åæŠŠå½“å‰é”™è¯¯ç‡è¿”å› float onError() { int currentNumberOfFailedCalls = ringBitSet.setNextBit(true); //é€šè¿‡ringBitSetçš„setNextBitç½®ä¸ºtrueï¼Œç®—ä½œä¸€ç¬”å¤±è´¥çš„è®°å½• return getFailureRate(currentNumberOfFailedCalls); } //å½“è¯·æ±‚æ­£å¸¸æ—¶è§¦å‘è¯¥æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºè®°ä¸€æ¬¡æˆåŠŸï¼Œç„¶åæŠŠå½“å‰é”™è¯¯ç‡è¿”å› float onSuccess() { int currentNumberOfFailedCalls = ringBitSet.setNextBit(false); //é€šè¿‡ringBitSetçš„setNextBitç½®ä¸ºfalseï¼Œç®—ä½œä¸€ç¬”æˆåŠŸçš„è®°å½• return getFailureRate(currentNumberOfFailedCalls); } //å…¨å¼€çŠ¶æ€ä¸‹ç´¯è®¡è¢«ç†”æ–­çš„è¯·æ±‚ä¸ªæ•° void onCallNotPermitted() { numberOfNotPermittedCalls.increment(); } //é€šè¿‡getFailureRateè®¡ç®—é”™è¯¯ç‡å¹¶è¿”å› @Override public float getFailureRate() { return getFailureRate(getNumberOfFailedCalls()); } //ä¸‹æ–¹æ³¨é‡Šä¸­çš„çª—å£å¤§å°å°±æ˜¯ringBufferSizeå±æ€§ //è¯¥æ–¹æ³•é€šè¿‡ringBitSetå¯¹è±¡è¿”å›å½“å‰è¯·æ±‚çª—å£å†…å‘ç”Ÿè¯·æ±‚çš„æ€»æ¬¡æ•°ï¼Œå¦‚æœè¾¾åˆ°äº†ringBufferSizeæ¬¡ï¼Œåˆ™è¿™ä¸ªå€¼å°±æ’ç­‰äºringBufferSize @Override public int getNumberOfBufferedCalls() { return this.ringBitSet.length(); } //è¯¥æ–¹æ³•é€šè¿‡ringBitSetå¯¹è±¡è¿”å›å½“å‰è¯·æ±‚çª—å£å†…å‘ç”Ÿé”™è¯¯çš„æ¬¡æ•° @Override public int getNumberOfFailedCalls() { return this.ringBitSet.cardinality(); } //é”™è¯¯ç‡è®¡ç®—æ–¹æ³• private float getFailureRate(int numberOfFailedCalls) { //è‹¥è¯·æ±‚è¿˜æ²¡æœ‰å®Œæˆä¸€ä¸ªè¯·æ±‚çª—å£ï¼Œåˆ™è¿”å›-1 if (getNumberOfBufferedCalls() &lt; ringBufferSize) { return -1.0f; } //å®Œæˆäº†ä¸€æ¬¡è¯·æ±‚çª—å£ï¼Œæ‰ä¼šçœŸæ­£è®¡ç®—é”™è¯¯ç‡ return numberOfFailedCalls * 100.0f / ringBufferSize; }} é€šè¿‡ä¸Šé¢çš„ä»£ç å¯ä»¥çŸ¥é“æœ€ç»ˆç»Ÿè®¡é”™è¯¯æ•°çš„æ˜¯åœ¨RingBitSetç»“æ„ä¸­ï¼Œä¸‹é¢æ¥ä»”ç»†äº†è§£ä¸‹è¿™ä¸ªç±»~ 3.4.2ï¼šä½å›¾&amp;BitSetModäº†è§£RingBitSetä¹‹å‰ï¼Œå…ˆæ¥äº†è§£ä¸€ç§æ•°æ®ç»“æ„-ä½å›¾ï¼Œå¦‚æœå·²ç»äº†è§£è¿‡ä½å›¾ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥å»çœ‹RingBitSetã€‚ RingBitSetæŒæœ‰ä¸€ä¸ªBitSetModå¯¹è±¡ï¼ŒBitSetModåŸºäºä½å›¾å®ç°ï¼Œä½å›¾æ˜¯æ€æ ·çš„ä¸€ç§ç»“æ„å‘¢ï¼Ÿå…ˆçœ‹ä¸‹å›¾7ï¼Œç„¶åå†å»è§£æå®ƒçš„æºç å®ç°ã€‚ é€šè¿‡ä¸Šå›¾å¯çŸ¥ï¼Œä½å›¾å°±æ˜¯åˆ©ç”¨æ•°ç»„å†…æ¯ä¸ªå…ƒç´ çš„bitä½å­˜å…¥ä¸€ä¸ªæ ‡è®°ï¼Œæ ‡è®°åªæœ‰å­˜åœ¨æˆ–è€…ä¸å­˜åœ¨ï¼ˆå¯¹åº”äºŒè¿›åˆ¶çš„0å’Œ1ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥åšåˆ°ç”¨ä¸€ä¸ªlongå‹çš„æ•°å­—å°±å¯ä»¥äº§ç”Ÿå‡º64ä¸ªæ ‡è®°ä¿¡æ¯ï¼Œéå¸¸é€‚åˆæ•°æ®é‡åºå¤§è€Œåˆ¤æ–­çŠ¶æ€å°‘çš„åº”ç”¨åœºæ™¯ï¼Œæ¯”å¦‚åˆ¤æ–­ä¸€ä¸ªè¯è¯­æ˜¯å¦æ˜¯å±è”½è¯ï¼Œé¦–å…ˆå±è”½è¯çŠ¶æ€åªæœ‰ä¸¤ç§ï¼šå‘½ä¸­orä¸å‘½ä¸­ï¼Œä½†æ˜¯å±è”½è¯å¯èƒ½æ˜¯ä¸ªéå¸¸åºå¤§çš„é›†åˆï¼Œå¦‚æœä¸€ä¸ªä¸ªæ‹¿æ¥æ¯”è¾ƒï¼Œæ•ˆç‡å®Œå…¨ä¿è¯ä¸äº†ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ•°æ®ç»“æ„æ¥è§£å†³è¿™ç±»é—®é¢˜ï¼Œå¯ä»¥é¦–å…ˆæŠŠæ‰€æœ‰çš„å±è”½è¯æ”¾åˆ°ä¸€ä¸ªä½å›¾ç»“æ„é‡Œï¼Œå¦‚æœæœ‰ç›¸åŒçš„è¯è¯­ï¼Œåªéœ€è¦ç®€å•çš„ä¸¤éƒ¨è¿ç®—å°±å¯ä»¥æ‹¿åˆ°æ˜¯å¦å‘½ä¸­ç»“æœï¼Œæ„å»ºè¿™ä¸ªä½å›¾ç»“æ„çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š é€šè¿‡ä¸Šå›¾ï¼Œå±è”½è¯ä½å›¾ç»“æ„å°±æ„å»ºå¥½äº†ï¼Œå¦‚æœæœ‰ä¸ªè¯è¯­éœ€è¦åˆ¤å®šæ˜¯å¦å‘½ä¸­å±è”½è¯ï¼Œåªéœ€è¦è®©è¿™ä¸ªè¯è¯­é€šè¿‡ä¸Šé¢çš„å“ˆå¸Œç®—æ³•è®¡ç®—å‡ºå“ˆå¸Œå€¼ï¼Œç„¶åæ‰¾åˆ°å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ï¼Œé€šè¿‡ä½è¿ç®—ç®—å‡ºå…¶æ‰€åœ¨ä½ç½®ï¼Œå°†è¯¥ä½ç½®çš„å€¼å–å‡ºï¼Œå¦‚æœæ˜¯0ï¼Œåˆ™è®¤ä¸ºæ²¡æœ‰å‘½ä¸­ï¼Œ1åˆ™è®¤ä¸ºå‘½ä¸­ã€‚ ä»¥ä¸Šå°±æ˜¯ä½å›¾ç»“æ„ï¼Œé€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œå¯ä»¥è®¤ä¸ºåŒä¸€ä¸ªå€¼ä¸€å®šå‘½ä¸­ä½å›¾é‡Œçš„åŒä¸€ä¸ªä½ç½®ï¼Œé‚£ä¹ˆæŠ½è±¡æˆç†”æ–­å™¨çš„é”™è¯¯ç‡ï¼Œé”™è¯¯çŠ¶æ€åªæœ‰0å’Œ1ï¼Œ1è¡¨ç¤ºé”™è¯¯ï¼Œ0è¡¨ç¤ºæ­£ç¡®ï¼Œç»™æ¯æ¬¡è¯·æ±‚ç¼–å·ï¼Œå½“æˆæ˜¯å›¾8ä¸­çš„å“ˆå¸Œå€¼ï¼Œç›¸åŒç¼–å·çš„è¯·æ±‚ä¸€å®šä¼šè½åˆ°åŒä¸€ä¸ªä½ç½®ï¼Œç°åœ¨ä¸ç†è§£æ²¡å…³ç³»ï¼Œè¿™ä¸ªè¦ç»“åˆRingBitSetä¸€èµ·çœ‹ï¼Œç›®å‰åªéœ€è¦ç†è§£ä½å›¾ç‰¹æ€§å³å¯ã€‚ Resilience4jé‡Œé€šè¿‡BitSetModç®€å•å®ç°äº†ä¸€ä¸ªä½å›¾ç»“æ„ï¼Œæ¥çœ‹ä¸‹ä»£ç ï¼ˆæ³¨ï¼šä»£ç é‡Œæœ‰å¤§é‡ä½è¿ç®—ï¼Œè¿‡ç¨‹è¯´æ˜éƒ½å†™åœ¨äº†æ³¨é‡Šé‡Œï¼‰ï¼š ä»£ç å—14123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125/** * ä¸‹æ–¹ä¸ºæºç æ³¨é‡Šâ†“â†“ * {@link io.github.resilience4j.circuitbreaker.internal.BitSetMod} is simplified version of {@link java.util.BitSet}. * It has no dynamic allocation, expanding logic, boundary checks * and it's set method returns previous bit state. */public class BitSetMod { /** * 1.æ­¤ç±»æ˜¯ä¸€ç§æ€æ ·çš„æ•°æ®ç»“æ„ï¼Ÿ * æ ¹æ®åŸæœ‰æ³¨é‡Šï¼Œå¯çŸ¥è¿™æ˜¯ä¸€ä¸ªç®€æ˜“ç‰ˆçš„BitSetï¼Œå³ä½å›¾ç»“æ„ï¼Œå¯ä»¥é€šè¿‡å›¾7æ›´ä¸ºç›´è§‚çš„äº†è§£ä¸‹è¯¥ç»“æ„ * ç”±å›¾7å¯çŸ¥ï¼Œä½å›¾åˆ†ä¸ºxï¼Œyè½´ï¼Œyè½´å°±æ˜¯æœ¬ç±»çš„longå‹çš„æ•°ç»„ï¼ˆwordsï¼‰ï¼Œå…¶ä¸­å†…éƒ¨æ¯ä¸€ä¸ªå…ƒç´ éƒ½åŒ…æ‹¬64ä¸ªbitï¼Œå› æ­¤bitä½æ¨ªå‘æ‰©å±•å°±æ˜¯xè½´ï¼ˆxè½´å¤§å°æ’ç­‰äº64ï¼‰ * å¦‚æœè¦æ ‡è®°ä¸€ä¸ªæ•°å­—æ˜¯å¦å­˜åœ¨äºå›¾ä¸­ï¼Œåªéœ€è¦å…ˆæ‰¾åˆ°æ‰€å±çš„yè½´ä½ç½®ï¼ˆå³å¯¹åº”çš„wordsä¸‹æ ‡ï¼‰ï¼Œç„¶åå†è®¡ç®—å‡ºå®ƒåº”è¯¥å‡ºç°çš„xè½´longå‹æ•°å­—ä¸­å“ªä¸ªbitä½ï¼Œ * ç„¶ååˆ¤æ–­è¯¥bitä½æ˜¯å¦å·²è¢«æ ‡è®°ä¸ºtrueï¼Œè‹¥æ˜¯ï¼Œåˆ™è¿”å›å·²å­˜åœ¨ï¼Œå¦åˆ™è¿”å›ä¸å­˜åœ¨ã€‚ * &lt;p&gt; * &lt;p&gt; * 2.ä½è¿ç®— * ç®€å•äº†è§£ä¸‹æœ¬ç±»ä¸­å‡ºç°çš„ä½è¿ç®—ï¼Œä»»æ„ä¸¤ä¸ªæ•°çš„ä¹˜æ³•æˆ–é™¤æ³•éƒ½å¯ä»¥ç”¨&lt;&lt;ï¼ˆå·¦ç§»ï¼‰æˆ–&gt;&gt;ï¼ˆå³ç§»ï¼‰æ¥è¡¨ç¤º * ä¾‹ï¼š * a * b == a &lt;&lt; log2(b) * a / b == a &gt;&gt; log2(b) * æœ¬ä¾‹ä¸­çš„ADDRESS_BITS_PER_WORDå±æ€§ï¼Œå…¶å®å°±æ˜¯longå‹ä½æ•°ä»¥2ä¸ºåº•çš„å¯¹æ•°ï¼Œå³log2(64) = 6 * é‚£ä¹ˆæ¥ä¸‹æ¥ä»£ç ä¸­é’ˆå¯¹ADDRESS_BITS_PER_WORDçš„ä½è¿ç®—å°±å¯ä»¥ç®€å•ç†è§£ä¸ºä¹˜ä»¥/é™¤ä»¥64äº† */ //longç±»å‹bitä½çš„å¯¹æ•°ï¼Œå³log2(64)ï¼6ï¼Œåˆ©ç”¨è¯¥å€¼å¯ä»¥è¿›è¡Œç®€å•çš„ä¹˜é™¤æ³•çš„ä½è¿ç®— private final static int ADDRESS_BITS_PER_WORD = 6; //æœ€ç»ˆå¯ä»¥å­˜æ”¾çš„æ€»ä½æ•°ï¼Œè®¡ç®—æ–¹å¼ï¼šwords.length * 64ï¼ˆæ¯ä¸ªlongå‹æœ‰64ä½ï¼Œåˆ©ç”¨æ•°ç»„é•¿åº¦ä¹˜ä»¥ä½æ•°ï¼Œå°±è®¡ç®—å‡ºäº†ä½å›¾çš„æ€»ä½æ•°ï¼‰ //ç”¨ä½è¿ç®—è¡¨ç¤ºä¸ºï¼šwords.length &lt;&lt; 6ï¼ˆå³ç§»è¡¨ç¤ºä¹˜æ³•ï¼Œå³ç§»6ä½è¡¨ç¤ºä¹˜ä»¥2^6ï¼Œå³words.length * 64ï¼‰ private final int size; //ä½å›¾æ•°ç»„ï¼Œlongå‹ï¼Œ64ä¸ªbitä½ private final long[] words; //æ„é€ å™¨ï¼Œä¼ å…¥ä½å›¾çš„å®¹é‡å¤§å° public BitSetMod(final int capacity) { //è®¡ç®—æ•°ç»„å¤§å°ï¼ˆå³yè½´å¤§å°ï¼‰ï¼Œæ ¹æ®ä¸Šé¢å¯¹ä½å›¾çš„åŸºæœ¬è§£é‡Šï¼Œå¯ä»¥çŸ¥é“ï¼Œyè½´æ˜¯ä¸€ä¸ªlongå‹æ•°ç»„ï¼Œ //è€Œæ¯æ¬¡ä¸€ä¸ªæ•°å­—è¿›æ¥ï¼Œä¼šé¦–å…ˆæ‰¾åˆ°yè½´æ‰€å±çš„ä½ç½®ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°ç»„å¾—å¤šå¤§æ‰åˆé€‚å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“xè½´å›ºå®šä¸º64ä¸ªï¼Œ //ä¹Ÿå°±æ˜¯è¯´æ­£å¸¸æƒ…å†µä¸‹ï¼Œä»»æ„æ•°å­—è¿›æ¥åéƒ½ä¼šè¢«åˆ†åˆ°æŸä¸ªyè½´å¯¹åº”çš„longå‹æ•°å­—é‡Œçš„æŸä¸€ä½ï¼Œé‚£ä¹ˆyè½´å¤§å°å°±å¾ˆå¥½æ¨ç®—äº†ï¼Œ //åˆ©ç”¨ç»™å‡ºçš„å®¹é‡å¤§å°ï¼ˆè¿™ä¸ªè¡¨ç¤ºä»»æ„æ•°æœ€å¤§æ—¶ä¸ºå¤šå¤§ï¼‰ï¼Œé™¤ä»¥64è¿›è¡Œå¹³å‡åˆ†ç»„ï¼Œè¿™æ ·ä¸ç®¡ä¼ çš„ä»»æ„æ•°ä¸ºå¤šå¤§ï¼Œå§‹ç»ˆéƒ½å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„[x,y]ï¼Œä¸”ä¸ä¼šè¶Šç•Œ int countOfWordsRequired = wordIndex(capacity - 1) + 1; //ä¸Šé¢è¯´è¿‡ï¼Œsizeå°±æ˜¯ä½å›¾é‡Œæ‰€æœ‰ä½æ•°ï¼Œå³x * yï¼Œä¹Ÿå°±æ˜¯words.length * 64ï¼Œç”¨ä½è¿ç®—è¡¨ç¤ºä¸ºï¼šwords.length &lt;&lt; 6 size = countOfWordsRequired &lt;&lt; ADDRESS_BITS_PER_WORD; //æœ€ç»ˆ((capacity - 1)/64)+1å°±æ˜¯yè½´æ•°ç»„å¤§å°ï¼Œåˆå§‹åŒ–æ•°ç»„å³å¯ words = new long[countOfWordsRequired]; //åˆ°è¿™é‡Œï¼Œä¸€ä¸ªä½å›¾å¯¹è±¡å°±è¢«æˆ‘ä»¬åˆ›å»ºå¥½äº†ï¼Œæ•°ç»„ï¼ˆyè½´ï¼‰æ˜¯å®ƒå®é™…çš„å®ä½“ï¼Œxè½´æ˜¯æ•°ç»„é‡Œlongå‹æ•°å­—çš„äºŒè¿›åˆ¶ä½ï¼ˆ64ï¼‰ } private static int wordIndex(int bitIndex) { //ä¸‹é¢è¿™ä¸ªä½è¿ç®—ç­‰åŒäºï¼šbitIndex/64 return bitIndex &gt;&gt; ADDRESS_BITS_PER_WORD; } //å¼€å§‹è®¾ç½®æ•°å­—ä¿¡æ¯ï¼ŒbitIndexä¸ºç›®æ ‡æ”¾ç½®ä½ç½®ï¼Œvalueä¸ºå€¼ï¼ˆ0æˆ–1ï¼‰ public int set(int bitIndex, boolean value) { // åˆ©ç”¨ä½ç½®æ•°å­—é™¤ä»¥64ï¼Œæ¨ç®—å‡ºå®ƒå¯¹åº”çš„yè½´ä¸‹æ ‡ int wordIndex = wordIndex(bitIndex); // æ³¨ï¼šä¸‹é¢çš„ä»£ç éƒ½æ˜¯ä½è¿ç®—ï¼Œå¼€å§‹å‰å…ˆæ¥äº†è§£ä¸€ä¸‹å¦‚ä½•å®šä½æŸä¸ªæ•°å­—çš„äºŒè¿›åˆ¶ç¬¬nä½ä¸Šçš„æ•°å­—æ˜¯0è¿˜æ˜¯1 // å°†1å³ç§»bitIndexä½ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªç±»ä¼¼1000000çš„äºŒè¿›åˆ¶æ•°å­—ï¼Œåˆ©ç”¨è¿™ä¸ªæ•°å­—è·ŸåŸæ¥çš„æ•°å­—æœ¬èº«åšä½ä¸è¿ç®—ï¼Œå¯ä»¥æ¨ç®—å‡ºåŸæ•°ç¬¬bitIndexä½ä¸Šçš„æ•°å­—æ˜¯1è¿˜æ˜¯0 // ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘æƒ³çŸ¥é“ä¸‹é¢è¿™ä¸ªäºŒè¿›åˆ¶æ•°å­—ä¸­ç¬¬5ä½çš„æ•°å­—æ˜¯0è¿˜æ˜¯1ï¼ˆè·Ÿåè¿›åˆ¶ä¸€æ ·ï¼Œä½æ•°æ˜¯ä»å³å¾€å·¦æ•°ï¼Œä½æ•°æœ€é«˜çš„åœ¨æœ€å·¦è¾¹ï¼Œä¸‹æ ‡ä»0å¼€å§‹ç®—èµ·ï¼‰ // å‡è®¾è¯¥äºŒè¿›åˆ¶æ•°ä¸ºÎ»ï¼Œè®¾ï¼šÎ»=101010101 // ç°åœ¨å°†1å³ç§»5ä½å¾—åˆ°bitMaskï¼Œå®ƒç”¨äºŒè¿›åˆ¶è¡¨ç¤ºä¸ºï¼š100000ï¼Œ1çš„ä½ç½®æ­£å¥½ä½äºç¬¬5ä½ï¼ˆä»å³å¾€å·¦ï¼Œä¸‹æ ‡ä»0ç®—èµ·ï¼‰ // åˆ©ç”¨Î»è·ŸbitMaskè¿›è¡Œä½ä¸è¿ç®—ï¼š // 101010101ï¼ˆÎ»ï¼‰ // &amp; // 000100000ï¼ˆbitMaskï¼‰ // ------------------ // 000000000ï¼ˆä½ä¸ç»“æœï¼‰ // ç”±è¿™ä¸ªè¿‡ç¨‹å¯ä»¥å‘ç°ï¼ŒÎ»çš„ç¬¬5ä½å¦‚æœæ˜¯0ï¼Œä½ä¸åçš„ç»“æœä¹Ÿæ˜¯0ï¼Œå¦‚æœæ˜¯1ï¼Œé‚£ä¹ˆä½ä¸è¿ç®—åçš„ç»“æœè‚¯å®šæ˜¯ä¸ç­‰äº0çš„ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨1å³ç§»çš„æ–¹å¼ï¼Œ // çŸ¥é“Î»çš„ç¬¬nä½æ˜¯0è¿˜æ˜¯1 // // é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œå¯ä»¥çŸ¥é“ï¼Œä»»æ„æ•°ä¸1å³ç§»åçš„æ•°å­—ï¼ˆbitMaskï¼‰è¿›è¡Œä½ä¸è¿ç®—çš„ç»“æœè¦ä¹ˆä¸ç­‰äº0ï¼Œè¦ä¹ˆç­‰äº0ï¼Œå› ä¸º1å³ç§»nä½åç”Ÿæˆçš„äºŒè¿›åˆ¶æ•°åœ¨å…¶nä½ä¸Šä¸€å®šä¸º1ï¼Œ // å…¶ä½™ä½ç½®ä¸€å®šä¸º0ï¼Œ0&amp;0ã€0&amp;1å‡ä¸º0ï¼Œæ‰€ä»¥æœ€åçš„ç»“æœè¦ä¹ˆæ˜¯000000000ï¼Œè¦ä¹ˆè¿˜ç­‰äº1å³ç§»åçš„é‚£ä¸ªæ•°ï¼š000010000ï¼Œè¿™å–å†³äºåŸå§‹æ•°å­—é‡Œç¬¬nä½ä¸Šæ˜¯å¦æ˜¯1ï¼Œ // å¦‚æœæ˜¯1ï¼Œåˆ™ç›¸ä¸åçš„ç»“æœå€¼ä¸€å®šä¸ç­‰äº0ï¼Œåä¹‹åˆ™ç­‰äº0 // ç»“åˆä¸Šé¢æ‰€æœ‰çš„æè¿°ï¼Œè¿™é‡Œå¯ä»¥å†æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆä½ä¸ä¼šç›¸äº’è¦†ç›–ï¼Ÿæ¯”å¦‚æˆ‘ä¼ äº†ä¸€ä¸ªbitIndexä¸º100ï¼Œlongå‹1&lt;&lt;100ç­‰ä»·äº1&lt;&lt;36ï¼ˆä»¥64ä¸ºæ¨¡è½®å›ï¼‰ï¼Œé‚£ä¹ˆå½“æˆ‘ä¼ 100çš„æ—¶å€™å²‚ä¸æ˜¯ä¼šè¦†ç›–æ‰ä¼ 36æ—¶é‚£æ¬¡åšæ ‡è®°ï¼Ÿ // è¿™ä¸ªé—®é¢˜ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œå› ä¸ºåœ¨æœ€åˆçš„æ—¶å€™å°±å·²ç»æŠŠbitIndexæŒ‰ç…§64ä¸ºå•ä½è¿›è¡Œç›¸é™¤è®¡ç®—å‡ºä¸‹æ ‡äº†ï¼Œä¹Ÿå°±æ˜¯è¯´bitIndexç­‰äº100é‚£æ¬¡ï¼Œè·ŸbitIndexç­‰äº36é‚£æ¬¡ï¼Œä¸åœ¨ä¸€ä¸ªä¸‹æ ‡é‡Œï¼ˆä¸åœ¨ä¸€ä¸ªæ¬¡å…ƒï¼‰ // æ ¹æ®è¿™äº›è§„åˆ™ï¼Œä¸‹é¢çš„ä»£ç å°±å¥½ç†è§£äº†ã€‚ long bitMask = 1L &lt;&lt; bitIndex; int previous = (words[wordIndex] &amp; bitMask) != 0 ? 1 : 0; //æŠŠè¯¥ä½ç½®ä¸Šå½“å‰çš„å€¼ï¼ˆ0æˆ–1ï¼‰èµ‹å€¼ç»™previousï¼ˆä¹Ÿå°±æ˜¯æœ€åè¿”å›å‡ºå»çš„ç»“æœï¼‰ if (value) { // é‡æ–°èµ‹å€¼ï¼Œæ³¨æ„ï¼Œè¿™é‡Œæ˜¯åŸå€¼è·ŸbitMaskè¿›è¡Œæˆ–è¿ç®—ï¼Œæ„å‘³ç€ç›®æ ‡ä½çš„å€¼ä¼šç›´æ¥å˜æˆ1ï¼Œå…¶ä½™ä½ç½®çš„å€¼å‡ä¸å˜ words[wordIndex] = words[wordIndex] | bitMask; // ç»“åˆä¾‹å­ï¼Œå‚è€ƒä¸‹é¢è¿™ä¸ªè¿‡ç¨‹æ›´å®¹æ˜“ç†è§£ // 101010101 // | // 000100000 // --------- // 101110101 } else { // valueç­‰äºfalseçš„æ—¶å€™ï¼ŒbitMaskå–ååè·ŸåŸå€¼è¿›è¡Œä¸è¿ç®—ï¼Œè·Ÿä¸Šé¢ç›¸åï¼Œè¿™æ˜¯æŠŠç›®æ ‡ä½å˜æˆ0 words[wordIndex] = words[wordIndex] &amp; ~bitMask; // ç»“åˆä¾‹å­ï¼Œå‚è€ƒä¸‹é¢è¿™ä¸ªè¿‡ç¨‹æ›´å®¹æ˜“ç†è§£ // 101010101 // &amp; // 111011111ï¼ˆbitMaskçš„åç ï¼‰ // --------- // 101010101 } return previous; } int size() { //è¿”å›ä½å›¾é‡Œçš„æ€»ä½æ•° return size; } boolean get(int bitIndex) { // æ³¨ï¼šå¦‚æœå¯¹ä¸‹æ–¹çš„å³ç§»ç­‰æ“ä½œè¿˜ä¸æ˜¯å¾ˆäº†è§£ï¼Œè¯·å…ˆçœ‹setæ–¹æ³•é‡Œçš„æ³¨é‡Š // é¦–å…ˆè¿˜æ˜¯åˆ©ç”¨ä½ç½®æ•°å­—é™¤ä»¥64ï¼Œæ¨ç®—å‡ºå®ƒå¯¹åº”çš„yè½´ä¸‹æ ‡ int wordIndex = wordIndex(bitIndex); //å¦‚æœseté‡Œçš„ä½è¿ç®—ç†è§£äº†ï¼Œä¸‹é¢è¿™ä¸ªå¾ˆå®¹æ˜“ç†è§£ï¼Œè¿™ä¸ªæµç¨‹è·Ÿsetæ–¹æ³•é‡Œè·å–previousä¸€æ · long bitMask = 1L &lt;&lt; bitIndex; return (words[wordIndex] &amp; bitMask) != 0; //å¤§äº0æ—¶è¿”å›trueï¼Œè¡¨ç¤ºç›®æ ‡ä½æ˜¯1ï¼Œå¦åˆ™è¿”å›falseï¼Œç›®æ ‡ä½æ˜¯0 }} ä¸Šé¢æ˜¯Resilience4jé’ˆå¯¹ä½å›¾çš„ç®€å•å®ç°ï¼Œå®ƒè´Ÿè´£å­˜å‚¨å•ä½è¯·æ±‚å†…çš„é”™è¯¯/æˆåŠŸæ ‡å¿—ã€‚ 3.4.3ï¼šRingBitSetä¹‹å‰è¯´è¿‡ï¼Œæœ€ç»ˆè¯·æ±‚è¢«æ”¾åˆ°äº†ä¸€ä¸ªç¯å½¢ç»“æ„é‡Œæ‰å¯¹ï¼Œæ²¿ç€ç¯æ‰§è¡Œä¸€å‘¨å°±æ˜¯ä¸€æ¬¡å•ä½è¯·æ±‚ï¼Œå›çœ‹ä¸‹å›¾4ï¼Œå…¶å®ç¬¬101æ¬¡è¯·æ±‚å°±æ˜¯é¡¶æ›¿æ‰ç¬¬ä¸€æ¬¡è¯·æ±‚çš„ç»“æœç½¢äº†ï¼Œç°åœ¨æŠŠå›¾4ä¸­ä»¥100ä¸ºè¯·æ±‚çª—å£å¼¯æ›²æˆä¸€ä¸ªç¯ï¼Œå‡å¦‚ç¬¬ä¸€æ¬¡è¯·æ±‚æ˜¯å¤±è´¥çš„ï¼Œç¬¬101æ¬¡è¯·æ±‚æ˜¯æˆåŠŸçš„ï¼ˆç»¿è‰²èƒŒæ™¯è¡¨ç¤ºæˆåŠŸçš„è¯·æ±‚ï¼Œçº¢è‰²èƒŒæ™¯è¡¨ç¤ºå¤±è´¥çš„è¯·æ±‚ï¼‰ï¼š å¦‚ä½•åˆ©ç”¨ä½å›¾ç»“æ„è®°å½•æ¯æ¬¡è¯·æ±‚çš„é”™è¯¯/æˆåŠŸæ ‡è®°ç„¶åå†å®ç°å›¾9é‡Œçš„ç¯å½¢ç»“æ„å‘¢ï¼ŸResilience4jé€šè¿‡RingBitSetæ¥å®ç°ï¼Œæ¥çœ‹ä¸‹å®ƒçš„ä»£ç ï¼š ä»£ç å—1512345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697public class RingBitSet { //å•ä½è¯·æ±‚æ•°ï¼Œæ ¹æ®Stateç±»åˆå§‹åŒ–RingSetæ—¶ç»™çš„sizeå€¼ï¼Œå¯ä»¥ç¡®å®šè¯¥å€¼å°±æ˜¯å„ç§ringBufferSize private final int size; //çœŸæ­£å­˜æ”¾é”™è¯¯ç‡çš„ä½å›¾ç»“æ„ private final BitSetMod bitSet; //åœ¨å®Œæˆä¸€ä¸ªè¯·æ±‚çª—å£åï¼Œè¯¥å€¼ä¸ºfalseï¼Œè¡¨ç¤ºè¯·æ±‚å·²æ»¡ä¸€æ¬¡è¯·æ±‚çª—å£ private boolean notFull; //ç»™è¯·æ±‚ç¼–å·ï¼Œæ–¹ä¾¿ä½å›¾è®¡ç®—ä½ç½® private int index = -1; //è¯·æ±‚æ•°é‡ï¼Œæœ€ç»ˆç­‰äºsize private volatile int length; //å½“å‰è¯·æ±‚çª—å£å†…çš„é”™è¯¯æ•°ï¼Œå°±æ˜¯åˆ©ç”¨è¿™ä¸ªæ•°å®æ—¶è®¡ç®—é”™è¯¯ç‡çš„ï¼ˆå‚è€ƒCircuitBreakerMetrics.getNumberOfFailedCallsï¼‰ private volatile int cardinality = 0; RingBitSet(int bitSetSize) { notFull = true; size = bitSetSize; bitSet = new BitSetMod(bitSetSize); } //æºå¸¦RingBitSetå‚æ•°çš„æ„é€ å™¨ä¼šæŠŠsourceSeté‡Œçš„ç»Ÿè®¡æ•°æ®èµ‹å€¼ç»™æ–°çš„RingBitSetï¼ˆç»§æ‰¿å…¶è¯·æ±‚æ•°ã€é”™è¯¯ç‡ç­‰ï¼‰ //è°ƒç”¨è¯¥æ„é€ å™¨çš„è§¦å‘ç‚¹åœ¨CircuitBreakerMetrics.copyä¸­è§¦å‘ï¼Œé€šè¿‡å›¾6å¯çŸ¥ï¼Œæ¯æ¬¡ç”±åŠå¼€çŠ¶æ€è½¬åˆ°é—­åˆçŠ¶æ€æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨copyæ–¹æ³•ï¼Œ //è®©æ–°çš„é—­åˆæ€ç»§æ‰¿ä¸Šæ¬¡åŠå¼€æ€çš„è¯·æ±‚é‡å’Œé”™è¯¯ç‡ï¼Œè¿™æ˜¯åˆç†çš„ï¼Œæ¯”è¾ƒå¹³æ»‘æ— æŸçš„è¿‡åº¦åˆ°é—­åˆæ€ã€‚ RingBitSet(int bitSetSize, RingBitSet sourceSet) { this(bitSetSize); int targetLength = Integer.min(bitSetSize, sourceSet.length); int sourceIndex = sourceSet.index; int forwardIndex = sourceSet.size - sourceIndex; for (int i = 0; i &lt; targetLength; i++) { this.setNextBit(sourceSet.bitSet.get(sourceIndex)); // looping sourceIndex backwards without conditional statements forwardIndex = (forwardIndex + 1) % sourceSet.size; sourceIndex = (sourceSet.size - forwardIndex) % sourceSet.size; } } //éå¸¸éå¸¸é‡è¦çš„æ–¹æ³•ï¼Œå®ƒçš„è§¦å‘ç‚¹åœ¨CircuitBreakerMetricsçš„onErrorå’ŒonSuccessï¼Œä¸»è¦ç”¨äºè®°å½•é”™è¯¯ç‡ public synchronized int setNextBit(boolean value) { increaseLength(); //ç¯å½¢ç»“æ„ä¾é è¿™é‡Œæ¥å®ç°ï¼Œindexæ°¸è¿œåœ¨0~sizeé—´å¾ªç¯ç´¯åŠ ï¼Œç±»ä¼¼ï¼š[0,1,2,3...99,0,1,2,3...99] index = (index + 1) % size; //åˆ©ç”¨ä½å›¾ï¼Œå°†æœ¬æ¬¡çš„é”™è¯¯/æˆåŠŸæ ‡è®°è®¾ç½®åˆ°å¯¹åº”indexçš„ä½ç½®ä¸Šï¼Œ //å¹¶ä¸”æ‹¿åˆ°å½“å‰indexå¯¹åº”ä¸Šæ¬¡è¯·æ±‚çª—å£ä¸­åŒæ ·ä¸ºindexä½ç½®çš„è¯·æ±‚ç»“æœpreviousï¼Œè‡³äºä¸ºå•¥è¦æ‹¿åˆ°è¿™ä¸ªå€¼ï¼Œå‚è€ƒä¸‹æ–¹çš„é€»è¾‘ int previous = bitSet.set(index, value); //æœ¬æ¬¡è¯·æ±‚ç»“æœ int current = value ? 1 : 0; //ä¸‹é¢è¿™ä¸€æ­¥å°±æ˜¯åˆ·æ–°é”™è¯¯æ•°çš„ï¼Œè®¡ç®—æ–¹å¼ä¸ºï¼šå‡å»åŒä½ç½®ä¸Šä¸ªè¯·æ±‚çª—å£çš„è¯·æ±‚ç»“æœï¼Œç„¶ååŠ ä¸Šè¿™æ¬¡çš„è¯·æ±‚ç»“æœ //ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾å•ä½è¯·æ±‚çª—å£æ˜¯100ï¼Œç¬¬ä¸€ä¸ªè¯·æ±‚çª—å£çš„ç¬¬ä¸€æ¬¡è¯·æ±‚é”™è¯¯ï¼Œindex=0çš„ä½ç½®è¢«æ ‡ä¸º1ï¼Œç¬¬101æ¬¡è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯ç¬¬äºŒä¸ªè¯·æ±‚çª—å£çš„ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œ //æ„å‘³ç€indexä»ç„¶ä¸º0ï¼Œé‚£ä¹ˆç¬¬101æ¬¡è¯·æ±‚çš„ç»“æœå°±ä¼šè¦†ç›–æ‰ç¬¬1æ¬¡è¯·æ±‚çš„é‚£ä¸ªç»“æœï¼Œä»¥æ­¤æ¥å®Œæˆçª—å£æ»šåŠ¨ï¼ˆå‚è€ƒå›¾9ï¼‰ cardinality = cardinality - previous + current; return cardinality; } //è¿”å›å½“å‰è¯·æ±‚çª—å£å†…çš„é”™è¯¯æ€»é‡ public int cardinality() { return cardinality; } public int size() { return bitSet.size(); } public int length() { return length; } @Override public String toString() { StringBuilder result = new StringBuilder(); for (int i = 0; i &lt; size; i++) { result.append(bitSet.get(i) ? '1' : '0'); } return result.toString(); } synchronized int getIndex() { return index; } //ç´¯åŠ å½“å‰è¯·æ±‚çª—å£å†…çš„è¯·æ±‚é‡ï¼Œå½“å®Œæˆä¸€æ¬¡å•ä½è¯·æ±‚çª—å£æ—¶ï¼Œlengthæ’ç­‰äºå•ä½è¯·æ±‚çª—å£å¤§å°ï¼ˆsizeï¼‰ private void increaseLength() { if (notFull) { int nextLength = length + 1; if (nextLength &lt; size) { length = nextLength; } else { length = size; notFull = false; } } }} å››ã€æ€»ç»“Resilience4jé€šè¿‡CircuitBreakerStateMachineæ¥ç‹¬ç«‹å‡ºä¸€ä¸ªç†”æ–­å™¨ï¼Œå…¶å†…éƒ¨æŒæœ‰ä¸€ä¸ªCircuitBreakerStateå¯¹è±¡çš„å¼•ç”¨ï¼Œåœ¨é”™è¯¯ç‡è¾¾åˆ°æŸä¸ªé˜ˆå€¼æ—¶ï¼Œä¼šå‘ç”ŸçŠ¶æ€åˆ‡æ¢ï¼ŒCircuitBreakerStateçš„å¼•ç”¨ä¼šæŒ‡å‘æ–°çš„çŠ¶æ€å¯¹è±¡ã€‚æ¯ä¸ªçŠ¶æ€å¯¹è±¡æŒæœ‰ä¸€ä¸ªCircuitBreakerMetricså¯¹è±¡ï¼Œç”¨äºåšå®æ—¶ç»Ÿè®¡å’Œé”™è¯¯ç‡ç›‘å¬ä½¿ç”¨ï¼ŒCircuitBreakerMetricså¯¹è±¡é€šè¿‡RingBitSetæ¥å®Œæˆå•ä½è¯·æ±‚çª—å£çš„é”™è¯¯ç‡ç»Ÿè®¡ï¼Œè¿™ä¸ªç»Ÿè®¡æ˜¯å®æ—¶çš„ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šè§¦å‘ä¸€æ¬¡é”™è¯¯ç‡çš„åˆ¤æ–­ã€‚RingBitSeté€šè¿‡Resilience4jè‡ªå·±å®ç°çš„ä¸€ä¸ªè½»é‡çº§çš„ä½å›¾ç»“æ„BitSetModæ¥æ ‡è®°è¯·æ±‚é”™è¯¯/æˆåŠŸï¼Œé¡ºä¾¿è¯´ä¸‹ï¼Œè¿™é‡Œé€šè¿‡RingBitSetæ¥ä¿è¯ç¯å½¢ç»“æ„ï¼Œè€Œä½å›¾åªè´Ÿè´£å­˜å‚¨è¯·æ±‚ç»“æœï¼Œé‚£ä¹ˆæ—¢ç„¶è¿™æ ·ï¼Œæˆ‘ç”¨æ™®é€šçš„æ•°ç»„æˆ–è€…å…¶ä»–çš„å¯ä»¥é€šè¿‡ä¸‹æ ‡è·å–æ•°å€¼çš„é›†åˆç»“æ„ä¹Ÿå¯ä»¥å®ç°å•Šï¼Œä¸ºä»€ä¹ˆä¸€å®šè¦ç”¨ä½å›¾å‘¢ï¼ŸçŒœæµ‹æ˜¯ä½å›¾æ—¢å¯ä»¥ä¿è¯è·Ÿæ•°ç»„ä¸€æ ·é«˜æ•ˆï¼Œéƒ½æ˜¯O(1)çš„å¤æ‚åº¦ï¼Œåˆå¯ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œæ¯”å¦‚æˆ‘çš„å•ä½è¯·æ±‚æ˜¯1wæ¬¡ï¼Œå¦‚æœæ˜¯æ•°ç»„ç»“æ„ï¼Œè™½ç„¶æ•ˆç‡è·Ÿä½å›¾ä¸€æ ·é«˜ï¼Œä½†æ˜¯æ•°ç»„å´éœ€è¦å­˜1wä¸ª0æˆ–1è¿™æ ·çš„æ•°ç»„ï¼Œå³ä¾¿ç”¨byteç±»å‹çš„æ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ éƒ½æµªè´¹äº†7ä¸ªbitä½ã€‚å…¶ä»–é›†åˆå°±æ›´ä¸ç”¨è¯´äº†ï¼Œæ•ˆç‡æ— æ³•ä¿è¯ï¼Œå…¶æ¬¡ä»–ä»¬æµªè´¹çš„å†…å­˜æ¯”å•çº¯æ•°ç»„è¦é«˜ï¼Œæ‰€ä»¥ï¼Œç±»ä¼¼è¿™ç§åªæœ‰trueæˆ–falseçš„æ•°æ®çš„å­˜å‚¨ï¼Œä½å›¾å†é€‚åˆä¸è¿‡äº†ã€‚ æ„Ÿè§‰æœ‰äº›åœ°æ–¹è¯´çš„ä¸å¤ªæ¸…æ™°ï¼Œå¾…åç»­æ”¹è¿›æè¿°æ–¹å¼ã€‚","link":"/2019/12/10/Resilience4j%E7%86%94%E6%96%AD%E5%99%A8-%E4%BD%BF%E7%94%A8%E4%B8%8E%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"},{"title":"å·¥ä½œä¸­æœ‰å…³åˆ†å¸ƒå¼ç¼“å­˜çš„ä½¿ç”¨å’Œéœ€è¦æ³¨æ„çš„é—®é¢˜æ¢³ç†","text":"ç›®å‰å·¥ä½œä¸­ç”¨åˆ°çš„åˆ†å¸ƒå¼ç¼“å­˜æŠ€æœ¯æœ‰rediså’Œmemcachedä¸¤ç§ï¼Œç¼“å­˜çš„ç›®çš„æ˜¯ä¸ºäº†åœ¨é«˜å¹¶å‘ç³»ç»Ÿä¸­æœ‰æ•ˆé™ä½DBçš„å‹åŠ›ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨çš„æ—¶å€™å¯èƒ½ä¼šå› ä¸ºç¼“å­˜ç»“æ„è®¾è®¡ä¸å½“é€ æˆä¸€äº›é—®é¢˜ï¼Œè¿™é‡Œä¼šæŠŠå¯èƒ½é‡åˆ°çš„å‘æ•´ç†å‡ºæ¥ï¼Œæ–¹ä¾¿æ—¥åæŸ¥æ‰¾ã€‚ ä¸€ã€å¸¸ç”¨çš„ä¸¤ç§ç¼“å­˜æŠ€æœ¯çš„æœåŠ¡ç«¯ç‰¹ç‚¹1.1ï¼šMemcacheæœåŠ¡ç«¯Memcacheï¼ˆä¸‹é¢ç®€ç§°mcï¼‰æœåŠ¡ç«¯æ˜¯æ²¡æœ‰é›†ç¾¤æ¦‚å¿µçš„ï¼Œæ‰€æœ‰çš„å­˜å‚¨åˆ†å‘å…¨éƒ¨äº¤ç”±mc clientå»åšï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯xmemcachedï¼Œè¿™ä¸ªå®¢æˆ·ç«¯æ”¯æŒå¤šç§å“ˆå¸Œç­–ç•¥ï¼Œé»˜è®¤ä½¿ç”¨keyä¸å®ä¾‹æ•°å–æ¨¡æ¥è¿›è¡Œç®€å•çš„æ•°æ®åˆ†ç‰‡ï¼Œè¿™ç§åˆ†ç‰‡æ–¹å¼ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯æ–°å¢æˆ–è€…å‡å°‘èŠ‚ç‚¹åä¼šåœ¨ä¸€ç¬é—´å¯¼è‡´å¤§é‡keyå¤±æ•ˆï¼Œæœ€ç»ˆå¯¼è‡´ç¼“å­˜é›ªå´©çš„å‘ç”Ÿï¼Œç»™DBå¸¦æ¥å·¨å¤§å‹åŠ›ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„mc clientå¯ç”¨äº†xmemcachedçš„ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ¥è¿›è¡Œæ•°æ®åˆ†ç‰‡ï¼š ä»£ç å—11234567XMemcachedClientBuilder builder = new XMemcachedClientBuilder(AddrUtil.getAddresses(servers));builder.setOpTimeout(opTimeout);builder.setConnectTimeout(connectTimeout);builder.setTranscoder(transcoder);builder.setConnectionPoolSize(connectPoolSize);builder.setKeyProvider(keyProvider);builder.setSessionLocator(new KetamaMemcachedSessionLocator()); //å¯ç”¨ketamaä¸€è‡´æ€§å“ˆå¸Œç®—æ³•è¿›è¡Œæ•°æ®åˆ†ç‰‡ æ ¹æ®ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„ç‰¹æ€§ï¼Œåœ¨æ–°å¢æˆ–å‡å°‘mcçš„èŠ‚ç‚¹åªä¼šå½±å“è¾ƒå°‘ä¸€éƒ¨åˆ†çš„æ•°æ®ã€‚ä½†è¿™ç§æ¨¡å¼ä¸‹ä¹Ÿæ„å‘³ç€åˆ†é…ä¸å‡åŒ€ï¼Œæ–°å¢çš„èŠ‚ç‚¹å¯èƒ½å¹¶ä¸èƒ½åŠæ—¶è¾¾åˆ°å‡æ‘Šæ•°æ®çš„æ•ˆæœï¼Œä¸è¿‡mcé‡‡ç”¨äº†è™šæ‹ŸèŠ‚ç‚¹çš„æ–¹å¼æ¥ä¼˜åŒ–åŸå§‹ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼ˆç”±ketamaç®—æ³•æ§åˆ¶å®ç°ï¼‰ï¼Œå®ç°äº†æ–°å¢ç‰©ç†èŠ‚ç‚¹åä¹Ÿå¯ä»¥å‡æ‘Šæ•°æ®çš„èƒ½åŠ›ã€‚ æœ€åï¼ŒmcæœåŠ¡ç«¯æ˜¯å¤šçº¿ç¨‹å¤„ç†æ¨¡å¼ï¼Œmcä¸€ä¸ªvalueæœ€å¤§åªèƒ½å­˜å‚¨1Mçš„æ•°æ®ï¼Œæ‰€æœ‰çš„k-vè¿‡æœŸåä¸ä¼šè‡ªåŠ¨ç§»é™¤ï¼Œè€Œæ˜¯ä¸‹æ¬¡è®¿é—®æ—¶ä¸å½“å‰æ—¶é—´åšå¯¹æ¯”ï¼Œè¿‡æœŸæ—¶é—´å°äºå½“å‰æ—¶é—´åˆ™åˆ é™¤ï¼Œå¦‚æœä¸€ä¸ªk-väº§ç”Ÿåå°±æ²¡æœ‰å†æ¬¡è®¿é—®äº†ï¼Œé‚£ä¹ˆæ•°æ®å°†ä¼šä¸€ç›´å­˜åœ¨åœ¨å†…å­˜ä¸­ï¼Œç›´åˆ°è§¦å‘LRUã€‚ 1.2ï¼šRedisæœåŠ¡ç«¯redisæœåŠ¡ç«¯æœ‰é›†ç¾¤æ¨¡å¼ï¼Œkeyçš„è·¯ç”±äº¤ç”±redisæœåŠ¡ç«¯åšå¤„ç†ï¼Œé™¤æ­¤ä¹‹å¤–redisæœ‰ä¸»ä»é…ç½®ä»¥è¾¾åˆ°æœåŠ¡é«˜å¯ç”¨ã€‚ redisæœåŠ¡ç«¯æ˜¯å•çº¿ç¨‹å¤„ç†æ¨¡å¼ï¼Œè¿™æ„å‘³ç€å¦‚æœæœ‰ä¸€ä¸ªæŒ‡ä»¤å¯¼è‡´rediså¤„ç†è¿‡æ…¢ï¼Œä¼šé˜»å¡å…¶ä»–æŒ‡ä»¤çš„å“åº”ï¼Œæ‰€ä»¥redisç¦æ­¢åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨é‡é‡çº§æ“ä½œï¼ˆä¾‹å¦‚keysï¼Œå†ä¾‹å¦‚ç¼“å­˜è¾ƒå¤§çš„å€¼å¯¼è‡´ä¼ è¾“è¿‡æ…¢ï¼‰ redisæœåŠ¡ç«¯å¹¶æ²¡æœ‰é‡‡ç”¨ä¸€è‡´æ€§å“ˆå¸Œæ¥åšæ•°æ®åˆ†ç‰‡ï¼Œè€Œæ˜¯é‡‡ç”¨äº†å“ˆå¸Œæ§½çš„æ¦‚å¿µæ¥åšæ•°æ®åˆ†ç‰‡ï¼Œä¸€ä¸ªredis clusteræ•´ä½“æ‹¥æœ‰16384ä¸ªå“ˆå¸Œæ§½ï¼ˆslotï¼‰ï¼Œè¿™äº›å“ˆå¸Œæ§½æŒ‰ç…§ç¼–å·åŒºé—´çš„ä¸åŒï¼Œåˆ†å¸ƒåœ¨ä¸åŒèŠ‚ç‚¹ä¸Šï¼Œç„¶åä¸€ä¸ªkeyè¿›æ¥ï¼Œé€šè¿‡å†…éƒ¨å“ˆå¸Œç®—æ³•ï¼ˆCRC16(key)ï¼‰è®¡ç®—å‡ºæ§½ä½ç½®ï¼Œç„¶åå°†æ•°æ®å­˜æ”¾è¿›å¯¹åº”çš„å“ˆå¸Œæ§½å¯¹åº”çš„ç©ºé—´ï¼Œredisåœ¨æ–°å¢æˆ–è€…å‡å°‘èŠ‚ç‚¹æ—¶ï¼Œå…¶å®å°±æ˜¯å¯¹è¿™äº›å“ˆå¸Œæ§½è¿›è¡Œé‡æ–°åˆ†é…ï¼Œä»¥æ–°å¢èŠ‚ç‚¹ä¸ºä¾‹ï¼Œæ–°å¢èŠ‚ç‚¹æ„å‘³ç€åŸå…ˆèŠ‚ç‚¹ä¸Šçš„å“ˆå¸Œæ§½åŒºé—´ä¼šç›¸å¯¹ç¼©å°ï¼Œè¢«å‡å»çš„é‚£äº›å“ˆå¸Œæ§½é‡Œçš„æ•°æ®å°†ä¼šé¡ºå»¶è‡³ä¸‹ä¸€ä¸ªå¯¹åº”èŠ‚ç‚¹ï¼Œè¿™ä¸ªè¿‡ç¨‹ç”±redisæœåŠ¡ç«¯åè°ƒå®Œæˆï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š è¿ç§»è¿‡ç¨‹æ˜¯ä»¥æ§½ä¸ºå•ä½ï¼Œå°†æ§½å†…çš„keyæŒ‰æ‰¹æ¬¡è¿›è¡Œè¿ç§»çš„ï¼ˆmigrateï¼‰ã€‚ æœ‰å…³å“ˆå¸Œæ§½å’Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„å¯¹æ¯”å‚è€ƒï¼šä¸€è‡´æ€§å“ˆå¸Œå’Œå“ˆå¸Œæ§½å¯¹æ¯” äºŒã€é€‰å‹é—®é¢˜2.1ï¼šç¼“å­˜ç»“æ„åŒ–é€‰å‹mcæä¾›ç®€å•çš„k-vå­˜å‚¨ï¼Œvalueæœ€å¤§å¯ä»¥å­˜å‚¨1Mçš„æ•°æ®ï¼Œå¤šçº¿ç¨‹å¤„ç†æ¨¡å¼ï¼Œä¸ä¼šå‡ºç°å› ä¸ºæŸæ¬¡å¤„ç†æ…¢è€Œå¯¼è‡´å…¶ä»–è¯·æ±‚æ’é˜Ÿç­‰å¾…çš„æƒ…å†µï¼Œé€‚åˆå­˜å‚¨æ•°æ®çš„æ–‡æœ¬ä¿¡æ¯ã€‚ redisæä¾›ä¸°å¯Œçš„æ•°æ®ç»“æ„ï¼ŒæœåŠ¡ç«¯æ˜¯å•çº¿ç¨‹å¤„ç†æ¨¡å¼ï¼Œè™½ç„¶å¤„ç†é€Ÿåº¦å¾ˆå¿«ï¼Œä½†æ˜¯å¦‚æœæœ‰ä¸€æ¬¡æŸ¥è¯¢å‡ºç°ç“¶é¢ˆï¼Œé‚£ä¹ˆåç»­çš„æ“ä½œå°†è¢«é˜»å¡ï¼Œæ‰€ä»¥ç›¸æ¯”k-vè¿™ç§å¯èƒ½å› ä¸ºæ•°æ®è¿‡å¤§è€Œå¯¼è‡´ç½‘ç»œäº¤äº’äº§ç”Ÿç“¶é¢ˆçš„ç»“æ„æ¥è¯´ï¼Œå®ƒæ›´é€‚åˆå¤„ç†ä¸€äº›æ•°æ®ç»“æ„çš„æŸ¥è¯¢ã€æ’åºã€åˆ†é¡µç­‰æ“ä½œï¼Œè¿™äº›æ“ä½œå¾€å¾€å¤æ‚åº¦ä¸é«˜ï¼Œä¸”è€—æ—¶æçŸ­ï¼Œå› æ­¤ä¸å¤ªå¯èƒ½ä¼šé˜»å¡redisçš„å¤„ç†ã€‚ ä½¿ç”¨è¿™ä¸¤ç§ç¼“å­˜æœåŠ¡æ¥æ„å»ºæˆ‘ä»¬çš„ç¼“å­˜æ•°æ®ï¼Œç›®å‰æå€¡æ‰€æœ‰æ•°æ®æŒ‰ç…§æ ‡å¿—æ€§å­—æ®µï¼ˆä¾‹å¦‚idï¼‰ç»„æˆè‡ªå·±çš„ä¿¡æ¯ç¼“å­˜å­˜å‚¨ï¼Œè¿™ä¸ªä¸€èˆ¬ç”±mcçš„k-vç»“æ„æ¥å®Œæˆå­˜å‚¨ã€‚è€Œredisæä¾›äº†å¾ˆå¤šå¥½ç”¨çš„æ•°æ®ç»“æ„ï¼Œä¸€èˆ¬æ„å»ºç»“æ„åŒ–çš„ç¼“å­˜æ•°æ®éƒ½ä½¿ç”¨redisçš„æ•°æ®ç»“æ„æ¥ä¿å­˜æ•°æ®çš„åŸºæœ¬ç»“æ„ï¼Œç„¶åç»„è£…æ•°æ®æ—¶æ ¹æ®redisé‡Œç¼“å­˜çš„æ ‡å¿—æ€§å­—æ®µå»mcé‡ŒæŸ¥è¯¢å…·ä½“æ•°æ®ï¼Œä¾‹å¦‚ä¸€ä¸ªæ’è¡Œæ¦œæ¥å£çš„è·å–ï¼š ä¸Šå›¾redisæä¾›æ’è¡Œæ¦œçš„ç»“æ„å­˜å‚¨ï¼Œæ’è¡Œæ¦œé‡Œå­˜å‚¨çš„æ˜¯idå’Œscoreï¼Œé€šè¿‡rediså¯ä»¥è·å–åˆ°ç»“æ„å†…æ‰€æœ‰ä¿¡æ¯çš„idï¼Œç„¶ååˆ©ç”¨è·å¾—çš„idå¯ä»¥ä»mcä¸­æŸ¥å‡ºè¯¦ç»†ä¿¡æ¯ï¼Œredisåœ¨è¿™ä¸ªè¿‡ç¨‹è´Ÿè´£åˆ†é¡µã€æ’åºï¼Œmcåˆ™è´Ÿè´£å­˜å‚¨è¯¦ç»†ä¿¡æ¯ã€‚ ä¸Šé¢æ˜¯æ¯”è¾ƒåˆé€‚çš„ç¼“å­˜åšæ³•ï¼Œå»ºè®®æ¯æ¡æ•°æ®éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„åŸºæœ¬ç¼“å­˜æ•°æ®ï¼Œè¿™æ ·ä¾¿äºç®¡ç†ï¼Œè€Œä¸æ˜¯æŠŠä¸€ä¸ªæ¥å£çš„å·¨å¤§ç»“æ„å®Œå…¨ç¼“å­˜åˆ°mcæˆ–è€…redisé‡Œï¼Œè¿™æ ·åˆ’åˆ†å¤ªç²—ï¼Œæ—¥ç§¯æœˆç´¯ä¸‹æ¥æ¯ä¸ªæ¥å£æˆ–è€…å·¨å¤§æ–¹æ³•éƒ½æœ‰ä¸€ä¸ªç¼“å­˜ï¼Œkeyä¼šè¶Šæ¥è¶Šå¤šï¼Œè¶Šæ¥è¶Šæ‚ã€‚ 2.2ï¼šRedisçš„æ•°æ®ç»“æ„å¸¸ç”¨æ“ä½œå’Œæ—¶é—´å¤æ‚åº¦ï¼šRedisåŸºç¡€ã€å¸¸ç”¨ç±»å‹ä»‹ç»ã€æ—¶é—´å¤æ‚åº¦ ç‰¹æ®Šç»“æ„BitMapï¼šRedisä¸­BitMapä½¿ç”¨ BitMapé€‚ç”¨äºå®ç°ç”¨æˆ·ç­¾åˆ°ã€åœ¨çº¿çŠ¶æ€ç­‰åŠŸèƒ½ï¼Œç©ºé—´å æœ‰é‡æä½ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥ç”¨å®ƒæ¥å®ç°ä¸€ä¸ªBloomFilterã€‚ åœ¨ä½¿ç”¨redisæ—¶ï¼Œå¯¹äºæ—¶é—´å¤æ‚åº¦éO(1)çš„æ“ä½œéƒ½éœ€è¦æ¨ç®—ç°æœ‰çš„æ•°æ®é‡æ˜¯å¦å¯èƒ½å¯¼è‡´redisé˜»å¡ï¼ˆåˆ†é¡µæ“ä½œä¸€èˆ¬ä¸ä¼šå‘½ä¸­è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºå•é¡µä¸ªæ•°æœ‰é™ï¼Œå‡ºé—®é¢˜è¾ƒå¤šçš„ä¸€èˆ¬éƒ½æ˜¯å…¨é‡è¾“å‡ºå¤§åˆ—è¡¨å¯¼è‡´çš„ï¼Œç”Ÿäº§ç¯å¢ƒåº”é¿å…å…¨é‡æ“ä½œï¼‰ã€‚ 2.3ï¼šRedisæ„é€ å¤§ç´¢å¼•å›æºé—®é¢˜Rediså¦‚æœåšç¼“å­˜ä½¿ç”¨ï¼Œå§‹ç»ˆä¼šæœ‰è¿‡æœŸæ—¶é—´å­˜åœ¨ï¼Œå¦‚æœåˆ°äº†è¿‡æœŸæ—¶é—´ï¼Œä½¿ç”¨redisæ„å»ºçš„ç´¢å¼•å°†ä¼šæ¶ˆå¤±ï¼Œè¿™ä¸ªæ—¶å€™å›æºï¼Œå¦‚æœå­˜åœ¨å¤§æ‰¹é‡çš„æ•°æ®éœ€è¦æ„å»ºredisç´¢å¼•ï¼Œå°±ä¼šå­˜åœ¨å›æºæ–¹æ³•è¿‡æ…¢çš„é—®é¢˜ï¼Œè¿™é‡Œä»¥æŸä¸ªè¯„è®ºç³»ç»Ÿä¸ºä¾‹ï¼š è¯„è®ºç³»ç»Ÿé‡‡ç”¨æœ‰åºé›†åˆä½œä¸ºè¯„è®ºåˆ—è¡¨çš„ç´¢å¼•ï¼Œå­˜å‚¨çš„æ˜¯è¯„è®ºidï¼Œç”¨äºæ’åºçš„scoreå€¼åˆ™æŒ‰ç…§æ’åºç»´åº¦æ‹†åˆ†ï¼Œæ¯”å¦‚å‘å¸ƒæ—¶é—´ã€ç‚¹èµæ•°ç­‰ï¼Œè¿™ä¹Ÿæ„å‘³ç€ä¸€ä¸ªèµ„æºä¸‹çš„è¯„è®ºåˆ—è¡¨æ ¹æ®æ’åºç»´åº¦ä¸åŒå­˜åœ¨ç€å¤šä¸ªredisç´¢å¼•åˆ—è¡¨ï¼Œè€Œå…·ä½“è¯„è®ºå†…å®¹å­˜mcï¼Œæ­£å¸¸æƒ…å†µä¸‹ç»“æ„å¦‚ä¸‹ï¼š ä¸Šé¢æ˜¯æ­£å¸¸è§¦å‘ä¸€ä¸ªèµ„æºçš„è¯„è®ºåŒºï¼Œæ¯æ¬¡è§¦å‘è¯»ç¼“å­˜ï¼Œéƒ½ä¼šé¡ºå¸¦å»¶é•¿ä¸€æ¬¡ç¼“å­˜çš„è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·å¯ä»¥ä¿è¯è¾ƒçƒ­çš„å†…å®¹ä¸ä¼šè½»æ˜“è¿‡æœŸï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªè¯„è®ºåŒºæ—¶é—´è¿‡é•¿æ²¡äººè®¿é—®è¿‡ï¼Œredisç´¢å¼•å°±ä¼šè¿‡æœŸï¼Œå¦‚æœä¸€ä¸ªè¯„è®ºåŒºæœ‰æ•°ä¸‡æ¡è¯„è®ºæ•°æ®ï¼Œé•¿æ—¶é—´æ²¡äººè®¿é—®ï¼Œçªç„¶æœ‰äººè¿‡å»è€ƒå¤ï¼Œé‚£ä¹ˆåœ¨å›æºæ„å»ºredisç´¢å¼•æ—¶ä¼šå¾ˆç¼“æ…¢ï¼Œå¦‚æœæ²¡æœ‰æ§åˆ¶æªæ–½ï¼Œè¿˜ä¼šé€ æˆä¸‹é¢ç¼“å­˜ç©¿é€çš„é—®é¢˜ï¼Œä»è€Œå¯¼è‡´è¿™ç§é‡é‡çº§æ“ä½œåå¤è¢«å¤šä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œå¯¹DBé€ æˆå·¨å¤§å‹åŠ›ã€‚ å¯¹äºä¸Šé¢è¿™ç§å›æºæ„å»ºç´¢å¼•ç¼“æ…¢çš„é—®é¢˜ï¼Œå¤„ç†æ–¹å¼å¯ä»¥æ˜¯ä¸‹é¢è¿™æ ·ï¼š ç›¸æ¯”ç›´æ¥æ‰§è¡Œå›æºæ–¹æ³•ï¼Œè¿™ç§é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—æ„é€ redisç´¢å¼•çš„æ–¹æ³•æ›´åŠ é€‚åˆï¼Œé¦–å…ˆä»…æ„å»ºå•é¡µæˆ–è€…å‰é¢å‡ é¡µçš„ç´¢å¼•æ•°æ®ï¼Œç„¶åé€šè¿‡é˜Ÿåˆ—é€šçŸ¥jobï¼ˆè¿™é‡Œå¯ä»¥ç†è§£ä¸ºæ¶ˆè´¹è€…ï¼‰è¿›è¡Œå®Œæ•´ç´¢å¼•æ„é€ ï¼Œå½“ç„¶ï¼Œè¿™åªé€‚åˆå¯¹ä¸€è‡´æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯ã€‚ ä¸‰ã€ä¸€è‡´æ€§é—®é¢˜ä¸€èˆ¬æƒ…å†µä¸‹ç¼“å­˜å†…çš„æ•°æ®è¦å’Œæ•°æ®åº“æºæ•°æ®ä¿æŒä¸€è‡´æ€§ï¼Œè¿™å°±æ¶‰åŠåˆ°æ›´æ–°DBåä¸»åŠ¨å¤±æ•ˆç¼“å­˜ç­–ç•¥ï¼ˆé€šä¿—å«æ³•ï¼šæ¸…ç¼“å­˜ï¼‰ï¼Œå¤§éƒ¨åˆ†ä¼šç»è¿‡å¦‚ä¸‹è¿‡ç¨‹ï¼š å‡å¦‚ç°åœ¨æœ‰ä¸¤ä¸ªæœåŠ¡ï¼ŒæœåŠ¡Aå’ŒæœåŠ¡Bï¼Œç°åœ¨å‡è®¾æœåŠ¡Aä¼šè§¦å‘æŸä¸ªæ•°æ®çš„å†™æ“ä½œï¼Œè€ŒæœåŠ¡Båˆ™æ˜¯åªè¯»ç¨‹åºï¼Œæ•°æ®è¢«ç¼“å­˜åœ¨ä¸€ä¸ªCacheæœåŠ¡å†…ï¼Œç°åœ¨å‡å¦‚æœåŠ¡Aæ›´æ–°äº†ä¸€æ¬¡æ•°æ®åº“ï¼Œé‚£ä¹ˆç»“åˆä¸Šå›¾å¾—å‡ºä»¥ä¸‹æµç¨‹ï¼š æœåŠ¡Aè§¦å‘æ›´æ–°æ•°æ®åº“çš„æ“ä½œ æ›´æ–°å®Œæˆååˆ é™¤æ•°æ®å¯¹åº”çš„ç¼“å­˜key åªè¯»æœåŠ¡ï¼ˆæœåŠ¡Bï¼‰è¯»å–ç¼“å­˜æ—¶å‘ç°ç¼“å­˜miss æœåŠ¡Bè¯»å–æ•°æ®åº“æºä¿¡æ¯ å†™å…¥ç¼“å­˜å¹¶è¿”å›å¯¹åº”ä¿¡æ¯ è¿™ä¸ªè¿‡ç¨‹ä¹ä¸€çœ‹æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜çš„ï¼Œä½†æ˜¯å¾€å¾€å¤šçº¿ç¨‹è¿è½¬çš„ç¨‹åºä¼šå¯¼è‡´æ„æƒ³ä¸åˆ°çš„ç»“æœï¼Œç°åœ¨æ¥æƒ³è±¡ä¸‹æœåŠ¡Aå’ŒæœåŠ¡Bè¢«å¤šä¸ªçº¿ç¨‹è¿è¡Œç€ï¼Œè¿™ä¸ªæ—¶å€™é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œå°±ä¼šå­˜åœ¨ä¸€è‡´æ€§é—®é¢˜ï¼š 3.1ï¼šå¹¶å‘è¯»å†™å¯¼è‡´çš„ä¸€è‡´æ€§é—®é¢˜ è¿è¡Œç€æœåŠ¡Açš„çº¿ç¨‹1é¦–å…ˆä¿®æ”¹æ•°æ®ï¼Œç„¶ååˆ é™¤ç¼“å­˜ è¿è¡Œç€æœåŠ¡Bçš„çº¿ç¨‹3è¯»ç¼“å­˜æ—¶å‘ç°ç¼“å­˜missï¼Œå¼€å§‹è¯»å–DBä¸­çš„æºæ•°æ®ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™æ¬¡è¯»å‡ºæ¥çš„æ•°æ®æ˜¯çº¿ç¨‹1ä¿®æ”¹åçš„é‚£ä»½ è¿™ä¸ªæ—¶å€™è¿è¡Œç€æœåŠ¡Açš„çº¿ç¨‹2ä¸Šçº¿ï¼Œå¼€å§‹ä¿®æ”¹æ•°æ®åº“ï¼ŒåŒæ ·çš„ï¼Œåˆ é™¤ç¼“å­˜ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™æ¬¡åˆ é™¤çš„å…¶å®æ˜¯ä¸€ä¸ªç©ºç¼“å­˜ï¼Œæ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºæœ¬æ¥çº¿ç¨‹3é‚£è¾¹è¿˜æ²¡æœ‰å›æºå®Œæˆ è¿è¡Œç€æœåŠ¡Bçš„çº¿ç¨‹3å°†è¯»åˆ°çš„ç”±çº¿ç¨‹1å†™çš„é‚£ä»½æ•°æ®å›å†™è¿›Cache ä¸Šè¿°è¿‡ç¨‹å®Œæˆåï¼Œæœ€ç»ˆç»“æœå°±æ˜¯DBé‡Œä¿å­˜çš„æœ€ç»ˆæ•°æ®æ˜¯çº¿ç¨‹2å†™è¿›å»çš„é‚£ä»½ï¼Œè€ŒCacheç»è¿‡çº¿ç¨‹3çš„å›æºåä¿å­˜çš„å´æ˜¯çº¿ç¨‹1å†™çš„é‚£ä»½æ•°æ®ï¼Œä¸ä¸€è‡´é—®é¢˜å‡ºç°ã€‚ 3.2ï¼šä¸»ä»åŒæ­¥å»¶æ—¶å¯¼è‡´çš„ä¸€è‡´æ€§é—®é¢˜è¿™ç§æƒ…å†µè¦ç¨å¾®ä¿®æ”¹ä¸‹ç¨‹åºçš„æµç¨‹å›¾ï¼Œå¤šå‡ºä¸€ä¸ªä»åº“ï¼š ç°åœ¨è¯»æ“ä½œèµ°ä»åº“ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœåœ¨ä¸»åº“å†™æ“ä½œåˆ é™¤ç¼“å­˜åï¼Œç”±äºä¸»ä»åŒæ­¥æœ‰å¯èƒ½ç¨å¾®æ…¢äºå›æºæµç¨‹è§¦å‘ï¼Œå›æºæ—¶è¯»å–ä»åº“ä»ç„¶ä¼šè¯»åˆ°è€æ•°æ®ã€‚ 3.3ï¼šç¼“å­˜æ±¡æŸ“å¯¼è‡´çš„ä¸€è‡´æ€§é—®é¢˜æ¯æ¬¡åšæ–°éœ€æ±‚æ—¶æ›´æ–°äº†åŸæœ‰çš„ç¼“å­˜ç»“æ„ï¼Œæˆ–å»é™¤å‡ ä¸ªå±æ€§ï¼Œæˆ–æ–°å¢å‡ ä¸ªå±æ€§ï¼Œå‡å¦‚æ–°éœ€æ±‚æ˜¯ç»™æŸä¸ªç¼“å­˜å¯¹è±¡Oæ–°å¢ä¸€ä¸ªå±æ€§Bï¼Œå¦‚æœæ–°é€»è¾‘å·²ç»åœ¨é¢„å‘æˆ–è€…å¤„äºç°åº¦ä¸­ï¼Œå°±ä¼šå‡ºç°ç”Ÿäº§ç¯å¢ƒå›æºåçš„ç¼“å­˜æ•°æ®æ²¡æœ‰Bå±æ€§çš„æƒ…å†µï¼Œè€Œé¢„å‘å’Œç°åº¦æ—¶ï¼Œæ–°é€»è¾‘éœ€è¦ä½¿ç”¨Bå±æ€§ï¼Œå°±ä¼šå¯¼è‡´ç”Ÿäº§&amp;é¢„å‘ç¼“å­˜æ±¡æŸ“ã€‚è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š å››ã€åº”å¯¹ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜4.1ï¼šbinlog+æ¶ˆæ¯é˜Ÿåˆ—+æ¶ˆè´¹è€…del cache ä¸Šå›¾æ˜¯ç°åœ¨å¸¸ç”¨çš„æ¸…ç¼“å­˜ç­–ç•¥ï¼Œæ¯æ¬¡è¡¨å‘ç”Ÿå˜åŠ¨ï¼Œé€šè¿‡mysqläº§ç”Ÿçš„binlogå»ç»™æ¶ˆæ¯é˜Ÿåˆ—å‘é€å˜åŠ¨æ¶ˆæ¯ï¼Œè¿™é‡Œç›‘å¬DBå˜åŠ¨çš„æœåŠ¡ç”±canalæä¾›ï¼Œcanalå¯ä»¥ç®€å•ç†è§£æˆä¸€ä¸ªå®ç°äº†mysqlé€šä¿¡åè®®çš„ä»åº“ï¼Œé€šè¿‡mysqlä¸»ä»é…ç½®å®ŒæˆbinlogåŒæ­¥ï¼Œä¸”å®ƒåªæ¥æ”¶binlogï¼Œé€šè¿‡è¿™ç§æœºåˆ¶ï¼Œå°±å¯ä»¥å¾ˆè‡ªç„¶çš„ç›‘å¬æ•°æ®åº“è¡¨æ•°æ®å˜åŠ¨äº†ï¼Œå¯ä»¥ä¿è¯æ¯æ¬¡æ•°æ®åº“å‘ç”Ÿçš„å˜åŠ¨ï¼Œéƒ½ä¼šè¢«é¡ºåºå‘å¾€æ¶ˆè´¹è€…å»æ¸…é™¤å¯¹åº”çš„ç¼“å­˜keyã€‚ 4.2ï¼šä»åº“binlog+æ¶ˆæ¯é˜Ÿåˆ—+æ¶ˆè´¹è€…del cacheä¸Šé¢çš„è¿‡ç¨‹èƒ½ä¿è¯å†™åº“æ—¶æ¸…ç¼“å­˜çš„é¡ºåºé—®é¢˜ï¼Œçœ‹ä¼¼å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯ç”Ÿäº§ç¯å¢ƒå¾€å¾€å­˜åœ¨ä¸»ä»åˆ†ç¦»çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¯´ä¸Šé¢çš„å›¾ä¸­å¦‚æœå›æºæ—¶è¯»çš„æ˜¯ä»åº“ï¼ˆå‚è€ƒé—®é¢˜3.2ï¼‰ï¼Œé‚£ä¸Šé¢çš„è¿‡ç¨‹ä»ç„¶æ˜¯å­˜åœ¨ä¸€è‡´æ€§é—®é¢˜çš„ï¼š ä»åº“å»¶è¿Ÿå¯¼è‡´çš„è„è¯»é—®é¢˜ï¼Œå¦‚ä½•è§£å†³è¿™ç±»é—®é¢˜å‘¢ï¼Ÿåªéœ€è¦å°†canalç›‘å¬çš„æ•°æ®åº“è®¾ç½®æˆä»åº“å³å¯ï¼Œä¿è¯åœ¨canalæ¨é€è¿‡æ¥æ¶ˆæ¯æ—¶ï¼Œæ‰€æœ‰çš„ä»åº“å’Œä¸»åº“å®Œå…¨ä¸€è‡´ï¼Œä¸è¿‡è¿™åªé’ˆå¯¹ä¸€ä¸»ä¸€ä»çš„æƒ…å†µï¼Œå¦‚æœä¸€ä¸»å¤šä»ï¼Œä¸”å›æºè¯»å–çš„ä»åº“æœ‰å¤šä¸ªï¼Œé‚£ä¹ˆä¸Šè¿°ä¹Ÿæ˜¯å­˜åœ¨ä¸€å®šçš„é£é™©çš„ï¼ˆä¸€ä¸»å¤šä»éœ€è¦è®¢é˜…æ¯ä¸ªä»èŠ‚ç‚¹çš„binlogï¼Œæ‰¾å‡ºæœ€åå‘è¿‡æ¥çš„é‚£ä¸ªèŠ‚ç‚¹ï¼Œç„¶åæ¸…ç¼“å­˜ï¼Œç¡®ä¿æ‰€æœ‰çš„ä»èŠ‚ç‚¹å…¨éƒ¨å’Œä¸»èŠ‚ç‚¹ä¸€è‡´ï¼‰ã€‚ ä¸è¿‡ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œä»åº“binlogçš„åŒæ­¥é€Ÿåº¦éƒ½è¦æ¯”canalå‘æ¶ˆæ¯å¿«ï¼Œå› ä¸ºcanalè¦æ¥æ”¶binlogï¼Œç„¶åç»„è£…æ•°æ®å˜åŠ¨å®ä½“ï¼ˆè¿™ä¸€æ­¥æ˜¯æœ‰é¢å¤–å¼€é”€çš„ï¼‰ï¼Œç„¶åé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—æ¨é€ç»™å„æ¶ˆè´¹è€…ï¼ˆè¿™ä¸€æ­¥ä¹Ÿæ˜¯æœ‰å¼€é”€çš„ï¼‰ï¼Œæ‰€ä»¥å³ä¾¿æ˜¯è®¢é˜…çš„masteråº“çš„è¡¨å˜æ›´ï¼Œå‡ºé—®é¢˜çš„æ¦‚ç‡ä¹Ÿæå°ã€‚ psï¼šç›®å‰ç¬”è€…å…¬å¸å†…æ•°æ®åº“éƒ½æ˜¯ä¸€ä¸»ä¸€ä»ï¼Œcanalç›‘å¬çš„éƒ½æ˜¯ä»åº“çš„å˜åŠ¨ã€‚ 4.3ï¼šæ›´æ–°åkeyå‡çº§é’ˆå¯¹ä¸Šé¢çš„ä¸€è‡´æ€§é—®é¢˜3.3ï¼ˆç¼“å­˜æ±¡æŸ“ï¼‰ï¼Œä¿®æ”¹æŸä¸ªç¼“å­˜ç»“æ„å¯èƒ½å¯¼è‡´åœ¨é¢„å‘æˆ–è€…ç°åº¦ä¸­çŠ¶æ€æ—¶å’Œå®é™…ç”Ÿäº§ç¯å¢ƒçš„ç¼“å­˜ç›¸äº’æ±¡æŸ“ï¼Œè¿™ä¸ªæ—¶å€™å»ºè®®æ¯æ¬¡æ›´æ–°ç»“æ„æ—¶éƒ½è¿›è¡Œä¸€æ¬¡keyå‡çº§ï¼ˆæ¯”å¦‚åœ¨åŸæœ‰çš„keyåç§°åŸºç¡€ä¸ŠåŠ ä¸Š_v2çš„åç¼€ï¼‰ã€‚ âš¡âš¡âš¡binlogæ˜¯å¦çœŸçš„æ˜¯å‡†ç¡®æ— è¯¯çš„å‘¢ï¼Ÿâš¡âš¡âš¡ å¹¶ä¸æ˜¯ï¼Œæ¯”å¦‚ä¸Šé¢çš„æƒ…å†µï¼š é¦–å…ˆçº¿ç¨‹1èµ°åˆ°æœåŠ¡Aï¼Œå†™DBï¼Œå‘binlogåˆ é™¤ç¼“å­˜ ç„¶åçº¿ç¨‹3è¿è¡Œçš„æœåŠ¡Bè¿™æ—¶cache missï¼Œç„¶åè¯»å–DBå›æºï¼ˆè¿™æ—¶è¯»åˆ°çš„æ•°æ®æ˜¯çº¿ç¨‹1å†™å…¥çš„é‚£ä»½æ•°æ®ï¼‰ æ­¤æ—¶çº¿ç¨‹2å†æ¬¡è§¦å‘æœåŠ¡Aå†™DBï¼ŒåŒæ ·å‘é€binlogåˆ é™¤ç¼“å­˜ æœ€åçº¿ç¨‹3æŠŠè¯»åˆ°çš„æ•°æ®å†™å…¥cacheï¼Œæœ€ç»ˆå¯¼è‡´DBé‡Œå­˜å‚¨çš„æ˜¯çº¿ç¨‹2å†™å…¥çš„æ•°æ®ï¼Œä½†æ˜¯cacheé‡Œå­˜å‚¨çš„å´æ˜¯çº¿ç¨‹1å†™å…¥çš„æ•°æ®ï¼Œä¸ä¸€è‡´è¾¾æˆ è¿™ç§æƒ…å†µæ¯”è¾ƒéš¾ä»¥è§¦å‘ï¼Œå› ä¸ºæå°‘ä¼šå‡ºç°çº¿ç¨‹3é‚£é‡Œå†™cacheçš„åŠ¨ä½œä¼šæ™šäºç¬¬äºŒæ¬¡binlogå‘é€çš„ï¼Œé™¤éåœ¨å›æºæ—¶åšäº†åˆ«çš„å¸¦æœ‰é˜»å¡æ€§è´¨çš„æ“ä½œï¼Œæ‰€ä»¥æ ¹æ®ç°æœ‰çš„ç­–ç•¥ï¼Œé’ˆå¯¹é—®é¢˜3.1ï¼Œæ²¡æœ‰ç‰¹åˆ«å®Œç¾çš„è§£å†³æ–¹æ¡ˆï¼Œåªèƒ½å°½å¯èƒ½ä¿è¯ä¸€è‡´æ€§ï¼Œä½†ç”±äºå®é™…ç”Ÿäº§ç¯å¢ƒå°±åƒé—®é¢˜3.1é‡Œé‚£æ ·ï¼Œå¤„äºå¤šçº¿ç¨‹å¹¶å‘è¯»å†™çš„ç¯å¢ƒï¼Œå³ä¾¿æœ‰binlogåšæœ€ç»ˆçš„ä¿è¯ï¼Œä¹Ÿä¸èƒ½ä¿è¯æœ€åå›æºæ–¹æ³•å†™ç¼“å­˜é‚£é‡Œçš„é¡ºåºæ€§ã€‚é™¤éå›æºå…¨éƒ¨äº¤ç”±binlogæ¶ˆè´¹è€…æ¥åšï¼Œä¸è¿‡è¿™æœ¬å°±ä¸å¤ªç°å®ï¼Œè¿™æ ·ç­‰äºè¯´æœåŠ¡Bæ²¡æœ‰å›æºæ–¹æ³•äº†ã€‚ é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œå‡ºç°æ¦‚ç‡æœ€å¤§çš„å°±æ˜¯é‚£ç§å†™å¹¶å‘æ¦‚ç‡å¾ˆå¤§çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™ä¼´éšè€Œæ¥çš„è¿˜æœ‰å‘½ä¸­ç‡ï¼ˆå‚è€ƒäº”ï¼‰é—®é¢˜ã€‚ 4.4ï¼šä¸€è‡´æ€§é—®é¢˜è§£å†³æ€»ç»“æ²¡æœ‰å¾ˆå¥½çš„é¿å…é—®é¢˜3.1çš„æ–¹æ³•ï¼Œä»åº“binlogè®¢é˜…+æ¸…ç¼“å­˜å¯ä»¥ä¿è¯åœ¨æ¸…ç¼“å­˜åæœåŠ¡å›æºè¯»åˆ°çš„ä¸€å®šæ˜¯æœ€æ–°æ•°æ®ï¼Œä½†æ˜¯è¿™å¹¶ä¸å¦¨ç¢å›¾11ä¸­çš„é—®é¢˜å‘ç”Ÿï¼Œåªæ˜¯æ¦‚ç‡æå°ï¼Œåœ¨é«˜å¹¶å‘å†™+è¯»å›æºæ—¶æ²¡æœ‰ä»€ä¹ˆåŠæ³•æ˜¯å¯ä»¥ä¿è¯å®Œå…¨æ²¡æœ‰é—®é¢˜çš„ï¼Œå¯ä»¥åŠ åˆ†å¸ƒå¼é”æ§åˆ¶å›æºæ–¹æ³•ï¼ˆè¿™æ ·å‡ºé—®é¢˜çš„æ¦‚ç‡å°±æ›´åŠ ä½äº†ï¼‰ã€‚å½“ç„¶ï¼Œåªæœ‰åœ¨è¿™ç§å¤§é‡å†™æ“ä½œçš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šä½¿é—®é¢˜3.1å‡ºç°çš„æ¦‚ç‡æå‡ï¼Œä¸€èˆ¬è¿™ç§å¤§é‡å†™çš„è¿˜ä¼šæœ‰å‘½ä¸­ç‡ä½çš„é—®é¢˜ï¼Œæ‰€ä»¥è¿™ç±»ç¼“å­˜çš„æ›´æ–°ä¸€èˆ¬äº¤ç»™binlogæ¶ˆè´¹è€…ç›´æ¥å»åšï¼Œåœ¨å•çº¿ç¨‹å¤„ç†æ¨¡å¼ä¸‹ï¼Œä¸€è‡´æ€§é—®é¢˜å‡ ä¹ä¸ä¼šå‡ºç°ã€‚ç›¸æ¯”é—®é¢˜3.1é‡Œçš„ç›´æ¥deleteç¼“å­˜ï¼Œbinlogæ¨¡å¼å¯ä»¥ä¿è¯æ¸…ç¼“å­˜åç¼“å­˜å›æºæ—¶è¯»åˆ°çš„å†…å®¹ä¸€å®šæ˜¯æœ€æ–°çš„ï¼Œæå¤§çš„é™ä½äº†å› ä¸ºä¸»ä»é…ç½®å¯¼è‡´çš„é—®é¢˜3.1ã€3.2å‡ºç°çš„æ¦‚ç‡ã€‚ äº”ã€å‘½ä¸­ç‡é—®é¢˜é€šè¿‡å‰é¢çš„æµç¨‹ï¼ŒæŠ›å¼€ç‰¹æ®Šå› ç´ ï¼Œå·²ç»è§£å†³äº†ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œä½†éšç€æ¸…ç¼“å­˜è€Œæ¥çš„å¦ä¸€ä¸ªé—®é¢˜å°±æ˜¯å‘½ä¸­ç‡é—®é¢˜ï¼Œæ¯”å¦‚ä¸€ä¸ªæ•°æ®å˜æ›´è¿‡äºé¢‘ç¹ï¼Œä»¥è‡³äºäº§ç”Ÿè¿‡å¤šçš„binlogæ¶ˆæ¯ï¼Œè¿™ä¸ªæ—¶å€™æ¯æ¬¡éƒ½ä¼šè§¦å‘æ¶ˆè´¹è€…çš„æ¸…ç¼“å­˜æ“ä½œï¼Œè¿™æ ·çš„è¯ç¼“å­˜çš„å‘½ä¸­ç‡ä¼šç¬é—´ä¸‹é™ï¼Œå¯¼è‡´å¤§éƒ¨åˆ†ç”¨æˆ·è®¿é—®ç›´æ¥è®¿é—®DBï¼Œè€Œä¸”è¿™ç§é¢‘ç¹å˜æ›´çš„æ•°æ®è¿˜ä¼šåŠ å¤§é—®é¢˜â‘ å‡ºç°çš„æ¦‚ç‡ï¼Œæ‰€ä»¥é’ˆå¯¹è¿™ç§é¢‘ç¹å˜æ›´çš„æ•°æ®ï¼Œä¸å†åˆ é™¤ç¼“å­˜keyï¼Œè€Œæ˜¯ç›´æ¥åœ¨binlogæ¶ˆè´¹è€…é‚£é‡Œç›´æ¥å›æºæ›´æ–°ç¼“å­˜ï¼Œè¿™æ ·å³ä¾¿è¡¨é¢‘ç¹å˜æ›´ï¼Œç”¨æˆ·è®¿é—®æ—¶æ¯æ¬¡éƒ½æ˜¯æ¶ˆè´¹è€…æ›´æ–°å¥½çš„é‚£ä»½ç¼“å­˜æ•°æ®ï¼Œåªæ˜¯è¿™æ—¶å€™æ¶ˆè´¹è€…è¦ä¸¥æ ¼æŒ‰ç…§æ¶ˆæ¯é¡ºåºæ¥å¤„ç†ï¼Œå¦åˆ™ä¹Ÿä¼šæœ‰å†™è„çš„å±é™©ï¼Œæ¯”å¦‚å¼€ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ¶ˆè´¹binlogæ¶ˆæ¯ï¼Œçº¿ç¨‹1æ¥æ”¶åˆ°äº†ç¬¬ä¸€æ¬¡æ•°æ®å˜æ›´çš„binlogï¼Œè€Œçº¿ç¨‹2æ¥æ”¶åˆ°äº†ç¬¬äºŒæ¬¡æ•°æ®å˜æ›´çš„binlogï¼Œè¿™æ—¶çº¿ç¨‹1è¯»å‡ºæ•°æ®ï¼ˆæ—§æ•°æ®ï¼‰ï¼Œçº¿ç¨‹2è¯»å‡ºæ•°æ®ï¼ˆæ–°æ•°æ®ï¼‰æ›´æ–°ç¼“å­˜ï¼Œç„¶åçº¿ç¨‹1å†æ‰§è¡Œæ›´æ–°ï¼Œè¿™æ—¶ç¼“å­˜åˆä¼šè¢«å†™è„ï¼Œæ‰€ä»¥ä¸ºäº†ä¿è¯æ¶ˆè´¹é¡ºåºï¼Œå¿…é¡»æ˜¯å•çº¿ç¨‹å¤„ç†ï¼Œå¦‚æœæƒ³è¦å¯ç”¨å¤šçº¿ç¨‹å‡æ‘Šå‹åŠ›ï¼Œå¯ä»¥åˆ©ç”¨keyã€idç­‰æ ‡è¯†æ€§å­—æ®µåšä»»åŠ¡åˆ†ç»„ï¼Œè¿™æ ·åŒä¸€ä¸ªidçš„binlogæ¶ˆæ¯å§‹ç»ˆä¼šè¢«åŒä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚ å…­ã€ç¼“å­˜ç©¿é€6.1ï¼šä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Ÿæ­£å¸¸æƒ…å†µä¸‹ç”¨æˆ·è¯·æ±‚ä¸€ä¸ªæ•°æ®æ—¶ä¼šæºå¸¦æ ‡è®°æ€§çš„å‚æ•°ï¼ˆæ¯”å¦‚idï¼‰ï¼Œè€Œæˆ‘ä»¬çš„ç¼“å­˜keyåˆ™ä¼šä»¥è¿™äº›æ ‡è®°æ€§çš„å‚æ•°æ¥åˆ’åˆ†ä¸åŒçš„cache valueï¼Œç„¶åæˆ‘ä»¬æ ¹æ®è¿™äº›å‚æ•°å»æŸ¥ç¼“å­˜ï¼ŒæŸ¥åˆ°å°±è¿”å›ï¼Œå¦åˆ™å›æºï¼Œç„¶åå†™å…¥cacheæœåŠ¡åè¿”å›ï¼Œè¯¦ç»†è¿‡ç¨‹å‚è€ƒä¸Šè¿°ç¬¬ä¸‰éƒ¨åˆ†ã€‚ è¿™ä¸ªè¿‡ç¨‹çœ‹èµ·æ¥ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯æŸäº›æƒ…å†µä¸‹ï¼Œæ ¹æ®å¸¦è¿›æ¥çš„å‚æ•°ï¼Œåœ¨æ•°æ®åº“é‡Œå¹¶ä¸èƒ½æ‰¾åˆ°å¯¹åº”çš„ä¿¡æ¯ï¼Œè¿™ä¸ªæ—¶å€™æ¯æ¬¡å¸¦æœ‰è¿™ç§å‚æ•°çš„è¯·æ±‚ï¼Œéƒ½ä¼šèµ°åˆ°æ•°æ®åº“å›æºï¼Œè¿™ç§ç°è±¡å«åšç¼“å­˜ç©¿é€ï¼Œæ¯”è¾ƒå…¸å‹çš„å‡ºç°è¿™ç§é—®é¢˜çš„æƒ…å†µæœ‰ï¼š â‘ æ¶æ„æ”»å‡»æˆ–è€…çˆ¬è™«ï¼Œæºå¸¦æ•°æ®åº“é‡Œæœ¬å°±ä¸å­˜åœ¨çš„æ•°æ®åšå‚æ•°å›æº â‘¡å…¬å¸å†…éƒ¨åˆ«çš„ä¸šåŠ¡æ–¹è°ƒç”¨æˆ‘æ–¹çš„æ¥å£æ—¶ï¼Œç”±äºæ²Ÿé€šä¸å½“æˆ–å…¶ä»–åŸå› å¯¼è‡´çš„å‚æ•°å¤§é‡è¯¯ä¼  â‘¢å®¢æˆ·ç«¯bugå¯¼è‡´çš„å‚æ•°å¤§é‡è¯¯ä¼  6.2ï¼šå¦‚ä½•è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜ï¼Ÿç›®å‰æˆ‘ä»¬æå€¡çš„åšæ³•æ˜¯å›æºæŸ¥ä¸åˆ°ä¿¡æ¯æ—¶ç›´æ¥ç¼“å­˜ç©ºæ•°æ®ï¼ˆæ³¨æ„ï¼šç©ºæ•°æ®ç¼“å­˜çš„è¿‡æœŸæ—¶é—´è¦å°½å¯èƒ½å°ï¼Œé˜²æ­¢æ— æ„ä¹‰å†…å®¹è¿‡å¤šå ç”¨Cacheå†…å­˜ï¼‰ï¼Œè¿™æ ·å³ä¾¿æ˜¯æœ‰å‚æ•°è¯¯ä¼ ã€æ¶æ„æ”»å‡»ç­‰æƒ…å†µï¼Œä¹Ÿä¸ä¼šæ¯æ¬¡éƒ½æ‰“è¿›DBã€‚ ä½†æ˜¯ç›®å‰è¿™ç§åšæ³•ä»ç„¶å­˜åœ¨è¢«æ”»å‡»çš„é£é™©ï¼Œå¦‚æœæ¶æ„æ”»å‡»æ—¶æºå¸¦å°‘é‡å‚æ•°è¿˜å¥½ï¼Œè¿™æ ·ä¸å­˜åœ¨çš„ç©ºæ•°æ®ç¼“å­˜ä»…ä»…ä¼šå ç”¨å°‘é‡å†…å­˜ï¼Œä½†æ˜¯å¦‚æœæ”»å‡»è€…ä½¿ç”¨å¤§é‡ç©¿é€æ”»å‡»ï¼Œæºå¸¦çš„å‚æ•°åƒå¥‡ç™¾æ€ªï¼Œè¿™æ ·å°±ä¼šäº§ç”Ÿå¤§é‡æ— æ„ä¹‰çš„ç©ºå¯¹è±¡ç¼“å­˜ï¼Œä½¿å¾—æˆ‘ä»¬çš„ç¼“å­˜æœåŠ¡å™¨å†…å­˜æš´å¢ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦æœåŠ¡ç«¯æ¥è¿›è¡Œç®€å•çš„æ§åˆ¶ï¼šæŒ‰ç…§ä¸šåŠ¡å†…è‡ªå·±çš„ä¼°ç®—ï¼Œåˆç†çš„idå¤§è‡´åœ¨ä»€ä¹ˆèŒƒå›´å†…ï¼Œæ¯”å¦‚æŒ‰ç…§ç”¨æˆ·idåšæ ‡è®°çš„ç¼“å­˜ï¼Œå°±ç›´æ¥åœ¨è·å–ç¼“å­˜å‰åˆ¤æ–­æ‰€ä¼ ç”¨æˆ·idå‚æ•°æ˜¯å¦è¶…è¿‡äº†æŸä¸ªé˜ˆå€¼ï¼Œè¶…è¿‡ç›´æ¥è¿”å›ç©ºã€‚ï¼ˆæ¯”å¦‚ç”¨æˆ·æ€»é‡æ‰å‡ åä¸‡æˆ–è€…ä¸Šç™¾ä¸‡ï¼Œç»“æœç”¨æˆ·idä¼ è¿‡æ¥ä¸ªå‡ åƒä¸‡ç”šè‡³å‡ äº¿æ˜æ˜¾ä¸åˆç†çš„æƒ…å†µï¼‰ ä¸ƒã€ç¼“å­˜å‡»ç©¿7.1ï¼šä»€ä¹ˆæ˜¯ç¼“å­˜å‡»ç©¿ï¼Ÿç¼“å­˜å‡»ç©¿æ˜¯æŒ‡åœ¨ä¸€ä¸ªkeyå¤±æ•ˆåï¼Œå¤§é‡è¯·æ±‚æ‰“è¿›å›æºæ–¹æ³•ï¼Œå¤šçº¿ç¨‹å¹¶å‘å›æºçš„é—®é¢˜ã€‚ è¿™ç§æƒ…å†µåœ¨å°‘é‡è®¿é—®æ—¶ä¸èƒ½ç®—ä½œä¸€ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å½“ä¸€ä¸ªçƒ­ç‚¹keyå¤±æ•ˆåï¼Œå°±ä¼šå‘ç”Ÿå›æºæ—¶æ¶Œè¿›è¿‡å¤šæµé‡ï¼Œå…¨éƒ¨æ‰“åœ¨DBä¸Šï¼Œè¿™æ ·ä¼šå¯¼è‡´DBåœ¨è¿™ä¸€æ—¶åˆ»å‹åŠ›å‰§å¢ã€‚ 7.2ï¼šå¦‚ä½•è§£å†³ç¼“å­˜å‡»ç©¿ï¼Ÿ7.2.1ï¼šå›æºæ–¹æ³•å†…è¿½åŠ äº’æ–¥é”è¿™ä¸ªå¯ä»¥é¿å…å¤šæ¬¡å›æºï¼Œä½†æ˜¯nå°å®ä¾‹ç¾¤æ¨¡å¼ä¸‹ï¼Œä»ç„¶ä¼šå­˜åœ¨å®ä¾‹å¹¶å‘å›æºçš„æƒ…å†µï¼Œè¿™ä¸ªé‡çº§ç›¸æ¯”ä¹‹å‰å¤§é‡æ‰“è¿›ï¼Œå·²ç»å¤§é‡é™ä½äº†ã€‚ 7.2.2ï¼šå›æºæ–¹æ³•å†…è¿½åŠ åˆ†å¸ƒå¼é”è¿™ä¸ªå¯ä»¥å®Œå…¨é¿å…ä¸Šé¢å¤šå®ä¾‹ä¸‹å¹¶å‘å›æºçš„æƒ…å†µï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œé‚£å°±æ˜¯åˆå¼•å…¥äº†ä¸€ä¸ªæ–°çš„æœåŠ¡ï¼Œè¿™æ„å‘³ç€å‘ç”Ÿå¼‚å¸¸çš„é£é™©ä¼šåŠ å¤§ã€‚ å…«ã€ç¼“å­˜é›ªå´©8.1ï¼šä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿç¼“å­˜é›ªå´©æ˜¯æŒ‡ç¼“å­˜æ•°æ®æŸä¸€æ—¶åˆ»å‡ºç°å¤§é‡å¤±æ•ˆçš„æƒ…å†µï¼Œæ‰€æœ‰è¯·æ±‚å…¨éƒ¨æ‰“è¿›DBï¼Œå¯¼è‡´çŸ­æœŸå†…DBè´Ÿè½½æš´å¢çš„é—®é¢˜ï¼Œä¸€èˆ¬æ¥è¯´é€ æˆç¼“å­˜é›ªå´©æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š 8.1.1ï¼šç¼“å­˜æœåŠ¡æ‰©ç¼©å®¹è¿™ä¸ªæ˜¯ç”±ç¼“å­˜çš„æ•°æ®åˆ†ç‰‡ç­–ç•¥çš„è€Œå¯¼è‡´çš„ï¼Œå¦‚æœé‡‡ç”¨ç®€å•çš„å–æ¨¡è¿ç®—è¿›è¡Œæ•°æ®åˆ†ç‰‡ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯æ‰©ç¼©å®¹å°±ä¼šå¯¼è‡´é›ªå´©çš„å‘ç”Ÿã€‚ 8.1.2ï¼šç¼“å­˜æœåŠ¡å®•æœºæŸä¸€æ—¶åˆ»ç¼“å­˜æœåŠ¡å™¨å‡ºç°å¤§é‡å®•æœºçš„æƒ…å†µï¼Œå¯¼è‡´ç¼“å­˜æœåŠ¡ä¸å¯ç”¨ï¼Œæ ¹æ®ç°æœ‰çš„å®ç°ï¼Œæ˜¯ç›´æ¥æ‰“åˆ°DBä¸Šçš„ã€‚ 8.2ï¼šå¦‚ä½•é¿å…é›ªå´©çš„å‘ç”Ÿï¼Ÿ8.2.1ï¼šç¼“å­˜æœåŠ¡ç«¯çš„é«˜å¯ç”¨é…ç½®*ä¸Šé¢mcå’Œredisçš„åˆ†ç‰‡ç­–ç•¥å·²ç»è¯´è¿‡ï¼Œæ‰€ä»¥æ‰©ç¼©å®¹å¸¦æ¥çš„é›ªå´©å‡ ç‡å¾ˆå°ï¼Œå…¶æ¬¡redisæœåŠ¡å®ç°äº†é«˜å¯ç”¨é…ç½®ï¼šå¯ç”¨clusteræ¨¡å¼ï¼Œä¸€ä¸»ä¸€ä»é…ç½®ã€‚ç”±äºå¯¹ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„ä¼˜åŒ–ï¼Œmcå®•æœºã€æ‰©ç¼©å®¹å¯¹æ•´ä½“å½±å“ä¸å¤§ï¼Œæ‰€ä»¥ç¼“å­˜æœåŠ¡å™¨æœåŠ¡ç«¯æœ¬èº«ç›®å‰æ˜¯å¯ä»¥ä¿è¯è‰¯å¥½çš„å¯ç”¨æ€§çš„ï¼Œå°½å¯èƒ½çš„é¿å…äº†é›ªå´©çš„å‘ç”Ÿï¼ˆé™¤éå¤§è§„æ¨¡å®•æœºï¼Œæ¦‚ç‡å¾ˆå°ï¼‰ã€‚ 8.2.2ï¼šæ•°æ®åˆ†ç‰‡ç­–ç•¥è°ƒæ•´è°ƒæ•´ç¼“å­˜æœåŠ¡å™¨çš„åˆ†ç‰‡ç­–ç•¥ï¼Œæ¯”å¦‚ä¸Šé¢ç¬¬ä¸€éƒ¨åˆ†æ‰€è®²çš„ï¼Œç»™mcå¼€å¯ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„åˆ†ç‰‡ç­–ç•¥ï¼Œé˜²æ­¢ç¼“å­˜æœåŠ¡ç«¯æ‰©ç¼©å®¹åç¼“å­˜æ•°æ®å¤§é‡ä¸å¯ç”¨ã€‚ 8.2.3ï¼šå›æºé™æµå¦‚æœç¼“å­˜æœåŠ¡çœŸçš„æŒ‚æ‰äº†ï¼Œè¯·æ±‚å…¨æ‰“åœ¨DBä¸Šï¼Œä»¥è‡³äºè¶…å‡ºäº†DBæ‰€èƒ½æ‰¿å—ä¹‹é‡ï¼Œè¿™ä¸ªæ—¶å€™å»ºè®®å›æºæ—¶è¿›è¡Œæ•´ä½“é™æµï¼Œè¢«é™åˆ°çš„è¯·æ±‚ç´«è‡ªåŠ¨èµ°é™çº§é€»è¾‘ï¼Œæˆ–è€…ç›´æ¥æŠ¥é”™ã€‚ ä¹ã€çƒ­keyé—®é¢˜9.1ï¼šä»€ä¹ˆæ˜¯çƒ­keyé—®é¢˜ï¼Ÿäº†è§£äº†ç¼“å­˜æœåŠ¡ç«¯çš„å®ç°ï¼Œå¯ä»¥çŸ¥é“æŸä¸€ä¸ªç¡®å®šçš„keyå§‹ç»ˆä¼šè½åˆ°æŸä¸€å°æœåŠ¡å™¨ä¸Šï¼Œå¦‚æœæŸä¸ªkeyåœ¨ç”Ÿäº§ç¯å¢ƒè¢«å¤§é‡è®¿é—®ï¼Œå°±å¯¼è‡´äº†æŸä¸ªç¼“å­˜æœåŠ¡èŠ‚ç‚¹æµé‡æš´å¢ï¼Œç­‰è®¿é—®è¶…å‡ºå•èŠ‚ç‚¹è´Ÿè½½ï¼Œå°±å¯èƒ½ä¼šå‡ºç°å•ç‚¹æ•…éšœï¼Œå•ç‚¹æ•…éšœåè½¬ç§»è¯¥keyçš„æ•°æ®åˆ°å…¶ä»–èŠ‚ç‚¹ï¼Œå•ç‚¹é—®é¢˜ä¾æ—§å­˜åœ¨ï¼Œåˆ™å¯èƒ½ç»§ç»­ä¼šè®©è¢«è½¬ç§»åˆ°çš„èŠ‚ç‚¹ä¹Ÿå‡ºç°æ•…éšœï¼Œæœ€ç»ˆå½±å“æ•´ä¸ªç¼“å­˜æœåŠ¡é›†ç¾¤ã€‚ 9.2ï¼šå¦‚ä½•è§£å†³çƒ­keyé—®é¢˜ï¼Ÿ9.2.1ï¼šå¤šç¼“å­˜å‰¯æœ¬é¢„å…ˆæ„ŸçŸ¥åˆ°å‘ç”Ÿçƒ­ç‚¹è®¿é—®çš„keyï¼Œç”Ÿæˆå¤šä¸ªå‰¯æœ¬keyï¼Œè¿™æ ·å¯ä»¥ä¿è¯çƒ­ç‚¹keyä¼šè¢«å¤šä¸ªç¼“å­˜æœåŠ¡å™¨æŒæœ‰ï¼Œç„¶åå›æºæ–¹æ³•å…¬ç”¨ä¸€ä¸ªï¼Œè¯·æ±‚æ—¶æŒ‰ç…§ä¸€å®šçš„ç®—æ³•éšæœºè®¿é—®æŸä¸ªå‰¯æœ¬keyï¼š 9.2.2ï¼šæœ¬åœ°ç¼“å­˜é’ˆå¯¹çƒ­ç‚¹keyå¤–é¢åŒ…ä¸€å±‚çŸ­å­˜æ´»æœŸçš„æœ¬åœ°ç¼“å­˜ï¼Œç”¨äºç¼“å†²çƒ­ç‚¹æœåŠ¡å™¨çš„å‹åŠ›ã€‚","link":"/2019/10/24/%E5%B7%A5%E4%BD%9C%E4%B8%AD%E6%9C%89%E5%85%B3%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98%E7%9A%84%E4%BD%BF%E7%94%A8%E5%92%8C%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E9%97%AE%E9%A2%98%E6%A2%B3%E7%90%86/"},{"title":"Druid-ç±»å›¾-å±æ€§è¡¨","text":"æ‰€å±æ–‡ç« ï¼šæ± åŒ–æŠ€æœ¯ï¼ˆä¸€ï¼‰Druidæ˜¯å¦‚ä½•ç®¡ç†æ•°æ®åº“è¿æ¥çš„ï¼Ÿ æœ¬ç¯‡ä¸ºã€Œå·¥å…·äººã€æ–‡ç« ï¼Œå»ºè®®ç›´æ¥ç”¨ã€Œctrl+fã€è¿›è¡ŒæŸ¥æ‰¾å±æ€§ã€æ–¹æ³•ã€ç±»åï¼Œå¿«é€Ÿäº†è§£å…¶å«ä¹‰å’Œæ‰€å±ç±»ã€‚ ä¸»è¦æµç¨‹é‡Œä¸»è¦æ¶‰åŠåˆ°çš„ç±»åç§°ã€ç±»å±æ€§ã€ç±»æ–¹æ³•å¦‚ä¸‹å›¾ï¼ˆæ·¡é»„è‰²è¡¨ç¤ºå±æ€§ï¼Œæ·¡è“è‰²è¡¨ç¤ºæ–¹æ³•ï¼‰ï¼š DruidAbstractDataSourceæŠ½è±¡ç±»è¿™ä¸ªç±»æ˜¯druidè¿æ¥æ± åŸºç¡€ç±»ï¼Œå®šä¹‰äº†ä¸€äº›è¿æ¥æ± è¯¥æœ‰çš„åŸºæœ¬å±æ€§ï¼Œä»¥åŠç”Ÿæˆé©±åŠ¨è¿æ¥å¯¹è±¡çš„æ–¹æ³•ã€‚ å±æ€§è¡¨ å±æ€§å è¯´æ˜ username ç”¨æˆ·å password å¯†ç  jdbcUrl é©±åŠ¨è¿æ¥ driverClass é©±åŠ¨classï¼Œå¯ä»¥ä¸ç”¨é…ç½® initialSize åˆå§‹åŒ–è¿æ¥æ± ï¼ˆä¸»æµç¨‹2ï¼‰æ—¶éœ€è¦é¢„å…ˆç”Ÿæˆçš„è¿æ¥å¯¹è±¡ä¸ªæ•° maxActive æ± å†…æœ€å¤§è¿æ¥æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ç”Ÿæˆè¿æ¥çš„çº¿ç¨‹åœ¨å½“å‰æ± å†…è¿æ¥æ•°è¶…è¿‡è¿™ä¸ªæŒ‡æ ‡åå°±ä¸å†å·¥ä½œäº†ï¼Œå‚è€ƒä¸»æµç¨‹3 minIdle æ± å†…æœ€å°é—²ç½®è¿æ¥æ•°ï¼Œå‚è€ƒæµç¨‹4.1 maxWait åœ¨ä¸šåŠ¡çº¿ç¨‹æ‹¿ä¸åˆ°å¯ç”¨è¿æ¥è€Œå‘ç”Ÿæ’é˜Ÿæ—¶ï¼Œç­‰å¾…è·å–åˆ°å¯ç”¨è¿æ¥å¯¹è±¡çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œå‚è€ƒä¸»æµç¨‹1å’Œæµç¨‹1.2 notFullTimeoutRetryCount è·å–ä¸åˆ°è¿æ¥æ—¶ï¼Œä¼šå°è¯•é‡è¯•ï¼Œè¿™é‡Œè¡¨ç¤ºæœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œå‚è€ƒä¸»æµç¨‹1 testOnBorrow åœ¨å–å‡ºé“¾æ¥æ—¶ï¼Œæ˜¯å¦è¿›è¡Œè¿æ¥å¯ç”¨æ€§æµ‹è¯•ï¼Œé»˜è®¤ä¸å¼€å¯ï¼Œå‚è€ƒä¸»æµç¨‹1 testOnReturn åœ¨å›æ”¶è¿æ¥æ—¶ï¼Œæ˜¯å¦è¿›è¡Œè¿æ¥å¯ç”¨æ€§æµ‹è¯•ï¼Œé»˜è®¤ä¸å¼€å¯ï¼Œå‚è€ƒä¸»æµç¨‹5 testWhileIdle åœ¨é—²ç½®æ—¶é—´è¶…å‡ºæŒ‡å®šæ—¶é—´ï¼ˆtimeBetweenEvictionRunsMillisï¼‰åè¿›è¡Œè¿æ¥å¯ç”¨æ€§æµ‹è¯• timeBetweenEvictionRunsMillis é»˜è®¤60sï¼Œä¸€ä¸ªè¿æ¥é—²ç½®æ—¶é—´è¶…å‡ºè¯¥å€¼ï¼Œä¸”è®¾ç½®äº†testWhileIdleä¸ºtrueæ—¶ï¼Œè¿›è¡Œè¿æ¥å¯ç”¨æ€§æµ‹è¯• inited æ˜¯å¦å·²è¢«åˆå§‹åŒ–è¿‡ï¼Œå‚è€ƒä¸»æµç¨‹2 filtersï¼ˆé›†åˆï¼‰ è§¦å‘è´£ä»»é“¾æ‰§è¡Œæ—¶éœ€è¦æ‰§è¡Œçš„æ‰€æœ‰filter maxWaitThreadCount é»˜è®¤ä¸å¼€å¯ï¼ˆ-1ï¼‰ï¼Œè¡¨ç¤ºå–ä¸åˆ°è¿æ¥å‘ç”Ÿç­‰å¾…æ—¶é˜»å¡çš„æœ€å¤§ä¸šåŠ¡çº¿ç¨‹æ•°ï¼Œå‚è€ƒæµç¨‹1.2 removeAbandoned æ˜¯å¦ä¸»åŠ¨å›æ”¶ä¸€äº›è¢«æ‹¿å‡ºå»ä½¿ç”¨é•¿ä¹…æ²¡æœ‰å½’è¿˜çš„è¿æ¥ï¼Œé»˜è®¤ä¸å¼€å¯ï¼Œå‚è€ƒæµç¨‹4.2 removeAbandonedTimeoutMillis è¡¨ç¤ºåœ¨removeAbandonedå¼€å¯çš„æƒ…å†µä¸‹ï¼Œè§¦å‘ä¸»åŠ¨å½’è¿˜çš„æ—¶é—´é—´éš”ã€‚ dbType æ ‡è®°è¯¥è¿æ¥æ± å¯¹è±¡æ˜¯å±äºä»€ä¹ˆæ•°æ®åº“ç±»å‹ï¼ˆæ ¹æ®é©±åŠ¨åè®®å¤´æ¨ç®—å‡ºæ¥ï¼‰ validConnectionChecker druidæœ‰å¤šä¸ªéªŒè¯é•¿è¿æ¥å¯ç”¨æ€§çš„checkerå¯¹è±¡ï¼Œè¯¥å±æ€§æœ€ç»ˆä¼šæ ¹æ®æ•°æ®åº“ç±»å‹é€‚é…åˆé€‚çš„checkerå¯¹è±¡ï¼Œå‚è€ƒæµç¨‹1.3é‡Œçš„init-checker lock æ§åˆ¶è¿æ¥æ± çº¿ç¨‹å®‰å…¨çš„å…¨å±€é‡å…¥é”ï¼ˆå‚è€ƒå…¨éƒ¨æµç¨‹é‡Œå‡ºç°çš„lockï¼‰ notEmpty ç”±lockåˆ›å»ºçš„Conditionï¼Œç”¨äºè¿æ¥ä¸å¤Ÿç”¨æ—¶é˜»å¡ä¸šåŠ¡çº¿ç¨‹ï¼ŒåŒæ—¶å”¤èµ·ä¸»æµç¨‹3çš„å®ˆæŠ¤çº¿ç¨‹è¿½åŠ è¿æ¥ï¼Œè§£é‡Šå‚è€ƒä¸»æµç¨‹2çš„ç‰¹åˆ«è¯´æ˜ç¬¬2æ¡ empty ç”±lockåˆ›å»ºçš„Conditionï¼Œç”¨äºè¿æ¥è¶³å¤Ÿæ—¶ï¼ˆä¸å‘ç”Ÿçº¿ç¨‹ç­‰å¾…ï¼‰ï¼Œé˜»å¡ä¸»æµç¨‹3çš„å®ˆæŠ¤çº¿ç¨‹ï¼Œè§£é‡Šå‚è€ƒä¸»æµç¨‹2çš„ç‰¹åˆ«è¯´æ˜ç¬¬2æ¡ activeConnectionLock æ´»åŠ¨è¿æ¥é‡å…¥é”ï¼Œè¢«å€Ÿå‡ºå»çš„è¿æ¥ç§°ä¸ºactiveè¿æ¥ï¼Œè¿™ç±»è¿æ¥åœ¨removeAbandonedå¼€å¯æ—¶ä¼šè¢«ä¿å­˜è¿›ä¸‹é¢çš„activeConnectionsé‡Œï¼Œåˆ©ç”¨è¯¥é”å®Œæˆå¯¹å…¶æ“ä½œçš„å®‰å…¨æ€§ï¼Œå‚è€ƒä¸»æµç¨‹1å’Œæµç¨‹4.2 activeConnectionsï¼ˆk-vï¼‰ è§£é‡Šå‚è€ƒä¸Šé¢çš„æè¿°ï¼Œå‚è€ƒä¸»æµç¨‹1å’Œæµç¨‹4.2 è¡¨1-1 æ–¹æ³•è¡¨ æ–¹æ³•å è¯´æ˜ testConnectionInternal æµ‹è¯•è¿æ¥å¯ç”¨æ€§çš„åŸºæœ¬æ–¹æ³•ï¼Œå‚è€ƒæµç¨‹1.3 createPhysicalConnection æ–°å¢çœŸæ­£çš„æ•°æ®åº“ç‰©ç†è¿æ¥ï¼Œå‚è€ƒæµç¨‹2.1 è¡¨1-2 DruidDataSourceç±»è¿™ä¸ªç±»ä¹Ÿæ˜¯druidè¿æ¥æ± åŸºç¡€ç±»ï¼Œæ‰©å±•äº†ä¸€äº›å…¶çˆ¶ç±»çš„åŠŸèƒ½ï¼Œå‡ ä¹æ‰€æœ‰çš„æœ‰å…³è¿æ¥æ± ç®¡ç†çš„æ“ä½œéƒ½åœ¨æ­¤ç±»å®Œæˆã€‚ å±æ€§è¡¨ å±æ€§å è¯´æ˜ connectCount ä¸€å…±æˆåŠŸä»è¯¥æ± è·å–äº†å¤šå°‘æ¬¡è¿æ¥ï¼ˆåªè¦è·å–æˆåŠŸä¸€æ¬¡ï¼Œå°±ç´¯åŠ ä¸€æ¬¡ï¼‰ recycleCount ä¸€å…±æˆåŠŸå½’è¿˜äº†å¤šå°‘æ¬¡è¿æ¥åˆ°è¯¥æ± ï¼ˆæˆåŠŸå½’è¿˜ä¸€æ¬¡ï¼Œç´¯åŠ ä¸€æ¬¡ï¼‰ removeAbandonedCount åœ¨removeAbandonedå¼€å¯çš„æƒ…å†µä¸‹ï¼Œè¢«æ£€æŸ¥åå¼ºåˆ¶å½’è¿˜çš„è¿æ¥æ•° connectionsï¼ˆæ•°ç»„ï¼‰ æœ€ç»ˆæ± å­é‡Œæ²¡æœ‰è¢«ä½¿ç”¨çš„é—²ç½®è¿æ¥å­˜æ”¾çš„åœ°æ–¹ï¼Œç±»å‹æ˜¯DruidConnectionHolder poolingCount pollingCountå°±æ˜¯æŒ‡ä¸Šé¢connectionsçš„çœŸå®æ•°é‡ activeCount å½“å‰å¤„äºå€Ÿå‡ºçŠ¶æ€çš„è¿æ¥æ•°ï¼ˆä¹Ÿå³æ˜¯è¢«æ‹¿å‡ºå»ä½¿ç”¨çš„è¿æ¥æ•°ï¼‰ï¼ŒpoolingCount+activeCountå°±æ˜¯å½“å‰è¯¥æ± å­é‡Œä¸€å…±æœ‰å¤šå°‘ä¸ªè¿æ¥ï¼Œä¸èƒ½è¶…è¿‡maxActiveï¼Œå‚è€ƒä¸»æµç¨‹3 discardCount è¢«ä¸¢å¼ƒçš„è¿æ¥æ•°ï¼Œè§¦å‘ä¸¢å¼ƒçš„åœ°æ–¹æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚æµç¨‹1.4ã€æµç¨‹4.1 evictConnectionsï¼ˆæ•°ç»„ï¼‰ å‚è€ƒæµç¨‹4.1 keepAliveConnectionsï¼ˆæ•°ç»„ï¼‰ å‚è€ƒæµç¨‹4.1 createConnectionThreadï¼ˆçº¿ç¨‹ï¼‰ ç”Ÿäº§è¿æ¥çš„å®ˆæŠ¤çº¿ç¨‹ï¼Œå‚è€ƒä¸»æµç¨‹3 destroyConnectionThreadï¼ˆçº¿ç¨‹ï¼‰ æŠ›å¼ƒè¿æ¥çš„å®ˆæŠ¤çº¿ç¨‹ï¼Œå‚è€ƒä¸»æµç¨‹4 logStatsThreadï¼ˆçº¿ç¨‹ï¼‰ æ‰“å°è¿æ¥æ± å„é¡¹ç›‘æ§æŒ‡æ ‡æ—¥å¿—çš„å®ˆæŠ¤çº¿ç¨‹ï¼Œå‚è€ƒä¸»æµç¨‹2ï¼Œé»˜è®¤å…³é—­ initedLatchï¼ˆCountDownLatchï¼‰ å€’è®¡æ•°å™¨ï¼Œç”¨æ¥ä¿è¯createConnectionThreadå’ŒdestroyConnectionThreadä¸¤ä¸ªå®ˆæŠ¤çº¿ç¨‹å…¨éƒ¨å¼€å¯æˆåŠŸã€‚ enable è¿æ¥æ± å¯¹è±¡æ˜¯å¦å¯ç”¨ï¼Œåœ¨è¿æ¥æ± æ•´ä½“closeåï¼Œè¯¥å€¼ä¸ºfalseï¼Œè¡¨ç¤ºå·²å…³é—­çš„è¿æ¥æ± ä¸å¯ç”¨ã€‚ keepAlive å‚è€ƒæµç¨‹4.1 loadSpifilterSkip æ˜¯å¦å¯ç”¨é€šè¿‡SPIæœºåˆ¶åŠ è½½è´£ä»»é“¾ä¸Šçš„filterï¼Œé»˜è®¤å¼€å¯ è¡¨2-1 æ–¹æ³•è¡¨ æ–¹æ³•å è¯´æ˜ init åˆå§‹åŒ–æ•´ä¸ªè¿æ¥æ± ï¼Œå‚è€ƒä¸»æµç¨‹2 initFromSPIServiceLoader é€šè¿‡SPIæœºåˆ¶åŠ è½½è´£ä»»é“¾ä¸­çš„filters initValidConnectionChecker åˆå§‹åŒ–ï¼ˆé€‚é…ï¼‰æ£€æµ‹å™¨ï¼Œå‚è€ƒæµç¨‹1.3ä¸­çš„init-checker createAndLogThread å¯åŠ¨ä¸Šé¢è¡¨2-1é‡Œçš„logStatsThreadçº¿ç¨‹ createAndStartCreatorThread å¯åŠ¨ä¸Šé¢è¡¨2-1é‡Œçš„createConnectionThreadçº¿ç¨‹ createAndStartDestroyThread å¯åŠ¨ä¸Šé¢è¡¨2-1é‡Œçš„destroyConnectionThreadçº¿ç¨‹ getConnection è·å–è¿æ¥æ–¹æ³•ï¼Œå‚è€ƒä¸»æµç¨‹1 getConnectionDirect è·å–è¿æ¥æ–¹æ³•ï¼ˆé€šè¿‡getConnectionè§¦å‘ï¼‰ï¼Œå‚è€ƒä¸»æµç¨‹1 pollLast çœŸæ­£ä»æ± å­é‡Œè·å–è¿æ¥å¯¹è±¡çš„æ–¹æ³•ï¼ˆé€šè¿‡getConnectionDirectè§¦å‘ï¼‰ï¼Œå‚è€ƒæµç¨‹1.2 putLast çœŸæ­£å½’è¿˜è¿æ¥è¿›æ± å­çš„æ–¹æ³•ï¼ˆé€šè¿‡recycleè§¦å‘ï¼‰ï¼Œå‚è€ƒä¸»æµç¨‹5 put æ–°å¢è¿æ¥å¯¹è±¡æ”¾è¿›æ± å­é‡Œçš„æ–¹æ³•ï¼Œé€šè¿‡ä¸»æµç¨‹3è§¦å‘ close è¿æ¥æ± å…³é—­ï¼Œä¸å†æä¾›æœåŠ¡ï¼Œè¿…é€Ÿå¹²æ‰æ‰€æœ‰è¿æ¥è¿›å…¥è´¤è€…æ¨¡å¼ã€‚ recycle è¿æ¥å›æ”¶æ–¹æ³•ï¼Œé€šè¿‡ä¸‹é¢DruidPooledConnectionç±»çš„closeæ–¹æ³•è§¦å‘ï¼Œå‚è€ƒä¸»æµç¨‹5 shrink è¿æ¥æ± ç˜¦èº«ï¼Œå‚è€ƒä¸»æµç¨‹4ã€æµç¨‹4.1 removeAbandoned å›æ”¶é•¿æœŸæœªå›æ”¶çš„è¿æ¥ï¼Œé»˜è®¤å…³é—­ä¸æ£€æŸ¥ï¼Œé€šè¿‡è¡¨1-1é‡Œçš„removeAbandonedå±æ€§æ§åˆ¶ emptySignal è§¦å‘è¡¨1-1é‡Œçš„emptyæ‰§è¡Œsignalï¼Œç”¨äºå”¤èµ·ä¸»æµç¨‹3æ–°å¢è¿æ¥ è¡¨2-2 DruidConnectionHolderç±»æœ€ç»ˆå­˜æ”¾è¿›æ± å­é‡Œçš„åŸºæœ¬ç±»å‹ï¼Œè¯¥ç±»æŒæœ‰é©±åŠ¨äº§ç”Ÿçš„çœŸå®Connectionå¯¹è±¡ï¼ŒåŒæ—¶æä¾›ä¸€äº›è¿æ¥æ± éœ€è¦çš„æ ‡è®°æ€§çš„å±æ€§ã€‚ å±æ€§è¡¨ å±æ€§å è¯´æ˜ dataSourceï¼ˆDruidDataSourceï¼‰ æœ¬èº«åŒ…å«ä¸€ä¸ªæŒæœ‰è‡ªå·±å®ä¾‹çš„è¿æ¥æ± å¯¹è±¡ connï¼ˆConnectionï¼‰ çœŸå®çš„é©±åŠ¨è¿æ¥å¯¹è±¡ lastActiveTimeMillis ä¸Šæ¬¡æ´»åŠ¨æ—¶é—´ï¼Œè¯¥å€¼åœ¨å½’è¿˜è¿æ¥æ—¶ä¼šè¢«åˆ·æ–°ä¸€æ¬¡ï¼Œå‚è€ƒä¸»æµç¨‹5ï¼Œé™¤æ­¤ä¹‹å¤–åœ¨ä¸€å¥sqlæ‰§è¡Œç»“æŸåï¼Œè¿™ä¸ªå€¼ä¹Ÿä¼šè¢«åˆ·æ–° defaultReadOnly æ˜¯å¦é»˜è®¤ä¸ºåªè¯»æ¨¡å¼ï¼Œé»˜è®¤ä¸æ˜¯ defaultAutoCommit æ˜¯å¦é»˜è®¤å¼€å¯AutoCommitï¼Œé»˜è®¤å¼€å¯ discard å½“å‰è¿æ¥æ˜¯å¦å·²è¢«æŠ›å¼ƒ è¡¨3-1 æ–¹æ³•è¡¨ æ–¹æ³•å è¯´æ˜ reset åœ¨è¿æ¥å¯¹è±¡è¢«å½’è¿˜æ—¶ï¼Œç”±äºä½¿ç”¨æ—¶å¯èƒ½è¢«ä¸šåŠ¡ä»£ç äººä¸ºçš„æ”¹åŠ¨ä¸€äº›å±æ€§ï¼ˆæ¯”å¦‚autoCommitç­‰ï¼‰éœ€è¦æŠŠä¸€äº›å±æ€§é‡æ–°ç½®ä¸ºé»˜è®¤å€¼ï¼Œå°±éœ€è¦è¯¥æ–¹æ³• è¡¨3-2 DruidPooledConnectionç±»å¯¹å¤–æš´éœ²ç»™ä¸šåŠ¡æ–¹çš„è¿æ¥å¯¹è±¡åŒ…è£…ç±»ï¼Œå®é™…ä¸Šå…¶å†…éƒ¨æ˜¯åŒ…äº†ä¸€å±‚ä¸Šé¢çš„holderå¯¹è±¡ã€‚ å±æ€§è¡¨ å±æ€§å è¯´æ˜ connï¼ˆConnectionï¼‰ å®é™…çš„é©±åŠ¨è¿æ¥å¯¹è±¡ï¼Œé€šè¿‡ä¸‹é¢æŒæœ‰çš„holderå¯¹è±¡è·å¾—å¹¶èµ‹å€¼ holderï¼ˆDruidConnectionHolderï¼‰ æŒæœ‰çš„holderå¯¹è±¡ disable æ ‡è®°æ˜¯å¦å¯ç”¨ ownerThread æ ‡è®°æœ€åˆè·å–åˆ°è‡ªå·±çš„é‚£ä¸ªçº¿ç¨‹ï¼ˆç”¨äºå†³å®šåœ¨closeæ—¶èµ°ä¸‹æ–¹çš„closeè¿˜æ˜¯syncCloseï¼Œå‚è€ƒä¸»æµç¨‹5ï¼‰ closed æ ‡è®°æ˜¯å¦å·²è¢«å…³é—­ running æ ‡è®°æ˜¯å¦æ­£åœ¨è¿è¡Œä¸­ï¼Œrunningè¢«ç½®ä¸ºtrueçš„åœ°æ–¹ï¼Œå°±æ˜¯æ‰§è¡Œexcuteæ–¹æ³•æ—¶ã€‚ abandoned æ ‡è®°æ˜¯å¦å·²è¢«æ£€æŸ¥å¹¶ä¸¢å¼ƒï¼Œå‚è€ƒæµç¨‹4.2 è¡¨4-1 æ–¹æ³•è¡¨ æ–¹æ³•å è¯´æ˜ close å…³é—­è¯¥è¿æ¥ï¼Œå°†å®é™…è¿æ¥å½’è¿˜è‡³è¿æ¥æ± ï¼Œå‚è€ƒä¸»æµç¨‹5 syncClose å¦‚æœæ˜¯åˆ«çš„çº¿ç¨‹æ‰§è¡Œcloseæ–¹æ³•ï¼Œå°±å¾—å¯ç”¨è¯¥æ–¹æ³•å»åšï¼Œè¯¥æ–¹æ³•ä¸ä¸Šé¢closeçš„åŒºåˆ«å°±æ˜¯åŠ äº†é”æ§åˆ¶ï¼Œå‚è€ƒæµç¨‹5 recycle å®é™…è§¦å‘datasource.recycleæ–¹æ³•çš„æ–¹æ³•ï¼Œå‚è€ƒæµç¨‹5 å¸¸è§„æ“ä½œ æœ‰createStatementã€commitã€rollbackç­‰ç­‰å¸¸è§„æ“ä½œï¼Œæœ¬ç¯‡æ–‡ç« ä¸æ¶‰åŠåˆ°ï¼Œä»…åšè¿æ¥æ± çš„è¯´æ˜ï¼Œæš‚æ—¶å¿½ç•¥ã€‚ è¡¨4-2","link":"/2019/09/20/Druid-%E7%B1%BB%E5%9B%BE-%E5%B1%9E%E6%80%A7%E8%A1%A8/"},{"title":"æ± åŒ–æŠ€æœ¯ï¼ˆäºŒï¼‰HikariCPæ˜¯å¦‚ä½•ç®¡ç†æ•°æ®åº“è¿æ¥çš„ï¼Ÿ","text":"åŸºäºä¾èµ–ç¨‹åºçš„ç‰ˆæœ¬ä¿¡æ¯ï¼š&nbsp;&nbsp; ä¸Šä¸€ç¯‡ï¼šDruidæ˜¯å¦‚ä½•ç®¡ç†æ•°æ®åº“è¿æ¥çš„ é›¶ã€ç±»å›¾å’Œæµç¨‹å›¾å¼€å§‹å‰å…ˆæ¥äº†è§£ä¸‹HikariCPè·å–ä¸€ä¸ªè¿æ¥æ—¶ç±»é—´çš„äº¤äº’æµç¨‹ï¼Œæ–¹ä¾¿ä¸‹é¢è¯¦ç»†æµç¨‹çš„é˜…è¯»ã€‚ è·å–è¿æ¥æ—¶çš„ç±»é—´äº¤äº’ï¼š ä¸€ã€ä¸»æµç¨‹1ï¼šè·å–è¿æ¥æµç¨‹HikariCPè·å–è¿æ¥æ—¶çš„å…¥å£æ˜¯HikariDataSourceé‡Œçš„getConnectionæ–¹æ³•ï¼Œç°åœ¨æ¥çœ‹ä¸‹è¯¥æ–¹æ³•çš„å…·ä½“æµç¨‹ï¼š ä¸Šè¿°ä¸ºHikariCPè·å–è¿æ¥æ—¶çš„æµç¨‹å›¾ï¼Œç”±å›¾1å¯çŸ¥ï¼Œæ¯ä¸ªdatasourceå¯¹è±¡é‡Œéƒ½ä¼šæŒæœ‰ä¸€ä¸ªHikariPoolå¯¹è±¡ï¼Œè®°ä¸ºpoolï¼Œåˆå§‹åŒ–åçš„datasourceå¯¹è±¡poolæ˜¯ç©ºçš„ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡getConnectionçš„æ—¶å€™ä¼šè¿›è¡Œå®ä¾‹åŒ–poolå±æ€§ï¼ˆå‚è€ƒä¸»æµç¨‹1ï¼‰ï¼Œåˆå§‹åŒ–çš„æ—¶å€™éœ€è¦å°†å½“å‰datasourceé‡Œçš„configå±æ€§ä¼ è¿‡å»ï¼Œç”¨äºpoolçš„åˆå§‹åŒ–ï¼Œæœ€ç»ˆæ ‡è®°sealedï¼Œç„¶åæ ¹æ®poolå¯¹è±¡è°ƒç”¨getConnectionæ–¹æ³•ï¼ˆå‚è€ƒæµç¨‹1.1ï¼‰ï¼Œè·å–æˆåŠŸåè¿”å›è¿æ¥å¯¹è±¡ã€‚ äºŒã€ä¸»æµç¨‹2ï¼šåˆå§‹åŒ–æ± å¯¹è±¡ è¯¥æµç¨‹ç”¨äºåˆå§‹åŒ–æ•´ä¸ªè¿æ¥æ± ï¼Œè¿™ä¸ªæµç¨‹ä¼šç»™è¿æ¥æ± å†…æ‰€æœ‰çš„å±æ€§åšåˆå§‹åŒ–çš„å·¥ä½œï¼Œå…¶ä¸­æ¯”è¾ƒä¸»è¦çš„å‡ ä¸ªæµç¨‹ä¸Šå›¾å·²ç»æŒ‡å‡ºï¼Œç®€å•æ¦‚æ‹¬ä¸€ä¸‹ï¼š åˆ©ç”¨configåˆå§‹åŒ–å„ç§è¿æ¥æ± å±æ€§ï¼Œå¹¶ä¸”äº§ç”Ÿä¸€ä¸ªç”¨äºç”Ÿäº§ç‰©ç†è¿æ¥çš„æ•°æ®æºDriverDataSource åˆå§‹åŒ–å­˜æ”¾è¿æ¥å¯¹è±¡çš„æ ¸å¿ƒç±»connectionBag åˆå§‹åŒ–ä¸€ä¸ªå»¶æ—¶ä»»åŠ¡çº¿ç¨‹æ± ç±»å‹çš„å¯¹è±¡houseKeepingExecutorServiceï¼Œç”¨äºåç»­æ‰§è¡Œä¸€äº›å»¶æ—¶/å®šæ—¶ç±»ä»»åŠ¡ï¼ˆæ¯”å¦‚è¿æ¥æ³„æ¼æ£€æŸ¥å»¶æ—¶ä»»åŠ¡ï¼Œå‚è€ƒæµç¨‹2.2ä»¥åŠä¸»æµç¨‹4ï¼Œé™¤æ­¤ä¹‹å¤–maxLifeTimeåä¸»åŠ¨å›æ”¶å…³é—­è¿æ¥ä¹Ÿæ˜¯äº¤ç”±è¯¥å¯¹è±¡æ¥æ‰§è¡Œçš„ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯ä»¥å‚è€ƒä¸»æµç¨‹3ï¼‰ é¢„çƒ­è¿æ¥æ± ï¼ŒHikariCPä¼šåœ¨è¯¥æµç¨‹çš„checkFailFasté‡Œåˆå§‹åŒ–å¥½ä¸€ä¸ªè¿æ¥å¯¹è±¡æ”¾è¿›æ± å­å†…ï¼Œå½“ç„¶è§¦å‘è¯¥æµç¨‹å¾—ä¿è¯initializationTimeout &gt; 0æ—¶ï¼ˆé»˜è®¤å€¼1ï¼‰ï¼Œè¿™ä¸ªé…ç½®å±æ€§è¡¨ç¤ºç•™ç»™é¢„çƒ­æ“ä½œçš„æ—¶é—´ï¼ˆé»˜è®¤å€¼1åœ¨é¢„çƒ­å¤±è´¥æ—¶ä¸ä¼šå‘ç”Ÿé‡è¯•ï¼‰ã€‚ä¸Druidé€šè¿‡initialSizeæ§åˆ¶é¢„çƒ­è¿æ¥å¯¹è±¡æ•°ä¸ä¸€æ ·çš„æ˜¯ï¼ŒHikariCPä»…é¢„çƒ­è¿›æ± ä¸€ä¸ªè¿æ¥å¯¹è±¡ã€‚ åˆå§‹åŒ–ä¸€ä¸ªçº¿ç¨‹æ± å¯¹è±¡addConnectionExecutorï¼Œç”¨äºåç»­æ‰©å……è¿æ¥å¯¹è±¡ åˆå§‹åŒ–ä¸€ä¸ªçº¿ç¨‹æ± å¯¹è±¡closeConnectionExecutorï¼Œç”¨äºå…³é—­ä¸€äº›è¿æ¥å¯¹è±¡ï¼Œæ€ä¹ˆè§¦å‘å…³é—­ä»»åŠ¡å‘¢ï¼Ÿå¯ä»¥å‚è€ƒæµç¨‹1.1.2 ä¸‰ã€æµç¨‹1.1ï¼šé€šè¿‡HikariPoolè·å–è¿æ¥å¯¹è±¡ ä»æœ€å¼€å§‹çš„ç»“æ„å›¾å¯çŸ¥ï¼Œæ¯ä¸ªHikariPoolé‡Œéƒ½ç»´æŠ¤ä¸€ä¸ªConcurrentBagå¯¹è±¡ï¼Œç”¨äºå­˜æ”¾è¿æ¥å¯¹è±¡ï¼Œç”±ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œå®é™…ä¸ŠHikariPoolçš„getConnectionå°±æ˜¯ä»ConcurrentBagé‡Œè·å–è¿æ¥çš„ï¼ˆè°ƒç”¨å…¶borrowæ–¹æ³•è·å¾—ï¼Œå¯¹åº”ConnectionBagä¸»æµç¨‹ï¼‰ï¼Œåœ¨é•¿è¿æ¥æ£€æŸ¥è¿™å—ï¼Œä¸ä¹‹å‰è¯´çš„Druidä¸åŒï¼Œè¿™é‡Œçš„é•¿è¿æ¥åˆ¤æ´»æ£€æŸ¥åœ¨è¿æ¥å¯¹è±¡æ²¡æœ‰è¢«æ ‡è®°ä¸ºâ€œå·²ä¸¢å¼ƒâ€æ—¶ï¼Œåªè¦è·ç¦»ä¸Šæ¬¡ä½¿ç”¨è¶…è¿‡500msæ¯æ¬¡å–å‡ºéƒ½ä¼šè¿›è¡Œæ£€æŸ¥ï¼ˆ500msæ˜¯é»˜è®¤å€¼ï¼Œå¯é€šè¿‡é…ç½®com.zaxxer.hikari.aliveBypassWindowMsçš„ç³»ç»Ÿå‚æ•°æ¥æ§åˆ¶ï¼‰ï¼Œemmmmï¼Œä¹Ÿå°±æ˜¯è¯´HikariCPå¯¹é•¿è¿æ¥çš„æ´»æ€§æ£€æŸ¥å¾ˆé¢‘ç¹ï¼Œä½†æ˜¯å…¶å¹¶å‘æ€§èƒ½ä¾æ—§ä¼˜äºDruidï¼Œè¯´æ˜é¢‘ç¹çš„é•¿è¿æ¥æ£€æŸ¥å¹¶ä¸æ˜¯å¯¼è‡´è¿æ¥æ± æ€§èƒ½é«˜ä½çš„å…³é”®æ‰€åœ¨ã€‚ è¿™ä¸ªå…¶å®æ˜¯ç”±äºHikariCPçš„æ— é”å®ç°ï¼Œåœ¨é«˜å¹¶å‘æ—¶å¯¹CPUçš„è´Ÿè½½æ²¡æœ‰å…¶ä»–è¿æ¥æ± é‚£ä¹ˆé«˜è€Œäº§ç”Ÿçš„å¹¶å‘æ€§èƒ½å·®å¼‚ï¼Œåé¢ä¼šè¯´HikariCPçš„å…·ä½“åšæ³•ï¼Œå³ä½¿æ˜¯Druidï¼Œåœ¨è·å–è¿æ¥ã€ç”Ÿæˆè¿æ¥ã€å½’è¿˜è¿æ¥æ—¶éƒ½è¿›è¡Œäº†é”æ§åˆ¶ï¼Œå› ä¸ºé€šè¿‡ä¸Šç¯‡è§£æDruidçš„æ–‡ç« å¯ä»¥çŸ¥é“ï¼ŒDruidé‡Œçš„è¿æ¥æ± èµ„æºæ˜¯å¤šçº¿ç¨‹å…±äº«çš„ï¼Œä¸å¯é¿å…çš„ä¼šæœ‰é”ç«äº‰ï¼Œæœ‰é”ç«äº‰æ„å‘³ç€çº¿ç¨‹çŠ¶æ€çš„å˜åŒ–ä¼šå¾ˆé¢‘ç¹ï¼Œçº¿ç¨‹çŠ¶æ€å˜åŒ–é¢‘ç¹æ„å‘³ç€CPUä¸Šä¸‹æ–‡åˆ‡æ¢ä¹Ÿå°†ä¼šå¾ˆé¢‘ç¹ã€‚ å›åˆ°æµç¨‹1.1ï¼Œå¦‚æœæ‹¿åˆ°çš„è¿æ¥ä¸ºç©ºï¼Œç›´æ¥æŠ¥é”™ï¼Œä¸ä¸ºç©ºåˆ™è¿›è¡Œç›¸åº”çš„æ£€æŸ¥ï¼Œå¦‚æœæ£€æŸ¥é€šè¿‡ï¼Œåˆ™åŒ…è£…æˆConnectionProxyå¯¹è±¡è¿”å›ç»™ä¸šåŠ¡æ–¹ï¼Œä¸é€šè¿‡åˆ™è°ƒç”¨closeConnectionæ–¹æ³•å…³é—­è¿æ¥ï¼ˆå¯¹åº”æµç¨‹1.1.2ï¼Œè¯¥æµç¨‹ä¼šè§¦å‘ConcurrentBagçš„removeæ–¹æ³•ä¸¢å¼ƒè¯¥è¿æ¥ï¼Œç„¶åæŠŠå®é™…çš„é©±åŠ¨è¿æ¥äº¤ç»™closeConnectionExecutorçº¿ç¨‹æ± ï¼Œå¼‚æ­¥å…³é—­é©±åŠ¨è¿æ¥ï¼‰ã€‚ å››ã€æµç¨‹1.1.1ï¼šè¿æ¥åˆ¤æ´» æ‰¿æ¥ä¸Šé¢çš„æµç¨‹1.1é‡Œçš„åˆ¤æ´»æµç¨‹ï¼Œæ¥çœ‹ä¸‹åˆ¤æ´»æ˜¯å¦‚ä½•åšçš„ï¼Œé¦–å…ˆè¯´éªŒè¯æ–¹æ³•ï¼ˆæ³¨æ„è¿™é‡Œè¯¥æ–¹æ³•æ¥å—çš„è¿™ä¸ªconnectionå¯¹è±¡ä¸æ˜¯poolEntryï¼Œè€Œæ˜¯poolEntryæŒæœ‰çš„å®é™…é©±åŠ¨çš„è¿æ¥å¯¹è±¡ï¼‰ï¼Œåœ¨ä¹‹å‰ä»‹ç»Druidçš„æ—¶å€™å°±çŸ¥é“ï¼ŒDruidæ˜¯æ ¹æ®é©±åŠ¨ç¨‹åºé‡Œæ˜¯å¦å­˜åœ¨pingæ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦å¯ç”¨pingçš„æ–¹å¼åˆ¤æ–­è¿æ¥æ˜¯å¦å­˜æ´»ï¼Œä½†æ˜¯åˆ°äº†HikariCPåˆ™æ›´åŠ ç®€å•ç²—æš´ï¼Œä»…æ ¹æ®æ˜¯å¦é…ç½®äº†connectionTestQueryè§‰å®šæ˜¯å¦å¯ç”¨pingï¼š 1this.isUseJdbc4Validation = config.getConnectionTestQuery() == null; ä»£ç å—1 æ‰€ä»¥ä¸€èˆ¬é©±åŠ¨å¦‚æœä¸æ˜¯ç‰¹åˆ«ä½çš„ç‰ˆæœ¬ï¼Œä¸å»ºè®®é…ç½®è¯¥é¡¹ï¼Œå¦åˆ™ä¾¿ä¼šèµ°createStatement+excuteçš„æ–¹å¼ï¼Œç›¸æ¯”pingç®€å•å‘é€å¿ƒè·³æ•°æ®ï¼Œè¿™ç§æ–¹å¼æ˜¾ç„¶æ›´ä½æ•ˆã€‚ æ­¤å¤–ï¼Œè¿™é‡Œåœ¨åˆšè¿›æ¥è¿˜ä¼šé€šè¿‡é©±åŠ¨çš„è¿æ¥å¯¹è±¡é‡æ–°ç»™å®ƒè®¾ç½®ä¸€énetworkTimeoutçš„å€¼ï¼Œä½¿ä¹‹å˜æˆvalidationTimeoutï¼Œè¡¨ç¤ºä¸€æ¬¡éªŒè¯çš„è¶…æ—¶æ—¶é—´ï¼Œä¸ºå•¥è¿™é‡Œè¦é‡æ–°è®¾ç½®è¿™ä¸ªå±æ€§å‘¢ï¼Ÿå› ä¸ºåœ¨ä½¿ç”¨pingæ–¹æ³•æ ¡éªŒæ—¶ï¼Œæ˜¯æ²¡åŠæ³•é€šè¿‡ç±»ä¼¼statementé‚£æ ·å¯ä»¥setQueryTimeoutçš„ï¼Œæ‰€ä»¥åªèƒ½ç”±ç½‘ç»œé€šä¿¡çš„è¶…æ—¶æ—¶é—´æ¥æ§åˆ¶ï¼Œè¿™ä¸ªæ—¶é—´å¯ä»¥é€šè¿‡jdbcçš„è¿æ¥å‚æ•°socketTimeoutæ¥æ§åˆ¶ï¼š 1jdbc:mysql://127.0.0.1:3306/xxx?socketTimeout=250 è¿™ä¸ªå€¼æœ€ç»ˆä¼šè¢«èµ‹å€¼ç»™HikariCPçš„networkTimeoutå­—æ®µï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ€åé‚£ä¸€æ­¥ä½¿ç”¨è¿™ä¸ªå­—æ®µæ¥è¿˜åŸé©±åŠ¨è¿æ¥è¶…æ—¶å±æ€§çš„åŸå› ï¼›è¯´åˆ°è¿™é‡Œï¼Œæœ€åé‚£é‡Œä¸ºå•¥è¦å†æ¬¡è¿˜åŸå‘¢ï¼Ÿè¿™å°±å¾ˆå®¹æ˜“ç†è§£äº†ï¼Œå› ä¸ºéªŒè¯ç»“æŸäº†ï¼Œè¿æ¥å¯¹è±¡è¿˜å­˜æ´»çš„æƒ…å†µä¸‹ï¼Œå®ƒçš„networkTimeoutçš„å€¼è¿™æ—¶ä»ç„¶ç­‰äºvalidationTimeoutï¼ˆä¸åˆé¢„æœŸï¼‰ï¼Œæ˜¾ç„¶åœ¨æ‹¿å‡ºå»ç”¨ä¹‹å‰ï¼Œéœ€è¦æ¢å¤æˆæœ¬æ¥çš„å€¼ï¼Œä¹Ÿå°±æ˜¯HikariCPé‡Œçš„networkTimeoutå±æ€§ã€‚ äº”ã€æµç¨‹1.1.2ï¼šå…³é—­è¿æ¥å¯¹è±¡ è¿™ä¸ªæµç¨‹ç®€å•æ¥è¯´å°±æ˜¯æŠŠæµç¨‹1.1.1ä¸­éªŒè¯ä¸é€šè¿‡çš„æ­»è¿æ¥ï¼Œä¸»åŠ¨å…³é—­çš„ä¸€ä¸ªæµç¨‹ï¼Œé¦–å…ˆä¼šæŠŠè¿™ä¸ªè¿æ¥å¯¹è±¡ä»ConnectionBagé‡Œç§»é™¤ï¼Œç„¶åæŠŠå®é™…çš„ç‰©ç†è¿æ¥äº¤ç»™ä¸€ä¸ªçº¿ç¨‹æ± å»å¼‚æ­¥æ‰§è¡Œï¼Œè¿™ä¸ªçº¿ç¨‹æ± å°±æ˜¯åœ¨ä¸»æµç¨‹2é‡Œåˆå§‹åŒ–æ± çš„æ—¶å€™åˆå§‹åŒ–çš„çº¿ç¨‹æ± closeConnectionExecutorï¼Œç„¶åå¼‚æ­¥ä»»åŠ¡å†…å¼€å§‹å®é™…çš„å…³è¿æ¥æ“ä½œï¼Œå› ä¸ºä¸»åŠ¨å…³é—­äº†ä¸€ä¸ªè¿æ¥ç›¸å½“äºå°‘äº†ä¸€ä¸ªè¿æ¥ï¼Œæ‰€ä»¥è¿˜ä¼šè§¦å‘ä¸€æ¬¡æ‰©å……è¿æ¥æ± ï¼ˆå‚è€ƒä¸»æµç¨‹5ï¼‰æ“ä½œã€‚ å…­ã€æµç¨‹2.1ï¼šHikariCPç›‘æ§è®¾ç½®ä¸åŒäºDruidé‚£æ ·ç›‘æ§æŒ‡æ ‡é‚£ä¹ˆå¤šï¼ŒHikariCPä¼šæŠŠæˆ‘ä»¬éå¸¸å…³å¿ƒçš„å‡ é¡¹æŒ‡æ ‡æš´éœ²ç»™æˆ‘ä»¬ï¼Œæ¯”å¦‚å½“å‰è¿æ¥æ± å†…é—²ç½®è¿æ¥æ•°ã€æ€»è¿æ¥æ•°ã€ä¸€ä¸ªè¿æ¥è¢«ç”¨äº†å¤šä¹…å½’è¿˜ã€åˆ›å»ºä¸€ä¸ªç‰©ç†è¿æ¥èŠ±è´¹å¤šä¹…ç­‰ï¼ŒHikariCPçš„è¿æ¥æ± çš„ç›‘æ§æˆ‘ä»¬è¿™ä¸€èŠ‚ä¸“é—¨è¯¦ç»†çš„åˆ†è§£ä¸€ä¸‹ï¼Œé¦–å…ˆæ‰¾åˆ°HikariCPä¸‹é¢çš„metricsæ–‡ä»¶å¤¹ï¼Œè¿™ä¸‹é¢æ”¾ç½®äº†ä¸€äº›è§„èŒƒå®ç°çš„ç›‘æ§æ¥å£ç­‰ï¼Œè¿˜æœ‰ä¸€äº›ç°æˆçš„å®ç°ï¼ˆæ¯”å¦‚HikariCPè‡ªå¸¦å¯¹prometheusã€micrometerã€dropwizardçš„æ”¯æŒï¼Œä¸å¤ªäº†è§£åé¢ä¸¤ä¸ªï¼Œprometheusä¸‹æ–‡ç›´æ¥ç§°ä¸ºæ™®ç½—ç±³ä¿®æ–¯ï¼‰ï¼š ä¸‹é¢ï¼Œæ¥ç€é‡çœ‹ä¸‹æ¥å£çš„å®šä¹‰ï¼š 123456789101112131415161718//è¿™ä¸ªæ¥å£çš„å®ç°ä¸»è¦è´Ÿè´£æ”¶é›†ä¸€äº›åŠ¨ä½œçš„è€—æ—¶public interface IMetricsTracker extends AutoCloseable{ //è¿™ä¸ªæ–¹æ³•è§¦å‘ç‚¹åœ¨åˆ›å»ºå®é™…çš„ç‰©ç†è¿æ¥æ—¶ï¼ˆä¸»æµç¨‹3ï¼‰ï¼Œç”¨äºè®°å½•ä¸€ä¸ªå®é™…çš„ç‰©ç†è¿æ¥åˆ›å»ºæ‰€è€—è´¹çš„æ—¶é—´ default void recordConnectionCreatedMillis(long connectionCreatedMillis) {} //è¿™ä¸ªæ–¹æ³•è§¦å‘ç‚¹åœ¨getConnectionæ—¶ï¼ˆä¸»æµç¨‹1ï¼‰ï¼Œç”¨äºè®°å½•è·å–ä¸€ä¸ªè¿æ¥æ—¶å®é™…çš„è€—æ—¶ default void recordConnectionAcquiredNanos(final long elapsedAcquiredNanos) {} //è¿™ä¸ªæ–¹æ³•è§¦å‘ç‚¹åœ¨å›æ”¶è¿æ¥æ—¶ï¼ˆä¸»æµç¨‹6ï¼‰ï¼Œç”¨äºè®°å½•ä¸€ä¸ªè¿æ¥ä»è¢«è·å–åˆ°è¢«å›æ”¶æ—¶æ‰€æ¶ˆè€—çš„æ—¶é—´ default void recordConnectionUsageMillis(final long elapsedBorrowedMillis) {} //è¿™ä¸ªæ–¹æ³•è§¦å‘ç‚¹ä¹Ÿåœ¨getConnectionæ—¶ï¼ˆä¸»æµç¨‹1ï¼‰ï¼Œç”¨äºè®°å½•è·å–è¿æ¥è¶…æ—¶çš„æ¬¡æ•°ï¼Œæ¯å‘ç”Ÿä¸€æ¬¡è·å–è¿æ¥è¶…æ—¶ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡è¯¥æ–¹æ³•çš„è°ƒç”¨ default void recordConnectionTimeout() {} @Override default void close() {}} ä»£ç å—2 è§¦å‘ç‚¹éƒ½äº†è§£æ¸…æ¥šåï¼Œå†æ¥çœ‹çœ‹MetricsTrackerFactoryçš„æ¥å£å®šä¹‰ï¼š 123456//ç”¨äºåˆ›å»ºIMetricsTrackerå®ä¾‹ï¼Œå¹¶ä¸”æŒ‰éœ€è®°å½•PoolStatså¯¹è±¡é‡Œçš„å±æ€§ï¼ˆè¿™ä¸ªå¯¹è±¡é‡Œçš„å±æ€§å°±æ˜¯ç±»ä¼¼è¿æ¥æ± å½“å‰é—²ç½®è¿æ¥æ•°ä¹‹ç±»çš„çº¿ç¨‹æ± çŠ¶æ€ç±»æŒ‡æ ‡ï¼‰public interface MetricsTrackerFactory{ //è¿”å›ä¸€ä¸ªIMetricsTrackerå¯¹è±¡ï¼Œå¹¶ä¸”æŠŠPoolStatsä¼ äº†è¿‡å» IMetricsTracker create(String poolName, PoolStats poolStats);} ä»£ç å—3 ä¸Šé¢çš„æ¥å£ç”¨æ³•è§æ³¨é‡Šï¼Œé’ˆå¯¹æ–°å‡ºç°çš„PoolStatsç±»ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒåšäº†ä»€ä¹ˆï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445public abstract class PoolStats { private final AtomicLong reloadAt; //è§¦å‘ä¸‹æ¬¡åˆ·æ–°çš„æ—¶é—´ï¼ˆæ—¶é—´æˆ³ï¼‰ private final long timeoutMs; //åˆ·æ–°ä¸‹é¢çš„å„é¡¹å±æ€§å€¼çš„é¢‘ç‡ï¼Œé»˜è®¤1sï¼Œæ— æ³•æ”¹å˜ // æ€»è¿æ¥æ•° protected volatile int totalConnections; // é—²ç½®è¿æ¥æ•° protected volatile int idleConnections; // æ´»åŠ¨è¿æ¥æ•° protected volatile int activeConnections; // ç”±äºæ— æ³•è·å–åˆ°å¯ç”¨è¿æ¥è€Œé˜»å¡çš„ä¸šåŠ¡çº¿ç¨‹æ•° protected volatile int pendingThreads; // æœ€å¤§è¿æ¥æ•° protected volatile int maxConnections; // æœ€å°è¿æ¥æ•° protected volatile int minConnections; public PoolStats(final long timeoutMs) { this.timeoutMs = timeoutMs; this.reloadAt = new AtomicLong(); } //è¿™é‡Œä»¥è·å–æœ€å¤§è¿æ¥æ•°ä¸ºä¾‹ï¼Œå…¶ä»–çš„è·Ÿè¿™ä¸ªå·®ä¸å¤š public int getMaxConnections() { if (shouldLoad()) { //æ˜¯å¦åº”è¯¥åˆ·æ–° update(); //åˆ·æ–°å±æ€§å€¼ï¼Œæ³¨æ„è¿™ä¸ªupdateçš„å®ç°åœ¨HikariPoolé‡Œï¼Œå› ä¸ºè¿™äº›å±æ€§å€¼çš„ç›´æ¥æˆ–é—´æ¥æ¥æºéƒ½æ˜¯HikariPool } return maxConnections; } protected abstract void update(); //å®ç°åœ¨â†‘ä¸Šé¢å·²ç»è¯´äº† private boolean shouldLoad() { //æŒ‰ç…§æ›´æ–°é¢‘ç‡æ¥å†³å®šæ˜¯å¦åˆ·æ–°å±æ€§å€¼ for (; ; ) { final long now = currentTime(); final long reloadTime = reloadAt.get(); if (reloadTime &gt; now) { return false; } else if (reloadAt.compareAndSet(reloadTime, plusMillis(now, timeoutMs))) { return true; } } }} ä»£ç å—4 å®é™…ä¸Šè¿™é‡Œå°±æ˜¯è¿™äº›å±æ€§è·å–å’Œè§¦å‘åˆ·æ–°çš„åœ°æ–¹ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡æ˜¯åœ¨å“ªé‡Œè¢«ç”Ÿæˆå¹¶ä¸”ä¸¢ç»™MetricsTrackerFactoryçš„createæ–¹æ³•çš„å‘¢ï¼Ÿè¿™å°±æ˜¯æœ¬èŠ‚æ‰€éœ€è¦è®²è¿°çš„è¦ç‚¹ï¼šä¸»æµç¨‹2é‡Œçš„è®¾ç½®ç›‘æ§å™¨çš„æµç¨‹ï¼Œæ¥çœ‹çœ‹é‚£é‡Œå‘ç”Ÿäº†ä»€ä¹ˆäº‹å§ï¼š 123456789101112131415161718192021222324252627//ç›‘æ§å™¨è®¾ç½®æ–¹æ³•ï¼ˆæ­¤æ–¹æ³•åœ¨HikariPoolä¸­ï¼ŒmetricsTrackerå±æ€§å°±æ˜¯HikariPoolç”¨æ¥è§¦å‘IMetricsTrackeré‡Œæ–¹æ³•è°ƒç”¨çš„ï¼‰public void setMetricsTrackerFactory(MetricsTrackerFactory metricsTrackerFactory) { if (metricsTrackerFactory != null) { //MetricsTrackerDelegateæ˜¯åŒ…è£…ç±»ï¼Œæ˜¯HikariPoolçš„ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œæ˜¯å®é™…æŒæœ‰IMetricsTrackerå¯¹è±¡çš„ç±»ï¼Œä¹Ÿæ˜¯å®é™…è§¦å‘IMetricsTrackeré‡Œæ–¹æ³•è°ƒç”¨çš„ç±» //è¿™é‡Œé¦–å…ˆä¼šè§¦å‘MetricsTrackerFactoryç±»çš„createæ–¹æ³•æ‹¿åˆ°IMetricsTrackerå¯¹è±¡ï¼Œç„¶ååˆ©ç”¨getPoolStatsåˆå§‹åŒ–PoolStatå¯¹è±¡ï¼Œç„¶åä¹Ÿä¸€å¹¶ä¼ ç»™MetricsTrackerFactory this.metricsTracker = new MetricsTrackerDelegate(metricsTrackerFactory.create(config.getPoolName(), getPoolStats())); } else { //ä¸å¯ç”¨ç›‘æ§ï¼Œç›´æ¥ç­‰äºä¸€ä¸ªæ²¡æœ‰å®ç°æ–¹æ³•çš„ç©ºç±» this.metricsTracker = new NopMetricsTrackerDelegate(); }}private PoolStats getPoolStats() { //åˆå§‹åŒ–PoolStatså¯¹è±¡ï¼Œå¹¶ä¸”è§„å®š1sè§¦å‘ä¸€æ¬¡å±æ€§å€¼åˆ·æ–°çš„updateæ–¹æ³• return new PoolStats(SECONDS.toMillis(1)) { @Override protected void update() { //å®ç°äº†PoolStatçš„updateæ–¹æ³•ï¼Œåˆ·æ–°å„ä¸ªå±æ€§çš„å€¼ this.pendingThreads = HikariPool.this.getThreadsAwaitingConnection(); this.idleConnections = HikariPool.this.getIdleConnections(); this.totalConnections = HikariPool.this.getTotalConnections(); this.activeConnections = HikariPool.this.getActiveConnections(); this.maxConnections = config.getMaximumPoolSize(); this.minConnections = config.getMinimumIdle(); } };} ä»£ç å—5 åˆ°è¿™é‡ŒHikariCPçš„ç›‘æ§å™¨å°±ç®—æ˜¯æ³¨å†Œè¿›å»äº†ï¼Œæ‰€ä»¥è¦æƒ³å®ç°è‡ªå·±çš„ç›‘æ§å™¨æ‹¿åˆ°ä¸Šé¢çš„æŒ‡æ ‡ï¼Œè¦ç»è¿‡å¦‚ä¸‹æ­¥éª¤ï¼š æ–°å»ºä¸€ä¸ªç±»å®ç°IMetricsTrackeræ¥å£ï¼Œæˆ‘ä»¬è¿™é‡Œå°†è¯¥ç±»è®°ä¸ºIMetricsTrackerImpl æ–°å»ºä¸€ä¸ªç±»å®ç°MetricsTrackerFactoryæ¥å£ï¼Œæˆ‘ä»¬è¿™é‡Œå°†è¯¥ç±»è®°ä¸ºMetricsTrackerFactoryImplï¼Œå¹¶ä¸”å°†ä¸Šé¢çš„IMetricsTrackerImplåœ¨å…¶createæ–¹æ³•å†…å®ä¾‹åŒ– å°†MetricsTrackerFactoryImplå®ä¾‹åŒ–åè°ƒç”¨HikariPoolçš„setMetricsTrackerFactoryæ–¹æ³•æ³¨å†Œåˆ°Hikariè¿æ¥æ± ã€‚ ä¸Šé¢æ²¡æœ‰æåˆ°PoolStatsé‡Œçš„å±æ€§æ€ä¹ˆç›‘æ§ï¼Œè¿™é‡Œæ¥è¯´ä¸‹ï¼Œç”±äºcreateæ–¹æ³•æ˜¯è°ƒç”¨ä¸€æ¬¡å°±æ²¡äº†ï¼Œcreateæ–¹æ³•åªæ˜¯æ¥æ”¶äº†PoolStatså¯¹è±¡çš„å®ä¾‹ï¼Œå¦‚æœä¸å¤„ç†ï¼Œé‚£ä¹ˆéšç€createè°ƒç”¨çš„ç»“æŸï¼Œè¿™ä¸ªå®ä¾‹é’ˆå¯¹ç›‘æ§æ¨¡å—æ¥è¯´å°±å¤±å»æŒæœ‰äº†ï¼Œæ‰€ä»¥è¿™é‡Œå¦‚æœæƒ³è¦æ‹¿åˆ°PoolStatsé‡Œçš„å±æ€§ï¼Œå°±éœ€è¦å¼€å¯ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œè®©å…¶æŒæœ‰PoolStatså¯¹è±¡å®ä¾‹ï¼Œå¹¶ä¸”å®šæ—¶è·å–å…¶å†…éƒ¨å±æ€§å€¼ï¼Œç„¶åpushç»™ç›‘æ§ç³»ç»Ÿï¼Œå¦‚æœæ˜¯æ™®ç½—ç±³ä¿®æ–¯ç­‰ä½¿ç”¨pullæ–¹å¼è·å–ç›‘æ§æ•°æ®çš„ç›‘æ§ç³»ç»Ÿï¼Œå¯ä»¥æ•ˆä»¿HikariCPåŸç”Ÿæ™®ç½—ç±³ä¿®æ–¯ç›‘æ§çš„å®ç°ï¼Œè‡ªå®šä¹‰ä¸€ä¸ªCollectorå¯¹è±¡æ¥æ¥æ”¶PoolStatså®ä¾‹ï¼Œè¿™æ ·æ™®ç½—ç±³ä¿®æ–¯å°±å¯ä»¥å®šæœŸæ‹‰å–äº†ï¼Œæ¯”å¦‚HikariCPæ ¹æ®æ™®ç½—ç±³ä¿®æ–¯ç›‘æ§ç³»ç»Ÿè‡ªå·±å®šä¹‰çš„MetricsTrackerFactoryå®ç°ï¼ˆå¯¹åº”å›¾2é‡Œçš„PrometheusMetricsTrackerFactoryç±»ï¼‰ï¼š 12345678910111213@Overridepublic IMetricsTracker create(String poolName, PoolStats poolStats) { getCollector().add(poolName, poolStats); //å°†æ¥æ”¶åˆ°çš„PoolStatså¯¹è±¡ç›´æ¥äº¤ç»™Collectorï¼Œè¿™æ ·æ™®ç½—ç±³ä¿®æ–¯æœåŠ¡ç«¯æ¯è§¦å‘ä¸€æ¬¡é‡‡é›†æ¥å£çš„è°ƒç”¨ï¼ŒPoolStatséƒ½ä¼šè·Ÿç€æ‰§è¡Œä¸€éå†…éƒ¨å±æ€§è·å–æµç¨‹ return new PrometheusMetricsTracker(poolName, this.collectorRegistry); //è¿”å›IMetricsTrackeræ¥å£çš„å®ç°ç±»}//è‡ªå®šä¹‰çš„Collectorprivate HikariCPCollector getCollector() { if (collector == null) { //æ³¨å†Œåˆ°æ™®ç½—ç±³ä¿®æ–¯æ”¶é›†ä¸­å¿ƒ collector = new HikariCPCollector().register(this.collectorRegistry); } return collector; ä»£ç å—6 é€šè¿‡ä¸Šé¢çš„è§£é‡Šå¯ä»¥çŸ¥é“åœ¨HikariCPä¸­å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ªè‡ªå·±çš„ç›‘æ§å™¨ï¼Œä»¥åŠç›¸æ¯”Druidçš„ç›‘æ§ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ã€‚å·¥ä½œä¸­å¾ˆå¤šæ—¶å€™éƒ½æ˜¯éœ€è¦è‡ªå®šä¹‰çš„ï¼Œæˆ‘å¸è™½ç„¶ä¹Ÿæ˜¯ç”¨çš„æ™®ç½—ç±³ä¿®æ–¯ç›‘æ§ï¼Œä½†æ˜¯å› ä¸ºHikariCPåŸç”Ÿçš„æ™®ç½—ç±³ä¿®æ–¯æ”¶é›†å™¨é‡Œé¢å¯¹ç›‘æ§æŒ‡æ ‡çš„å‘½åå¹¶ä¸ç¬¦åˆæˆ‘å¸çš„è§„èŒƒï¼Œæ‰€ä»¥å°±è‡ªå®šä¹‰äº†ä¸€ä¸ªï¼Œæœ‰ç±»ä¼¼é—®é¢˜çš„ä¸å¦¨ä¹Ÿè¯•ä¸€è¯•ã€‚ ğŸ è¿™ä¸€èŠ‚æ²¡æœ‰ç”»å›¾ï¼Œçº¯ä»£ç ï¼Œå› ä¸ºç”»å›¾ä¸å¤ªå¥½è§£é‡Šè¿™éƒ¨åˆ†çš„ä¸œè¥¿ï¼Œè¿™éƒ¨åˆ†å†…å®¹ä¸è¿æ¥æ± æ•´ä½“æµç¨‹å…³ç³»ä¹Ÿä¸å¤§ï¼Œå……å…¶é‡è·å–äº†è¿æ¥æ± æœ¬èº«çš„ä¸€äº›å±æ€§ï¼Œåœ¨è¿æ¥æ± é‡Œçš„è§¦å‘ç‚¹ä¹Ÿåœ¨ä¸Šé¢ä»£ç æ®µçš„æ³¨é‡Šé‡Œè¯´æ¸…æ¥šäº†ï¼Œçœ‹ä»£ç å®šä¹‰å¯èƒ½æ›´å¥½ç†è§£ä¸€äº›ã€‚ ä¸ƒã€æµç¨‹2.2ï¼šè¿æ¥æ³„æ¼çš„æ£€æµ‹ä¸å‘Šè­¦æœ¬èŠ‚å¯¹åº”ä¸»æµç¨‹2é‡Œçš„å­æµç¨‹2.2ï¼Œåœ¨åˆå§‹åŒ–æ± å¯¹è±¡æ—¶ï¼Œåˆå§‹åŒ–äº†ä¸€ä¸ªå«åšleakTaskFactoryçš„å±æ€§ï¼Œæœ¬èŠ‚æ¥çœ‹ä¸‹å®ƒå…·ä½“æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ã€‚ 7.1ï¼šå®ƒæ˜¯åšä»€ä¹ˆçš„ï¼Ÿä¸€ä¸ªè¿æ¥è¢«æ‹¿å‡ºå»ä½¿ç”¨æ—¶é—´è¶…è¿‡leakDetectionThresholdï¼ˆå¯é…ç½®ï¼Œé»˜è®¤0ï¼‰æœªå½’è¿˜çš„ï¼Œä¼šè§¦å‘ä¸€ä¸ªè¿æ¥æ³„æ¼è­¦å‘Šï¼Œé€šçŸ¥ä¸šåŠ¡æ–¹ç›®å‰å­˜åœ¨è¿æ¥æ³„æ¼çš„é—®é¢˜ã€‚ 7.2ï¼šè¿‡ç¨‹è¯¦è§£è¯¥å±æ€§æ˜¯ProxyLeakTaskFactoryç±»å‹å¯¹è±¡ï¼Œä¸”å®ƒè¿˜ä¼šæŒæœ‰houseKeepingExecutorServiceè¿™ä¸ªçº¿ç¨‹æ± å¯¹è±¡ï¼Œç”¨äºç”Ÿäº§ProxyLeakTaskå¯¹è±¡ï¼Œç„¶ååˆ©ç”¨ä¸Šé¢çš„houseKeepingExecutorServiceå»¶æ—¶è¿è¡Œè¯¥å¯¹è±¡é‡Œçš„runæ–¹æ³•ã€‚è¯¥æµç¨‹çš„è§¦å‘ç‚¹åœ¨ä¸Šé¢çš„æµç¨‹1.1æœ€ååŒ…è£…æˆProxyConnectionå¯¹è±¡çš„é‚£ä¸€æ­¥ï¼Œæ¥çœ‹çœ‹å…·ä½“çš„æµç¨‹å›¾ï¼š æ¯æ¬¡åœ¨æµç¨‹1.1é‚£é‡Œç”ŸæˆProxyConnectionå¯¹è±¡æ—¶ï¼Œéƒ½ä¼šè§¦å‘ä¸Šé¢çš„æµç¨‹ï¼Œç”±æµç¨‹å›¾å¯ä»¥çŸ¥é“ï¼ŒProxyConnectionå¯¹è±¡æŒæœ‰PoolEntryå’ŒProxyLeakTaskçš„å¯¹è±¡ï¼Œå…¶ä¸­åˆå§‹åŒ–ProxyLeakTaskå¯¹è±¡æ—¶å°±ç”¨åˆ°äº†leakTaskFactoryå¯¹è±¡ï¼Œé€šè¿‡å…¶scheduleæ–¹æ³•å¯ä»¥è¿›è¡ŒProxyLeakTaskçš„åˆå§‹åŒ–ï¼Œå¹¶å°†å…¶å®ä¾‹ä¼ é€’ç»™ProxyConnectionè¿›è¡Œåˆå§‹åŒ–èµ‹å€¼ï¼ˆpsï¼šç”±å›¾çŸ¥ProxyConnectionåœ¨è§¦å‘å›æ”¶äº‹ä»¶æ—¶ï¼Œä¼šä¸»åŠ¨å–æ¶ˆè¿™ä¸ªæ³„æ¼æ£€æŸ¥ä»»åŠ¡ï¼Œè¿™ä¹Ÿæ˜¯ProxyConnectionéœ€è¦æŒæœ‰ProxyLeakTaskå¯¹è±¡çš„åŸå› ï¼‰ã€‚ åœ¨ä¸Šé¢çš„æµç¨‹å›¾ä¸­å¯ä»¥çŸ¥é“ï¼Œåªæœ‰åœ¨leakDetectionThresholdä¸ç­‰äº0çš„æ—¶å€™æ‰ä¼šç”Ÿæˆä¸€ä¸ªå¸¦æœ‰å®é™…å»¶æ—¶ä»»åŠ¡çš„ProxyLeakTaskå¯¹è±¡ï¼Œå¦åˆ™è¿”å›æ— å®é™…æ„ä¹‰çš„ç©ºå¯¹è±¡ã€‚æ‰€ä»¥è¦æƒ³å¯ç”¨è¿æ¥æ³„æ¼æ£€æŸ¥ï¼Œé¦–å…ˆè¦æŠŠleakDetectionThresholdé…ç½®è®¾ç½®ä¸Šï¼Œè¿™ä¸ªå±æ€§è¡¨ç¤ºç»è¿‡è¯¥æ—¶é—´åå€Ÿå‡ºå»çš„è¿æ¥ä»æœªå½’è¿˜ï¼Œåˆ™è§¦å‘è¿æ¥æ³„æ¼å‘Šè­¦ã€‚ ProxyConnectionä¹‹æ‰€ä»¥è¦æŒæœ‰ProxyLeakTaskå¯¹è±¡ï¼Œæ˜¯å› ä¸ºå®ƒå¯ä»¥ç›‘å¬åˆ°è¿æ¥æ˜¯å¦è§¦å‘å½’è¿˜æ“ä½œï¼Œå¦‚æœè§¦å‘ï¼Œåˆ™è°ƒç”¨cancelæ–¹æ³•å–æ¶ˆå»¶æ—¶ä»»åŠ¡ï¼Œé˜²æ­¢è¯¯å‘Šã€‚ ç”±æ­¤æµç¨‹å¯ä»¥çŸ¥é“ï¼Œè·ŸDruidä¸€æ ·ï¼ŒHikariCPä¹Ÿæœ‰è¿æ¥å¯¹è±¡æ³„æ¼æ£€æŸ¥ï¼Œä¸Druidä¸»åŠ¨å›æ”¶è¿æ¥ç›¸æ¯”ï¼ŒHikariCPå®ç°æ›´åŠ ç®€å•ï¼Œä»…ä»…æ˜¯åœ¨è§¦å‘æ—¶æ‰“å°è­¦å‘Šæ—¥å¿—ï¼Œä¸ä¼šé‡‡å–å…·ä½“çš„å¼ºåˆ¶å›æ”¶çš„æªæ–½ã€‚ ä¸Druidä¸€æ ·ï¼Œé»˜è®¤ä¹Ÿæ˜¯å…³é—­è¿™ä¸ªæµç¨‹çš„ï¼Œå› ä¸ºå®é™…å¼€å‘ä¸­ä¸€èˆ¬ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¡†æ¶ï¼Œæ¡†æ¶æœ¬èº«ä¼šä¿è¯åŠæ—¶çš„closeè¿æ¥ï¼Œé˜²æ­¢è¿æ¥å¯¹è±¡æ³„æ¼ï¼Œå¼€å¯ä¸å¦è¿˜æ˜¯å–å†³äºä¸šåŠ¡æ˜¯å¦éœ€è¦ï¼Œå¦‚æœä¸€å®šè¦å¼€å¯ï¼Œå¦‚ä½•è®¾ç½®leakDetectionThresholdçš„å¤§å°ä¹Ÿæ˜¯éœ€è¦è€ƒè™‘çš„ä¸€ä»¶äº‹ã€‚ å…«ã€ä¸»æµç¨‹3ï¼šç”Ÿæˆè¿æ¥å¯¹è±¡æœ¬èŠ‚æ¥è®²ä¸‹ä¸»æµç¨‹2é‡Œçš„createEntryæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åˆ©ç”¨PoolBaseé‡Œçš„DriverDataSourceå¯¹è±¡ç”Ÿæˆä¸€ä¸ªå®é™…çš„è¿æ¥å¯¹è±¡ï¼ˆå¦‚æœå¿˜è®°DriverDatasourceæ˜¯å“ªé‡Œåˆå§‹åŒ–çš„äº†ï¼Œå¯ä»¥çœ‹ä¸‹ä¸»æµç¨‹2é‡ŒPoolBaseçš„initializeDataSourceæ–¹æ³•çš„ä½œç”¨ï¼‰ï¼Œç„¶åç”¨PoolEntryç±»åŒ…è£…æˆPoolEntryå¯¹è±¡ï¼Œç°åœ¨æ¥çœ‹ä¸‹è¿™ä¸ªåŒ…è£…ç±»æœ‰å“ªäº›ä¸»è¦å±æ€§ï¼š 123456789101112131415161718192021final class PoolEntry implements IConcurrentBagEntry { private static final Logger LOGGER = LoggerFactory.getLogger(PoolEntry.class); //é€šè¿‡casæ¥ä¿®æ”¹stateå±æ€§ private static final AtomicIntegerFieldUpdater stateUpdater; Connection connection; //å®é™…çš„ç‰©ç†è¿æ¥å¯¹è±¡ long lastAccessed; //è§¦å‘å›æ”¶æ—¶åˆ·æ–°è¯¥æ—¶é—´ï¼Œè¡¨ç¤ºâ€œæœ€è¿‘ä¸€æ¬¡ä½¿ç”¨æ—¶é—´â€ long lastBorrowed; //getConnectioné‡ŒborrowæˆåŠŸååˆ·æ–°è¯¥æ—¶é—´ï¼Œè¡¨ç¤ºâ€œæœ€è¿‘ä¸€æ¬¡å€Ÿå‡ºçš„æ—¶é—´â€ @SuppressWarnings(\"FieldCanBeLocal\") private volatile int state = 0; //è¿æ¥çŠ¶æ€ï¼Œæšä¸¾å€¼ï¼šIN_USEï¼ˆä½¿ç”¨ä¸­ï¼‰ã€NOT_IN_USEï¼ˆé—²ç½®ä¸­ï¼‰ã€REMOVEDï¼ˆå·²ç§»é™¤ï¼‰ã€RESERVEDï¼ˆæ ‡è®°ä¸ºä¿ç•™ä¸­ï¼‰ private volatile boolean evict; //æ˜¯å¦è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼Œå¾ˆå¤šåœ°æ–¹ç”¨åˆ°ï¼ˆæ¯”å¦‚æµç¨‹1.1é è¿™ä¸ªåˆ¤æ–­è¿æ¥æ˜¯å¦å·²è¢«åºŸå¼ƒï¼Œå†æ¯”å¦‚ä¸»æµç¨‹4é‡Œæ—¶é’Ÿå›æ‹¨æ—¶è§¦å‘çš„ç›´æ¥åºŸå¼ƒé€»è¾‘ï¼‰ private volatile ScheduledFuture&lt;?&gt; endOfLife; //ç”¨äºåœ¨è¶…è¿‡è¿æ¥ç”Ÿå‘½å‘¨æœŸï¼ˆmaxLifeTimeï¼‰æ—¶åºŸå¼ƒè¿æ¥çš„å»¶æ—¶ä»»åŠ¡ï¼Œè¿™é‡ŒpoolEntryè¦æŒæœ‰è¯¥å¯¹è±¡ï¼Œä¸»è¦æ˜¯å› ä¸ºåœ¨å¯¹è±¡ä¸»åŠ¨è¢«å…³é—­æ—¶ï¼ˆæ„å‘³ç€ä¸éœ€è¦åœ¨è¶…è¿‡maxLifeTimeæ—¶ä¸»åŠ¨å¤±æ•ˆäº†ï¼‰ï¼Œéœ€è¦cancelæ‰è¯¥ä»»åŠ¡ private final FastList openStatements; //å½“å‰è¯¥è¿æ¥å¯¹è±¡ä¸Šç”Ÿæˆçš„æ‰€æœ‰çš„statementå¯¹è±¡ï¼Œç”¨äºåœ¨å›æ”¶è¿æ¥æ—¶ä¸»åŠ¨å…³é—­è¿™äº›å¯¹è±¡ï¼Œé˜²æ­¢å­˜åœ¨æ¼å…³çš„statement private final HikariPool hikariPool; //æŒæœ‰poolå¯¹è±¡ private final boolean isReadOnly; //æ˜¯å¦ä¸ºåªè¯» private final boolean isAutoCommit; //æ˜¯å¦å­˜åœ¨äº‹åŠ¡} ä»£ç å—7 ä¸Šé¢å°±æ˜¯æ•´ä¸ªPoolEntryå¯¹è±¡é‡Œæ‰€æœ‰çš„å±æ€§ï¼Œè¿™é‡Œå†è¯´ä¸‹endOfLifeå¯¹è±¡ï¼Œå®ƒæ˜¯ä¸€ä¸ªåˆ©ç”¨houseKeepingExecutorServiceè¿™ä¸ªçº¿ç¨‹æ± å¯¹è±¡åšçš„å»¶æ—¶ä»»åŠ¡ï¼Œè¿™ä¸ªå»¶æ—¶ä»»åŠ¡ä¸€èˆ¬åœ¨åˆ›å»ºå¥½è¿æ¥å¯¹è±¡åmaxLifeTimeå·¦å³çš„æ—¶é—´è§¦å‘ï¼Œå…·ä½“æ¥çœ‹ä¸‹createEntryä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233private PoolEntry createPoolEntry() { final PoolEntry poolEntry = newPoolEntry(); //ç”Ÿæˆå®é™…çš„è¿æ¥å¯¹è±¡ final long maxLifetime = config.getMaxLifetime(); //æ‹¿åˆ°é…ç½®å¥½çš„maxLifetime if (maxLifetime &gt; 0) { //&lt;=0çš„æ—¶å€™ä¸å¯ç”¨ä¸»åŠ¨è¿‡æœŸç­–ç•¥ // è®¡ç®—éœ€è¦å‡å»çš„éšæœºæ•° // æºæ³¨é‡Šï¼švariance up to 2.5% of the maxlifetime final long variance = maxLifetime &gt; 10_000 ? ThreadLocalRandom.current().nextLong(maxLifetime / 40) : 0; final long lifetime = maxLifetime - variance; //ç”Ÿæˆå®é™…çš„å»¶æ—¶æ—¶é—´ poolEntry.setFutureEol(houseKeepingExecutorService.schedule( () -&gt; { //å®é™…çš„å»¶æ—¶ä»»åŠ¡ï¼Œè¿™é‡Œç›´æ¥è§¦å‘softEvictConnectionï¼Œè€ŒsoftEvictConnectionå†…åˆ™ä¼šæ ‡è®°è¯¥è¿æ¥å¯¹è±¡ä¸ºåºŸå¼ƒçŠ¶æ€ï¼Œç„¶åå°è¯•ä¿®æ”¹å…¶çŠ¶æ€ä¸ºSTATE_RESERVEDï¼Œè‹¥æˆåŠŸï¼Œåˆ™è§¦å‘closeConnectionï¼ˆå¯¹åº”æµç¨‹1.1.2ï¼‰ if (softEvictConnection(poolEntry, \"(connection has passed maxLifetime)\", false /* not owner */)) { addBagItem(connectionBag.getWaitingThreadCount()); //å›æ”¶å®Œæ¯•åï¼Œè¿æ¥æ± å†…å°‘äº†ä¸€ä¸ªè¿æ¥ï¼Œå°±ä¼šå°è¯•æ–°å¢ä¸€ä¸ªè¿æ¥å¯¹è±¡ } }, lifetime, MILLISECONDS)); //ç»™endOfLifeèµ‹å€¼ï¼Œå¹¶ä¸”æäº¤å»¶æ—¶ä»»åŠ¡ï¼Œlifetimeåè§¦å‘ } return poolEntry; } //è§¦å‘æ–°å¢è¿æ¥ä»»åŠ¡ public void addBagItem(final int waiting) { //å‰æ’æç¤ºï¼šaddConnectionQueueå’ŒaddConnectionExecutorçš„å…³ç³»å’Œåˆå§‹åŒ–å‚è€ƒä¸»æµç¨‹2 //å½“æ·»åŠ è¿æ¥çš„é˜Ÿåˆ—é‡Œå·²æäº¤çš„ä»»åŠ¡è¶…è¿‡é‚£äº›å› ä¸ºè·å–ä¸åˆ°è¿æ¥è€Œå‘ç”Ÿé˜»å¡çš„çº¿ç¨‹ä¸ªæ•°æ—¶ï¼Œå°±è¿›è¡Œæäº¤è¿æ¥æ–°å¢è¿æ¥çš„ä»»åŠ¡ final boolean shouldAdd = waiting - addConnectionQueue.size() &gt;= 0; // Yes, &gt;= is intentional. if (shouldAdd) { //æäº¤ä»»åŠ¡ç»™addConnectionExecutorè¿™ä¸ªçº¿ç¨‹æ± ï¼ŒPoolEntryCreatoræ˜¯ä¸€ä¸ªå®ç°äº†Callableæ¥å£çš„ç±»ï¼Œä¸‹é¢å°†é€šè¿‡æµç¨‹å›¾çš„æ–¹å¼ä»‹ç»è¯¥ç±»çš„callæ–¹æ³• addConnectionExecutor.submit(poolEntryCreator); } } ä»£ç å—8 é€šè¿‡ä¸Šé¢çš„æµç¨‹ï¼Œå¯ä»¥çŸ¥é“ï¼ŒHikariCPä¸€èˆ¬é€šè¿‡createEntryæ–¹æ³•æ¥æ–°å¢ä¸€ä¸ªè¿æ¥å…¥æ± ï¼Œæ¯ä¸ªè¿æ¥è¢«åŒ…è£…æˆPoolEntryå¯¹è±¡ï¼Œåœ¨åˆ›å»ºå¥½å¯¹è±¡æ—¶ï¼ŒåŒæ—¶ä¼šæäº¤ä¸€ä¸ªå»¶æ—¶ä»»åŠ¡æ¥å…³é—­åºŸå¼ƒè¯¥è¿æ¥ï¼Œè¿™ä¸ªæ—¶é—´å°±æ˜¯æˆ‘ä»¬é…ç½®çš„maxLifeTimeï¼Œä¸ºäº†ä¿è¯ä¸åœ¨åŒä¸€æ—¶é—´å¤±æ•ˆï¼ŒHikariCPè¿˜ä¼šåˆ©ç”¨maxLifeTimeå‡å»ä¸€ä¸ªéšæœºæ•°ä½œä¸ºæœ€ç»ˆçš„å»¶æ—¶ä»»åŠ¡å»¶è¿Ÿæ—¶é—´ï¼Œç„¶ååœ¨è§¦å‘åºŸå¼ƒä»»åŠ¡æ—¶ï¼Œè¿˜ä¼šè§¦å‘addBagItemï¼Œè¿›è¡Œè¿æ¥æ·»åŠ ä»»åŠ¡ï¼ˆå› ä¸ºåºŸå¼ƒäº†ä¸€ä¸ªè¿æ¥ï¼Œéœ€è¦å¾€æ± å­é‡Œè¡¥å……ä¸€ä¸ªï¼‰ï¼Œè¯¥ä»»åŠ¡åˆ™äº¤ç»™ç”±ä¸»æµç¨‹2é‡Œå®šä¹‰å¥½çš„addConnectionExecutorçº¿ç¨‹æ± æ‰§è¡Œï¼Œé‚£ä¹ˆï¼Œç°åœ¨æ¥çœ‹ä¸‹è¿™ä¸ªå¼‚æ­¥æ·»åŠ è¿æ¥å¯¹è±¡çš„ä»»åŠ¡æµç¨‹ï¼š è¿™ä¸ªæµç¨‹å°±æ˜¯å¾€è¿æ¥æ± é‡ŒåŠ è¿æ¥ç”¨çš„ï¼Œè·ŸcreateEntryç»“åˆèµ·æ¥è¯´æ˜¯å› ä¸ºè¿™ä¿©æµç¨‹æ˜¯ç´§å¯†ç›¸å…³çš„ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä¸»æµç¨‹5ï¼ˆfillPoolï¼Œæ‰©å……è¿æ¥æ± ï¼‰ä¹Ÿä¼šè§¦å‘è¯¥ä»»åŠ¡ã€‚ ä¹ã€ä¸»æµç¨‹4ï¼šè¿æ¥æ± ç¼©å®¹HikariCPä¼šæŒ‰ç…§minIdleå®šæ—¶æ¸…ç†é—²ç½®è¿‡ä¹…çš„è¿æ¥ï¼Œè¿™ä¸ªå®šæ—¶ä»»åŠ¡åœ¨ä¸»æµç¨‹2åˆå§‹åŒ–è¿æ¥æ± å¯¹è±¡æ—¶è¢«å¯ç”¨ï¼Œè·Ÿä¸Šé¢çš„æµç¨‹ä¸€æ ·ï¼Œä¹Ÿæ˜¯åˆ©ç”¨houseKeepingExecutorServiceè¿™ä¸ªçº¿ç¨‹æ± å¯¹è±¡åšè¯¥å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œå™¨ã€‚ æ¥çœ‹ä¸‹ä¸»æµç¨‹2é‡Œæ˜¯æ€ä¹ˆå¯ç”¨è¯¥ä»»åŠ¡çš„ï¼š 12//housekeepingPeriodMsçš„é»˜è®¤å€¼æ˜¯30sï¼Œæ‰€ä»¥å®šæ—¶ä»»åŠ¡çš„é—´éš”ä¸º30sthis.houseKeeperTask = houseKeepingExecutorService.scheduleWithFixedDelay(new HouseKeeper(), 100L, housekeepingPeriodMs, MILLISECONDS); ä»£ç å—9 é‚£ä¹ˆæœ¬èŠ‚ä¸»è¦æ¥è¯´ä¸‹HouseKeeperè¿™ä¸ªç±»ï¼Œè¯¥ç±»å®ç°äº†Runnableæ¥å£ï¼Œå›æ”¶é€»è¾‘ä¸»è¦åœ¨å…¶runæ–¹æ³•å†…ï¼Œæ¥çœ‹çœ‹runæ–¹æ³•çš„é€»è¾‘æµç¨‹å›¾ï¼š ä¸Šé¢çš„æµç¨‹å°±æ˜¯HouseKeeperçš„runæ–¹æ³•é‡Œå…·ä½“åšçš„äº‹æƒ…ï¼Œç”±äºç³»ç»Ÿæ—¶é—´å›æ‹¨ä¼šå¯¼è‡´è¯¥å®šæ—¶ä»»åŠ¡å›æ”¶ä¸€äº›è¿æ¥æ—¶äº§ç”Ÿè¯¯å·®ï¼Œå› æ­¤å­˜åœ¨å¦‚ä¸‹åˆ¤æ–­ï¼š 12345//nowå°±æ˜¯å½“å‰ç³»ç»Ÿæ—¶é—´ï¼Œpreviouså°±æ˜¯ä¸Šæ¬¡è§¦å‘è¯¥ä»»åŠ¡æ—¶çš„æ—¶é—´ï¼ŒhousekeepingPeriodMså°±æ˜¯éš”å¤šä¹…è§¦å‘è¯¥ä»»åŠ¡ä¸€æ¬¡//ä¹Ÿå°±æ˜¯è¯´plusMillis(previous, housekeepingPeriodMs)è¡¨ç¤ºå½“å‰æ—¶é—´//å¦‚æœç³»ç»Ÿæ—¶é—´æ²¡è¢«å›æ‹¨ï¼Œé‚£ä¹ˆplusMillis(now, 128)ä¸€å®šæ˜¯å¤§äºå½“å‰æ—¶é—´çš„ï¼Œå¦‚æœè¢«ç³»ç»Ÿæ—¶é—´è¢«å›æ‹¨//å›æ‹¨çš„æ—¶é—´è¶…è¿‡128msï¼Œé‚£ä¹ˆä¸‹é¢çš„åˆ¤æ–­å°±æˆç«‹ï¼Œå¦åˆ™æ°¸è¿œä¸ä¼šæˆç«‹if (plusMillis(now, 128) &lt; plusMillis(previous, housekeepingPeriodMs)) ä»£ç å—10 è¿™æ˜¯hikariCPåœ¨è§£å†³ç³»ç»Ÿæ—¶é’Ÿè¢«å›æ‹¨æ—¶åšå‡ºçš„ä¸€ç§æªæ–½ï¼Œé€šè¿‡æµç¨‹å›¾å¯ä»¥çœ‹åˆ°ï¼Œå®ƒæ˜¯ç›´æ¥æŠŠæ± å­é‡Œæ‰€æœ‰çš„è¿æ¥å¯¹è±¡å–å‡ºæ¥æŒ¨ä¸ªå„¿çš„æ ‡è®°æˆåºŸå¼ƒï¼Œå¹¶ä¸”å°è¯•æŠŠçŠ¶æ€å€¼ä¿®æ”¹ä¸ºSTATE_RESERVEDï¼ˆåé¢ä¼šè¯´æ˜è¿™äº›çŠ¶æ€ï¼Œè¿™é‡Œå…ˆä¸æ·±ç©¶ï¼‰ã€‚å¦‚æœç³»ç»Ÿæ—¶é’Ÿæ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼ˆç»å¤§å¤šæ•°æƒ…å†µä¼šå‘½ä¸­è¿™ä¸€å—çš„é€»è¾‘ï¼‰ï¼Œç”±å›¾çŸ¥ï¼Œä¼šæŠŠå½“å‰æ± å†…æ‰€æœ‰å¤„äºé—²ç½®çŠ¶æ€ï¼ˆSTATE_NOT_IN_USEï¼‰çš„è¿æ¥æ‹¿å‡ºæ¥ï¼Œç„¶åè®¡ç®—éœ€è¦æ£€æŸ¥çš„èŒƒå›´ï¼Œç„¶åå¾ªç¯ç€ä¿®æ”¹è¿æ¥çš„çŠ¶æ€ï¼š 123456789101112//æ‹¿åˆ°æ‰€æœ‰å¤„äºé—²ç½®çŠ¶æ€çš„è¿æ¥final List notInUse = connectionBag.values(STATE_NOT_IN_USE);//è®¡ç®—å‡ºéœ€è¦è¢«æ£€æŸ¥é—²ç½®æ—¶é—´çš„æ•°é‡ï¼Œç®€å•æ¥è¯´ï¼Œæ± å†…éœ€è¦ä¿è¯æœ€å°minIdleä¸ªè¿æ¥æ´»ç€ï¼Œæ‰€ä»¥éœ€è¦è®¡ç®—å‡ºè¶…å‡ºè¿™ä¸ªèŒƒå›´çš„é—²ç½®å¯¹è±¡è¿›è¡Œæ£€æŸ¥int toRemove = notInUse.size() - config.getMinIdle();for (PoolEntry entry : notInUse) { //åœ¨æ£€æŸ¥èŒƒå›´å†…ï¼Œä¸”é—²ç½®æ—¶é—´è¶…å‡ºidleTimeoutï¼Œç„¶åå°è¯•å°†è¿æ¥å¯¹è±¡çŠ¶æ€ç”±STATE_NOT_IN_USEå˜ä¸ºSTATE_RESERVEDæˆåŠŸ if (toRemove &gt; 0 &amp;&amp; elapsedMillis(entry.lastAccessed, now) &gt; idleTimeout &amp;&amp; connectionBag.reserve(entry)) { closeConnection(entry, \"(connection has passed idleTimeout)\"); //æ»¡è¶³ä¸Šè¿°æ¡ä»¶ï¼Œè¿›è¡Œè¿æ¥å…³é—­ toRemove--; }}fillPool(); //å› ä¸ºå¯èƒ½å›æ”¶äº†ä¸€äº›è¿æ¥ï¼Œæ‰€ä»¥è¦å†æ¬¡è§¦å‘è¿æ¥æ± æ‰©å……æµç¨‹æ£€æŸ¥ä¸‹æ˜¯å¦éœ€è¦æ–°å¢è¿æ¥ã€‚ ä»£ç å—11 ä¸Šé¢çš„ä»£ç å°±æ˜¯æµç¨‹å›¾é‡Œå¯¹åº”çš„æ²¡æœ‰å›æ‹¨ç³»ç»Ÿæ—¶é—´æ—¶çš„æµç¨‹é€»è¾‘ã€‚è¯¥æµç¨‹åœ¨idleTimeoutå¤§äº0ï¼ˆé»˜è®¤ç­‰äº0ï¼‰å¹¶ä¸”minIdleå°äºmaxPoolSizeçš„æ—¶å€™æ‰ä¼šå¯ç”¨ï¼Œé»˜è®¤æ˜¯ä¸å¯ç”¨çš„ï¼Œè‹¥éœ€è¦å¯ç”¨ï¼Œå¯ä»¥æŒ‰ç…§æ¡ä»¶æ¥é…ç½®ã€‚ åã€ä¸»æµç¨‹5ï¼šæ‰©å……è¿æ¥æ± è¿™ä¸ªæµç¨‹ä¸»è¦ä¾é™„HikariPoolé‡Œçš„fillPoolæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å·²ç»åœ¨ä¸Šé¢å¾ˆå¤šæµç¨‹é‡Œå‡ºç°è¿‡äº†ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯åœ¨è§¦å‘è¿æ¥åºŸå¼ƒã€è¿æ¥æ± è¿æ¥ä¸å¤Ÿç”¨æ—¶ï¼Œå‘èµ·æ‰©å……è¿æ¥æ•°çš„æ“ä½œï¼Œè¿™æ˜¯ä¸ªå¾ˆç®€å•çš„è¿‡ç¨‹ï¼Œä¸‹é¢çœ‹ä¸‹æºç ï¼ˆä¸ºäº†ä½¿ä»£ç ç»“æ„æ›´åŠ æ¸…æ™°ï¼Œå¯¹æºç åšäº†ç»†å¾®æ”¹åŠ¨ï¼‰ï¼š 123456789101112131415161718// PoolEntryCreatorå…³äºcallæ–¹æ³•çš„å®ç°æµç¨‹åœ¨ä¸»æµç¨‹3é‡Œå·²ç»çœ‹è¿‡äº†ï¼Œä½†æ˜¯è¿™é‡Œå´æœ‰ä¿©PoolEntryCreatorå¯¹è±¡ï¼Œ// è¿™æ˜¯ä¸ªè¾ƒç»†èŠ‚çš„åœ°æ–¹ï¼Œç”¨äºæ‰“æ—¥å¿—ç”¨ï¼Œä¸å†è¯´è¿™éƒ¨åˆ†ï¼Œä¸ºäº†ä¾¿äºç†è§£ï¼Œåªéœ€è¦çŸ¥é“è¿™ä¿©å¯¹è±¡æ‰§è¡Œçš„æ˜¯åŒä¸€å—callæ–¹æ³•å³å¯private final PoolEntryCreator poolEntryCreator = new PoolEntryCreator(null);private final PoolEntryCreator postFillPoolEntryCreator = new PoolEntryCreator(\"After adding \");private synchronized void fillPool() { // è¿™ä¸ªåˆ¤æ–­å°±æ˜¯æ ¹æ®å½“å‰æ± å­é‡Œç›¸å…³æ•°æ®ï¼Œæ¨ç®—å‡ºéœ€è¦æ‰©å……çš„è¿æ¥æ•°ï¼Œ // åˆ¤æ–­æ–¹å¼å°±æ˜¯åˆ©ç”¨æœ€å¤§è¿æ¥æ•°è·Ÿå½“å‰è¿æ¥æ€»æ•°çš„å·®å€¼ï¼Œä¸æœ€å°è¿æ¥æ•°ä¸å½“å‰æ± å†…é—²ç½®çš„è¿æ¥æ•°çš„å·®å€¼ï¼Œå–å…¶æœ€å°çš„é‚£ä¸€ä¸ªå¾—åˆ° int needAdd = Math.min(maxPoolSize - connectionBag.size(), minIdle - connectionBag.getCount(STATE_NOT_IN_USE)); //å‡å»å½“å‰æ’é˜Ÿçš„ä»»åŠ¡ï¼Œå°±æ˜¯æœ€ç»ˆéœ€è¦æ–°å¢çš„è¿æ¥æ•° final int connectionsToAdd = needAdd - addConnectionQueue.size(); for (int i = 0; i &lt; connectionsToAdd; i++) { //ä¸€èˆ¬å¾ªç¯çš„æœ€åä¸€æ¬¡ä¼šå‘½ä¸­postFillPoolEntryCreatorä»»åŠ¡ï¼Œå…¶å®å°±æ˜¯åœ¨æœ€åä¸€æ¬¡ä¼šæ‰“å°ä¸€æ¬¡æ—¥å¿—è€Œå·²ï¼ˆå¯ä»¥å¿½ç•¥è¯¥å¹²æ‰°é€»è¾‘ï¼‰ addConnectionExecutor.submit((i &lt; connectionsToAdd - 1) ? poolEntryCreator : postFillPoolEntryCreator); }} ä»£ç å—12 ç”±è¯¥è¿‡ç¨‹å¯ä»¥çŸ¥é“ï¼Œæœ€ç»ˆè¿™ä¸ªæ–°å¢è¿æ¥çš„ä»»åŠ¡ä¹Ÿæ˜¯äº¤ç”±addConnectionExecutorçº¿ç¨‹æ± æ¥å¤„ç†çš„ï¼Œè€Œä»»åŠ¡çš„ä¸»é¢˜ä¹Ÿæ˜¯PoolEntryCreatorï¼Œè¿™ä¸ªæµç¨‹å¯ä»¥å‚è€ƒä¸»æµç¨‹3. ç„¶åneedAddçš„æ¨ç®—ï¼š 1Math.min(æœ€å¤§è¿æ¥æ•° - æ± å†…å½“å‰è¿æ¥æ€»æ•°, æœ€å°è¿æ¥æ•° - æ± å†…é—²ç½®çš„è¿æ¥æ•°) æ ¹æ®è¿™ä¸ªæ–¹å¼åˆ¤æ–­ï¼Œå¯ä»¥ä¿è¯æ± å†…çš„è¿æ¥æ•°æ°¸è¿œä¸ä¼šè¶…è¿‡maxPoolSizeï¼Œä¹Ÿæ°¸è¿œä¸ä¼šä½äºminIdleã€‚åœ¨è¿æ¥åƒç´§çš„æ—¶å€™ï¼Œå¯ä»¥ä¿è¯æ¯æ¬¡è§¦å‘éƒ½ä»¥minIdleçš„æ•°é‡æ‰©å®¹ã€‚å› æ­¤å¦‚æœåœ¨maxPoolSizeè·ŸminIdleé…ç½®çš„å€¼ä¸€æ ·çš„è¯ï¼Œåœ¨æ± å†…è¿æ¥åƒç´§çš„æ—¶å€™ï¼Œå°±ä¸ä¼šå‘ç”Ÿä»»ä½•æ‰©å®¹äº†ã€‚ åä¸€ã€ä¸»æµç¨‹6ï¼šè¿æ¥å›æ”¶æœ€å¼€å§‹è¯´è¿‡ï¼Œæœ€ç»ˆçœŸå®çš„ç‰©ç†è¿æ¥å¯¹è±¡ä¼šè¢«åŒ…è£…æˆPoolEntryå¯¹è±¡ï¼Œå­˜æ”¾è¿›ConcurrentBagï¼Œç„¶åè·å–æ—¶ï¼ŒPoolEntryå¯¹è±¡åˆä¼šè¢«å†æ¬¡åŒ…è£…æˆProxyConnectionå¯¹è±¡æš´éœ²ç»™ä½¿ç”¨æ–¹çš„ï¼Œé‚£ä¹ˆè§¦å‘è¿æ¥å›æ”¶ï¼Œå®é™…ä¸Šå°±æ˜¯è§¦å‘ProxyConnectioné‡Œçš„closeæ–¹æ³•ï¼š 12345678910111213141516public final void close() throws SQLException { // åŸæ³¨é‡Šï¼šClosing statements can cause connection eviction, so this must run before the conditional below closeStatements(); //æ­¤è¿æ¥å¯¹è±¡åœ¨ä¸šåŠ¡æ–¹ä½¿ç”¨è¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ‰€æœ‰statementå¯¹è±¡ï¼Œè¿›è¡Œç»Ÿä¸€closeï¼Œé˜²æ­¢æ¼closeçš„æƒ…å†µ if (delegate != ClosedConnection.CLOSED_CONNECTION) { leakTask.cancel(); //å–æ¶ˆè¿æ¥æ³„æ¼æ£€æŸ¥ä»»åŠ¡ï¼Œå‚è€ƒæµç¨‹2.2 try { if (isCommitStateDirty &amp;&amp; !isAutoCommit) { //åœ¨å­˜åœ¨æ‰§è¡Œè¯­å¥åå¹¶ä¸”è¿˜æ‰“å¼€äº†äº‹åŠ¡ï¼Œè°ƒç”¨closeæ—¶éœ€è¦ä¸»åŠ¨å›æ»šäº‹åŠ¡ delegate.rollback(); //å›æ»š lastAccess = currentTime(); //åˆ·æ–°\"æœ€åä¸€æ¬¡ä½¿ç”¨æ—¶é—´\" } } finally { delegate = ClosedConnection.CLOSED_CONNECTION; poolEntry.recycle(lastAccess); //è§¦å‘å›æ”¶ } }} ä»£ç å—13 è¿™ä¸ªå°±æ˜¯ProxyConnectioné‡Œçš„closeæ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°å®ƒæœ€ç»ˆä¼šè°ƒç”¨PoolEntryçš„recycleæ–¹æ³•è¿›è¡Œå›æ”¶ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿æ¥å¯¹è±¡çš„æœ€åä¸€æ¬¡ä½¿ç”¨æ—¶é—´ä¹Ÿæ˜¯åœ¨è¿™ä¸ªæ—¶å€™åˆ·æ–°çš„ï¼Œè¯¥æ—¶é—´æ˜¯ä¸ªå¾ˆé‡è¦çš„å±æ€§ï¼Œå¯ä»¥ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªè¿æ¥å¯¹è±¡çš„é—²ç½®æ—¶é—´ï¼Œæ¥çœ‹ä¸‹PoolEntryçš„recycleæ–¹æ³•ï¼š 123456void recycle(final long lastAccessed) { if (connection != null) { this.lastAccessed = lastAccessed; //åˆ·æ–°æœ€åä½¿ç”¨æ—¶é—´ hikariPool.recycle(this); //è§¦å‘HikariPoolçš„å›æ”¶æ–¹æ³•ï¼ŒæŠŠè‡ªå·±ä¼ è¿‡å» }} ä»£ç å—14 ä¹‹å‰æœ‰è¯´è¿‡ï¼Œæ¯ä¸ªPoolEntryå¯¹è±¡éƒ½æŒæœ‰HikariPoolçš„å¯¹è±¡ï¼Œæ–¹ä¾¿è§¦å‘è¿æ¥æ± çš„ä¸€äº›æ“ä½œï¼Œç”±ä¸Šè¿°ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œæœ€ç»ˆè¿˜æ˜¯ä¼šè§¦å‘HikariPoolé‡Œçš„recycleæ–¹æ³•ï¼Œå†æ¥çœ‹ä¸‹HikariPoolçš„recycleæ–¹æ³•ï¼š 1234void recycle(final PoolEntry poolEntry) { metricsTracker.recordConnectionUsage(poolEntry); //ç›‘æ§æŒ‡æ ‡ç›¸å…³ï¼Œå¿½ç•¥ connectionBag.requite(poolEntry); //æœ€ç»ˆè§¦å‘connectionBagçš„requiteæ–¹æ³•å½’è¿˜è¿æ¥ï¼Œè¯¥æµç¨‹å‚è€ƒConnectionBagä¸»æµç¨‹é‡Œçš„requiteæ–¹æ³•éƒ¨åˆ†} ä»£ç å—15 ä»¥ä¸Šå°±æ˜¯è¿æ¥å›æ”¶éƒ¨åˆ†çš„é€»è¾‘ï¼Œç›¸æ¯”å…¶ä»–æµç¨‹ï¼Œè¿˜æ˜¯æ¯”è¾ƒç®€æ´çš„ã€‚ åäºŒã€ConcurrentBagä¸»æµç¨‹è¿™ä¸ªç±»ç”¨æ¥å­˜æ”¾æœ€ç»ˆçš„PoolEntryç±»å‹çš„è¿æ¥å¯¹è±¡ï¼Œæä¾›äº†åŸºæœ¬çš„å¢åˆ æŸ¥çš„åŠŸèƒ½ï¼Œè¢«HikariPoolæŒæœ‰ï¼Œä¸Šé¢é‚£ä¹ˆå¤šçš„æ“ä½œï¼Œå‡ ä¹éƒ½æ˜¯åœ¨HikariPoolä¸­å®Œæˆçš„ï¼ŒHikariPoolç”¨æ¥ç®¡ç†å®é™…çš„è¿æ¥ç”Ÿäº§åŠ¨ä½œå’Œå›æ”¶åŠ¨ä½œï¼Œå®é™…æ“ä½œçš„å´æ˜¯ConcurrentBagç±»ï¼Œæ¢³ç†ä¸‹ä¸Šé¢æ‰€æœ‰æµç¨‹çš„è§¦å‘ç‚¹ï¼š ä¸»æµç¨‹2ï¼šåˆå§‹åŒ–HikariPoolæ—¶åˆå§‹åŒ–ConcurrentBagï¼ˆæ„é€ æ–¹æ³•ï¼‰ï¼Œé¢„çƒ­æ—¶é€šè¿‡createEntryæ‹¿åˆ°è¿æ¥å¯¹è±¡ï¼Œè°ƒç”¨ConcurrentBag.addæ·»åŠ è¿æ¥åˆ°ConcurrentBagã€‚ æµç¨‹1.1ï¼šé€šè¿‡HikariPoolè·å–è¿æ¥æ—¶ï¼Œé€šè¿‡è°ƒç”¨ConcurrentBag.borrowæ‹¿åˆ°ä¸€ä¸ªè¿æ¥å¯¹è±¡ã€‚ ä¸»æµç¨‹6ï¼šé€šè¿‡ConcurrentBag.requiteå½’è¿˜ä¸€ä¸ªè¿æ¥ã€‚ æµç¨‹1.1.2ï¼šè§¦å‘å…³é—­è¿æ¥æ—¶ï¼Œä¼šé€šè¿‡ConcurrentBag.removeç§»é™¤è¿æ¥å¯¹è±¡ï¼Œç”±å‰é¢çš„æµç¨‹å¯çŸ¥å…³é—­è¿æ¥è§¦å‘ç‚¹ä¸ºï¼šè¿æ¥è¶…è¿‡æœ€å¤§ç”Ÿå‘½å‘¨æœŸmaxLifeTimeä¸»åŠ¨åºŸå¼ƒã€å¥åº·æ£€æŸ¥ä¸é€šè¿‡ä¸»åŠ¨åºŸå¼ƒã€è¿æ¥æ± ç¼©å®¹ã€‚ ä¸»æµç¨‹3ï¼šé€šè¿‡å¼‚æ­¥æ·»åŠ è¿æ¥æ—¶ï¼Œé€šè¿‡è°ƒç”¨ConcurrentBag.addæ·»åŠ è¿æ¥åˆ°ConcurrentBagï¼Œç”±å‰é¢çš„æµç¨‹å¯çŸ¥æ·»åŠ è¿æ¥è§¦å‘ç‚¹ä¸ºï¼šè¿æ¥è¶…è¿‡æœ€å¤§ç”Ÿå‘½å‘¨æœŸmaxLifeTimeä¸»åŠ¨åºŸå¼ƒè¿æ¥åã€è¿æ¥æ± æ‰©å®¹ã€‚ ä¸»æµç¨‹4ï¼šè¿æ¥æ± ç¼©å®¹ä»»åŠ¡ï¼Œé€šè¿‡è°ƒç”¨ConcurrentBag.valuesç­›é€‰å‡ºéœ€è¦çš„åšæ“ä½œçš„è¿æ¥å¯¹è±¡ï¼Œç„¶åå†é€šè¿‡ConcurrentBag.reserveå®Œæˆå¯¹è¿æ¥å¯¹è±¡çŠ¶æ€çš„ä¿®æ”¹ï¼Œç„¶åä¼šé€šè¿‡æµç¨‹1.1.2è§¦å‘å…³é—­å’Œç§»é™¤è¿æ¥æ“ä½œã€‚ é€šè¿‡è§¦å‘ç‚¹æ•´ç†ï¼Œå¯ä»¥çŸ¥é“è¯¥ç»“æ„é‡Œçš„ä¸»è¦æ–¹æ³•ï¼Œå°±æ˜¯ä¸Šé¢è§¦å‘ç‚¹é‡Œæ ‡è®°ä¸ºæ ‡ç­¾è‰²çš„éƒ¨åˆ†ï¼Œç„¶åæ¥å…·ä½“çœ‹ä¸‹è¯¥ç±»çš„åŸºæœ¬å®šä¹‰å’Œä¸»è¦æ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273public class ConcurrentBag&lt;T extends IConcurrentBagEntry&gt; implements AutoCloseable { private final CopyOnWriteArrayList&lt;T&gt; sharedList; //æœ€ç»ˆå­˜æ”¾PoolEntryå¯¹è±¡çš„åœ°æ–¹ï¼Œå®ƒæ˜¯ä¸€ä¸ªCopyOnWriteArrayList private final boolean weakThreadLocals; //é»˜è®¤falseï¼Œä¸ºtrueæ—¶å¯ä»¥è®©ä¸€ä¸ªè¿æ¥å¯¹è±¡åœ¨ä¸‹æ–¹threadListé‡Œçš„listå†…å¤„äºå¼±å¼•ç”¨çŠ¶æ€ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ï¼ˆå‚è§å¤‡æ³¨1ï¼‰ private final ThreadLocal&lt;List&lt;Object&gt;&gt; threadList; //çº¿ç¨‹çº§çš„ç¼“å­˜ï¼Œä»sharedListæ‹¿åˆ°çš„è¿æ¥å¯¹è±¡ï¼Œä¼šè¢«ç¼“å­˜è¿›å½“å‰çº¿ç¨‹å†…ï¼Œborrowæ—¶ä¼šå…ˆä»ç¼“å­˜ä¸­æ‹¿ï¼Œä»è€Œè¾¾åˆ°æ± å†…æ— é”å®ç° private final IBagStateListener listener; //å†…éƒ¨æ¥å£ï¼ŒHikariPoolå®ç°äº†è¯¥æ¥å£ï¼Œä¸»è¦ç”¨äºConcurrentBagä¸»åŠ¨é€šçŸ¥HikariPoolè§¦å‘æ·»åŠ è¿æ¥å¯¹è±¡çš„å¼‚æ­¥æ“ä½œï¼ˆä¹Ÿå°±æ˜¯ä¸»æµç¨‹3é‡Œçš„addConnectionExecutoræ‰€è§¦å‘çš„æµç¨‹ï¼‰ private final AtomicInteger waiters; //å½“å‰å› ä¸ºè·å–ä¸åˆ°è¿æ¥è€Œå‘ç”Ÿé˜»å¡çš„ä¸šåŠ¡çº¿ç¨‹æ•°ï¼Œè¿™ä¸ªåœ¨ä¹‹å‰çš„æµç¨‹é‡Œä¹Ÿå‡ºç°è¿‡ï¼Œæ¯”å¦‚ä¸»æµç¨‹3é‡ŒaddBagItemå°±ä¼šæ ¹æ®è¯¥æŒ‡æ ‡è¿›è¡Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ–°å¢è¿æ¥ private volatile boolean closed; //æ ‡è®°å½“å‰ConcurrentBagæ˜¯å¦å·²è¢«å…³é—­ private final SynchronousQueue&lt;T&gt; handoffQueue; //è¿™æ˜¯ä¸ªå³äº§å³é”€çš„é˜Ÿåˆ—ï¼Œç”¨äºåœ¨è¿æ¥ä¸å¤Ÿç”¨æ—¶ï¼ŒåŠæ—¶è·å–åˆ°addæ–¹æ³•é‡Œæ–°åˆ›å»ºçš„è¿æ¥å¯¹è±¡ï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒä¸‹é¢borrowå’Œaddçš„ä»£ç  //å†…éƒ¨æ¥å£ï¼ŒPoolEntryç±»å®ç°äº†è¯¥æ¥å£ public interface IConcurrentBagEntry { //è¿æ¥å¯¹è±¡çš„çŠ¶æ€ï¼Œå‰é¢çš„æµç¨‹å¾ˆå¤šåœ°æ–¹éƒ½å·²ç»æ¶‰åŠåˆ°äº†ï¼Œæ¯”å¦‚ä¸»æµç¨‹4çš„ç¼©å®¹ int STATE_NOT_IN_USE = 0; //é—²ç½® int STATE_IN_USE = 1; //ä½¿ç”¨ä¸­ int STATE_REMOVED = -1; //å·²åºŸå¼ƒ int STATE_RESERVED = -2; //æ ‡è®°ä¿ç•™ï¼Œä»‹äºé—²ç½®å’ŒåºŸå¼ƒä¹‹é—´çš„ä¸­é—´çŠ¶æ€ï¼Œä¸»è¦ç”±ç¼©å®¹é‚£é‡Œè§¦å‘ä¿®æ”¹ boolean compareAndSet(int expectState, int newState); //å°è¯•åˆ©ç”¨casä¿®æ”¹è¿æ¥å¯¹è±¡çš„çŠ¶æ€å€¼ void setState(int newState); //è®¾ç½®çŠ¶æ€å€¼ int getState(); //è·å–çŠ¶æ€å€¼ } //å‚è€ƒä¸Šé¢listenerå±æ€§çš„è§£é‡Š public interface IBagStateListener { void addBagItem(int waiting); } //è·å–è¿æ¥æ–¹æ³• public T borrow(long timeout, final TimeUnit timeUnit) { // çœç•¥... } //å›æ”¶è¿æ¥æ–¹æ³• public void requite(final T bagEntry) { //çœç•¥... } //æ·»åŠ è¿æ¥æ–¹æ³• public void add(final T bagEntry) { //çœç•¥... } //ç§»é™¤è¿æ¥æ–¹æ³• public boolean remove(final T bagEntry) { //çœç•¥... } //æ ¹æ®è¿æ¥çŠ¶æ€å€¼è·å–å½“å‰æ± å­å†…æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„è¿æ¥é›†åˆ public List values(final int state) { //çœç•¥... } //è·å–å½“å‰æ± å­å†…æ‰€æœ‰çš„è¿æ¥ public List values() { //çœç•¥... } //åˆ©ç”¨casæŠŠä¼ å…¥çš„è¿æ¥å¯¹è±¡çš„stateä» STATE_NOT_IN_USE å˜ä¸º STATE_RESERVED public boolean reserve(final T bagEntry) { //çœç•¥... } //è·å–å½“å‰æ± å­å†…ç¬¦åˆä¼ å…¥çŠ¶æ€å€¼çš„è¿æ¥æ•°é‡ public int getCount(final int state) { //çœç•¥... }} ä»£ç å—16 ä»è¿™ä¸ªåŸºæœ¬ç»“æ„å°±å¯ä»¥ç¨å¾®çœ‹å‡ºHikariCPæ˜¯å¦‚ä½•ä¼˜åŒ–ä¼ ç»Ÿè¿æ¥æ± å®ç°çš„äº†ï¼Œç›¸æ¯”Druidæ¥è¯´ï¼ŒHikariCPæ›´åŠ åå‘æ— é”å®ç°ï¼Œå°½é‡é¿å…é”ç«äº‰çš„å‘ç”Ÿã€‚ 12.1ï¼šborrowè¿™ä¸ªæ–¹æ³•ç”¨æ¥è·å–ä¸€ä¸ªå¯ç”¨çš„è¿æ¥å¯¹è±¡ï¼Œè§¦å‘ç‚¹ä¸ºæµç¨‹1.1ï¼ŒHikariPoolå°±æ˜¯åˆ©ç”¨è¯¥æ–¹æ³•è·å–è¿æ¥çš„ï¼Œä¸‹é¢æ¥çœ‹ä¸‹è¯¥æ–¹æ³•åšäº†ä»€ä¹ˆï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748public T borrow(long timeout, final TimeUnit timeUnit) throws InterruptedException { // æºæ³¨é‡Šï¼šTry the thread-local list first final List&lt;Object&gt; list = threadList.get(); //é¦–å…ˆä»å½“å‰çº¿ç¨‹çš„ç¼“å­˜é‡Œæ‹¿åˆ°ä¹‹å‰è¢«ç¼“å­˜è¿›æ¥çš„è¿æ¥å¯¹è±¡é›†åˆ for (int i = list.size() - 1; i &gt;= 0; i--) { final Object entry = list.remove(i); //å…ˆç§»é™¤ï¼Œå›æ”¶æ–¹æ³•é‚£é‡Œä¼šå†æ¬¡addè¿›æ¥ final T bagEntry = weakThreadLocals ? ((WeakReference&lt;T&gt;) entry).get() : (T) entry; //é»˜è®¤ä¸å¯ç”¨å¼±å¼•ç”¨ // è·å–åˆ°å¯¹è±¡åï¼Œé€šè¿‡caså°è¯•æŠŠå…¶çŠ¶æ€ä»STATE_NOT_IN_USE å˜ä¸º STATE_IN_USEï¼Œæ³¨æ„ï¼Œè¿™é‡Œå¦‚æœå…¶ä»–çº¿ç¨‹ä¹Ÿåœ¨ä½¿ç”¨è¿™ä¸ªè¿æ¥å¯¹è±¡ï¼Œ // å¹¶ä¸”æˆåŠŸä¿®æ”¹å±æ€§ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹çš„casä¼šå¤±è´¥ï¼Œé‚£ä¹ˆå°±ä¼šç»§ç»­å¾ªç¯å°è¯•è·å–ä¸‹ä¸€ä¸ªè¿æ¥å¯¹è±¡ if (bagEntry != null &amp;&amp; bagEntry.compareAndSet(STATE_NOT_IN_USE, STATE_IN_USE)) { return bagEntry; //casè®¾ç½®æˆåŠŸåï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹ç»•è¿‡å…¶ä»–çº¿ç¨‹å¹²æ‰°ï¼ŒæˆåŠŸè·å–åˆ°è¯¥è¿æ¥å¯¹è±¡ï¼Œç›´æ¥è¿”å› } } // æºæ³¨é‡Šï¼šOtherwise, scan the shared list ... then poll the handoff queue final int waiting = waiters.incrementAndGet(); //å¦‚æœç¼“å­˜å†…æ‰¾ä¸åˆ°ä¸€ä¸ªå¯ç”¨çš„è¿æ¥å¯¹è±¡ï¼Œåˆ™è®¤ä¸ºéœ€è¦â€œå›æºâ€ï¼Œwaiters+1 try { for (T bagEntry : sharedList) { //å¾ªç¯sharedListï¼Œå°è¯•æŠŠè¿æ¥çŠ¶æ€å€¼ä»STATE_NOT_IN_USE å˜ä¸º STATE_IN_USE if (bagEntry.compareAndSet(STATE_NOT_IN_USE, STATE_IN_USE)) { // æºæ³¨é‡Šï¼šIf we may have stolen another waiter's connection, request another bag add. if (waiting &gt; 1) { //é˜»å¡çº¿ç¨‹æ•°å¤§äº1æ—¶ï¼Œéœ€è¦è§¦å‘HikariPoolçš„addBagItemæ–¹æ³•æ¥è¿›è¡Œæ·»åŠ è¿æ¥å…¥æ± ï¼Œè¿™ä¸ªæ–¹æ³•çš„å®ç°å‚è€ƒä¸»æµç¨‹3 listener.addBagItem(waiting - 1); } return bagEntry; //casè®¾ç½®æˆåŠŸï¼Œè·Ÿä¸Šé¢çš„é€»è¾‘ä¸€æ ·ï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹ç»•è¿‡å…¶ä»–çº¿ç¨‹å¹²æ‰°ï¼ŒæˆåŠŸè·å–åˆ°è¯¥è¿æ¥å¯¹è±¡ï¼Œç›´æ¥è¿”å› } } //èµ°åˆ°è¿™é‡Œè¯´æ˜ä¸å…‰çº¿ç¨‹ç¼“å­˜é‡Œçš„åˆ—è¡¨ç«äº‰ä¸åˆ°è¿æ¥å¯¹è±¡ï¼Œè¿sharedListé‡Œä¹Ÿæ‰¾ä¸åˆ°å¯ç”¨çš„è¿æ¥ï¼Œè¿™æ—¶åˆ™è®¤ä¸ºéœ€è¦é€šçŸ¥HikariPoolï¼Œè¯¥è§¦å‘æ·»åŠ è¿æ¥æ“ä½œäº† listener.addBagItem(waiting); timeout = timeUnit.toNanos(timeout); //è¿™æ—¶å€™å¼€å§‹åˆ©ç”¨timeoutæ§åˆ¶è·å–æ—¶é—´ do { final long start = currentTime(); //å°è¯•ä»handoffQueueé˜Ÿåˆ—é‡Œè·å–æœ€æ–°è¢«åŠ è¿›æ¥çš„è¿æ¥å¯¹è±¡ï¼ˆä¸€èˆ¬æ–°å…¥çš„è¿æ¥å¯¹è±¡é™¤äº†åŠ è¿›sharedListä¹‹å¤–ï¼Œè¿˜ä¼šè¢«offerè¿›è¯¥é˜Ÿåˆ—ï¼‰ final T bagEntry = handoffQueue.poll(timeout, NANOSECONDS); //å¦‚æœè¶…å‡ºæŒ‡å®šæ—¶é—´åä»ç„¶æ²¡æœ‰è·å–åˆ°å¯ç”¨çš„è¿æ¥å¯¹è±¡ï¼Œæˆ–è€…è·å–åˆ°å¯¹è±¡åé€šè¿‡casè®¾ç½®æˆåŠŸï¼Œè¿™ä¸¤ç§æƒ…å†µéƒ½ä¸éœ€è¦é‡è¯•ï¼Œç›´æ¥è¿”å›å¯¹è±¡ if (bagEntry == null || bagEntry.compareAndSet(STATE_NOT_IN_USE, STATE_IN_USE)) { return bagEntry; } //èµ°åˆ°è¿™é‡Œè¯´æ˜ä»é˜Ÿåˆ—å†…è·å–åˆ°äº†è¿æ¥å¯¹è±¡ï¼Œä½†æ˜¯casè®¾ç½®å¤±è´¥ï¼Œè¯´æ˜åˆè¯¥å¯¹è±¡åˆè¢«å…¶ä»–çº¿ç¨‹ç‡å…ˆæ‹¿å»ç”¨äº†ï¼Œè‹¥æ—¶é—´è¿˜å¤Ÿï¼Œåˆ™å†æ¬¡å°è¯•è·å– timeout -= elapsedNanos(start); //timeoutå‡å»æ¶ˆè€—çš„æ—¶é—´ï¼Œè¡¨ç¤ºä¸‹æ¬¡å¾ªç¯å¯ç”¨æ—¶é—´ } while (timeout &gt; 10_000); //å‰©ä½™æ—¶é—´å¤§äº10sæ—¶æ‰ç»§ç»­è¿›è¡Œï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå¾ªç¯åªä¼šèµ°ä¸€æ¬¡ï¼Œå› ä¸ºtimeoutå¾ˆå°‘ä¼šé…çš„æ¯”10sè¿˜å¤§ return null; //è¶…æ—¶ï¼Œä»ç„¶è¿”å›null } finally { waiters.decrementAndGet(); //è¿™ä¸€æ­¥å‡ºå»åï¼ŒHikariPoolæ”¶åˆ°borrowçš„ç»“æœï¼Œç®—æ˜¯èµ°å‡ºé˜»å¡ï¼Œæ‰€ä»¥waiters-1 }} ä»£ç å—17 ä»”ç»†çœ‹ä¸‹æ³¨é‡Šï¼Œè¯¥è¿‡ç¨‹å¤§è‡´åˆ†æˆä¸‰ä¸ªä¸»è¦æ­¥éª¤ï¼š ä»çº¿ç¨‹ç¼“å­˜è·å–è¿æ¥ è·å–ä¸åˆ°å†ä»sharedListé‡Œè·å– éƒ½è·å–ä¸åˆ°åˆ™è§¦å‘æ·»åŠ è¿æ¥é€»è¾‘ï¼Œå¹¶å°è¯•ä»é˜Ÿåˆ—é‡Œè·å–æ–°ç”Ÿæˆçš„è¿æ¥å¯¹è±¡ 12.2ï¼šaddè¿™ä¸ªæµç¨‹ä¼šæ·»åŠ ä¸€ä¸ªè¿æ¥å¯¹è±¡è¿›å…¥bagï¼Œé€šå¸¸ç”±ä¸»æµç¨‹3é‡Œçš„addBagItemæ–¹æ³•é€šè¿‡addConnectionExecutorå¼‚æ­¥ä»»åŠ¡è§¦å‘æ·»åŠ æ“ä½œï¼Œè¯¥æ–¹æ³•ä¸»æµç¨‹å¦‚ä¸‹ï¼š 12345678910public void add(final T bagEntry) { sharedList.add(bagEntry); //ç›´æ¥åŠ åˆ°sharedListé‡Œå» // æºæ³¨é‡Šï¼šspin until a thread takes it or none are waiting // å‚è€ƒborrowæµç¨‹ï¼Œå½“å­˜åœ¨çº¿ç¨‹ç­‰å¾…è·å–å¯ç”¨è¿æ¥ï¼Œå¹¶ä¸”å½“å‰æ–°å…¥çš„è¿™ä¸ªè¿æ¥çŠ¶æ€ä»ç„¶æ˜¯é—²ç½®çŠ¶æ€ï¼Œä¸”é˜Ÿåˆ—é‡Œæ— æ¶ˆè´¹è€…ç­‰å¾…è·å–æ—¶ï¼Œå‘èµ·ä¸€æ¬¡çº¿ç¨‹è°ƒåº¦ while (waiters.get() &gt; 0 &amp;&amp; bagEntry.getState() == STATE_NOT_IN_USE &amp;&amp; !handoffQueue.offer(bagEntry)) { //æ³¨æ„è¿™é‡Œä¼šofferä¸€ä¸ªè¿æ¥å¯¹è±¡å…¥é˜Ÿåˆ— yield(); }} ä»£ç å—18 ç»“åˆborrowæ¥ç†è§£çš„è¯ï¼Œè¿™é‡Œåœ¨å­˜åœ¨ç­‰å¾…çº¿ç¨‹æ—¶ä¼šæ·»åŠ ä¸€ä¸ªè¿æ¥å¯¹è±¡å…¥é˜Ÿåˆ—ï¼Œå¯ä»¥è®©borrowé‡Œå‘ç”Ÿç­‰å¾…çš„åœ°æ–¹æ›´å®¹æ˜“pollåˆ°è¿™ä¸ªè¿æ¥å¯¹è±¡ã€‚ 12.3ï¼šrequiteè¿™ä¸ªæµç¨‹ä¼šå›æ”¶ä¸€ä¸ªè¿æ¥ï¼Œè¯¥æ–¹æ³•çš„è§¦å‘ç‚¹åœ¨ä¸»æµç¨‹6ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920public void requite(final T bagEntry) { bagEntry.setState(STATE_NOT_IN_USE); //å›æ”¶æ„å‘³ç€ä½¿ç”¨å®Œæ¯•ï¼Œæ›´æ”¹stateä¸ºSTATE_NOT_IN_USEçŠ¶æ€ for (int i = 0; waiters.get() &gt; 0; i++) { //å¦‚æœå­˜åœ¨ç­‰å¾…çº¿ç¨‹çš„è¯ï¼Œå°è¯•ä¼ ç»™é˜Ÿåˆ—ï¼Œè®©borrowè·å– if (bagEntry.getState() != STATE_NOT_IN_USE || handoffQueue.offer(bagEntry)) { return; } else if ((i &amp; 0xff) == 0xff) { parkNanos(MICROSECONDS.toNanos(10)); } else { yield(); } } final List&lt;Object&gt; threadLocalList = threadList.get(); if (threadLocalList.size() &lt; 50) { //çº¿ç¨‹å†…è¿æ¥é›†åˆçš„ç¼“å­˜æœ€å¤š50ä¸ªï¼Œè¿™é‡Œå›æ”¶è¿æ¥æ—¶ä¼šå†æ¬¡åŠ è¿›å½“å‰çº¿ç¨‹çš„ç¼“å­˜é‡Œï¼Œæ–¹ä¾¿ä¸‹æ¬¡borrowè·å– threadLocalList.add(weakThreadLocals ? new WeakReference&lt;&gt;(bagEntry) : bagEntry); //é»˜è®¤ä¸å¯ç”¨å¼±å¼•ç”¨ï¼Œè‹¥å¯ç”¨çš„è¯ï¼Œåˆ™ç¼“å­˜é›†åˆé‡Œçš„è¿æ¥å¯¹è±¡æ²¡æœ‰å†…å­˜æ³„éœ²çš„é£é™© }} ä»£ç å—19 12.4ï¼šremoveè¿™ä¸ªè´Ÿè´£ä»æ± å­é‡Œç§»é™¤ä¸€ä¸ªè¿æ¥å¯¹è±¡ï¼Œè§¦å‘ç‚¹åœ¨æµç¨‹1.1.2ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415public boolean remove(final T bagEntry) { // ä¸‹é¢ä¸¤ä¸ªcasæ“ä½œï¼Œéƒ½æ˜¯ä»å…¶ä»–çŠ¶æ€å˜ä¸ºç§»é™¤çŠ¶æ€ï¼Œä»»æ„ä¸€ä¸ªæˆåŠŸï¼Œéƒ½ä¸ä¼šèµ°åˆ°ä¸‹é¢çš„warn log if (!bagEntry.compareAndSet(STATE_IN_USE, STATE_REMOVED) &amp;&amp; !bagEntry.compareAndSet(STATE_RESERVED, STATE_REMOVED) &amp;&amp; !closed) { LOGGER.warn(\"Attempt to remove an object from the bag that was not borrowed or reserved: {}\", bagEntry); return false; } // ç›´æ¥ä»sharedListç§»é™¤æ‰ final boolean removed = sharedList.remove(bagEntry); if (!removed &amp;&amp; !closed) { LOGGER.warn(\"Attempt to remove an object from the bag that does not exist: {}\", bagEntry); } return removed;} ä»£ç å—20 è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç§»é™¤æ—¶ä»…ä»…ç§»é™¤äº†sharedListé‡Œçš„å¯¹è±¡ï¼Œå„ä¸ªçº¿ç¨‹å†…ç¼“å­˜çš„é‚£ä¸€ä»½é›†åˆé‡Œå¯¹åº”çš„å¯¹è±¡å¹¶æ²¡æœ‰è¢«ç§»é™¤ï¼Œè¿™ä¸ªæ—¶å€™ä¼šä¸ä¼šå­˜åœ¨è¯¥è¿æ¥å†æ¬¡ä»ç¼“å­˜é‡Œæ‹¿åˆ°å‘¢ï¼Ÿä¼šçš„ï¼Œä½†æ˜¯ä¸ä¼šè¿”å›å‡ºå»ï¼Œè€Œæ˜¯ç›´æ¥removeæ‰äº†ï¼Œä»”ç»†çœ‹borrowçš„ä»£ç å‘ç°çŠ¶æ€ä¸æ˜¯é—²ç½®çŠ¶æ€çš„æ—¶å€™ï¼Œå–å‡ºæ¥æ—¶å°±ä¼šremoveæ‰ï¼Œç„¶åä¹Ÿæ‹¿ä¸å‡ºå»ï¼Œè‡ªç„¶ä¹Ÿä¸ä¼šè§¦å‘å›æ”¶æ–¹æ³•ã€‚ 12.5ï¼švaluesè¯¥æ–¹æ³•å­˜åœ¨é‡è½½æ–¹æ³•ï¼Œç”¨äºè¿”å›å½“å‰æ± å­å†…è¿æ¥å¯¹è±¡çš„é›†åˆï¼Œè§¦å‘ç‚¹åœ¨ä¸»æµç¨‹4ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011public List values(final int state) { //è¿‡æ»¤å‡ºæ¥ç¬¦åˆçŠ¶æ€å€¼çš„å¯¹è±¡é›†åˆé€†åºåè¿”å›å‡ºå» final List list = sharedList.stream().filter(e -&gt; e.getState() == state).collect(Collectors.toList()); Collections.reverse(list); return list;}public List values() { //è¿”å›å…¨éƒ¨è¿æ¥å¯¹è±¡ï¼ˆæ³¨æ„ä¸‹æ–¹cloneä¸ºæµ…æ‹·è´ï¼‰ return (List) sharedList.clone();} ä»£ç å—21 12.6ï¼šreserveè¯¥æ–¹æ³•å•çº¯å°†è¿æ¥å¯¹è±¡çš„çŠ¶æ€å€¼ç”±STATE_NOT_IN_USEä¿®æ”¹ä¸ºSTATE_RESERVEDï¼Œè§¦å‘ç‚¹ä»ç„¶æ˜¯ä¸»æµç¨‹4ï¼Œç¼©å®¹æ—¶ä½¿ç”¨ï¼Œä»£ç å¦‚ä¸‹ï¼š 123public boolean reserve(final T bagEntry){ return bagEntry.compareAndSet(STATE_NOT_IN_USE, STATE_RESERVED);} ä»£ç å—22 12.7ï¼šgetCountè¯¥æ–¹æ³•ç”¨äºè¿”å›æ± å†…ç¬¦åˆæŸä¸ªçŠ¶æ€å€¼çš„è¿æ¥çš„æ€»æ•°é‡ï¼Œè§¦å‘ç‚¹ä¸ºä¸»æµç¨‹5ï¼Œæ‰©å……è¿æ¥æ± æ—¶ç”¨äºè·å–é—²ç½®è¿æ¥æ€»æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789public int getCount(final int state){ int count = 0; for (IConcurrentBagEntry e : sharedList) { if (e.getState() == state) { count++; } } return count;} ä»£ç å—23 ä»¥ä¸Šå°±æ˜¯ConcurrentBagçš„ä¸»è¦æ–¹æ³•å’Œå¤„ç†è¿æ¥å¯¹è±¡çš„ä¸»è¦æµç¨‹ã€‚ åä¸‰ã€æ€»ç»“åˆ°è¿™é‡ŒåŸºæœ¬ä¸Šä¸€ä¸ªè¿æ¥çš„ç”Ÿäº§åˆ°è·å–åˆ°å›æ”¶åˆ°åºŸå¼ƒä¸€æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåœ¨HikariCPå†…æ˜¯å¦‚ä½•ç®¡ç†çš„å°±è¯´å®Œäº†ï¼Œç›¸æ¯”ä¹‹å‰çš„Druidçš„å®ç°ï¼Œæœ‰å¾ˆå¤§çš„ä¸åŒï¼Œä¸»è¦æ˜¯HikariCPçš„æ— é”è·å–è¿æ¥ï¼Œæœ¬ç¯‡æ²¡æœ‰æ¶‰åŠFastListçš„è¯´æ˜ï¼Œå› ä¸ºä»è¿æ¥ç®¡ç†è¿™ä¸ªè§’åº¦ç¡®å®å¾ˆå°‘ç”¨åˆ°è¯¥ç»“æ„ï¼Œç”¨åˆ°FastListçš„åœ°æ–¹ä¸»è¦åœ¨å­˜å‚¨è¿æ¥å¯¹è±¡ç”Ÿæˆçš„statementå¯¹è±¡ä»¥åŠç”¨äºå­˜å‚¨çº¿ç¨‹å†…ç¼“å­˜èµ·æ¥çš„è¿æ¥å¯¹è±¡ï¼› é™¤æ­¤ä¹‹å¤–HikariCPè¿˜åˆ©ç”¨javassistæŠ€æœ¯ç¼–è¯‘æœŸç”Ÿæˆäº†ProxyConnectionçš„åˆå§‹åŒ–ï¼Œè¿™é‡Œä¹Ÿæ²¡æœ‰ç›¸å…³è¯´æ˜ï¼Œç½‘ä¸Šæœ‰å…³HikariCPçš„ä¼˜åŒ–æœ‰å¾ˆå¤šæ–‡ç« ï¼Œå¤§å¤šæ•°éƒ½æåˆ°äº†å­—èŠ‚ç ä¼˜åŒ–ã€fastListã€concurrentBagçš„å®ç°ï¼Œæœ¬ç¯‡ä¸»è¦é€šè¿‡æ·±å…¥è§£æHikariPoolå’ŒConcurrentBagçš„å®ç°ï¼Œæ¥è¯´æ˜HikariCPç›¸æ¯”Druidå…·ä½“åšäº†å“ªäº›ä¸ä¸€æ ·çš„æ“ä½œã€‚","link":"/2019/08/28/%E6%B1%A0%E5%8C%96%E6%8A%80%E6%9C%AF%EF%BC%88%E4%BA%8C%EF%BC%89HikariCP%E6%98%AF%E5%A6%82%E4%BD%95%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E7%9A%84%EF%BC%9F/"},{"title":"æ± åŒ–æŠ€æœ¯ï¼ˆä¸€ï¼‰Druidæ˜¯å¦‚ä½•ç®¡ç†æ•°æ®åº“è¿æ¥çš„ï¼Ÿ","text":"åŸºäºä¾èµ–ç¨‹åºçš„ç‰ˆæœ¬ä¿¡æ¯ï¼š&nbsp;&nbsp; ä¸‹ä¸€ç¯‡ï¼šHikariCPæ˜¯å¦‚ä½•ç®¡ç†æ•°æ®åº“è¿æ¥çš„ é›¶ã€ç±»å›¾&amp;æµç¨‹é¢„è§ˆä¸‹æ–¹æµç¨‹ä¸­æ¶‰åŠåˆ°çš„ç±»ã€å±æ€§ã€æ–¹æ³•åå‡åˆ—åœ¨è¿™é‡Œï¼šDruid-ç±»å›¾-å±æ€§è¡¨ â†è¯¥è¡¨æ ¼ç”¨æ¥è¾…åŠ©ç†è§£ä¸‹é¢çš„æµç¨‹å›¾å’Œä»£ç ï¼Œä¸ç”¨ç»†çœ‹ï¼Œæ··ä¹±æ—¶å¯ç”¨æ¥ç†æ¸…å…³ç³»ã€‚ æœ¬æ–‡ä¼šé€šè¿‡getConnectionä½œä¸ºå…¥å£ï¼Œæ¢ç´¢åœ¨druidé‡Œï¼Œä¸€ä¸ªè¿æ¥çš„ç”Ÿå‘½å‘¨æœŸã€‚å¤§ä½“æµç¨‹è¢«åˆ’åˆ†æˆäº†ä»¥ä¸‹å‡ ä¸ªä¸»æµç¨‹ï¼š ä¸€ã€ä¸»æµç¨‹1ï¼šè·å–è¿æ¥æµç¨‹é¦–å…ˆä»å…¥å£æ¥çœ‹çœ‹å®ƒåœ¨è·å–è¿æ¥æ—¶åšäº†å“ªäº›æ“ä½œï¼š ä¸Šè¿°æµç¨‹å¯¹åº”æºä»£ç å¦‚ä¸‹ï¼ˆè¯·å±•å¼€ï¼‰ï¼š ä»£ç æ®µ1-1 &gt;folded123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104public DruidPooledConnection getConnection(long maxWaitMillis) throws SQLException { init(); //åˆå§‹åŒ–ï¼Œå³ä¸»æµç¨‹2 if (filters.size() &gt; 0) { FilterChainImpl filterChain = new FilterChainImpl(this); //è´£ä»»é“¾ï¼Œå†…éƒ¨ä¹Ÿæ˜¯è§¦å‘ä¸‹é¢çš„getConnectionDirectæ–¹æ³•ï¼Œåªæ˜¯è¦èµ°ä¸€éè´£ä»»é“¾ä¸Šæ¯ä¸ªfilterçš„é€»è¾‘ï¼Œè¿™é‡Œä¸åšæè¿°ï¼Œåç»­æ”¾åˆ°æµç¨‹1.1é‡Œä½“ç° return filterChain.dataSource_connect(this, maxWaitMillis); } else { return getConnectionDirect(maxWaitMillis); //è§¦å‘getConnectionDirect } } public DruidPooledConnection getConnectionDirect(long maxWaitMillis) throws SQLException { int notFullTimeoutRetryCnt = 0; for (;;) { //æ­»å¾ªç¯ /** * çœŸæ­£è¿”å›å‡ºå»çš„è¿æ¥å¯¹è±¡ï¼Œæ³¨æ„è¿™é‡Œæ˜¯è¢«druidåŒ…è£…æˆäº†DruidPooledConnectionç±»å‹ï¼Œ * å®é™…ä¸Šæ± å­é‡Œå­˜æ”¾çš„è¿æ¥ç±»å‹æ˜¯DruidConnectionHolderï¼ŒDruidPooledConnectionç±»æœ¬èº«æŒæœ‰ä¸€ä¸ªholderå±æ€§ï¼Œ * ç”¨äºä¿å­˜çœŸæ­£çš„è¿æ¥å¯¹è±¡ï¼Œè€ŒDruidConnectionHolderæ‰æ˜¯çœŸæ­£ä¿å­˜é©±åŠ¨è¿æ¥å¯¹è±¡çš„ç±»ã€‚ */ DruidPooledConnection poolableConnection; try { poolableConnection = getConnectionInternal(maxWaitMillis); //ä»æ± å­é‡Œè·å–è¿æ¥ï¼Œè¿™ä¸€ä¸ªåç»­æ”¾åˆ°æµç¨‹1.2ä½“ç° } catch (GetConnectionTimeoutException ex) { if (notFullTimeoutRetryCnt &lt;= this.notFullTimeoutRetryCount &amp;&amp; !isFull()) { //å‡ºç°äº†è¶…æ—¶å¼‚å¸¸ï¼Œåœ¨è¿æ¥æ± æ²¡æ»¡ä¸”é‡è¯•æ¬¡æ•°æœªè¶…è¿‡ä¸Šé™çš„æƒ…å†µä¸‹ï¼Œé‡è¯•ä¸€æ¬¡ï¼ˆnotFullTimeoutRetryCounté»˜è®¤æ˜¯0ï¼Œæ‰€ä»¥è‡³å°‘å¯ä»¥é‡è¯•ä¸€æ¬¡ï¼‰ã€‚ notFullTimeoutRetryCnt++; //é‡è¯•æ¬¡æ•°+1 if (LOG.isWarnEnabled()) { LOG.warn(\"get connection timeout retry : \" + notFullTimeoutRetryCnt); } continue; } throw ex; //è¶…è¿‡é‡è¯•æ¬¡æ•°æˆ–è€…æ± å­å·²æ»¡ä»ç„¶è·å–å¤±è´¥ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸ } if (testOnBorrow) { //testOnBorrowå¼€å¯æ—¶ï¼Œæ¯æ¬¡éƒ½è¿›è¡Œæ£€æµ‹è¿æ¥å¯ç”¨æ€§ boolean validate = testConnectionInternal(poolableConnection.holder, poolableConnection.conn); if (!validate) { if (LOG.isDebugEnabled()) { LOG.debug(\"skip not validate connection.\"); } Connection realConnection = poolableConnection.conn; //è·å–çœŸæ­£é©±åŠ¨çš„è¿æ¥å¯¹è±¡ discardConnection(realConnection); //è‹¥è¿æ¥ä¸å¯ç”¨ï¼Œåˆ™è§¦å‘discardï¼Œè¿™ä¸ªæ–¹æ³•å…·ä½“æ”¾åˆ°æµç¨‹1.4ä½“ç° continue; } } else { Connection realConnection = poolableConnection.conn; if (poolableConnection.conn.isClosed()) { discardConnection(null); // ä¼ å…¥nullï¼Œé¿å…é‡å¤å…³é—­ continue; } if (testWhileIdle) { //ä¸å¯ç”¨testOnBorrowçš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šåˆ¤æ–­æ˜¯å¦å¯ç”¨testWhileIdle final DruidConnectionHolder holder = poolableConnection.holder; long currentTimeMillis = System.currentTimeMillis(); long lastActiveTimeMillis = holder.lastActiveTimeMillis; //ä¸Šæ¬¡è¢«ä½¿ç”¨çš„æ—¶é—´ long lastKeepTimeMillis = holder.lastKeepTimeMillis; if (lastKeepTimeMillis &gt; lastActiveTimeMillis) { lastActiveTimeMillis = lastKeepTimeMillis; } long idleMillis = currentTimeMillis - lastActiveTimeMillis; //è®¡ç®—å‡ºé—²ç½®æ—¶é—´ long timeBetweenEvictionRunsMillis = this.timeBetweenEvictionRunsMillis; if (timeBetweenEvictionRunsMillis &lt;= 0) { timeBetweenEvictionRunsMillis = DEFAULT_TIME_BETWEEN_EVICTION_RUNS_MILLIS; } if (idleMillis &gt;= timeBetweenEvictionRunsMillis || idleMillis &lt; 0) { //å½“é—²ç½®æ—¶é—´è¶…å‡ºtimeBetweenEvictionRunsMillisï¼ˆé»˜è®¤60sï¼‰æ—¶ï¼Œåˆ™è§¦å‘æ£€æŸ¥é€»è¾‘ boolean validate = testConnectionInternal(poolableConnection.holder, poolableConnection.conn); if (!validate) { if (LOG.isDebugEnabled()) { LOG.debug(\"skip not validate connection.\"); } discardConnection(realConnection); //è¿æ¥ä¸å¯ç”¨ï¼ŒåŒæ ·è§¦å‘discard continue; } } } } if (removeAbandoned) { //è‹¥å¼€å¯removeAbandonedï¼Œåˆ™æŠŠå½“å‰æ‹¿åˆ°çš„è¿æ¥æ”¾åˆ°activeConnectionsé‡Œï¼Œæ–¹ä¾¿åç»­æ£€æŸ¥ï¼ˆåé¢æµç¨‹4.2ä½“ç°ï¼‰ StackTraceElement[] stackTrace = Thread.currentThread().getStackTrace(); poolableConnection.connectStackTrace = stackTrace; poolableConnection.setConnectedTimeNano(); //è®¾ç½®è¿æ¥è·å–æ—¶é—´ä¸ºå½“å‰æ—¶é—´ poolableConnection.traceEnable = true; //è¿™ä¸ªè®¾ç½®ä¸ºtrueï¼Œåˆ™åœ¨å½’è¿˜è¯¥è¿æ¥æ—¶ä¼šåœ¨activeConnectionsé‡Œæ¸…é™¤æ‰è¯¥è¿æ¥å¯¹è±¡ activeConnectionLock.lock(); try { activeConnections.put(poolableConnection, PRESENT); } finally { activeConnectionLock.unlock(); } } if (!this.defaultAutoCommit) { //é»˜è®¤æ˜¯ä¸å¼€äº‹åŠ¡çš„ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯trueï¼Œä¸ä¼šè§¦å‘ä¸‹é¢çš„é€»è¾‘ï¼›è¿™ä¸ªä¸å»ºè®®æ‰‹åŠ¨è®¾ç½®é»˜è®¤å€¼ï¼Œä¸€èˆ¬å¼€å¯äº‹åŠ¡çš„å·¥ä½œè‡ªå·±åšæˆ–è€…äº¤ç»™ç¬¬ä¸‰æ–¹æ¡†æ¶ï¼ˆå¦‚springï¼‰åšæ¯”è¾ƒå¥½ poolableConnection.setAutoCommit(false); } return poolableConnection; //æœ€ç»ˆè¿”å›å¯ç”¨è¿æ¥ } } ä¸Šè¿°ä¸ºè·å–è¿æ¥æ—¶çš„æµç¨‹å›¾ï¼Œé¦–å…ˆä¼šè°ƒç”¨initè¿›è¡Œè¿æ¥æ± çš„åˆå§‹åŒ–ï¼Œç„¶åè¿è¡Œè´£ä»»é“¾ä¸Šçš„æ¯ä¸€ä¸ªfilterï¼Œæœ€ç»ˆæ‰§è¡ŒgetConnectionDirectè·å–çœŸæ­£çš„è¿æ¥å¯¹è±¡ï¼Œå¦‚æœå¼€å¯äº†testOnBorrowï¼Œåˆ™æ¯æ¬¡éƒ½ä¼šå»æµ‹è¯•è¿æ¥æ˜¯å¦å¯ç”¨ è¿™ä¹Ÿæ˜¯å®˜æ–¹ä¸å»ºè®®è®¾ç½®testOnBorrowä¸ºtrueçš„åŸå› ï¼Œå½±å“æ€§èƒ½ï¼Œè¿™é‡Œçš„æµ‹è¯•æ˜¯æŒ‡æµ‹è¯•mysqlæœåŠ¡ç«¯çš„é•¿è¿æ¥æ˜¯å¦æ–­å¼€ï¼Œä¸€èˆ¬mysqlæœåŠ¡ç«¯é•¿è¿ä¿æ´»æ—¶é—´æ˜¯8hï¼Œè¢«ä½¿ç”¨ä¸€æ¬¡åˆ™åˆ·æ–°ä¸€æ¬¡ä½¿ç”¨æ—¶é—´ï¼Œè‹¥ä¸€ä¸ªè¿æ¥è·ç¦»ä¸Šæ¬¡è¢«ä½¿ç”¨è¶…è¿‡äº†ä¿æ´»æ—¶é—´ï¼Œé‚£ä¹ˆå†æ¬¡ä½¿ç”¨æ—¶å°†æ— æ³•ä¸mysqlæœåŠ¡ç«¯é€šä¿¡ å¦‚æœtestOnBorrowæ²¡æœ‰è¢«ç½®ä¸ºtrueï¼Œåˆ™ä¼šè¿›è¡ŒtestWhileIdleçš„æ£€æŸ¥ï¼ˆè¿™ä¸€é¡¹å®˜æ–¹å»ºè®®è®¾ç½®ä¸ºtrueï¼Œç¼ºçœå€¼ä¹Ÿæ˜¯trueï¼‰ï¼Œæ£€æŸ¥æ—¶ä¼šåˆ¤æ–­å½“å‰è¿æ¥å¯¹è±¡è·ç¦»ä¸Šæ¬¡è¢«ä½¿ç”¨çš„æ—¶é—´æ˜¯å¦è¶…è¿‡è§„å®šæ£€æŸ¥çš„æ—¶é—´ï¼Œè‹¥è¶…è¿‡ï¼Œåˆ™è¿›è¡Œæ£€æŸ¥ä¸€æ¬¡ï¼Œè¿™ä¸ªæ£€æŸ¥æ—¶é—´é€šè¿‡timeBetweenEvictionRunsMillisæ¥æ§åˆ¶ï¼Œé»˜è®¤60sï¼Œæ¯ä¸ªè¿æ¥å¯¹è±¡ä¼šè®°å½•ä¸‹ä¸Šæ¬¡è¢«ä½¿ç”¨çš„æ—¶é—´ï¼Œç”¨å½“å‰æ—¶é—´å‡å»ä¸Šä¸€æ¬¡çš„ä½¿ç”¨æ—¶é—´å¾—å‡ºé—²ç½®æ—¶é—´ï¼Œé—²ç½®æ—¶é—´å†è·ŸtimeBetweenEvictionRunsMillisæ¯”è¾ƒï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´å°±åšä¸€æ¬¡è¿æ¥å¯ç”¨æ€§æ£€æŸ¥ï¼Œè¿™ä¸ªç›¸æ¯”testOnBorrowæ¯æ¬¡éƒ½æ£€æŸ¥æ¥è¯´ï¼Œæ€§èƒ½ä¼šæå‡å¾ˆå¤šï¼Œç”¨çš„æ—¶å€™æ— éœ€å…³æ³¨è¯¥å€¼ï¼Œå› ä¸ºç¼ºçœå€¼æ˜¯trueï¼Œç»æµ‹è¯•å¦‚æœå°†è¯¥å€¼è®¾ç½®ä¸ºfalseï¼ŒtestOnBorrowä¹Ÿè®¾ç½®ä¸ºfalseï¼Œæ•°æ®åº“æœåŠ¡ç«¯é•¿è¿ä¿æ´»æ—¶é—´æ”¹ä¸º60sï¼Œ60så†…ä¸ä½¿ç”¨è¿æ¥ï¼Œè¶…è¿‡60såä½¿ç”¨å°†ä¼šæŠ¥è¿æ¥é”™è¯¯ã€‚è‹¥ä½¿ç”¨testConnectionInternalæ–¹æ³•æµ‹è¯•é•¿è¿æ¥ç»“æœä¸ºfalseï¼Œåˆ™è¯æ˜è¯¥è¿æ¥å·²è¢«æœåŠ¡ç«¯æ–­å¼€æˆ–è€…æœ‰å…¶ä»–çš„ç½‘ç»œåŸå› å¯¼è‡´è¯¥è¿æ¥ä¸å¯ç”¨ï¼Œåˆ™ä¼šè§¦å‘discardConnectionè¿›è¡Œè¿æ¥å›æ”¶ï¼ˆå¯¹åº”æµç¨‹1.4ï¼Œå› ä¸ºä¸¢å¼ƒäº†ä¸€ä¸ªè¿æ¥ï¼Œå› æ­¤è¯¥æ–¹æ³•ä¼šå”¤é†’ä¸»æµç¨‹3è¿›è¡Œæ£€æŸ¥æ˜¯å¦éœ€è¦æ–°å»ºè¿æ¥ï¼‰ã€‚æ•´ä¸ªæµç¨‹è¿è¡Œåœ¨ä¸€ä¸ªæ­»å¾ªç¯å†…ï¼Œç›´åˆ°å–åˆ°å¯ç”¨è¿æ¥æˆ–è€…è¶…è¿‡é‡è¯•ä¸Šé™æŠ¥é”™é€€å‡ºï¼ˆåœ¨è¿æ¥æ²¡æœ‰è¶…è¿‡è¿æ¥æ± ä¸Šé™çš„è¯ï¼Œæœ€å¤šé‡è¯•ä¸€æ¬¡ï¼ˆé‡è¯•æ¬¡æ•°é»˜è®¤é‡è¯•1æ¬¡ï¼Œå¯ä»¥é€šè¿‡notFullTimeoutRetryCountå±æ€§æ¥æ§åˆ¶ï¼‰ï¼Œæ‰€ä»¥å–è¿æ¥è¿™é‡Œä¸€æ—¦å‘ç”Ÿç­‰å¾…ï¼Œåœ¨è¿æ¥æ± æ²¡æœ‰æ»¡çš„æƒ…å†µä¸‹ï¼Œæœ€å¤§ç­‰å¾…2 Ã— maxWaitçš„æ—¶é—´ â†è¿™ä¸ªæœ‰å¾…éªŒè¯ï¼‰ã€‚ ç‰¹åˆ«è¯´æ˜é¡¹ ä¸ºäº†ä¿è¯æ€§èƒ½ï¼Œä¸å»ºè®®å°†testOnBorrowè®¾ç½®ä¸ºtrueï¼Œæˆ–è€…è¯´ç‰µæ‰¯åˆ°é•¿è¿æ¥å¯ç”¨æ£€æµ‹çš„é‚£å‡ é¡¹é…ç½®ä½¿ç”¨druidé»˜è®¤çš„é…ç½®å°±å¯ä»¥ä¿è¯æ€§èƒ½æ˜¯æœ€å¥½çš„ï¼Œå¦‚ä¸Šæ‰€è¯´ï¼Œé»˜è®¤é•¿è¿æ¥æ£€æŸ¥æ˜¯60sä¸€æ¬¡ï¼Œæ‰€ä»¥ä¸å¯ç”¨testOnBorrowçš„æƒ…å†µä¸‹è¦æƒ³ä¿è¯ä¸‡æ— ä¸€å¤±ï¼Œè‡ªå·±è¦ç¡®è®¤ä¸‹æ‰€è¿çš„é‚£ä¸ªmysqlæœåŠ¡ç«¯çš„é•¿è¿æ¥ä¿æ´»æ—¶é—´ï¼ˆè™½ç„¶é»˜è®¤æ˜¯8hï¼Œä½†æ˜¯dbaå¯èƒ½ç»™æµ‹è¯•ç¯å¢ƒè®¾ç½®çš„æ—¶é—´è¿œå°äºè¿™ä¸ªæ—¶é—´ï¼Œæ‰€ä»¥å¦‚æœè¿™ä¸ªæ—¶é—´å°äº60sï¼Œå°±éœ€è¦æ‰‹åŠ¨è®¾ç½®timeBetweenEvictionRunsMillisäº†ï¼Œå¦‚æœmysqlæœåŠ¡ç«¯é•¿è¿æ¥æ—¶é—´æ˜¯8hæˆ–è€…æ›´é•¿ï¼Œåˆ™ç”¨é»˜è®¤å€¼å³å¯ã€‚ ä¸ºäº†é˜²æ­¢ä¸å¿…è¦çš„æ‰©å®¹ï¼Œåœ¨mysqlæœåŠ¡ç«¯é•¿è¿æ¥å¤Ÿç”¨çš„æƒ…å†µä¸‹ï¼Œå¯¹äºä¸€äº›qpsè¾ƒé«˜çš„æœåŠ¡ã€ç½‘å…³ä¸šåŠ¡ï¼Œå»ºè®®æŠŠæ± å­çš„æœ€å°é—²ç½®è¿æ¥æ•°minIdleå’Œæœ€å¤§è¿æ¥æ•°maxActiveè®¾ç½®æˆä¸€æ ·çš„ï¼Œä¸”æŒ‰ç…§éœ€è¦è°ƒå¤§ï¼Œä¸”å¼€å¯keepAliveè¿›è¡Œè¿æ¥æ´»æ€§æ£€æŸ¥ï¼ˆå‚è€ƒæµç¨‹4.1ï¼‰ï¼Œè¿™æ ·å°±ä¸ä¼šåæœŸå‘ç”ŸåŠ¨æ€æ–°å»ºè¿æ¥çš„æƒ…å†µï¼ˆå»ºè¿è¿˜æ˜¯ä¸ªæ¯”è¾ƒé‡çš„æ“ä½œï¼Œæ‰€ä»¥ä¸å¦‚ä¸€å¼€å§‹å°±ç”³è¯·å¥½æ‰€æœ‰éœ€è¦çš„è¿æ¥ï¼Œä¸ªäººæ„è§ï¼Œä»…ä¾›å‚è€ƒï¼‰ï¼Œä½†æ˜¯åƒç®¡ç†åå°è¿™ç§ï¼Œé•¿æœŸqpséå¸¸ä½ï¼Œä½†æ˜¯æœ‰çš„æ—¶å€™éœ€è¦ç”¨ç®¡ç†åå°åšä¸€äº›å·¨å¤§çš„æ“ä½œï¼ˆæ¯”å¦‚å¯¼æ•°æ®ä»€ä¹ˆçš„ï¼‰å¯¼è‡´éœ€è¦çš„è¿æ¥æš´å¢ï¼Œä¸”ç®¡ç†åå°ä¸ä¼šç‰¹åˆ«è¦æ±‚æ€§èƒ½ï¼Œå°±é€‚åˆå°†minIdleçš„å€¼è®¾ç½®çš„æ¯”maxActiveå°ï¼Œè¿™æ ·ä¸ä¼šé€ æˆä¸å¿…è¦çš„è¿æ¥æµªè´¹ï¼Œä¹Ÿä¸ä¼šåœ¨éœ€è¦æš´å¢è¿æ¥çš„æ—¶å€™æ— æ³•åŠ¨æ€æ‰©å¢è¿æ¥ã€‚ äºŒã€ä¸»æµç¨‹2ï¼šåˆå§‹åŒ–è¿æ¥æ± é€šè¿‡ä¸Šé¢çš„æµç¨‹å›¾å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è·å–ä¸€ä¸ªè¿æ¥çš„æ—¶å€™é¦–å…ˆä¼šæ£€æŸ¥è¿æ¥æ± æ˜¯å¦å·²ç»åˆå§‹åŒ–å®Œæ¯•ï¼ˆé€šè¿‡initedæ¥æ§åˆ¶ï¼Œboolç±»å‹ï¼Œæœªåˆå§‹åŒ–ä¸ºflaseï¼Œåˆå§‹åŒ–å®Œæ¯•ä¸ºtrueï¼Œè¿™ä¸ªåˆ¤æ–­è¿‡ç¨‹åœ¨initæ–¹æ³•å†…å®Œæˆï¼‰ï¼Œè‹¥æ²¡æœ‰åˆå§‹åŒ–ï¼Œåˆ™è°ƒç”¨initè¿›è¡Œåˆå§‹åŒ–ï¼ˆå›¾ä¸»æµç¨‹1ä¸­çš„ç´«è‰²éƒ¨åˆ†ï¼‰ï¼Œä¸‹é¢æ¥çœ‹çœ‹initæ–¹æ³•é‡Œåˆåšäº†å“ªäº›æ“ä½œï¼š ä¸Šè¿°æµç¨‹å¯¹åº”æºä»£ç å¦‚ä¸‹ï¼ˆè¯·å±•å¼€ï¼‰ï¼š ä»£ç æ®µ2-1 >folded123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295public void init() throws SQLException { if (inited) { return; //å¦‚æœå·²ç»è¢«åˆå§‹åŒ–è¿‡ï¼Œåˆ™ç»ˆæ­¢è¯¥æ–¹æ³• } // bug fixed for dead lock, for issue #2980 DruidDriver.getInstance(); final ReentrantLock lock = this.lock; //è·å–é‡å…¥é” try { lock.lockInterruptibly(); } catch (InterruptedException e) { throw new SQLException(\"interrupt\", e); } boolean init = false; try { if (inited) { //åŒé‡æ£€æŸ¥ return; } initStackTrace = Utils.toString(Thread.currentThread().getStackTrace()); this.id = DruidDriver.createDataSourceId(); //ç”Ÿæˆè¿æ¥æ± id if (this.id &gt; 1) { //ç”Ÿæˆå…¶ä»–å¯¹è±¡çš„idï¼Œæ¯”å¦‚è¿æ¥å¯¹è±¡çš„idã€statementå¯¹è±¡çš„id long delta = (this.id - 1) * 100000; this.connectionIdSeedUpdater.addAndGet(this, delta); this.statementIdSeedUpdater.addAndGet(this, delta); this.resultSetIdSeedUpdater.addAndGet(this, delta); this.transactionIdSeedUpdater.addAndGet(this, delta); } if (this.jdbcUrl != null) { this.jdbcUrl = this.jdbcUrl.trim(); initFromWrapDriverUrl(); //jdbc urlçš„å¤´å¿…é¡»æ˜¯jdbc:wrap-jdbcæ‰ä¼šè§¦å‘è¯¥æ–¹æ³•é‡Œçš„é€»è¾‘ï¼ˆè¿™ä¸ªå¤´è²Œä¼¼æ˜¯oracleçš„ï¼Ÿæœ¬ç¯‡æ–‡ç« ä»…é’ˆå¯¹mysqlï¼‰ } for (Filter filter : filters) { filter.init(this); //é€šè¿‡æ± å¯¹è±¡åˆå§‹åŒ–filtersï¼ˆå› ä¸ºfilteré‡Œé¢å¯èƒ½ä¼šç”¨åˆ°ä¸€äº›æ± å±æ€§ï¼‰ } if (this.dbType == null || this.dbType.length() == 0) { this.dbType = JdbcUtils.getDbType(jdbcUrl, null); //æ ¹æ®jdbcåè®®å¤´åˆ†æå‡ºå½“å‰æ•°æ®åº“çš„ç±»å‹ï¼ˆæœ¬æ–‡é»˜è®¤mysqlï¼‰ } if (JdbcConstants.MYSQL.equals(this.dbType) || JdbcConstants.MARIADB.equals(this.dbType) || JdbcConstants.ALIYUN_ADS.equals(this.dbType)) { boolean cacheServerConfigurationSet = false; if (this.connectProperties.containsKey(\"cacheServerConfiguration\")) { cacheServerConfigurationSet = true; } else if (this.jdbcUrl.indexOf(\"cacheServerConfiguration\") != -1) { cacheServerConfigurationSet = true; } if (cacheServerConfigurationSet) { this.connectProperties.put(\"cacheServerConfiguration\", \"true\"); } } //ä¸‹é¢å°±æ˜¯å¯¹è®¾ç½®çš„è¿™äº›å±æ€§åˆç†æ€§çš„åˆ¤æ–­ï¼Œä¸ç¬¦åˆè¦æ±‚çš„å°†ç›´æ¥æŠ›å¼‚å¸¸ if (maxActive &lt;= 0) { throw new IllegalArgumentException(\"illegal maxActive \" + maxActive); } if (maxActive &lt; minIdle) { throw new IllegalArgumentException(\"illegal maxActive \" + maxActive); } if (getInitialSize() &gt; maxActive) { throw new IllegalArgumentException(\"illegal initialSize \" + this.initialSize + \", maxActive \" + maxActive); } if (timeBetweenLogStatsMillis &gt; 0 &amp;&amp; useGlobalDataSourceStat) { throw new IllegalArgumentException(\"timeBetweenLogStatsMillis not support useGlobalDataSourceStat=true\"); } if (maxEvictableIdleTimeMillis &lt; minEvictableIdleTimeMillis) { throw new SQLException(\"maxEvictableIdleTimeMillis must be grater than minEvictableIdleTimeMillis\"); } if (this.driverClass != null) { this.driverClass = driverClass.trim(); } //é€šè¿‡SPIæœºåˆ¶åŠ è½½è´£ä»»é“¾ä¸Šéœ€è¦æ‰§è¡Œçš„filterï¼Œæ–¹æ³•è¯¦æƒ…åœ¨ä¸‹é¢ initFromSPIServiceLoader(); //å¦‚æœdriverä¸ºç©ºï¼ŒåŠ è½½é©±åŠ¨ï¼Œæœ€ç»ˆå°†åŠ è½½åˆ°çš„é©±åŠ¨æ³¨å†Œåˆ°DriverManagerä¸Šå» if (this.driver == null) { if (this.driverClass == null || this.driverClass.isEmpty()) { this.driverClass = JdbcUtils.getDriverClassName(this.jdbcUrl); //åœ¨driverClassä¸é…ç½®çš„æƒ…å†µä¸‹ï¼Œdruidä¼šé€šè¿‡urlæ¥åˆ¤å®šå±äºå“ªä¸ªdriverClass } if (MockDriver.class.getName().equals(driverClass)) { //å¿½ç•¥ driver = MockDriver.instance; } else { if (jdbcUrl == null &amp;&amp; (driverClass == null || driverClass.length() == 0)) { throw new SQLException(\"url not set\"); } driver = JdbcUtils.createDriver(driverClassLoader, driverClass); //driverClassä¸ä¸ºç©ºçš„æƒ…å†µä¸‹ç›´æ¥è§¦å‘é©±åŠ¨åŠ è½½ } } else { //é™¤éæ‰‹åŠ¨è®¾ç½®é©±åŠ¨ï¼Œå¦åˆ™ä¸ä¼šèµ°è¿™é‡Œçš„é€»è¾‘ if (this.driverClass == null) { this.driverClass = driver.getClass().getName(); } } initCheck(); //æ ¹æ®dbTypeçš„ä¸åŒï¼Œæ¥åˆå§‹åŒ–ä¸€äº›æ ‡è®°å­—æ®µï¼ˆæ¯”å¦‚isMySqlï¼‰ initExceptionSorter(); //å¼‚å¸¸å¤„ç†å™¨åˆå§‹åŒ– initValidConnectionChecker(); //åˆå§‹åŒ–é•¿è¿æ¥æ£€æµ‹æ—¶æ‰€éœ€è¦ç”¨åˆ°çš„checkerçš„é€‚é…ç±»å‹ï¼Œå…·ä½“å®ç°åœ¨ä¸‹é¢ validationQueryCheck(); //ç®€å•çš„æ£€æµ‹validationQueryå‚æ•°æ˜¯å¦å¡«å†™äº†ï¼Œè‹¥æ²¡å¡«å†™ä¼šæ‰“å°ä¸€ä¸ªé”™è¯¯æ—¥å¿—ï¼Œä¸å½±å“ä¸»æµç¨‹ if (isUseGlobalDataSourceStat()) { //é»˜è®¤ä¸å¼€å¯ï¼Œå¿½ç•¥ dataSourceStat = JdbcDataSourceStat.getGlobal(); if (dataSourceStat == null) { dataSourceStat = new JdbcDataSourceStat(\"Global\", \"Global\", this.dbType); JdbcDataSourceStat.setGlobal(dataSourceStat); } if (dataSourceStat.getDbType() == null) { dataSourceStat.setDbType(this.dbType); } } else { dataSourceStat = new JdbcDataSourceStat(this.name, this.jdbcUrl, this.dbType, this.connectProperties); } dataSourceStat.setResetStatEnable(this.resetStatEnable); //ä¸‹é¢ä¸‰ä¸ªæ•°ç»„éƒ½è·Ÿæ± å­æœ¬èº«æœ‰å…³ç³»ï¼Œæ‰€ä»¥å®¹é‡ä¸ºmaxActive connections = new DruidConnectionHolder[maxActive]; //åˆå§‹åŒ–è¿æ¥æ± æœ¬ä½“ evictConnections = new DruidConnectionHolder[maxActive]; //åˆå§‹åŒ–ä¸¢å¼ƒè¿æ¥æ•°ç»„ï¼ˆæµç¨‹4.1éœ€è¦ç”¨åˆ°ï¼‰ keepAliveConnections = new DruidConnectionHolder[maxActive]; //åˆå§‹åŒ–éœ€è¦æ£€æµ‹å¯ç”¨æ€§è¿æ¥æ•°ç»„ï¼ˆæµç¨‹4.1è¦ç”¨ï¼‰ SQLException connectError = null; if (createScheduler != null &amp;&amp; asyncInit) { //å¦å¤–ä¸€ç§é€šè¿‡çº¿ç¨‹æ± ç®¡ç†è¿æ¥æ± çš„æ–¹å¼ï¼Œé»˜è®¤ä¸å¯ç”¨ï¼Œå¿½ç•¥ for (int i = 0; i &lt; initialSize; ++i) { createTaskCount++; CreateConnectionTask task = new CreateConnectionTask(true); this.createSchedulerFuture = createScheduler.submit(task); } } else if (!asyncInit) { // init connections while (poolingCount &lt; initialSize) { //å½“æ± å­é‡Œçš„è¿æ¥æ•°å°‘äºéœ€è¦åˆå§‹åŒ–çš„ä¸ªæ•°æ—¶ï¼Œåˆ™éœ€è¦ä¸æ–­æ–°å¢è¿æ¥å¡«å……è¿æ¥æ± ï¼Œç›´åˆ°ç­‰äºåˆå§‹åŒ–è¿æ¥æ•° try { PhysicalConnectionInfo pyConnectInfo = createPhysicalConnection(); //ç›´æ¥é€šè¿‡é©±åŠ¨ç¨‹åºåˆ›å»ºè¿æ¥å¯¹è±¡ï¼Œå‚è€ƒæµç¨‹2.1 DruidConnectionHolder holder = new DruidConnectionHolder(this, pyConnectInfo); //æ‹¿ç€é©±åŠ¨è¿æ¥åŒ…è£…æˆholderå¯¹è±¡ connections[poolingCount++] = holder; //ç”Ÿæˆå¥½çš„è¿æ¥ç›´æ¥å¾€åæ’ } catch (SQLException ex) { LOG.error(\"init datasource error, url: \" + this.getUrl(), ex); if (initExceptionThrow) { connectError = ex; break; } else { Thread.sleep(3000); //å¼‚å¸¸æŠ¥é”™åä¼šä¼‘çœ 3sæ¥è¿›è¡Œä¸‹æ¬¡çš„æ·»åŠ  } } } if (poolingCount &gt; 0) { poolingPeak = poolingCount; poolingPeakTime = System.currentTimeMillis(); } } createAndLogThread(); //å¼€å¯æ‰“å°logæ—¥å¿—çš„å®ˆæŠ¤çº¿ç¨‹ createAndStartCreatorThread(); //å¼€å¯è´Ÿè´£æ–°å¢è¿æ¥çš„å®ˆæŠ¤çº¿ç¨‹ï¼ˆä¸»æµç¨‹3ï¼‰ createAndStartDestroyThread(); //å¼€å¯è´Ÿè´£ä¸¢å¼ƒè¿æ¥çš„å®ˆæŠ¤çº¿ç¨‹ï¼ˆä¸»æµç¨‹4ï¼‰ initedLatch.await(); //å€’è®¡æ•°å™¨ï¼Œç”¨æ¥ä¿è¯ä¸Šé¢çš„ä¸»æµç¨‹3å’Œ4ä¸¤ä¸ªå®ˆæŠ¤çº¿ç¨‹å…¨éƒ¨å¼€å¯å®Œæ¯•åæ‰è¿›è¡Œæ¥ä¸‹æ¥çš„æ“ä½œ init = true; initedTime = new Date(); registerMbean(); if (connectError != null &amp;&amp; poolingCount == 0) { throw connectError; } if (keepAlive) { // async fill to minIdle if (createScheduler != null) { //é»˜è®¤ä¸å¯ç”¨è¯¥æ¨¡å¼ï¼Œå¿½ç•¥ for (int i = 0; i &lt; minIdle; ++i) { createTaskCount++; CreateConnectionTask task = new CreateConnectionTask(true); this.createSchedulerFuture = createScheduler.submit(task); } } else { this.emptySignal(); //keepAlive=trueï¼Œä¸»åŠ¨å”¤èµ·ä¸»æµç¨‹3ä¸€æ¬¡ } } } catch (SQLException e) { LOG.error(\"{dataSource-\" + this.getID() + \"} init error\", e); throw e; } catch (InterruptedException e) { throw new SQLException(e.getMessage(), e); } catch (RuntimeException e){ LOG.error(\"{dataSource-\" + this.getID() + \"} init error\", e); throw e; } catch (Error e){ LOG.error(\"{dataSource-\" + this.getID() + \"} init error\", e); throw e; } finally { inited = true; //åˆå§‹åŒ–å®Œæˆåç½®ä¸ºtrue lock.unlock(); //é‡Šæ”¾é” if (init &amp;&amp; LOG.isInfoEnabled()) { String msg = \"{dataSource-\" + this.getID(); if (this.name != null &amp;&amp; !this.name.isEmpty()) { msg += \",\"; msg += this.name; } msg += \"} inited\"; LOG.info(msg); } } } private void initFromSPIServiceLoader() { if (loadSpifilterSkip) { //é»˜è®¤ä¸è·³è¿‡SPIåŠ è½½ return; } if (autoFilters == null) { List filters = new ArrayList(); ServiceLoader autoFilterLoader = ServiceLoader.load(Filter.class); //åŠ è½½Filterçš„å®ç° for (Filter filter : autoFilterLoader) { AutoLoad autoLoad = filter.getClass().getAnnotation(AutoLoad.class); if (autoLoad != null &amp;&amp; autoLoad.value()) { filters.add(filter); } } autoFilters = filters; } for (Filter filter : autoFilters) { if (LOG.isInfoEnabled()) { LOG.info(\"load filter from spi :\" + filter.getClass().getName()); } addFilter(filter); //æŠŠé€šè¿‡SPIæœºåˆ¶åŠ è½½åˆ°çš„filteræ”¾åˆ°æ± å­çš„filtersé‡Œï¼Œç”¨äºåç»­è´£ä»»é“¾è§¦å‘ } } private void initValidConnectionChecker() { //åˆå§‹åŒ–checker if (this.validConnectionChecker != null) { return; } String realDriverClassName = driver.getClass().getName(); //æ ¹æ®é©±åŠ¨çš„classåç§°ï¼Œæ¥é€‚é…å…·ä½“çš„checkerå®ç° if (JdbcUtils.isMySqlDriver(realDriverClassName)) { this.validConnectionChecker = new MySqlValidConnectionChecker(); //å‡è®¾æ˜¯mysqlç±»å‹çš„é©±åŠ¨ï¼Œé‚£ä¹ˆé€‚é…åˆ°mysqlçš„checkerï¼ŒMySqlValidConnectionCheckerçš„æ„é€ å™¨å‚è€ƒä¸‹é¢çš„æ–¹æ³• } else if (realDriverClassName.equals(JdbcConstants.ORACLE_DRIVER) || realDriverClassName.equals(JdbcConstants.ORACLE_DRIVER2)) { this.validConnectionChecker = new OracleValidConnectionChecker(); } else if (realDriverClassName.equals(JdbcConstants.SQL_SERVER_DRIVER) || realDriverClassName.equals(JdbcConstants.SQL_SERVER_DRIVER_SQLJDBC4) || realDriverClassName.equals(JdbcConstants.SQL_SERVER_DRIVER_JTDS)) { this.validConnectionChecker = new MSSQLValidConnectionChecker(); } else if (realDriverClassName.equals(JdbcConstants.POSTGRESQL_DRIVER) || realDriverClassName.equals(JdbcConstants.ENTERPRISEDB_DRIVER)) { this.validConnectionChecker = new PGValidConnectionChecker(); } } //Mysqlå¯¹åº”çš„checkeræ„é€ å™¨ public MySqlValidConnectionChecker(){ try { clazz = Utils.loadClass(\"com.mysql.jdbc.MySQLConnection\"); if (clazz == null) { clazz = Utils.loadClass(\"com.mysql.cj.jdbc.ConnectionImpl\"); } if (clazz != null) { //å¦‚æœé©±åŠ¨ç¨‹åºæœ¬èº«æœ‰pingæ–¹æ³•ï¼Œåˆ™ä¸‹é¢çš„usePingMethodè®¾ç½®ä¸ºtrueï¼Œåç»­è¿æ¥ä¿æ´»æµ‹è¯•å°±ä¼šé‡‡ç”¨ping.invokeçš„æ–¹å¼è§¦å‘ã€‚ ping = clazz.getMethod(\"pingInternal\", boolean.class, int.class); } if (ping != null) { usePingMethod = true; } } catch (Exception e) { LOG.warn(\"Cannot resolve com.mysql.jdbc.Connection.ping method. Will use 'SELECT 1' instead.\", e); } configFromProperties(System.getProperties()); } å¯ä»¥çœ‹åˆ°ï¼Œå®ä¾‹åŒ–çš„æ—¶å€™ä¼šåˆå§‹åŒ–å…¨å±€çš„é‡å…¥é”lockï¼Œåœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­åŒ…æ‹¬åç»­çš„è¿æ¥æ± æ“ä½œéƒ½ä¼šåˆ©ç”¨è¯¥é”ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œåˆå§‹åŒ–è¿æ¥æ± çš„æ—¶å€™é¦–å…ˆä¼šè¿›è¡ŒåŒé‡æ£€æŸ¥æ˜¯å¦å·²ç»åˆå§‹åŒ–è¿‡ï¼Œè‹¥æ²¡æœ‰ï¼Œåˆ™è¿›è¡Œè¿æ¥æ± çš„åˆå§‹åŒ–ï¼Œè¿™æ—¶å€™è¿˜ä¼šé€šè¿‡SPIæœºåˆ¶é¢å¤–åŠ è½½è´£ä»»é“¾ä¸Šçš„filterï¼Œä½†æ˜¯è¿™ç±»filteréœ€è¦åœ¨ç±»ä¸ŠåŠ ä¸Š@AutoLoadæ³¨è§£ã€‚ç„¶ååˆå§‹åŒ–äº†ä¸‰ä¸ªæ•°ç»„ï¼Œå®¹ç§¯éƒ½ä¸ºmaxActiveï¼Œé¦–å…ˆconnectionså°±æ˜¯ç”¨æ¥å­˜æ”¾æ± å­é‡Œè¿æ¥å¯¹è±¡çš„ï¼ŒevictConnectionsç”¨æ¥å­˜æ”¾æ¯æ¬¡æ£€æŸ¥éœ€è¦æŠ›å¼ƒçš„è¿æ¥ï¼ˆç»“åˆæµç¨‹4.1ç†è§£ï¼‰ï¼ŒkeepAliveConnectionsç”¨äºå­˜æ”¾éœ€è¦è¿æ¥æ£€æŸ¥çš„å­˜æ´»è¿æ¥ï¼ˆåŒæ ·ç»“åˆæµç¨‹4.1ç†è§£ï¼‰ï¼Œç„¶åç”Ÿæˆåˆå§‹åŒ–æ•°ï¼ˆinitialSizeï¼‰ä¸ªè¿æ¥ï¼Œæ”¾è¿›connectionsï¼Œç„¶åç”Ÿæˆä¸¤ä¸ªå¿…é¡»çš„å®ˆæŠ¤çº¿ç¨‹ï¼Œç”¨æ¥æ·»åŠ è¿æ¥è¿›æ± ä»¥åŠä»æ± å­é‡Œæ‘˜é™¤ä¸éœ€è¦çš„è¿æ¥ï¼Œè¿™ä¿©è¿‡ç¨‹è¾ƒå¤æ‚ï¼Œå› æ­¤æ‹†å‡ºæ¥å•è¯´ï¼ˆä¸»æµç¨‹3å’Œä¸»æµç¨‹4ï¼‰ã€‚ ç‰¹åˆ«è¯´æ˜é¡¹ ä»æµç¨‹ä¸Šçœ‹å¦‚æœä¸€å¼€å§‹å®ä¾‹åŒ–çš„æ—¶å€™ä¸å¯¹è¿æ¥æ± è¿›è¡Œåˆå§‹åŒ–ï¼ˆè¿™ä¸ªåˆå§‹åŒ–æ˜¯æŒ‡å¯¹æ± å­æœ¬èº«çš„åˆå§‹åŒ–ï¼Œå¹¶éå•çº¯çš„æŒ‡druidå¯¹è±¡å±æ€§çš„åˆå§‹åŒ–ï¼‰ï¼Œé‚£ä¹ˆåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨getConnectionæ—¶å°±ä¼šèµ°ä¸Šå›¾é‚£ä¹ˆå¤šé€»è¾‘ï¼Œå°¤å…¶æ˜¯è€—æ—¶è¾ƒä¹…çš„å»ºç«‹è¿æ¥æ“ä½œï¼Œè¢«é‡å¤æ‰§è¡Œäº†å¾ˆå¤šæ¬¡ï¼Œå¯¼è‡´ç¬¬ä¸€æ¬¡getConnectionæ—¶è€—æ—¶è¿‡ä¹…ï¼Œå¦‚æœä½ çš„ç¨‹åºå¹¶å‘é‡å¾ˆå¤§ï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡è·å–è¿æ¥æ—¶å°±ä¼šå› ä¸ºåˆå§‹åŒ–æµç¨‹è€Œå‘ç”Ÿæ’é˜Ÿï¼Œæ‰€ä»¥å»ºè®®åœ¨å®ä¾‹åŒ–è¿æ¥æ± åå¯¹å…¶è¿›è¡Œé¢„çƒ­ï¼Œé€šè¿‡è°ƒç”¨initæ–¹æ³•æˆ–è€…getConnectionæ–¹æ³•éƒ½å¯ä»¥ã€‚ åœ¨æ„å»ºå…¨å±€é‡å…¥é”çš„æ—¶å€™ï¼Œåˆ©ç”¨lockå¯¹è±¡ç”Ÿæˆäº†ä¿©Conditionï¼Œå¯¹è¿™ä¿©Conditionè§£é‡Šå¦‚ä¸‹ï¼š å½“è¿æ¥æ± è¿æ¥å¤Ÿç”¨æ—¶ï¼Œåˆ©ç”¨emptyé˜»å¡æ·»åŠ è¿æ¥çš„å®ˆæŠ¤çº¿ç¨‹ï¼ˆä¸»æµç¨‹3ï¼‰ï¼Œå½“è¿æ¥æ± è¿æ¥ä¸å¤Ÿç”¨æ—¶ï¼Œè·å–è¿æ¥çš„é‚£ä¸ªçº¿ç¨‹ï¼ˆè¿™é‡Œè®°ä¸ºä¸šåŠ¡çº¿ç¨‹Aï¼‰å°±ä¼šé˜»å¡åœ¨notEmptyä¸Šï¼Œä¸”å”¤èµ·é˜»å¡åœ¨emptyä¸Šçš„æ·»åŠ è¿æ¥çš„å®ˆæŠ¤çº¿ç¨‹ï¼Œèµ°å®Œæ·»åŠ è¿æ¥çš„æµç¨‹ï¼Œèµ°å®Œåä¼šé‡æ–°å”¤èµ·é˜»å¡åœ¨notEmptyä¸Šçš„ä¸šåŠ¡çº¿ç¨‹Aï¼Œä¸šåŠ¡çº¿ç¨‹Aå°±ä¼šç»§ç»­å°è¯•è·å–è¿æ¥ã€‚ ä¸‰ã€æµç¨‹1.1ï¼šè´£ä»»é“¾ âš ï¸ è¿™å—ä¸œè¥¿ç»“åˆæºç çœ‹æ›´å®¹æ˜“ç†è§£ ä¸Šè¿°æµç¨‹å¯¹åº”æºä»£ç å¦‚ä¸‹ï¼ˆè¯·å±•å¼€ï¼‰ï¼š ä»£ç æ®µ-1-2 >folded1234567891011121314151617181920212223242526272829303132333435363738394041424344454647//DruidDataSourceç±»é‡Œçš„æ–¹æ³•ï¼šè·å–è¿æ¥ public DruidPooledConnection getConnection(long maxWaitMillis) throws SQLException { init(); if (filters.size() &gt; 0) { //è´£ä»»é“¾ä¸Šçš„filterå­˜åœ¨ FilterChainImpl filterChain = new FilterChainImpl(this); //è¯¥ç±»æ˜¯æ‰§è¡Œæ•´ä¸ªè´£ä»»é“¾çš„æ‰§è¡Œè€… return filterChain.dataSource_connect(this, maxWaitMillis); //æ¯ä¸ªéœ€è¦æ‰§è¡Œè´£ä»»é“¾çš„æ–¹æ³•ï¼Œåœ¨filterChainé‡Œéƒ½å¯ä»¥æ‰¾åˆ°æ˜ å°„æ–¹æ³•ï¼Œæ¯”å¦‚æœ¬æ–¹æ³•getConnectionï¼Œå°±å¯¹åº”filterChain.dataSource_connectï¼ˆå‚è€ƒæµç¨‹1.1ï¼‰ } else { return getConnectionDirect(maxWaitMillis); } } //FilterChainImplç±»é‡Œçš„æ–¹æ³•ï¼šè·å–è¿æ¥æ˜ å°„æ–¹æ³• @Override public DruidPooledConnection dataSource_connect(DruidDataSource dataSource, long maxWaitMillis) throws SQLException { if (this.pos &lt; filterSize) { //é™¤äº†FilterChainImplé‡Œé¢åŒ…å«ä¸€äº›datasourceçš„æ˜ å°„æ–¹æ³•ï¼Œéœ€è¦æ‰§è¡Œçš„filteré‡Œé¢ä¹ŸåŒ…æ‹¬ï¼Œæ¯”å¦‚ä¸‹é¢çš„dataSource_getConnectionæ–¹æ³• DruidPooledConnection conn = nextFilter().dataSource_getConnection(this, dataSource, maxWaitMillis); //æ ¹æ®ä¸‹æ ‡ï¼Œè·å–ä¸‹ä¸€ä¸ªfilterï¼Œè§¦å‘ç›®æ ‡æ–¹æ³• return conn; } return dataSource.getConnectionDirect(maxWaitMillis); //æ‰§è¡Œåˆ°æœ€åä¸€ä¸ªfilteræ—¶ï¼Œè§¦å‘datasourceï¼Œè¿”å›çœŸæ­£çš„è¿æ¥ } //FilterChainImplç±»é‡Œçš„æ–¹æ³•ï¼šè·å–ä¸‹ä¸€ä¸ªéœ€è¦æ‰§è¡Œçš„filter private Filter nextFilter() { return getFilters() .get(pos++); //æ ¹æ®æ¸¸æ ‡è®¡ç®— } //éšä¾¿æ‰¾äº†ä¸€ä¸ªfilteré‡Œçš„ç›®æ ‡æ–¹æ³• //LogFilterç±»é‡Œçš„æ–¹æ³•ï¼šdataSource_getConnection @Override public DruidPooledConnection dataSource_getConnection(FilterChain chain, DruidDataSource dataSource, long maxWaitMillis) throws SQLException { DruidPooledConnection conn = chain.dataSource_connect(dataSource, maxWaitMillis); //è¿™é‡Œåˆä¼šåˆ©ç”¨FilterChainImplè§¦å‘æ˜ å°„æ–¹æ³• //ä¸‹é¢å°±æ˜¯è‡ªå·±å†…éƒ¨çš„ä¸€äº›ç‰¹æœ‰é€»è¾‘ï¼Œå¿½ç•¥ ConnectionProxy connection = (ConnectionProxy) conn.getConnectionHolder().getConnection(); if (connectionConnectAfterLogEnable &amp;&amp; isConnectionLogEnabled()) { connectionLog(\"{conn-\" + connection.getId() + \"} pool-connect\"); } return conn; //è¿”å› } è¿™é‡Œå¯¹åº”æµç¨‹1é‡Œè·å–è¿æ¥æ—¶éœ€è¦æ‰§è¡Œçš„è´£ä»»é“¾ï¼Œæ¯ä¸ªDruidAbstractDataSourceé‡Œéƒ½åŒ…å«filterså±æ€§ï¼Œfiltersæ˜¯å¯¹Druidé‡ŒFiltersæ¥å£çš„å®ç°ï¼Œé‡Œé¢æœ‰å¾ˆå¤šå¯¹åº”ç€è¿æ¥æ± é‡Œçš„æ˜ å°„æ–¹æ³•ï¼Œæ¯”å¦‚ä¾‹å­ä¸­dataSourceçš„getConnectionæ–¹æ³•åœ¨è§¦å‘çš„æ—¶å€™å°±ä¼šåˆ©ç”¨FilterChainæŠŠæ¯ä¸ªfilteré‡Œçš„dataSource_getConnectionç»™æ‰§è¡Œä¸€éï¼Œè¿™é‡Œä¹Ÿè¦è¯´æ˜ä¸‹FilterChainï¼Œé€šè¿‡æµç¨‹1.1å¯ä»¥çœ‹å‡ºæ¥ï¼Œdatasourceæ˜¯åˆ©ç”¨FilterChainæ¥è§¦å‘å„ä¸ªfilterçš„æ‰§è¡Œçš„ï¼ŒFilterChainé‡Œä¹Ÿæœ‰ä¸€å †datasourceé‡Œçš„æ˜ å°„æ–¹æ³•ï¼Œæ¯”å¦‚ä¸Šå›¾é‡Œçš„dataSource_connectï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæŠŠdatasourceé‡Œçš„filterså…¨éƒ¨æ‰§è¡Œä¸€éç›´åˆ°nextFilterå–ä¸åˆ°å€¼ï¼Œæ‰ä¼šè§¦å‘dataSource.getConnectionDirectï¼Œè¿™ä¸ªç»“åˆä»£ç ä¼šæ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚ å››ã€æµç¨‹1.2ï¼šä»æ± ä¸­è·å–è¿æ¥çš„æµç¨‹ ä¸Šè¿°æµç¨‹å¯¹åº”æºä»£ç å¦‚ä¸‹ï¼ˆè¯·å±•å¼€ï¼‰ï¼š ä»£ç æ®µ1-3 >folded123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215private DruidPooledConnection getConnectionInternal(long maxWait) throws SQLException { //å¯ç”¨æ€§åˆ¤æ–­ if (closed) { connectErrorCountUpdater.incrementAndGet(this); throw new DataSourceClosedException(\"dataSource already closed at \" + new Date(closeTimeMillis)); } if (!enable) { connectErrorCountUpdater.incrementAndGet(this); throw new DataSourceDisableException(); } final long nanos = TimeUnit.MILLISECONDS.toNanos(maxWait); //çº³ç§’ final int maxWaitThreadCount = this.maxWaitThreadCount; //ç›®å‰å› ä¸ºæ‹¿ä¸åˆ°è¿æ¥è€Œå‘ç”Ÿé˜»å¡çš„ä¸šåŠ¡çº¿ç¨‹æ•° DruidConnectionHolder holder; for (boolean createDirect = false;;) { if (createDirect) { //æ¨¡å¼æœªå¯ç”¨ï¼Œæ’ç­‰falseï¼Œä¸‹é¢çš„é€»è¾‘ä¸ä¼šè§¦å‘ï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œéšè—è¿™éƒ¨åˆ†ä»£ç  //ä»£ç éšè— } try { lock.lockInterruptibly(); //é”è·å– } catch (InterruptedException e) { connectErrorCountUpdater.incrementAndGet(this); throw new SQLException(\"interrupt\", e); } try { if (maxWaitThreadCount &gt; 0 &amp;&amp; notEmptyWaitThreadCount &gt;= maxWaitThreadCount) { //å¦‚æœå› ä¸ºæ‹¿ä¸åˆ°è¿æ¥è€Œé˜»å¡çš„ä¸šåŠ¡çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼ï¼Œåˆ™ç›´æ¥æŠ›å¼‚å¸¸ connectErrorCountUpdater.incrementAndGet(this); throw new SQLException(\"maxWaitThreadCount \" + maxWaitThreadCount + \", current wait Thread count \" + lock.getQueueLength()); } if (onFatalError &amp;&amp; onFatalErrorMaxActive &gt; 0 &amp;&amp; activeCount &gt;= onFatalErrorMaxActive) { connectErrorCountUpdater.incrementAndGet(this); StringBuilder errorMsg = new StringBuilder(); errorMsg.append(\"onFatalError, activeCount \") .append(activeCount) .append(\", onFatalErrorMaxActive \") .append(onFatalErrorMaxActive); if (lastFatalErrorTimeMillis &gt; 0) { errorMsg.append(\", time '\") .append(StringUtils.formatDateTime19( lastFatalErrorTimeMillis, TimeZone.getDefault())) .append(\"'\"); } if (lastFatalErrorSql != null) { errorMsg.append(\", sql \\n\") .append(lastFatalErrorSql); } throw new SQLException( errorMsg.toString(), lastFatalError); } connectCount++; //è¿æ¥æ•°ç´¯åŠ  if (createScheduler != null &amp;&amp; poolingCount == 0 &amp;&amp; activeCount &lt; maxActive &amp;&amp; creatingCountUpdater.get(this) == 0 &amp;&amp; createScheduler instanceof ScheduledThreadPoolExecutor) { ScheduledThreadPoolExecutor executor = (ScheduledThreadPoolExecutor) createScheduler; if (executor.getQueue().size() &gt; 0) { createDirect = true; //createSchedulerè¿™ç§å¼‚æ­¥æ·»åŠ æ¨¡å¼ä¸å¼€å¯ï¼ˆé»˜è®¤ä¸å¼€å¯ï¼Œæœ¬æ–‡ä¹Ÿä¸æ˜¯åŸºäºè¯¥æ¨¡å¼çš„ï¼‰ï¼ŒcreateDirectæ°¸è¿œä¸ç­‰äºtrueï¼Œæ‰€ä»¥ä¸Šé¢createDirect==trueçš„ä»£ç ä¸ä¼šè¢«è§¦å‘ continue; } } if (maxWait &gt; 0) { holder = pollLast(nanos); //å°è¯•ä»æ± å­é‡Œè·å–è¿æ¥ } else { holder = takeLast(); } if (holder != null) { activeCount++; //æ‹¿åˆ°è¿æ¥ï¼ŒactiveCountç´¯åŠ  if (activeCount &gt; activePeak) { activePeak = activeCount; activePeakTime = System.currentTimeMillis(); } } } catch (InterruptedException e) { connectErrorCountUpdater.incrementAndGet(this); throw new SQLException(e.getMessage(), e); } catch (SQLException e) { connectErrorCountUpdater.incrementAndGet(this); throw e; } finally { lock.unlock(); } break; } if (holder == null) { //æ²¡æœ‰è·å–åˆ°è¿æ¥ï¼Œæ•´ç†é”™è¯¯ä¿¡æ¯ï¼ŒæŠ›å‡ºé”™è¯¯ long waitNanos = waitNanosLocal.get(); StringBuilder buf = new StringBuilder(128); buf.append(\"wait millis \")// .append(waitNanos / (1000 * 1000))// .append(\", active \").append(activeCount)// .append(\", maxActive \").append(maxActive)// .append(\", creating \").append(creatingCount)// ; if (creatingCount &gt; 0 &amp;&amp; createStartNanos &gt; 0) { long createElapseMillis = (System.nanoTime() - createStartNanos) / (1000 * 1000); if (createElapseMillis &gt; 0) { buf.append(\", createElapseMillis \").append(createElapseMillis); } } if (createErrorCount &gt; 0) { buf.append(\", createErrorCount \").append(createErrorCount); } List sqlList = this.getDataSourceStat().getRuningSqlList(); for (int i = 0; i &lt; sqlList.size(); ++i) { if (i != 0) { buf.append('\\n'); } else { buf.append(\", \"); } JdbcSqlStatValue sql = sqlList.get(i); buf.append(\"runningSqlCount \").append(sql.getRunningCount()); buf.append(\" : \"); buf.append(sql.getSql()); } String errorMessage = buf.toString(); if (this.createError != null) { throw new GetConnectionTimeoutException(errorMessage, createError); } else { throw new GetConnectionTimeoutException(errorMessage); } } holder.incrementUseCount(); DruidPooledConnection poolalbeConnection = new DruidPooledConnection(holder); //åŒ…è£…æˆç›®æ ‡å¯¹è±¡ return poolalbeConnection; //è¿”å› } //å°è¯•ä»æ± å­é‡Œè·å–è¿æ¥ private DruidConnectionHolder pollLast(long nanos) throws InterruptedException, SQLException { long estimate = nanos; for (;;) { if (poolingCount == 0) { //æ± å­é‡Œçš„ç©ºé—²è¿æ¥ä¸º0ï¼Œè¯´æ˜éœ€è¦é€šçŸ¥ä¸»æµç¨‹3æ–°å¢è¿æ¥äº† emptySignal(); // empty.signalï¼Œå”¤èµ·ä¸»æµç¨‹3æ–°å¢è¿æ¥ if (failFast &amp;&amp; isFailContinuous()) { //å¦‚æœç½®ä¸ºå¿«é€Ÿç»“æŸï¼Œåˆ™ä¸é˜»å¡ä¸šåŠ¡çº¿ç¨‹ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸ throw new DataSourceNotAvailableException(createError); } if (estimate &lt;= 0) { waitNanosLocal.set(nanos - estimate); return null; } notEmptyWaitThreadCount++; //å› ä¸ºè·å–ä¸åˆ°è¿æ¥è€Œé™·å…¥é˜»å¡çŠ¶æ€çš„ä¸šåŠ¡çº¿ç¨‹æ•°+1 if (notEmptyWaitThreadCount &gt; notEmptyWaitThreadPeak) { notEmptyWaitThreadPeak = notEmptyWaitThreadCount; } try { long startEstimate = estimate; estimate = notEmpty.awaitNanos(estimate); // é˜»å¡ï¼ˆæŒ‚èµ·ï¼‰estimateè¿™ä¹ˆé•¿çš„ä¸–ç•Œï¼ŒæœŸé—´å¦‚æœè¢«å”¤é†’ï¼Œåˆ™estimateå°±ä¼šè¢«åˆ·æ–°æˆå‰©ä½™ç­‰å¾…æ—¶é—´ // recycle or // creator notEmptyWaitCount++; notEmptyWaitNanos += (startEstimate - estimate); if (!enable) { connectErrorCountUpdater.incrementAndGet(this); throw new DataSourceDisableException(); } } catch (InterruptedException ie) { notEmpty.signal(); // æœŸé—´çº¿ç¨‹è¢«ä¸­æ–­ï¼Œåˆ™å”¤èµ·ä¸€æ¬¡å…¶ä»–å¤„äºé˜»å¡çŠ¶æ€çš„ä¸šåŠ¡çº¿ç¨‹ notEmptySignalCount++; throw ie; } finally { notEmptyWaitThreadCount--; } if (poolingCount == 0) { //ä¾ç„¶æ²¡æœ‰ç«äº‰åˆ° if (estimate &gt; 0) { //å¦‚æœç›®æ ‡é˜»å¡æ—¶é—´ï¼ˆmaxWaitï¼‰è¿˜æ²¡æœ‰ç”¨å®Œï¼Œåˆ™ç»§ç»­å°è¯•è·å– continue; } waitNanosLocal.set(nanos - estimate); return null; } } decrementPoolingCount(); //poolingCount-- DruidConnectionHolder last = connections[poolingCount]; //ç›´æ¥è·å– connections[poolingCount] = null; //è·å–åæ„å‘³ç€è¿æ¥å·²è¢«å€Ÿå‡ºï¼ŒåŸæœ‰ä½ç½®ç½®ç©º long waitNanos = nanos - estimate; //æ ‡è®°è¿™æ¬¡è·å–è¿æ¥èŠ±äº†å¤šé•¿æ—¶é—´ï¼Œè¿æ¥å¤Ÿç”¨æ—¶ä¾¿ä¸º0 last.setLastNotEmptyWaitNanos(waitNanos); return last; //è¿”å› } } é€šè¿‡getConnectionInternalæ–¹æ³•ä»æ± å­é‡Œè·å–çœŸæ­£çš„è¿æ¥å¯¹è±¡ï¼Œdruidæ”¯æŒä¸¤ç§æ–¹å¼æ–°å¢è¿æ¥ï¼Œä¸€ç§æ˜¯é€šè¿‡å¼€å¯ä¸åŒçš„å®ˆæŠ¤çº¿ç¨‹é€šè¿‡awaitã€signalé€šä¿¡å®ç°ï¼ˆæœ¬æ–‡å¯ç”¨çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯é»˜è®¤çš„æ–¹å¼ï¼‰ï¼Œå¦ä¸€ç§æ˜¯ç›´æ¥é€šè¿‡çº¿ç¨‹æ± å¼‚æ­¥æ–°å¢ï¼Œè¿™ä¸ªæ–¹å¼é€šè¿‡åœ¨åˆå§‹åŒ–druidæ—¶ä¼ å…¥asyncInit=trueï¼Œå†æŠŠä¸€ä¸ªçº¿ç¨‹æ± å¯¹è±¡èµ‹å€¼ç»™createSchedulerï¼Œå°±æˆåŠŸå¯ç”¨äº†è¿™ç§æ¨¡å¼ï¼Œæ²¡ä»”ç»†ç ”ç©¶è¿™ç§æ–¹å¼ï¼Œæ‰€ä»¥æœ¬æ–‡çš„æµç¨‹å›¾å’Œä»£ç å—éƒ½ä¼šè§„é¿è¿™ä¸ªæ¨¡å¼ã€‚ ä¸Šé¢çš„æµç¨‹å¾ˆç®€å•ï¼Œè¿æ¥è¶³å¤Ÿæ—¶å°±ç›´æ¥poolingCount-1ï¼Œæ•°ç»„å–å€¼ï¼Œè¿”å›ï¼ŒactiveCount+1ï¼Œæ•´ä½“å¤æ‚åº¦ä¸ºO(1)ï¼Œå…³é”®è¿˜æ˜¯çœ‹å–ä¸åˆ°è¿æ¥æ—¶çš„åšæ³•ï¼Œå–ä¸åˆ°è¿æ¥æ—¶ï¼Œdruidä¼šå…ˆå”¤èµ·æ–°å¢è¿æ¥çš„å®ˆæŠ¤çº¿ç¨‹æ–°å¢è¿æ¥ï¼Œç„¶åé™·å…¥ç­‰å¾…çŠ¶æ€ï¼Œç„¶åå”¤é†’è¯¥ç­‰å¾…çš„ç‚¹æœ‰ä¸¤å¤„ï¼Œä¸€ä¸ªæ˜¯ç”¨å®Œäº†è¿æ¥recycleï¼ˆä¸»æµç¨‹5ï¼‰è¿›æ± å­åè§¦å‘ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯æ–°å¢è¿æ¥çš„å®ˆæŠ¤çº¿ç¨‹æˆåŠŸæ–°å¢äº†ä¸€ä¸ªè¿æ¥åè§¦å‘ï¼Œawaitè¢«å”¤èµ·åç»§ç»­åŠ å…¥é”ç«äº‰ï¼Œç„¶åå¾€ä¸‹èµ°å¦‚æœå‘ç°æ± å­é‡Œçš„è¿æ¥æ•°ä»ç„¶æ˜¯0ï¼ˆè¯´æ˜åœ¨å”¤é†’åå‚ä¸é”ç«äº‰é‡Œåˆšè¢«æ”¾è¿›æ¥çš„è¿æ¥åˆè¢«åˆ«çš„çº¿ç¨‹æ‹¿å»äº†ï¼‰ï¼Œåˆ™ç»§ç»­ä¸‹ä¸€æ¬¡çš„awaitï¼Œè¿™é‡Œé‡‡ç”¨çš„æ˜¯awaitNanosæ–¹æ³•ï¼Œåˆå§‹å€¼æ˜¯maxWaitï¼Œç„¶åä¸‹æ¬¡è¢«åˆ·æ–°åå°±æ˜¯maxWaitå‡å»ä¸Šæ¬¡é˜»å¡èŠ±è´¹çš„å®é™…æ—¶é—´ï¼Œæ¯æ¬¡awaitçš„æ—¶é—´ä¼šé€æ­¥å‡å°‘ï¼Œç›´åˆ°å½’é›¶ï¼Œæ•´ä½“æ—¶é—´æ˜¯çº¦ç­‰äºmaxWaitçš„ï¼Œä½†å®é™…æ¯”maxActiveè¦å¤§ï¼Œå› ä¸ºç¨‹åºæœ¬èº«å­˜åœ¨è€—æ—¶ä»¥åŠè¢«å”¤é†’ååˆè¦å‚ä¸é”ç«äº‰å¯¼è‡´ä¹Ÿå­˜åœ¨ä¸€å®šçš„è€—æ—¶ã€‚ å¦‚æœæœ€ç»ˆéƒ½æ²¡åŠæ³•æ‹¿åˆ°è¿æ¥åˆ™è¿”å›nullå‡ºå»ï¼Œç´§æ¥ç€è§¦å‘ä¸»æµç¨‹1ä¸­çš„é‡è¯•é€»è¾‘ã€‚ druidå¦‚ä½•é˜²æ­¢åœ¨è·å–ä¸åˆ°è¿æ¥æ—¶é˜»å¡è¿‡å¤šçš„ä¸šåŠ¡çº¿ç¨‹ï¼Ÿ é€šè¿‡ä¸Šé¢çš„æµç¨‹å›¾å’Œæµç¨‹æè¿°ï¼Œå¦‚æœéå¸¸æç«¯çš„æƒ…å†µï¼Œæ± å­é‡Œçš„è¿æ¥å®Œå…¨ä¸å¤Ÿç”¨æ—¶ï¼Œä¼šé˜»å¡è¿‡å¤šçš„ä¸šåŠ¡çº¿ç¨‹ï¼Œç”šè‡³ä¼šé˜»å¡è¶…è¿‡maxWaitè¿™ä¹ˆä¹…ï¼Œæœ‰æ²¡æœ‰ä¸€ç§æªæ–½æ˜¯å¯ä»¥åœ¨è¿æ¥ä¸å¤Ÿç”¨çš„æ—¶å€™æ§åˆ¶é˜»å¡çº¿ç¨‹çš„ä¸ªæ•°ï¼Œè¶…è¿‡è¿™ä¸ªé™åˆ¶åç›´æ¥æŠ¥é”™ï¼Œè€Œä¸æ˜¯é™·å…¥ç­‰å¾…å‘¢ï¼Ÿ druidå…¶å®æ”¯æŒè¿™ç§ç­–ç•¥çš„ï¼Œåœ¨maxWaitThreadCountå±æ€§ä¸ºé»˜è®¤å€¼ï¼ˆ-1ï¼‰çš„æƒ…å†µä¸‹ä¸å¯ç”¨ï¼Œå¦‚æœmaxWaitThreadCounté…ç½®å¤§äº0ï¼Œè¡¨ç¤ºå¯ç”¨ï¼Œè¿™æ˜¯druidåšçš„ä¸€ç§ä¸¢å¼ƒæªæ–½ï¼Œå¦‚æœä½ ä¸å¸Œæœ›åœ¨æ± å­é‡Œçš„è¿æ¥å®Œå…¨ä¸å¤Ÿç”¨å¯¼é˜»å¡çš„ä¸šåŠ¡çº¿ç¨‹è¿‡å¤šï¼Œå°±å¯ä»¥è€ƒè™‘é…ç½®è¯¥é¡¹ï¼Œè¿™ä¸ªå±æ€§çš„æ„æ€æ˜¯è¯´åœ¨è¿æ¥ä¸å¤Ÿç”¨æ—¶æœ€å¤šè®©å¤šå°‘ä¸ªä¸šåŠ¡çº¿ç¨‹å‘ç”Ÿé˜»å¡ï¼Œæµç¨‹1.2çš„å›¾é‡Œæ²¡æœ‰ä½“ç°è¿™ä¸ªå¼€å…³çš„ç”¨é€”ï¼Œå¯ä»¥åœ¨ä»£ç é‡ŒæŸ¥çœ‹ï¼Œæ¯æ¬¡åœ¨pollLastæ–¹æ³•é‡Œé™·å…¥ç­‰å¾…å‰ä¼šæŠŠå±æ€§notEmptyWaitThreadCountè¿›è¡Œç´¯åŠ ï¼Œé˜»å¡ç»“æŸåä¼šé€’å‡ï¼Œç”±æ­¤å¯è§notEmptyWaitThreadCountå°±æ˜¯è¡¨ç¤ºå½“å‰ç­‰å¾…å¯ç”¨è¿æ¥æ—¶é˜»å¡çš„ä¸šåŠ¡çº¿ç¨‹çš„æ€»ä¸ªæ•°ï¼Œè€ŒgetConnectionInternalåœ¨æ¯æ¬¡è°ƒç”¨pollLastå‰éƒ½ä¼šåˆ¤æ–­è¿™æ ·ä¸€æ®µä»£ç ï¼š ä»£ç å—112345if (maxWaitThreadCount &gt; 0 &amp;&amp; notEmptyWaitThreadCount &gt;= maxWaitThreadCount) { connectErrorCountUpdater.incrementAndGet(this); throw new SQLException(\"maxWaitThreadCount \" + maxWaitThreadCount + \", current wait Thread count \" + lock.getQueueLength()); //ç›´æ¥æŠ›å¼‚å¸¸ï¼Œè€Œä¸æ˜¯é™·å…¥ç­‰å¾…çŠ¶æ€é˜»å¡ä¸šåŠ¡çº¿ç¨‹ } å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœé…ç½®äº†maxWaitThreadCountæ‰€é™åˆ¶çš„ç­‰å¾…çº¿ç¨‹ä¸ªæ•°ï¼Œé‚£ä¹ˆä¼šç›´æ¥åˆ¤æ–­å½“å‰é™·å…¥ç­‰å¾…çš„ä¸šåŠ¡çº¿ç¨‹æ˜¯å¦è¶…è¿‡äº†maxWaitThreadCountï¼Œä¸€æ—¦è¶…è¿‡ç”šè‡³ä¸è§¦å‘pollLastçš„è°ƒç”¨ï¼ˆé˜²æ­¢æ–°å¢ç­‰å¾…çº¿ç¨‹ï¼‰ï¼Œç›´æ¥æŠ›é”™ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦å¯ç”¨è¯¥é¡¹ï¼Œä¸€å®šè¦å¯ç”¨å»ºè®®è€ƒè™‘å¥½maxWaitThreadCountçš„å–å€¼ï¼Œä¸€èˆ¬æ¥è¯´å‘ç”Ÿå¤§é‡ç­‰å¾…è¯´æ˜ä»£ç é‡Œå­˜åœ¨ä¸åˆç†çš„åœ°æ–¹ï¼šæ¯”å¦‚å…¸å‹çš„è¿æ¥æ± åŸºæœ¬é…ç½®ä¸åˆç†ï¼Œé«˜qpsçš„ç³»ç»Ÿé‡ŒmaxActiveé…ç½®è¿‡å°ï¼›æ¯”å¦‚å€Ÿå‡ºå»çš„è¿æ¥æ²¡æœ‰åŠæ—¶closeå½’è¿˜ï¼›æ¯”å¦‚å­˜åœ¨æ…¢æŸ¥è¯¢æˆ–è€…æ…¢äº‹åŠ¡å¯¼è‡´è¿æ¥å€Ÿå‡ºæ—¶é—´è¿‡ä¹…ã€‚è¿™äº›è¦æ¯”é…ç½®maxWaitThreadCountæ›´å€¼å¾—ä¼˜å…ˆè€ƒè™‘ï¼Œå½“ç„¶é…ç½®è¿™ä¸ªåšä¸€ä¸ªæé™ä¿æŠ¤ä¹Ÿæ˜¯æ²¡é—®é¢˜çš„ï¼Œåªæ˜¯è¦ç»“åˆå®é™…æƒ…å†µè€ƒè™‘å¥½å–å€¼ã€‚ äº”ã€æµç¨‹1.3ï¼šè¿æ¥å¯ç”¨æ€§æµ‹è¯•â‘ init-checkerè®²è¿™å—çš„ä¸œè¥¿ä¹‹å‰ï¼Œå…ˆæ¥äº†è§£ä¸‹å¦‚ä½•åˆå§‹åŒ–æ£€æµ‹è¿æ¥ç”¨çš„checkerï¼Œæ•´ä¸ªæµç¨‹å‚è€ƒä¸‹å›¾ï¼š psï¼šä¸Šè¿°æµç¨‹å¯¹åº”æºä»£ç ä½ç½®ï¼šä»£ç æ®µ2-1ä¸­çš„initValidConnectionCheckeræ–¹æ³•ä¸MySqlValidConnectionCheckeræ„é€ å™¨ åˆå§‹åŒ–checkerå‘ç”Ÿåœ¨inité˜¶æ®µï¼ˆé™äºç¯‡å¹…ï¼Œæ²¡æœ‰åœ¨ä¸»æµç¨‹2ï¼ˆinité˜¶æ®µï¼‰é‡Œä½“ç°å‡ºæ¥ï¼Œåªéœ€è¦è®°ä½åˆå§‹åŒ–checkerä¹Ÿæ˜¯å‘ç”Ÿåœ¨inité˜¶æ®µå°±å¥½ï¼‰ï¼Œdruidæ”¯æŒå¤šç§æ•°æ®åº“çš„è¿æ¥æºï¼Œæ‰€ä»¥checkeré’ˆå¯¹ä¸åŒçš„é©±åŠ¨ç¨‹åºéƒ½åšäº†é€‚é…ï¼Œæ‰€ä»¥æ‰çœ‹åˆ°å›¾ä¸­checkeræœ‰ä¸åŒçš„å®ç°ï¼Œæˆ‘ä»¬æ ¹æ®åŠ è½½åˆ°çš„é©±åŠ¨ç±»ååŒ¹é…ä¸åŒçš„æ•°æ®åº“checkerï¼Œä¸Šå›¾åŒ¹é…è‡³mysqlçš„checkerï¼Œcheckerçš„åˆå§‹åŒ–é‡Œåšäº†ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯åˆ¤æ–­é©±åŠ¨å†…æ˜¯å¦æœ‰pingæ–¹æ³•ï¼ˆjdbc4å¼€å§‹æ”¯æŒï¼Œmysql-connector-javaæ—©åœ¨3.xçš„ç‰ˆæœ¬å°±æœ‰pingæ–¹æ³•çš„å®ç°äº†ï¼‰ï¼Œå¦‚æœæœ‰ï¼Œåˆ™æŠŠusePingMethodç½®ä¸ºtrueï¼Œç”¨äºåç»­å¯ç”¨checkeræ—¶åšåˆ¤æ–­ç”¨ï¼ˆä¸‹é¢ä¼šè®²ï¼Œè¿™é‡Œç½®ä¸ºtrueï¼Œåˆ™é€šè¿‡åå°„çš„æ–¹å¼è°ƒç”¨é©±åŠ¨ç¨‹åºçš„pingæ–¹æ³•ï¼Œå¦‚æœä¸ºfalseï¼Œåˆ™è§¦å‘æ™®é€šçš„SELECT 1æŸ¥è¯¢æ£€æµ‹ï¼ŒSELECT 1å°±æ˜¯æˆ‘ä»¬éå¸¸ç†Ÿæ‚‰çš„é‚£ä¸ªä¸œè¥¿å•¦ï¼Œæ–°å»ºstatementï¼Œç„¶åæ‰§è¡ŒSELECT 1ï¼Œç„¶åå†åˆ¤æ–­è¿æ¥æ˜¯å¦å¯ç”¨ï¼‰ã€‚ â‘¡testConnectionInternalç„¶åå›åˆ°æœ¬èŠ‚æ¢è®¨çš„æ–¹æ³•ï¼šæµç¨‹1.3å¯¹åº”çš„testConnectionInternal ä¸Šè¿°æµç¨‹å¯¹åº”æºä»£ç å¦‚ä¸‹ï¼ˆè¯·å±•å¼€ï¼‰ï¼š ä»£ç æ®µ1-4 >folded123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137//æ•°æ®åº“è¿æ¥å¯ç”¨æ€§æµ‹è¯• protected boolean testConnectionInternal(DruidConnectionHolder holder, Connection conn) { String sqlFile = JdbcSqlStat.getContextSqlFile(); String sqlName = JdbcSqlStat.getContextSqlName(); if (sqlFile != null) { JdbcSqlStat.setContextSqlFile(null); } if (sqlName != null) { JdbcSqlStat.setContextSqlName(null); } try { if (validConnectionChecker != null) { //checkerä¸ä¸ºç©º //checkeræ˜¯initï¼ˆä¸»æµç¨‹2ï¼‰é‡Œé€šè¿‡é©±åŠ¨è¿›è¡Œé€‚é…çš„æ£€æµ‹è€…ï¼Œå› ä¸ºæœ¬ç¯‡æ–‡ç« åŸºäºmysqlï¼Œæ‰€ä»¥å‡è®¾è¿™é‡Œé€‚é…åˆ°çš„checkeræ˜¯MySqlValidConnectionCheckerç±»å‹çš„ boolean valid = validConnectionChecker.isValidConnection(conn, validationQuery, validationQueryTimeout); long currentTimeMillis = System.currentTimeMillis(); if (holder != null) { holder.lastValidTimeMillis = currentTimeMillis; } if (valid &amp;&amp; isMySql) { //è¿™é‡Œåœ¨ç°æœ‰é©±åŠ¨ç‰ˆæœ¬çš„æƒ…å†µä¸‹æ‹¿åˆ°çš„lastPacketReceivedTimeMså§‹ç»ˆå°äº0ï¼Œå› ä¸ºæ‰¾ä¸åˆ°com.mysql.jdbc.MySQLConnection long lastPacketReceivedTimeMs = MySqlUtils.getLastPacketReceivedTimeMs(conn); if (lastPacketReceivedTimeMs &gt; 0) { long mysqlIdleMillis = currentTimeMillis - lastPacketReceivedTimeMs; if (lastPacketReceivedTimeMs &gt; 0 // &amp;&amp; mysqlIdleMillis &gt;= timeBetweenEvictionRunsMillis) { discardConnection(conn); String errorMsg = \"discard long time none received connection. \" + \", jdbcUrl : \" + jdbcUrl + \", jdbcUrl : \" + jdbcUrl + \", lastPacketReceivedIdleMillis : \" + mysqlIdleMillis; LOG.error(errorMsg); return false; } } } return valid; //è¿”å›éªŒè¯ç»“æœ } if (conn.isClosed()) { return false; } //checkerä¸ºç©ºæ—¶ï¼Œå°±ç›´æ¥åˆ©ç”¨validationQueryè¿›è¡Œå¸¸è§„æµ‹è¯• if (null == validationQuery) { return true; //validationQueryä¸ºç©ºå°±å•çº¯è¿”å›true } Statement stmt = null; ResultSet rset = null; try { stmt = conn.createStatement(); if (getValidationQueryTimeout() &gt; 0) { stmt.setQueryTimeout(validationQueryTimeout); } rset = stmt.executeQuery(validationQuery); if (!rset.next()) { return false; //æ‰§è¡Œæ£€æµ‹è¯­å¥å¤±è´¥ï¼Œè¿”å›false } } finally { //å…³é—­èµ„æº JdbcUtils.close(rset); JdbcUtils.close(stmt); } return true; //éªŒè¯é€šè¿‡è¿”å›true } catch (Throwable ex) { // skip return false; } finally { if (sqlFile != null) { JdbcSqlStat.setContextSqlFile(sqlFile); } if (sqlName != null) { JdbcSqlStat.setContextSqlName(sqlName); } } } //MySqlValidConnectionCheckerç±»é‡Œçš„éªŒè¯æ–¹æ³• public boolean isValidConnection(Connection conn, String validateQuery, int validationQueryTimeout) throws Exception { if (conn.isClosed()) { return false; } if (usePingMethod) { //æ˜¯å¦å¯ç”¨pingæ–¹æ³•ï¼ˆå¦‚æœé©±åŠ¨ç¨‹åºæœ‰è¯¥æ–¹æ³•ï¼Œåˆ™è¿™é‡Œä¸ºtrueï¼Œä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯trueï¼‰ if (conn instanceof DruidPooledConnection) { conn = ((DruidPooledConnection) conn).getConnection(); } if (conn instanceof ConnectionProxy) { conn = ((ConnectionProxy) conn).getRawObject(); } if (clazz.isAssignableFrom(conn.getClass())) { if (validationQueryTimeout &lt; 0) { validationQueryTimeout = DEFAULT_VALIDATION_QUERY_TIMEOUT; } try { //pingå¯¹è±¡æ˜¯åˆå§‹åŒ–æ—¶æ‹¿åˆ°é©±åŠ¨ç¨‹åºçš„ä¸€ä¸ªMethodå¯¹è±¡ï¼Œè¿™é‡Œé€šè¿‡invokeè§¦å‘è°ƒç”¨ ping.invoke(conn, true, validationQueryTimeout * 1000); } catch (InvocationTargetException e) { Throwable cause = e.getCause(); if (cause instanceof SQLException) { throw (SQLException) cause; } throw e; //pingå‡ºé”™æŠ›å¼‚å¸¸ } return true; //é€šè¿‡åˆ™è¿”å›true } } //å¦‚æœä¸æ”¯æŒpingæ–¹å¼æ£€æµ‹ï¼Œåˆ™è§¦å‘SELECT 1çš„æ–¹å¼è¿›è¡Œæ£€æµ‹ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šè§¦å‘ï¼Œéƒ½æ˜¯ä¸Šé¢pingæ–¹å¼ï¼‰ String query = validateQuery; if (validateQuery == null || validateQuery.isEmpty()) { query = DEFAULT_VALIDATION_QUERY; } Statement stmt = null; ResultSet rs = null; try { stmt = conn.createStatement(); if (validationQueryTimeout &gt; 0) { stmt.setQueryTimeout(validationQueryTimeout); } rs = stmt.executeQuery(query); return true; } finally { JdbcUtils.close(rs); JdbcUtils.close(stmt); } } è¿™ä¸ªæ–¹æ³•ä¼šåˆ©ç”¨ä¸»æµç¨‹2ï¼ˆinité˜¶æ®µï¼‰é‡Œåˆå§‹åŒ–å¥½çš„checkerå¯¹è±¡ï¼ˆæµç¨‹å‚è€ƒinit-checkerï¼‰é‡Œçš„isValidConnectionæ–¹æ³•ï¼Œå¦‚æœå¯ç”¨pingï¼Œåˆ™è¯¥æ–¹æ³•ä¼šåˆ©ç”¨invokeè§¦å‘é©±åŠ¨ç¨‹åºé‡Œçš„pingæ–¹æ³•ï¼Œå¦‚æœä¸å¯ç”¨pingï¼Œå°±é‡‡ç”¨SELECT 1æ–¹å¼ï¼ˆä»init-checkeré‡Œå¯ä»¥çœ‹å‡ºå¯ä¸å¯ç”¨å–å†³äºåŠ è½½åˆ°çš„é©±åŠ¨ç¨‹åºé‡Œæ˜¯å¦å­˜åœ¨ç›¸åº”çš„æ–¹æ³•ï¼‰ã€‚ å…­ã€æµç¨‹1.4ï¼šæŠ›å¼ƒè¿æ¥ ä¸Šè¿°æµç¨‹å¯¹åº”æºä»£ç å¦‚ä¸‹ï¼ˆè¯·å±•å¼€ï¼‰ï¼š ä»£ç æ®µ1-5 >folded12345678910111213141516//ä¸¢å¼ƒè¿æ¥ public void discardConnection(Connection realConnection) { JdbcUtils.close(realConnection); //closeæ‰çœŸæ­£çš„è¿æ¥å¯¹è±¡ï¼Œä¸€èˆ¬è°ƒç”¨è¯¥æ–¹æ³•ä¼ å…¥çš„connectionå¯¹è±¡éƒ½æ˜¯æœ€åŸå§‹çš„é©±åŠ¨è¿æ¥å¯¹è±¡ï¼Œæ‰€ä»¥è¿™é‡Œå¹¶ä¸ä¼šè§¦å‘recycle lock.lock(); try { activeCount--; //æ´»è·ƒè¿æ¥æ•°-1 discardCount++; //ä¸¢å¼ƒè¿æ¥æ•°+1 if (activeCount &lt;= minIdle) { emptySignal(); //å”¤èµ·ä¸€æ¬¡ä¸»æµç¨‹3æ–°å¢è¿æ¥ } } finally { lock.unlock(); } } ç»è¿‡æµç¨‹1.3è¿”å›çš„æµ‹è¯•ç»“æœï¼Œå¦‚æœå‘ç°è¿æ¥ä¸å¯ç”¨ï¼Œåˆ™ç›´æ¥è§¦å‘æŠ›å¼ƒè¿æ¥é€»è¾‘ï¼Œè¿™ä¸ªè¿‡ç¨‹éå¸¸ç®€å•ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç”±æµç¨‹1.2è·å–åˆ°è¯¥è¿æ¥æ—¶ç´¯åŠ ä¸Šå»çš„activeCountï¼Œåœ¨æœ¬æµç¨‹é‡Œä¼šå†æ¬¡å‡ä¸€ï¼Œè¡¨ç¤ºè¢«å–å‡ºæ¥çš„è¿æ¥ä¸å¯ç”¨ï¼Œå¹¶ä¸èƒ½activeçŠ¶æ€ã€‚å…¶æ¬¡è¿™é‡Œçš„closeæ˜¯æ‹¿ç€é©±åŠ¨é‚£ä¸ªè¿æ¥å¯¹è±¡è¿›è¡Œcloseï¼Œæ­£å¸¸æƒ…å†µä¸‹ä¸€ä¸ªè¿æ¥å¯¹è±¡ä¼šè¢«druidå°è£…æˆDruidPooledConnectionå¯¹è±¡ï¼Œå†…éƒ¨æŒæœ‰çš„connå°±æ˜¯çœŸæ­£çš„é©±åŠ¨Connectionå¯¹è±¡ï¼Œä¸Šå›¾ä¸­çš„å…³é—­è¿æ¥å°±æ˜¯è·å–çš„è¯¥å¯¹è±¡è¿›è¡Œcloseï¼Œå¦‚æœä½¿ç”¨åŒ…è£…ç±»DruidPooledConnectionè¿›è¡Œcloseï¼Œåˆ™ä»£è¡¨å›æ”¶è¿æ¥å¯¹è±¡ï¼ˆrecycleï¼Œå‚è€ƒä¸»æµç¨‹5ï¼‰ã€‚ ä¸ƒã€ä¸»æµç¨‹3ï¼šæ·»åŠ è¿æ¥çš„å®ˆæŠ¤çº¿ç¨‹ ä¸Šè¿°æµç¨‹å¯¹åº”æºä»£ç å¦‚ä¸‹ï¼ˆè¯·å±•å¼€ï¼‰ï¼š ä»£ç æ®µ3-1 >folded123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182//DruidDataSourceçš„å†…éƒ¨ç±»ï¼Œå¯¹åº”ä¸»æµç¨‹3ï¼Œç”¨æ¥è¡¥å……è¿æ¥ public class CreateConnectionThread extends Thread { public CreateConnectionThread(String name){ super(name); //é‡ç½®çº¿ç¨‹åç§° this.setDaemon(true); //æ ‡è®°ä¸ºå®ˆæŠ¤çº¿ç¨‹ } //runæ–¹æ³• public void run() { initedLatch.countDown(); //é€šçŸ¥initï¼ˆä¸»æµç¨‹2ï¼‰è‡ªå·±å·²ç»å¯åŠ¨æˆåŠŸ long lastDiscardCount = 0; int errorCount = 0; for (;;) { //æ­»å¾ªç¯ // addLast try { lock.lockInterruptibly(); //é”è·å– } catch (InterruptedException e2) { break; } long discardCount = DruidDataSource.this.discardCount; //å½“å‰ä¸¢å¼ƒè¿æ¥æ•°ä¸æœ€åä¸€æ¬¡ä¸¢å¼ƒè¿æ¥æ•°çš„å·®å€¼å¤§äº0ï¼Œè¯´æ˜åˆå‘ç”Ÿäº†ä¸¢å¼ƒè¿æ¥çš„ç°è±¡ï¼Œè¯¥æ¡ä»¶ä¼šä¿ƒè¿›è¿æ¥çš„åˆ›å»º boolean discardChanged = discardCount - lastDiscardCount &gt; 0; lastDiscardCount = discardCount; try { boolean emptyWait = true; if (createError != null &amp;&amp; poolingCount == 0 &amp;&amp; !discardChanged) { emptyWait = false; } if (emptyWait &amp;&amp; asyncInit &amp;&amp; createCount &lt; initialSize) { emptyWait = false; } if (emptyWait) { // å¿…é¡»å­˜åœ¨çº¿ç¨‹ç­‰å¾…ï¼Œæ‰åˆ›å»ºè¿æ¥ï¼Œå¦åˆ™ä¸åˆ›å»º if (poolingCount &gt;= notEmptyWaitThreadCount &amp;&amp; (!(keepAlive &amp;&amp; activeCount + poolingCount &lt; minIdle)) &amp;&amp; !isFailContinuous() ) { empty.await(); //ä¸éœ€è¦åˆ›å»ºè¿æ¥æ—¶ï¼Œé˜»å¡ï¼ˆæŒ‚èµ·ï¼‰ } // é˜²æ­¢åˆ›å»ºè¶…è¿‡maxActiveæ•°é‡çš„è¿æ¥ if (activeCount + poolingCount &gt;= maxActive) { empty.await(); //è¶…å‡ºé™åˆ¶ä¾ç„¶æŒ‚èµ·ï¼Œä¸å†æ–°å¢è¿æ¥ continue; } } } catch (InterruptedException e) { lastCreateError = e; lastErrorTimeMillis = System.currentTimeMillis(); if (!closing) { LOG.error(\"create connection Thread Interrupted, url: \" + jdbcUrl, e); } break; } finally { lock.unlock(); //é”é‡Šæ”¾ } //ä»ä¸Šé¢çš„ç¨‹åºèµ°åˆ°è¿™é‡Œï¼Œè¯´æ˜è¯¥çº¿ç¨‹è¢«æˆåŠŸå”¤èµ·ï¼Œåˆ™è¿›è¡Œæ–°å»ºè¿æ¥ PhysicalConnectionInfo connection = null; try { connection = createPhysicalConnection(); //åˆ©ç”¨é©±åŠ¨ç¨‹åºæ–°å»ºç‰©ç†è¿æ¥ } catch (SQLException e) { LOG.error(\"create connection SQLException, url: \" + jdbcUrl + \", errorCode \" + e.getErrorCode() + \", state \" + e.getSQLState(), e); errorCount++; if (errorCount &gt; connectionErrorRetryAttempts &amp;&amp; timeBetweenConnectErrorMillis &gt; 0) { // fail over retry attempts setFailContinuous(true); if (failFast) { lock.lock(); try { notEmpty.signalAll(); } finally { lock.unlock(); } } if (breakAfterAcquireFailure) { break; } try { Thread.sleep(timeBetweenConnectErrorMillis); } catch (InterruptedException interruptEx) { break; } } } catch (RuntimeException e) { LOG.error(\"create connection RuntimeException\", e); setFailContinuous(true); continue; } catch (Error e) { LOG.error(\"create connection Error\", e); setFailContinuous(true); break; } if (connection == null) { continue; //æ–°å»ºå¤±è´¥åå†æ¬¡å°è¯• } boolean result = put(connection); //å°è¯•æ”¾å…¥æ± å­ if (!result) { JdbcUtils.close(connection.getPhysicalConnection()); LOG.info(\"put physical connection to pool failed.\"); } errorCount = 0; // reset errorCount } } } //è¿™ä¸€ä¸ªputæ–¹æ³•æ˜¯ä¸Šé¢è§¦å‘æ¥æ”¶PhysicalConnectionInfoç±»å‹è¿æ¥ç”¨çš„ï¼Œä¹‹å‰è¯´è¿‡ï¼Œæœ€ç»ˆä¿å­˜åœ¨æ± å­é‡Œçš„è¿æ¥å¯¹è±¡éƒ½æ˜¯DruidConnectionHolderç±»å‹ï¼Œæ‰€ä»¥è¿™é‡Œæ—¶è¿›è¡Œä¸€æ¬¡åŒ…è£…ï¼Œç„¶åçœŸæ­£putè¿›å»çš„æ˜¯æ›´ä¸‹é¢çš„putæ–¹æ³• protected boolean put(PhysicalConnectionInfo physicalConnectionInfo) { DruidConnectionHolder holder = null; try { //åŒ…è£…æˆholderç±»å‹ holder = new DruidConnectionHolder(DruidDataSource.this, physicalConnectionInfo); } catch (SQLException ex) { lock.lock(); try { if (createScheduler != null) { createTaskCount--; } } finally { lock.unlock(); } LOG.error(\"create connection holder error\", ex); return false; } return put(holder); //çœŸæ­£æ”¾å…¥æ± å­ } //çœŸæ­£å°†è¿æ¥å¯¹è±¡æ”¾å…¥æ± å­ private boolean put(DruidConnectionHolder holder) { lock.lock(); try { if (poolingCount &gt;= maxActive) { return false; //å¦‚æœæ­¤æ—¶å‘ç°å½“å‰æ± å­é‡Œçš„é—²ç½®è¿æ¥æ•°å·²ç»è¶…è¿‡äº†maxActiveï¼Œé‚£ä¹ˆå°±ä¸å†å¾€é‡Œé¢åŠ äº† } connections[poolingCount] = holder; //åŠ åœ¨æ•°ç»„å°¾éƒ¨ incrementPoolingCount(); //poolingCount++ if (poolingCount &gt; poolingPeak) { poolingPeak = poolingCount; poolingPeakTime = System.currentTimeMillis(); } notEmpty.signal(); //å”¤èµ·ä¸€ä¸ªå› ä¸ºæ‹¿ä¸åˆ°è¿æ¥å¯¹è±¡è€Œå‘ç”Ÿé˜»å¡çš„ä¸šåŠ¡çº¿ç¨‹ï¼Œè®©å…¶å†æ¬¡è¿›å…¥è¿è¡ŒçŠ¶æ€ï¼Œè¿›è¡Œè·å–è¿æ¥ç«äº‰ notEmptySignalCount++; if (createScheduler != null) { //æ¨¡å¼æœªå¯ç”¨ createTaskCount--; if (poolingCount + createTaskCount &lt; notEmptyWaitThreadCount // &amp;&amp; activeCount + poolingCount + createTaskCount &lt; maxActive) { emptySignal(); } } } finally { lock.unlock(); } return true; } åœ¨ä¸»æµç¨‹2ï¼ˆinitåˆå§‹åŒ–é˜¶æ®µï¼‰æ—¶å°±å¼€å¯äº†è¯¥æµç¨‹ï¼Œè¯¥æµç¨‹ç‹¬ç«‹è¿è¡Œï¼Œå¤§éƒ¨åˆ†æ—¶é—´å¤„äºç­‰å¾…çŠ¶æ€ï¼Œä¸ä¼šæŠ¢å cpuï¼Œä½†æ˜¯å½“è¿æ¥ä¸å¤Ÿç”¨æ—¶ï¼Œå°±ä¼šè¢«å”¤èµ·è¿½åŠ è¿æ¥ï¼ŒæˆåŠŸåˆ›å»ºè¿æ¥åå°†ä¼šå”¤é†’å…¶ä»–æ­£åœ¨ç­‰å¾…è·å–å¯ç”¨è¿æ¥çš„çº¿ç¨‹ï¼Œæ¯”å¦‚ï¼š ç»“åˆæµç¨‹1.2æ¥çœ‹ï¼Œå½“è¿æ¥ä¸å¤Ÿç”¨æ—¶ï¼Œä¼šé€šè¿‡empty.signalå”¤é†’è¯¥çº¿ç¨‹è¿›è¡Œè¡¥å……è¿æ¥ï¼ˆé˜»å¡åœ¨emptyä¸Šçš„çº¿ç¨‹åªæœ‰ä¸»æµç¨‹3çš„å•çº¿ç¨‹ï¼‰ï¼Œç„¶åé€šè¿‡notEmptyé˜»å¡è‡ªå·±ï¼Œå½“è¯¥çº¿ç¨‹è¡¥å……è¿æ¥æˆåŠŸåï¼Œåˆä¼šå¯¹é˜»å¡åœ¨notEmptyä¸Šçš„çº¿ç¨‹è¿›è¡Œå”¤é†’ï¼Œè®©å…¶è¿›å…¥é”ç«äº‰çŠ¶æ€ï¼Œç®€å•ç†è§£å°±æ˜¯ä¸€ä¸ªç”Ÿäº§-æ¶ˆè´¹æ¨¡å‹ã€‚è¿™é‡Œæœ‰ä¸€äº›ç»†èŠ‚ï¼Œæ¯”å¦‚æ± å­é‡Œçš„è¿æ¥ä½¿ç”¨ä¸­ï¼ˆactiveCountï¼‰åŠ ä¸Šæ± å­é‡Œå‰©ä½™è¿æ¥æ•°ï¼ˆpoolingCountï¼‰å°±æ˜¯æŒ‡å½“å‰ä¸€å…±ç”Ÿæˆäº†å¤šå°‘ä¸ªè¿æ¥ï¼Œè¿™ä¸ªæ•°ä¸èƒ½æ¯”maxActiveè¿˜å¤§ï¼Œå¦‚æœæ¯”maxActiveè¿˜å¤§ï¼Œåˆ™å†æ¬¡é™·å…¥ç­‰å¾…ã€‚è€Œåœ¨å¾€æ± å­é‡Œputè¿æ¥æ—¶ï¼Œåˆ™åˆ¤æ–­poolingCountæ˜¯å¦å¤§äºmaxActiveæ¥å†³å®šæœ€ç»ˆæ˜¯å¦å…¥æ± ã€‚ å…«ã€ä¸»æµç¨‹4ï¼šæŠ›å¼ƒè¿æ¥çš„å®ˆæŠ¤çº¿ç¨‹ ä¸Šè¿°æµç¨‹å¯¹åº”æºä»£ç å¦‚ä¸‹ï¼ˆè¯·å±•å¼€ï¼‰ï¼š ä»£ç æ®µ4-1 >folded123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354//è¿æ¥æ± ç˜¦èº«ï¼Œå‚è€ƒä¸»æµç¨‹4 public class DestroyConnectionThread extends Thread { public DestroyConnectionThread(String name){ super(name); //ç»™çº¿ç¨‹é‡å‘½å this.setDaemon(true); //æ ‡è®°ä¸ºå®ˆæŠ¤çº¿ç¨‹ } //runæ–¹æ³• public void run() { initedLatch.countDown(); //é€šçŸ¥initï¼ˆä¸»æµç¨‹2ï¼‰è‡ªå·±å·²ç»å¯åŠ¨æˆåŠŸ for (;;) { //æ­»å¾ªç¯ // ä»å‰é¢å¼€å§‹åˆ é™¤ try { if (closed) { break; } if (timeBetweenEvictionRunsMillis &gt; 0) { //æ£€æŸ¥æ—¶é—´é—´éš”ï¼Œä¸å¯ç”¨ï¼ˆå°äºç­‰äº0æ—¶ï¼‰åˆ™é»˜è®¤1sï¼Œäº‹å®ä¸Šï¼Œdruidå¯¹äºè¯¥å‚æ•°çš„ç¼ºçœå€¼æ˜¯60s Thread.sleep(timeBetweenEvictionRunsMillis); } else { Thread.sleep(1000); //é»˜è®¤1s } if (Thread.interrupted()) { break; } destroyTask.run(); //å¯åŠ¨destroyçš„runæ–¹æ³•ï¼ˆåœ¨ä¸‹æ–¹ï¼‰ } catch (InterruptedException e) { break; } } } } //DruidDataSourceå†…éƒ¨ç±» public class DestroyTask implements Runnable { public DestroyTask() { } @Override public void run() { shrink(true, keepAlive); //è¿æ¥æ± çš„æ£€æŸ¥&amp;ç˜¦èº« if (isRemoveAbandoned()) { //å¦‚æœå¼€å¯è¯¥å±æ€§ï¼Œåˆ™è¿›è¡Œå¼ºåˆ¶å›æ”¶æ£€æŸ¥ removeAbandoned(); } } } æµç¨‹4.1ï¼šè¿æ¥æ± ç˜¦èº«ï¼Œæ£€æŸ¥è¿æ¥æ˜¯å¦å¯ç”¨ä»¥åŠä¸¢å¼ƒå¤šä½™è¿æ¥æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹ï¼š ä¸Šè¿°æµç¨‹å¯¹åº”æºä»£ç å¦‚ä¸‹ï¼ˆè¯·å±•å¼€ï¼‰ï¼š ä»£ç æ®µ-4-2 >folded123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164//è¿æ¥æ± ç˜¦èº« public void shrink(boolean checkTime, boolean keepAlive) { try { lock.lockInterruptibly(); } catch (InterruptedException e) { return; } int evictCount = 0; int keepAliveCount = 0; try { if (!inited) { return; } final int checkCount = poolingCount - minIdle; //æ ¹æ®poolingCountå’ŒminIdleè®¡ç®—å‡ºevictCheckçš„èŒƒå›´ final long currentTimeMillis = System.currentTimeMillis(); for (int i = 0; i &lt; poolingCount; ++i) { //å¼€å§‹éå†è¿æ¥æ± é‡Œé—²ç½®çš„è¿æ¥ DruidConnectionHolder connection = connections[i]; if (checkTime) { //é™¤éæ‰‹åŠ¨è°ƒç”¨ï¼Œä¸ç„¶ç»è¿‡ä¸»æµç¨‹4è§¦å‘ï¼Œä¸€èˆ¬ä¸ºtrue if (phyTimeoutMillis &gt; 0) { //é»˜è®¤ä¸å¯ç”¨ï¼Œå¿½ç•¥ long phyConnectTimeMillis = currentTimeMillis - connection.connectTimeMillis; if (phyConnectTimeMillis &gt; phyTimeoutMillis) { evictConnections[evictCount++] = connection; continue; } } //è®¡ç®—é—²ç½®æ—¶é—´ long idleMillis = currentTimeMillis - connection.lastActiveTimeMillis; if (idleMillis &lt; minEvictableIdleTimeMillis &amp;&amp; idleMillis &lt; keepAliveBetweenTimeMillis ) { //å¦‚æœé—²ç½®æ—¶é—´è¾¾ä¸åˆ°æ£€æµ‹&amp;ç˜¦èº«çš„é˜ˆå€¼ï¼Œåˆ™ä¸å¤„ç† break; } if (idleMillis &gt;= minEvictableIdleTimeMillis) { if (checkTime &amp;&amp; i &lt; checkCount) { //è¾¾åˆ°éœ€è¦ä¸¢å¼ƒçš„é˜ˆå€¼æ—¶ï¼Œåˆ™åˆ¤æ–­è¿æ¥ä¸‹æ ‡æ˜¯å¦åœ¨evictCheckèŒƒå›´ï¼Œè‹¥åœ¨ï¼Œåˆ™è§†ä¸ºâ€œå¯ä»¥ä¸¢å¼ƒçš„å¯¹è±¡â€æ”¾å…¥evictConnectionsæ•°ç»„ evictConnections[evictCount++] = connection; continue; } else if (idleMillis &gt; maxEvictableIdleTimeMillis) { //è¾¾åˆ°å¿…é¡»è¦ä¸¢å¼ƒçš„é˜ˆå€¼æ—¶ï¼Œåˆ™ä¸ç®¡æ˜¯ä¸æ˜¯åœ¨evictCheckèŒƒå›´å†…ï¼Œéƒ½ç›´æ¥æ”¾å…¥â€œå¯ä»¥ä¸¢å¼ƒçš„å¯¹è±¡â€çš„evictConnectionsæ•°ç»„ evictConnections[evictCount++] = connection; continue; } } //å¦‚æœä¸Šé¢çš„æ¡ä»¶å‡æ²¡æœ‰å‘½ä¸­ï¼Œå¦‚æœkeepAliveä¸ºtrueï¼Œåˆ™åˆ¤æ–­æ˜¯ä¸æ˜¯è¶…è¿‡äº†é—²ç½®è¿æ¥æ£€æŸ¥å…¶æ´»æ€§çš„é¢‘æ¬¡é˜ˆå€¼ï¼ˆå³ç”±keepAliveBetweenTimeMillisæ§åˆ¶ï¼‰ if (keepAlive &amp;&amp; idleMillis &gt;= keepAliveBetweenTimeMillis) { keepAliveConnections[keepAliveCount++] = connection; //æ»¡è¶³æ¡ä»¶åˆ™è§†ä¸ºâ€œéœ€è¦æ£€æµ‹æ´»æ€§çš„å¯¹è±¡â€ï¼Œæ”¾å…¥keepAliveConnectionsæ•°ç»„ } } else { if (i &lt; checkCount) { evictConnections[evictCount++] = connection; } else { break; } } } int removeCount = evictCount + keepAliveCount; //è¿™ä¸€æ‰¹éœ€è¦ç§»é™¤ç‰¹æ®Šå¤„ç†çš„è¿æ¥æ€»æ•° if (removeCount &gt; 0) { System.arraycopy(connections, removeCount, connections, 0, poolingCount - removeCount); //æ ¹æ®å½“å‰ç§»é™¤çš„å…ƒç´ ï¼ŒæŠŠå‰©ä½™çš„å…ƒç´ ç§»åŠ¨è‡³æ•°ç»„é¦–éƒ¨ï¼ˆå‚è€ƒæµç¨‹4.1ï¼‰ Arrays.fill(connections, poolingCount - removeCount, poolingCount, null); //å‰©ä½™ä½ç½®æ¸…ç©º poolingCount -= removeCount; } keepAliveCheckCount += keepAliveCount; } finally { lock.unlock(); } if (evictCount &gt; 0) { //å¦‚æœéœ€è¦ä¸¢å¼ƒçš„è¿æ¥æ•°é‡å¤§äº0 for (int i = 0; i &lt; evictCount; ++i) { DruidConnectionHolder item = evictConnections[i]; Connection connection = item.getConnection(); JdbcUtils.close(connection); //ç›´æ¥å…³é—­è¿æ¥ï¼ˆè¿™é‡Œæ˜¯ç›´æ¥å…³é—­é©±åŠ¨è¿æ¥ï¼Œä¸å†æ”¾å›æ± å­ï¼‰ destroyCountUpdater.incrementAndGet(this); } Arrays.fill(evictConnections, null); //å°†evictConnectionsæ•°ç»„é‡æ–°ç½®ç©ºï¼ˆæ–¹ä¾¿ä¸‹æ¬¡ä½¿ç”¨ï¼‰ } if (keepAliveCount &gt; 0) { //æ£€æµ‹é‚£äº›éœ€è¦åˆ¤æ´»çš„è¿æ¥æ•° // keep order for (int i = keepAliveCount - 1; i &gt;= 0; --i) { DruidConnectionHolder holer = keepAliveConnections[i]; Connection connection = holer.getConnection(); holer.incrementKeepAliveCheckCount(); boolean validate = false; try { this.validateConnection(connection); //æ£€æµ‹å…¶æ´»æ€§ validate = true; } catch (Throwable error) { if (LOG.isDebugEnabled()) { LOG.debug(\"keepAliveErr\", error); } // skip } boolean discard = !validate; if (validate) { //æ£€æµ‹é€šè¿‡ holer.lastKeepTimeMillis = System.currentTimeMillis(); boolean putOk = put(holer); //æ£€æµ‹é€šè¿‡åï¼Œå†æ¬¡æ”¾å…¥æ± å­ if (!putOk) { //æ”¾ä¸è¿›å»æ± å­ï¼ˆè¯´æ˜å·²ç»è¾¾åˆ°è¿æ¥æ± æœ€å¤§è¿æ¥æ•°é˜ˆå€¼maxActiveï¼‰ï¼Œåˆ™è§†ä¸ºå¯ä»¥â€œç›´æ¥æŠ›å¼ƒâ€çš„è¿æ¥ discard = true; } } if (discard) { try { connection.close(); //å¦‚æœå¯ä»¥æŠ›å¼ƒï¼Œåˆ™ç›´æ¥å…³é—­è¿æ¥ï¼ˆç›´æ¥è°ƒç”¨é©±åŠ¨çš„closeï¼‰ } catch (Exception e) { // skip } lock.lock(); try { discardCount++; //æŠ›å¼ƒè¿æ¥æ•°ç´¯åŠ  if (activeCount &lt;= minIdle) { emptySignal(); //å”¤èµ·ä¸»æµç¨‹3è¿½åŠ è¿æ¥å¯¹è±¡ } } finally { lock.unlock(); } } } this.getDataSourceStat().addKeepAliveCheckCount(keepAliveCount); Arrays.fill(keepAliveConnections, null); //å°†keepAliveConnectionsæ•°ç»„é‡æ–°ç½®ç©ºï¼ˆæ–¹ä¾¿ä¸‹æ¬¡ä½¿ç”¨ï¼‰ } } //ä¸Šé¢æ£€æµ‹é€šè¿‡ï¼Œå†æ¬¡é€šè¿‡è¯¥æ–¹æ³•é‡æ–°æŠŠè¿æ¥æ”¾å…¥æ± å­ private boolean put(DruidConnectionHolder holder) { lock.lock(); try { if (poolingCount &gt;= maxActive) { return false; //è‹¥æ± å­å†…é—²ç½®è¿æ¥æ•°è¶…è¿‡maxActiveï¼Œåˆ™æ— æ³•ç»§ç»­æ·»åŠ æ–°çš„è¿æ¥è¿›æ¥ï¼Œè¿”å›false } connections[poolingCount] = holder; //å¦åˆ™ç›´æ¥æŠŠæ­¤è¿æ¥å¯¹è±¡æ”¾å…¥è¿æ¥æ± é˜Ÿå°¾ incrementPoolingCount(); //poolingCount++ if (poolingCount &gt; poolingPeak) { poolingPeak = poolingCount; poolingPeakTime = System.currentTimeMillis(); } notEmpty.signal(); //å”¤èµ·é‚£äº›å› è·å–ä¸åˆ°å¯ç”¨è¿æ¥è€Œé™·å…¥é˜»å¡çŠ¶æ€çš„ä¸šåŠ¡çº¿ç¨‹ä¸€æ¬¡ notEmptySignalCount++; if (createScheduler != null) { //ä¸å¯ç”¨è¯¥æ¨¡å¼ï¼Œå¿½ç•¥ createTaskCount--; if (poolingCount + createTaskCount &lt; notEmptyWaitThreadCount // &amp;&amp; activeCount + poolingCount + createTaskCount &lt; maxActive) { emptySignal(); } } } finally { lock.unlock(); } return true; } æ•´ä¸ªæµç¨‹åˆ†æˆå›¾ä¸­ä¸»è¦çš„å‡ æ­¥ï¼Œé¦–å…ˆåˆ©ç”¨poolingCountå‡å»minIdleè®¡ç®—å‡ºéœ€è¦åšä¸¢å¼ƒæ£€æŸ¥çš„è¿æ¥å¯¹è±¡åŒºé—´ï¼Œæ„å‘³ç€è¿™ä¸ªåŒºé—´çš„å¯¹è±¡æœ‰è¢«ä¸¢å¼ƒçš„å¯èƒ½ï¼Œå…·ä½“è¦ä¸è¦æ”¾è¿›ä¸¢å¼ƒé˜Ÿåˆ—evictConnectionsï¼Œè¦åˆ¤æ–­ä¸¤ä¸ªå±æ€§ï¼š minEvictableIdleTimeMillisï¼šæœ€å°æ£€æŸ¥é—´éš™ï¼Œç¼ºçœå€¼30minï¼Œå®˜æ–¹è§£é‡Šï¼šä¸€ä¸ªè¿æ¥åœ¨æ± ä¸­æœ€å°ç”Ÿå­˜çš„æ—¶é—´ï¼ˆç»“åˆæ£€æŸ¥åŒºé—´æ¥çœ‹ï¼Œé—²ç½®æ—¶é—´è¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œæ‰ä¼šè¢«ä¸¢å¼ƒï¼‰ã€‚ maxEvictableIdleTimeMillisï¼šæœ€å¤§æ£€æŸ¥é—´éš™ï¼Œç¼ºçœå€¼7hï¼Œå®˜æ–¹è§£é‡Šï¼šä¸€ä¸ªè¿æ¥åœ¨æ± ä¸­æœ€å¤§ç”Ÿå­˜çš„æ—¶é—´ï¼ˆæ— è§†æ£€æŸ¥åŒºé—´ï¼Œåªè¦é—²ç½®æ—¶é—´è¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œå°±ä¸€å®šä¼šè¢«ä¸¢å¼ƒï¼‰ã€‚ å¦‚æœå½“å‰è¿æ¥å¯¹è±¡é—²ç½®æ—¶é—´è¶…è¿‡minEvictableIdleTimeMillisä¸”ä¸‹æ ‡åœ¨evictCheckåŒºé—´å†…ï¼Œåˆ™åŠ å…¥ä¸¢å¼ƒé˜Ÿåˆ—evictConnectionsï¼Œå¦‚æœé—²ç½®æ—¶é—´è¶…è¿‡maxEvictableIdleTimeMillisï¼Œåˆ™ç›´æ¥æ”¾å…¥evictConnectionsï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ä¼šå‘½ä¸­ç¬¬ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶ï¼Œé™¤éä¸€ä¸ªè¿æ¥ä¸åœ¨æ£€æŸ¥åŒºé—´ï¼Œä¸”é—²ç½®æ—¶é—´è¶…è¿‡maxEvictableIdleTimeMillisï¼‰ã€‚ å¦‚æœè¿æ¥å¯¹è±¡ä¸åœ¨evictCheckåŒºé—´å†…ï¼Œä¸”keepAliveå±æ€§ä¸ºtrueï¼Œåˆ™åˆ¤æ–­è¯¥å¯¹è±¡é—²ç½®æ—¶é—´æ˜¯å¦è¶…å‡ºkeepAliveBetweenTimeMillisï¼ˆç¼ºçœå€¼60sï¼‰ï¼Œè‹¥è¶…å‡ºï¼Œåˆ™æ„å‘³ç€è¯¥è¿æ¥éœ€è¦è¿›è¡Œè¿æ¥å¯ç”¨æ€§æ£€æŸ¥ï¼Œåˆ™å°†è¯¥å¯¹è±¡æ”¾å…¥keepAliveConnectionsé˜Ÿåˆ—ã€‚ ä¸¤ä¸ªé˜Ÿåˆ—èµ‹å€¼å®Œæˆåï¼Œåˆ™æ± å­ä¼šè¿›è¡Œä¸€æ¬¡å‹ç¼©ï¼Œæ²¡æœ‰æ¶‰åŠåˆ°çš„è¿æ¥å¯¹è±¡ä¼šè¢«å‹ç¼©åˆ°é˜Ÿé¦–ã€‚ ç„¶åå°±æ˜¯å¤„ç†evictConnectionså’ŒkeepAliveConnectionsä¸¤ä¸ªé˜Ÿåˆ—äº†ï¼ŒevictConnectionsé‡Œçš„å¯¹è±¡ä¼šè¢«closeæœ€åé‡Šæ”¾æ‰ï¼ŒkeepAliveConnectionsé‡Œé¢çš„å¯¹è±¡å°†ä¼šå…¶è¿›è¡Œæ£€æµ‹ï¼ˆæµç¨‹å‚è€ƒæµç¨‹1.3çš„isValidConnectionï¼‰ï¼Œç¢°åˆ°ä¸å¯ç”¨çš„è¿æ¥ä¼šè°ƒç”¨discardï¼ˆæµç¨‹1.4ï¼‰æŠ›å¼ƒæ‰ï¼Œå¯ç”¨çš„è¿æ¥ä¼šå†æ¬¡è¢«æ”¾è¿›è¿æ¥æ± ã€‚ æ•´ä¸ªæµç¨‹å¯ä»¥çœ‹å‡ºï¼Œè¿æ¥é—²ç½®åï¼Œä¹Ÿå¹¶éä¸€ä¸‹å­å°±å‡å°‘åˆ°minIdleçš„ï¼Œå¦‚æœä¹‹å‰äº§ç”Ÿä¸€å †çš„è¿æ¥ï¼ˆä¸è¶…è¿‡maxActiveï¼‰ï¼Œçªç„¶é—²ç½®äº†ä¸‹æ¥ï¼Œåˆ™è‡³å°‘éœ€è¦èŠ±minEvictableIdleTimeMillisçš„æ—¶é—´æ‰å¯ä»¥è¢«ç§»å‡ºè¿æ¥æ± ï¼Œå¦‚æœä¸€ä¸ªè¿æ¥é—²ç½®æ—¶é—´è¶…è¿‡maxEvictableIdleTimeMillisåˆ™å¿…å®šè¢«å›æ”¶ï¼Œæ‰€ä»¥æç«¯æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚ä¸€ä¸ªè¿æ¥æ± ä»åˆå§‹åŒ–åå°±æ²¡æœ‰å†è¢«ä½¿ç”¨è¿‡ï¼‰ï¼Œè¿æ¥æ± é‡Œå¹¶ä¸ä¼šä¸€ç›´ä¿æŒminIdleä¸ªè¿æ¥ï¼Œè€Œæ˜¯ä¸€ä¸ªéƒ½æ²¡æœ‰ï¼Œç”Ÿäº§ç¯å¢ƒä¸‹è¿™æ˜¯éå¸¸ä¸å¸¸è§çš„ï¼Œé»˜è®¤çš„maxEvictableIdleTimeMilliséƒ½æœ‰7hé™¤éæ˜¯æåº¦å†·é—¨çš„ç³»ç»Ÿæ‰ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œè€Œå¼€å¯keepAliveä¹Ÿä¸ä¼šæ¨ç¿»è¿™ä¸ªè§„åˆ™ï¼ŒkeepAliveçš„ä¼˜å…ˆçº§æ˜¯ä½äºmaxEvictableIdleTimeMillisçš„ï¼ŒkeepAliveåªæ˜¯ä¿è¯äº†é‚£äº›æ£€æŸ¥ä¸­ä¸éœ€è¦è¢«ç§»å‡ºè¿æ¥æ± çš„è¿æ¥åœ¨æŒ‡å®šæ£€æµ‹æ—¶é—´å†…å»æ£€æµ‹å…¶è¿æ¥æ´»æ€§ï¼Œä»è€Œå†³å®šæ˜¯å¦æ”¾å…¥æ± å­æˆ–è€…ç›´æ¥discardã€‚ æµç¨‹4.2ï¼šä¸»åŠ¨å›æ”¶è¿æ¥ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼è¿‡ç¨‹å¦‚ä¸‹ï¼š ä¸Šè¿°æµç¨‹å¯¹åº”æºä»£ç å¦‚ä¸‹ï¼ˆè¯·å±•å¼€ï¼‰ï¼š ä»£ç æ®µ4-3 >folded1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283//å›æ”¶é•¿æœŸæœªå½’è¿˜çš„è¿æ¥ï¼ˆå†æ¬¡è¯´æ˜ï¼šè¯¥æ–¹æ³•ä»…åœ¨removeAbandonedè®¾ç½®ä¸ºtrueçš„æƒ…å†µä¸‹è§¦å‘ï¼‰ public int removeAbandoned() { int removeCount = 0; long currrentNanos = System.nanoTime(); //è¿™ä¸ªåˆ—è¡¨ç”¨äºå­˜æ”¾æ»¡è¶³æ¡ä»¶çš„çœŸæ­£éœ€è¦å¼ºåˆ¶å›æ”¶çš„è¿æ¥ List abandonedList = new ArrayList(); activeConnectionLock.lock(); try { //åœ¨removeAbandonedè®¾ç½®ä¸ºtrueçš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰è¢«å€Ÿå‡ºå»çš„è¿æ¥ï¼Œéƒ½ä¼šè¢«ä¿å­˜è¿›activeConnectionsï¼ˆå‚è€ƒä¸»æµç¨‹1ï¼‰ï¼Œæ‰€ä»¥è¦è¿›è¡Œâ€œé•¿æœŸæœªå½’è¿˜â€çš„æ£€æŸ¥ï¼Œå°±æ˜¯ä»activeConnectionså¼€å§‹çš„ Iterator iter = activeConnections.keySet().iterator(); for (; iter.hasNext();) { DruidPooledConnection pooledConnection = iter.next(); if (pooledConnection.isRunning()) { continue; //å¦‚æœå½“å‰è¿æ¥æ­£åœ¨ä½¿ç”¨ä¸­ï¼ˆæŒ‡çš„æ˜¯æ­£åœ¨executeï¼‰ï¼Œåˆ™ä¸å¤„ç† } //åˆ©ç”¨å½“å‰æ—¶é—´å’Œè¿æ¥è¢«å€Ÿå‡ºå»æ—¶çš„æ—¶é—´ï¼Œè®¡ç®—å‡ºè¿æ¥è¢«å€Ÿå‡ºå»çš„æ—¶é—´æœ‰å¤šä¹… long timeMillis = (currrentNanos - pooledConnection.getConnectedTimeNano()) / (1000 * 1000); if (timeMillis &gt;= removeAbandonedTimeoutMillis) { //å¦‚æœè¿æ¥è¢«å€Ÿå‡ºå»çš„æ—¶é—´è¶…è¿‡removeAbandonedTimeoutMillisè¿™ä¸ªé˜ˆå€¼ï¼Œå°†ä¼šå‘½ä¸­â€œä¸»åŠ¨å½’è¿˜â€çš„é€»è¾‘æ£€æŸ¥ iter.remove(); //å…ˆä»activeConnectionsç§»é™¤ pooledConnection.setTraceEnable(false); //æ ‡è®°ä¸ºfalseï¼Œé˜²æ­¢å›æ”¶æ—¶é‡å¤removeactiveConnectionsï¼Œå¯ä»¥å‚è€ƒä¸»æµç¨‹5 abandonedList.add(pooledConnection); //æ”¾å…¥â€œå¼ºåˆ¶å›æ”¶â€é˜Ÿåˆ— } } } finally { activeConnectionLock.unlock(); } if (abandonedList.size() &gt; 0) { //å¦‚æœâ€œå¼ºåˆ¶å›æ”¶â€é˜Ÿåˆ—å¤§äº0ï¼Œè¯´æ˜æœ‰éœ€è¦å›æ”¶çš„è¿æ¥ for (DruidPooledConnection pooledConnection : abandonedList) { //å¾ªç¯è¿™äº›è¿æ¥ final ReentrantLock lock = pooledConnection.lock; lock.lock(); //æ‹¿åˆ°è¿æ¥çš„é” try { if (pooledConnection.isDisable()) { continue; //å·²ç»è¢«å›æ”¶çš„ï¼Œåˆ™ä¸ç®¡ } } finally { lock.unlock(); } //è§¦å‘å›æ”¶è¿æ¥å¯¹è±¡ï¼ˆpooledConnectionï¼‰é‡Œçš„holcderï¼ˆæ³¨æ„è¿™é‡Œå…¶å®æ˜¯æŠŠpooledConnectionå¯¹è±¡é‡Œçš„holderç»™å›æ”¶è‡³è¿æ¥æ± äº†ï¼ŒpooledConnectionå¯¹è±¡æœ¬èº«ä¼šè¢«é”€æ¯ï¼‰ JdbcUtils.close(pooledConnection); //è¿™é‡Œè§¦å‘çš„closeï¼Œæ˜¯DruidPooledConnectionçš„closeï¼Œä¹Ÿå°±æ˜¯ä¼šè§¦å‘recycleæ–¹æ³•çš„close pooledConnection.abandond(); //æ ‡è®°ä¸º removeAbandonedCount++; removeCount++; if (isLogAbandoned()) { //æ—¥å¿—æ‰“å°ï¼Œå¿½ç•¥ StringBuilder buf = new StringBuilder(); buf.append(\"abandon connection, owner thread: \"); buf.append(pooledConnection.getOwnerThread().getName()); buf.append(\", connected at : \"); buf.append(pooledConnection.getConnectedTimeMillis()); buf.append(\", open stackTrace\\n\"); StackTraceElement[] trace = pooledConnection.getConnectStackTrace(); for (int i = 0; i &lt; trace.length; i++) { buf.append(\"\\tat \"); buf.append(trace[i].toString()); buf.append(\"\\n\"); } buf.append(\"ownerThread current state is \" + pooledConnection.getOwnerThread().getState() + \", current stackTrace\\n\"); trace = pooledConnection.getOwnerThread().getStackTrace(); for (int i = 0; i &lt; trace.length; i++) { buf.append(\"\\tat \"); buf.append(trace[i].toString()); buf.append(\"\\n\"); } LOG.error(buf.toString()); } } } return removeCount; //è¿”å›æœ¬æ¬¡è¢«å¼ºåˆ¶å›æ”¶çš„è¿æ¥ä¸ªæ•° } è¿™ä¸ªæµç¨‹åœ¨removeAbandonedè®¾ç½®ä¸ºtrueçš„æƒ…å†µä¸‹æ‰ä¼šè§¦å‘ï¼Œç”¨äºå›æ”¶é‚£äº›æ‹¿å‡ºå»çš„ä½¿ç”¨é•¿æœŸæœªå½’è¿˜ï¼ˆå½’è¿˜ï¼šè°ƒç”¨closeæ–¹æ³•è§¦å‘ä¸»æµç¨‹5ï¼‰çš„è¿æ¥ã€‚ å…ˆæ¥çœ‹çœ‹activeConnectionsæ˜¯ä»€ä¹ˆï¼ŒactiveConnectionsç”¨æ¥ä¿å­˜å½“å‰ä»æ± å­é‡Œè¢«å€Ÿå‡ºå»çš„è¿æ¥ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡ä¸»æµç¨‹1çœ‹å‡ºæ¥ï¼Œæ¯æ¬¡è°ƒç”¨getConnectionæ—¶ï¼Œå¦‚æœå¼€å¯removeAbandonedï¼Œåˆ™ä¼šæŠŠè¿æ¥å¯¹è±¡æ”¾åˆ°activeConnectionsï¼Œç„¶åå¦‚æœé•¿æœŸä¸è°ƒç”¨closeï¼Œé‚£ä¹ˆè¿™ä¸ªè¢«å€Ÿå‡ºå»çš„è¿æ¥å°†æ°¸è¿œæ— æ³•è¢«é‡æ–°æ”¾å›æ± å­ï¼Œè¿™æ˜¯ä¸€ä»¶å¾ˆéº»çƒ¦çš„äº‹æƒ…ï¼Œè¿™å°†å­˜åœ¨å†…å­˜æ³„æ¼çš„é£é™©ï¼Œå› ä¸ºä¸closeï¼Œæ„å‘³ç€æ± å­ä¼šä¸æ–­äº§ç”Ÿæ–°çš„è¿æ¥æ”¾è¿›connectionsï¼Œä¸ç¬¦åˆè¿æ¥æ± é¢„æœŸï¼ˆè¿æ¥æ± å‡ºå‘ç‚¹æ˜¯å°½å¯èƒ½å°‘çš„åˆ›å»ºè¿æ¥ï¼‰ï¼Œç„¶åä¹‹å‰è¢«å€Ÿå‡ºå»çš„è¿æ¥å¯¹è±¡è¿˜æœ‰ä¸€ç›´æ— æ³•è¢«å›æ”¶çš„é£é™©ï¼Œå­˜åœ¨å†…å­˜æ³„æ¼çš„é£é™©ï¼Œå› æ­¤ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±æœ‰äº†è¿™ä¸ªæµç¨‹ï¼Œæµç¨‹æ•´ä½“å¾ˆç®€å•ï¼Œå°±æ˜¯å°†ç°åœ¨å€Ÿå‡ºå»è¿˜æ²¡æœ‰å½’è¿˜çš„è¿æ¥ï¼Œåšä¸€æ¬¡åˆ¤æ–­ï¼Œç¬¦åˆæ¡ä»¶çš„å°†ä¼šè¢«æ”¾è¿›abandonedListè¿›è¡Œè¿æ¥å›æ”¶ï¼ˆè¿™ä¸ªlisté‡Œçš„è¿æ¥å¯¹è±¡é‡Œçš„abandonedå°†ä¼šè¢«ç½®ä¸ºtrueï¼Œæ ‡è®°å·²è¢«è¯¥æµç¨‹å¤„ç†è¿‡ï¼Œé˜²æ­¢ä¸»æµç¨‹5å†æ¬¡å¤„ç†ï¼Œå…·ä½“å¯ä»¥å‚è€ƒä»£ç æ®µ5-1ï¼‰ã€‚ è¿™ä¸ªå¦‚æœåœ¨å®è·µä¸­èƒ½ä¿è¯æ¯æ¬¡éƒ½å¯ä»¥æ­£å¸¸closeï¼Œå®Œå…¨ä¸ç”¨è®¾ç½®removeAbandoned=trueï¼Œç›®å‰å¦‚æœä½¿ç”¨äº†ç±»ä¼¼mybatisã€springç­‰å¼€æºæ¡†æ¶ï¼Œæ¡†æ¶å†…éƒ¨æ˜¯ä¸€å®šä¼šcloseçš„ï¼Œæ‰€ä»¥æ­¤é¡¹æ˜¯ä¸å»ºè®®è®¾ç½®çš„ï¼Œè§†æƒ…å†µè€Œå®šã€‚ ä¹ã€ä¸»æµç¨‹5ï¼šå›æ”¶è¿æ¥è¿™ä¸ªæµç¨‹é€šå¸¸æ˜¯é è¿æ¥åŒ…è£…ç±»DruidPooledConnectionçš„closeæ–¹æ³•è§¦å‘çš„ï¼Œç›®æ ‡æ–¹æ³•ä¸ºrecycleï¼Œæµç¨‹å›¾å¦‚ä¸‹ï¼š ä¸Šè¿°æµç¨‹å¯¹åº”æºä»£ç å¦‚ä¸‹ï¼ˆè¯·å±•å¼€ï¼‰ï¼š ä»£ç æ®µ5-1 >folded123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280//DruidPooledConnectionç±»çš„closeæ–¹æ³• @Override public void close() throws SQLException { if (this.disable) { //æ£€æŸ¥ï¼Œå› ä¸ºè¯¥è¿æ¥å¯¹è±¡æ˜¯æŠ›å‡ºå»ç»™åˆ«çš„ä¸šåŠ¡çº¿ç¨‹ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´å¹¶ä¸å—è¿æ¥æ± æœ¬èº«ç®¡æ§ï¼Œæ‰€ä»¥å¾ˆå¯èƒ½å­˜åœ¨å¤šçº¿ç¨‹åŒæ—¶closeçš„æ“ä½œï¼Œå› æ­¤è¿™é‡Œéœ€è¦åšä¸€å±‚æ£€æŸ¥ï¼ŒåŒ…æ‹¬ä¸‹æ–¹çš„syncCloseé‡Œçš„æ£€æŸ¥ä¹Ÿæ˜¯ä¸€ä¸ªæ„æ€ return; } DruidConnectionHolder holder = this.holder; //æ‹¿åˆ°å¯¹åº”çš„holderå¯¹è±¡ï¼ˆä¹‹å‰è¯´è¿‡ï¼Œè¿™ä¸ªå¯¹è±¡æ‰æ˜¯æœ€åæ”¾è¿›è¿æ¥æ± çš„å¯¹è±¡ï¼‰ if (holder == null) { if (dupCloseLogEnable) { LOG.error(\"dup close\"); } return; } DruidAbstractDataSource dataSource = holder.getDataSource(); //æ‹¿åˆ°å¯¹åº”çš„è¿æ¥æ± å¯¹è±¡ boolean isSameThread = this.getOwnerThread() == Thread.currentThread(); if (!isSameThread) { //å…³é—­è¯¥è¿æ¥ä¸è·å–è¯¥è¿æ¥çš„çº¿ç¨‹å¹¶éåŒä¸€ä¸ªçš„æ—¶å€™ï¼Œåˆ™è§¦å‘ä¸‹é¢çš„syncClose dataSource.setAsyncCloseConnectionEnable(true); } if (dataSource.isAsyncCloseConnectionEnable()) { syncClose(); //å‚è€ƒä¸Šé¢çš„è§£é‡Šï¼Œè¯¥æ–¹æ³•è¯¦æƒ…åœ¨ä¸‹æ–¹ return; } //ä¸€äº›äº‹ä»¶ç›‘å¬å™¨çš„è§¦å‘ï¼Œå¿½ç•¥ for (ConnectionEventListener listener : holder.getConnectionEventListeners()) { listener.connectionClosed(new ConnectionEvent(this)); } //è´£ä»»é“¾çš„æ‰§è¡Œï¼Œå‚è€ƒæµç¨‹1.1ä¸ä»£ç æ®µ1-2ï¼Œè¿è¡Œæ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œæ‰¾åˆ°æ˜ å°„æ–¹æ³•ï¼Œæ•´ä¸ªè§¦å‘ä¸€éè´£ä»»é“¾ä¸Šçš„filters List filters = dataSource.getProxyFilters(); if (filters.size() &gt; 0) { FilterChainImpl filterChain = new FilterChainImpl(dataSource); filterChain.dataSource_recycle(this); } else { recycle(); //è§¦å‘ç›®æ ‡æ–¹æ³•recycle } this.disable = true; //æ ‡è®°è¯¥è¿æ¥å·²å¤±æ•ˆï¼Œæ— æ³•å†æ¬¡æä¾›æœåŠ¡ } //ä¸Šé¢é€»è¾‘èµ°syncCloseçš„æƒ…å†µï¼Œè¯¥æ–¹æ³•ä¸ä¸Šé¢å¤§ä½“ç›¸åŒï¼Œä½†ç”±äºä¸æ˜¯åŒä¸€ä¸ªçº¿ç¨‹åšçš„æ“ä½œï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦é”æ§åˆ¶ public void syncClose() throws SQLException { lock.lock(); //è·å–é”ï¼Œè¿™ä¸ªé”æ˜¯å½“å‰è¿æ¥å¯¹è±¡ä¸Šçš„é”ï¼Œä¸ºäº†è§£å†³åŒä¸€ä¸ªè¿æ¥å¯¹è±¡åœ¨ä¸åŒçš„çº¿ç¨‹é‡Œè¢«åŒæ—¶closeå¤šæ¬¡è€Œé€ æˆçš„çº¿ç¨‹å®‰å…¨é—®é¢˜ try { if (this.disable) { return; } DruidConnectionHolder holder = this.holder; //åŒæ ·çš„ï¼Œæ‹¿åˆ°éœ€è¦å½’è¿˜çš„holderå¯¹è±¡ if (holder == null) { if (dupCloseLogEnable) { LOG.error(\"dup close\"); } return; } //åŒæ ·æ˜¯ä¸€äº›äº‹ä»¶ç›‘å¬å™¨çš„è§¦å‘ï¼Œå¿½ç•¥ for (ConnectionEventListener listener : holder.getConnectionEventListeners()) { listener.connectionClosed(new ConnectionEvent(this)); } //åŒæ ·çš„è´£ä»»é“¾çš„æ‰§è¡Œï¼Œå‚è€ƒä¸Šé¢çš„è§£é‡Š DruidAbstractDataSource dataSource = holder.getDataSource(); List filters = dataSource.getProxyFilters(); if (filters.size() &gt; 0) { FilterChainImpl filterChain = new FilterChainImpl(dataSource); filterChain.dataSource_recycle(this); } else { recycle(); //è§¦å‘ç›®æ ‡æ–¹æ³•recycleï¼Œæ–¹æ³•è¯¦æƒ…åœ¨ä¸‹æ–¹ } this.disable = true; //æ ‡è®°è¯¥è¿æ¥å·²å¤±æ•ˆï¼Œæ— æ³•å†æ¬¡æä¾›æœåŠ¡ } finally { lock.unlock(); //è§£é” } } //DruidPooledConnectionç±»çš„recycleæ–¹æ³•ï¼Œç”±ä¸Šé¢ä¿©æ–¹æ³•ç›´æ¥è§¦å‘ public void recycle() throws SQLException { if (this.disable) { return; } DruidConnectionHolder holder = this.holder; //æ‹¿åˆ°çœŸæ­£éœ€è¦å½’è¿˜çš„è¿æ¥å¯¹è±¡ if (holder == null) { if (dupCloseLogEnable) { LOG.error(\"dup close\"); } return; } if (!this.abandoned) { //å¦‚æœæœŸé—´å·²ç»è¢«æµç¨‹4.2å¤„ç†è¿‡äº†ï¼ˆabandoned==trueï¼‰ï¼Œåˆ™ä¸è§¦å‘ä¸‹æ–¹é€»è¾‘ DruidAbstractDataSource dataSource = holder.getDataSource(); dataSource.recycle(this); //çœŸæ­£è§¦å‘è¿æ¥æ± çš„å›æ”¶æ–¹æ³•ï¼Œæ–¹æ³•è¯¦æƒ…åœ¨ä¸‹æ–¹ } //è¿æ¥å¯¹è±¡ä¸€æ—¦è¢«å›æ”¶å¤„ç†ï¼Œåˆ™ä¼šæŠŠæ‰€æœ‰ä¸è¿æ¥ç›¸å…³çš„å±æ€§ç½®ç©ºï¼ˆä¸æŒæœ‰ï¼‰ï¼Œclosedæ ‡è®°ä¸ºtrue this.holder = null; conn = null; transactionInfo = null; closed = true; } //DruidDataSourceç±»é‡Œçš„recycleæ–¹æ³•ï¼ŒçœŸæ­£å›æ”¶è¿æ¥çš„æ–¹æ³•ï¼Œç”±ä¸Šé¢DruidPooledConnectionç±»çš„recycleè§¦å‘ protected void recycle(DruidPooledConnection pooledConnection) throws SQLException { final DruidConnectionHolder holder = pooledConnection.holder; if (holder == null) { LOG.warn(\"connectionHolder is null\"); return; } if (logDifferentThread // &amp;&amp; (!isAsyncCloseConnectionEnable()) // &amp;&amp; pooledConnection.ownerThread != Thread.currentThread()// ) { LOG.warn(\"get/close not same thread\"); } final Connection physicalConnection = holder.conn; //æ‹¿åˆ°çœŸæ­£çš„é©±åŠ¨è¿æ¥å¯¹è±¡ if (pooledConnection.traceEnable) { //å¦‚æœtraceEnableä¸ºtrueï¼ˆæ»¡è¶³è¯¥å±æ€§ä¸ºtrueï¼Œå¿…é¡»è¦removeAbandonedè®¾ç½®ä¸ºtrueï¼Œè¿™æ ·åœ¨ä¸»æµç¨‹1é‚£é‡Œæ‰ä¼šè¢«æ”¾è¿›activeConnectionsï¼Œæ‰ä¼šç½®ä¸ºtrueï¼‰ï¼Œæµç¨‹4.2å¤„ç†è¿‡åï¼Œä¼šæŠŠè¯¥å±æ€§é‡æ–°ç½®ä¸ºfalseï¼Œå…¶ä»–æƒ…å†µå‡ä¸ºtrue Object oldInfo = null; activeConnectionLock.lock(); try { if (pooledConnection.traceEnable) { //åŒé‡æ£€æŸ¥ oldInfo = activeConnections.remove(pooledConnection); //ä»activeConnectionsç§»é™¤ï¼Œé˜²æ­¢æµç¨‹4.2çš„é‡å¤æ£€æŸ¥ pooledConnection.traceEnable = false; //ç½®ä¸ºfalse } } finally { activeConnectionLock.unlock(); } if (oldInfo == null) { if (LOG.isWarnEnabled()) { LOG.warn(\"remove abandonded failed. activeConnections.size \" + activeConnections.size()); } } } final boolean isAutoCommit = holder.underlyingAutoCommit; final boolean isReadOnly = holder.underlyingReadOnly; final boolean testOnReturn = this.testOnReturn; try { // å¦‚æœåœ¨å½’è¿˜è‡³è¿æ¥æ± æ—¶å‘ç°æ­¤è¿æ¥å¯¹è±¡è¿˜æœ‰æœªå¤„ç†å®Œçš„äº‹åŠ¡ï¼Œåˆ™ç›´æ¥å›æ»š if ((!isAutoCommit) &amp;&amp; (!isReadOnly)) { pooledConnection.rollback(); } // reset holder, restore default settings, clear warnings boolean isSameThread = pooledConnection.ownerThread == Thread.currentThread(); if (!isSameThread) { //åŒæ ·åˆ¤æ–­çº¿ç¨‹ï¼Œä¸ºäº†ä¿è¯å®‰å…¨æ€§ final ReentrantLock lock = pooledConnection.lock; lock.lock(); try { holder.reset(); //è¿æ¥è¢«å€Ÿå‡ºå»åï¼Œå¯èƒ½è¢«ä¸šåŠ¡æ–¹æ”¹åŠ¨äº†ä¸€äº›å±æ€§ï¼ˆå…¸å‹çš„æ¯”å¦‚autoCommitï¼‰ï¼Œç°åœ¨åˆ©ç”¨resetæ–¹æ³•è¿˜åŸä¸ºé»˜è®¤å€¼ } finally { lock.unlock(); } } else { holder.reset(); //åŒä¸Šï¼Œè¿™é‡Œè®¤ä¸ºè·å–å’Œå…³é—­è¿æ¥çš„æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼Œä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå› æ­¤ä¸ç”¨å»ç«äº‰é” } //è¿æ¥å·²è¢«æŠ›å¼ƒï¼Œåˆ™ä¸ä½œä»»ä½•å¤„ç†ï¼ˆä¸å†å½’è¿˜ï¼‰ if (holder.discard) { return; } //å¿½ç•¥ if (phyMaxUseCount &gt; 0 &amp;&amp; holder.useCount &gt;= phyMaxUseCount) { discardConnection(holder.conn); return; } //å¦‚æœé©±åŠ¨è¿æ¥æœ¬èº«è¢«äººä¸ºå…³é—­äº†ï¼Œé™¤ä¸€äº›ç›‘æ§å€¼ä¹‹å¤–ï¼Œä¹Ÿä¸åšå¤„ç† if (physicalConnection.isClosed()) { lock.lock(); try { activeCount--; closeCount++; } finally { lock.unlock(); } return; } //å‚è€ƒtestOnBorrowï¼Œè¿™é‡ŒtestOnReturnå°±æ˜¯æŒ‡æ¯æ¬¡å›æ”¶è¿æ¥éƒ½è¦åšè¿æ¥å¯ç”¨æ€§æ£€æŸ¥ï¼ŒåŒæ ·å®˜æ–¹ä¸å»ºè®®å¼€å¯ï¼Œå½±å“æ€§èƒ½ï¼Œç¼ºçœå€¼ä¹Ÿæ˜¯ä¸å¼€å¯çš„ if (testOnReturn) { //æµç¨‹å¿½ç•¥ boolean validate = testConnectionInternal(holder, physicalConnection); if (!validate) { JdbcUtils.close(physicalConnection); destroyCountUpdater.incrementAndGet(this); lock.lock(); try { activeCount--; closeCount++; } finally { lock.unlock(); } return; } } if (!enable) { //ä¸­é€”å‘ç°è¿æ¥åˆè¢«ç½®ä¸ºä¸å¯ç”¨ï¼Œåˆ™ç›´æ¥è§¦å‘æŠ›å¼ƒæ–¹æ³•ï¼Œå‚è€ƒæµç¨‹1.4å’Œä»£ç æ®µ1-5 discardConnection(holder.conn); return; } boolean result; final long currentTimeMillis = System.currentTimeMillis(); if (phyTimeoutMillis &gt; 0) { long phyConnectTimeMillis = currentTimeMillis - holder.connectTimeMillis; if (phyConnectTimeMillis &gt; phyTimeoutMillis) { discardConnection(holder.conn); return; } } lock.lock(); try { activeCount--; closeCount++; //æœ€ç»ˆæ”¾å…¥æ± å­ï¼Œæ–¹æ³•è¯¦æƒ…åœ¨ä¸‹æ–¹ result = putLast(holder, currentTimeMillis); recycleCount++; } finally { lock.unlock(); } if (!result) { //å¦‚æœåŠ ä¸è¿›å»ï¼Œåˆ™ç›´æ¥å…³é—­é©±åŠ¨è¿æ¥ï¼Œç„¶åä¸å¤„ç†ï¼ˆæ­¤æ—¶holderå·²ç»å¤±å»å¼ºå¼•ç”¨ï¼Œä¸ä¹…ä¾¿ä¼šè¢«å›æ”¶ï¼‰ JdbcUtils.close(holder.conn); LOG.info(\"connection recyle failed.\"); } } catch (Throwable e) { holder.clearStatementCache(); if (!holder.discard) { this.discardConnection(physicalConnection); holder.discard = true; } LOG.error(\"recyle error\", e); recycleErrorCountUpdater.incrementAndGet(this); } } //DruidDataSourceç±»é‡Œçš„putLastæ–¹æ³•ï¼Œç”±ä¸Šæ–¹çš„recycleæ–¹æ³•è§¦å‘ boolean putLast(DruidConnectionHolder e, long lastActiveTimeMillis) { if (poolingCount &gt;= maxActive) { //æ± å­å·²æ»¡ï¼Œä¸åŠ  return false; } e.lastActiveTimeMillis = lastActiveTimeMillis; //åˆ·æ–°ä¸Šæ¬¡æ´»è·ƒæ—¶é—´ï¼Œè¯¥æ—¶é—´å¾ˆé‡è¦ï¼Œç›´æ¥å½±å“è¿æ¥æ£€æŸ¥çš„è§¦å‘ connections[poolingCount] = e; //æ”¾è¿›è¿æ¥æ± æ•°ç»„å°¾éƒ¨ incrementPoolingCount(); //poolingCount++ if (poolingCount &gt; poolingPeak) { poolingPeak = poolingCount; poolingPeakTime = lastActiveTimeMillis; } notEmpty.signal(); //å› ä¸ºæˆåŠŸå›æ”¶äº†ä¸€ä¸ªè¿æ¥ï¼Œé‚£å°±å”¤èµ·ä¸€æ¬¡æ‰€æœ‰å› ä¸ºè·å–ä¸åˆ°è¿æ¥è€Œè¢«é˜»å¡çš„ä¸šåŠ¡çº¿ç¨‹å§~ï¼ˆå‚è€ƒæµç¨‹1.2ï¼‰ notEmptySignalCount++; return true; } è¿™ä¹Ÿæ˜¯éå¸¸é‡è¦çš„ä¸€ä¸ªæµç¨‹ï¼Œè¿æ¥ç”¨å®Œè¦å½’è¿˜ï¼Œå°±æ˜¯åˆ©ç”¨è¯¥æµç¨‹å®Œæˆå½’è¿˜çš„åŠ¨ä½œï¼Œåˆ©ç”¨druidå¯¹å¤–åŒ…è£…çš„ConnecionåŒ…è£…ç±»DruidPooledConnectionçš„closeæ–¹æ³•è§¦å‘ï¼Œè¯¥æ–¹æ³•ä¼šé€šè¿‡è‡ªå·±å†…éƒ¨çš„closeæˆ–è€…syncCloseæ–¹æ³•æ¥é—´æ¥è§¦å‘dataSourceå¯¹è±¡çš„recycleæ–¹æ³•ï¼Œä»è€Œè¾¾åˆ°å›æ”¶çš„ç›®çš„ã€‚ æœ€ç»ˆçš„recycleæ–¹æ³•ï¼š å¦‚æœremoveAbandonedè¢«è®¾ç½®ä¸ºtrueï¼Œåˆ™é€šè¿‡traceEnableåˆ¤æ–­æ˜¯å¦éœ€è¦ä»activeConnectionsç§»é™¤è¯¥è¿æ¥å¯¹è±¡ï¼Œé˜²æ­¢æµç¨‹4.2å†æ¬¡æ£€æµ‹åˆ°è¯¥è¿æ¥å¯¹è±¡ï¼Œå½“ç„¶å¦‚æœæ˜¯æµç¨‹4.2ä¸»åŠ¨è§¦å‘çš„è¯¥æµç¨‹ï¼Œé‚£ä¹ˆæ„å‘³ç€æµç¨‹4.2é‡Œå·²ç»removeè¿‡è¯¥å¯¹è±¡äº†ï¼ŒtraceEnableä¼šè¢«ç½®ä¸ºfalseï¼Œæœ¬æµç¨‹å°±ä¸å†è§¦å‘removeäº†ï¼ˆè¿™ä¸ªæµç¨‹éƒ½æ˜¯åœ¨removeAbandoned=trueçš„æƒ…å†µä¸‹è¿›è¡Œçš„ï¼Œåœ¨ä¸»æµç¨‹1é‡Œè¿æ¥è¢«æ”¾è¿›activeConnectionsæ—¶traceEnableè¢«ç½®ä¸ºtrueï¼Œè€Œåœ¨removeAbandoned=falseçš„æƒ…å†µä¸‹traceEnableæ’ç­‰äºfalseï¼‰ã€‚ å¦‚æœå›æ”¶è¿‡ç¨‹ä¸­å‘ç°å­˜åœ¨æœ‰æœªå¤„ç†å®Œçš„äº‹åŠ¡ï¼Œåˆ™è§¦å‘å›æ»šï¼ˆæ¯”è¾ƒæœ‰å¯èƒ½è§¦å‘è¿™ä¸€æ¡çš„æ˜¯æµç¨‹4.2é‡Œå¼ºåˆ¶å½’è¿˜è¿æ¥ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å•çº¯ä½¿ç”¨è¿æ¥ï¼Œå¼€å¯äº‹åŠ¡å´æ²¡æœ‰æäº¤äº‹åŠ¡å°±ç›´æ¥closeçš„æƒ…å†µï¼‰ï¼Œç„¶ååˆ©ç”¨holder.resetè¿›è¡Œæ¢å¤è¿æ¥å¯¹è±¡é‡Œä¸€äº›å±æ€§çš„é»˜è®¤å€¼ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œholderå¯¹è±¡è¿˜ä¼šæŠŠç”±å®ƒäº§ç”Ÿçš„statementå¯¹è±¡æ”¾åˆ°è‡ªå·±çš„ä¸€ä¸ªarraylisté‡Œé¢ï¼Œresetæ–¹æ³•ä¼šå¾ªç¯ç€å…³é—­å†…éƒ¨æœªå…³é—­çš„statementå¯¹è±¡ï¼Œæœ€åæ¸…ç©ºlistï¼Œå½“ç„¶ï¼Œstatementå¯¹è±¡è‡ªå·±ä¹Ÿä¼šè®°å½•ä¸‹å…¶äº§ç”Ÿçš„æ‰€æœ‰çš„resultSetå¯¹è±¡ï¼Œç„¶åå…³é—­statementæ—¶åŒæ ·ä¹Ÿä¼šå¾ªç¯å…³é—­å†…éƒ¨æœªå…³é—­çš„resultSetå¯¹è±¡ï¼Œè¿™æ˜¯è¿æ¥æ± åšçš„ä¸€ç§ä¿æŠ¤æªæ–½ï¼Œé˜²æ­¢ç”¨æˆ·æ‹¿ç€è¿æ¥å¯¹è±¡åšå®Œä¸€äº›æ“ä½œæ²¡æœ‰å¯¹æ‰“å¼€çš„èµ„æºå…³é—­ã€‚ åˆ¤æ–­æ˜¯å¦å¼€å¯testOnReturnï¼Œè¿™ä¸ªè·ŸtestOnBorrowä¸€æ ·ï¼Œå®˜æ–¹é»˜è®¤ä¸å¼€å¯ï¼Œä¹Ÿä¸å»ºè®®å¼€å¯ï¼Œå½±å“æ€§èƒ½ï¼Œç†ç”±å‚è€ƒä¸»æµç¨‹1é‡Œé’ˆå¯¹testOnBorrowçš„è§£é‡Šã€‚ ç›´æ¥æ”¾å›æ± å­ï¼ˆå½“å‰connectionsçš„å°¾éƒ¨ï¼‰ï¼Œç„¶åéœ€è¦æ³¨æ„çš„æ˜¯putLastæ–¹æ³•å’Œputæ–¹æ³•çš„ä¸åŒä¹‹å¤„ï¼ŒputLastä¼šæŠŠlastActiveTimeMillisç½®ä¸ºå½“å‰æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ç®¡ä¸€ä¸ªè¿æ¥è¢«å€Ÿå‡ºå»è¿‡ä¹…ï¼Œåªè¦å½’è¿˜äº†ï¼Œæœ€åæ´»è·ƒæ—¶é—´å°±æ˜¯å½“å‰æ—¶é—´ï¼Œè¿™å°±ä¼šæœ‰é€ æˆæŸç§ç‰¹æ®Šå¼‚å¸¸æƒ…å†µçš„å‘ç”Ÿï¼ˆéå¸¸æç«¯ï¼Œå‡ ä¹ä¸ä¼šè§¦å‘ï¼Œå¯ä»¥é€‰æ‹©ä¸çœ‹ï¼‰ï¼š å¦‚æœä¸å¼€å¯testOnBorrowå’ŒtestOnReturnï¼Œå¹¶ä¸”keepAliveè®¾ç½®ä¸ºfalseï¼Œé‚£ä¹ˆé•¿è¿æ¥å¯ç”¨æµ‹è¯•çš„é—´éš”ä¾æ®å°±æ˜¯åˆ©ç”¨å½“å‰æ—¶é—´å‡å»ä¸Šæ¬¡æ´»è·ƒæ—¶é—´ï¼ˆlastActiveTimeMillisï¼‰å¾—å‡ºé—²ç½®æ—¶é—´ï¼Œç„¶åå†åˆ©ç”¨é—²ç½®æ—¶é—´è·ŸtimeBetweenEvictionRunsMillisï¼ˆé»˜è®¤60sï¼‰è¿›è¡Œå¯¹æ¯”ï¼Œè¶…è¿‡æ‰è¿›è¡Œé•¿è¿æ¥å¯ç”¨æµ‹è¯•ã€‚ é‚£ä¹ˆå¦‚æœä¸€ä¸ªmysqlæœåŠ¡ç«¯çš„é•¿è¿æ¥ä¿æ´»æ—¶é—´è¢«äººä¸ºè°ƒæ•´ä¸º60sï¼Œç„¶åtimeBetweenEvictionRunsMillisè¢«è®¾ç½®ä¸º59sï¼Œè¿™ä¸ªè®¾ç½®æ˜¯éå¸¸åˆç†çš„ï¼Œä¿è¯äº†æµ‹è¯•é—´éš”å°äºé•¿è¿æ¥å®é™…ä¿æ´»æ—¶é—´ï¼Œç„¶åå¦‚æœè¿™æ—¶ä¸€ä¸ªè¿æ¥è¢«æ‹¿å‡ºå»åä¸€ç›´è¿‡äº†61sæ‰è¢«closeå›æ”¶ï¼Œè¯¥è¿æ¥å¯¹è±¡çš„lastActiveTimeMillisè¢«åˆ·ä¸ºå½“å‰æ—¶é—´ï¼Œå¦‚æœåœ¨59så†…å†æ¬¡æ‹¿åˆ°è¯¥è¿æ¥å¯¹è±¡ï¼Œå°±ä¼šç»•è¿‡è¿æ¥æ£€æŸ¥ç›´æ¥æŠ¥è¿æ¥ä¸å¯ç”¨çš„é”™è¯¯ã€‚ åã€å°¾å£°åˆ°è¿™é‡Œé’ˆå¯¹druidè¿æ¥æ± çš„åˆå§‹åŒ–ä»¥åŠå…¶å†…éƒ¨ä¸€ä¸ªè¿æ¥ä»ç”Ÿäº§åˆ°æ¶ˆäº¡çš„æ•´ä¸ªæµç¨‹å°±å·²ç»æ•´ç†å®Œäº†ï¼Œä¸»è¦æ˜¯åˆ—å‡ºå…¶è¿è¡Œæµç¨‹ä»¥åŠä¸€äº›ä¸»è¦çš„ç›‘æ§æ•°æ®éƒ½æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Œæ²¡æœ‰æ¶‰åŠåˆ°çš„æ˜¯ä¸€ä¸ªsqlçš„æ‰§è¡Œï¼Œå› ä¸ºè¿™ä¸ªåŸºæœ¬ä¸Šå°±è·Ÿä½¿ç”¨åŸç”Ÿé©±åŠ¨ç¨‹åºå·®ä¸å¤šï¼Œåªæ˜¯druidåˆåŒ…è£…äº†ä¸€å±‚Statementç­‰ï¼Œç”¨äºå®Œæˆä¸€äº›è‡ªå·±çš„æ“ä½œã€‚ å¯¹äºdruidï¼Œå¤„ç†è¿æ¥åªæ˜¯å¾ˆå°çš„ä¸€å—å†…å®¹ï¼Œå´æ˜¯å¾ˆæ ¸å¿ƒçš„ä¸€å—å†…å®¹ã€‚ Druidåœ°å€ï¼šhttps://github.com/alibaba/druid","link":"/2019/08/28/%E6%B1%A0%E5%8C%96%E6%8A%80%E6%9C%AF%EF%BC%88%E4%B8%80%EF%BC%89Druid%E6%98%AF%E5%A6%82%E4%BD%95%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E7%9A%84%EF%BC%9F/"},{"title":"åˆ©ç”¨Springçš„BeanPostProcessoræ¥ä¿®æ”¹beanå±æ€§","text":"ä¸€ã€å…³äºBeanPostProcessor1.1ï¼šå®ƒæ˜¯ä»€ä¹ˆï¼Ÿé¦–å…ˆå®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼š 1234567891011public interface BeanPostProcessor { @Nullable //æ‰€æœ‰beanåˆå§‹åŒ–ä¹‹å‰è§¦å‘è¯¥æ–¹æ³• default Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException { return bean; } @Nullable //æ‰€æœ‰beanåˆå§‹åŒ–ä¹‹åè§¦å‘è¯¥æ–¹æ³• default Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException { return bean; }} ä»£ç å—1 å®ƒå®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ï¼š postProcessBeforeInitializationï¼šbeanåˆå§‹åŒ–å‰ç½®å¤„ç† postProcessAfterInitializationï¼šbeanåˆå§‹åŒ–åç½®å¤„ç† âš™ï¸ æ³¨ï¼šè¿™é‡Œçš„åˆå§‹åŒ–æ˜¯æŒ‡ä¸€ä¸ªè¢«å®ä¾‹åŒ–åçš„beançš„å®Œæˆå…¶ä¸€äº›åˆå§‹åŒ–æ–¹æ³•çš„è°ƒç”¨ï¼ˆæœ€åŸºæœ¬çš„å°±æ˜¯é€šè¿‡@PostConstructé¢„è®¾çš„åˆå§‹åŒ–æ–¹æ³•ï¼‰ï¼Œä¸Šé¢ä¸¤ä¸ªæ–¹æ³•çš„beforeå’Œafterå°±æ˜¯é’ˆå¯¹è¿™ä¸ªçŠ¶æ€æ¥åŒºåˆ†è§¦å‘æ—¶æœºçš„ã€‚ æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå®ç°äº†è¯¥æ¥å£çš„beanï¼Œæ¥è¾¾åˆ°å¯¹å…¶ä»–beanåšä¸€äº›åˆå§‹åŒ–å‰åè¦åšçš„äº‹æƒ…ã€‚ 1.2ï¼šä»€ä¹ˆæ—¶å€™è§¦å‘ï¼Ÿé¦–å…ˆçœ‹ä¸‹spring beansçš„ç”Ÿå‘½å‘¨æœŸï¼ˆå›¾ç‰‡æ¥æºäºç½‘ç»œï¼‰ï¼š ä¸Šå›¾ä¸­æ ‡çº¢çš„ä½ç½®å°±æ˜¯BeanPostProcessorä¸¤ä¸ªæ–¹æ³•çš„è§¦å‘ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°è¿™äº›æ–¹æ³•çš„è§¦å‘æ˜¯åœ¨åˆå§‹åŒ–é˜¶æ®µã€‚ é‚£ä¹ˆï¼Œå¦‚ä½•å®šä¹‰ä¸€ä¸ªç±»ä¼¼çš„beançš„åˆå§‹åŒ–é˜¶æ®µçš„åç½®å¤„ç†å™¨å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œè®©ä¸€ä¸ªbeanå®ç°BeanPostProcessoræ¥å£å¹¶é‡å†™å…¶beforeã€afteræ–¹æ³•å³å¯ï¼Œå¯ä»¥æå¾ˆå¤šä¸ªè¿™æ ·çš„beanï¼Œè§¦å‘è¿‡ç¨‹å°±æ˜¯ï¼Œå®¹å™¨é‡Œçš„ä»»ä½•beanåœ¨å®ä¾‹åŒ–ååˆå§‹åŒ–å‰ï¼Œéƒ½ä¼šè§¦å‘ä¸€æ¬¡æ‰€æœ‰å®ç°äº†BeanPostProcessoræ¥å£çš„beançš„beforeæ–¹æ³•ï¼Œåˆå§‹åŒ–ä»¥åéƒ½ä¼šè§¦å‘ä¸€æ¬¡æ‰€æœ‰å®ç°äº†BeanPostProcessoræ¥å£çš„beançš„afteræ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œspringåœ¨å¯åŠ¨æ—¶ï¼Œä¼šé¢„å…ˆåŠ è½½å®ç°äº†è¯¥æ¥å£çš„å¯¹è±¡ï¼ˆé€šè¿‡registerBeanPostProcessorsæ–¹æ³•æ³¨å†Œè¿™ç±»beanï¼‰ï¼Œè¿™æ ·ï¼Œå…¶ä»–ä»»ä½•beanåœ¨åˆå§‹åŒ–æ—¶ï¼Œéƒ½å¯ä»¥é€šè¿‡ä¹‹å‰å·²ç»åŠ è½½å¥½çš„é€»è¾‘ï¼Œé€ä¸ªè§¦å‘ä¸€éï¼ˆå½“ç„¶å¦‚æœæƒ³è¦ä¿è¯å®ç°é¡ºåºï¼Œè¿˜å¯ä»¥é€šè¿‡å®ç°Orderæ¥å£ï¼Œæ¥å®šä¹‰è§¦å‘é¡ºåºï¼‰ã€‚ 1.3ï¼šå¯ä»¥ç”¨æ¥åšä»€ä¹ˆï¼Ÿäº†è§£äº†å®ƒçš„è§¦å‘æ—¶æœºï¼Œé‚£ä¹ˆå®ƒé€šå¸¸å¯ä»¥ç”¨æ¥åšå“ªäº›äº‹æƒ…å‘¢ï¼Ÿä¸€èˆ¬æ¥è¯´ï¼Œå¯ä»¥åˆ©ç”¨å…¶åšä¸€äº›é€šç”¨æ€§çš„beanå±æ€§æ³¨å…¥ï¼Œä¸‹é¢é€šè¿‡ä¸€ä¸ªå®ä¾‹æ¥è¯´ä¸‹å…¶åº”ç”¨æ–¹å¼å’Œåœºæ™¯ã€‚ äºŒã€ä½¿ç”¨æ–¹å¼å®æˆ˜ä¸€ä¸‹ï¼Œç»™ç›®å‰é¡¹ç›®å†…æ‰€æœ‰çš„SqlSessionFactoryå¯¹è±¡éƒ½åŠ ä¸€ä¸ªæ‹¦æˆªå™¨ã€‚ 2.1ï¼šå®šä¹‰ä¸€ä¸ªMybatisæ‹¦æˆªå™¨ç°åœ¨æ¥å®šä¹‰ä¸€ä¸ªMybatisé‡Œçš„æ‹¦æˆªå™¨ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ç®€å•æ‹¿åˆ°sqlï¼Œç„¶åæ‰“å°å‡ºè¯¥sqlæ‰§è¡Œè€—æ—¶ï¼š 12345678910111213141516171819202122232425262728293031323334@Slf4j@Intercepts({@Signature(type = StatementHandler.class, method = \"query\", args = {Statement.class, ResultHandler.class}), @Signature(type = StatementHandler.class, method = \"update\", args = {Statement.class}), @Signature(type = StatementHandler.class, method = \"batch\", args = {Statement.class})})public class SqlInterceptor implements Interceptor { @Override public Object intercept(Invocation invocation) throws Throwable { //æ‹¦æˆªæ¯æ¬¡çš„sqlæ‰§è¡Œ Object target = invocation.getTarget(); StatementHandler statementHandler = (StatementHandler) target; BoundSql boundSql = statementHandler.getBoundSql(); String sql = boundSql.getSql(); //è·å–sql long start = System.currentTimeMillis(); try { return invocation.proceed(); //sqlè¿è¡Œ } catch (Throwable t) { System.out.println(String.format(\"é”™è¯¯SQL=%s\", sql)); throw t; } finally { System.out.println(String.format(\"è€—æ—¶%s ms, SQL=%s\", (System.currentTimeMillis() - start), sql)); } } @Override public Object plugin(Object target) { return Plugin.wrap(target, this); } @Override public void setProperties(Properties properties) { }} ä»£ç å—2 Mybatisçš„æ‹¦æˆªå™¨éœ€è¦é¢„å…ˆå¾€SqlSessionFactoryè®¾ç½®ï¼š 12345678@Bean(name = \"sqlSession\") public SqlSessionFactory sqlSession(@Qualifier(\"dataSource\") DataSource dataSource) throws Exception { SqlSessionFactoryBean bean = new SqlSessionFactoryBean(); bean.setDataSource(dataSource); bean.setVfs(SpringBootVFS.class); bean.getObject().getConfiguration().addInterceptor(new SqlInterceptor()); //æ‰‹åŠ¨åŠ å…¥ return bean.getObject(); } ä»£ç å—3 2.2ï¼šå€ŸåŠ©BeanPostProcessoræ“ä½œç›¸å…³Beanè¿™æ—¶é¡¹ç›®æ¨¡å—å¦‚æœå¾ˆå¤šï¼Œä½†æ˜¯è¿™ä¸ªæ‹¦æˆªå™¨åˆè¦æ±‚å¯¹æ‰€æœ‰é¡¹ç›®æ‰€æœ‰çš„SqlSessionFactoryéƒ½ç”Ÿæ•ˆï¼Œä¸€ä¸ªä¸ªå»æ”¹æ¯ä¸ªé¡¹ç›®é‡Œçš„SqlSessionFactoryç±»å‹çš„beanå¤ªè¿‡ç¹çï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥åœ¨å…¬å…±æ¨¡å—é‡Œå®šä¹‰ä¸€ä¸ªBeanPostProcessorå»å¹²è¿™ä»¶äº‹ï¼Œæ¯”å¦‚å¯ä»¥å®šä¹‰æˆä¸‹é¢è¿™æ ·ï¼š 123456789101112131415@Slf4jpublic class SqlSessionFactoryBeanPostProcessor implements BeanPostProcessor { @Override public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException { if (bean instanceof SqlSessionFactory) { //æ‰€æœ‰beanåˆå§‹åŒ–ä¹‹åéƒ½ä¼šè¿›å…¥è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æ»¤å‡ºéœ€è¦çš„ç±»å‹ï¼Œæ¯”å¦‚è¿™æ¬¡å°±åªéœ€è¦æ‹¿åˆ°SqlSessionFactoryç±»å‹çš„å¯¹è±¡å¯¹å…¶è®¾ç½®æ‹¦æˆªå™¨å°±è¡Œäº† SqlSessionFactory nowBean = (SqlSessionFactory) bean; nowBean.getConfiguration().addInterceptor(new SqlInterceptor(nowBean //è®¾ç½®æ‹¦æˆªå™¨ .getConfiguration() .getEnvironment() .getDataSource())); } return bean; //å®Œæˆåè¿”å›å‡ºå»ï¼Œå¯èƒ½ç›´æ¥è¿›å…¥å®¹å™¨ï¼Œä¹Ÿå¯èƒ½ä¼šå»æ‰§è¡Œå…¶ä»–çš„BeanPostProcessor }} ä»£ç å—4 ç„¶åå†æŠŠå®ƒä¹Ÿå®šä¹‰æˆä¸€ä¸ªbeanï¼Œå…¶æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªbeanï¼Œæ‰èƒ½è¢«springæ‰«åˆ°å»è£…è½½ï¼Œå¦åˆ™åªæ˜¯å®ç°BeanPostProcessoræ¥å£springæ˜¯æ²¡åŠæ³•å¯Ÿè§‰åšç®¡ç†çš„ï¼š 1234567@ConditionalOnClass({SqlSessionFactory.class}) //å­˜åœ¨SqlSessionFactoryç±»å‹æ—¶ï¼Œæ‰ä¼šè§¦å‘ä¸‹é¢beançš„è£…è½½public class MysqlAutoConfiguration { @Bean public SqlSessionFactoryBeanPostProcessor sqlSessionFactoryBeanPostProcessor() { return new SqlSessionFactoryBeanPostProcessor(); }} ä»£ç å—5 è¿™æ ·å†™å®Œï¼Œå°±ä¸ç”¨å»ä¸€ä¸ªä¸ªçš„æ”¹SqlSessionFactoryå¯¹è±¡äº†ï¼Œåªè¦å¼•å…¥è¯¥å…¬å…±æ¨¡å—ï¼Œé‚£ä¹ˆåœ¨beanåˆå§‹åŒ–å®Œæˆåï¼Œå°±ä¼šèµ°è¿™æ®µé€»è¾‘ï¼Œç„¶åæ»¤å‡ºè‡ªå·±éœ€è¦çš„ç±»å‹ï¼Œå¯¹å…¶è¿›è¡Œä¿®æ”¹å°±å¥½ï¼Œè¿™æ ·ï¼Œæ‰€æœ‰SqlSessionFactoryå°±åœ¨ä¸ä¿®æ”¹åˆ«çš„åœ°æ–¹åˆå§‹åŒ–SqlSessionFactoryä»£ç çš„æƒ…å†µä¸‹ï¼Œå…¨å±€ç”Ÿæ•ˆäº†ã€‚","link":"/2019/07/16/%E5%88%A9%E7%94%A8Spring%E7%9A%84BeanPostProcessor%E6%9D%A5%E4%BF%AE%E6%94%B9bean%E5%B1%9E%E6%80%A7/"},{"title":"InfluxDBï¼ˆä¸€ï¼‰åˆæ¢æ—¶åºæ•°æ®åº“","text":"æœ€è¿‘å…¬å¸æœ‰ä¸ªéœ€æ±‚éœ€è¦å€ŸåŠ©InfluxDBå®ç°ï¼ˆæˆ–è€…æ›´å‡†ç¡®çš„è¯´ï¼Œä½¿ç”¨è¯¥æ•°æ®åº“å¯ä»¥æ›´å®¹æ˜“çš„å®ç°ï¼‰ï¼Œå› æ­¤ç¨å¾®çœ‹äº†ä¸‹è¿™ä¸ªæ•°æ®åº“ï¼ŒæŠŠæ¯”è¾ƒé‡è¦çš„ä¸€äº›ä¸œè¥¿å…ˆç®€å•è®°å½•ä¸€ä¸‹ï¼Œæ—¥åå¦‚æœè¸©å‘ï¼Œä¹Ÿä¼šç»§ç»­åœ¨ä¸‹é¢è¡¥å……ã€‚ é›¶ã€ä¸‹è½½&amp;å®‰è£…å®˜æ–¹åœ°å€ï¼šhttps://portal.influxdata.com/downloads/ ä¸€ã€ä»€ä¹ˆæ˜¯æ—¶åºæ•°æ®åº“ï¼Œå®ƒå¯ä»¥ç”¨æ¥åšä»€ä¹ˆï¼Ÿç®€å•æ¥è¯´æ—¶åºæ•°æ®åº“å°±æ˜¯å­˜å‚¨å¸¦æœ‰æ—¶é—´æˆ³ä¸”åŒ…å«éšæ—¶é—´å‘ç”Ÿå˜åŒ–çš„æ•°æ®ï¼ŒInfluxDBå±äºä¸€ç§æ—¶åºæ•°æ®åº“ã€‚è¿™ç±»æ•°æ®å…·ä½“æŒ‡ä»€ä¹ˆæ•°æ®å‘¢ï¼Ÿè¿™é‡Œä¸¾å‡ ä¸ªä¾‹å­ï¼š ç›‘æ§ï¼Œæ¯”å¦‚æŸä¸€æ—¶æ®µCPUå ç”¨ç‡ã€æœåŠ¡QPSã€æœåŠ¡è€—æ—¶ç­‰ç›‘æ§æ•°æ® æŸé£æœºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­å„æ—¶åˆ»çš„é«˜åº¦ã€é€Ÿåº¦ã€æœºèˆ±å†…æ¸©åº¦ã€æ¹¿åº¦ æŸåœ°åŒºæ¯æ—¶æ¯åˆ»çš„å®¤å¤–æ¸©åº¦è®°å½• ä¸Šè¿°çš„æ•°æ®éƒ½æ»¡è¶³æŸä¸€ä¸ªå…·ä½“çš„äº‹ç‰©ï¼ˆç›‘æ§æŒ‡æ ‡ã€é£æœºã€åœ°åŒºï¼‰éšç€æ—¶é—´çš„å˜åŒ–è€Œéœ€è¦è®°å½•çš„ä¸€äº›æ•°æ®ï¼ˆç›‘æ§æ•°æ®ã€é€Ÿåº¦ã€æ¸©åº¦ç­‰ï¼‰ï¼Œè¿™äº›æ•°æ®è¢«ç§°ä¸ºæ—¶åºæ€§æ•°æ®ï¼Œè¿™äº›æ•°æ®å¯ä»¥è¢«ç”¨æ¥åšå¤§æ•°æ®åˆ†æã€äººå·¥æ™ºèƒ½ç­‰ã€‚ â“ ç–‘é—®ç‚¹ï¼šé€šè¿‡ä¸Šè¿°çš„ä¾‹å­ï¼Œè¿™äº›æ— éæ˜¯ä¸€äº›æŒ‡æ ‡æ•°æ®å˜›ï¼Œä¸ºä»€ä¹ˆéå¾—ç”¨æ—¶åºæ€§æ•°æ®åº“è®°å½•ï¼Ÿä¸å¯ä»¥ç”¨Mysqlè¿™ç§å…³ç³»å‹æ•°æ®åº“æ¥åšå—ï¼Ÿ ä¸å¯ä»¥ï¼Œé¦–å…ˆå¯¹äºè¿™ç§æ•°æ®ï¼Œé‡çº§ä¸Šæ˜¯å·¨å¤§çš„ï¼Œæ¯”å¦‚æ¯æ—¶æ¯åˆ»éƒ½è¦è®°å½•æŸé£æœºçš„åæ ‡å˜åŒ–ï¼Œç±»ä¼¼è¿™ç§æŒ‡æ ‡ï¼Œé‡çº§å¾ˆåºå¤§ï¼Œå…³ç³»å‹æ•°æ®åº“è®¾è®¡ä¹‹åˆå¹¶ä¸æ˜¯ä¸ºäº†å¤„ç†è¿™ç§å¤§æ•°æ®é‡çº§çš„ï¼Œå³ä¾¿æ˜¯åæ¥çš„åˆ†è¡¨åˆ†åº“ï¼Œä¹Ÿæ˜¯ä¸ºäº†ä¼˜åŒ–æ•°æ®é‡å’Œè®¿é—®é‡å¤§äº†ä»¥åæŸ¥è¯¢å’Œå†™å…¥æ€§èƒ½é—®é¢˜çš„ï¼Œæ‰€ä»¥ä¸é€‚åˆç”¨æ¥å­˜å‚¨æ•°é‡å¦‚æ­¤åºå¤§çš„æ•°æ®ï¼Œæ‰€ä»¥è¿™å¹¶ä¸æ˜¯èƒ½ä¸èƒ½å®ç°çš„é—®é¢˜ï¼Œè€Œæ˜¯é€‚ä¸é€‚åˆçš„é—®é¢˜ï¼Œè€Œæ—¶åºå‹æ•°æ®åº“çš„å†™å…¥é€Ÿåº¦éå¸¸å¿«ï¼Œå…¶æ¬¡å†…éƒ¨è¿˜ä¼šå¯¹å­˜å‚¨æ•°æ®è¿›è¡Œå‹ç¼©ï¼ŒåŒæ—¶æä¾›äº†æ›´é«˜çš„å¯ç”¨æ€§ï¼Œæ¯”å¦‚æ•°æ®ä¿ç•™ç­–ç•¥ã€æ•°æ®èšåˆå‡½æ•°ã€è¿ç»­æŸ¥è¯¢ç­‰ã€‚æ•°æ®ä¿ç•™ç­–ç•¥å¯ä»¥ä¿è¯è¶…è¿‡æŒ‡å®šæœŸé™çš„æ•°æ®è¢«å›æ”¶ï¼Œé‡Šæ”¾ç£ç›˜ç©ºé—´ã€‚ äºŒã€InfluxDBåŸºæœ¬æ¦‚å¿µ2.1ï¼šå»ºè¡¨ä¸éœ€è¦ä¸“é—¨å»ºè¡¨ï¼Œä¸€èˆ¬insertæ‰§è¡Œè¿‡å»æ—¶ï¼Œå¦‚æœå‘ç°è¡¨ä¸å­˜åœ¨ï¼Œå°±è‡ªåŠ¨åˆ›å»ºã€‚ 2.2ï¼šåŸºæœ¬æ¦‚å¿µä¸mysqlä¸­æ¦‚å¿µçš„å¯¹åº”å…³ç³» æ¦‚å¿µåç§° æ¦‚å¿µè§£é‡Š MySQLç±»æ¯” database æ•°æ®åº“ ç±»ä¼¼mysqlé‡Œçš„åº“ measurement è¡¨ ç±»ä¼¼mysqlé‡Œçš„è¡¨ point ä¸€è¡Œæ•°æ®è®°å½• ç±»ä¼¼mysqlé‡Œçš„ä¸€è¡Œæ•°æ® è¡¨1 2.3ï¼špointè¯¦è§£pointçš„æ¦‚å¿µå°±ç±»ä¼¼äºmysqlé‡Œä¸€è¡Œæ•°æ®ï¼ˆdata pointï¼Œç›´è¯‘ä¸ºæ•°æ®ç‚¹ï¼Œå¯ä»¥ç†è§£æˆä¸€è¡Œæ•°æ®ï¼‰ï¼Œpointçš„æ„æˆéƒ¨åˆ†æœ‰ä¸‰ä¸ªï¼š pointå±æ€§ å±æ€§è§£é‡Š å¤‡æ³¨ time æ—¶é—´æˆ³ influxdbè‡ªå¸¦å­—æ®µï¼Œå•ä½ï¼šçº³ç§’ tags æœ‰å„ç§ç´¢å¼•çš„å±æ€§ å¯è®¾ç½®å¤šä¸ªï¼Œé€—å·éš”å¼€ fields æ²¡æœ‰ç´¢å¼•çš„å±æ€§ å¯è®¾ç½®å¤šä¸ªï¼Œé€—å·éš”å¼€ è¡¨2 tagså’Œfiledsçš„åŒºåˆ«ï¼š 121. fieldæ— ç´¢å¼•ï¼Œä¸€èˆ¬è¡¨ç¤ºä¼šéšç€æ—¶é—´æˆ³è€Œå‘ç”Ÿæ”¹å˜çš„å±æ€§ï¼Œæ¯”å¦‚æ¸©åº¦ã€ç»çº¬åº¦ç­‰ï¼Œç±»å‹å¯ä»¥æ˜¯ string, float, int, bool2. tagæœ‰ç´¢å¼•ï¼Œä¸€èˆ¬è¡¨ç¤ºä¸ä¼šéšç€æ—¶é—´æˆ³è€Œå‘ç”Ÿæ”¹å˜çš„å±æ€§ï¼Œæ¯”å¦‚åŸå¸‚ã€ç¼–å·ç­‰ï¼Œç±»å‹åªå¯ä¸º string æ¯”è¾ƒå€¼å¾—æ³¨æ„çš„æ˜¯ï¼šåœ¨InfluxDBä¸­ï¼Œtagså†³å®šäº†seriesçš„æ•°é‡ï¼Œè€Œseriesçš„æ•°é‡è¶Šå¤§ï¼Œå¯¹äºç³»ç»ŸCPUå’ŒInfluxDBçš„æ€§èƒ½å½±å“è¶Šå¤§ï¼Œseriesä¼°ç®—æ–¹æ³•ä¸‹é¢ä¼šè¯´ã€‚ 2.4ï¼šsqlè¯­å¥ç¤ºèŒƒå»ºåº“ï¼š 1create database \"åº“å\" ä¸€èˆ¬æ¥è¯´ï¼Œæ–°å»ºå®Œåº“ï¼Œè¿˜è¦å¯¹è¯¥åº“è®¾ç½®è‡ªå·±çš„æ—¶æ•ˆç­–ç•¥ï¼ˆRPï¼‰ï¼Œä¸‹é¢ä¼šè¯¦ç»†è¯´æ˜RPçš„è®¾ç½®æ–¹æ³•ï¼Œä¸€èˆ¬å»ºå¥½åº“åéƒ½ä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„RPç­–ç•¥ æ’å…¥æ•°æ®ï¼š 12345insert results,hostname=index2,name=index2333 value=2,value2=4 -------- ---------------------------- ------------------------- è¡¨å tagsçš„è®¾ç½® fieldsçš„è®¾ç½® ä¸Šé¢è¿™å¥sqlçš„æ„æ€å°±æ˜¯è¯´åœ¨åä¸ºresultçš„è¡¨é‡Œï¼Œæ’å…¥ä¸¤ä¸ªåˆ†åˆ«å‘½åä¸ºhostnameå’Œnameå–å€¼åˆ†åˆ«ä¸ºindex2å’Œindex2333çš„tagsï¼Œä»¥åŠä¸¤ä¸ªåˆ†åˆ«å‘½åä¸ºvalueå’Œvalue2å–å€¼åˆ†åˆ«ä¸º2å’Œ4çš„fieldsçš„æ•°æ®ã€‚ âš ï¸ æ³¨æ„ï¼šè¿™é‡Œçš„æŒ‡ä»¤ç›´æ¥è¾“å…¥æ•´æ•°ï¼ŒInfluxDBæ˜¯æŒ‰ç…§æµ®ç‚¹å‹å¤„ç†çš„ï¼Œå¦‚æœä¸€å®šè¦è®©ä¸Šé¢çš„value=2å’Œvalue2=4ä¸­çš„2å’Œ4æ˜¯æ•´å‹æ•°æ®ï¼Œé‚£ä¹ˆéœ€è¦åœ¨åé¢åŠ ä¸Šä¿®é¥°è¯ï¼švalue=2iï¼Œiå°±ä»£è¡¨æ•´å‹ã€‚ æ£€ç´¢æ•°æ®ï¼š 1select * from results æ‰“å°ç»“æœä¸ºï¼š 1234name: results2time hostname name value value2---- -------- ---- ----- ------1560928150794920700 index2 index2333 2 4 åˆ†é¡µæ£€ç´¢ï¼š 1SELECT * FROM è¡¨ WHERE æ¡ä»¶ LIMIT rows OFFSET (page - 1)*rows rowsä»£è¡¨æ¯é¡µå±•ç¤ºè¡Œæ•°ï¼Œpageè¡¨ç¤ºé¡µç  åˆ é™¤è¡¨ï¼š 1drop measurement \"è¡¨å\" ä¸‰ã€InfluxDBçš„æ—¶æ•ˆè®¾ç½®å¾ˆé—æ†¾ï¼ŒInfluxDBæ˜¯ä¸æ”¯æŒåˆ é™¤å’Œä¿®æ”¹çš„ï¼Œåˆ é™¤æœ‰ä¸“é—¨çš„æ“ä½œï¼Œä½†æ˜¯æ€§èƒ½å¾ˆä½ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚ InfluxDBæ”¯æŒå®šæœŸæ¸…é™¤æ•°æ®ç­–ç•¥ã€‚ æŸ¥çœ‹å½“å‰åº“å¯¹åº”ç­–ç•¥é…ç½®çš„å‘½ä»¤ä¸ºï¼š 1show retention policies on \"åº“å\" ç»“æœï¼š 123name duration shardGroupDuration replicaN default------- --------- ------------------ --------- -------autogen 0s 168h0m0s 1 true nameï¼šè¿‡æœŸç­–ç•¥å durationï¼šä¿ç•™å¤šé•¿æ—¶é—´çš„æ•°æ®ï¼Œæ¯”å¦‚3wï¼Œæ„æ€å°±æ˜¯æŠŠä¸‰å‘¨å‰çš„æ•°æ®æ¸…é™¤æ‰ï¼Œåªä¿ç•™ä¸‰å‘¨å†…çš„ï¼Œæ”¯æŒhï¼ˆå°æ—¶ï¼‰ï¼Œdï¼ˆå¤©ï¼‰ï¼Œwï¼ˆæ˜ŸæœŸï¼‰è¿™å‡ ç§é…æ³•ã€‚ shardGroupDurationï¼šå­˜å‚¨æ•°æ®çš„åˆ†ç»„ç»“æ„ï¼Œæ¯”å¦‚è®¾ç½®ä¸º1dï¼Œè¡¨ç¤ºçš„æ˜¯æ¯ç»„å­˜å‚¨1dçš„æ•°æ®é‡ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®å°†æŒ‰ç…§å¤©ä¸ºå•ä½åˆ’åˆ†å­˜å‚¨åˆ†ç»„ï¼Œç„¶åæ ¹æ®æ¯æ¡æ•°æ®çš„æ—¶é—´æˆ³å†³å®šæŠŠå®ƒæ”¾åˆ°å“ªä¸ªåˆ†ç»„é‡Œï¼Œå› æ­¤è¿™ä¸ªæ¦‚å¿µè¿˜ä¼šå½±å“åˆ°è¿‡æœŸç­–ç•¥ï¼Œå› ä¸ºInfluxDBåœ¨æ¸…é™¤è¿‡æœŸæ•°æ®æ—¶ä¸å¯èƒ½é€æ¡æ¸…ç†ï¼Œè€Œæ˜¯é€šè¿‡æ¸…é™¤æ•´ä¸ªShardGroupçš„æ–¹å¼è¿›è¡Œï¼Œå› ä¸ºé€šè¿‡è·Ÿå½“å‰æ—¶é—´å¯¹æ¯”å°±å¯ä»¥çŸ¥é“å“ªäº›åˆ†ç»„é‡Œçš„æ•°æ®ä¸€å®šæ˜¯è¿‡æœŸçš„ï¼Œä»è€Œè¿›è¡Œæ•´ç»„æ¸…ç†ï¼Œæ•ˆç‡å¾€å¾€æ›´é«˜ã€‚ replicaNï¼šå‰¯æœ¬æ•°é‡ï¼Œä¸€èˆ¬ä¸º1ä¸ªï¼ˆè¿™ä¸ªå¤§æ¦‚å°±æ˜¯å¤‡ä»½çš„æ„æ€ï¼Ÿè¿™ä¸ªé…ç½®åœ¨å•å®ä¾‹æ¨¡å¼ä¸‹ä¸èµ·ä½œç”¨ï¼‰ defaultï¼šæ˜¯å¦æ˜¯é»˜è®¤é…ç½®ï¼Œè®¾ç½®ä¸ºtrueè¡¨ç¤ºé»˜è®¤çš„æ„æ€ï¼Œä¸»è¦ç”¨äºæŸ¥è¯¢æ—¶æ˜¯å¦æŒ‡å®šç­–ç•¥ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œåˆ™è¿™ä¸ªæŸ¥è¯¢å°±æ˜¯é’ˆå¯¹default=trueçš„ç­–ç•¥è¿›è¡Œçš„ï¼Œæ³¨æ„ï¼Œæœ¬æ–‡ç« é‡Œçš„sqléƒ½æ²¡æœ‰æŒ‡æ˜ä¿ç•™ç­–ç•¥çš„åå­—ï¼Œå¦‚æœæœ‰éœ€è¦ï¼Œé‚£ä¹ˆè¯·æŒ‡å®šã€‚ä¸€ä¸ªåº“å…è®¸æœ‰å¤šå¥—ç­–ç•¥é…ç½®ï¼ˆæ¯å¥—ç­–ç•¥é‡Œéƒ½å¯ä»¥æœ‰è‡ªå·±çš„ä¸€ä»½æ•°æ®ï¼Œæ¯”å¦‚åŒæ ·ä¸€å¼ è¡¨çš„æ•°æ®åœ¨ç­–ç•¥Aå’Œç­–ç•¥Bçš„æƒ…å†µä¸‹æ˜¯ä¸åŒçš„ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªåº“å¯¹åº”Nä¸ªç­–ç•¥ï¼Œæ¯ä¸ªç­–ç•¥é‡Œæœ‰è‡ªå·±çš„Nå¤šå¼ è¡¨ï¼Œç›¸äº’ç‹¬ç«‹ï¼‰ï¼Œåœ¨ä¸æŒ‡å®šç­–ç•¥åç§°çš„æƒ…å†µä¸‹å†™çš„sqlï¼Œé»˜è®¤ä½¿ç”¨default=trueçš„ç­–ç•¥ã€‚ å½“ç„¶ï¼Œç­–ç•¥ä¹Ÿæ”¯æŒä¿®æ”¹ï¼ŒæŒ‡ä»¤å¦‚ä¸‹ï¼š 1alter retention policy \"autogen\" on \"test\" duration 30d default ä¸Šé¢è¿™æ¡æŒ‡ä»¤å°±ä¼šæŠŠä¸Šé¢ç­–ç•¥æ˜ä¸ºautogençš„ç­–ç•¥æœ‰æ•ˆä¿å­˜æ—¶é—´æ”¹ä¸º30å¤©ã€‚ å››ã€InfluxDBçš„å­˜å‚¨ç»“æ„4.1ï¼šç»“æ„å±‚çº§äº†è§£å®Œç­–ç•¥ï¼Œç»“åˆä¸Šé¢æåˆ°çš„seriesã€tagsã€fieldsç­‰æ¦‚å¿µï¼Œç”»ä¸€ä¸‹å•ä¸ªInfluxDBåº“çš„å­˜å‚¨ç»“æ„ï¼š å›¾é‡Œæ²¡æœ‰ä½“ç°å‡ºtagsã€fieldsè¿™äº›æ•°æ®å±‚é¢çš„ä¸œè¥¿ï¼Œå®ƒä»¬æœ€ç»ˆè¢«å­˜æ”¾åœ¨äº†Shardé‡Œï¼Œä¹‹å‰è¯´è¿‡tagsä¼šå½±å“seriesçš„å¤§å°ï¼Œå…¶å®serieså°±ç›¸å½“äºä¸€ä¸ªå”¯ä¸€åŒ–åˆ†ç±»ï¼Œeriesä¼°ç®—æ–¹å¼ä¸ºï¼š seriesçš„ä¸ªæ•° = RP Ã— measurement Ã— tagsï¼ˆtagså»é‡åçš„ä¸ªæ•°ï¼‰ æ¯”å¦‚ä¸€ä¸ªdatabaseä¸­æœ‰ä¸€ä¸ªmeasurementï¼Œå«testï¼Œæœ‰ä¸¤ä¸ªRPï¼ˆ7d, 30dï¼‰ï¼Œtagæœ‰hostï¼Œserverã€‚hostçš„å€¼æœ‰hostAã€hostBï¼Œserverä¸ºserver1ï¼Œserver2ã€‚é‚£ä¹ˆè¿™ä¸ªdatabaseçš„serieså€¼ä¸º2RP x 4tags = 8 4.2ï¼šLSM-Treeå›å½’å›¾1å‰ï¼Œå…ˆæ¥äº†è§£ä¸‹LSM-Treeï¼Œå‡ ä¹æ‰€æœ‰çš„k-vå­˜å‚¨çš„å†™å¯†é›†å‹æ•°æ®åº“éƒ½é‡‡ç”¨è¯¥æ•°æ®ç»“æ„å®ç°ï¼Œè¯¥æ•°æ®ç»“æ„çš„ç»“æ„å¦‚ä¸‹ï¼ˆæ³¨æ„ä¸‹é¢è¯´çš„å±‚çº§å¹¶éæ ‘çš„å±‚çº§ï¼Œè€Œæ˜¯åˆå¹¶é€»è¾‘å‘ç”Ÿæ—¶çš„å±‚çº§ï¼‰ï¼š å¦‚å›¾2ï¼Œè¯¥ç»“æ„å†™å…¥æµç¨‹å¦‚ä¸‹ï¼š å†™å…¥çš„æ•°æ®é¦–å…ˆåŠ åˆ°0å±‚ï¼Œ0å±‚çš„æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼ŒçŸ­æœŸå†…æŸ¥è¯¢çš„æ•°æ®ä¸€èˆ¬åœ¨0å±‚ï¼Œç”±äºæ˜¯å†…å­˜æ“ä½œï¼Œå› æ­¤æ•ˆç‡ä¼šéå¸¸é«˜ï¼Œå½“0å±‚çš„æ•°æ®è¾¾åˆ°ä¸€å®šå¤§å°æ—¶ï¼Œæ­¤æ—¶ä¼šæŠŠ0å±‚ å’Œä½äºå®ƒä¸‹é¢çš„1å±‚è¿›è¡Œåˆå¹¶ï¼Œç„¶ååˆå¹¶å‡ºæ¥çš„æ–°çš„æ•°æ®ï¼ˆ0å±‚+1å±‚çš„æ•°æ®ï¼‰ä¼šé¡ºåºå†™ç£ç›˜ï¼ˆè¿™é‡Œç”±äºæ˜¯é¡ºåºå†™å…¥ç£ç›˜ï¼Œå› æ­¤å†™æ€§èƒ½ä¼šéå¸¸å¥½ï¼‰ï¼Œç„¶åæ›¿æ¢æ‰åŸæ¥è€çš„1å±‚æ•°æ®ï¼Œå½“1å±‚è¾¾åˆ°ä¸€å®šå¤§å°çš„æ—¶å€™ï¼Œå°†ç»§ç»­å’Œå®ƒçš„ä¸‹å±‚åˆå¹¶ï¼Œä»¥æ­¤ç±»æ¨ï¼Œä¸€çº§ä¸€çº§çš„å¾€ä¸‹é€’ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥å°†åˆå¹¶ä¹‹åæ—§æ–‡ä»¶å…¨éƒ¨åˆ æ‰ï¼Œç•™ä¸‹æœ€æ–°çš„ã€‚ LSM-Treeå‚è€ƒæ–‡ç« ï¼šLSM-tree åŸºæœ¬åŸç†åŠåº”ç”¨ ç„¶åå›å½’å›¾1ï¼Œæœ€ç»ˆçš„æ•°æ®ä¼šè¢«å­˜å‚¨è¿›Shardï¼ŒShardé‡Œå­˜åœ¨å‡ ä¸ªåŒºåŸŸï¼Œå°±æ˜¯æœ€ç»ˆå­˜æ”¾æ•°æ®çš„åœ°æ–¹ï¼Œä¸‹é¢é’ˆå¯¹è¿™å‡ ä¸ªåŒºåŸŸè¯´æ˜ä¸‹å®ƒä»¬çš„ä½œç”¨ï¼š 4.3ï¼šCacheç›¸å½“äºä¸Šé¢è¯´çš„LSM-Treeçš„0å±‚ï¼Œå­˜æ”¾äºå†…å­˜ä¸­ï¼Œå†™å…¥çš„æ•°æ®æ—¶é¦–å…ˆè¢«è¯¥æ¨¡å—æ¥æ”¶å¹¶å­˜å‚¨ï¼Œè¯¥æ¨¡å—åœ¨å†…å­˜ä¸­è¡¨ç°ä¸ºä¸€ä¸ªmapç»“æ„ï¼Œk = seriesKey + åˆ†éš”ç¬¦ + fieldsNameï¼Œv = å…·ä½“çš„filedå¯¹åº”çš„å€¼çš„æ•°ç»„ï¼Œå…·ä½“ç»“æ„ä½“å¦‚ä¸‹ï¼ˆå‚è€ƒç½‘ä¸Šèµ„æ–™ï¼‰ï¼š 123456789101112131415161718192021type Cache struct { commit sync.Mutex mu sync.RWMutex store map[string]*entry size uint64 // å½“å‰ä½¿ç”¨å†…å­˜çš„å¤§å° maxSize uint64 // ç¼“å­˜æœ€å¤§å€¼ // snapshots are the cache objects that are currently being written to tsm files // they're kept in memory while flushing so they can be queried along with the cache. // they are read only and should never be modified // memtable å¿«ç…§ï¼Œç”¨äºå†™å…¥ tsm æ–‡ä»¶ï¼Œåªè¯» snapshot *Cache snapshotSize uint64 snapshotting bool // This number is the number of pending or failed WriteSnaphot attempts since the last successful one. snapshotAttempts int stats *CacheStatistics lastSnapshot time.Time} ä»£ç å—1 åŸºäºå‰é¢è¯´çš„LSM-Treeï¼Œå¯ä»¥çŸ¥é“è¿™é‡Œçš„cacheä¸æ˜¯æŒç»­å¢é•¿çš„ï¼Œè€Œæ˜¯è¾¾åˆ°ä¸€å®šå€¼å°±ä¼šè¿›è¡Œè·Ÿä¸‹å±‚å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„æ•°æ®ï¼ˆ1~nå±‚ï¼‰è¿›è¡Œåˆå¹¶ï¼Œç„¶åæ¸…ç©ºcacheï¼Œåœ¨InfluxDBä¸­ï¼Œè¿™ä¸€éƒ¨åˆ†å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„æ•°æ®ï¼Œå°±æ˜¯æŒ‡TSM Fileæ¨¡å—ï¼Œä¸‹é¢ä¼šä»‹ç»ã€‚ 4.4ï¼šWALåœ¨ä¸Šé¢å¯¹äºCacheçš„æè¿°ä¸­ï¼ŒCacheæ˜¯åŸºäºå†…å­˜åšçš„å†™å…¥æ•°æ®æ¥æ”¶æ–¹ï¼Œé‚£ä¹ˆå¦‚æœä¸­é€”æœºå™¨å®•æ‰ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆCacheé‡Œæ•°æ®ä¸¢å¤±çš„é—®é¢˜ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒInfluxDBå°±è®¾è®¡äº†WALæ¨¡å—ï¼Œå®é™…åœ¨å†™å…¥ä¸€ä¸ªæ•°æ®æ—¶ï¼Œä¸ä»…ä¼šå…ˆå†™è¿›Cacheï¼Œè¿˜ä¼šå†™å…¥WALï¼Œå¯ä»¥ç®€å•ç†è§£WALå°±æ˜¯å¯¹Cacheé‡Œæ•°æ®çš„å¤‡ä»½ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œåœ¨Cacheåšå®Œä¸€æ¬¡åˆå¹¶æ¸…é™¤æ‰è‡ªèº«æ—¶ï¼Œæ—§çš„WALæ–‡ä»¶ä¹Ÿä¼šéšä¹‹åˆ é™¤ï¼Œç„¶åæ–°å»ºä¸€ä¸ªWALï¼Œè¿æ¥æ–°ä¸€è½®çš„å†™å…¥ã€‚åŒæ ·çš„ï¼Œåœ¨InfluxDBå¯åŠ¨æ—¶ï¼Œä¹Ÿä¼šå…ˆå»è¯»å–WALæ–‡ä»¶åˆå§‹åŒ–Cacheæ¨¡å—ã€‚ 4.5ï¼šTSM Fileç”¨äºç»„æˆTSM-Treeç»“æ„çš„ä¸»è¦ç£ç›˜æ–‡ä»¶ï¼ˆå¯ä»¥å¯¹åº”å›¾2çš„1~nå±‚ï¼‰ï¼Œå†…éƒ¨åšäº†å¾ˆå¤šå­˜å‚¨ä»¥åŠå‹ç¼©ä¼˜åŒ–ï¼Œå•ä¸ªTSM Fileçš„æœ€å¤§å¤§å°ä¸º2GBã€‚ 4.6ï¼šCompactoråœ¨åå°æŒç»­è¿è¡Œçš„ä¸€ä¸ªtaskï¼ˆé¢‘ç‡ä¸º1sï¼‰ï¼Œä¸»è¦åšä»¥ä¸‹äº‹æƒ…ï¼š åœ¨Cacheè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œè¿›è¡Œå¿«ç…§ï¼Œç„¶åå°†æ•°æ®åˆå¹¶å¹¶ä¿å­˜åœ¨TSM Fileä¸­ åˆå¹¶TSM Fileï¼Œå°†å¤šä¸ªå°å‹TSM Fileè¿›è¡Œåˆå¹¶ï¼Œä½¿å¾—æ¯ä¸ªæ–‡ä»¶çš„å¤§å°å°½å¯èƒ½è¾¾åˆ°å•ä¸ªæ–‡ä»¶æœ€å¤§å¤§å°ï¼ˆä¹Ÿå°±æ˜¯ä¸Šé¢è¯´åˆ°çš„2GBï¼‰ æ£€æŸ¥å¹¶åˆ é™¤ä¸€äº›å·²å…³é—­çš„WALæ–‡ä»¶ äº”ã€å…·ä½“æ¡ˆä¾‹ï¼Œä»¥åŠå®é™…çš„å­˜å‚¨ç›®å½•ç»“åˆå›¾1çš„ç»“æ„ä»¥åŠå›¾2çš„æ•°æ®ç»“æ„ï¼Œå†åŠ ä¸Šå¯¹shardå†…éƒ¨å„ç»„ä»¶çš„ä»‹ç»ï¼Œä¸‹é¢é€šè¿‡ä¸€ä¸ªå®é™…çš„ä¾‹å­æ¥æ¢ç´¢ä¸‹InfluxDBå®é™…çš„å­˜å‚¨ç›®å½•ã€‚ ç°åœ¨åˆ›å»ºå‡ºæ¥ä¸€ä¸ªå«style_rankçš„åº“ï¼Œä¸”è®¾ç½®é»˜è®¤RPä¸º7dï¼Œä¿å­˜å‘¨æœŸä¸º7å¤©ï¼Œé»˜è®¤åˆ†ç»„ç­–ç•¥ä¸º24håˆ†ä¸€æ¬¡ï¼Œå¦‚å›¾ï¼š å›¾ä¸­åä¸º7dçš„rpç­–ç•¥è¢«è®¾ç½®ä¸ºé»˜è®¤ç­–ç•¥ï¼Œå…¶ä¸­durationè¢«è®¾ç½®ä¸º168hï¼ŒshardGroupDurationè¢«è®¾ç½®ä¸ºäº†24hï¼Œæ„å‘³ç€è¯¥ç­–ç•¥é‡Œçš„è¡¨æ•°æ®å°†ä»¥7å¤©ä¸ºä¸€ä¸ªå‘¨æœŸè¿‡æœŸï¼ŒæœŸé—´ä»¥1å¤©ä¸ºå•ä½åˆ†ç»„ã€‚ 5.1ï¼šInfluxDBé…ç½®æ–‡ä»¶ä¸‹è½½ä¸‹æ¥ä¸€ä¸ªInfluxDBåï¼Œé€šè¿‡é…ç½®æ–‡ä»¶influxdb.confå¯ä»¥é…ç½®å„ä¸ªæ–‡ä»¶å­˜æ”¾çš„ç›®å½•ï¼š è¿™å‡ ä¸ªé…ç½®å†³å®šäº†ä½ å°†äº§ç”Ÿçš„æ•°æ®å­˜æ”¾åœ¨å“ªé‡Œï¼Œå»ºè®®è‡ªå®šä¹‰è¿™ä¸ªï¼Œé»˜è®¤çš„ç›®å½•å¾ˆè¿·=_= 5.2ï¼šå…·ä½“çš„æ•°æ®ç›®å½•é…ç½®å®Œä¸Šé¢çš„æ–‡ä»¶ï¼Œå¯åŠ¨ï¼Œç„¶åå½•å…¥æ•°æ®ï¼Œç„¶åå†å»å…·ä½“çš„ç›®å½•ä¸‹æŸ¥æ‰¾å…·ä½“çš„æ•°æ®æ–‡ä»¶ï¼š å…ƒæ•°æ®å±‚ï¼šç”¨æ¥å­˜æ”¾å½“å‰åº“çš„å±æ€§ï¼Œæ¯”å¦‚RPã€é»˜è®¤RPã€åˆ†ç»„ç­–ç•¥ç­‰ã€‚ walå±‚ï¼šç”¨æ¥å­˜æ”¾åˆšå†™å…¥æ•°æ®çš„ä¿¡æ¯ï¼Œä¼šå…ˆå†™å…¥å†…å­˜ï¼Œç„¶åå¼‚æ­¥å†™å…¥walæ–‡ä»¶ï¼Œwalæ–‡ä»¶ç”¨æ¥é‡å¯InfluxDBæ—¶æ¢å¤å†…å­˜æ•°æ®ç”¨ï¼Œå½“walæ–‡ä»¶è¾¾åˆ°ä¸€å®šå¤§å°æ—¶ï¼Œä¼šå‹å…¥dataå±‚ï¼Œwalå±‚çš„ç»“æ„å’Œdataå±‚çš„å‡ ä¹ä¸€è‡´ï¼š ä¸Šé¢è¿›å…¥walç›®å½•åï¼Œéœ€è¦é€‰æ‹©æ­£ç¡®çš„åº“ï¼Œè¿™é‡Œé€‰æ‹©style_rankï¼Œè¿›å…¥åº“åï¼Œä¼šæ˜¾ç¤ºå‡ºè¯¥åº“çš„æ‰€æœ‰RPï¼Œè¿™é‡Œé€‰æ‹©7dï¼Œç„¶åå¯¹åº”å›¾1ï¼Œä½ ç°åœ¨æ¥åˆ°äº†ShardGroupå±‚ï¼Œå›¾6ä¸­çš„ç¼–å·ï¼Œå°±æ˜¯ç”Ÿæˆçš„ShardGroupï¼Œéšä¾¿è¿›å…¥ä¸€ä¸ªï¼Œåˆ™å¯ä»¥çœ‹åˆ°æœ€ç»ˆçš„walæ–‡ä»¶ï¼ˆäº‹å®ä¸Šåªæœ‰å½“å¤©å»ºçš„groupå†…çš„walæ‰æœ‰æ•°æ®ï¼‰ã€‚ dataå±‚ï¼šç”¨æ¥æœ€ç»ˆå­˜æ”¾æ•°æ®çš„ç›®å½•ï¼Œæ‰€æœ‰walæ–‡ä»¶å†…çš„æ•°æ®è¾¾åˆ°ä¸€å®šå¤§å°åï¼Œå‡ä¼šè¢«å‹ç¼©è¿›dataå±‚ï¼Œç°åœ¨è¿›å…¥dataå±‚ï¼Œç„¶åè¿›å…¥style_rankï¼š å¯ä»¥çœ‹åˆ°ä¸‹æ–¹é™¤äº†æœ‰ä¸¤ä¸ªRPç­–ç•¥å¤–ï¼Œè¿˜æœ‰_seriesç›®å½•ï¼Œè¿™ä¸ªç›®å½•å°±æ˜¯å­˜æ”¾ç´¢å¼•ï¼ˆtagså­—æ®µæ‰€äº§ç”Ÿçš„ç´¢å¼•æ•°æ®ï¼‰çš„åœ°æ–¹ï¼Œç”¨äºæœåŠ¡é‡å¯æ—¶æ¢å¤ç´¢å¼•æ•°æ®ç”¨ã€‚ è¿›å…¥7dï¼Œå¯ä»¥çœ‹åˆ°è·Ÿwalå±‚å·®ä¸å¤šçš„ShardGroupåˆ†å±‚ï¼Œä½ ç°åœ¨åˆæ¥åˆ°äº†å›¾1çš„ShardGroupå±‚ï¼š ç„¶åå†æ¬¡è¿›å…¥ä¸€ä¸ªåˆ†ç»„å†…ï¼š æœ€ç»ˆçš„tsmæ–‡ä»¶å°±å­˜åœ¨è¯¥ç›®å½•ä¸‹ï¼Œfields.idxå­˜æ”¾çš„æ˜¯è¡¨é‡Œçš„fieldså…ƒæ•°æ®ï¼Œç”¨äºå†™å…¥æ•°æ®æ—¶åšæ•ˆéªŒç”¨ã€‚ å…­ã€æ‰§è¡Œè®¡åˆ’ç„¶åç»§ç»­ç”±ä¸Šé¢çš„style_rankåº“ï¼Œåœ¨7dè¿™ä¸ªRPä¸‹ï¼Œæ–°å»ºä¸¤å¼ è¡¨ï¼š 12insert season_views,date=\"201907\" season_id=666,views=56789insert season_views_v2,season_id=666 views=56789 ç›®çš„å¾ˆç®€å•ï¼Œåªæ˜¯ä¸ºäº†è®°å½•ä¸‹season_id=xxxçš„æ•°æ®åœ¨æŸä¸€æ—¶åˆ»å¯¹åº”çš„viewså€¼ï¼Œä¿©è¡¨çš„åŒºåˆ«åœ¨äºï¼Œseason_viewä»…ä»…ä»¥æ—¥æœŸä¸ºtagï¼ˆä½œä¸ºç´¢å¼•å­—æ®µï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡ï¼‰ï¼Œseason_views_v2åˆ™ä»¥season_idä½œä¸ºtagï¼ŒæŸä¸€æ—¶åˆ»ï¼Œä¸¤å¼ è¡¨çš„æ•°æ®é‡å‡è¾¾åˆ°äº†5kwä¸”æ•°æ®ä¸€è‡´ï¼Œä¸‹é¢ï¼Œè®©æˆ‘ä»¬ä»¥æœ€ç®€å•çš„æ–¹å¼ï¼ŒæŸ¥è¯¢ä¸‹è¿™ä¸¤å¼ è¡¨ï¼š â„¹ï¸ psï¼šsqlå‰åŠ explainå…³é”®å­—å¯ä»¥æŸ¥çœ‹å…¶æ‰§è¡Œè®¡åˆ’ï¼ŒåŠ explain analyzeå¯ä»¥çœ‹åˆ°å…·ä½“æ¯ä¸€æ­¥æ‰§è¡Œçš„è€—æ—¶ã€‚ åŒæ ·çš„æŸ¥è¯¢ï¼Œseason_idåŠ äº†ç´¢å¼•å’Œä¸åŠ ç´¢å¼•çš„åŒºåˆ«ï¼š NUMBER OF SERIESï¼ˆæ‰«æç³»åˆ—æ•°ï¼ŒåŠ äº†ç´¢å¼•åæ ¹æ®seriesçš„å“ˆå¸Œç®—æ³•ï¼ŒåŒä¸€ä¸ªseason_idéƒ½è¢«åˆ†åœ¨äº†åŒä¸€ä¸ªShardé‡Œï¼Œè¿™é‡Œä¹‹æ‰€ä»¥ä¸º8ï¼Œæ˜¯å› ä¸ºShardGroupä¸åŒï¼‰ç”±ä¸åŠ ç´¢å¼•çš„64ä¸ªï¼Œå‡å°‘åˆ°äº†8ä¸ª NUMBER OF FILESï¼ˆæ‰«ææ–‡ä»¶æ•°ï¼‰ç”±ä¸åŠ ç´¢å¼•çš„54ä¸ªå‡å°‘åˆ°11ä¸ª NUMBER OF BLOCKSï¼ˆæ‰«æçš„æ•°æ®å—ï¼‰ç”±ä¸åŠ ç´¢å¼•çš„152058å‡å°‘åˆ°äº†184 ä¸ƒã€æ€»ç»“ åœ¨ä½¿ç”¨æ—¶ï¼Œå°½å¯èƒ½æŒ‰ç…§æŸå…·ä½“æ—¶é—´æ®µè¿›è¡Œè¿‡æ»¤ï¼Œå¦‚æœè¿‡æ»¤æ¡ä»¶ç­›é€‰å‡ºçš„æ•°æ®é‡è¿‡å¤§ï¼Œåˆ™ä¼šä¸¥é‡å½±å“æŸ¥è¯¢æ•ˆç‡ã€‚ é€‚åº¦ä½¿ç”¨å‡½æ•°ï¼Œè‹¥ä½¿ç”¨ï¼Œè¯·ä¿è¯ç­›é€‰æ¡ä»¶ç­›é€‰å‡ºçš„æ•°æ®é‡ï¼Œå¦‚æœè¿‡å¤§ï¼Œæ•ˆç‡ä¼šæä½ï¼Œæ¯”å¦‚åœ¨season_views_v2ä¸­å¯ç”¨TOPå‡½æ•°ï¼ŒæŸ¥å‡ºå‰ä¸‰åï¼ŒæŸ¥è¯¢è€—æ—¶è¶…è¿‡10sï¼ŒåŠ ä¸Šseason_idæ¡ä»¶åï¼Œåˆ™è¿…é€Ÿè¿”å›ã€‚ åŠ ç´¢å¼•æ—¶éœ€è¦æ³¨æ„ï¼Œå°½é‡é¿å…å¤§æ•°æ®é‡çš„å±æ€§åštagï¼Œå¦åˆ™ä¼šäº§ç”Ÿå¤§é‡seriesï¼Œç”Ÿæˆå¤§é‡ç´¢å¼•æ•°æ®ï¼Œå ç”¨è¿‡å¤šå†…å­˜ï¼Œæ¯”å¦‚ç”¨æˆ·çº§åˆ«çš„tagï¼ˆè¿™é‡Œçš„ç”¨æˆ·çº§åˆ«æ˜¯æŒ‡å¤§å‹ç½‘ç«™ç”¨æˆ·æ•°é‡çº§ï¼Œä¸€èˆ¬1äº¿ä»¥ä¸Šçš„æƒ…å†µï¼‰ã€‚ å…è´¹ç‰ˆçš„InfluxDBä¸æ”¯æŒé›†ç¾¤ï¼Œä¸»ä»éœ€è¦å€ŸåŠ©influx-proxyå®ç°ï¼Œä¹Ÿå¯ä»¥è‡ªå·±é€šè¿‡ç›‘å¬walæ–‡ä»¶å†™å…¥ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼å®ç°ä¸»ä»åŒæ­¥ï¼Œwalç±»ä¼¼mysqlé‡Œçš„binlogã€‚ å»ºè®®ä½¿ç”¨çš„æ—¶å€™ï¼Œå…ˆæŠŠè‡ªå·±çš„åº“å»ºå¥½ï¼Œç„¶åå†æŠŠRPå»ºå¥½ï¼Œå¦‚æœå«Œéº»çƒ¦ï¼Œå¯ä»¥ç›´æ¥æŠŠè‡ªå·±æ–°å»ºçš„RPå®šä¹‰æˆé»˜è®¤RPï¼Œå¦‚æœRPè®¾ç½®ä¸ºé»˜è®¤ï¼Œåªä¼šå¯¹æŸ¥è¯¢äº§ç”Ÿå½±å“ï¼ˆå½“ç„¶å†™çš„æ—¶å€™ä¹Ÿéœ€è¦æŒ‡å®šï¼‰ï¼Œåœ¨sqlä¸­ä¸æŒ‡å®šRPçš„æƒ…å†µä¸‹æ‰§è¡Œï¼Œåˆ™è®¤ä¸ºå°±æ˜¯èµ°çš„é»˜è®¤RPã€‚ åˆ†åº“ï¼Œå»ºè®®æŒ‰ç…§æ—¥æœŸåˆ†ã€‚","link":"/2019/06/21/InfluxDB%EF%BC%88%E4%B8%80%EF%BC%89%E5%88%9D%E6%8E%A2%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"title":"é“¾è·¯è¿½è¸ªï¼ˆäºŒï¼‰-åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªç³»ç»Ÿæ•°æ®é‡‡é›†","text":"æœ¬ç¯‡æ–‡ç« åŸºäºä¸Šä¸€ç¯‡ï¼Œåªé’ˆå¯¹æ•°æ®é‡‡é›†åšä»‹ç»ï¼Œä¼šæä¾›ä¸€ä¸ªSDKçš„å®ç°å’Œä½¿ç”¨ï¼Œä¼šåšå®ç°æ–¹æ¡ˆçš„ä»‹ç»ï¼Œå…·ä½“è¯¦ç»†ä»‹ç»ä¸‹é¢è¾¹æ¡†åŠ ç²—çš„éƒ¨åˆ†ï¼š ä¸€ã€æ•°æ®é‡‡é›†æ¥ç€æ‹¿ä¸Šä¸€ç¯‡é‡Œçš„ä¾‹å­æ¥è¯´ï¼ŒæŠŠä¾‹å­é‡Œçš„å›¾è´´è¿‡æ¥ï¼š ç®€å•å›é¡¾ä¸‹ä¸Šå›¾ï¼Œä¸€æ¬¡APIè°ƒç”¨ï¼Œå®Œæˆä¸Šé¢å„ä¸ªä¸šåŠ¡æœåŠ¡çš„è°ƒç”¨ï¼Œç„¶åèšåˆæ‰€æœ‰æœåŠ¡çš„ä¿¡æ¯ï¼Œç„¶åRedis_02çš„è°ƒç”¨å‘ç”Ÿç“¶é¢ˆï¼Œç»§è€Œå½±å“åˆ°Eã€Dã€Cä¸‰ä¸ªæœåŠ¡ï¼Œç°åœ¨éœ€è¦ç›´è§‚çš„å±•ç¤ºè¿™æ¡é“¾è·¯ä¸Šçš„ç“¶é¢ˆç‚¹ï¼Œäºæ˜¯éœ€è¦ä¸€ä¸ªé“¾è·¯ç³»ç»Ÿï¼Œå±•ç¤ºæˆå¦‚ä¸‹å›¾çš„æ•ˆæœï¼š è¦æƒ³å±•ç¤ºæˆä¸Šå›¾ä¸­çš„æ•ˆæœï¼Œåˆ™å¿…é¡»è¦è¿›è¡Œæ•°æ®çš„é‡‡é›†å’Œä¸ŠæŠ¥ï¼Œé‚£ä¹ˆè¿™å°±ç‰µæ‰¯åˆ°ä¸¤ä¸ªæ¦‚å¿µï¼ŒSpanå’ŒTracerï¼ŒæŠ½è±¡æˆæ•°æ®åº“çš„è®¾è®¡å±‚é¢ï¼Œå¯ä»¥ç†è§£æˆTracerå¯¹Spanç­‰äºä¸€å¯¹å¤šçš„å…³ç³»ï¼Œè€Œä¸€ä¸ªSpanå¯èƒ½åŒ…å«å¤šä¸ªå­Spanï¼Œä¸€ä¸ªTracerè¡¨ç¤ºä¸€æ¬¡è°ƒç”¨æ‰€ç»è¿‡çš„æ•´ä¸ªç³»ç»Ÿé“¾è·¯ï¼Œé‡Œé¢åŒ…å«Nå¤šSpanï¼Œæ¯ä¸ªSpanè¡¨ç¤ºä¸€æ¬¡äº‹ä»¶çš„è§¦å‘ï¼ˆä¹Ÿå°±æ˜¯è°ƒç”¨ï¼‰ï¼Œé‚£ä¹ˆå°±ç”¨å›¾2æ¥è§£é‡Šä¸‹è¿™ç§å…³ç³»ï¼š æ‰€ä»¥ä¸ŠæŠ¥æ•°æ®æœ€å…³é”®çš„åœ°æ–¹å°±æ˜¯è¦åšåˆ°å¦‚ä¸‹å‡ ç‚¹ï¼š åœ¨è°ƒç”¨ä¹‹å¤„ï¼ˆæ¯”å¦‚ä¾‹å­ä¸­APIè°ƒç”¨å¼€å§‹çš„åœ°æ–¹ï¼‰ï¼Œåˆ›å»ºTracerï¼Œç”Ÿæˆå”¯ä¸€Trace IDï¼› åœ¨éœ€è¦è¿½è¸ªçš„åœ°æ–¹ï¼ˆæ¯”å¦‚ä¾‹å­ä¸­å‘ç”ŸæœåŠ¡è°ƒç”¨çš„åœ°æ–¹ï¼‰ï¼Œåˆ›å»ºSpanï¼ŒæŒ‡å®šTrace IDï¼Œå¹¶ç”Ÿæˆå”¯ä¸€Span IDï¼Œç„¶åæŒ‰éœ€å»ºç«‹çˆ¶å­å…³ç³»ï¼Œè¿½è¸ªç»“æŸæ—¶ï¼ˆæ¯”å¦‚ä¾‹å­ä¸­è°ƒç”¨å®Œæˆæ—¶ï¼‰é‡Šæ”¾Spanï¼ˆå³ç½®ä¸ºfinishedï¼Œæ­¤æ—¶è®¡æ—¶å·²å®Œæˆï¼‰ï¼› è·¨ç³»ç»Ÿè¿½è¸ªæ—¶åšå¥½åè®®çº¦å®šï¼Œæ¯æ¬¡è·¨ç³»ç»Ÿè°ƒç”¨æ—¶å¯ä»¥åœ¨åè®®å¤´ä¼ è¾“å‘èµ·è°ƒç”¨ç³»ç»Ÿçš„TraceIDï¼Œä»¥ä¾¿é“¾è·¯å¯ä»¥åšåˆ°è·¨ç³»ç»Ÿé¡ºåˆ©ä¼ è¾“ã€‚ æœ€ç»ˆä¸»é“¾è·¯æ‰§è¡Œå®Œæ¯•ï¼ˆä¾‹å­ä¸­å°±æ˜¯æŒ‡APIè°ƒç”¨ç»“æŸï¼‰æ—¶ï¼Œæ¨é€æ­¤é“¾è·¯äº§ç”Ÿçš„æ‰€æœ‰Spanåˆ°é“¾è·¯ç³»ç»Ÿï¼Œé“¾è·¯ç³»ç»Ÿè´Ÿè´£è½åº“ã€æ•°æ®åˆ†æå’Œå±•ç¤ºã€‚ ä»¥ä¸Šä¾¿æ˜¯é“¾è·¯è¿½è¸ªä¸šåŠ¡SDKéœ€è¦å‚ä¸åšåˆ°çš„äº‹æƒ…ã€‚ Traceræ˜¯ä¸ªè™šæ‹Ÿæ¦‚å¿µï¼Œè´Ÿè´£èšåˆSpanä½¿ç”¨ï¼Œå®é™…ä¸ŠæŠ¥çš„æ•°æ®å…¨æ˜¯Spanï¼Œä¸‹é¢æ¥çœ‹ä¸‹Spançš„ç»“æ„å®šä¹‰ï¼ˆJSONï¼‰ï¼š 12345678910111213{ \"spanId\": 123456, \"traceId\": 1234, \"parentId\": 123455, \"title\": \"getSomeThing\", \"project\": \"project.tree.group.project_name\", \"startTime\": 1555731560000, \"endTime\": 1555731570000, \"tags\": { \"component\": \"rpc\", \"span.kind\": \"client\" }} è¿™æ˜¯ä¸€ä¸ªspançš„åŸºæœ¬ç»“æ„å®šä¹‰ï¼ŒstartTimeå’ŒendTimeå¯ä»¥æ¨ç®—å‡ºæœ¬æ¬¡Spanè€—æ—¶ï¼ˆäº¤ç»™é“¾è·¯ç³»ç»Ÿå‰ç«¯æ—¶å¯ä»¥ç”¨æ¥å±•ç¤ºæ—¶é—´è½´çš„é•¿çŸ­ï¼‰ï¼Œtitleè¡¨ç¤ºçš„æ˜¯Spanæœ¬èº«çš„æè¿°ï¼Œä¸€èˆ¬æ˜¯ä¸€ä¸ªmethodçš„åå­—ï¼Œprojectæ˜¯å½“å‰æ‰€å¤„é¡¹ç›®çš„å…¨ç§°ï¼Œé¡¹ç›®çš„å…¨ç§°å¯ä»¥äº¤ç»™é“¾è·¯ç³»ç»Ÿå‰ç«¯ç”¨æ¥æœç´¢å‡ºè¯¥é¡¹ç›®çš„æ‰€æœ‰é“¾è·¯ä¿¡æ¯ã€‚spanIdã€traceIdã€parentIdç»“åˆä¸Šé¢çš„å›¾ç†è§£å³å¯ï¼Œtagsè¡¨ç¤ºçš„æ˜¯ä¸€äº›æè¿°ä¿¡æ¯ï¼Œè¿™é‡Œæœ‰ä¸€äº›æ ‡å‡†åŒ–çš„ä¸œè¥¿ï¼šæ ‡å‡†çš„Span tag å’Œ log field äºŒã€æ•°æ®é‡‡é›†åŸºäºJavaè¯­è¨€çš„å®ç°ä¸€èˆ¬åŸºäºio.opentracingæ ‡å‡†å®ç°ä¸ŠæŠ¥SDKï¼Œä¸‹é¢æ¥é€æ­¥å®ç°ä¸€ä¸ªæœ€ç®€å•çš„æ•°æ®æ”¶é›†å™¨ï¼Œé¦–å…ˆåœ¨é¡¹ç›®ä¸­å¼•å…¥io.opentracingçš„jaråŒ…ï¼Œç„¶åè¿½åŠ ä¸¤ä¸ªåŸºæœ¬ç±»SimpleTracerå’ŒSimpleSpanï¼Œè¿™é‡Œåªè´´å‡ºå…³é”®ä»£ç ã€‚ SimpleTracerå®šä¹‰ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475// è¿½è¸ªå™¨ï¼Œå®ç°Traceræ¥å£public class SimpleTracer implements Tracer { private final List finishedSpans = new ArrayList&lt;&gt;(); //å­˜æ”¾é“¾è·¯ä¸­å·²æ‰§è¡Œå®Œæˆçš„spanï¼ˆfinished spanï¼‰ private String project; //é¡¹ç›®åç§° private Boolean sampled; //æ˜¯å¦ä¸ŠæŠ¥ï¼ˆç”±é‡‡æ ·ç‡ç®—æ³•ç”Ÿæˆè¯¥å€¼ï¼‰ public SimpleTracer(boolean sampled, String project) { this.project = project; this.sampled = sampled; } public SimpleTracer(String uri, String project) { this.project = project; this.sampled = PushUtils.sampled(uri); //æœ¬æ¬¡è¿½è¸ªæ˜¯å¦ä¸ŠæŠ¥ } @Override public SpanBuilder buildSpan(String operationName) { return new SpanBuilder(operationName); //åˆ›å»ºspanä¸€èˆ¬äº¤ç»™Tracerå»åšï¼Œè¿™é‡Œç”±å…¶å†…éƒ¨ç±»SpanBuilderè§¦å‘åˆ›å»º } //ä¸ŠæŠ¥spanï¼Œè¿™ä¸ªæ–¹æ³•ä¸€èˆ¬åœ¨ä¸€æ¬¡é“¾è·¯å®Œæˆæ—¶è°ƒç”¨ï¼Œè´Ÿè´£å°†finishedSpansé‡Œçš„æ•°æ®ä¸ŠæŠ¥ç»™è¿½è¸ªç³»ç»Ÿ public synchronized void pushSpans() { if (sampled != null &amp;&amp; sampled) { List finished = this.finishedSpans; if (finished.size() &gt; 0) { finished.stream().filter(SimpleSpan::sampled).forEach(span -&gt; PushHandler.getHandler().pushSpan(span)); //å®é™…è´Ÿè´£æ¨é€çš„æ–¹æ³• this.reset(); //æ¯å‘ç”Ÿä¸€æ¬¡æ¨é€ï¼Œåˆ™æ¸…ç†ä¸€æ¬¡å·²å®Œæˆspané›†åˆ } } } // Tracerå¯¹è±¡å†…éƒ¨ç±»SpanBuilderï¼Œå®ç°äº†æ ‡å‡†é‡Œçš„Tracer.SpanBuilderæ¥å£ï¼Œç”¨æ¥è´Ÿè´£åˆ›å»ºspan public final class SpanBuilder implements Tracer.SpanBuilder { private final String title; //æ“ä½œåï¼Œä¹Ÿå°±æ˜¯spançš„title private long startMicros; //åˆå§‹åŒ–å¼€å§‹æ—¶é—´ private List references = new ArrayList&lt;&gt;(); //çˆ¶å­å…³ç³» private Map&lt;String, Object&gt; initialTags = new HashMap&lt;&gt;(); //tagæè¿°ä¿¡æ¯åˆå§‹åŒ– //åˆ›å»ºspanç”¨çš„titleä¼ å…¥ SpanBuilder(String title) { this.title = title; } @Override public SpanBuilder asChildOf(SpanContext parent) { //ä¼ å…¥çˆ¶å­å…³ç³» return addReference(References.CHILD_OF, parent); } @Override public SpanBuilder addReference(String referenceType, SpanContext referencedContext) { if (referencedContext != null) { //æ·»åŠ çˆ¶å­å…³ç³»ï¼Œå…¶å®è¿™é‡Œå°±æ˜¯åˆå§‹åŒ–äº†Spané‡Œçš„Referenceå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¼šåœ¨åˆ›å»ºSpanå¯¹è±¡æ—¶ä½œä¸ºå‚æ•°ä¼ è¿›å»ï¼Œç„¶åå…·ä½“å…³ç³»çš„ç¡®ç«‹ï¼Œæ˜¯åœ¨Spanå¯¹è±¡å†…ï¼ˆå…·ä½“Spanç±»çš„ä»£ç æ®µä¼šå±•ç¤ºï¼‰ this.references.add(new SimpleSpan.Reference((SimpleSpan.SimpleSpanContext) referencedContext, referenceType)); } return this; } @Override public SimpleSpan start() { return startManual(); } @Override public SimpleSpan startManual() { //åˆ›å»ºå¹¶å¼€å§‹ä¸€ä¸ªspan if (this.startMicros == 0) { this.startMicros = SimpleSpan.nowMicros(); //å°±æ˜¯åœ¨è¿™é‡Œåˆå§‹åŒ–startTimeçš„ } //è¿™é‡Œè§¦å‘SimpleSpançš„æ„é€ æ–¹æ³•ï¼Œä¹‹å‰çš„referencesä¼šè¢«ä¼ å…¥ï¼Œæ­¤å¤–åˆå§‹åŒ–çš„tagä¿¡æ¯ã€titleã€å¼€å§‹æ—¶é—´ç­‰ä¹Ÿä¼šè¢«ä¼ å…¥å‚ä¸åˆå§‹åŒ– return new SimpleSpan(SimpleTracer.this, title, startMicros, initialTags, references); } }} ä»£ç å—1 ä¸Šé¢æ”¾äº†SimpleTracerçš„ä»£ç ç‰‡æ®µï¼Œå…³é”®ä¿¡æ¯å·²æ ‡æ³¨ï¼Œè¿™ä¸ªç±»çš„ä½œç”¨å°±æ˜¯å¸®åŠ©åˆ›å»ºspanï¼Œä¸Šé¢è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯sampledæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨æ¥ç”Ÿæˆè¿™æ¬¡é“¾è·¯æ˜¯å¦ä¸ŠæŠ¥ï¼ˆä¹Ÿå°±æ˜¯é‡‡æ ·ç‡ï¼Œå®é™…çš„è¿½è¸ªç³»ç»Ÿä¸å¯èƒ½æ¯æ¬¡çš„è¯·æ±‚éƒ½ä¸ŠæŠ¥ï¼Œå¯¹äºä¸€äº›QPSè¾ƒé«˜çš„ç³»ç»Ÿï¼Œä¼šå¸¦æ¥é¢å¤–å¤§é‡çš„å­˜å‚¨æ•°æ®ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªä¸ŠæŠ¥ç‡ï¼‰ï¼Œä¸‹é¢æ¥ç®€å•çœ‹ä¸‹ä¸ŠæŠ¥ç‡çš„å®ç°ï¼š 12345678910111213141516171819202122232425262728293031public class PushUtils { public static final Random random = new Random(); private static final Map&lt;String, Long&gt; requestMap = Maps.newConcurrentMap(); public static boolean sampled(String uri) { if (Strings.isNullOrEmpty(uri)) { return false; } Long start = requestMap.get(uri); Long end = System.currentTimeMillis(); if (start == null) { requestMap.put(uri, end); return true; } if ((end - start) &gt;= 60000) { //è·ç¦»ä¸Šæ¬¡ä¸ŠæŠ¥å·²ç»è¶…è¿‡1minäº† requestMap.put(uri, end); return true; } else { // æ²¡è¶…è¿‡1minï¼Œåˆ™æŒ‰ç…§1/1000çš„æ¦‚ç‡ä¸ŠæŠ¥ if (random.nextInt(999) == 0) { requestMap.put(uri, end); return true; } } return false; }} ä»£ç å—2 è¿™ç§æ˜¯æ¯”è¾ƒé€‚ä¸­çš„åšæ³•ï¼Œå¦‚æœ1minå†…æ²¡æœ‰ä¸ŠæŠ¥ä¸€æ¬¡ï¼Œåˆ™å¿…å®šä¸ŠæŠ¥ï¼Œå¦‚æœ1minå†…è¿ç»­ä¸ŠæŠ¥å¤šæ¬¡ï¼Œåˆ™æŒ‰ç…§åƒåˆ†ä¹‹ä¸€çš„æ¦‚ç‡ä¸ŠæŠ¥ï¼Œè¿™æ ·æ—¢ä¿è¯äº†ä½QPSçš„ç³»ç»Ÿå¯ä»¥æœ‰ç›¸å¯¹è¾ƒå¤šçš„é“¾è·¯æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä¿è¯é«˜QPSçš„ç³»ç»Ÿå¯ä»¥æœ‰ç›¸å¯¹è¾ƒå°‘çš„é“¾è·¯æ•°æ®ã€‚ ä¸‹é¢æ¥çœ‹ä¸‹SimpleSpançš„å…³é”®ä»£ç æ®µï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788// é“¾è·¯Spanï¼Œå®ç°æ ‡å‡†é‡Œçš„Spanæ¥å£public class SimpleSpan implements Span { private final SimpleTracer simpleTracer; //é“¾è·¯è¿½è¸ªå¯¹è±¡ï¼ˆä¸€æ¬¡è¿½è¸ªå»ºè®®ç”Ÿæˆä¸€ä¸ªé“¾è·¯å¯¹è±¡ï¼Œå°½é‡ä¸è¦ç”¨å•ä¾‹ï¼Œä¼šæœ‰åŒæ­¥é”å½±å“å¹¶å‘æ•ˆç‡ï¼‰ private final long parentId; // çˆ¶spanè¯¥å€¼ä¸º0 private final long startTime; // è®¡æ—¶å¼€å§‹å¼€å§‹æ—¶é—´æˆ³ private final Map&lt;String, Object&gt; tags; //ä¸€äº›æ‰©å±•ä¿¡æ¯ private final List references; // å…³ç³»ï¼Œå¤–éƒ¨ä¼ å…¥ private final List errors = new ArrayList&lt;&gt;(); private SimpleSpanContext context; // spanContext,å†…éƒ¨åŒ…å«traceIdã€spanè‡ªèº«id private boolean finished; // å½“å‰spanæ˜¯å¦ç»“æŸæ ‡è¯† private long endTime; // è®¡æ—¶ç»“æŸæ—¶é—´æˆ³ private boolean sampled; // æ˜¯å¦ä¸ºæŠ½æ ·æ•°æ®ï¼Œå–å†³äºçˆ¶èŠ‚ç‚¹ï¼Œä¾æ¬¡å«¡ä¼ ä¸‹æ¥ç»™å…¶å­èŠ‚ç‚¹ private String project; // è¿½è¸ªç›®æ ‡çš„é¡¹ç›®å private String title; //æ–¹æ³•å SimpleSpan(SimpleTracer tracer, String title, long startTime, Map&lt;String, Object&gt; initialTags, List refs) { this.simpleTracer = tracer; // è¿™é‡Œä¼ å…¥çš„traceræ˜¯é’ˆå¯¹æœ¬æ¬¡è·Ÿè¸ªè¿‡ç¨‹å”¯ä¸€å¯¹è±¡ï¼Œè´Ÿè´£æ”¶é›†å·²å®Œæˆçš„span this.title = title; this.startTime = startTime; this.project = tracer.getProject(); this.sampled = tracer.isSampled(); //æ˜¯å¦ä¸ŠæŠ¥ï¼Œè¯¥å­—æ®µæ ¹æ®å…·ä½“çš„é‡‡æ ·ç‡æ–¹æ³•ç”Ÿæˆ if (initialTags == null) { this.tags = new HashMap&lt;&gt;(); } else { this.tags = new HashMap&lt;&gt;(initialTags); } if (refs == null) { //spanå¯¹è±¡ç”±tracerå¯¹è±¡åˆ›å»ºï¼Œåˆ›å»ºæ—¶ä¼šæŠŠçˆ¶å­å…³ç³»ä¼ å…¥ this.references = Collections.emptyList(); } else { this.references = new ArrayList&lt;&gt;(refs); } SimpleSpanContext parent = findPreferredParentRef(this.references); //æŸ¥çœ‹æ˜¯å¦å­˜åœ¨çˆ¶span if (parent == null) { //é€šå¸¸çˆ¶spanä¸ºç©ºçš„æƒ…å†µï¼Œéƒ½æ˜¯é“¾è·¯å¼€å§‹çš„åœ°æ–¹ï¼Œè¿™é‡Œä¼šç”ŸæˆtraceId // å½“å‰é“¾è·¯è¿˜ä¸å­˜åœ¨çˆ¶spanï¼Œåˆ™æœ¬æ¬¡spanå°±ç½®ä¸ºçˆ¶spanï¼Œä¸‹é¢ä¼šç”ŸæˆtraceIdå’Œå½“å‰çˆ¶spançš„spanId this.context = new SimpleSpanContext(nextId(), nextId(), new HashMap&lt;&gt;()); this.parentId = 0; //çˆ¶spançš„parentIdæ˜¯0 } else { // å½“å‰é“¾è·¯å·²ç»å­˜åœ¨çˆ¶spanäº†ï¼Œé‚£ä¹ˆå­spançš„parentIdç½®ä¸ºå½“å‰çˆ¶spançš„idï¼Œè¡¨ç¤ºå½“å‰spanæ˜¯å±äºè¿™ä¸ªçˆ¶spançš„å­spanï¼ŒåŒæ—¶traceIdä¹Ÿå»¶ç”¨çˆ¶spançš„ï¼ˆè¡¨ç¤ºå±äºåŒä¸€é“¾è·¯ï¼‰ this.context = new SimpleSpanContext(parent.traceId, nextId(), mergeBaggages(this.references)); this.parentId = parent.spanId; } } @Nullable private static SimpleSpanContext findPreferredParentRef(List references) { if (references.isEmpty()) { return null; } for (Reference reference : references) { if (References.CHILD_OF.equals(reference.getReferenceType())) { //ç°æœ‰çš„referenceä¸­å­˜åœ¨çˆ¶å­å…³ç³»ï¼ˆç®€å•ç†è§£ï¼Œè¿™ä¸ªå…³ç³»å°±æ˜¯BuildSpançš„æ—¶å€™ä¼ å…¥çš„ï¼‰ return reference.getContext(); //è¿”å›çˆ¶spançš„contextä¿¡æ¯ï¼ˆåŒ…å«traceIdå’Œå®ƒçš„spanIdï¼‰ } } return references.get(0).getContext(); } @Override public synchronized void finish(long endTime) { finishedCheck(\"å½“å‰spanå¤„äºå®Œæˆæ€\"); this.endTime = endTime; this.simpleTracer.appendFinishedSpan(this); //spanå®Œæˆæ—¶æ”¾è¿›é“¾è·¯å¯¹è±¡çš„finishedSpansé›†åˆé‡Œ this.finished = true; } // SimpleSpançš„å†…éƒ¨ç±»SimpleSpanContextï¼Œå­˜æ”¾å½“å‰Spançš„idã€é“¾è·¯idï¼Œå®ç°äº†æ ‡å‡†é‡Œçš„SpanContextæ¥å£ public static final class SimpleSpanContext implements SpanContext { private final long traceId; //é“¾è·¯id private final Map&lt;String, String&gt; baggage; private final long spanId; //spanId public SimpleSpanContext(long traceId, long spanId, Map&lt;String, String&gt; baggage) { this.baggage = baggage; this.traceId = traceId; this.spanId = spanId; } } public static final class Reference { //ç”¨äºå»ºç«‹Spané—´å…³ç³»çš„å†…éƒ¨ç±» private final SimpleSpanContext context; //å­˜æ”¾äº†æŸä¸€ä¸ªSpançš„contextï¼ˆç”¨äºè·Ÿå½“å‰spanå»ºç«‹å…³ç³»æ—¶ä½¿ç”¨ï¼‰ private final String referenceType; //å…³ç³»ç±»å‹ï¼Œç›®å‰æœ‰ä¸¤ç§ï¼šchild_ofå’Œfollows_fromï¼Œç¬¬ä¸€ç§ä»£è¡¨å½“å‰spanæ˜¯ä¸Šé¢contexté‡Œspançš„å­spanï¼Œç¬¬äºŒä¸ªåˆ™è¡¨ç¤ºåŒçº§é¡ºåºå…³ç³» public Reference(SimpleSpanContext context, String referenceType) { this.context = context; this.referenceType = referenceType; } }} ä»£ç å—3 ä¸Šé¢å°±æ˜¯SimpleSpançš„å…³é”®å®ç°ï¼Œå…³é”®ç‚¹å·²æ ‡æ³¨ï¼Œä¸‹é¢æ¥çœ‹ä¸‹æ•°æ®ä¸ŠæŠ¥è¿™é‡Œçš„å®ç°ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647public class PushHandler { private static final PushHandler handler = new PushHandler(); private BlockingQueue queue; private PushHandler() { this.queue = new LinkedBlockingQueue&lt;&gt;(); //æ•°æ®ç®¡é“ new Thread(this::pushTask).start(); } public static PushHandler getHandler() { return handler; } public void pushSpan(SimpleSpan span) { queue.offer(span); } private void pushTask() { if (queue != null) { SimpleSpan span; while (true) { try { span = queue.take(); //ä¸ºäº†æµ‹è¯•ï¼Œè¿™é‡Œåªæ‰“å°äº†åŸºæœ¬ä¿¡æ¯ï¼Œå®é™…ç¯å¢ƒä¸­è¿™é‡Œéœ€è¦åšæ•°æ®æ¨é€ï¼ˆkafkaã€UnixSocketç­‰ï¼‰ StringBuilder sb = new StringBuilder() .append(\"tracerId=\") .append(span.context().traceId()) .append(\", parentId=\") .append(span.parentId()) .append(\", spanId=\") .append(span.context().spanId()) .append(\", title=\") .append(span.title()) .append(\", è€—æ—¶=\") .append((span.endTime() / 1000000) - (span.startTime() / 1000000)) .append(\"ms, tags=\") .append(span.tags().toString()); System.out.println(sb.toString()); } catch (InterruptedException e) { e.printStackTrace(); } } } }} ä»£ç å—4 åªæ˜¯åšäº†ç®€å•çš„æµ‹è¯•ï¼Œæ‰€ä»¥å¤„ç†é€»è¾‘åªæ˜¯ç®€å•çš„åšäº†æ‰“å°ï¼Œå®é™…å½“ä¸­è¿™é‡Œè¦ä¸ŠæŠ¥é“¾è·¯æ•°æ®ï¼ˆspansï¼‰ã€‚è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—åšæ•°æ®æ¥æ”¶çš„ç¼“å†²åŒºã€‚ è¿™å¥—å®ç°æ˜¯éå¸¸ç®€å•çš„ï¼Œåªè¿›è¡Œç®€å•çš„è®¡æ—¶ã€æ¨é€ï¼Œå¹¶æ²¡æœ‰æ¶‰åŠactiveæ–¹å¼çš„ç”¨æ³•ï¼Œä¸€åˆ‡åˆ›å»ºã€å»ºç«‹çˆ¶å­å…³ç³»å‡äº¤ç”±å¼€å‘äººå‘˜è‡ªå·±æŠŠæ§ï¼Œæ¸…æ™°åº¦ä¹Ÿæ›´é«˜äº›ã€‚ ä»£ç å®Œæ•´åœ°å€ï¼šsimple-trace ä¸‰ã€simple-traceçš„ä½¿ç”¨çœ‹äº†ä¸Šé¢çš„å®ç°ï¼Œè¿™é‡Œåˆ©ç”¨simple-traceæ¥è¿›è¡Œç¨‹åºè¿½è¸ªï¼Œçœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384public class SimpleTest { private SimpleTracer tracer = null; private SimpleSpan parent = null; //å‡è®¾è¿™é‡Œæ˜¯é“¾è·¯å¼€å§‹çš„åœ°æ–¹ @Test public void test1() { //åˆ›å»ºé“¾è·¯ tracer = new SimpleTracer(\"test1\", \"projectName\"); parent = tracer.buildSpan(\"test1\") .withTag(SpanTags.COMPONENT, \"http\") .withTag(SpanTags.SPAN_KIND, \"server\") .start(); //spanå¼€å§‹ //-------------------------------------------------- String result1 = getResult1(); //å‡è®¾getResult1éœ€è¦é“¾è·¯è¿½è¸ª System.out.println(\"r1 = \" + result1); String result2 = getResult2(); //å‡è®¾getResult2éœ€è¦é“¾è·¯è¿½è¸ª System.out.println(\"r2 = \" + result2); //-------------------------------------------------- //ä¸‹é¢æ ‡è®°ç€ä¸€æ¬¡é“¾è·¯è¿½è¸ªçš„ç»“æŸ parent.finish(); //ä¸»spanç»“æŸ tracer.pushSpans(); //è§¦å‘spanæ•°æ®æ¨é€ } public String getResult1() { //å‰æˆï¼Œå»ºç«‹getResult1è‡ªå·±çš„è¿½è¸ªspan SimpleSpan currentSpan = null; if (tracer != null &amp;&amp; parent != null) { //å½“å‰é“¾è·¯è§†ä¸ºtest1æ–¹æ³•çš„å­é“¾è·¯ï¼Œå»ºç«‹çˆ¶å­å…³ç³» SimpleSpan.SimpleSpanContext context = new SimpleSpan.SimpleSpanContext(parent.context().traceId(), parent.context().spanId(), new HashMap&lt;&gt;()); //å»ºç«‹çˆ¶å­å…³ç³»ï¼ŒtraceIdå’Œçˆ¶spanIdè¢«æŒ‡å®š currentSpan = tracer.buildSpan(\"getResult1\") .addReference(References.CHILD_OF, context) .withTag(SpanTags.COMPONENT, \"redis\") .withTag(SpanTags.SPAN_KIND, \"client\").start(); //å¯åŠ¨è‡ªå·±çš„è¿½è¸ªspan } try { Thread.sleep(1000L); return \"result1\"; } catch (InterruptedException e) { e.printStackTrace(); return \"\"; } finally { if (currentSpan != null) { currentSpan.finish(); //æœ€åå®Œæˆæœ¬æ¬¡é“¾è·¯è¿½è¸ª } } } public String getResult2() { //å‰æˆï¼Œå»ºç«‹getResult2è‡ªå·±çš„è¿½è¸ªspan SimpleSpan currentSpan = null; if (tracer != null &amp;&amp; parent != null) { //å½“å‰é“¾è·¯è§†ä¸ºtest2æ–¹æ³•çš„å­é“¾è·¯ï¼Œå»ºç«‹çˆ¶å­å…³ç³» SimpleSpan.SimpleSpanContext context = new SimpleSpan.SimpleSpanContext(parent.context().traceId(), parent.context().spanId(), new HashMap&lt;&gt;()); //å»ºç«‹çˆ¶å­å…³ç³»ï¼ŒtraceIdå’Œçˆ¶spanIdè¢«æŒ‡å®š currentSpan = tracer.buildSpan(\"getResult2\") .addReference(References.CHILD_OF, context) .withTag(SpanTags.COMPONENT, \"redis\") .withTag(SpanTags.SPAN_KIND, \"client\").start(); //å¯åŠ¨è‡ªå·±çš„è¿½è¸ªspan } try { Thread.sleep(2000L); return \"result2\"; } catch (InterruptedException e) { e.printStackTrace(); return \"\"; } finally { if (currentSpan != null) { currentSpan.finish(); //æœ€åå®Œæˆæœ¬æ¬¡é“¾è·¯è¿½è¸ª } } }} ä»£ç å—5 è¿è¡Œç»“æœï¼š 12345r1 = result1r2 = result2tracerId=1507767477962777317, parentId=2107142446015091038, spanId=5095502823334701185, title=getResult1, è€—æ—¶=1555839336570 - 1555839335569 = 1001ms, tags={span.kind=client, component=redis}tracerId=1507767477962777317, parentId=2107142446015091038, spanId=9071431876337611242, title=getResult2, è€—æ—¶=1555839338572 - 1555839336571 = 2001ms, tags={span.kind=client, component=redis}tracerId=1507767477962777317, parentId=0, spanId=2107142446015091038, title=test1, è€—æ—¶=1555839338572 - 1555839334687 = 3885ms, tags={span.kind=server, component=http} é€šè¿‡è¯¥å®ä¾‹ï¼Œå…³äºsimple-traceçš„åŸºæœ¬ç”¨æ³•å·²ç»å±•ç¤ºå‡ºæ¥äº†ï¼ˆåˆ›å»ºtracerã€spanã€å»ºç«‹å…³ç³»ã€tagsã€finishç­‰ï¼‰ï¼Œçœ‹ä¸‹æ‰“å°ç»“æœï¼ˆæ‰“å°ç»“æœå°±æ˜¯simple-traceæ¨é€æ•°æ®æ—¶ç›´æ¥æ‰“å°çš„ï¼Œè€—æ—¶æ˜¯æ ¹æ®startTimeå’ŒendTimeæ¨ç®—å‡ºæ¥çš„ï¼‰ï¼Œçˆ¶å­å…³ç³»å»ºç«‹å®Œæˆï¼Œå‡å¦‚è¯´è¿™äº›æ•°æ®å·²ç»è½åº“å®Œæˆï¼Œé‚£ä¹ˆé€šè¿‡é“¾è·¯ç³»ç»Ÿçš„APIè§£æå’Œå‰ç«¯æ¸²æŸ“ï¼Œä¼šå˜æˆä¸‹é¢è¿™æ ·ï¼ˆç»˜å›¾å’Œä¸Šé¢æµ‹è¯•ç»“æœä¸æ˜¯åŒä¸€æ¬¡ï¼Œæ‰€ä»¥å›¾é‡Œè€—æ—¶è·Ÿä¸Šé¢æ‰“å°çš„è€—æ—¶ä¸ä¸€è‡´ğŸ˜­ï¼‰ï¼š æœ¬ç¯‡ä¸è®¨è®ºå›¾å¦‚ä½•ç”Ÿæˆï¼Œå¯ä»¥è¯´ä¸‹åç«¯å¯ä»¥ç»™å‰ç«¯æä¾›çš„æ¥å£ç»“æ„ä»¥åŠç»„è£…æ–¹å¼ï¼šé¦–å…ˆå¯ä»¥æ ¹æ®traceIdæŸ¥å‡ºæ¥æ‰€æœ‰ç›¸å…³spanï¼Œç„¶åæ ¹æ®parentIdè¿›è¡Œå°è£…å±‚çº§ï¼Œæ¯”å¦‚å›¾4çš„APIç»“æ„å¤§è‡´ä¸Šå¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142{ \"spanId\": 2107142446015091038, \"traceId\": 1507767477962777317, \"parentId\": 0, \"title\": \"test1\", \"project\": \"projectName\", \"startTime\": 1555839334687, \"endTime\": 1555839338572, \"tags\": { \"span.kind\": \"server\", \"component\": \"http\" }, \"children\": [{ \"spanId\": 5095502823334701185, \"traceId\": 1507767477962777317, \"parentId\": 2107142446015091038, \"title\": \"getResult1\", \"project\": \"projectName\", \"startTime\": 1555839335569, \"endTime\": 1555839336570, \"tags\": { \"span.kind\": \"client\", \"component\": \"redis\" }, \"children\": [] }, { \"spanId\": 9071431876337611242, \"traceId\": 1507767477962777317, \"parentId\": 2107142446015091038, \"title\": \"getResult2\", \"project\": \"projectName\", \"startTime\": 1555839336571, \"endTime\": 1555839338572, \"tags\": { \"span.kind\": \"client\", \"component\": \"redis\" }, \"children\": [] } ]} åŒ…è£…æˆä¸Šé¢çš„ç»“æ„ï¼Œå‰ç«¯æ ¹æ®å±‚çº§å…³ç³»ã€startTimeã€endTimeè¿›è¡Œè°ƒç”¨æ ‘å’Œæ—¶é—´è½´çš„æ¸²æŸ“å³å¯ï¼Œåœ¨å®é™…ç”Ÿäº§ä¸­ï¼Œè¿™ä¸ªå±‚çº§æ ‘å¯èƒ½æ›´åŠ åºå¤§ï¼Œæ¯”å¦‚å›¾2ã€‚ åŸºæœ¬ä½¿ç”¨å¾ˆç®€å•ï¼Œé‚£ä¹ˆåŸºäºç®€å•çš„ä¾‹å­å†è¿›è¡Œä¸€å±‚æŠ½è±¡ï¼Œå¦‚æœåœ¨ç”Ÿå®é™…é¡¹ç›®ä¸­ï¼Œå°±ä¸èƒ½å•å•åƒä¸Šé¢é‚£æ ·ä½¿ç”¨äº†ï¼Œéœ€è¦å°è£…ã€è§£è€¦ï¼Œé‚£ä¹ˆå®é™…é¡¹ç›®ä¸­ä¸€èˆ¬ä¼šé€šè¿‡æ€æ ·çš„æ–¹å¼æ¥ä½¿ç”¨å‘¢ï¼Ÿè·¨ç³»ç»Ÿçš„æ—¶å€™å¦‚ä½•å»ºç«‹å±‚çº§å…³ç³»å‘¢ï¼Ÿä¸‹é¢é’ˆå¯¹å›¾2ä¸­çš„ä¾‹å­ï¼Œè¿›è¡Œç®€å•çš„æ–¹æ¡ˆè®¾è®¡ï¼ˆå›¾2è¿‡äºå¤æ‚ï¼Œè¿™é‡Œåªè¯´æœåŠ¡Açš„è°ƒç”¨é“¾è·¯ï¼Œå…¶ä½™æŒ‰ç…§æœåŠ¡Aç±»æ¨å³å¯ï¼‰ï¼Œä¸‹é¢å°†ä¼šé‡‡ç”¨ä¼ªä»£ç çš„æ–¹å¼è¿›è¡Œè¯´æ˜é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œå®é™…å½“ä¸­éœ€è¦è‡ªå·±æŒ‰ç…§å®ç°æ€è·¯è‡ªè¡Œå°è£…ã€‚ ç°åœ¨å¼•å…¥ä¸¤ä¸ªæ¦‚å¿µï¼Œæ‹¦æˆªå™¨å’ŒContextï¼ˆä¸Šä¸‹æ–‡ï¼‰ï¼Œå®ƒä»¬å±äºæ­£å¸¸ä¸šåŠ¡ä¸­å¸¸ç”¨çš„æ¦‚å¿µï¼ŒContextæ˜¯æŒ‡ä¸€æ¬¡è°ƒç”¨äº§ç”Ÿçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¸Šä¸‹æ–‡ä¿¡æ¯å¯ä»¥åœ¨å•æ¬¡ç¨‹åºè°ƒç”¨ä¸­çš„ä»»æ„ä½ç½®å–åˆ°ï¼Œä¸€èˆ¬ä¸Šä¸‹æ–‡éƒ½æ˜¯åˆ©ç”¨ThreadLocalï¼ˆç®€ç§°TLï¼‰å®ç°çš„ï¼Œçº¿ç¨‹æœ¬åœ°å˜é‡ï¼Œå•çº¯ç†è§£å°±æ˜¯åªè¦æœ¬æ¬¡è°ƒç”¨çš„ä¿¡æ¯éƒ½å¤„äºåŒä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆä»»æ„åœ°æ–¹éƒ½å¯ä»¥é€šè¿‡TLå¯¹è±¡æ‹¿åˆ°ä¸Šä¸‹æ–‡å¯¹è±¡ä¿¡æ¯ï¼Œä½†æ˜¯ç”±äºç³»ç»Ÿçš„å¤æ‚åº¦è¶Šæ¥è¶Šé«˜ï¼Œä¸€äº›åœ°æ–¹ä¼šé‡‡ç”¨çº¿ç¨‹æ± æ¥è¿›è¡Œä¼˜åŒ–ä¸šåŠ¡ä»£ç ï¼Œæ¯”å¦‚ä¸€æ¬¡è°ƒç”¨å¯èƒ½ä¼šåˆ©ç”¨CompletableFutureæ¥è¿›è¡Œå¼‚æ­¥ä»»åŠ¡è°ƒåº¦æ¥ä¼˜åŒ–å½“å‰ä»£ç æ‰§è¡Œæ•ˆç‡ï¼Œè¿™ä¸ªæ—¶å€™å•çº¯ä½¿ç”¨TLå°±åŠä¸æˆäº‹å„¿äº†ï¼Œè€Œä½¿ç”¨InheritableThreadLocalï¼ˆç®€ç§°ITLï¼‰åˆè§£å†³ä¸äº†çº¿ç¨‹æ± ä¼ é€’é—®é¢˜ï¼Œäºæ˜¯å°±æœ‰äº†é˜¿é‡Œæ¨å‡ºçš„TransmittableThreadLocalï¼ˆç®€ç§°TTLï¼‰ï¼Œè¿™ä¸ªå¯ä»¥å®Œç¾è§£å†³è·¨çº¿ç¨‹ä¼ é€’ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆä¸ç®¡æ˜¯new Threadè¿˜æ˜¯çº¿ç¨‹æ± ï¼Œéƒ½å¯ä»¥å‡†ç¡®ä¼ é€’ï¼‰ï¼Œå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä»¿ç…§TTLçš„å®ç°ï¼Œç®€å•ä»£ç†çº¿ç¨‹æ± å¯¹è±¡ï¼Œä»ç„¶ä½¿ç”¨TLå®ç°è·¨çº¿ç¨‹ä¼ é€’ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼ŒTLç³»åˆ—æ–‡ç« ä¼ é€é—¨ï¼šThreadLocalã€InheritableThreadLocalã€TransmittableThreadLocal ä¸‹é¢æ˜¯å…³äºç³»ç»Ÿä¸Šä¸‹æ–‡çš„ç®€å•å®šä¹‰ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849//è‡ªå®šä¸Šä¸‹æ–‡ç±»public class Context { private SimpleTracer simpleTracer; //å½“å‰é“¾è·¯å¯¹è±¡ private SimpleSpan parent; //å½“å‰é“¾è·¯å…¨å±€çˆ¶span //ä¹Ÿå¯ä»¥æ”¾å¾ˆå¤šåˆ«çš„ä¸Šä¸‹æ–‡å†…å®¹ï¼Œè¿™é‡Œçœç•¥... public SimpleTracer getSimpleTracer() { return simpleTracer; } public void setSimpleTracer(SimpleTracer simpleTracer) { this.simpleTracer = simpleTracer; } public SimpleSpan getParent() { return parent; } public void setParent(SimpleSpan parent) { this.parent = parent; }}public class ContextHolder { //è¿™é‡Œä»…ç”¨TLç®€å•å®ç°ï¼Œå¦‚æœé¡¹ç›®é‡Œä½¿ç”¨äº†çº¿ç¨‹æ± ï¼Œé‚£ä¹ˆè¿™é‡Œçš„å®ç°è¦å˜æˆTTLï¼Œå¹¶è®©TTLä»£ç†å…¨å±€çš„çº¿ç¨‹æ± å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨TTLï¼Œè‡ªå·±ä»£ç†çº¿ç¨‹æ± å¯¹è±¡ï¼Œè¿™é‡Œä¸å†è¯¦è¿° private static ThreadLocal contextThreadLocal = new ThreadLocal&lt;&gt;(); private ContextHolder() { } public static void removeContext() { contextThreadLocal.remove(); } public static Context getContext() { return contextThreadLocal.get(); } public static void setContext(Context context) { if (context == null) { removeContext(); } contextThreadLocal.set(context); }} ä»£ç å—6 æˆ‘ä»¬æŠŠé“¾è·¯å¯¹è±¡å’Œé“¾è·¯ç¬¬ä¸€æ¬¡äº§ç”Ÿçš„çˆ¶spanæ”¾åˆ°ä¸Šä¸‹æ–‡ï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨è¿™æ¬¡è°ƒç”¨çš„ä»»æ„ä½ç½®é€šè¿‡ContextHolderè·å–åˆ°å½“å‰é“¾è·¯å¯¹è±¡ï¼ˆä¼ªä»£ç ä¼šå‡ºç°è¯¥ç±»ï¼‰ï¼Œä¸‹é¢æ¥ç»“åˆå›¾2çš„AæœåŠ¡é“¾è·¯ï¼Œç»“åˆaopæ€æƒ³ï¼Œå†™ä¸€æ¬¡ä»å›¾2APIè°ƒç”¨å¼€å§‹åˆ°Redis01è°ƒç”¨ç»“æŸçš„ä»£ç ã€‚ æŒ‰ç…§æµç¨‹ï¼ŒAPIå±äºä¸€æ¬¡Httpè°ƒç”¨ï¼Œä¹Ÿæ˜¯é“¾è·¯å…¥å£ï¼Œé‚£ä¹ˆåˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œå’ŒHttpæœåŠ¡çš„æ‹¦æˆªå™¨åŠŸèƒ½ï¼ˆå¤§éƒ¨åˆ†ç³»ç»Ÿéƒ½ä¼šç”¨åˆ°ä¸€ä¸ªhttpè°ƒç”¨çš„æ‹¦æˆªå™¨ï¼Œä¸€èˆ¬ä¸Šä¸‹æ–‡ä¹Ÿæ˜¯è¿™é‡Œäº§ç”Ÿçš„ï¼‰ï¼Œä¼ªä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354public class ApiInterceptor { //å¼€å§‹Httpå¤„ç†è¯·æ±‚ä¹‹å‰è¦åšçš„ï¼Œä¸€èˆ¬è¿™é‡Œäº§ç”Ÿä¸Šä¸‹æ–‡ï¼Œå¹¶äº¤ç»™TLä¼ é€’ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œè¿™é‡Œä¹Ÿæ˜¯é“¾è·¯åˆå§‹åŒ–çš„åœ°æ–¹ public void beforeHandle(Request request) { Context context = new Context(); //ä¸Šä¸‹æ–‡å¯¹è±¡ SimpleTracer tracer = null; SimpleSpan parent = null; //è¿™é‡Œæ˜¯ä¸ºè·¨ç³»ç»Ÿè°ƒç”¨åšçš„åè®®å¤´ä¼ é€’ï¼Œå› ä¸ºæˆ‘ä»¬è¿™ä¸ªAPIä¹Ÿå¯èƒ½æ˜¯å…¬å¸å†…åˆ«çš„ä¸šåŠ¡æ–¹å†…éƒ¨è°ƒç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±éœ€è¦çº¦å®šåè®®å¤´ï¼Œä¸€æ—¦åè®®å¤´ä¸­å¸¦æœ‰çº¦å®šå¥½çš„é“¾è·¯å­—æ®µï¼Œé‚£ä¹ˆå°±è®¤ä¸ºæˆ‘ä»¬è¿™ä¸ªAPIæœ¬æ¬¡è°ƒç”¨ç›¸å¯¹äºåˆ«çš„ç³»ç»Ÿæ˜¯ä¸ªå­é“¾è·¯ String traceId = request.headers.get(\"x1-trace-id\"); //æ‹¿åˆ°åè®®å¤´çš„çˆ¶é“¾è·¯idï¼Œå­é“¾è·¯ç»§æ‰¿ä¹‹ String parentId = request.headers.get(\"x1-span-id\"); //æ‹¿åˆ°åè®®å¤´çš„çˆ¶spanä¿¡æ¯ String sampled = request.headers.get.get(\"x1-sampled\"); //æ˜¯å¦ä¸ŠæŠ¥ if (traceId != null &amp;&amp; parentId != null &amp;&amp; sampled == true) { tracer = new SimpleTracer(request.getUri, \"æ‰€å±é¡¹ç›®å\"); //è¿™é‡Œç”¨urlå½“æˆæ˜¯åˆå§‹åŒ–spançš„title // ç¬¦åˆè¿™ç§æƒ…å†µçš„ï¼Œæˆ‘ä»¬è¿™é‡Œçš„parentå…¶å®åªæ˜¯ä¸€ä¸ªç›¸å¯¹äºåˆ«çš„ç³»ç»Ÿçš„child SimpleSpan.SimpleSpanContext simpleSpanContext = new SimpleSpan.SimpleSpanContext(traceId, parentId, new HashMap&lt;&gt;()); parent = tracer.buildSpan(request.getUri) .addReference(References.CHILD_OF, simpleSpanContext) //å»ºç«‹çˆ¶å­å…³ç³»ï¼Œå¦‚æœæ˜¯åˆ«çš„ä¸šåŠ¡æ–¹è°ƒç”¨æˆ‘ä»¬è¿™ä¸ªhttpæœåŠ¡ï¼Œé‚£ä¹ˆè¿™é‡Œè¿™ä¸€æ­¥ï¼Œä¹Ÿå°±å»ºç«‹äº†è·Ÿè°ƒç”¨æ–¹çš„çˆ¶å­å…³ç³»ï¼ŒtraceIdç­‰æ˜¯ç»§æ‰¿çš„è°ƒç”¨æ–¹çš„ï¼Œæ„å‘³ç€æœ¬æ¬¡è°ƒç”¨ä¹Ÿå±äºè°ƒç”¨æ–¹çš„ä¸€ç¯ï¼Œè¿™ä¹Ÿå°±å®ç°äº†è·¨ç³»ç»Ÿçš„é“¾è·¯è¿½è¸ª .withTag(SpanTags.COMPONENT, \"http\") .withTag(SpanTags.SPAN_KIND, \"server\").start(); //å¯åŠ¨span } else { //æ‰§è¡Œelseï¼Œè¯´æ˜è¯¥httpè°ƒç”¨æ˜¯ä¸€æ¬¡è‡ªå·±å®Œæ•´çš„è°ƒç”¨ï¼Œä¸å±äºä»»ä½•çˆ¶é“¾è·¯ï¼Œé‚£ä¹ˆå°±æ— éœ€å»ºç«‹å…³ç³»ï¼Œç›´æ¥åˆå§‹åŒ–tracerå³å¯ tracer = new SimpleTracer(request.getUri, \"æ‰€å±é¡¹ç›®å\"); parent = tracer.buildSpan(request.getUri) .withTag(SpanTags.COMPONENT, \"http\") .withTag(SpanTags.SPAN_KIND, \"server\") .start(); //å¯åŠ¨span } //å°†å°è£…å¥½çš„tracerå’ŒparentSpanè®¾ç½®åˆ°ä¸Šä¸‹æ–‡å¯¹è±¡é‡Œå» context.setSimpleTracer(tracer); context.setParent(parent); ContextHolder.setContext(context); //å°†æœ¬æ¬¡è¯·æ±‚ç”Ÿæˆçš„ä¸Šä¸‹æ–‡å¯¹è±¡æ”¾è¿›ContextHolderï¼ˆä¹Ÿå°±æ˜¯TLé‡Œï¼‰ï¼Œæ–¹ä¾¿åœ¨ä»»æ„ä½ç½®å–å‡ºä½¿ç”¨ } //ä¸šåŠ¡é€»è¾‘å¤„ç†ä¸­ public void hadle() { //æœ¬æ¬¡APIè¯·æ±‚å®é™…èµ°çš„ä¸šåŠ¡é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯AæœåŠ¡è°ƒç”¨ã€BæœåŠ¡è°ƒç”¨ç­‰è¿™äº›å®é™…çš„ä¸šåŠ¡é€»è¾‘å¤„ç† doing(); } //Httpä¸šåŠ¡å¤„ç†å®Œæˆåçš„è§¦å‘ public void afterHandler() { //Httpè°ƒç”¨ç»“æŸçš„æ—¶å€™ï¼Œå–å‡ºå½“å‰é“¾è·¯ä¿¡æ¯ï¼Œå®Œæˆæ•°æ®çš„ä¸ŠæŠ¥ SimpleTracer tracer = ContextHolder.getContext().getTracer(); SimpleSpan parent = ContextHolder.getContext().getParent(); if (tracer != null &amp;&amp; parent != null) { parent.finish(); //ç»“æŸæ‰parent Span tracer.pushSpans(); //ä¸ŠæŠ¥è¿™æ¬¡äº§ç”Ÿçš„é“¾è·¯æ•°æ®ï¼ˆspansï¼‰ } }} ä»£ç å—7 é€šè¿‡è¿™ä¸ªå¤–éƒ¨çš„APIé“¾è·¯åŒ…è£…ï¼Œå¯ä»¥çŸ¥é“çš„äº‹æƒ…æ˜¯ä¸Šä¸‹æ–‡åœ¨è¿™é‡Œé¢å……å½“çš„è§’è‰²ï¼ŒAPIè°ƒç”¨æ˜¯ä¸€ä¸ªç³»ç»Ÿçš„å…¥å£ï¼Œè¿™ç§å…¥å£æœ‰å¾ˆå¤šï¼Œä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨éƒ½ä¼šæœ‰ä¸€ä¸ªç±»ä¼¼çš„å…¥å£ï¼Œæ¯”å¦‚RPCè°ƒç”¨ï¼Œè·¨ç³»ç»Ÿåçš„rpcServerç«¯ä¹Ÿæ˜¯ä¸€ä¸ªå…¥å£ï¼Œè¿™ç§å…¥å£çº§çš„æ‹¦æˆªå™¨ï¼Œbeforeé‡Œé¢åšçš„é€šå¸¸éƒ½æ˜¯å»ºç«‹Tracerï¼Œä½†æ˜¯ä»£ç é‡Œä¸æ˜¯ç®€å•çš„åˆ›å»ºä¸€ä¸ªTracerå¯¹è±¡å°±å®Œäº‹å„¿äº†ï¼Œè¿˜æœ‰åè®®å¤´çš„åˆ†æï¼Œé“¾è·¯ç³»ç»Ÿå¦‚ä½•å®ç°è·¨ç³»ç»Ÿçš„ä¼ è¾“å‘¢ï¼Ÿè¿™å°±ç‰µæ‰¯åˆ°åè®®çº¦å®šï¼Œæ¯”å¦‚Httpè¯·æ±‚ï¼Œå¯ä»¥åœ¨åè®®å¤´é‡Œçº¦å®šå‡ ä¸ªç‰¹æ®Šå­—ç¬¦ä¸²æ¥å­˜æ”¾æ¥æºç³»ç»Ÿçš„tracerIdç­‰ï¼Œç»“åˆä¸Šé¢çš„ä¾‹å­ï¼Œå‡å¦‚æˆ‘ä»¬è¿™ä¸ªAPIæ˜¯å…¬å¸å†…åˆ«çš„ç³»ç»ŸAPI01å‘èµ·çš„httpè°ƒç”¨ï¼ŒAPI01æœ¬èº«ä¹Ÿä¼šæœ‰é“¾è·¯è¿½è¸ªï¼ŒAPI01ç³»ç»Ÿå†…å‘èµ·å¯¹æˆ‘ä»¬APIçš„httpè¯·æ±‚ï¼Œè¿™å°±å±äºè·¨ç³»ç»Ÿè°ƒç”¨ï¼Œæˆ‘ä»¬è¿™æ¬¡APIè°ƒç”¨ç›¸å¯¹äºAPI01æ˜¯ä¸€ä¸ªå­é“¾è·¯ï¼Œéœ€è¦å»ºç«‹çˆ¶å­å…³ç³»ï¼Œç»“åˆä¸Šé¢çš„ä¾‹å­ç®€å•ç”»ä¸‹è¿™æ¬¡è°ƒç”¨å›¾ï¼š åŒ…æ‹¬APIçš„å…¶ä»–è·¨ç³»ç»Ÿçš„è°ƒç”¨ï¼Œæ¯”å¦‚AæœåŠ¡çš„è°ƒç”¨ï¼Œä¹Ÿæ˜¯ä½¿ç”¨åŒæ ·çš„åŸç†è¿›è¡Œé“¾è·¯è·¨ç³»ç»Ÿä¼ è¾“çš„ï¼ˆå¾ˆå¤šRPCæ¡†æ¶ä¸Šå±‚åè®®ä¹Ÿæ˜¯æ”¯æŒæ‰©å±•åè®®å¤´ï¼ˆå³åè®®çš„å…ƒæ•°æ®ä¿¡æ¯ï¼‰çš„ï¼Œæ¯”å¦‚grpcçš„ä¸Šå±‚åè®®å°±æ˜¯http2ï¼ŒåŒæ ·æœ‰headerï¼‰ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çœ‹ä¸‹å›¾ä¸­ï¼ˆæˆªè‡ªå›¾2ï¼‰æ ‡çº¢æ¨¡å—å¯¹åº”çš„ä¼ªä»£ç å§ï¼š è¿™å—æ˜¯æŒ‡å½“å‰ç³»ç»Ÿé€šè¿‡rpc clientå‘èµ·å¯¹AæœåŠ¡çš„è°ƒç”¨ï¼Œä»å‘èµ·è°ƒç”¨åˆ°AæœåŠ¡å“åº”ï¼Œè¿™ä¸ªè¿‡ç¨‹ä»ç„¶å±äºAPIè¿™æ¬¡è°ƒç”¨çš„å­spanï¼ˆæ²¡æœ‰å‡ºç³»ç»Ÿï¼‰ï¼Œä½†æ˜¯åˆ°äº†AæœåŠ¡çš„è§¦å‘ï¼Œå°±ç‰µæ‰¯åˆ°è·¨ç³»ç»Ÿï¼ŒAæœåŠ¡çš„é“¾è·¯ç›¸å¯¹äºrpc clientï¼ˆå›¾6æ ‡çº¢çš„æ“ä½œï¼‰çš„spanï¼Œæ˜¯ä¸€ä¸ªå­spanï¼Œé€šè¿‡ä¸Šé¢å¯¹è·¨ç³»ç»Ÿçš„å¤„ç†ï¼Œè¿™é‡Œrpc clienté‡Œä¸€å®šä¼šæŠŠè‡ªèº«çš„spanIdä½œä¸ºAæœåŠ¡çš„parentIdä¼ è¿‡å»ï¼ŒåŒ…æ‹¬traceIdç­‰ï¼Œæ¥çœ‹ä¸‹ä¼ªä»£ç ï¼š 1234567891011121314151617181920212223242526272829public class RpcClient { //ç­‰å¾…æœåŠ¡ç«¯å“åº”æ–¹æ³• public void requestRpc(RpcRequest request) { //è°ƒç”¨å‰æ‰§è¡Œ SimpleSpan span = null; SimpleSpan parent = ContextHolder.getContext().getParent(); SimpleTracer tracer = ContextHolder.getContext().getTracer(); if (tracer != null &amp;&amp; parent != null) {//â†“è¿™ä¸ªtitleå°±è®¾ç½®æˆrpcè°ƒç”¨çš„é‚£ä¸ªæ–¹æ³•åå³å¯ span = tracer.buildSpan(request.getRpcMethod).asChildOf(parent) //å»ºç«‹çˆ¶å­å…³ç³»ï¼Œå› ä¸ºrpc clientè°ƒç”¨å±äºAPIè°ƒç”¨çš„å­é“¾è·¯ .withTag(SpanTags.COMPONENT, \"grpc\") .withTag(SpanTags.PEER_SERVICE, request.getRpcMethod) .withTag(SpanTags.SPAN_KIND, \"client\") .start(); //å¯åŠ¨è¿™ä¸ªspan //è®¾ç½®åè®®å¤´ï¼Œå› ä¸ºè¢«è°ƒç”¨çš„RPCæœåŠ¡ç›¸å¯¹äºæˆ‘ä»¬æ¥è¯´æ˜¯ä¸ªå­é“¾è·¯ request.setHeader(\"x1-rpc-span-id\", span.context().spanId()); request.setHeader(\"x1-rpc-trace-id\", span.context().traceId()); request.setHeader(\"x1-rpc-sampled\", span.sampled()); } rpcServerRequest(request); //å®é™…è°ƒç”¨rpcæœåŠ¡ //è°ƒç”¨åæ‰§è¡Œ if(span != null){ span.finish(); //å®Œæˆæœ¬æ¬¡è¿½è¸ª } }} ä»£ç å—8 è¿™æ ·å°±å®Œæˆäº†å›¾6ä¸­çº¢çº¿éƒ¨åˆ†çš„spanï¼Œç„¶åæ¥çœ‹ä¸‹è¢«è°ƒç”¨çš„æœåŠ¡Aå†…éƒ¨æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼ˆå…¶å®å¾ˆåƒä¸Šé¢httpå…¥å£çš„å¤„ç†æ–¹å¼ï¼‰ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152public class RpcServerInterceptor { //æœåŠ¡çš„å…¥å£ï¼ŒRpcæœåŠ¡å¤„ç†è¯·æ±‚ä¹‹å‰è¦åšçš„ï¼Œä¸€èˆ¬è¿™é‡Œäº§ç”Ÿä¸Šä¸‹æ–‡ï¼Œå¹¶äº¤ç»™TLä¼ é€’ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œè¿™é‡Œä¹Ÿæ˜¯é“¾è·¯åˆå§‹åŒ–çš„åœ°æ–¹ public void beforeHandle(RpcRequest request) { Context context = new Context(); //ä¸Šä¸‹æ–‡å¯¹è±¡ SimpleTracer tracer = null; SimpleSpan parent = null; //è§£æåè®®å¤´ String traceId = request.headers.get(\"x1-rpc-trace-id\"); //æ‹¿åˆ°åè®®å¤´çš„çˆ¶é“¾è·¯idï¼Œå­é“¾è·¯ç»§æ‰¿ä¹‹ String parentId = request.headers.get(\"x1-rpc-span-id\"); //æ‹¿åˆ°åè®®å¤´çš„çˆ¶spanä¿¡æ¯ String sampled = request.headers.get.get(\"x1-rpc-sampled\"); //æ˜¯å¦ä¸ŠæŠ¥ if (traceId != null &amp;&amp; parentId != null &amp;&amp; sampled == true) { tracer = new SimpleTracer(request.getMethod, \"æ‰€å±é¡¹ç›®å\"); // ç¬¦åˆè¿™ç§æƒ…å†µçš„ï¼Œæˆ‘ä»¬è¿™é‡Œçš„parentå…¶å®åªæ˜¯ä¸€ä¸ªç›¸å¯¹äºåˆ«çš„ç³»ç»Ÿçš„child SimpleSpan.SimpleSpanContext simpleSpanContext = new SimpleSpan.SimpleSpanContext(traceId, parentId, new HashMap&lt;&gt;()); parent = tracer.buildSpan(request.getMethod) .addReference(References.CHILD_OF, simpleSpanContext) //å»ºç«‹çˆ¶å­å…³ç³»ï¼Œå¦‚æœæ˜¯åˆ«çš„ä¸šåŠ¡æ–¹è°ƒç”¨æˆ‘ä»¬è¿™ä¸ªæœåŠ¡ï¼Œé‚£ä¹ˆè¿™é‡Œè¿™ä¸€æ­¥ï¼Œä¹Ÿå°±å»ºç«‹äº†è·Ÿè°ƒç”¨æ–¹çš„çˆ¶å­å…³ç³»ï¼ŒtraceIdç­‰æ˜¯ç»§æ‰¿çš„è°ƒç”¨æ–¹çš„ï¼Œæ„å‘³ç€æœ¬æ¬¡è°ƒç”¨ä¹Ÿå±äºè°ƒç”¨æ–¹çš„ä¸€ç¯ï¼Œè¿™ä¹Ÿå°±å®ç°äº†è·¨ç³»ç»Ÿçš„é“¾è·¯è¿½è¸ª .withTag(SpanTags.COMPONENT, \"rpc\") .withTag(SpanTags.SPAN_KIND, \"server\").start(); //å¯åŠ¨span } else { //æ‰§è¡Œelseï¼Œè¯´æ˜è¯¥rpcè°ƒç”¨æ˜¯ä¸€æ¬¡è‡ªå·±å®Œæ•´çš„è°ƒç”¨ï¼Œä¸å±äºä»»ä½•çˆ¶é“¾è·¯ï¼Œé‚£ä¹ˆå°±æ— éœ€å»ºç«‹å…³ç³»ï¼Œç›´æ¥åˆå§‹åŒ–tracerå³å¯ tracer = new SimpleTracer(request.getMethod, \"æ‰€å±é¡¹ç›®å\"); parent = tracer.buildSpan(request.getMethod) .withTag(SpanTags.COMPONENT, \"rpc\") .withTag(SpanTags.SPAN_KIND, \"server\") .start(); //å¯åŠ¨span } //å°†å°è£…å¥½çš„tracerå’ŒparentSpanè®¾ç½®åˆ°ä¸Šä¸‹æ–‡å¯¹è±¡é‡Œå» context.setSimpleTracer(tracer); context.setParent(parent); ContextHolder.setContext(context); //å°†æœ¬æ¬¡è¯·æ±‚ç”Ÿæˆçš„ä¸Šä¸‹æ–‡å¯¹è±¡æ”¾è¿›ContextHolderï¼ˆä¹Ÿå°±æ˜¯TLé‡Œï¼‰ï¼Œæ–¹ä¾¿åœ¨ä»»æ„ä½ç½®å–å‡ºä½¿ç”¨ } //ä¸šåŠ¡é€»è¾‘å¤„ç†ä¸­ public void rpcServerHadle() { doing(); } //Rpcä¸šåŠ¡å¤„ç†å®Œæˆåçš„è§¦å‘ public void afterHandler() { //Rpc Serverè°ƒç”¨ç»“æŸçš„æ—¶å€™ï¼Œå–å‡ºå½“å‰é“¾è·¯ä¿¡æ¯ï¼Œå®Œæˆæ•°æ®çš„ä¸ŠæŠ¥ SimpleTracer tracer = ContextHolder.getContext().getTracer(); SimpleSpan parent = ContextHolder.getContext().getParent(); if (tracer != null &amp;&amp; parent != null) { parent.finish(); //ç»“æŸæ‰parent Span tracer.pushSpans(); //ä¸ŠæŠ¥è¿™æ¬¡äº§ç”Ÿçš„é“¾è·¯æ•°æ®ï¼ˆspansï¼‰ } }} ä»£ç å—9 å¯ä»¥çœ‹åˆ°ï¼Œclientå‘èµ·è°ƒç”¨æ—¶ä¼ é€’çš„åè®®å­—æ®µï¼Œåœ¨æœåŠ¡ç«¯è¿™é‡Œè¢«è§£æäº†ï¼Œå»ºç«‹å¥½çˆ¶å­å…³ç³»åï¼ŒAæœåŠ¡å†å»å¤„ç†è‡ªå·±çš„é€»è¾‘å’Œé“¾è·¯ã€‚ æ²¡æœ‰ç‰µæ‰¯åˆ°è·¨ç³»ç»Ÿçš„é“¾è·¯è¿½è¸ªï¼Œå¦‚å¯¹redisã€memcachedã€mysqlç­‰DBçš„è°ƒç”¨ï¼Œå¯ä»¥ç®€å•åœ¨è°ƒç”¨å…ƒæ–¹æ³•ä¸Šæä¸ªaopä»£ç†ï¼Œç„¶åé€šè¿‡é€šè¿‡ä¸Šä¸‹æ–‡å¯¹è±¡é‡Œçš„Tracerå’Œparentå»ºç«‹çˆ¶å­å…³ç³»ï¼Œç»“æŸæ—¶finishå³å¯ï¼Œè€ŒpushSpansè¿™ä¸ªåŠ¨ä½œé€šå¸¸å‘ç”Ÿåœ¨ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œå®Œæ¯•çš„æ—¶å€™å‘ç”Ÿï¼Œæ¯”å¦‚APIçš„è°ƒç”¨ç»“æŸæ—¶ã€AæœåŠ¡è°ƒç”¨ç»“æŸæ—¶ï¼Œéƒ½æ˜¯pushSpansçš„è§¦å‘ç‚¹ã€‚ åˆ°è¿™é‡ŒåŸºæœ¬ä¸Šå…³äºé“¾è·¯è¿½è¸ªçš„ä»‹ç»ç®—ç»“æŸäº†ï¼Œå› ä¸ºç³»ç»Ÿçº§çš„å®ç°æ–¹å¼æƒ³è¦å®Œæ•´çš„å±•ç°åœ¨ä¸€ç¯‡æ–‡ç« é‡Œä¸å¤ªç°å®ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨simple-trace sdkçš„æ—¶å€™ä½¿ç”¨äº†ä¼ªä»£ç ï¼Œä¾¿äºè¯´æ˜é—®é¢˜ï¼Œæ–‡ç« æ²¡æœ‰é’ˆå¯¹æ•´ä¸ªé“¾è·¯ç³»ç»Ÿä½œè¯´æ˜ï¼Œä¸»è¦æ˜¯é’ˆå¯¹æ•°æ®é‡‡é›†ã€æ•°æ®è·¨ç³»ç»Ÿè¿½è¸ªåšäº†æè¿°ï¼Œå› ä¸ºæ•°æ®é‡‡é›†è¿™ä¸€ç¯ç®—æ˜¯æ¯”è¾ƒé‡è¦çš„ä¸€ç¯ï¼Œä¹Ÿæ˜¯è·Ÿä¸šåŠ¡å¼€å‘äººå‘˜æ¯æ¯ç›¸å…³çš„ä¸€ç¯ï¼Œå¦‚æœæƒ³è¦å®Œæ•´æä¸€ä¸ªé“¾è·¯è¿½è¸ªç³»ç»Ÿï¼Œå¯ä»¥å‚è€ƒä¹‹å‰çš„æ¶æ„æ­å»ºä¸€å¥—ï¼Œä»¥å®Œæˆé‡‡é›†ã€ä¸ŠæŠ¥ã€è½åº“ã€è§£æã€å±•ç¤ºæ•´ä¸ªæµç¨‹ã€‚","link":"/2019/04/15/%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA%EF%BC%88%E4%BA%8C%EF%BC%89-%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86/"},{"title":"é“¾è·¯è¿½è¸ªï¼ˆä¸€ï¼‰-åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªç³»ç»Ÿçš„ä»‹ç»","text":"ä¸€ã€åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªå¯ä»¥åšä»€ä¹ˆï¼Ÿ1.1ï¼šç®€å•é›†ç¾¤æ¶æ„&amp;å¾®æœåŠ¡æ¶æ„å…ˆæ¥çœ‹ä¸‹æœ€ç®€å•çš„ç½‘ç«™é›†ç¾¤æ¶æ„å›¾ï¼š åœ¨è¿™ä¸ªå›¾é‡Œï¼Œå­˜åœ¨ä»1~nä¸ªæœåŠ¡å™¨ï¼Œé€šè¿‡è´Ÿè½½å‡è¡¡å™¨SLBè¿›è¡Œè¯·æ±‚åˆ†å‘ï¼Œåœ¨æ¯ä¸ªæœåŠ¡å™¨é‡Œï¼Œéƒ½åšåŒä¸€ä»¶äº‹æƒ…ã€‚ ç°åœ¨æ¥çœ‹ä¸‹è¿™ä¸ªç³»ç»Ÿçš„å…·ä½“ä¸šåŠ¡é€»è¾‘ï¼ˆå°±æ˜¯å›¾1ä¸­æ¯å°æœåŠ¡å™¨æ‰§è¡Œçš„é€»è¾‘ï¼Œè¿™é‡Œæ˜¯å‡è®¾å…¶ä¸­ä¸€ä¸ªä¸šåŠ¡æ¥å£çš„å¤„ç†ï¼ŒçœŸå®ç³»ç»Ÿä¸­å¯èƒ½å­˜åœ¨nå¤šä¸šåŠ¡æ¥å£ï¼‰ï¼š å›¾2æ˜¯å¯¹ç³»ç»Ÿä¸­æŸä¸€ä¸ªæ¥å£ï¼ˆAPIï¼‰çš„é€»è¾‘åšäº†æè¿°ï¼Œå‡è®¾å¤„ç†æµç¨‹å°±æ˜¯è¯·æ±‚ä¸€æ¬¡RedisæœåŠ¡ï¼Œç„¶ååšä¸‹å¤„ç†ï¼Œç„¶åå†è¯·æ±‚ä¸‹MemecachedæœåŠ¡ï¼Œåœ¨åšä¸‹ä¸šåŠ¡å¤„ç†ï¼Œåç»­å¯èƒ½è¿˜æœ‰å…¶ä»–å„ç§ä¸šåŠ¡é€»è¾‘ï¼Œæˆ‘ä»¬ç»Ÿç§°ä¸ºé€»è¾‘å—ã€‚ ç°åœ¨å‡è®¾è¿™ä¸ªæ¥å£å­˜åœ¨æ€§èƒ½é—®é¢˜ï¼Œé‚£ä¹ˆæ‰¾å¯¹åº”å¼€å‘è´Ÿè´£äººæ’æŸ¥æ˜¯æ¯”è¾ƒå®¹æ˜“çš„ï¼Œå› ä¸ºæœåŠ¡å™¨åªæ‰§è¡Œä¸€å¥—é€»è¾‘ï¼Œç“¶é¢ˆç‚¹ä¸€å®šå‘ç”Ÿåœ¨å½“å‰æ¥å£å¯¹åº”ä»£ç é‡Œçš„æŸä¸ªç‚¹ï¼Œé‚£ä¹ˆå°±æ‰¾æ¥å£å¯¹åº”çš„è´Ÿè´£äººå»æ’æŸ¥ä¼˜åŒ–å³å¯ã€‚ ä½†æ˜¯å½“ä¸šåŠ¡å‘å±•åˆ°ä¸€å®šçš„ç¨‹åº¦ï¼Œæ¯”å¦‚ä¸Šè¿°å•ç³»ç»Ÿé€»è¾‘è¶Šæ¥è¶Šå¤æ‚ï¼ˆä¸šåŠ¡æ¥å£è¶Šæ¥è¶Šå¤šï¼Œé€»è¾‘è¶Šæ¥è¶Šå¤æ‚ï¼‰ï¼Œå°±ä¼šé€ æˆå¾ˆå¤šæˆ‘ä»¬ä¸æ„¿æ„çœ‹åˆ°çš„é—®é¢˜å‘ç”Ÿï¼š æ¯ä¸€æ¬¡å¾®å°çš„æ”¹åŠ¨éƒ½éœ€è¦æ•´ä½“èµ°ä¸€æ¬¡æ‰“åŒ…ã€å‘ç‰ˆçš„æµç¨‹ï¼Œå¯¹æµ‹è¯•ä¹Ÿæ˜¯ç§è´Ÿæ‹…ï¼Œå› ä¸ºnå¤šä¸ªäººå¦‚æœåŒæ—¶å¼€å‘ä¸åŒçš„åŠŸèƒ½ï¼Œè¿™æ—¶å€™å°±ä¼šå¯¹æµ‹è¯•å’Œå‘å¸ƒæµç¨‹é€ æˆå¾ˆå¤§çš„å›°æ‰°ã€‚ å¦‚æœå› ä¸ºåšæŸæ¬¡æ´»åŠ¨ï¼ŒæŸä¸€ä¸ªæ¥å£å¯èƒ½å¼•å…¥å¤§é‡è¯·æ±‚ï¼Œéœ€è¦ç´§æ€¥æ‰©å®¹ï¼Œé‚£ä¹ˆåªèƒ½å¯¹æ•´ä½“æ‰©å®¹ï¼ˆå› ä¸ºè¯¥æ¥å£ä¸å…¶ä»–æ¥å£éƒ½å¤„äºåŒä¸€ä¸ªç³»ç»Ÿä¸­ï¼‰ã€‚ ç³»ç»Ÿå„æ¨¡å—é«˜åº¦è€¦åˆï¼Œä¸é€‚åˆå¤šäººå¼€å‘å’Œç»´æŠ¤ã€‚ ç®€å•é›†ç¾¤å¸¦æ¥çš„é—®é¢˜ä¼šéšç€ç³»ç»Ÿå¤æ‚åº¦çš„æå‡ï¼Œç»´æŠ¤æˆæœ¬å˜å¾—è¶Šæ¥è¶Šå¤§ï¼ŒåŸºäºæ­¤ï¼Œä¾¿æœ‰äº†å¾®æœåŠ¡æ¶æ„ï¼ˆå¾®æœåŠ¡æ˜¯ä¸€ç§æ¶æ„æ€æƒ³ï¼Œç®€å•æ¥è¯´å°±æ˜¯å°†å¤æ‚åºå¤§è€¦åˆåº¦é«˜çš„ç³»ç»ŸæŒ‰ç…§åŠŸèƒ½ç‰¹æ€§æ‹†åˆ†æˆä¸€ä¸ªä¸ªç‹¬ç«‹çš„ç³»ç»Ÿï¼Œé€šè¿‡ç½‘ç»œäº’ç›¸é€šä¿¡ï¼Œè¿™ç§æ¶æ„å¯ä»¥å€ŸåŠ©RPCæ¡†æ¶ï¼ˆæ¯”å¦‚grpcã€dubboï¼‰å®ç°æ‹†åˆ†ã€‚å½“ç„¶ï¼Œç†Ÿæ‚‰çš„HTTPæ¡†æ¶ä¹Ÿå¯ä»¥åšåˆ°ï¼ˆæ¯”å¦‚okhttpï¼‰ï¼Œä½†æ˜¯å—é™äºHTTPåè®®ï¼Œæ€§èƒ½å¯èƒ½å¹¶æ²¡æœ‰æ™®é€šRPCæ¡†æ¶é«˜ï¼Œæ¯”å¦‚grpcé‡‡ç”¨HTTP2åº”ç”¨å±‚åè®®è¿›è¡Œæ•°æ®é€šä¿¡ï¼Œè¿™ä¸ªåè®®ç›¸æ¯”HTTP1æ¥è¯´ï¼Œæ”¯æŒæ•°æ®æµçš„æ ‡è®°ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªé•¿è¿æ¥ä¸ŠåšNå¤šè¯·æ±‚å’Œæ¥æ”¶çš„å¹¶å‘å¤„ç†ï¼Œå±äºå…¨åŒå·¥ç½‘ç»œé€šä¿¡ï¼Œè¿™ç‚¹æ”¾åˆ°HTTP1å°±å¾ˆéš¾åšåˆ°ï¼Œæ­¤å¤–ï¼Œå®ƒè¿˜é‡‡ç”¨äº†è½»é‡çº§ä¸”è·¨è¯­è¨€çš„protobufæ¥ç¼–è§£ç ä¿¡æ¯ï¼Œåœ¨æ€§èƒ½ä¸Šå°½å¯èƒ½åšåˆ°æè‡´ï¼‰ã€‚ ç»“åˆå›¾2ï¼Œæˆ‘ä»¬æ¥ç®€å•æŒ‰ç…§ä¸šåŠ¡åˆ’åˆ†ä¸€ä¸‹æœåŠ¡ï¼Œå¯ä»¥å°†Aä»£ç å—é‡Œçš„é€»è¾‘æŠ½è±¡æˆAæœåŠ¡ï¼Œå°†Bä»£ç å—é‡Œçš„é€»è¾‘æŠ½è±¡æˆBæœåŠ¡ï¼Œå½“ç„¶è¿˜æœ‰å¯èƒ½æœ‰å…¶ä»–nå¤šç»†åŒ–çš„æœåŠ¡ï¼Œç½‘å…³å±‚APIï¼ˆè´Ÿè´£èšåˆä¿¡æ¯ä»¥åŠä¸šåŠ¡å¤„ç†çš„æ¨¡å—ï¼Œå¯¹åº”ä¸Šé¢ç®€å•é›†ç¾¤é‡Œçš„å…·ä½“æ¥å£ï¼‰ï¼ŒæœåŠ¡æ³¨å†Œä¸å‘ç°ã€SLBç­‰ã€‚ ä¸‹é¢å†æ¥çœ‹ä¸€ä¸‹è¢«æ‹†åˆ†åçš„æ¶æ„å›¾ï¼š è¿™å¼ å›¾æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„å¾®æœåŠ¡åŒ–çš„æ¶æ„å›¾ï¼Œå›¾ä¸­è™šçº¿éƒ¨åˆ†éƒ½æ˜¯åœ¨å„æœåŠ¡å¯åŠ¨æ—¶æˆ–è€…è¿è¡ŒæœŸå‘ç”Ÿçš„è°ƒç”¨ï¼Œè´Ÿè´£æ³¨å†Œä¸å‘ç°ï¼ˆå¦‚zookeeperã€Eurakeç­‰éƒ½å¯ä»¥ä½œæœåŠ¡æ³¨å†Œä¸å‘ç°ï¼Œè¿™é‡Œä¸å†ç»†è¯´ï¼Œåªå…³æ³¨å®çº¿éƒ¨åˆ†å³å¯ï¼‰ã€‚ è¿™ç§æ¶æ„å¾ˆå¥½çš„è§£å†³äº†æ™®é€šé›†ç¾¤æ¶æ„å¸¦æ¥çš„é—®é¢˜ï¼ˆå‚è€ƒä¸Šè¿°1ã€2ã€3ï¼‰ï¼Œå¾®æœåŠ¡æ¶æ„çš„å¥½å¤„ï¼š é™ä½äº†ç³»ç»Ÿï¼ˆé€»è¾‘å—ï¼‰é—´çš„è€¦åˆåº¦ï¼Œå¯ä»¥ç‹¬ç«‹å¼€å‘ã€ç‹¬ç«‹éƒ¨ç½²å’Œæµ‹è¯•ï¼Œç³»ç»Ÿé—´çš„è¾¹ç•Œæ˜ç¡®ï¼Œå¯ä»¥ç»†åˆ†ç›¸å…³è´Ÿè´£äººï¼Œå¼€å‘æ•ˆç‡å¤§å¤§æå‡ã€‚ å¦‚æœå› ä¸ºåšæŸæ¬¡æ´»åŠ¨ï¼ŒæŸä¸€ä¸ªæ¥å£å¯èƒ½å¼•å…¥å¤§é‡è¯·æ±‚ï¼Œéœ€è¦ç´§æ€¥æ‰©å®¹ï¼Œé‚£ä¹ˆåªéœ€è¦å°†è¯¥æ¥å£æ¶‰åŠåˆ°çš„æœåŠ¡è¿›è¡Œæ‰©å®¹å³å¯ï¼Œè€Œä¸æ˜¯åƒä¹‹å‰é‚£æ ·æ•´ä½“æ‰©å®¹ï¼Œé™ä½äº†ç»´æŠ¤æˆæœ¬ï¼ˆæŸç§æ„ä¹‰ä¸Šçš„é™ä½ï¼Œç»´æŠ¤äººå‘˜è¦è¶³å¤Ÿå¤šï¼Œæ¯ä¸ªäººå»è´Ÿè´£è‡ªå·±çš„å°æ¨¡å—ï¼Œå¦‚æœä¸€ä¸ªå…¬å¸åªæœ‰ä¸€ä¸ªç»´æŠ¤äººå‘˜ï¼Œå¾®æœåŠ¡åè€Œæ˜¯åœ¨åŠ é‡ç»´æŠ¤äººå‘˜çš„å·¥ä½œ:ï¼‰ã€‚ æé«˜äº†ç³»ç»Ÿï¼ˆé€»è¾‘å—ï¼‰çš„å¤ç”¨æ€§ï¼Œæ¯”å¦‚ä¸Šé¢çš„æœåŠ¡Aåšè‡ªå·±çš„äº‹æƒ…ï¼Œä¸‡ä¸€ä»¥åæœ‰ä¸ªAPIä»ç„¶éœ€è¦Aé€»è¾‘å—ï¼Œé‚£ä¹ˆè¯¥APIåªéœ€è¦å†æ¬¡è°ƒç”¨AæœåŠ¡å³å¯ï¼ˆå®é™…åº”ç”¨å½“ä¸­çš„ä¾‹å­ï¼šç”¨æˆ·æœåŠ¡ï¼‰ã€‚ æœåŠ¡åŒ–ä»¥åï¼Œæ¯ä¸ªæœåŠ¡ç”šè‡³å¯ä»¥ç”¨ä¸åŒçš„è¯­è¨€æ¥å®ç°ï¼ˆå­˜åœ¨æ”¯æŒè·¨è¯­è¨€çš„RPCæ¡†æ¶ï¼Œæ¯”å¦‚grpcï¼‰ï¼Œä¸€ä¸ªå…¬å¸å¤§äº†ä»¥åï¼Œå¯èƒ½å­˜åœ¨è¯­è¨€å·®å¼‚ï¼Œæœ‰çš„ç»„ä½¿ç”¨JAVAï¼Œæœ‰çš„ç»„ç”¨Goï¼Œé€šè¿‡æœåŠ¡åŒ–çš„æ–¹å¼ï¼Œæ¥å°†ä¸¤ä¸ªä¸åŒè¯­è¨€çš„ç³»ç»Ÿäº’è”ã€‚ ä¸Šé¢ç®€å•ä»‹ç»äº†æ™®é€šé›†ç¾¤æ¶æ„å’Œå¾®æœåŠ¡æ¶æ„ï¼ŒåŒæ ·çš„ï¼Œå¾®æœåŠ¡åŒ–ä¹Ÿæ„å‘³ç€ç³»ç»Ÿè°ƒç”¨çš„å¤æ‚åŒ–ï¼Œæœ‰å¯èƒ½ä¸€æ¬¡APIçš„è°ƒç”¨å¯¹åº”å¤§æ‰¹é‡çš„æœåŠ¡è°ƒç”¨ï¼ŒæœåŠ¡æ–¹è‡ªå·±åˆæœ‰ä¸€å †æœåŠ¡è°ƒç”¨ï¼Œé‚£ä¹ˆé’ˆå¯¹è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸€æ¬¡å¤æ‚çš„APIè°ƒç”¨ï¼ˆæ³¨å†Œä¸å‘ç°æœåŠ¡å·²éšè—ï¼‰ï¼Œå¦‚å›¾4æ‰€ç¤º: è¿™æ˜¯æ¨¡æ‹Ÿäº†ä¸€æ¬¡å¾®æœåŠ¡æ¶æ„ä¸­æ¯”è¾ƒå¤æ‚çš„ç³»ç»Ÿè°ƒç”¨ã€‚ âš ï¸æ³¨æ„ï¼šå›¾ç”»çš„æœ‰ç‚¹æ­ªï¼Œå¾®æœåŠ¡æ¶æ„çš„è®¾è®¡ç›®æ ‡æ˜¯è¦é«˜åº¦è§£è€¦ï¼Œæ¯ä¸ªç‹¬ç«‹çš„æœåŠ¡æœ€å¥½éƒ½æœ‰ä¸€ä»½è‡ªå·±ç‹¬ç«‹çš„èµ„æºè®¿é—®ï¼Œæ¯”å¦‚æœåŠ¡Aåªè®¿é—®Aä¸šåŠ¡ç›¸å…³çš„æ•°æ®åº“å’Œç¼“å­˜ç­‰èµ„æºï¼Œå›¾ä¸­é’ˆå¯¹è¿™äº›èµ„æºåˆ’åˆ†åšçš„å¾ˆç³™ é‚£ä¹ˆç°åœ¨å¦‚æœè¿™ä¸ªè¾ƒå¤æ‚çš„é“¾è·¯è°ƒç”¨ä¸Šçš„å…¶ä¸­ä¸€ç¯å‘ç”Ÿäº†æ€§èƒ½ç“¶é¢ˆï¼Œæ‹–æ…¢äº†æ•´ä¸ªAPIçš„è°ƒç”¨ï¼Œæ¯”å¦‚å›¾ä¸­çš„æ…¢æ ‡è¯†ï¼Œç°åœ¨æˆ‘ä»¬å†æ¥æ¨¡æ‹Ÿä¸€ä¸‹è¿™ä¸ªæ€§èƒ½é—®é¢˜çš„æ’æŸ¥è¿‡ç¨‹ï¼ˆè¿‡ç¨‹ç›¸å½“é¬¼ç•œï¼‰ï¼š è´Ÿè´£APIç¼–å†™çš„åŒå­¦å‘ç°APIçš„å“åº”æ—¶é—´æ€»æ˜¯è¾¾ä¸åˆ°é¢„æœŸï¼Œè‡ªå·±debugå‘ç°å¯¼è‡´æ€§èƒ½é—®é¢˜çš„åŸå› æ˜¯æœåŠ¡Cï¼Œäºæ˜¯æ‰¾åˆ°äº†æœåŠ¡Cçš„æœåŠ¡è´Ÿè´£äººï¼Œå‡è®¾å°±å«ä»–CæœåŠ¡è´Ÿè´£äººï¼ŒCæœåŠ¡è´Ÿè´£äººç´§æ¥ç€æ’æŸ¥ï¼Œå‘ç°åŸæ¥æ˜¯æœåŠ¡Dçš„è°ƒç”¨è¿‡æ…¢ï¼Œäºæ˜¯åˆè·‘å»æ‰¾DæœåŠ¡è´Ÿè´£äººï¼ŒDæœåŠ¡è´Ÿè´£äººæ”¶åˆ°CæœåŠ¡è´Ÿè´£äººçš„åé¦ˆï¼Œç„¶åå»æŸ¥è‡ªå·±çš„æœåŠ¡ï¼Œå‘ç°è‡ªå·±è°ƒç”¨çš„æœåŠ¡Eå“åº”ç¼“æ…¢ï¼Œäºæ˜¯DæœåŠ¡è´Ÿè´£äººåˆè·‘å»æ‰¾EæœåŠ¡è´Ÿè´£äººï¼ŒEæœåŠ¡è´Ÿè´£äººç´§æ¥ç€æ’æŸ¥ï¼Œå‘ç°åŸæ¥æ˜¯è‡ªå·±è¿™é‡Œè°ƒç”¨çš„Redis_02æœåŠ¡æœ‰é—®é¢˜ï¼Œç„¶åè‡ªå·±æ’æŸ¥ï¼Œå¦‚æœä¸æ˜¯è‡ªå·±è°ƒç”¨æ–¹å¼æœ‰é—®é¢˜ï¼Œæ¥ä¸‹æ¥è¿˜å¯èƒ½å»è”ç³»å¯¹åº”çš„Redis_02ç›¸å…³ç»´æŠ¤äººå‘˜å¸®åŠ©æ£€æŸ¥ç“¶é¢ˆç‚¹ã€‚ å¯¹æ¯”ç®€å•é›†ç¾¤æ–¹å¼ä¸­çš„å•ç³»ç»Ÿæ€§èƒ½é—®é¢˜æ’æŸ¥ï¼Œå¾®æœåŠ¡é’ˆå¯¹æ­¤ç±»é—®é¢˜çš„æ’æŸ¥ç®€ç›´æ˜¯ä¸€åœºå™©æ¢¦ï¼Œè¿™å…¶ä¸­æ¶‰åŠåˆ°çš„äººè·Ÿç“¶é¢ˆèŠ‚ç‚¹çš„æ·±åº¦æˆæ­£æ¯”ï¼Œå› ä¸ºä»»ä½•ä¸€ä¸ªç¯èŠ‚éƒ½æœ‰å¯èƒ½å­˜åœ¨æ€§èƒ½é—®é¢˜ï¼Œè€Œæ‹–æ…¢æ•´ä¸ªè¿›åº¦çš„æ ¹æºæœªçŸ¥ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§å·¥å…·å¯ä»¥å®Œæˆè·¨æœåŠ¡è·¨ç³»ç»Ÿçš„å»è·Ÿè¸ªè¿™æ¬¡çš„è°ƒç”¨é“¾è·¯å‘¢ï¼Ÿ 1.2ï¼šåˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªç»“åˆä¸Šé¢çš„é—®é¢˜ï¼Œåˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªç³»ç»Ÿå°±è¯ç”Ÿäº†ï¼Œæ¥çœ‹ä¸‹Googleçš„è¿™ç¯‡æ–‡ç« ï¼šDapperï¼Œå¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿçš„è·Ÿè¸ªç³»ç»Ÿï¼Œå¯ä»¥å¯¹åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªç³»ç»Ÿæœ‰ä¸ªç³»ç»Ÿçš„è®¤è¯†ã€‚ å•çº¯çš„ç†è§£é“¾è·¯è¿½è¸ªï¼Œå°±æ˜¯æŒ‡ä¸€æ¬¡ä»»åŠ¡çš„å¼€å§‹åˆ°ç»“æŸï¼ŒæœŸé—´è°ƒç”¨çš„æ‰€æœ‰ç³»ç»ŸåŠè€—æ—¶ï¼ˆæ—¶é—´è·¨åº¦ï¼‰éƒ½å¯ä»¥å®Œæ•´è®°å½•ä¸‹æ¥ï¼Œæ¯”å¦‚ä¸Šé¢å›¾4çš„ä¾‹å­ï¼Œå‡è®¾æ€»è€—æ—¶100msï¼Œå­˜åœ¨ç“¶é¢ˆé“¾è·¯C--&gt;D--&gt;E--&gt;Redis02ï¼Œå¦‚æœé“¾è·¯è¿½è¸ªç³»ç»Ÿåšå¥½äº†ï¼Œé“¾è·¯æ•°æ®æœ‰äº†ï¼Œå€ŸåŠ©å‰ç«¯è§£æå’Œæ¸²æŸ“å·¥å…·ï¼Œå¯ä»¥è¾¾åˆ°ä¸‹å›¾ä¸­çš„æ•ˆæœï¼š å¯ä»¥çœ‹åˆ°ä»APIçš„è°ƒç”¨å¼€å§‹åˆ°æ¯ä¸ªæ¶‰åŠåˆ°çš„ç³»ç»Ÿè°ƒç”¨ä»¥åŠç³»ç»Ÿå†…éƒ¨çš„è°ƒç”¨é“¾è·¯å’Œæ—¶é—´è·¨åº¦è¢«ç›´è§‚çš„å±•ç¤ºå‡ºæ¥äº†ï¼Œé€šè¿‡ä¸Šå›¾ï¼Œå¯ä»¥çœ‹åˆ°æ—¶é—´è·¨åº¦æœ€é•¿çš„å°±æ˜¯Redis_02ï¼Œè¯¥æœåŠ¡çš„è°ƒç”¨é—´æ¥æ‹–æ…¢äº†EæœåŠ¡ã€DæœåŠ¡ã€CæœåŠ¡çš„å“åº”ï¼Œæœ€åç”±CæœåŠ¡ç›´æ¥å¯¼è‡´APIæ•´ä½“å“åº”ç¼“æ…¢ï¼Œé€šè¿‡è¿™ä¸ªå›¾ï¼Œå°±å¯ä»¥ç›´æ¥æ‰¾åˆ°å¯¹åº”çš„è´£ä»»äººå»æ’æŸ¥å¯¹åº”çš„é—®é¢˜ï¼Œè€Œä¸æ˜¯åƒä¹‹å‰é‚£æ ·æ‰¾ä¸€ç¾¤äººã€‚ äºŒã€åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªç³»ç»Ÿçš„ç»„æˆç±»ä¼¼å¾ˆå¤šç›‘æ§ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿä¹Ÿåˆ†ä¸ºåŸºç¡€æ•°æ®é‡‡é›†+æ•°æ®å­˜å‚¨+å‰ç«¯å±•ç¤ºå‡ ä¸ªéƒ¨åˆ†ï¼Œæ¥çœ‹ä¸‹ä¸€ä¸ªåˆ†å¸ƒå¼é“¾è·¯ç³»ç»Ÿçš„åŸºæœ¬ç»“æ„ï¼š ä¸Šå›¾æ¯”è¾ƒç²—ç•¥çš„å±•ç¤ºäº†ä¸€ä¸ªå®Œæ•´çš„é“¾è·¯è¿½è¸ªç³»ç»Ÿçš„ç»“æ„ï¼Œæœ¬ç¯‡æ–‡ç« ä¸ä¼šä»‹ç»å…·ä½“çš„é“¾è·¯è¿½è¸ªç³»ç»Ÿçš„å®ç°ï¼Œå¯ä»¥å…ˆç®€å•å°†è¯¥ç³»ç»Ÿç†è§£ä¸ºæ¥æ”¶+å­˜å‚¨é“¾è·¯æ•°æ®çš„ä½œç”¨ï¼Œå‰ç«¯ä¹Ÿä¸€æ ·ï¼Œå¯ä»¥å…ˆç®€å•ç†è§£ä¸ºè¯·æ±‚é“¾è·¯ç³»ç»ŸAPIï¼ŒAPIå†…éƒ¨è´Ÿè´£è¯»å–dbï¼Œå¹¶å°†æ•°æ®å°è£…æˆå‰ç«¯éœ€è¦çš„æ ¼å¼ï¼Œå‰ç«¯è´Ÿè´£ç»˜åˆ¶å›¾5ä¸­çš„é¡µé¢å³å¯ï¼ˆåªè¦æ•°æ®ç»“æ„çº¦å®šå¥½ï¼Œå¯¹äºä¸“ä¸šçš„å‰ç«¯å·¥ç¨‹å¸ˆåšå‡ºå›¾5çš„æ•ˆæœæ˜¯å¾ˆå®¹æ˜“çš„ï¼Œå½“ç„¶ç½‘ä¸Šä¹Ÿæœ‰ç°æˆçš„å‰ç«¯å·¥å…·ï¼‰ã€‚ æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»é“¾è·¯è¿½è¸ªç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Œå¯ä»¥è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Œä¸‹ä¸€ç¯‡å°†ä¼šè¯¦ç»†ä»‹ç»â€œé“¾è·¯æ•°æ®é‡‡é›†SDKâ€ï¼Œå› ä¸ºè¿™ä¸€éƒ¨åˆ†æ˜¯è·Ÿä¸šåŠ¡ç»„ä»¶å¼€å‘äººå‘˜ç›´æ¥æŒ‚é’©çš„ï¼Œä¸‹ä¸€ç¯‡ä¼šè¯´æ˜é“¾è·¯è¿½è¸ªçš„æ•°æ®ç»“æ„ã€å¦‚ä½•åšåˆ°é“¾è·¯æ•°æ®çš„é‡‡é›†å’Œä¸ŠæŠ¥ã€å¦‚ä½•åšåˆ°è·¨æœåŠ¡çš„é“¾è·¯è¿½è¸ªã€‚ å¼€å§‹å‰å¯ä»¥å…ˆäº†è§£ä¸€ä¸ªæ ‡å‡†ï¼šOpenTracingè¯­ä¹‰æ ‡å‡† è¿™é‡Œé¢è®²äº†ä¸¤ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼šTracerå’ŒSpanï¼Œä¸€ä¸ªTracerè®¤ä¸ºæ˜¯ä¸€æ¬¡å®Œæ•´çš„é“¾è·¯ï¼Œå†…éƒ¨åŒ…å«nå¤šä¸ªSpanï¼ŒSpanè¡¨ç¤ºå…·ä½“çš„ä¸€æ¬¡è°ƒç”¨ï¼Œå›¾5ä¸­å°±æ˜¯ä¸€æ¬¡å®Œæ•´çš„è°ƒç”¨é“¾è·¯ï¼Œé‡Œé¢æ¯ä¸ªè€—æ—¶æ¡éƒ½æ˜¯ä¸€ä¸ªSpanï¼ŒTracerå’ŒSpanå­˜åœ¨ä¸€å¯¹å¤šçš„å…³ç³»ï¼ˆçœ‹åˆ°è¿™é‡Œï¼Œå›¾6ä¸­çš„é“¾è·¯è¿½è¸ªAPIçš„å®ç°å¯ä»¥è®¤ä¸ºæ˜¯æ ¹æ®Tracerçš„idèšåˆä¸€æ‰¹å­˜åœ¨çˆ¶å­å…³ç³»çš„Spanå°è£…æˆå®šä¹‰å¥½çš„æ•°æ®ç»“æ„ä¼ ç»™å‰ç«¯è¿›è¡Œæ¸²æŸ“çš„ï¼‰ï¼Œæ ¹æ®å›¾5ï¼Œå¯ä»¥çŸ¥é“Spanä¸Spanä¹‹é—´åˆå­˜åœ¨çˆ¶å­å…³ç³»ã€‚ å…·ä½“çš„å®ç°æ–¹æ¡ˆå’Œå®ç°æ–¹æ³•ï¼Œä¸‹ä¸€ç¯‡ä¼šé€šè¿‡ä¸€ä¸ªé’ˆå¯¹ç®€å•å®ç°äº†OpenTracingåè®®çš„ä¾‹å­æ¥ä»‹ç»ï¼Œä¸‹ä¸€ç¯‡ä¼šå›´ç»•ç€å›¾5è¿›è¡Œå±•å¼€ã€‚","link":"/2019/04/11/%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA%EF%BC%88%E4%B8%80%EF%BC%89-%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA%E7%B3%BB%E7%BB%9F%E7%9A%84%E4%BB%8B%E7%BB%8D/"},{"title":"Java NIOå­¦ä¹ ä¸è®°å½•ï¼ˆå…«ï¼‰ï¼š Reactorä¸¤ç§å¤šçº¿ç¨‹æ¨¡å‹çš„å®ç°","text":"æ³¨ï¼šæœ¬ç¯‡æ–‡ç« ä¾‹å­åŸºäºä¸Šä¸€ç¯‡è¿›è¡Œï¼šJava NIOå­¦ä¹ ä¸è®°å½•ï¼ˆä¸ƒï¼‰ï¼š Reactorå•çº¿ç¨‹æ¨¡å‹çš„å®ç° å‰è¨€ï¼šå•çº¿ç¨‹Reactoræ¨¡å‹çš„ç¼ºç‚¹ç´§æ¥ç€ä¸Šç¯‡Reactorå•çº¿ç¨‹æ¨¡å‹çš„ä¾‹å­æ¥ï¼Œå‡è®¾Handlerçš„readé‚£é‡Œçš„å¤„ç†æ–¹å¼å»¶è¿Ÿ5sï¼Œå½“åšæ˜¯ä¸šåŠ¡æ€§èƒ½ç“¶é¢ˆï¼Œæ”¹å˜ä¸‹åŸæ¥çš„Handlerï¼Œè®©å…¶readæ–¹æ³•åœ¨å¤„ç†æ—¶å»¶è¿Ÿ5sï¼š 1234567891011121314151617181920212223private void read() throws IOException { if (selectionKey.isValid()) { System.out.println(\"æœåŠ¡ç«¯è¯»å–æ•°æ®å‰\"); readBuffer.clear(); int count = socketChannel.read(readBuffer); if (count &gt; 0) { try { Thread.sleep(5000L); //è¯»å–ä¿¡æ¯åç¡çœ 5så½“åšä¸šåŠ¡å¤„ç†ç“¶é¢ˆ } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(String.format(\"æ”¶åˆ°æ¥è‡ª %s çš„æ¶ˆæ¯: %s\", socketChannel.getRemoteAddress(), new String(readBuffer.array()))); status = SEND; selectionKey.interestOps(SelectionKey.OP_WRITE); } else { selectionKey.cancel(); socketChannel.close(); System.out.println(\"readæ—¶-------è¿æ¥å…³é—­\"); } } } ä»£ç å—1 ç°åœ¨åŒæ ·å¼€å¯ä¸¤ä¸ªå®¢æˆ·ç«¯åŒæ—¶è¿æ¥åˆ°è¯¥æœåŠ¡ç«¯ï¼Œç„¶åè¯·æ±‚--&gt;æ”¶åˆ°å“åº”--&gt;å†æ¬¡è¯·æ±‚çš„æµç¨‹èµ°10æ¬¡ï¼Œä¼šå‘ç°ï¼Œå®¢æˆ·ç«¯æ¯æ”¶åˆ°ä¸€æ¬¡å“åº”éœ€è¦10sï¼ŒåŒæ ·çš„å¦‚æœå¼€å¯3ä¸ªå®¢æˆ·ç«¯ï¼Œåˆ™éœ€è¦15sï¼Œå› ä¸ºå•çº¿ç¨‹çš„Reactoræ¨¡å‹æ˜¯ä¸²è¡Œçš„ï¼Œä¸šåŠ¡å¤„ç†çš„ç“¶é¢ˆå¯ä»¥å½±å“åˆ°å…¨å±€çš„äº‹ä»¶åˆ†å‘ï¼Œè¿™ç§æ¨¡å‹ä¸‹ï¼Œå¦‚æœå­˜åœ¨ç±»ä¼¼ä¾‹å­ä¸­çš„ç“¶é¢ˆç‚¹æ˜¯è‡´å‘½çš„ï¼ˆä¾‹å­çš„5sæ˜¯å¤¸å¼ å¤„ç†ï¼‰ï¼Œå› ä¸ºæ–°è¿›æ¥çš„è¿æ¥ä¹Ÿä¼šæ’é˜Ÿï¼Œæ•´ä¸ªselectéƒ½ä¼šè¢«Handlerçš„å¤„ç†ç»™é˜»å¡æ‰ï¼Œä¸¾ä¸ªå®é™…ç‚¹çš„ä¾‹å­ï¼Œredisåœ¨ä½¿ç”¨æ—¶å¤§éƒ¨åˆ†æ—¶å€™ä¼šé¿å…ä½¿ç”¨ç±»ä¼¼keysè¿™ç§é‡æ“ä½œï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå°±æ˜¯å› ä¸ºredisæ˜¯å•çº¿ç¨‹ï¼Œè¿™é‡Œè¯´çš„å•çº¿ç¨‹å…¶å®å¹¶ä¸æ˜¯è¯´redisæœåŠ¡ç«¯å°±ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œæ˜¯è¯´redisé‡‡ç”¨çš„NIO Reactoræ¨¡å‹å°±æ˜¯å•çº¿ç¨‹çš„Reactoræ¨¡å‹ï¼Œè·Ÿä¸Šé¢ä»£ç é‡Œåšçš„æ”¹åŠ¨ä¸€æ ·ï¼Œ5så¯ä»¥ç†è§£æˆé‡æ“ä½œï¼Œå½±å“æ•´ä¸ªæ¨¡å‹çš„æ­£å¸¸è¿ä½œï¼Œredisä¹‹æ‰€ä»¥é‡‡ç”¨å•çº¿ç¨‹æ¨¡å¼ï¼Œæ˜¯å› ä¸ºrediså¤§éƒ¨åˆ†æ“ä½œå®åœ¨æ˜¯å¤ªå¿«äº†ï¼Œå¿«åˆ°ä½¿ç”¨è¿™ç§æ¨¡å¼ä¹Ÿå¯ä»¥æä¾›è¿‘åä¸‡/ç§’çš„å¹¶å‘èƒ½åŠ›ï¼Œå•çº¿ç¨‹æ¨¡å‹å®ç°èµ·æ¥ç®€å•ä¸”å¯æ§æ€§å¼ºï¼Œæ‰€ä»¥rediså¾ˆè‡ªç„¶çš„é€‰æ‹©äº†è¿™ç§æ¨¡å¼ã€‚å›åˆ°é—®é¢˜æœ¬èº«ï¼Œæˆ‘ä»¬è‡ªå·±çš„ä¸šåŠ¡å¯èƒ½å¹¶æ²¡æœ‰redisé‚£æ ·é«˜çš„å¤„ç†èƒ½åŠ›ï¼Œæä¸å¥½å‡ ä¸ªç½‘ç»œè¯·æ±‚å°±å¯ä»¥é€ æˆæ€§èƒ½ç“¶é¢ˆï¼Œæ‹–æ…¢ç”šè‡³æ‹–å®æ•´ä¸ªå¤„ç†æ¨¡å‹ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†RPCæ¡†æ¶å’Œwebå®¹å™¨å¹¶ä¸ä¼šé‡‡ç”¨å•çº¿ç¨‹çš„Reactoræ¨¡å‹å®ç°ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥ä¼˜åŒ–è¿™ç§æ¨¡å‹å‘¢ï¼Ÿæ¯”å¦‚ï¼ŒæŠŠè¿™ä¸ªç“¶é¢ˆç‚¹åˆ©ç”¨ç‹¬ç«‹çº¿ç¨‹å¼‚æ­¥å‡ºå»å¤„ç†ï¼Œè¿™æ ·å¯ä»¥ä¿è¯ä¸å½±å“selectçš„æ‰§è¡Œï¼Œä¹Ÿå°±å¾ˆå¥½çš„é¿å…äº†ä¸Šé¢çš„é—®é¢˜äº†ï¼Œä¸‹é¢ä»‹ç»ä¸¤ç§å¤šçº¿ç¨‹å¼‚æ­¥çš„Reactoræ¨¡å‹ã€‚ ä¸€ã€å•Reactorå¤šçº¿ç¨‹æ¨¡å‹æ¨¡å‹å›¾ï¼š ä¸Šå›¾ä¸å•çº¿ç¨‹Reactoræ¨¡å‹å¯¹æ¯”å¯ä»¥çœ‹å‡ºï¼Œè¯»å…¥æ•°æ®åï¼Œå¯¹æ•°æ®çš„ä¸šåŠ¡å¤„ç†éƒ¨åˆ†è¢«çº¿ç¨‹æ± åšäº†å¼‚æ­¥å¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šè¿°5sçš„é‚£æ®µç“¶é¢ˆè¢«æ”¾åˆ°äº†å­çº¿ç¨‹å»å¤„ç†ï¼Œselectçš„æ‰§è¡Œä¸ä¼šå—åˆ°ä»»ä½•å½±å“ï¼Œå› æ­¤å¯¹æ–°çš„è¿æ¥å¤„ç†ã€å¤šä¸ªå®¢æˆ·ç«¯çš„å“åº”é€Ÿåº¦éƒ½åº”è¯¥å¯ä»¥å¾—åˆ°ä¿éšœã€‚ ç°åœ¨æ¥æ”¹å†™ä¸‹å‰ç¯‡æ–‡ç« é‡Œçš„å•çº¿ç¨‹å¤„ç†æ¨¡å¼çš„Handlerï¼Œæ›´åä¸ºAsyncHandlerï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118public class AsyncHandler implements Runnable { private final Selector selector; private final SelectionKey selectionKey; private final SocketChannel socketChannel; private ByteBuffer readBuffer = ByteBuffer.allocate(1024); private ByteBuffer sendBuffer = ByteBuffer.allocate(2048); private final static int READ = 0; //è¯»å–å°±ç»ª private final static int SEND = 1; //å“åº”å°±ç»ª private final static int PROCESSING = 2; //å¤„ç†ä¸­ private int status = READ; //æ‰€æœ‰è¿æ¥å®Œæˆåéƒ½æ˜¯ä»ä¸€ä¸ªè¯»å–åŠ¨ä½œå¼€å§‹çš„ //å¼€å¯çº¿ç¨‹æ•°ä¸º5çš„å¼‚æ­¥å¤„ç†çº¿ç¨‹æ±  private static final ExecutorService workers = Executors.newFixedThreadPool(5); AsyncHandler(SocketChannel socketChannel, Selector selector) throws IOException { this.socketChannel = socketChannel; this.socketChannel.configureBlocking(false); selectionKey = socketChannel.register(selector, 0); selectionKey.attach(this); selectionKey.interestOps(SelectionKey.OP_READ); this.selector = selector; this.selector.wakeup(); } @Override public void run() { //å¦‚æœä¸€ä¸ªä»»åŠ¡æ­£åœ¨å¼‚æ­¥å¤„ç†ï¼Œé‚£ä¹ˆè¿™ä¸ªrunæ˜¯ç›´æ¥ä¸è§¦å‘ä»»ä½•å¤„ç†çš„ï¼Œreadå’Œsendåªè´Ÿè´£ç®€å•çš„æ•°æ®è¯»å–å’Œå“åº”ï¼Œä¸šåŠ¡å¤„ç†å®Œå…¨ä¸é˜»å¡è¿™é‡Œçš„å¤„ç† switch (status) { case READ: read(); break; case SEND: send(); break; default: } } private void read() { if (selectionKey.isValid()) { try { readBuffer.clear(); int count = socketChannel.read(readBuffer); if (count &gt; 0) { status = PROCESSING; //ç½®ä¸ºå¤„ç†ä¸­ï¼Œå¤„ç†å®Œæˆåè¯¥çŠ¶æ€ä¸ºå“åº”ï¼Œè¡¨ç¤ºè¯»å…¥å¤„ç†å®Œæˆï¼Œæ¥ä¸‹æ¥å¯ä»¥å“åº”å®¢æˆ·ç«¯äº† workers.execute(this::readWorker); //å¼‚æ­¥å¤„ç† } else { selectionKey.cancel(); socketChannel.close(); System.out.println(\"readæ—¶-------è¿æ¥å…³é—­\"); } } catch (IOException e) { System.err.println(\"å¤„ç†readä¸šåŠ¡æ—¶å‘ç”Ÿå¼‚å¸¸ï¼å¼‚å¸¸ä¿¡æ¯ï¼š\" + e.getMessage()); selectionKey.cancel(); try { socketChannel.close(); } catch (IOException e1) { System.err.println(\"å¤„ç†readä¸šåŠ¡å…³é—­é€šé“æ—¶å‘ç”Ÿå¼‚å¸¸ï¼å¼‚å¸¸ä¿¡æ¯ï¼š\" + e.getMessage()); } } } } void send() { if (selectionKey.isValid()) { status = PROCESSING; //ç½®ä¸ºæ‰§è¡Œä¸­ workers.execute(this::sendWorker); //å¼‚æ­¥å¤„ç† selectionKey.interestOps(SelectionKey.OP_READ); //é‡æ–°è®¾ç½®ä¸ºè¯» } } //è¯»å…¥ä¿¡æ¯åçš„ä¸šåŠ¡å¤„ç† private void readWorker() { try { Thread.sleep(5000L); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(String.format(\"æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯: %s\", new String(readBuffer.array()))); status = SEND; selectionKey.interestOps(SelectionKey.OP_WRITE); //æ³¨å†Œå†™äº‹ä»¶ this.selector.wakeup(); //å”¤é†’é˜»å¡åœ¨selectçš„çº¿ç¨‹ï¼Œå› ä¸ºè¯¥interestOpså†™äº‹ä»¶æ˜¯æ”¾åˆ°å­çº¿ç¨‹çš„ï¼Œselectåœ¨è¯¥channelè¿˜æ˜¯å¯¹readäº‹ä»¶æ„Ÿå…´è¶£æ—¶åˆè¢«è°ƒç”¨ï¼Œå› æ­¤å¦‚æœä¸ä¸»åŠ¨å”¤é†’ï¼Œselectå¯èƒ½å¹¶ä¸ä¼šç«‹åˆ»selectè¯¥è¯»å°±ç»ªäº‹ä»¶ï¼ˆåœ¨è¯¥ä¾‹ä¸­ï¼Œå¯èƒ½æ°¸è¿œä¸ä¼šè¢«selectåˆ°ï¼‰ } private void sendWorker() { try { sendBuffer.clear(); sendBuffer.put(String.format(\"æˆ‘æ”¶åˆ°æ¥è‡ª%sçš„ä¿¡æ¯è¾£ï¼š%s, 200ok;\", socketChannel.getRemoteAddress(), new String(readBuffer.array())).getBytes()); sendBuffer.flip(); int count = socketChannel.write(sendBuffer); if (count &lt; 0) { selectionKey.cancel(); socketChannel.close(); System.out.println(\"sendæ—¶-------è¿æ¥å…³é—­\"); } else { //å†æ¬¡åˆ‡æ¢åˆ°è¯» status = READ; } } catch (IOException e) { System.err.println(\"å¼‚æ­¥å¤„ç†sendä¸šåŠ¡æ—¶å‘ç”Ÿå¼‚å¸¸ï¼å¼‚å¸¸ä¿¡æ¯ï¼š\" + e.getMessage()); selectionKey.cancel(); try { socketChannel.close(); } catch (IOException e1) { System.err.println(\"å¼‚æ­¥å¤„ç†sendä¸šåŠ¡å…³é—­é€šé“æ—¶å‘ç”Ÿå¼‚å¸¸ï¼å¼‚å¸¸ä¿¡æ¯ï¼š\" + e.getMessage()); } } }} ä»£ç å—2 å¯ä»¥çœ‹åˆ°ï¼Œreadé‡Œã€sendé‡Œçš„é€»è¾‘å¤„ç†è¢«å¼‚æ­¥å‡ºå»æ‰§è¡Œï¼Œæ–°å¢äº†ä¸­é—´çŠ¶æ€â€œæ‰§è¡Œä¸­â€ï¼Œä¸»è¦ç”¨æ¥é˜²æ­¢äº‹ä»¶é‡å¤è§¦å‘ï¼Œé‡å¤æ‰§è¡Œå¼‚æ­¥é€»è¾‘ï¼Œå½“å¼‚æ­¥é€»è¾‘å¤„ç†å®Œæ¯•æ‰ä¼šæ›´æ”¹çŠ¶æ€å€¼ï¼Œè¿™æ—¶å€™å¯ä»¥ç»§ç»­å¤„ç†æ¥ä¸‹æ¥çš„äº‹ä»¶ï¼ˆè¯»æˆ–å†™ï¼‰ã€‚ æŠŠAccptorç±»é‡Œçš„å®ç°æ¢æˆAsyncHandlerï¼Œè¿è¡ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¼šå‘ç°ï¼Œä¸¤ä¸ªå®¢æˆ·ç«¯çš„å“åº”å‡ä¸º5sï¼Œä¹Ÿä¸ä¼šé˜»å¡æ–°å¢çš„è¿æ¥ï¼Œæ–°å¢è‡³ä¸‰ä¸ªæˆ–è€…æ›´å¤šçš„å®¢æˆ·ç«¯åŸºæœ¬å¯ä»¥ä¿æŒå®¢æˆ·ç«¯å“åº”å‡ä¸º5sï¼ˆè¯´æ˜ï¼šè¿™é‡Œ5sæ˜¯å¤¸å¼ æ¯”å–»ï¼Œæ­£å¸¸ç“¶é¢ˆæ²¡è¿™ä¹ˆå¤¸å¼ ï¼Œè‹¥å¼€äº†nå¤šå®¢æˆ·ç«¯ï¼Œæ¯ä¸ªéƒ½é˜»å¡5sï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¹Ÿä¼šå‘ç”Ÿæ’é˜Ÿï¼Œå› ä¸ºå­çº¿ç¨‹ä¸ªæ•°æœ‰é™ï¼Œå¤„ç†ä¸è¿‡æ¥ï¼Œæœ€åè¿˜æ˜¯é˜»å¡ï¼Œä¸€å®šä¼šè¿œè¶…è¿‡5sï¼‰ã€‚ é€šè¿‡å¤šçº¿ç¨‹Reactoræ¨¡å‹ï¼Œé™ä½äº†ä¸šåŠ¡ä»£ç ç“¶é¢ˆå¯¼è‡´å½±å“æ•´ä¸ªReactoræ‰§è¡Œé“¾è·¯çš„é£é™©ï¼Œä½†æ˜¯å³ä¾¿å¦‚æ­¤ï¼Œreadã€sendæ“ä½œä»ç„¶å’Œæ¥æ”¶è¯·æ±‚ï¼ˆacceptï¼‰å¤„äºåŒä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™å°±æ„å‘³ç€readã€sendçš„å¤„ç†å¯èƒ½ä¼šå½±å“åˆ°å¯¹å®¢æˆ·ç«¯è¿æ¥çš„æ¥æ”¶èƒ½åŠ›ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§åŠæ³•ï¼Œå¯ä»¥æŠŠè¯»å†™æµç¨‹å½»åº•å¼‚æ­¥å‡ºå»ï¼Œè´Ÿè´£è¿æ¥çš„çº¿ç¨‹å°±åªè´Ÿè´£æ¥æ”¶è¿æ¥ï¼Ÿäºæ˜¯å¤šReactorå¤šçº¿ç¨‹æ¨¡å‹å°±äº§ç”Ÿäº†ï¼Œè¿™ç§æ¨¡å‹ä¹Ÿå«ä¸»ä»Reactoræ¨¡å‹ï¼Œè¯¥æ¨¡å‹ä¸‹å¯ä»¥åˆ†ä¸ºä¸€ä¸ªä¸»Reactorä¸“é—¨å¤„ç†è¿æ¥äº‹ä»¶ï¼Œè€Œå¤šä¸ªä»Reactorè´Ÿè´£è¯»å†™ã€ä¸šåŠ¡å¤„ç†ç­‰ï¼Œè¿™æ ·æœåŠ¡ç«¯å¯ä»¥æ¥æ”¶å¹¶å¤„ç†æ›´å¤šçš„è¯·æ±‚ï¼Œæå‡æœåŠ¡ç«¯çš„ååèƒ½åŠ›ï¼ˆè¯¥æ¨¡å‹æˆ–è€…è¯´æ‰€æœ‰åŸºäºNIOçš„Reactoræ¨¡å‹ï¼Œéƒ½æ˜¯ä»¥æå‡æœåŠ¡ç«¯å¤„ç†èƒ½åŠ›ä¸ºåŸºç¡€çš„ï¼ŒNIOåœ¨æŸäº›æƒ…å†µä¸‹ä¸ä¸€å®šä¼šæ¯”BIOå¤„ç†é€Ÿåº¦å¿«ï¼Œä½†ä¸€å®šæ¯”BIOç¨³ï¼Œå°±åƒNIOå¯ä»¥åˆ©ç”¨å¾ˆå°‘çš„çº¿ç¨‹å¤„ç†å¤§é‡çš„å®¢æˆ·ç«¯è¯·æ±‚ï¼Œè€ŒBIOåœ¨å¤§é‡å®¢æˆ·ç«¯è¯·æ±‚è¿‡æ¥çš„æƒ…å†µä¸‹ï¼Œç”±äºå„ç§æ“ä½œå‡ä¼šé˜»å¡çº¿ç¨‹ï¼Œä¼šå¤„ç†ä¸è¿‡æ¥ï¼‰ã€‚ äºŒã€ä¸»ä»Reactoræ¨¡å‹è¿˜æ˜¯æŠŠä¹‹å‰æ–‡ç« çš„å›¾æ‹¿æ¥å±•ç¤ºä¸‹è¿™ç§æ¨¡å‹çš„æµç¨‹ï¼Œå¯ä»¥ä¸ä¸Šé¢å›¾1è¿›è¡Œå¯¹æ¯”ï¼Œçœ‹çœ‹å‘ç”Ÿäº†å“ªäº›å˜åŒ–ï¼š ä¸Šå›¾å°±æ˜¯ä¸»ä»Reactoræ¨¡å‹çš„ä¸€ä¸ªæµç¨‹ï¼Œçœ‹ä¸‹ä¸å›¾1çš„ä¸åŒä¹‹å¤„ï¼Œå¤šäº†SubReactorè¿™æ ·ä¸€ä¸ªè§’è‰²ï¼Œè¿™ä¸ªè§’è‰²å°±æ˜¯ç”¨æ¥å¤„ç†è¯»å†™æ“ä½œçš„Reactorï¼Œç°åœ¨ä»ç„¶åŸºäºä¹‹å‰çš„ä¾‹å­ï¼Œè¿›è¡Œæ”¹å†™ï¼Œæ˜ç¡®éœ€è¦æ”¹å†™çš„ç‚¹ï¼š æ–°å¢SubReactor Acceptoré‚£é‡Œè¿›è¡Œåˆå§‹åŒ–ä¸€æ‰¹SubReactorï¼Œè¿›è¡Œåˆ†å‘å¤„ç† ä¸ºäº†åŒºåˆ†å®¢æˆ·ç«¯åˆ†åˆ«æ˜¯è¢«å“ªä¸ªSubReactorå¤„ç†çš„è¯»å†™æ“ä½œï¼Œè¿˜éœ€è¦æ”¹å†™ä¸‹AsyncHandlerï¼Œåœ¨é‡Œé¢åŠ ä¸ŠSubReactorçš„åºå·ï¼Œæ‰“å°ä¿¡æ¯æ—¶è¿›è¡ŒåŒºåˆ†ã€‚ okï¼Œæ€»ç»“å®Œæ”¹åŠ¨ç‚¹ï¼Œç°åœ¨åŸºäºä¸Šé¢çš„ä»£ç ï¼ˆä»£ç åˆä»£ç›®ç‰ˆæœ¬ï¼šReactorå•çº¿ç¨‹æ¨¡å‹çš„å®ç°ï¼‰æ”¹å†™ä¸€ä¸‹è¿™å‡ ä¸ªç±»ï¼š step1.é¦–å…ˆæ–°å¢SubReactorç±»1234567891011121314151617181920212223242526272829303132333435363738394041424344public class SubReactor implements Runnable { private final Selector selector; private boolean register = false; //æ³¨å†Œå¼€å…³è¡¨ç¤ºï¼Œä¸ºä»€ä¹ˆè¦åŠ è¿™ä¹ˆä¸ªä¸œè¥¿ï¼Œå¯ä»¥å‚è€ƒAcceptorè®¾ç½®è¿™ä¸ªå€¼é‚£é‡Œçš„æè¿° private int num; //åºå·ï¼Œä¹Ÿå°±æ˜¯Acceptoråˆå§‹åŒ–SubReactoræ—¶çš„ä¸‹æ ‡ SubReactor(Selector selector, int num) { this.selector = selector; this.num = num; } @Override public void run() { while (!Thread.interrupted()) { System.out.println(String.format(\"%då·SubReactorç­‰å¾…æ³¨å†Œä¸­...\", num)); while (!Thread.interrupted() &amp;&amp; !register) { try { if (selector.select() == 0) { continue; } } catch (IOException e) { e.printStackTrace(); } Set selectedKeys = selector.selectedKeys(); Iterator it = selectedKeys.iterator(); while (it.hasNext()) { dispatch(it.next()); it.remove(); } } } } private void dispatch(SelectionKey key) { Runnable r = (Runnable) (key.attachment()); if (r != null) { r.run(); } } void registering(boolean register) { this.register = register; }} ä»£ç å—3 è¿™ä¸ªç±»è´Ÿè´£Acceptoräº¤ç»™è‡ªå·±çš„äº‹ä»¶selectï¼ˆä¾‹å­ä¸­å®é™…ä¸Šå°±æ˜¯readã€sendï¼‰ã€‚ step2.Acceptorç±»çš„æ›´æ”¹1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950public class Acceptor implements Runnable { private final ServerSocketChannel serverSocketChannel; private final int coreNum = Runtime.getRuntime().availableProcessors(); // è·å–CPUæ ¸å¿ƒæ•° private final Selector[] selectors = new Selector[coreNum]; // åˆ›å»ºselectorç»™SubReactorä½¿ç”¨ï¼Œä¸ªæ•°ä¸ºCPUæ ¸å¿ƒæ•°ï¼ˆå¦‚æœä¸éœ€è¦é‚£ä¹ˆå¤šå¯ä»¥è‡ªå®šä¹‰ï¼Œæ¯•ç«Ÿè¿™é‡Œä¼šåæ‰ä¸€ä¸ªçº¿ç¨‹ï¼‰ private int next = 0; // è½®è¯¢ä½¿ç”¨subReactorçš„ä¸‹æ ‡ç´¢å¼• private SubReactor[] reactors = new SubReactor[coreNum]; // subReactor private Thread[] threads = new Thread[coreNum]; // subReactorçš„å¤„ç†çº¿ç¨‹ Acceptor(ServerSocketChannel serverSocketChannel) throws IOException { this.serverSocketChannel = serverSocketChannel; // åˆå§‹åŒ– for (int i = 0; i &lt; coreNum; i++) { selectors[i] = Selector.open(); reactors[i] = new SubReactor(selectors[i], i); //åˆå§‹åŒ–sub reactor threads[i] = new Thread(reactors[i]); //åˆå§‹åŒ–è¿è¡Œsub reactorçš„çº¿ç¨‹ threads[i].start(); //å¯åŠ¨ï¼ˆå¯åŠ¨åçš„æ‰§è¡Œå‚è€ƒSubReactoré‡Œçš„runæ–¹æ³•ï¼‰ } } @Override public void run() { SocketChannel socketChannel; try { socketChannel = serverSocketChannel.accept(); // è¿æ¥ if (socketChannel != null) { System.out.println(String.format(\"æ”¶åˆ°æ¥è‡ª %s çš„è¿æ¥\", socketChannel.getRemoteAddress())); socketChannel.configureBlocking(false); // reactors[next].registering(true); // æ³¨æ„ä¸€ä¸ªselectoråœ¨selectæ—¶æ˜¯æ— æ³•æ³¨å†Œæ–°äº‹ä»¶çš„ï¼Œå› æ­¤è¿™é‡Œè¦å…ˆæš‚åœä¸‹selectæ–¹æ³•è§¦å‘çš„ç¨‹åºæ®µï¼Œä¸‹é¢çš„weakupå’Œè¿™é‡Œçš„setRestartéƒ½æ˜¯åšè¿™ä¸ªäº‹æƒ…çš„ï¼Œå…·ä½“å‚è€ƒSubReactoré‡Œçš„runæ–¹æ³• selectors[next].wakeup(); // ä½¿ä¸€å€‹é˜»å¡ä½çš„selectoræ“ä½œç«‹å³è¿”å› SelectionKey selectionKey = socketChannel.register(selectors[next], SelectionKey.OP_READ); // å½“å‰å®¢æˆ·ç«¯é€šé“SocketChannelå‘selector[next]æ³¨å†Œä¸€ä¸ªè¯»äº‹ä»¶ï¼Œè¿”å›key selectors[next].wakeup(); // ä½¿ä¸€å€‹é˜»å¡ä½çš„selectoræ“ä½œç«‹å³è¿”å› reactors[next].registering(false); // æœ¬æ¬¡äº‹ä»¶æ³¨å†Œå®Œæˆåï¼Œéœ€è¦å†æ¬¡è§¦å‘selectçš„æ‰§è¡Œï¼Œå› æ­¤è¿™é‡ŒRestartè¦åœ¨è®¾ç½®å›falseï¼ˆå…·ä½“å‚è€ƒSubReactoré‡Œçš„runæ–¹æ³•ï¼‰ selectionKey.attach(new AsyncHandler(socketChannel, selectors[next], next)); // ç»‘å®šHandler if (++next == selectors.length) { next = 0; //è¶Šç•Œåé‡æ–°åˆ†é… } } } catch (IOException e) { e.printStackTrace(); } }} ä»£ç å—4 å¯ä»¥è·Ÿä»¥å‰çš„Acceptoråšä¸ªå¯¹æ¯”ï¼Œåšäº†å¦‚ä¸‹æ”¹åŠ¨ï¼š æ¥å—åˆ°è¿æ¥åä¸å†ç›´æ¥è§¦å‘handleräº† åˆå§‹åŒ–ä¸€å †SubReactorï¼ˆä»ååº”å †ï¼‰ï¼Œæ¯ä¸ªäº¤ç»™ä¸€ä¸ªçº¿ç¨‹å¤„ç†ï¼Œæ³¨å†Œè¯»äº‹ä»¶åé¡ºåºåˆ†é…ç»™ä¸åŒçš„SubReactorå»å¤„ç†è‡ªå·±çš„selectorç›‘å¬ã€‚ ä»¥ä¸Šï¼Œå°±å¯ä»¥æŠŠè¯»å†™å¤„ç†+ä¸šåŠ¡å¤„ç†ä¸æ¥å—è¿æ¥çš„Reactorå½»åº•åˆ†å¼€äº†ï¼Œæ¥å—è¿æ¥çš„äº‹ä»¶ä¸å†å—ä»»ä½•è¯»å†™ã€ä¸šåŠ¡ç›¸å…³çš„å½±å“ï¼Œåªè´Ÿè´£æ¥æ”¶ï¼Œç›®å‰å³ä¾¿æ˜¯ä¸šåŠ¡çº¿ç¨‹æ± ç”¨å…‰çº¿ç¨‹å‘ç”Ÿæ’é˜Ÿï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°è¿æ¥çš„æ¥æ”¶ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šé™ä½äº†æœåŠ¡ç«¯çš„æ¥æ”¶èƒ½åŠ›é­é‡ç“¶é¢ˆçš„é£é™©ã€‚ step3.æ”¹å†™AsyncHandlerçš„æ‰“å°è¿™é‡Œå°±ä¸poä»£ç äº†ï¼Œå…·ä½“å°±æ˜¯æŠŠSubReactorçš„åºå·ä¼ ç»™handlerï¼Œæ ‡è®°è§¦å‘Handlerçš„Reactoræ˜¯å“ªä¸ªã€‚ åŒæ ·çš„ï¼Œå¯åŠ¨ä¸‹æœåŠ¡ç«¯ï¼Œå†å¼€å¯ä¸¤ä¸ªå®¢æˆ·ç«¯ï¼ˆè·Ÿä¹‹å‰ä¸€æ ·ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯å‘10æ¡æ¶ˆæ¯ç»ˆæ­¢è¿æ¥ï¼‰ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š æœåŠ¡ç«¯ï¼š 1234567891011121314151617181920212223242526272829301å·SubReactorç­‰å¾…æ³¨å†Œä¸­...3å·SubReactorç­‰å¾…æ³¨å†Œä¸­...0å·SubReactorç­‰å¾…æ³¨å†Œä¸­...2å·SubReactorç­‰å¾…æ³¨å†Œä¸­...æ”¶åˆ°æ¥è‡ª /127.0.0.1:60407 çš„è¿æ¥0å·SubReactorç­‰å¾…æ³¨å†Œä¸­...æ”¶åˆ°æ¥è‡ª /127.0.0.1:60410 çš„è¿æ¥1å·SubReactorç­‰å¾…æ³¨å†Œä¸­...1å·SubReactorè§¦å‘ï¼šæ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯/127.0.0.1:60410çš„æ¶ˆæ¯: å®¢æˆ·ç«¯å‘é€çš„ç¬¬1æ¡æ¶ˆæ¯0å·SubReactorè§¦å‘ï¼šæ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯/127.0.0.1:60407çš„æ¶ˆæ¯: å®¢æˆ·ç«¯å‘é€çš„ç¬¬1æ¡æ¶ˆæ¯0å·SubReactorè§¦å‘ï¼šæ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯/127.0.0.1:60407çš„æ¶ˆæ¯: å®¢æˆ·ç«¯å‘é€çš„ç¬¬2æ¡æ¶ˆæ¯1å·SubReactorè§¦å‘ï¼šæ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯/127.0.0.1:60410çš„æ¶ˆæ¯: å®¢æˆ·ç«¯å‘é€çš„ç¬¬2æ¡æ¶ˆæ¯0å·SubReactorè§¦å‘ï¼šæ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯/127.0.0.1:60407çš„æ¶ˆæ¯: å®¢æˆ·ç«¯å‘é€çš„ç¬¬3æ¡æ¶ˆæ¯1å·SubReactorè§¦å‘ï¼šæ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯/127.0.0.1:60410çš„æ¶ˆæ¯: å®¢æˆ·ç«¯å‘é€çš„ç¬¬3æ¡æ¶ˆæ¯1å·SubReactorè§¦å‘ï¼šæ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯/127.0.0.1:60410çš„æ¶ˆæ¯: å®¢æˆ·ç«¯å‘é€çš„ç¬¬4æ¡æ¶ˆæ¯0å·SubReactorè§¦å‘ï¼šæ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯/127.0.0.1:60407çš„æ¶ˆæ¯: å®¢æˆ·ç«¯å‘é€çš„ç¬¬4æ¡æ¶ˆæ¯1å·SubReactorè§¦å‘ï¼šæ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯/127.0.0.1:60410çš„æ¶ˆæ¯: å®¢æˆ·ç«¯å‘é€çš„ç¬¬5æ¡æ¶ˆæ¯0å·SubReactorè§¦å‘ï¼šæ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯/127.0.0.1:60407çš„æ¶ˆæ¯: å®¢æˆ·ç«¯å‘é€çš„ç¬¬5æ¡æ¶ˆæ¯1å·SubReactorè§¦å‘ï¼šæ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯/127.0.0.1:60410çš„æ¶ˆæ¯: å®¢æˆ·ç«¯å‘é€çš„ç¬¬6æ¡æ¶ˆæ¯0å·SubReactorè§¦å‘ï¼šæ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯/127.0.0.1:60407çš„æ¶ˆæ¯: å®¢æˆ·ç«¯å‘é€çš„ç¬¬6æ¡æ¶ˆæ¯1å·SubReactorè§¦å‘ï¼šæ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯/127.0.0.1:60410çš„æ¶ˆæ¯: å®¢æˆ·ç«¯å‘é€çš„ç¬¬7æ¡æ¶ˆæ¯0å·SubReactorè§¦å‘ï¼šæ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯/127.0.0.1:60407çš„æ¶ˆæ¯: å®¢æˆ·ç«¯å‘é€çš„ç¬¬7æ¡æ¶ˆæ¯0å·SubReactorè§¦å‘ï¼šæ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯/127.0.0.1:60407çš„æ¶ˆæ¯: å®¢æˆ·ç«¯å‘é€çš„ç¬¬8æ¡æ¶ˆæ¯1å·SubReactorè§¦å‘ï¼šæ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯/127.0.0.1:60410çš„æ¶ˆæ¯: å®¢æˆ·ç«¯å‘é€çš„ç¬¬8æ¡æ¶ˆæ¯0å·SubReactorè§¦å‘ï¼šæ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯/127.0.0.1:60407çš„æ¶ˆæ¯: å®¢æˆ·ç«¯å‘é€çš„ç¬¬9æ¡æ¶ˆæ¯1å·SubReactorè§¦å‘ï¼šæ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯/127.0.0.1:60410çš„æ¶ˆæ¯: å®¢æˆ·ç«¯å‘é€çš„ç¬¬9æ¡æ¶ˆæ¯0å·SubReactorè§¦å‘ï¼šæ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯/127.0.0.1:60407çš„æ¶ˆæ¯: å®¢æˆ·ç«¯å‘é€çš„ç¬¬10æ¡æ¶ˆæ¯1å·SubReactorè§¦å‘ï¼šæ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯/127.0.0.1:60410çš„æ¶ˆæ¯: å®¢æˆ·ç«¯å‘é€çš„ç¬¬10æ¡æ¶ˆæ¯0å·SubReactorè§¦å‘ï¼šreadæ—¶-------è¿æ¥å…³é—­1å·SubReactorè§¦å‘ï¼šreadæ—¶-------è¿æ¥å…³é—­ å®¢æˆ·ç«¯ï¼š 12345678910111213141516171819202122å·²å®Œæˆ /127.0.0.1:2333 çš„è¿æ¥å·²å®Œæˆ /127.0.0.1:2333 çš„è¿æ¥æ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯: 0å·SubReactorè§¦å‘ï¼šæˆ‘æ”¶åˆ°æ¥è‡ª/127.0.0.1:60407çš„ä¿¡æ¯è¾£ï¼šå®¢æˆ·ç«¯å‘é€çš„ç¬¬1æ¡æ¶ˆæ¯, 200ok;æ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯: 1å·SubReactorè§¦å‘ï¼šæˆ‘æ”¶åˆ°æ¥è‡ª/127.0.0.1:60410çš„ä¿¡æ¯è¾£ï¼šå®¢æˆ·ç«¯å‘é€çš„ç¬¬1æ¡æ¶ˆæ¯, 200ok;æ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯: 0å·SubReactorè§¦å‘ï¼šæˆ‘æ”¶åˆ°æ¥è‡ª/127.0.0.1:60407çš„ä¿¡æ¯è¾£ï¼šå®¢æˆ·ç«¯å‘é€çš„ç¬¬2æ¡æ¶ˆæ¯, 200ok;æ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯: 1å·SubReactorè§¦å‘ï¼šæˆ‘æ”¶åˆ°æ¥è‡ª/127.0.0.1:60410çš„ä¿¡æ¯è¾£ï¼šå®¢æˆ·ç«¯å‘é€çš„ç¬¬2æ¡æ¶ˆæ¯, 200ok;æ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯: 1å·SubReactorè§¦å‘ï¼šæˆ‘æ”¶åˆ°æ¥è‡ª/127.0.0.1:60410çš„ä¿¡æ¯è¾£ï¼šå®¢æˆ·ç«¯å‘é€çš„ç¬¬3æ¡æ¶ˆæ¯, 200ok;æ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯: 0å·SubReactorè§¦å‘ï¼šæˆ‘æ”¶åˆ°æ¥è‡ª/127.0.0.1:60407çš„ä¿¡æ¯è¾£ï¼šå®¢æˆ·ç«¯å‘é€çš„ç¬¬3æ¡æ¶ˆæ¯, 200ok;æ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯: 1å·SubReactorè§¦å‘ï¼šæˆ‘æ”¶åˆ°æ¥è‡ª/127.0.0.1:60410çš„ä¿¡æ¯è¾£ï¼šå®¢æˆ·ç«¯å‘é€çš„ç¬¬4æ¡æ¶ˆæ¯, 200ok;æ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯: 0å·SubReactorè§¦å‘ï¼šæˆ‘æ”¶åˆ°æ¥è‡ª/127.0.0.1:60407çš„ä¿¡æ¯è¾£ï¼šå®¢æˆ·ç«¯å‘é€çš„ç¬¬4æ¡æ¶ˆæ¯, 200ok;æ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯: 1å·SubReactorè§¦å‘ï¼šæˆ‘æ”¶åˆ°æ¥è‡ª/127.0.0.1:60410çš„ä¿¡æ¯è¾£ï¼šå®¢æˆ·ç«¯å‘é€çš„ç¬¬5æ¡æ¶ˆæ¯, 200ok;æ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯: 0å·SubReactorè§¦å‘ï¼šæˆ‘æ”¶åˆ°æ¥è‡ª/127.0.0.1:60407çš„ä¿¡æ¯è¾£ï¼šå®¢æˆ·ç«¯å‘é€çš„ç¬¬5æ¡æ¶ˆæ¯, 200ok;æ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯: 1å·SubReactorè§¦å‘ï¼šæˆ‘æ”¶åˆ°æ¥è‡ª/127.0.0.1:60410çš„ä¿¡æ¯è¾£ï¼šå®¢æˆ·ç«¯å‘é€çš„ç¬¬6æ¡æ¶ˆæ¯, 200ok;æ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯: 0å·SubReactorè§¦å‘ï¼šæˆ‘æ”¶åˆ°æ¥è‡ª/127.0.0.1:60407çš„ä¿¡æ¯è¾£ï¼šå®¢æˆ·ç«¯å‘é€çš„ç¬¬6æ¡æ¶ˆæ¯, 200ok;æ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯: 1å·SubReactorè§¦å‘ï¼šæˆ‘æ”¶åˆ°æ¥è‡ª/127.0.0.1:60410çš„ä¿¡æ¯è¾£ï¼šå®¢æˆ·ç«¯å‘é€çš„ç¬¬7æ¡æ¶ˆæ¯, 200ok;æ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯: 0å·SubReactorè§¦å‘ï¼šæˆ‘æ”¶åˆ°æ¥è‡ª/127.0.0.1:60407çš„ä¿¡æ¯è¾£ï¼šå®¢æˆ·ç«¯å‘é€çš„ç¬¬7æ¡æ¶ˆæ¯, 200ok;æ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯: 1å·SubReactorè§¦å‘ï¼šæˆ‘æ”¶åˆ°æ¥è‡ª/127.0.0.1:60410çš„ä¿¡æ¯è¾£ï¼šå®¢æˆ·ç«¯å‘é€çš„ç¬¬8æ¡æ¶ˆæ¯, 200ok;æ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯: 0å·SubReactorè§¦å‘ï¼šæˆ‘æ”¶åˆ°æ¥è‡ª/127.0.0.1:60407çš„ä¿¡æ¯è¾£ï¼šå®¢æˆ·ç«¯å‘é€çš„ç¬¬8æ¡æ¶ˆæ¯, 200ok;æ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯: 0å·SubReactorè§¦å‘ï¼šæˆ‘æ”¶åˆ°æ¥è‡ª/127.0.0.1:60407çš„ä¿¡æ¯è¾£ï¼šå®¢æˆ·ç«¯å‘é€çš„ç¬¬9æ¡æ¶ˆæ¯, 200ok;æ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯: 1å·SubReactorè§¦å‘ï¼šæˆ‘æ”¶åˆ°æ¥è‡ª/127.0.0.1:60410çš„ä¿¡æ¯è¾£ï¼šå®¢æˆ·ç«¯å‘é€çš„ç¬¬9æ¡æ¶ˆæ¯, 200ok;æ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯: 0å·SubReactorè§¦å‘ï¼šæˆ‘æ”¶åˆ°æ¥è‡ª/127.0.0.1:60407çš„ä¿¡æ¯è¾£ï¼šå®¢æˆ·ç«¯å‘é€çš„ç¬¬10æ¡æ¶ˆæ¯, 200ok;æ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯: 1å·SubReactorè§¦å‘ï¼šæˆ‘æ”¶åˆ°æ¥è‡ª/127.0.0.1:60410çš„ä¿¡æ¯è¾£ï¼šå®¢æˆ·ç«¯å‘é€çš„ç¬¬10æ¡æ¶ˆæ¯, 200ok; åˆ°è¿™é‡Œï¼Œä¸»ä»Reactoræ¨¡å‹å°±è¢«æ”¹å†™å®Œæˆäº†ï¼Œä¸Šé¢çš„ä¾‹å­åªæ˜¯ç®€å•æ¼”ç¤ºäº†ä¸‹è¿™ä¸ªæ¨¡å‹ï¼Œæ‰€æœ‰çš„ä¾‹å­éƒ½æ˜¯ä»å•çº¿ç¨‹Reactoræ¨¡å‹ä¸€ç‚¹ç‚¹æ”¹å†™æ¥çš„ï¼Œå®¢æˆ·ç«¯æ²¡å˜è¿‡ï¼Œä¸ºçš„æ˜¯æ›´å¥½çš„æµ‹è¯•æœåŠ¡ç«¯åœ¨ä¸åŒæ¨¡å‹ä¸‹çš„è¡¨ç°ã€‚ä¸»ä»Reactoræ¨¡å‹åº”ç”¨çš„æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚è‘—åNIOæ¡†æ¶Nettyåº•å±‚æ¨¡å‹ä¹Ÿæ˜¯åŸºäºä¸»ä»Reactoræ¨¡å‹æ¥å®ç°çš„ã€‚ åˆ°è¿™é‡Œjava nioçš„ä¸œè¥¿å·²ç»å·®ä¸å¤šè®°å½•å®Œäº†ï¼Œåç»­ä¼šå¼€å§‹nettyçš„å­¦ä¹ è®°å½•ï¼Œå½“ç„¶ä¸Šè¿°ä¾‹å­å¼±åŒ–äº†bufferçš„ä½¿ç”¨ï¼Œè€Œä¸”ä¾‹å­ä¸­ä¸å­˜åœ¨ç²˜åŒ…æ‹†åŒ…çš„é—®é¢˜ï¼ˆå› ä¸ºéƒ½æ˜¯è¯·æ±‚+åº”ç­”çš„æ–¹å¼è¿›è¡Œï¼‰ï¼Œå¦‚æœæŠŠä¸Šé¢çš„ä¾‹å­æ”¹æˆå®¢æˆ·ç«¯åœ¨æœªæ”¶åˆ°å“åº”æ—¶å°±è¿ç»­å‘é€å‡ æ¡ä¿¡æ¯ï¼ŒæœåŠ¡ç«¯è¿™æ—¶å†æ¬¡ç”±å†™æ¨¡å¼åˆ‡æ¢åˆ°è¯»æ¨¡å¼ï¼Œå°±ä¼šä»Channelé‡Œè¿ç»­æ‹¿åˆ°è¿™å‡ æ¡æ¶ˆæ¯ï¼Œè¿™å°±å¯¼è‡´äº†ç²˜åŒ…é—®é¢˜ï¼Œé‚£ä¹ˆå¦‚ä½•è§£å†³ç±»ä¼¼çš„é—®é¢˜å‘¢ï¼Ÿé€šå¸¸æ˜¯å®šä¹‰ä¸€ç§åè®®ï¼Œæ¥åŒºåˆ†æ¶ˆæ¯å¤´å’Œå°¾ï¼Œä¸­é—´çš„æ¶ˆæ¯ä½“æ˜¯æˆ‘ä»¬çœŸæ­£éœ€è¦çš„æ•°æ®ï¼Œè¿™ç§åè®®ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„åº”ç”¨å±‚åè®®ï¼Œæ¯”å¦‚HTTPã€FTPç­‰ï¼Œè¿™é‡Œä¸åšèµ˜è¿°ï¼Œä¹‹åä¼šé€šè¿‡ä¸€ä¸ªä¾‹å­æ¥å®Œæˆè¿™éƒ¨åˆ†çš„è¡¥å……è¯´æ˜ã€‚ ä»£ç åœ°å€ å•çº¿ç¨‹Reactoræ¨¡å‹ï¼šhttps://github.com/exceting/DemoAll/tree/master/jdk/src/main/java/demo/jdk/reactor/simple å¤šçº¿ç¨‹Reactoræ¨¡å‹ï¼šåŒä¸Šï¼ŒAcceptoré‡Œçš„Handleræ”¹æˆAsyncHandlerå³å¯ ä¸»ä»å¤šçº¿ç¨‹Reactoræ¨¡å‹ï¼šhttps://github.com/exceting/DemoAll/tree/master/jdk/src/main/java/demo/jdk/reactor/mainsub","link":"/2019/04/01/Java%20NIO%E5%AD%A6%E4%B9%A0%E4%B8%8E%E8%AE%B0%E5%BD%95%EF%BC%88%E5%85%AB%EF%BC%89%EF%BC%9A%20Reactor%E4%B8%A4%E7%A7%8D%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%AE%9E%E7%8E%B0/"},{"title":"Java NIOå­¦ä¹ ä¸è®°å½•ï¼ˆä¸ƒï¼‰ï¼š Reactorå•çº¿ç¨‹æ¨¡å‹çš„å®ç°","text":"ä¸€ã€Selector&amp;Channel1.1ï¼šå„ç§channelå†™è¿™ä¸ªæ¨¡å‹éœ€è¦æå‰äº†è§£Selectorä»¥åŠChannelï¼Œä¹‹å‰è®°å½•è¿‡FileChannelï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä»¥ä¸‹å‡ ç§Channelï¼š ServerSocketChannelï¼šç”¨äºç›‘å¬æ–°çš„TCPè¿æ¥çš„é€šé“ï¼Œè´Ÿè´£è¯»å–&amp;å“åº”ï¼Œé€šå¸¸ç”¨äºæœåŠ¡ç«¯çš„å®ç°ã€‚ SocketChannelï¼šç”¨äºå‘èµ·TCPè¿æ¥ï¼Œè¯»å†™ç½‘ç»œä¸­çš„æ•°æ®ï¼Œé€šå¸¸ç”¨äºå®¢æˆ·ç«¯çš„å®ç°ã€‚ DatagramChannelï¼šä¸Šè¿°ä¸¤ä¸ªé€šé“åŸºäºTCPä¼ è¾“åè®®ï¼Œè€Œè¿™ä¸ªé€šé“åˆ™åŸºäºUDPï¼Œç”¨äºè¯»å†™ç½‘ç»œä¸­çš„æ•°æ®ã€‚ FileChannelï¼šä»æ–‡ä»¶è¯»å–æ•°æ®ã€‚ æœ¬ç¯‡é‡ç‚¹æ”¾åœ¨ServerSocketChannelå’ŒSocketChannelä¸Šï¼Œå¤§éƒ¨åˆ†å®¢æˆ·ç«¯/æœåŠ¡ç«¯ä¸ºäº†ä¿è¯æ•°æ®å‡†ç¡®æ€§ï¼Œéƒ½æ˜¯åŸºäºTCPä¼ è¾“åè®®å®ç°çš„ï¼Œç”±äºä½¿ç”¨Selectoræ³¨å†Œå¿…é¡»è¦æ±‚è¢«æ³¨å†Œçš„Channelæ˜¯éé˜»å¡æ¨¡å¼çš„ï¼Œå› æ­¤FileChannelç”±äºæ²¡æœ‰éé˜»å¡æ¨¡å¼ï¼ˆæ— æ³•è®¾ç½®configureBlocking(false)ï¼‰ï¼Œæ²¡åŠæ³•å’Œæ³¨å†Œåˆ°selectorã€‚ 1.2ï¼šselectorSelectoræ˜¯ä¸ªé€šé“æ³¨å†Œå™¨ï¼ˆç”¨æ³•ä¼šåœ¨ç¨‹åºé‡Œæ ‡æ³¨ï¼‰ï¼Œæ˜¯å®ç°Reactoræ¨¡å‹çš„å…³é”®ï¼Œå¤šä¸ªé€šé“å‡å¯ä»¥æ³¨å†Œåˆ°Selectorï¼ŒSelectorè´Ÿè´£ç›‘å¬æ¯ä¸ªChannelçš„å‡ ä¸ªäº‹ä»¶ï¼šè¿æ¥å°±ç»ªã€å†™å°±ç»ªã€è¯»å°±ç»ªï¼Œå½“æŸä¸ªchannelæ³¨å†Œæ„Ÿå…´è¶£å°±ç»ªäº‹ä»¶åˆ°selectoræ—¶ï¼Œè‹¥å‘ç”Ÿå…´è¶£äº‹ä»¶å°±ç»ªï¼Œåˆ™Selector.select()æ–¹æ³•ä¸å†é˜»å¡ï¼Œè¿”å›å…´è¶£äº‹ä»¶é›†åˆï¼ˆå¯èƒ½åŒ…å«å¤šä¸ªchannelçš„ï¼‰ï¼Œç„¶åæŒ‰ç…§äº‹ä»¶ä¸åŒè¿›è¡Œåˆ†å‘å¤„ç†ã€‚ Selectorè¿”å›å¯¹åº”çš„å°±ç»ªäº‹ä»¶ï¼Œå°è£…ä¸ºSelectionKeyï¼Œæ¯ä¸ªChannelå¯¹åº”ä¸€ä¸ªSelectionKeyï¼Œè¿™ä¸ªå¯¹è±¡è¿˜å¯ä»¥é€šè¿‡attachæ–¹æ³•é™„ç€å¤„ç†ç±»ï¼ˆHandlerã€Acceptorç­‰ï¼‰ã€‚ 1.3ï¼šä¸€ä¸ªç®€å•çš„ä¾‹å­å…ˆæ¥çœ‹ä¸ªç®€å•ä½¿ç”¨Selectoråšå¤„ç†çš„æœåŠ¡ç«¯å®ç°ï¼Œå¯ä»¥ç®€å•å¯¹Selectorå’ŒSelectionKeyçš„ç”¨æ³•åšä¸ªäº†è§£ï¼š 123456789101112131415161718192021222324252627282930313233343536373839public static void main(String[] args) throws IOException { Selector selector = Selector.open(); //æ‰“å¼€é€‰æ‹©å™¨ ServerSocketChannel serverSocketChannel = ServerSocketChannel.open(); //æ‰“å¼€é€šé“ serverSocketChannel.configureBlocking(false); //è®¾ç½®é€šé“ä¸ºéé˜»å¡æ¨¡å¼ serverSocketChannel.bind(new InetSocketAddress(2333)); //ç»‘å®šç«¯å£ serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT); //æ³¨å†Œchannelåˆ°é€‰æ‹©å™¨ï¼ŒæŒ‡å®šç›‘å¬è¯¥Channelçš„å“ªäº›äº‹ä»¶ï¼Œåˆå§‹åŒ–éƒ½æ˜¯å¯¹è¿æ¥äº‹ä»¶ç›‘å¬ï¼ˆå› ä¸ºæ˜¯å…¥å£ï¼‰ while (selector.select() &gt; 0) { // è‹¥æ”¶åˆ°å°±ç»ªäº‹ä»¶selectè¿”å›â€œæ„Ÿå…´è¶£â€äº‹ä»¶é›†åˆï¼Œå¦åˆ™é˜»å¡å½“å‰çº¿ç¨‹ Set keys = selector.selectedKeys(); //è·å–æœ¬æ¬¡æ‹¿åˆ°çš„äº‹ä»¶é›†åˆ Iterator iterator = keys.iterator(); while (iterator.hasNext()) { SelectionKey key = iterator.next(); iterator.remove(); if (key.isAcceptable()) { //å½“å‰å°±ç»ªäº‹ä»¶ä¸ºè¿æ¥äº‹ä»¶ ServerSocketChannel skc = (ServerSocketChannel) key.channel(); //è¿æ¥å°±ç»ªè§¦å‘ï¼Œè¯´æ˜å·²ç»æœ‰å®¢æˆ·ç«¯é€šé“è¿äº†è¿‡æ¥ï¼Œè¿™é‡Œéœ€è¦æ‹¿æœåŠ¡ç«¯é€šé“å»è·å–å®¢æˆ·ç«¯é€šé“ SocketChannel socketChannel = skc.accept(); //è·å–å®¢æˆ·ç«¯é€šé“ï¼ˆè¿æ¥å°±ç»ªï¼Œè¯´æ˜å®¢æˆ·ç«¯æ¥ä¸‹æ¥å¯èƒ½è¿˜æœ‰åˆ«çš„åŠ¨ä½œï¼Œæ¯”å¦‚è¯»å’Œå†™ï¼‰ socketChannel.configureBlocking(false); //åŒæ ·çš„éœ€è¦è®¾ç½®éé˜»å¡æ¨¡å¼ System.out.println(String.format(\"æ”¶åˆ°æ¥è‡ª %s çš„è¿æ¥\", socketChannel.getRemoteAddress())); socketChannel.register(selector, SelectionKey.OP_READ); //å°†è¯¥å®¢æˆ·ç«¯æ³¨å†Œåˆ°é€‰æ‹©å™¨ï¼Œæ„Ÿå…´è¶£äº‹ä»¶è®¾ç½®ä¸ºè¯»ï¼ˆå®¢æˆ·ç«¯è¿æ¥å®Œæ¯•ï¼Œå¾ˆè‚¯èƒ½ä¼šå¾€æœåŠ¡ç«¯å†™æ•°æ®ï¼Œå› æ­¤è¿™é‡Œè¦æ³¨å†Œè¯»äº‹ä»¶ç”¨ä»¥æ¥æ”¶è¿™äº›æ•°æ®ï¼‰ } else if (key.isReadable()) { //å½“å‰äº‹ä»¶ä¸ºè¯»å°±ç»ª SocketChannel socketChannel = (SocketChannel) key.channel(); //èƒ½è§¦å‘è¯»å°±ç»ªï¼Œè¯´æ˜å®¢æˆ·ç«¯å·²ç»å¼€å§‹å¾€æœåŠ¡ç«¯å†™æ•°æ®ï¼Œé€šè¿‡SelectionKeyæ‹¿åˆ°å½“å‰å®¢æˆ·ç«¯é€šé“ ByteBuffer buffer = ByteBuffer.allocate(1024); int count = socketChannel.read(buffer); //ä»é€šé“è¯»å…¥æ•°æ® if (count &lt; 0) { //è‹¥æœ¬æ¬¡è¯»å°±ç»ªæ‹¿åˆ°-1ï¼Œåˆ™è®¤ä¸ºå®¢æˆ·ç«¯ä¸»åŠ¨æ–­å¼€äº†è¿æ¥ socketChannel.close(); //æœåŠ¡ç«¯å…³é—­å®¢æˆ·ç«¯é€šé“ key.cancel(); //æ–­è¿åå°±å°†è¯¥äº‹ä»¶ä»é€‰æ‹©å™¨çš„SelectionKeyé›†åˆä¸­ç§»é™¤ï¼ˆè¿™é‡Œè¯´ä¸€ä¸‹ï¼Œè¿™é‡Œä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ç§»é™¤ï¼Œè¿™é‡Œæ˜¯å–æ¶ˆï¼Œä¼šå°†è¯¥keyæ”¾å…¥å–æ¶ˆé˜Ÿåˆ—é‡Œï¼Œåœ¨ä¸‹æ¬¡selectå‡½æ•°è°ƒç”¨æ—¶æ‰è´Ÿè´£æ¸…ç©ºï¼‰ System.out.println(\"è¿æ¥å…³é—­\"); continue; } System.out.println(String.format(\"æ”¶åˆ°æ¥è‡ª %s çš„æ¶ˆæ¯: %s\", socketChannel.getRemoteAddress(), new String(buffer.array()))); } keys.remove(key); } } } ä»£ç å—1 ä¸Šé¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¥ä¸‹æ¥ï¼Œå°±åˆ©ç”¨é€‰æ‹©å™¨ã€é€šé“æ¥å®ç°Reactorå•çº¿ç¨‹æ¨¡å‹ã€‚ äºŒã€å•Reactorå•çº¿ç¨‹æ¨¡å‹çš„æœåŠ¡ç«¯å®ç°å®ç°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œæ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚æ•°æ®ä»¥åŠå“åº”å®¢æˆ·ç«¯ã€‚ æŠŠä¸Šä¸€ç¯‡çš„ç»“æ„å›¾å†æ‹¿è¿‡æ¥å±•ç¤ºä¸‹ï¼Œçœ‹çœ‹éœ€è¦åšçš„æœ‰å“ªäº›æ¨¡å—ï¼š é€šè¿‡ä¸Šå›¾ï¼Œæˆ‘ä»¬éœ€è¦å®ç°çš„æ¨¡å—æœ‰Reactorã€Acceptorã€Handlerï¼Œä¸‹é¢æ¥é€ä¸ªç¼–å†™ï¼š 2.1ï¼šReactoræ ¸å¿ƒæ¨¡å—è¯¥æ¨¡å—å†…éƒ¨åŒ…å«ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼Œselectå’Œdispatchï¼Œè¯¥æ¨¡å—è´Ÿè´£ç›‘å¬å°±ç»ªäº‹ä»¶å’Œå¯¹äº‹ä»¶çš„åˆ†å‘å¤„ç†ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142public class Reactor implements Runnable { private final Selector selector; private final ServerSocketChannel serverSocketChannel; public Reactor(int port) throws IOException { //Reactoråˆå§‹åŒ– selector = Selector.open(); //æ‰“å¼€ä¸€ä¸ªSelector serverSocketChannel = ServerSocketChannel.open(); //å»ºç«‹ä¸€ä¸ªServerç«¯é€šé“ serverSocketChannel.socket().bind(new InetSocketAddress(port)); //ç»‘å®šæœåŠ¡ç«¯å£ serverSocketChannel.configureBlocking(false); //selectoræ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰é€šé“å¿…é¡»æ˜¯éé˜»å¡çš„ //Reactoræ˜¯å…¥å£ï¼Œæœ€åˆç»™ä¸€ä¸ªchannelæ³¨å†Œä¸Šå»çš„äº‹ä»¶éƒ½æ˜¯accept SelectionKey sk = serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT); //attach callback object, Acceptor sk.attach(new Acceptor(serverSocketChannel, selector)); } @Override public void run() { try { while (!Thread.interrupted()) { selector.select(); //å°±ç»ªäº‹ä»¶åˆ°è¾¾ä¹‹å‰ï¼Œé˜»å¡ Set selected = selector.selectedKeys(); //æ‹¿åˆ°æœ¬æ¬¡selectè·å–çš„å°±ç»ªäº‹ä»¶ Iterator it = selected.iterator(); while (it.hasNext()) { //è¿™é‡Œè¿›è¡Œä»»åŠ¡åˆ†å‘ dispatch((SelectionKey) (it.next())); } selected.clear(); } } catch (IOException e) { e.printStackTrace(); } } void dispatch(SelectionKey k) { Runnable r = (Runnable) (k.attachment()); //è¿™é‡Œå¾ˆå…³é”®ï¼Œæ‹¿åˆ°æ¯æ¬¡selectKeyé‡Œé¢é™„å¸¦çš„å¤„ç†å¯¹è±¡ï¼Œç„¶åè°ƒç”¨å…¶runï¼Œè¿™ä¸ªå¯¹è±¡åœ¨å…·ä½“çš„Handleré‡Œä¼šè¿›è¡Œåˆ›å»ºï¼Œåˆå§‹åŒ–çš„é™„å¸¦å¯¹è±¡ä¸ºAcceptorï¼ˆçœ‹ä¸Šé¢æ„é€ å™¨ï¼‰ //è°ƒç”¨ä¹‹å‰æ³¨å†Œçš„callbackå¯¹è±¡ if (r != null) { r.run(); } }} ä»£ç å—2 ç»†èŠ‚å·²æ ‡æ³¨ã€‚ 2.2ï¼šå®ç°Acceptoræ¨¡å—è¿™ä¸ªæ¨¡å—åªè´Ÿè´£å¤„ç†è¿æ¥å°±ç»ªäº‹ä»¶ï¼Œæœ‰äº†è¿™ä¸ªäº‹ä»¶å°±å¯ä»¥æ‹¿åˆ°å®¢æˆ·å•çš„SocketChannelï¼Œå°±å¯ä»¥ç»§ç»­å®Œæˆæ¥ä¸‹æ¥çš„è¯»å†™ä»»åŠ¡äº†ï¼š 1234567891011121314151617181920212223242526public class Acceptor implements Runnable { private final Selector selector; private final ServerSocketChannel serverSocketChannel; Acceptor(ServerSocketChannel serverSocketChannel, Selector selector) { this.serverSocketChannel = serverSocketChannel; this.selector = selector; } @Override public void run() { SocketChannel socketChannel; try { socketChannel = serverSocketChannel.accept(); if (socketChannel != null) { System.out.println(String.format(\"æ”¶åˆ°æ¥è‡ª %s çš„è¿æ¥\", socketChannel.getRemoteAddress())); new Handler(socketChannel, selector); //è¿™é‡ŒæŠŠå®¢æˆ·ç«¯é€šé“ä¼ ç»™Handlerï¼ŒHandlerè´Ÿè´£æ¥ä¸‹æ¥çš„äº‹ä»¶å¤„ç†ï¼ˆé™¤äº†è¿æ¥äº‹ä»¶ä»¥å¤–çš„äº‹ä»¶å‡å¯ï¼‰ } } catch (IOException e) { e.printStackTrace(); } }} ä»£ç å—3 ç»†èŠ‚å·²æ ‡æ³¨ã€‚ 2.3ï¼šHandleræ¨¡å—çš„å®ç°è¿™ä¸ªæ¨¡å—è´Ÿè´£æ¥ä¸‹æ¥çš„è¯»å†™æ“ä½œï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788public class Handler implements Runnable { private final SelectionKey selectionKey; private final SocketChannel socketChannel; private ByteBuffer readBuffer = ByteBuffer.allocate(1024); private ByteBuffer sendBuffer = ByteBuffer.allocate(2048); private final static int READ = 0; private final static int SEND = 1; private int status = READ; Handler(SocketChannel socketChannel, Selector selector) throws IOException { this.socketChannel = socketChannel; //æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ this.socketChannel.configureBlocking(false); //ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼ˆselectorä»…å…éé˜»å¡æ¨¡å¼ï¼‰ selectionKey = socketChannel.register(selector, 0); //å°†è¯¥å®¢æˆ·ç«¯æ³¨å†Œåˆ°selectorï¼Œå¾—åˆ°ä¸€ä¸ªSelectionKeyï¼Œä»¥åçš„selectåˆ°çš„å°±ç»ªåŠ¨ä½œå…¨éƒ½æ˜¯ç”±è¯¥å¯¹è±¡è¿›è¡Œå°è£… selectionKey.attach(this); //é™„åŠ å¤„ç†å¯¹è±¡ï¼Œå½“å‰æ˜¯Handlerå¯¹è±¡ï¼Œrunæ˜¯å¯¹è±¡å¤„ç†ä¸šåŠ¡çš„æ–¹æ³• selectionKey.interestOps(SelectionKey.OP_READ); //èµ°åˆ°è¿™é‡Œï¼Œè¯´æ˜ä¹‹å‰Acceptoré‡Œçš„å»ºè¿å·²å®Œæˆï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯è¯»å–åŠ¨ä½œï¼Œå› æ­¤è¿™é‡Œé¦–å…ˆå°†è¯»äº‹ä»¶æ ‡è®°ä¸ºâ€œæ„Ÿå…´è¶£â€äº‹ä»¶ selector.wakeup(); //å”¤èµ·selecté˜»å¡ } @Override public void run() { try { switch (status) { case READ: read(); break; case SEND: send(); break; default: } } catch (IOException e) { //è¿™é‡Œçš„å¼‚å¸¸å¤„ç†æ˜¯åšäº†æ±‡æ€»ï¼Œå¸¸å‡ºçš„å¼‚å¸¸å°±æ˜¯serverç«¯è¿˜æœ‰æœªè¯»/å†™å®Œçš„å®¢æˆ·ç«¯æ¶ˆæ¯ï¼Œå®¢æˆ·ç«¯å°±ä¸»åŠ¨æ–­å¼€è¿æ¥ï¼Œè¿™ç§æƒ…å†µä¸‹æ˜¯ä¸ä¼šè§¦å‘è¿”å›-1çš„ï¼Œè¿™æ ·ä¸‹é¢readå’Œwriteæ–¹æ³•é‡Œçš„cancelå’Œcloseå°±éƒ½æ— æ³•è§¦å‘ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ­»å¾ªç¯å¼‚å¸¸ï¼ˆread/writeå¤„ç†å¤±è´¥ï¼Œäº‹ä»¶åˆæœªè¢«cancelï¼Œå› æ­¤ä¼šä¸æ–­çš„è¢«selectåˆ°ï¼Œä¸æ–­çš„æŠ¥å¼‚å¸¸ï¼‰ System.err.println(\"readæˆ–sendæ—¶å‘ç”Ÿå¼‚å¸¸ï¼å¼‚å¸¸ä¿¡æ¯ï¼š\" + e.getMessage()); selectionKey.cancel(); try { socketChannel.close(); } catch (IOException e2) { System.err.println(\"å…³é—­é€šé“æ—¶å‘ç”Ÿå¼‚å¸¸ï¼å¼‚å¸¸ä¿¡æ¯ï¼š\" + e2.getMessage()); e2.printStackTrace(); } } } private void read() throws IOException { if (selectionKey.isValid()) { readBuffer.clear(); int count = socketChannel.read(readBuffer); //readæ–¹æ³•ç»“æŸï¼Œæ„å‘³ç€æœ¬æ¬¡\"è¯»å°±ç»ª\"å˜ä¸º\"è¯»å®Œæ¯•\"ï¼Œæ ‡è®°ç€ä¸€æ¬¡å°±ç»ªäº‹ä»¶çš„ç»“æŸ if (count &gt; 0) { System.out.println(String.format(\"æ”¶åˆ°æ¥è‡ª %s çš„æ¶ˆæ¯: %s\", socketChannel.getRemoteAddress(), new String(readBuffer.array()))); status = SEND; selectionKey.interestOps(SelectionKey.OP_WRITE); //æ³¨å†Œå†™æ–¹æ³• } else { //è¯»æ¨¡å¼ä¸‹æ‹¿åˆ°çš„å€¼æ˜¯-1ï¼Œè¯´æ˜å®¢æˆ·ç«¯å·²ç»æ–­å¼€è¿æ¥ï¼Œé‚£ä¹ˆå°†å¯¹åº”çš„selectKeyä»selectoré‡Œæ¸…é™¤ï¼Œå¦åˆ™ä¸‹æ¬¡è¿˜ä¼šselectåˆ°ï¼Œå› ä¸ºæ–­å¼€è¿æ¥æ„å‘³ç€è¯»å°±ç»ªä¸ä¼šå˜æˆè¯»å®Œæ¯•ï¼Œä¹Ÿä¸cancelï¼Œä¸‹æ¬¡selectä¼šä¸åœæ”¶åˆ°è¯¥äº‹ä»¶ //æ‰€ä»¥åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œï¼ˆæœåŠ¡å™¨ç¨‹åºï¼‰ä½ éœ€è¦å…³é—­socketChannelå¹¶ä¸”å–æ¶ˆkeyï¼Œæœ€å¥½æ˜¯é€€å‡ºå½“å‰å‡½æ•°ã€‚æ³¨æ„ï¼Œè¿™ä¸ªæ—¶å€™æœåŠ¡ç«¯è¦æ˜¯ç»§ç»­ä½¿ç”¨è¯¥socketChannelè¿›è¡Œè¯»æ“ä½œçš„è¯ï¼Œå°±ä¼šæŠ›å‡ºâ€œè¿œç¨‹ä¸»æœºå¼ºè¿«å…³é—­ä¸€ä¸ªç°æœ‰çš„è¿æ¥â€çš„IOå¼‚å¸¸ã€‚ selectionKey.cancel(); socketChannel.close(); System.out.println(\"readæ—¶-------è¿æ¥å…³é—­\"); } } } void send() throws IOException { if (selectionKey.isValid()) { sendBuffer.clear(); sendBuffer.put(String.format(\"æˆ‘æ”¶åˆ°æ¥è‡ª%sçš„ä¿¡æ¯è¾£ï¼š%s, 200ok;\", socketChannel.getRemoteAddress(), new String(readBuffer.array())).getBytes()); sendBuffer.flip(); int count = socketChannel.write(sendBuffer); //writeæ–¹æ³•ç»“æŸï¼Œæ„å‘³ç€æœ¬æ¬¡å†™å°±ç»ªå˜ä¸ºå†™å®Œæ¯•ï¼Œæ ‡è®°ç€ä¸€æ¬¡äº‹ä»¶çš„ç»“æŸ if (count &lt; 0) { //åŒä¸Šï¼Œwriteåœºæ™¯ä¸‹ï¼Œå–åˆ°-1ï¼Œä¹Ÿæ„å‘³ç€å®¢æˆ·ç«¯æ–­å¼€è¿æ¥ selectionKey.cancel(); socketChannel.close(); System.out.println(\"sendæ—¶-------è¿æ¥å…³é—­\"); } //æ²¡æ–­å¼€è¿æ¥ï¼Œåˆ™å†æ¬¡åˆ‡æ¢åˆ°è¯» status = READ; selectionKey.interestOps(SelectionKey.OP_READ); } }} ä»£ç å—4 ç»†èŠ‚å·²æ ‡æ³¨ã€‚ å…³é”®æ¨¡å—å·²å®ç°ï¼Œä¸‹é¢æ¥å¯åŠ¨æœåŠ¡ç«¯ï¼š 1new Thread(new Reactor(2333)).start(); ä»£ç å—5 ä¸‰ã€å®¢æˆ·ç«¯çš„ç¼–å†™æ¥ä¸‹æ¥åŒæ ·åˆ©ç”¨selectorç¼–å†™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯éœ€è¦åšçš„äº‹æƒ…å°±æ˜¯å‘é€æ¶ˆæ¯åˆ°æœåŠ¡ç«¯ï¼Œç­‰å¾…æœåŠ¡ç«¯å“åº”ï¼Œç„¶åå†æ¬¡å‘é€æ¶ˆæ¯ï¼Œå‘å¤Ÿ10æ¡æ¶ˆæ¯æ–­å¼€è¿æ¥ï¼š 3.1ï¼šClientå…¥å£æ¨¡å—1234567891011121314151617181920212223242526272829303132333435363738394041424344454647public class NIOClient implements Runnable { private Selector selector; private SocketChannel socketChannel; NIOClient(String ip, int port) { try { selector = Selector.open(); //æ‰“å¼€ä¸€ä¸ªSelector socketChannel = SocketChannel.open(); socketChannel.configureBlocking(false); //è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ socketChannel.connect(new InetSocketAddress(ip, port)); //è¿æ¥æœåŠ¡ //å…¥å£ï¼Œæœ€åˆç»™ä¸€ä¸ªå®¢æˆ·ç«¯channelæ³¨å†Œä¸Šå»çš„äº‹ä»¶éƒ½æ˜¯è¿æ¥äº‹ä»¶ SelectionKey sk = socketChannel.register(selector, SelectionKey.OP_CONNECT); //é™„åŠ å¤„ç†ç±»ï¼Œç¬¬ä¸€æ¬¡åˆå§‹åŒ–æ”¾çš„æ˜¯è¿æ¥å°±ç»ªå¤„ç†ç±» sk.attach(new Connector(socketChannel, selector)); } catch (IOException e) { e.printStackTrace(); } } @Override public void run() { try { while (!Thread.interrupted()) { selector.select(); //å°±ç»ªäº‹ä»¶åˆ°è¾¾ä¹‹å‰ï¼Œé˜»å¡ Set selected = selector.selectedKeys(); //æ‹¿åˆ°æœ¬æ¬¡selectè·å–çš„å°±ç»ªäº‹ä»¶ Iterator it = selected.iterator(); while (it.hasNext()) { //è¿™é‡Œè¿›è¡Œä»»åŠ¡åˆ†å‘ dispatch((SelectionKey) (it.next())); } selected.clear(); } } catch (IOException e) { e.printStackTrace(); } } void dispatch(SelectionKey k) { Runnable r = (Runnable) (k.attachment()); //è¿™é‡Œå¾ˆå…³é”®ï¼Œæ‹¿åˆ°æ¯æ¬¡selectKeyé‡Œé¢é™„å¸¦çš„å¤„ç†å¯¹è±¡ï¼Œç„¶åè°ƒç”¨å…¶runï¼Œè¿™ä¸ªå¯¹è±¡åœ¨å…·ä½“çš„Handleré‡Œä¼šè¿›è¡Œåˆ›å»ºï¼Œåˆå§‹åŒ–çš„é™„å¸¦å¯¹è±¡ä¸ºConnectorï¼ˆçœ‹ä¸Šé¢æ„é€ å™¨ï¼‰ //è°ƒç”¨ä¹‹å‰æ³¨å†Œçš„callbackå¯¹è±¡ if (r != null) { r.run(); } }} ä»£ç å—6 ç»†èŠ‚å·²æ ‡æ³¨ã€‚ 3.2ï¼šConnectoræ¨¡å—ï¼ˆå»ºè¿ï¼‰123456789101112131415161718192021222324public class Connector implements Runnable { private final Selector selector; private final SocketChannel socketChannel; Connector(SocketChannel socketChannel, Selector selector) { this.socketChannel = socketChannel; this.selector = selector; } @Override public void run() { try { if (socketChannel.finishConnect()) { //è¿™é‡Œè¿æ¥å®Œæˆï¼ˆä¸æœåŠ¡ç«¯çš„ä¸‰æ¬¡æ¡æ‰‹å®Œæˆï¼‰ System.out.println(String.format(\"å·²å®Œæˆ %s çš„è¿æ¥\", socketChannel.getRemoteAddress())); new Handler(socketChannel, selector); //è¿æ¥å»ºç«‹å®Œæˆåï¼Œæ¥ä¸‹æ¥çš„åŠ¨ä½œäº¤ç»™Handlerå»å¤„ç†ï¼ˆè¯»å†™ç­‰ï¼‰ } } catch (IOException e) { e.printStackTrace(); } }} ä»£ç å—7 ç»†èŠ‚å·²æ ‡æ³¨ã€‚ 3.3ï¼šå®¢æˆ·ç«¯Handleræ¨¡å—å®ç°12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879public class Handler implements Runnable { private final SelectionKey selectionKey; private final SocketChannel socketChannel; private ByteBuffer readBuffer = ByteBuffer.allocate(2048); private ByteBuffer sendBuffer = ByteBuffer.allocate(1024); private final static int READ = 0; private final static int SEND = 1; private int status = SEND; //ä¸æœåŠ¡ç«¯ä¸åŒï¼Œé»˜è®¤æœ€å¼€å§‹æ˜¯å‘é€æ•°æ® private AtomicInteger counter = new AtomicInteger(); Handler(SocketChannel socketChannel, Selector selector) throws IOException { this.socketChannel = socketChannel; //æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ this.socketChannel.configureBlocking(false); //ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼ˆselectorä»…å…éé˜»å¡æ¨¡å¼ï¼‰ selectionKey = socketChannel.register(selector, 0); //å°†è¯¥å®¢æˆ·ç«¯æ³¨å†Œåˆ°selectorï¼Œå¾—åˆ°ä¸€ä¸ªSelectionKeyï¼Œä»¥åçš„selectåˆ°çš„å°±ç»ªåŠ¨ä½œå…¨éƒ½æ˜¯ç”±è¯¥å¯¹è±¡è¿›è¡Œå°è£… selectionKey.attach(this); //é™„åŠ å¤„ç†å¯¹è±¡ï¼Œå½“å‰æ˜¯Handlerå¯¹è±¡ï¼Œrunæ˜¯å¯¹è±¡å¤„ç†ä¸šåŠ¡çš„æ–¹æ³• selectionKey.interestOps(SelectionKey.OP_WRITE); //èµ°åˆ°è¿™é‡Œï¼Œè¯´æ˜ä¹‹å‰Connectå·²å®Œæˆï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯å‘é€æ•°æ®ï¼Œå› æ­¤è¿™é‡Œé¦–å…ˆå°†å†™äº‹ä»¶æ ‡è®°ä¸ºâ€œæ„Ÿå…´è¶£â€äº‹ä»¶ selector.wakeup(); //å”¤èµ·selecté˜»å¡ } @Override public void run() { try { switch (status) { case SEND: send(); break; case READ: read(); break; default: } } catch (IOException e) { //è¿™é‡Œçš„å¼‚å¸¸å¤„ç†æ˜¯åšäº†æ±‡æ€»ï¼ŒåŒæ ·çš„ï¼Œå®¢æˆ·ç«¯ä¹Ÿé¢ä¸´ç€æ­£åœ¨ä¸æœåŠ¡ç«¯è¿›è¡Œå†™/è¯»æ•°æ®æ—¶ï¼Œçªç„¶å› ä¸ºç½‘ç»œç­‰åŸå› ï¼ŒæœåŠ¡ç«¯ç›´æ¥æ–­æ‰è¿æ¥ï¼Œè¿™ä¸ªæ—¶å€™å®¢æˆ·ç«¯éœ€è¦å…³é—­è‡ªå·±å¹¶é€€å‡ºç¨‹åº System.err.println(\"sendæˆ–readæ—¶å‘ç”Ÿå¼‚å¸¸ï¼å¼‚å¸¸ä¿¡æ¯ï¼š\" + e.getMessage()); selectionKey.cancel(); try { socketChannel.close(); } catch (IOException e2) { System.err.println(\"å…³é—­é€šé“æ—¶å‘ç”Ÿå¼‚å¸¸ï¼å¼‚å¸¸ä¿¡æ¯ï¼š\" + e2.getMessage()); e2.printStackTrace(); } } } void send() throws IOException { if (selectionKey.isValid()) { sendBuffer.clear(); int count = counter.incrementAndGet(); if (count &lt;= 10) { sendBuffer.put(String.format(\"å®¢æˆ·ç«¯å‘é€çš„ç¬¬%sæ¡æ¶ˆæ¯\", count).getBytes()); sendBuffer.flip(); //åˆ‡æ¢åˆ°è¯»æ¨¡å¼ï¼Œç”¨äºè®©é€šé“è¯»åˆ°bufferé‡Œçš„æ•°æ® socketChannel.write(sendBuffer); //åˆ™å†æ¬¡åˆ‡æ¢åˆ°è¯»ï¼Œç”¨ä»¥æ¥æ”¶æœåŠ¡ç«¯çš„å“åº” status = READ; selectionKey.interestOps(SelectionKey.OP_READ); } else { selectionKey.cancel(); socketChannel.close(); } } } private void read() throws IOException { if (selectionKey.isValid()) { readBuffer.clear(); //åˆ‡æ¢æˆbufferçš„å†™æ¨¡å¼ï¼Œç”¨äºè®©é€šé“å°†è‡ªå·±çš„å†…å®¹å†™å…¥åˆ°bufferé‡Œ socketChannel.read(readBuffer); System.out.println(String.format(\"æ”¶åˆ°æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯: %s\", new String(readBuffer.array()))); //æ”¶åˆ°æœåŠ¡ç«¯çš„å“åº”åï¼Œå†ç»§ç»­å¾€æœåŠ¡ç«¯å‘é€æ•°æ® status = SEND; selectionKey.interestOps(SelectionKey.OP_WRITE); //æ³¨å†Œå†™äº‹ä»¶ } }} ä»£ç å—8 ç»†èŠ‚å·²æ ‡æ³¨ã€‚ ä¸‹é¢å¯åŠ¨å®¢æˆ·ç«¯å»è¿æ¥ä¹‹å‰çš„æœåŠ¡ç«¯ï¼š 12new Thread(new NIOClient(\"127.0.0.1\", 2333)).start();new Thread(new NIOClient(\"127.0.0.1\", 2333)).start(); ä»£ç å—9 ä¸Šé¢æ¨¡æ‹Ÿäº†ä¸¤ä¸ªå®¢æˆ·ç«¯åŒæ—¶è¿åˆ°æœåŠ¡ç«¯ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š å•çº¿ç¨‹Reactoræ¨¡å‹æœ‰ä¸ªè‡´å‘½çš„ç¼ºç‚¹ï¼Œé€šè¿‡ä¸Šè¿°ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œæ•´ä¸ªæ‰§è¡Œæµç¨‹éƒ½æ˜¯çº¿æ€§çš„ï¼Œå®¢æˆ·ç«¯è¯·æ±‚â†’æœåŠ¡ç«¯è¯»å–â†’æœåŠ¡ç«¯å“åº”â†’å®¢æˆ·ç«¯æ”¶åˆ°å“åº”â†’å®¢æˆ·ç«¯å†æ¬¡å‘é€è¯·æ±‚ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªé“¾è·¯ä¸­ï¼Œå¦‚æœhandlerä¸­æŸä¸ªä½ç½®å­˜åœ¨æ€§èƒ½ç“¶é¢ˆï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥æ”¹é€ ä¸‹æœåŠ¡ç«¯çš„sendæ–¹æ³•ï¼š 1234567try { Thread.sleep(2000L); //å“åº”2s} catch (InterruptedException e) { e.printStackTrace();}int count = socketChannel.write(sendBuffer); ä»£ç å—10 åœ¨å“åº”å®¢æˆ·ç«¯ä¹‹å‰ç¡çœ 2sï¼Œå½“åšæ˜¯æ€§èƒ½ç“¶é¢ˆç‚¹ï¼ŒåŒæ ·çš„å†æ¬¡å¼€ä¸¤ä¸ªå®¢æˆ·ç«¯åŒæ—¶è®¿é—®æœåŠ¡ç«¯ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯å‘é€10æ¡æ¶ˆæ¯ï¼Œä¼šå‘ç°ï¼Œç¨‹åºç›´æ¥è¿è¡Œäº†40sï¼Œè¿™æ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹ä¸æ„¿æ„çœ‹åˆ°çš„ï¼Œå› æ­¤ï¼Œå°±æœ‰äº†å¤šçº¿ç¨‹Reactoræ¨¡å¼ï¼Œè·ŸBIOä¸ºäº†æé«˜æ€§èƒ½å°†è¯»æ“ä½œæ”¾åˆ°ä¸€ä¸ªç‹¬ç«‹çº¿ç¨‹å¤„ç†ä¸€æ ·ï¼ŒReactorè¿™æ ·åšï¼Œä¹Ÿæ˜¯ä¸ºäº†è§£å†³ä¸Šé¢æåˆ°çš„æ€§èƒ½é—®é¢˜ï¼Œåªä¸è¿‡NIOæ¯”BIOåšå¼‚æ­¥æœ‰ä¸ªæœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯NIOä¸ä¼šé˜»å¡ä¸€ä¸ªçº¿ç¨‹ï¼Œç±»ä¼¼readè¿™ç§æ“ä½œçŠ¶æ€éƒ½æ˜¯ç”±selectorè´Ÿè´£ç›‘å¬çš„ï¼Œä¸åƒBIOé‡Œéƒ½æ˜¯é˜»å¡çš„ï¼Œåªè¦è¢«å¼‚æ­¥å‡ºå»ï¼Œé‚£ä¹ˆä¸€å®šæ˜¯éé˜»å¡çš„ä¸šåŠ¡ä»£ç ï¼ˆé™¤éæ˜¯äººä¸ºå°†ä»£ç ææˆé˜»å¡ï¼‰ï¼Œè€ŒBIOç”±äºreadæœ¬èº«é˜»å¡ï¼Œå› æ­¤ä¼šé˜»å¡æ‰æ•´ä¸ªä¸šåŠ¡çº¿ç¨‹ï¼Œè¿™ä¹Ÿæ˜¯åŒæ ·æ˜¯å¼‚æ­¥ä¸ºä»€ä¹ˆNIOå¯ä»¥æ›´åŠ é«˜æ•ˆçš„åŸå› ä¹‹ä¸€ã€‚ é‚£ä¹ˆå•çº¿ç¨‹Reactoré€‚ç”¨äºä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿé€‚ç”¨äºé‚£ç§ç¨‹åºå¤æ‚åº¦å¾ˆä½çš„ç³»ç»Ÿï¼Œä¾‹å¦‚redisï¼Œå…¶å¤§éƒ¨åˆ†æ“ä½œéƒ½æ˜¯éå¸¸é«˜æ•ˆçš„ï¼Œå¾ˆå¤šå‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦ç›´æ¥ä¸ºO(1)ï¼Œè¿™ç§æƒ…å†µä¸‹é€‚åˆè¿™ç§ç®€å•çš„Reactoræ¨¡å‹å®ç°æœåŠ¡ç«¯ã€‚","link":"/2019/03/27/Java%20NIO%E5%AD%A6%E4%B9%A0%E4%B8%8E%E8%AE%B0%E5%BD%95%EF%BC%88%E4%B8%83%EF%BC%89%EF%BC%9A%20Reactor%E5%8D%95%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%AE%9E%E7%8E%B0/"},{"title":"javaæ€§èƒ½ç«ç„°å›¾çš„ç”Ÿæˆ","text":"ä¸€ã€å‰è¨€å¼€å§‹ä¹‹å‰ï¼Œä½ éœ€è¦å‡†å¤‡çš„ç¯å¢ƒï¼š Linuxç³»ç»Ÿæœºå™¨æˆ–è€…è™šæ‹Ÿæœºä¸€å°ï¼Œé‡Œé¢éœ€è¦å®‰è£…çš„è½¯ä»¶ï¼šgitã€jdkã€perlã€‚ äºŒã€ç®€å•ä»‹ç»javaæ€§èƒ½åˆ†æç«ç„°å›¾çš„æ‰€åšçš„äº‹æƒ…å°±æ˜¯èƒ½å¤Ÿåˆ†æå‡ºjavaç¨‹åºè¿è¡ŒæœŸé—´å­˜åœ¨çš„æ€§èƒ½é—®é¢˜ï¼Œå› ä¸ºæŸæ®µä»£ç æ‹–æ…¢æ•´ä¸ªç¨‹åºæ‰§è¡Œæ˜¯ä¸å…è®¸çš„ï¼Œå› æ­¤é ç«ç„°å›¾çš„ç»˜åˆ¶å’Œåˆ†æå°±å¯ä»¥æ‰¾å‡ºç±»ä¼¼çš„â€œé—®é¢˜ä»£ç æ®µâ€ã€‚ é‚£ä¹ˆè¿™ä¸ªå›¾æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿé¦–å…ˆè·Ÿå¤§å¤šæ•°ç›‘æ§ç³»ç»Ÿä¸€æ ·ï¼Œæ•°æ®é‡‡é›†+å‰ç«¯ç»˜å›¾ï¼Œè¿™ä¸ªå›¾ä¹Ÿæ˜¯æ ¹æ®æŸäº›æ•°æ®ç»˜åˆ¶è€Œæˆçš„ï¼Œç»˜å›¾å·¥å…·æœ¬ç¯‡æ–‡ç« é‡‡ç”¨FlameGraphï¼Œè€Œè´Ÿè´£æ”¶é›†è¿™äº›æ•°æ®çš„å·¥å…·ï¼Œæœ¬ç¯‡é‡‡ç”¨async-profilerï¼Œè¿™ä¸ªå·¥å…·ä¼šåœ¨ç¨‹åºè¿è¡ŒæœŸé—´å‘jvmå‘é€ä¿¡å·é‡‡é›†å…¶è¿è¡ŒæœŸæ•°æ®ï¼ˆç®€å•æ¥è¯´å°±æ˜¯é€šè¿‡è¯¥å·¥å…·å¯ä»¥æ‰¾å‡ºç¨‹åºä¸­å ç”¨CPUèµ„æºæ—¶é—´æœ€é•¿çš„ä»£ç å—ï¼Œè¿™é‡Œasync-profilerçš„å®ç°ä½¿ç”¨äº†jvmtiï¼Œæˆ³è¿™é‡Œç®€å•äº†è§£ä¸€ä¸‹ï¼‰ï¼Œç„¶åç”Ÿæˆç›¸åº”çš„æ•°æ®æ ¼å¼æ–‡ä»¶ï¼Œè€ŒFlameGraphåˆ™è´Ÿè´£è¯»å–å’Œè§£ææ•°æ®æ–‡ä»¶ç”Ÿæˆå¯¹åº”çš„ç«ç„°å›¾ï¼ˆsvgæ–‡ä»¶ï¼‰ã€‚ ä¸‰ã€ä½¿ç”¨&amp;å®‰è£…ğŸ”¥3.1ï¼šç¯å¢ƒæ­å»ºç¡®è®¤ä½ çš„æœºå™¨å·²ç»å®‰è£…äº†gitã€jdkã€perlã€c++ç¼–è¯‘å™¨ï¼Œéƒ¨åˆ†å¯å‚è€ƒï¼šå®‰è£…æ‚è®° ğŸ”¥3.2ï¼šcloneç›¸å…³é¡¹ç›®ä¸‹è½½ä¸‹æ¥æ‰€éœ€è¦çš„ä¸¤ä¸ªé¡¹ç›®ï¼ˆè¿™é‡Œå»ºè®®æ”¾åˆ°dataç›®å½•ä¸‹ï¼‰ï¼š 12git clone https://github.com/jvm-profiling-tools/async-profilergit clone https://github.com/brendangregg/FlameGraph ğŸ”¥3.3ï¼šç¼–è¯‘ä¸‹è½½å¥½ä»¥åï¼Œéœ€è¦æ‰“å¼€async-profileræ–‡ä»¶ï¼Œè¾“å…¥makeæŒ‡ä»¤è¿›è¡Œç¼–è¯‘ï¼š 12cd async-profilermake ğŸ”¥3.4ï¼šç¼–å†™æµ‹è¯•ç¨‹åºç¼–è¯‘å®Œæˆåï¼Œæˆ‘ä»¬æ¥å†™ä¸€ä¸ªç®€å•çš„javaç¨‹åºï¼š 123456789101112131415161718192021222324public class Test { public static void main(String[] args) throws Exception { Test test = new Test(); while (true) { test.func1(); test.func2(); test.func3(); } } public void func1() throws Exception { //è°ƒç”¨ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼Œéœ€è¦100ms Thread.sleep(100L); } public void func2() throws Exception { //è°ƒç”¨ç¬¬äºŒä¸ªæ–¹æ³•ï¼Œéœ€è¦500ms Thread.sleep(500L); } public void func3() throws Exception { //è°ƒç”¨ç¬¬ä¸‰ä¸ªæ–¹æ³•ï¼Œéœ€è¦1500ms Thread.sleep(1500L); }} ä»£ç å—1 éå¸¸ç®€å•çš„ä¸€ä¸ªjavaç±»ï¼Œmainæ–¹æ³•é‡Œæ‰€åšçš„äº‹æƒ…ä¹Ÿå¾ˆç®€å•ï¼Œç°åœ¨æŠŠè¿™ä¸ªæ–‡ä»¶æåˆ°dataç›®å½•ä¸‹ï¼Œjavacå‘½ä»¤ç¼–è¯‘ï¼Œjavaå‘½ä»¤å¯åŠ¨ã€‚ ç„¶åæ‰¾åˆ°è¿™ä¸ªjavaç¨‹åºçš„è¿›ç¨‹idï¼š 123ps -ef | grep javaroot 30937 17605 0 19:12 pts/0 00:00:00 java Testroot 30961 23135 0 19:12 pts/1 00:00:00 /bin/grep --color=auto java å¯ä»¥ç¡®è®¤æ­¤æ—¶Testç±»è¿è¡Œæ—¶çš„javaè¿›ç¨‹pid = 30937ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨jpså‘½ä»¤ç›´æ¥æŸ¥çœ‹javaè¿›ç¨‹ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚ ğŸ”¥3.5ï¼šç”Ÿæˆç«ç„°å›¾æ•°æ®okï¼Œä¸Šè¿°æ­¥éª¤å®Œæˆåï¼Œç°åœ¨è¿›å…¥async-profileré‚£ä¸ªé¡¹ç›®çš„ç›®å½•ä¸‹ï¼Œç„¶åè¾“å…¥å¦‚ä¸‹æŒ‡ä»¤ï¼š 1./profiler.sh -d 60 -o collapsed -f /tmp/test_01.txt ${pid} ä¸Šé¢çš„-dè¡¨ç¤ºçš„æ˜¯æŒç»­æ—¶é•¿ï¼Œåé¢60ä»£è¡¨æŒç»­é‡‡é›†æ—¶é—´60sï¼Œ-oè¡¨ç¤ºçš„æ˜¯é‡‡é›†è§„èŒƒï¼Œè¿™é‡Œç”¨çš„æ˜¯collapsedï¼Œ-fåé¢çš„è·¯å¾„ï¼Œè¡¨ç¤ºçš„æ˜¯æ•°æ®é‡‡é›†åç”Ÿæˆçš„æ•°æ®å­˜æ”¾çš„æ–‡ä»¶è·¯å¾„ï¼ˆè¿™é‡Œæ”¾åœ¨äº†/tmp/test_01.txtï¼‰ï¼Œ${pid}è¡¨ç¤ºçš„æ˜¯é‡‡é›†ç›®æ ‡è¿›ç¨‹çš„pidï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„30937 å›è½¦è¿è¡Œï¼Œè¿è¡ŒæœŸé—´é˜»å¡ï¼ŒçŸ¥é“çº¦å®šæ—¶é—´å®Œæˆã€‚è¿è¡Œå®Œæˆåï¼Œç°åœ¨å»tmpä¸‹çœ‹çœ‹æœ‰æ²¡æœ‰å¯¹åº”æ–‡ä»¶ï¼š ğŸ”¥3.6ï¼šç”Ÿæˆsvgæ–‡ä»¶ä¸Šä¸€æ­¥äº§ç”Ÿçš„æ–‡ä»¶é‡Œçš„å†…å®¹ï¼Œè‚‰çœ¼æ˜¯å¾ˆéš¾çœ‹æ‡‚çš„ï¼Œæ‰€ä»¥ç°åœ¨FlameGraphçš„ä½œç”¨å°±ä½“ç°å‡ºæ¥äº†ï¼Œå®ƒå¯ä»¥è¯»å–è¯¥æ–‡ä»¶å¹¶ç”Ÿæˆç›´è§‚çš„ç«ç„°å›¾ï¼Œç°åœ¨è¿›å…¥è¯¥é¡¹ç›®ç›®å½•ä¸‹é¢ï¼Œæ‰§è¡Œå¦‚ä¸‹è¯­å¥ï¼š 1perl flamegraph.pl --colors=java /tmp/test_01.txt &gt; test_01.svg å› ä¸ºæ˜¯perlæ–‡ä»¶ï¼Œè¿™é‡Œä½¿ç”¨perlæŒ‡ä»¤è¿è¡Œè¯¥æ–‡ä»¶ï¼Œåé¢--colorsè¡¨ç¤ºç€è‰²é£æ ¼ï¼Œè¿™é‡Œæ˜¯javaï¼Œåé¢çš„æ˜¯æ•°æ®æ–‡ä»¶çš„è·¯å¾„ï¼Œè¿™é‡Œæ˜¯åˆšåˆšä¸Šé¢ç”Ÿæˆçš„é‚£ä¸ªæ–‡ä»¶/tmp/test_01.txtï¼Œæœ€åçš„test_01.svgå°±æ˜¯æœ€ç»ˆç”Ÿæˆçš„ç«ç„°å›¾æ–‡ä»¶å­˜æ”¾çš„è·¯å¾„å’Œæ–‡ä»¶å‘½åï¼Œè¿™é‡Œæ˜¯å‘½åä¸ºtest_01.svgå¹¶ä¿å­˜åœ¨å½“å‰è·¯å¾„ï¼Œè¿è¡Œåçœ‹åˆ°è¯¥æ–‡ä»¶å·²ç»å­˜åœ¨äºå½“å‰ç›®å½•ä¸‹ï¼š ğŸ”¥3.7ï¼šå±•ç¤ºç°åœ¨ä¸‹è½½ä¸‹æ¥è¯¥æ–‡ä»¶ï¼Œä½¿ç”¨æµè§ˆå™¨æ‰“å¼€ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š æœç„¶è¿˜æ˜¯çœ‹ä¸æ‡‚å•Š-_-|| åç»­ä¼šæ›´æ–°è¿™ä¸œè¥¿æ€ä¹ˆçœ‹å’Œåˆ†æï¼Œæˆ–è€…è¯´æˆ‘è¿™ç¯‡æ–‡ç« é‡Œçš„javaä¾‹å­å¯èƒ½å¹¶ä¸èƒ½å¾ˆå¥½çš„ä½“ç°å‡ºä»€ä¹ˆã€‚ ç»­æ›´ç»­æ›´ï¼Œå…¬å¸å†…éƒ¨ç«ç„°å›¾å·²ç»ä¸Šçº¿ï¼Œé€šè¿‡æ›´ä¸ºå¤æ‚çš„ä¸šåŠ¡åœºæ™¯ç”Ÿæˆçš„å›¾åè€Œçœ‹èµ·æ¥æ›´å®¹æ˜“ç†è§£ä¸€äº›ï¼Œå› ä¸ºä¸šåŠ¡ä»£ç çš„è°ƒç”¨ä¹Ÿä¼šæ‰“å°å‡ºæ¥ï¼Œä¸‹é¢è´´ä¸€ä¸‹å†…éƒ¨æŸä¸šåŠ¡ç³»ç»Ÿç«ç„°å›¾ï¼š è¿™å¼ å›¾æ˜¯åœ¨æŸä¸ªä¸šåŠ¡ç³»ç»Ÿè¿è¡Œæ—¶ï¼Œé‡‡æ ·60sç”Ÿæˆçš„ç«ç„°å›¾ï¼Œé€šè¿‡è¿™æ ·ä¸€å¼ å›¾å¯ä»¥çœ‹å‡ºï¼Œxè½´ä¸ºè°ƒç”¨é¡ºåºï¼Œyè½´ä¸ºæ ˆæ·±ï¼Œçº¿æ¡é¢œè‰²æ— å®é™…æ„ä¹‰ï¼ˆå¹¶ä¸æ˜¯è¶Šçº¢æ€§èƒ½è¶Šå·®ä¹‹ç±»çš„ï¼‰ï¼Œçº¿æ¡é•¿åº¦ä»£è¡¨CPUæ‰§è¡Œè¯¥æ–¹æ³•æ—¶æ‰€èŠ±è´¹çš„æ—¶é—´å æ¯”ï¼Œä¸€èˆ¬æ¥è¯´éœ€è¦å…³æ³¨çš„å°±æ˜¯æ ˆé¡¶ï¼Œä¸”å®½åº¦æ¯”è¾ƒå¤§çš„é‚£ä¸ªã€‚å› ä¸ºä¸€èˆ¬å¤„äºæ ˆé¡¶çš„ï¼Œè€Œä¸”å®½åº¦æ¯”è¾ƒå¤§çš„è°ƒç”¨æ ˆï¼Œè¯´æ˜å…¶å­˜åœ¨æ€§èƒ½é—®é¢˜ï¼Œè¿™æ ·åˆ†æçš„åŸå› å¦‚ä¸‹ï¼š æ ˆæ·±åº¦ä¸yè½´é«˜åº¦æˆæ­£æ¯”ï¼Œä¸€èˆ¬é€ æˆæ€§èƒ½é—®é¢˜çš„éƒ½åœ¨è°ƒç”¨æ ˆçš„æ ˆé¡¶ä½ç½®ï¼Œå› ä¸ºæ ˆé¡¶ä½ç½®çš„æ€§èƒ½é—®é¢˜ä¼šé—´æ¥æ‹–æ…¢æ•´ä¸ªè°ƒç”¨æ ˆï¼Œæ¯”å¦‚ä¸Šå›¾ä¸­æ¯ä¸ªæ ˆåº•çš„çº¿æ¡éƒ½å¾ˆé•¿ï¼Œè¿™æ˜¯å› ä¸ºè¶Šå¾€ä¸Šæ ˆè¶Šæ·±ï¼Œå¯¹ä¸‹å±‚çš„å½±å“å°±è¶Šå¤§ï¼Œå¯ä»¥ç®€å•æŠ½è±¡æˆæ–¹æ³•è°ƒç”¨ï¼šAè°ƒç”¨Bï¼ŒBè°ƒç”¨Cï¼ŒCæ…¢ä¼šé—´æ¥å¯¼è‡´Bæ…¢ï¼Œä»è€Œå¯¼è‡´Aæ…¢ï¼Œå½“ç„¶ç¬¦åˆè¿™ç§æƒ…å†µå°±é€‚åˆä¹‹å‰è¯´çš„çœ‹æ ˆé¡¶åˆ†æç“¶é¢ˆçš„æ–¹æ³•ï¼Œå¦‚æœAæœ¬èº«å°±æ…¢å‘¢ï¼Ÿé€šè¿‡ç«ç„°å›¾ä¹Ÿæ˜¯å¯ä»¥çœ‹å‡ºæ¥çš„ï¼Œæ¯”å¦‚æ ˆåº•çš„çº¿æ¡å®½åº¦å¾ˆå®½ï¼Œä½†æ˜¯å»ºç«‹åœ¨è¯¥æ ˆåº•çš„è°ƒç”¨é“¾ä¸Šï¼Œçº¿æ¡éƒ½å¾ˆçª„ï¼Œç«ç„°å›¾å‘ˆç°â”»å‹ï¼Œé‚£ä¹ˆå°±å¯ä»¥è®¤å®šï¼Œæ ˆåº•æ–¹æ³•å­˜åœ¨æ€§èƒ½é—®é¢˜ï¼Œä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯ä»æ ˆé¡¶çœ‹èµ·ï¼Œè§†æƒ…å†µè€Œå®š~","link":"/2019/03/22/java%E6%80%A7%E8%83%BD%E7%81%AB%E7%84%B0%E5%9B%BE%E7%9A%84%E7%94%9F%E6%88%90/"},{"title":"ã€æ‚è®°ã€‘linuxä¸‹å„ç§è½¯ä»¶å®‰è£…æ–¹æ³•ï¼ˆæŒç»­è®°å½•ï¼‰","text":"1.å®‰è£…jdkç½‘ä¸Šä¸€å †è¯´å…ˆä»windowsä¸‹å‹ç¼©åŒ…ï¼Œç„¶åé€šè¿‡å…±äº«æ–‡ä»¶å¤¹copyåˆ°linuxç³»ç»Ÿé‡Œï¼Œç„¶åè§£å‹å®‰è£…ï¼Œemmmmm é¦–å…ˆè¿›å…¥usræ–‡ä»¶å¤¹ï¼Œæ–°å»ºjavaæ–‡ä»¶å¤¹ï¼š 1mkdir java ç›´æ¥é€šè¿‡wgetå‘½ä»¤ä¸‹è½½å‹ç¼©åŒ…ï¼ˆå¦‚æœæ‰¾ä¸åˆ°wgetå·¥å…·ï¼Œå¯ä»¥é€šè¿‡apt-get install wgetå®‰è£…æ­¤å·¥å…·ï¼‰ï¼š 1wget --no-cookies --no-check-certificate --header \"Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie\" \"http://download.oracle.com/otn-pub/java/jdk/8u141-b15/336fa29ff2bb4ef291e347e091f7f4a7/jdk-8u141-linux-x64.tar.gz\" åé¢urléœ€è¦æŒ‰ç…§è‡ªå·±éœ€è¦è°ƒæ•´ã€‚ è¿›å…¥æ‰€åœ¨æ–‡ä»¶å¤¹ï¼ˆè¿™é‡ŒæŒ‡javaæ–‡ä»¶å¤¹ï¼‰è§£å‹ï¼š 1tar -zxvf jdk-8u141-linux-x64.tar.gz è§£å‹å¥½äº†å¦‚ä¸‹ï¼š 12root@xxx-xxx-xxx-01:/usr/java # ls -a. .. jdk1.8.0_141 jdk-8u141-linux-x64.tar.gz æ¥ç€é…ç½®ç¯å¢ƒå˜é‡ï¼Œè¾“å…¥æŒ‡ä»¤ï¼š 1vim /etc/profile ç„¶åç¼–è¾‘ï¼š 1234export JAVA_HOME=/usr/java/jdk1.8.0_141 export PATH=$JAVA_HOME/bin:$PATHexport CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jarexport JRE_HOME=$JAVA_HOME/jre ç„¶åè®©å…¶ç”Ÿæ•ˆï¼š 1source /etc/profile æœ€åè¿›è¡Œæµ‹è¯•çœ‹çœ‹æ˜¯å¦ç”Ÿæ•ˆäº†ï¼š 1234root@xxx-xxx1-xxx-01:~# java -versionjava version \"1.8.0_141\"Java(TM) SE Runtime Environment (build 1.8.0_141-b15)Java HotSpot(TM) 64-Bit Server VM (build 25.141-b15, mixed mode) å‡ºç°ç‰ˆæœ¬å·ï¼Œè§†ä¸ºå®‰è£…é…ç½®æˆåŠŸã€‚ 2.å®‰è£…Perl1234567wget http://www.cpan.org/src/5.0/perl-5.26.1.tar.gztar zxvf perl-5.26.1.tar.gzcd perl-5.26.1./Configure -demakemake testmake install wgetåé¢çš„è·¯å¾„å¯ä»¥æŒ‰éœ€æ›´æ”¹ã€‚å®‰è£…è¿‡ç¨‹æ¯”è¾ƒè€—æ—¶é—´ï¼Œå®‰è£…å®Œæˆåå¯é€šè¿‡perl -versionæŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸã€‚ 3.tcpdumpæŠ“åŒ…å·¥å…·12apt-get updateapt-get install tcpdump æŠ“åŒ…å·¥å…·tcpdumpå¯ä»¥æŠ“åˆ°å®¹å™¨å†…çš„ç½‘ç»œè¯·æ±‚ï¼Œå…·ä½“ç”¨æ³•å¦‚ä¸‹ï¼š 1tcpdump -i any -A -n port 80 | grep -C 50 'path' ä¸Šé¢æ˜¯æŠ“å–ç«¯å£ä¸º80çš„ç½‘ç»œäº¤äº’ï¼Œä¸”è¿‡æ»¤å‡ºåŒ…å«pathå…³é”®è¯çš„äº¤äº’ï¼Œå±•ç¤º50è¡Œã€‚ æ¯”å¦‚ä½ æƒ³æŠ“å–httpè¯·æ±‚ï¼ŒçŸ¥é“httpè¯·æ±‚ç«¯å£æ˜¯80ï¼Œè¿˜çŸ¥é“httpè¯·æ±‚å…·ä½“çš„pathï¼Œé‚£ä¹ˆå°±å¯ä»¥æŠ“å–ä¸€ä¸ªæ¥å£çš„è¯·æ±‚ä¿¡æ¯ï¼ˆåŒ…å«è¯·æ±‚æŠ¥æ–‡ã€å“åº”æŠ¥æ–‡ï¼‰ï¼Œredisç­‰åŒç†ï¼ŒçŸ¥é“ç«¯å£ï¼ŒçŸ¥é“å…³é”®è¯ï¼Œå°±å¯ä»¥æŠ“åˆ°äº¤äº’ã€‚ 4.C++ç¼–è¯‘å™¨1apt-get install g++ ä¸€èˆ¬ç”¨äºç¼–è¯‘c++ç¨‹åºï¼Œç¼ºå°‘è¿™ä¸ªç¼–è¯‘å™¨è¿›è¡Œmakeç¼–è¯‘c++ä»£ç æ—¶ï¼Œä¼šæŠ¥g++: not foundçš„é”™è¯¯ã€‚ 5.zookeeperçš„å®‰è£…&amp;å¯åŠ¨å…ˆä¸‹è½½zookeeperçš„å®‰è£…åŒ…ï¼Œç„¶åè§£å‹ï¼š 1tar -zxvf zookeeper-3.4.6.tar.gz è§£å‹åè¿›å…¥è¯¥åŒ…è·¯å¾„ï¼Œç„¶åè¿›å…¥confç›®å½•ä¿®æ”¹zoo_sample.cfgçš„åå­—ä¸ºzoo.cfgï¼š 1mv zoo_sample.cfg zoo.cfg ç„¶åæ‰“å¼€è¯¥æ–‡ä»¶ï¼š 12345678910111213141516171819202122232425262728# The number of milliseconds of each ticktickTime=2000# The number of ticks that the initial # synchronization phase can takeinitLimit=10# The number of ticks that can pass between # sending a request and getting an acknowledgementsyncLimit=5# the directory where the snapshot is stored.# do not use /tmp for storage, /tmp here is just # example sakes.dataDir=/tmp/zookeeper# the port at which the clients will connectclientPort=2181# the maximum number of client connections.# increase this if you need to handle more clients#maxClientCnxns=60## Be sure to read the maintenance section of the # administrator guide before turning on autopurge.## http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance## The number of snapshots to retain in dataDir#autopurge.snapRetainCount=3# Purge task interval in hours# Set to \"0\" to disable auto purge feature#autopurge.purgeInterval=1 é‡è¦è§£é‡Šï¼š tickTimeï¼šè¿™ä¸ªæ—¶é—´æ˜¯ä½œä¸º ZookeeperæœåŠ¡å™¨ä¹‹é—´æˆ–å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ç»´æŒå¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ª tickTimeæ—¶é—´å°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³ã€‚dataDirï¼šé¡¾åæ€ä¹‰å°±æ˜¯Zookeeperä¿å­˜æ•°æ®çš„ç›®å½•ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒZookeeperçš„æ—¥å¿—æ–‡ä»¶æ˜¯åœ¨binç›®å½•ä¸‹ï¼Œæœ‰ä¸€ä¸ªzookeeper.outæ–‡ä»¶ã€‚clientPortï¼šè¿™ä¸ªç«¯å£å°±æ˜¯å®¢æˆ·ç«¯è¿æ¥ ZookeeperæœåŠ¡å™¨çš„ç«¯å£ï¼ŒZookeeperä¼šç›‘å¬è¿™ä¸ªç«¯å£ï¼Œæ¥å—å®¢æˆ·ç«¯çš„è®¿é—®è¯·æ±‚ã€‚ä¼ªé›†ç¾¤æ¨¡å¼ä¸‹ï¼Œè¿™ä¸ªç«¯å£éœ€è¦é…ç½®æˆä¸åŒçš„ã€‚å¦‚æœæ˜¯å¤šå°è™šæ‹Ÿæœºæˆ–è€…æœåŠ¡å™¨ä¸‹ï¼Œåˆ™æ— éœ€æ›´æ”¹ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥æ ‡è®°ä¸‹è¯¥zkèŠ‚ç‚¹çš„idï¼ˆèŠ‚ç‚¹å·ï¼‰ï¼Œåœ¨dataDiræ˜¾ç¤ºçš„è·¯å¾„ä¸‹æ–°å»ºmyidæ–‡ä»¶ï¼Œå†™ä¸Šä¸€ä¸ªæ•°å­—ï¼ˆ1~255é—´ï¼‰ï¼Œè¿™é‡Œå†™çš„æ˜¯1ï¼š 123vim myid1:wq ç„¶åç»§ç»­å›åˆ°confç›®å½•ä¸‹ï¼Œç¼–è¾‘zoo.cfgï¼Œåœ¨ä¸‹é¢æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š 1server.1=xx.xx.xxx.xx:8881:7771 å‰é¢çš„server.1é‡Œçš„1å°±æ˜¯ä¹‹å‰åœ¨myidé‡Œå†™çš„idå·ï¼ŒzkèŠ‚ç‚¹å”¯ä¸€æ ‡è¯†ï¼Œåé¢çš„xx.xx.xxx.xxæ ‡è¯†æœ¬æœºipï¼› å†å¾€åçš„8881è¡¨ç¤ºçš„æ˜¯è¿™ä¸ªæœåŠ¡å™¨ä¸é›†ç¾¤ä¸­çš„ Leader æœåŠ¡å™¨äº¤æ¢ä¿¡æ¯çš„ç«¯å£ï¼ˆè‡ªå®šä¹‰ï¼‰ï¼› å†åé¢çš„7771è¡¨ç¤ºçš„æ˜¯ä¸‡ä¸€é›†ç¾¤ä¸­çš„LeaderæœåŠ¡å™¨æŒ‚äº†ï¼Œéœ€è¦ä¸€ä¸ªç«¯å£æ¥é‡æ–°è¿›è¡Œé€‰ä¸¾ï¼Œé€‰å‡ºä¸€ä¸ªæ–°çš„ Leaderï¼Œè€Œè¿™ä¸ªç«¯å£å°±æ˜¯ç”¨æ¥æ‰§è¡Œé€‰ä¸¾æ—¶æœåŠ¡å™¨ç›¸äº’é€šä¿¡çš„ç«¯å£ã€‚ æ¥ä¸‹æ¥è¿”å›åˆ°zkçš„binç›®å½•ï¼Œè¿›è¡Œå¯åŠ¨è¿™ä¸ªzkæœåŠ¡ï¼š 1./zkServer.sh start çœ‹åˆ°ä¸‹é¢çš„æ‰“å°è¯´æ˜å¯åŠ¨æˆåŠŸï¼š 123JMX enabled by defaultUsing config: /usr/zk/zookeeper-3.4.6/bin/../conf/zoo.cfgStarting zookeeper ... STARTED é›†ç¾¤æ­å»ºæ¯”è¾ƒç®€å•ï¼Œç›´æ¥æ”¹ä¸‹é…ç½®ï¼ŒæŠŠzoo.cfgä¸‹é¢çš„ip+portå¾€ä¸‹é¢åŠ èŠ‚ç‚¹å°±è¡Œäº†ï¼Œä¾‹å­ï¼š 123server.x=yyy.yy.yyy.yy:8881:7771server.x=yyy.yy.yyy.yy:8881:7771server.x=yyy.yy.yyy.yy:8881:7771 æ³¨æ„ï¼Œé›†ç¾¤é‡Œçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½è¦åŠ ä¸Šä¸Šé¢çš„é…ç½®ï¼Œä¸Šé¢é…ç½®é‡Œçš„xå°±æ˜¯æŒ‡ä¹‹å‰å•æœºçš„myidæ–‡ä»¶æ”¾çš„idå·ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œè¿™äº›idæ˜¯ä¸å…è®¸æœ‰é‡å¤çš„ï¼Œåé¢çš„yy.yyæŒ‡çš„æ˜¯èŠ‚ç‚¹ipåœ°å€ï¼Œå†å¾€åçš„8881å’Œ7771ä¹‹å‰æœ‰è§£é‡Šè¿‡ï¼Œä¸Šç¿»æŸ¥çœ‹ã€‚ è¿™æ ·é…ç½®åï¼Œå°†æ‰€æœ‰èŠ‚ç‚¹é‡å¯ä¸€éå³å¯ï¼ŒæœŸé—´ä¼šè¿›è¡ŒLeaderçš„é€‰ä¸¾ï¼Œå®Œæˆåå¯ä»¥è¿è¡Œbinç›®å½•ä¸‹çš„zkServer.sh statusæŸ¥çœ‹å…¶èº«ä»½ã€‚","link":"/2019/03/22/%E3%80%90%E6%9D%82%E8%AE%B0%E3%80%91linux%E4%B8%8B%E5%90%84%E7%A7%8D%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95%EF%BC%88%E6%8C%81%E7%BB%AD%E8%AE%B0%E5%BD%95%EF%BC%89/"},{"title":"Java NIOå­¦ä¹ ä¸è®°å½•ï¼ˆå…­ï¼‰ï¼š NIOçº¿ç¨‹æ¨¡å‹","text":"ä¸Šä¸€ç¯‡è¯´çš„æ˜¯åŸºäºæ“ä½œç³»ç»Ÿçš„IOå¤„ç†æ¨¡å‹ï¼Œé‚£ä¹ˆè¿™ä¸€ç¯‡æ¥ä»‹ç»ä¸‹æœåŠ¡å™¨ç«¯åŸºäºIOæ¨¡å‹å’Œè‡ªèº«çº¿ç¨‹çš„å¤„ç†æ–¹å¼ã€‚ ä¸€ã€åŸºäºBIOä¸‹çš„çº¿ç¨‹å¤„ç†æ¨¡å¼è¿™ç§å¤„ç†æ¨¡å‹æ˜¯åŸºäºé˜»å¡IOè¿›è¡Œçš„ï¼Œä¸Šä¸€ç¯‡è®²è¿‡ï¼Œé˜»å¡IOä¼šé˜»å¡æ¯ä¸€ä¸ªIOæ“ä½œï¼Œç›´åˆ°äº‹ä»¶å°±ç»ªï¼Œä¸‹é¢æ¥çœ‹ä¸‹é˜»å¡IOä¸‹çš„æœåŠ¡ç«¯çº¿ç¨‹æ¨¡å‹ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¯¥çº¿ç¨‹æ¨¡å‹åŸºäºé˜»å¡IOæ¨¡å‹å®ç°ï¼Œé’ˆå¯¹æ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦æŠ½å‡ºæ¥ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†è¯»å…¥æ•°æ®ã€ä¸šåŠ¡å¤„ç†æ•°æ®ã€è¿”å›å“åº”ç»“æœç»™å®¢æˆ·ç«¯ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­è¯»ã€å†™æ“ä½œå‡ä¼šé˜»å¡ï¼Œä¸”è·Ÿä¸šåŠ¡å¤„ç†ä¸²è¡Œæ‰§è¡Œï¼Œè¯¥æ¨¡å¼ä¸‹ï¼Œå¹¶å‘é‡è¿‡å¤§æ—¶ä¼šå¤§é‡åˆ›å»ºçº¿ç¨‹ï¼Œå‘ç”Ÿçš„å¤§é‡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä»è€Œå¯¼è‡´CPUèµ„æºå ç”¨è¿‡å¤§ï¼Œå½“è¿æ¥å»ºç«‹åï¼Œè‹¥å½“å‰çº¿ç¨‹æš‚æ— å¯è¯»æ•°æ®ï¼Œåˆ™çº¿ç¨‹ä¼šä¸€ç›´é˜»å¡åœ¨è¯»æ“ä½œä¸Šï¼Œé€ æˆçº¿ç¨‹èµ„æºæµªè´¹ï¼Œå³ä¾¿ä½¿ç”¨çº¿ç¨‹æ± è¿›è¡Œä¼˜åŒ–ï¼Œè™½ç„¶é¿å…äº†å¤§é‡åˆ›å»ºçº¿ç¨‹ï¼Œä½†ä¹Ÿä¼šå‡ºç°çº¿ç¨‹èµ„æºæµªè´¹çš„é—®é¢˜ï¼Œé«˜å¹¶å‘ä¸‹å¯èƒ½ä¼šé€ æˆæ’é˜Ÿã€å“åº”ä¸åŠæ—¶çš„é—®é¢˜ã€‚ å…·ä½“BIOæœåŠ¡å™¨çš„å®ç°å‚è€ƒï¼šSocketChannelä¸BIOæœåŠ¡å™¨ äºŒã€åŸºäºNIOä¸‹çš„Reactorçº¿ç¨‹æ¨¡å‹åˆ©ç”¨æ“ä½œç³»ç»ŸNIOçš„APIå®ç°ï¼ŒJavaå¯¹å…¶APIçš„è°ƒç”¨è¿›è¡Œäº†å°è£…ï¼ˆselectç­‰ï¼‰ï¼Œè¿™é‡Œå…ˆä¸æ¢è®¨æ€ä¹ˆåˆ©ç”¨javaçš„apiå»è°ƒç”¨ï¼Œå…ˆæ¥çœ‹çœ‹å®ƒçš„åŸºæœ¬æµç¨‹æ˜¯æ€æ ·çš„ï¼ŒReactoræ¨¡å¼ä¸‹çš„çº¿ç¨‹æ¨¡å‹åˆä¼šæ ¹æ®çº¿ç¨‹æ•°é‡ã€çº¿ç¨‹æ± æ•°é‡çš„ä¸åŒï¼Œç»†åˆ†äº†ä¸‰ç§çº¿ç¨‹æ¨¡å‹ã€‚ 2.1ï¼šå•Reactorå•çº¿ç¨‹æ¨¡å‹è¿™æ˜¯æœ€ç®€å•çš„Reactoræ¨¡å‹ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸­çš„äº‹ä»¶å¤„ç†å…¨éƒ¨å‘ç”Ÿåœ¨ä¸€ä¸ªçº¿ç¨‹é‡Œï¼š ä¸Šå›¾ç¤ºæ„å°±æ˜¯ä¸ªç®€å•çš„NIOå•Reactorå•çº¿ç¨‹å¤„ç†æ¨¡å‹ï¼Œæµç¨‹å¦‚ä¸‹ï¼š Reactorå¯¹è±¡é€šè¿‡selectç›‘å¬å®¢æˆ·ç«¯çš„è¯·æ±‚äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶æ¶ˆæ¯åé€šè¿‡dispatchè¿›è¡Œä»»åŠ¡åˆ†å‘ã€‚ å¦‚æœæ˜¯å»ºè¿è¯·æ±‚ï¼Œåˆ™äº¤ç”±Acceptorå¯¹è±¡å¤„ç†è¿æ¥è¯·æ±‚ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªHandlerå¯¹è±¡ç»§ç»­å®Œæˆåç»­å¤„ç† è‹¥ä¸æ˜¯å»ºè¿è¯·æ±‚ï¼Œåˆ™dispatchä¼šè°ƒç”¨å¯¹åº”è¿æ¥çš„Handlerè¿›è¡Œå¤„ç†ï¼ŒHandleè´Ÿè´£å®Œæˆè¿æ¥æˆåŠŸåçš„åç»­å¤„ç†ï¼ˆè¯»æ“ä½œã€å†™æ“ä½œã€ä¸šåŠ¡å¤„ç†ç­‰ï¼‰ æ­¤æ¨¡å‹å¾ˆç®€å•ï¼Œæ˜“äºç†è§£ï¼Œä½†æ˜¯å­˜åœ¨ä¸€å®šçš„é—®é¢˜ï¼Œæ¯”å¦‚å•çº¿å¤„ç†ç¨‹æ¨¡å‹ä¸‹ï¼Œæ— æ³•å‘æŒ¥å¤šæ ¸CPUçš„æ€§èƒ½ï¼Œå¦‚æœHandlerä¸Šçš„ä¸šåŠ¡å¤„ç†å¾ˆæ…¢ï¼Œåˆ™æ„å‘³ç€æ•´ä¸ªç¨‹åºæ— æ³•å¤„ç†å…¶ä»–è¿æ¥äº‹ä»¶ï¼Œé€ æˆæ€§èƒ½é—®é¢˜ã€‚é€‚ç”¨äºä¸šåŠ¡å¤„ç†å¿«é€Ÿã€å®¢æˆ·ç«¯è¿æ¥è¾ƒå°‘çš„æƒ…å†µã€‚ 2.2ï¼šå•Reactorå¤šçº¿ç¨‹æ¨¡å‹ç›¸è¾ƒäºä¸Šé¢çš„æ¨¡å‹ï¼Œå¯¹ä¸šåŠ¡å¤„ç†æ¨¡å—è¿›è¡Œäº†å¼‚æ­¥å¤„ç†ï¼Œæµç¨‹å›¾å¦‚ä¸‹ï¼š ä¸Šå›¾ç¤ºæ„å±äºå•Reactorå¤šçº¿ç¨‹å¤„ç†æ¨¡å‹ï¼Œæµç¨‹å¦‚ä¸‹ï¼š Reactorå¯¹è±¡é€šè¿‡selectç›‘å¬å®¢æˆ·ç«¯çš„è¯·æ±‚äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶æ¶ˆæ¯åé€šè¿‡dispatchè¿›è¡Œä»»åŠ¡åˆ†å‘ã€‚ å¦‚æœæ˜¯å»ºè¿è¯·æ±‚ï¼Œåˆ™äº¤ç”±Acceptorå¯¹è±¡å¤„ç†è¿æ¥è¯·æ±‚ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªHandlerå¯¹è±¡ç»§ç»­å®Œæˆåç»­å¤„ç† è‹¥ä¸æ˜¯å»ºè¿è¯·æ±‚ï¼Œåˆ™dispatchä¼šè°ƒç”¨å¯¹åº”è¿æ¥çš„Handlerè¿›è¡Œå¤„ç†ï¼ŒHandleè´Ÿè´£å®Œæˆè¿æ¥æˆåŠŸåçš„è¯»æ“ä½œï¼Œè¯»å‡ºæ¥æ•°æ®åçš„ä¸šåŠ¡å¤„ç†éƒ¨åˆ†äº¤ç”±çº¿ç¨‹æ± å¼‚æ­¥å¤„ç†ï¼Œä¸šåŠ¡å¤„ç†å®Œæˆåå‘é€ç»™Handlerå¤„ç†å®Œæˆçš„æ¶ˆæ¯ï¼Œç„¶åå†ç”±Handlerå‘é€å¤„ç†å“åº”ä¿¡æ¯ç»™å¯¹åº”çš„Clientã€‚ æœ¬æ¨¡å‹å……åˆ†åˆ©ç”¨äº†å¤šæ ¸CPUçš„å¤„ç†èƒ½åŠ›ï¼Œé™ä½äº†ç”±ä¸šåŠ¡å¤„ç†å¼•èµ·çš„æ€§èƒ½é—®é¢˜ï¼ŒReactorçº¿ç¨‹ä»…è´Ÿè´£æ¥æ”¶è¿æ¥ã€è¯»å†™æ“ä½œã€‚ä½†æ˜¯Reactoré™¤äº†è´Ÿè´£è¿æ¥å¤„ç†å¤–ä»ç„¶è´Ÿè´£è¯»å†™æ“ä½œï¼Œå¤§é‡çš„è¯·æ±‚ä¸‹ä»ç„¶å¯èƒ½ä»ç„¶å­˜åœ¨æ€§èƒ½é—®é¢˜ã€‚ 2.3ï¼šä¸»ä»Reactorå¤šçº¿ç¨‹æ¨¡å‹è¿™ä¸ªæ¨¡å‹ä¸­å°†ä¼šç‹¬ç«‹å‡ºå¦ä¸€ä¸ªReactorå¯¹è±¡æ¥å¤„ç†éè¿æ¥å¤„ç†çš„å…¶ä»–å¤„ç†ï¼Œå‘½åä¸ºä»Reactorï¼ˆSubReactorï¼‰ï¼Œæµç¨‹å›¾å¦‚ä¸‹ï¼š ä¸Šå›¾ç¤ºæ„å±äºä¸»ä»Reactorå¤šçº¿ç¨‹å¤„ç†æ¨¡å‹ï¼Œæµç¨‹å¦‚ä¸‹ï¼š ä¸»Reactorå¯¹è±¡ï¼ˆMainReactorï¼‰é€šè¿‡selectç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥äº‹ä»¶ï¼Œæ”¶åˆ°è¿æ¥äº‹ä»¶åäº¤ç”±Acceptorå¤„ç†ã€‚ Acceptorå¤„ç†å®Œæˆåï¼ŒMainReactorå°†æ­¤è¿æ¥åˆ†é…ç»™SubReactorå¤„ç†ï¼ŒSubReactorå°†æ­¤è¿æ¥åŠ å…¥è¿æ¥é˜Ÿåˆ—è¿›è¡Œäº‹ä»¶ç›‘å¬å¹¶å»ºç«‹Handlerè¿›è¡Œåç»­çš„å„ç§æ“ä½œï¼ŒåŒä¸Šé¢çš„æ¨¡å‹ä¸€è‡´ï¼ŒSubReactorä¼šç›‘å¬æ–°çš„äº‹ä»¶ï¼Œå¦‚æœæœ‰æ–°çš„äº‹ä»¶å‘ç”Ÿï¼Œåˆ™è°ƒç”¨Handlerè¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚ Handlerè¯»å‡ºæ¥æ•°æ®åçš„ä¸šåŠ¡å¤„ç†éƒ¨åˆ†äº¤ç”±çº¿ç¨‹æ± å¼‚æ­¥å¤„ç†ï¼Œä¸šåŠ¡å¤„ç†å®Œæˆåå‘é€ç»™Handlerå¤„ç†å®Œæˆçš„æ¶ˆæ¯ï¼Œç„¶åå†ç”±Handlerå‘é€å¤„ç†å“åº”ä¿¡æ¯ç»™å¯¹åº”çš„Clientã€‚ è¯¥æ¨¡å‹å­˜åœ¨ä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«å¤„ç†Reactoräº‹ä»¶ï¼Œä¸»çº¿ç¨‹åªè´Ÿè´£å¤„ç†è¿æ¥äº‹ä»¶ï¼Œå­çº¿ç¨‹åªè´Ÿè´£å¤„ç†è¯»å†™äº‹ä»¶ï¼Œè¿™æ ·ä¸»çº¿ç¨‹å¯ä»¥å¤„ç†æ›´å¤šçš„è¿æ¥ï¼Œè€Œä¸ç”¨å…³å¿ƒå­çº¿ç¨‹é‡Œçš„è¯»å†™å¤„ç†æ˜¯å¦ä¼šå½±å“åˆ°è‡ªå·±ã€‚ç›®å‰è¿™ç§æ¨¡å‹è¢«å¹¿æ³›ä½¿ç”¨åœ¨å„ç§é¡¹ç›®ä¸­ï¼ˆå¦‚Nettyã€Memcachedç­‰ï¼‰ã€‚ ä»¥ä¸Šçš„çº¿ç¨‹æ¨¡å‹éƒ½æ˜¯åŸºäºåŒæ­¥IOï¼Œå¼‚æ­¥IOè¿™é‡Œä¸ä½œè¯´æ˜ï¼Œç›®å‰å¤§éƒ¨åˆ†é¡¹ç›®éƒ½é‡‡ç”¨NIOçš„APIè¿›è¡Œå®ç°ï¼ˆè¯¥æ¨¡å¼ä¸‹åˆåˆ†æˆäº†ä¸Šè¿°3ç§çº¿ç¨‹å¤„ç†æ¨¡å‹ï¼‰ã€‚ ä¸‹ä¸€ç¯‡å°†ä¼šé’ˆå¯¹NIOä¸‹çš„ä¸‰ç§çº¿ç¨‹å¤„ç†æ¨¡å‹ï¼Œä»‹ç»ä¸‹Selectorï¼Œä»¥åŠåˆ©ç”¨Selectoræ¥å†™ä¸€ä¸‹å…·ä½“çš„å®ç°ä»£ç ã€‚","link":"/2019/03/20/Java%20NIO%E5%AD%A6%E4%B9%A0%E4%B8%8E%E8%AE%B0%E5%BD%95%EF%BC%88%E5%85%AD%EF%BC%89%EF%BC%9A%20NIO%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/"},{"title":"Java NIOå­¦ä¹ ä¸è®°å½•ï¼ˆäº”ï¼‰ï¼š æ“ä½œç³»ç»Ÿçš„I/Oæ¨¡å‹","text":"åœ¨å¼€å§‹ä»‹ç»NIO Reactoræ¨¡å¼ä¹‹å‰ï¼Œå…ˆæ¥ä»‹ç»ä¸‹æ“ä½œç³»ç»Ÿçš„äº”ç§I/Oæ¨¡å‹ï¼Œäº†è§£äº†è¿™äº›æ¨¡å‹ï¼Œå¯¹ç†è§£java nioä¼šæœ‰ä¸å°çš„å¸®åŠ©ã€‚ å‰è¨€ï¼šä¸€æ¬¡ç½‘ç»œè¯·æ±‚çš„æµç¨‹å…ˆæ¥çœ‹ä¸‹ä¸€ä¸ªæœåŠ¡ç«¯å¤„ç†ä¸€æ¬¡ç½‘ç»œè¯·æ±‚çš„æµç¨‹å›¾ï¼š ä¸€ã€å›¾1è§£æ1.1ï¼šå†…æ ¸ç©ºé—´&amp;ç”¨æˆ·ç©ºé—´å†…æ ¸ç©ºé—´ï¼šæŒ‡æ“ä½œç³»ç»Ÿè¿è¡Œæ—¶ç”¨äºç¨‹åºè°ƒåº¦ã€è™šæ‹Ÿå†…å­˜çš„ä½¿ç”¨æˆ–è€…è¿æ¥ç¡¬ä»¶èµ„æºçš„ç¨‹åºé€»è¾‘ã€‚ ç”¨æˆ·ç©ºé—´ï¼šåº”ç”¨ç¨‹åºèƒ½å¤Ÿç”³è¯·ä½¿ç”¨çš„ç©ºé—´ã€‚ æ“ä½œç³»ç»Ÿé‡‡ç”¨è™šæ‹Ÿå­˜å‚¨å™¨ï¼Œæ“ä½œç³»ç»Ÿæ ¸å¿ƒæ˜¯å†…æ ¸ï¼ˆKernelï¼‰ï¼Œç‹¬ç«‹äºæ™®é€šåº”ç”¨ç¨‹åºï¼Œå®ƒæ—¢å¯ä»¥è®¿é—®å—ä¿æŠ¤çš„å†…å­˜ç©ºé—´ï¼Œåˆæœ‰è®¿é—®åº•å±‚ç¡¬ä»¶è®¾å¤‡çš„æ‰€æœ‰æƒé™ï¼Œä¸ºäº†ä¿è¯å†…æ ¸å®‰å…¨ï¼Œä½¿å¾—ç”¨æˆ·è¿›ç¨‹ä¸ç›´æ¥æ“ä½œå†…æ ¸ï¼Œå› æ­¤æ“ä½œç³»ç»Ÿå°†è™šæ‹Ÿå­˜å‚¨å™¨åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šå†…æ ¸ç©ºé—´&amp;ç”¨æˆ·ç©ºé—´ 1.2ï¼šç½‘ç»œè¯·æ±‚æµç¨‹æ ¹æ®å›¾1ï¼Œå®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªè¯·æ±‚åˆ°æœåŠ¡ç«¯ï¼Œè¯·æ±‚é¦–å…ˆåˆ°è¾¾çš„æ˜¯æœåŠ¡ç«¯ç½‘å¡ï¼ˆæ­¥éª¤1ï¼‰ï¼Œç„¶åå°†è¯·æ±‚æ•°æ®copyåˆ°å†…æ ¸ç©ºé—´çš„å†…æ ¸ç¼“å†²åŒºå†…ï¼ˆæ­¥éª¤2ï¼‰ï¼Œåˆ°è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬è¯´ä¸€ä¸ªæ•°æ®æŠ¥å·²ç»å‡†å¤‡å¥½äº†ã€‚ ç”¨æˆ·ç©ºé—´é‡Œçš„webæœåŠ¡è¿›ç¨‹ï¼ˆæˆ‘ä»¬çœŸæ­£çš„ä¸šåŠ¡ç¨‹åºï¼‰å‘èµ·è¯»å–å†…æ ¸ç¼“å†²åŒºé‡Œçš„æ•°æ®ï¼Œè‹¥å†…æ ¸ç¼“å†²åŒºå‡†å¤‡å¥½äº†æ•°æ®æŠ¥ï¼Œåˆ™ä¼šå°†æ•°æ®æŠ¥ç”±å†…æ ¸ç¼“å†²åŒºcopyåˆ°ç”¨æˆ·ç©ºé—´çš„webæœåŠ¡è¿›ç¨‹å†…ï¼ˆæ­¥éª¤3ï¼‰ï¼Œç„¶åæ‹¿ç€è¿™äº›æ•°æ®è¿›è¡Œé€»è¾‘å¤„ç†ï¼ˆæ­¥éª¤4ï¼‰ï¼Œç„¶åå°†å¤„ç†ç»“æœcopyåˆ°å†…å’Œç¼“å†²åŒºï¼ˆæ­¥éª¤5ï¼‰ï¼Œç„¶åå†…æ ¸ç¼“å†²åŒºå°†è¯¥æ•°æ®copyåˆ°ç½‘å¡ï¼ˆæ­¥éª¤6ï¼‰ï¼Œç„¶åè¿œç¨‹ä¼ è¾“ç»™å®¢æˆ·ç«¯ï¼ˆæ­¥éª¤7ï¼‰ï¼Œè¿™å°±å®Œæˆäº†ä¸€æ¬¡ç½‘ç»œè¯·æ±‚-å“åº”å¤„ç†ã€‚ è¿™é‡Œéœ€è¦æŒ‡å‡ºæ­¥éª¤3ä¸‹é¢è¿™ä¸€æ­¥ï¼Œè¿™ä¸€æ­¥æ²¡æœ‰è®¡å…¥æ­¥éª¤ï¼Œä½†è¿™ä¸€æ­¥æ°å¥½æ˜¯ç†è§£I/Oæ˜¯å¦å‘ç”Ÿé˜»å¡çš„å…³é”®ï¼Œä¸‹é¢ä»‹ç»é˜»å¡/éé˜»å¡IOæ—¶ä¼šè¯¦ç»†è®²ã€‚ 1.3ï¼šå¥—æ¥å­—(socket)&amp;æ–‡ä»¶æè¿°ç¬¦(fd)TCPç”¨ä¸»æœºçš„IPåœ°å€åŠ ä¸Šä¸»æœºä¸Šçš„ç«¯å£å·ä½œä¸ºTCPè¿æ¥çš„ç«¯ç‚¹ï¼Œè¿™ç§ç«¯ç‚¹å°±å«åšå¥—æ¥å­—ï¼ˆsocketï¼‰ï¼Œå¥—æ¥å­—æä¾›äº†å¾ˆå¤šä¾›åº”ç”¨ç¨‹åºä½¿ç”¨çš„APIï¼Œæ¯”å¦‚acceptã€readã€writeç­‰ã€‚ æ–‡ä»¶æè¿°ç¬¦(fd)ï¼ŒUnix/Linuxç³»ç»Ÿä¸‹ï¼Œå…¶ä½œä¸ºä¸€ä¸ªsocketçš„å¥æŸ„ï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œåœ¨socketä¸Šæ”¶å‘æ•°æ®ï¼Œç›¸å½“äºå¯¹ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œè¯»å†™ï¼Œæ‰€ä»¥ä¸€ä¸ªsocketå¥æŸ„ï¼Œé€šå¸¸ä¹Ÿç”¨è¡¨ç¤ºæ–‡ä»¶å¥æŸ„çš„fdæ¥è¡¨ç¤ºã€‚ äºŒã€I/Oæ¨¡å‹2.1ï¼šé˜»å¡&amp;éé˜»å¡è°ƒç”¨é˜»å¡ä¸éé˜»å¡çš„æ¦‚å¿µæ˜¯é’ˆå¯¹è°ƒç”¨æ–¹ï¼ˆä¸€èˆ¬æŒ‡æˆ‘ä»¬çš„ä¸šåŠ¡ç¨‹åºï¼Œå¦‚å›¾1ä¸­çš„webæœåŠ¡å™¨è¿›ç¨‹ï¼‰æ¥è¯´çš„ã€‚ é˜»å¡è°ƒç”¨ï¼šå›¾1ä¸­æ­¥éª¤1ã€2æ‰§è¡ŒæœŸé—´ï¼Œæ²¡æœ‰æ•°æ®åˆ°è¾¾å†…æ ¸ç¼“å†²åŒºï¼Œè¿™ä¸ªæ—¶å€™webæœåŠ¡å™¨è¿›ç¨‹å‘èµ·çš„è·å–æ•°æ®çš„è¯·æ±‚ä¼šè¢«ç›´æ¥é˜»å¡ï¼Œå½“å‰ç›¸å…³çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œç›´åˆ°æ­¥éª¤1ã€2å®Œæˆï¼Œæœ‰æ•°æ®å†™å…¥å†…æ ¸ç¼“å†²åŒºï¼Œè¿™ä¸ªæ—¶å€™æ‰ä¼šå”¤é†’çº¿ç¨‹æ‰§è¡Œæ­¥éª¤3å’Œ4. éé˜»å¡è°ƒç”¨ï¼šä¸é˜»å¡è°ƒç”¨ç›¸åï¼Œå½“æ²¡æœ‰æ•°æ®åˆ°è¾¾å†…æ ¸ç¼“å†²åŒºæ—¶ï¼ŒwebæœåŠ¡å‘èµ·çš„è·å–æ•°æ®çš„è¯·æ±‚ä¸ä¼šå‘ç”Ÿé˜»å¡ï¼Œç›¸å…³çº¿ç¨‹å¯ä»¥é€‰æ‹©åšå…¶ä»–äº‹æƒ…ï¼Œç„¶åè½®è¯¢ç€æŸ¥è¯¢è¯·æ±‚ç»“æœå³å¯ï¼Œå½“æŸæ¬¡è½®è¯¢å‡ºç»“æœï¼Œåˆ™è¿›è¡Œæ­¥éª¤3å’Œ4çš„æ“ä½œã€‚ 2.2ï¼šåŒæ­¥&amp;å¼‚æ­¥å¤„ç†åŒæ­¥ä¸å¼‚æ­¥çš„æ¦‚å¿µæ˜¯é’ˆå¯¹è¢«è°ƒç”¨æ–¹ï¼ˆä¸€èˆ¬æ˜¯æŒ‡å†…æ ¸ç©ºé—´é‡Œçš„IOå¤„ç†ï¼Œå¦‚å›¾1ä¸­çš„æ­¥éª¤1å’Œ2ï¼‰æ¥è¯´çš„ï¼ˆä¸€å®šè¦åŒºåˆ†å’Œç†è§£é˜»å¡/éé˜»å¡ã€åŒæ­¥/å¼‚æ­¥è¿™ä¸¤ä¸ªæ¦‚å¿µï¼‰ã€‚ åŒæ­¥å¤„ç†ï¼šè¢«è°ƒç”¨æ–¹å¾—åˆ°æœ€ç»ˆå¤„ç†ç»“æœæ‰è¿”å›ç»™è°ƒç”¨æ–¹ã€‚ å¼‚æ­¥å¤„ç†ï¼šè¢«è°ƒç”¨æ–¹ä¸ç”¨å¾—åˆ°ç»“æœï¼Œåªéœ€è¿”å›ä¸€ä¸ªçŠ¶æ€ç»™è°ƒç”¨æ–¹ï¼Œç„¶åå¼€å§‹IOå¤„ç†ï¼Œå¤„ç†å®Œäº†å°±ä¸»åŠ¨è¿”å›é€šçŸ¥è°ƒç”¨æ–¹ã€‚ 2.3ï¼šæ•°æ®è¾“å…¥çš„ä¸¤ä¸ªé˜¶æ®µä¸€ä¸ªç½‘ç»œè¾“å…¥æµç¨‹åŒ…å«ä¸‹é¢ä¸¤ä¸ªé˜¶æ®µï¼š æ•°æ®å‡†å¤‡ï¼ˆæ­¥éª¤1ã€2ï¼‰ã€‚ å°†å‡†å¤‡å¥½çš„æ•°æ®ä»å†…æ ¸ç©ºé—´å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ï¼ˆæ­¥éª¤3ï¼‰ã€‚ 2.4ï¼šé˜»å¡IOæ¨¡å‹æˆ‘ä»¬ä»å›¾1çš„æ­¥éª¤3ä¸‹é¢çš„é‚£æ¬¡è¯·æ±‚å¼€å§‹ç”»å›¾ï¼Œé˜»å¡å¼I/Oæ¨¡å‹å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œé˜»å¡IOæ¨¡å‹æ˜¯æŒ‡ä»åº”ç”¨ç¨‹åºå‘èµ·ä»socketè·å–æ•°æ®ï¼ˆrecvfromï¼‰é‚£ä¸€åˆ»èµ·ï¼Œå¦‚æœå†…æ ¸é‡Œæ²¡æœ‰å‡†å¤‡å¥½çš„æ•°æ®æŠ¥ï¼Œåˆ™ç›´æ¥é˜»å¡åº”ç”¨ç¨‹åºï¼Œå¯¼è‡´åº”ç”¨ç¨‹åºæ— æ³•å»åšåˆ«çš„ä»»ä½•äº‹æƒ…ï¼Œç›´åˆ°æ•°æ®æŠ¥å‡†å¤‡å¥½ï¼Œè¢«é˜»å¡çš„ç¨‹åºæ‰ä¼šè¢«å”¤é†’ï¼Œç»§ç»­å¤„ç†ä¸‹é¢æ‹¿åˆ°çš„æ•°æ®æŠ¥ã€‚ é˜»å¡IOæ¨¡å‹åªå…è®¸ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªè¿æ¥è¯·æ±‚ï¼Œå› æ­¤å½“å¹¶å‘é‡å¤§çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œçº¿ç¨‹åˆ‡æ¢å¼€é”€å¾ˆå¤§ï¼Œå¯¼è‡´ç¨‹åºå¤„ç†æ€§èƒ½ä½ä¸‹ã€‚å…·ä½“å‚è€ƒBIOæ¨¡å¼çš„æœåŠ¡ç«¯å®ç°ï¼šSocketChannelä¸BIOæœåŠ¡å™¨ 2.5ï¼šéé˜»å¡IOæ¨¡å‹åŒæ ·ä»åº”ç”¨ç¨‹åºå‘èµ·è·å–æ•°æ®çš„åœ°æ–¹å¼€å§‹ç”»å›¾ï¼Œéé˜»å¡å¼I/Oæ¨¡å‹å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œéé˜»å¡æ¨¡å¼ä¹Ÿæ˜¯ç›¸å¯¹äºè°ƒç”¨è€…çš„ï¼Œè°ƒç”¨è€…åœ¨å‘é€è·å–æ•°æ®çš„è¯·æ±‚æ—¶ä¼šå°†å¯¹åº”å¥—æ¥å£è®¾ç½®ä¸ºéé˜»å¡ï¼Œè¿™æ ·åœ¨æ•°æ®æŠ¥è¿˜æœªå‡†å¤‡å¥½çš„æ—¶å€™ï¼Œåº”ç”¨ç¨‹åºå°±ä¸ä¼šè¢«é˜»å¡äº†ï¼Œç„¶ååº”ç”¨ç¨‹åºå†é€šè¿‡è½®è¯¢çš„æ–¹å¼è¿›è¡Œè¯¢é—®æ•°æ®æŠ¥æ˜¯å¦å·²ç»å‡†å¤‡å¥½ï¼Œå½“å‡†å¤‡å¥½ååœæ­¢è½®è¯¢ï¼Œæ¥ä¸‹æ¥çš„é€»è¾‘è·Ÿé˜»å¡IOä¸€è‡´ã€‚å¯¹æ¯”å¯ä»¥å‘ç°ï¼Œé˜»å¡ä¸éé˜»å¡éƒ½æ˜¯ä»¥è°ƒç”¨æ–¹çš„è§’åº¦çœ‹çš„ï¼Œè€Œä¸”é˜»å¡ä¸å¦å…¨åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œç¬¬äºŒä¸ªé˜¶æ®µéƒ½æ˜¯ä¸€è‡´çš„ã€‚éé˜»å¡IOè™½ç„¶ä¸ä¼šé˜»å¡åº”ç”¨ç¨‹åºï¼Œä½†æ˜¯å› ä¸ºéœ€è¦é•¿æ—¶é—´çš„è½®è¯¢ï¼Œå¯¹äºCPUæ¥è¯´ï¼Œå°†ä¼šè¿›è¡Œå¤§é‡æ— æ„ä¹‰çš„åˆ‡æ¢ï¼Œèµ„æºåˆ©ç”¨ç‡è¾ƒä½ã€‚ 2.6ï¼šéé˜»å¡IO-å¤šè·¯å¤ç”¨æ¨¡å‹2.6.1ï¼šæ¨¡å‹ä»‹ç»IOå¤šè·¯å¤ç”¨æ¨¡å‹å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒIOå¤šè·¯å¤ç”¨ï¼Œå…¶å®æ˜¯æ‰¾äº†ä¸ªä»£ç†selectï¼Œå¸®åŠ©ç›‘å¬å¤šä¸ªIOé€šé“çš„çŠ¶æ€ï¼ŒæŸä¸ªé€šé“æœ‰æ–°çŠ¶æ€äº§ç”Ÿï¼Œæ‰è§¦å‘recvfromæ“ä½œï¼Œæ²¡æœ‰æ–°çš„çŠ¶æ€äº§ç”Ÿï¼Œåˆ™selectä¼šé˜»å¡ã€‚æ³¨æ„è¿™é‡Œçš„é˜»å¡ï¼Œä¸é˜»å¡IOæ¨¡å‹é‡Œçš„ä¸åŒï¼Œé˜»å¡IOæ¨¡å‹æ˜¯æŒ‡ä¸€ä¸ªIOæ“ä½œå‘ç”Ÿçš„é˜»å¡è¡Œä¸ºï¼Œè€Œè¿™é‡Œselectå¯ä»¥åŒæ—¶é˜»å¡å¤šä¸ªIOé€šé“ï¼Œä¹Ÿå°±æ˜¯è¯´selectå¯èƒ½ä¼šç›‘å¬åˆ°ä¸€ä¸ªä»¥ä¸Šçš„IOé€šé“çš„çŠ¶æ€ï¼Œç›´åˆ°æœ‰æ•°æ®å¯è¯»ã€å¯å†™æ—¶ï¼Œæ‰çœŸæ­£è§¦å‘IOæ“ä½œçš„å‡½æ•°ã€‚ ğŸŒ¿ å¤šè·¯å¤ç”¨ å›¾4é‡Œçš„å¤šè·¯å¤ç”¨æ˜¯è¯´åˆ©ç”¨æŸä¸ªIOå‡½æ•°ï¼ˆè¿™é‡Œæ˜¯æŒ‡selectï¼‰åŒæ—¶ç›‘å¬å¤šä¸ªIOé€šé“çš„çŠ¶æ€å˜æ›´ï¼Œè¿™æ ·åº”ç”¨ç¨‹åºå°±å¯ä»¥é€šè¿‡ä¸€ä¸ªå‡½æ•°åŒæ—¶ç›‘å¬å¤šä¸ªé€šé“çš„å°±ç»ªçŠ¶æ€ï¼ˆå¦‚è¿æ¥å°±ç»ªã€è¯»å°±ç»ªï¼‰ï¼Œå¤šè·¯å¤ç”¨è·Ÿåé¢è¦è®²çš„NIOä¸æ˜¯åŒä¸€ä¸ªæ¦‚å¿µï¼Œå®ƒåªæ˜¯ä¸€ç§å¤„ç†æ¨¡å‹ï¼Œè€ŒNIOæ˜¯ä¸€ç»„APIï¼Œå®ƒæä¾›çš„selectå‡½æ•°æ°å¥½å¯ä»¥å®ç°è¿™ç§æ•°æ®å¤„ç†æ¨¡å‹ã€‚ å¦å¤–ä¸€ç§å¤šè·¯å¤ç”¨æ˜¯æŒ‡åŸºäºä¼ è¾“å±‚åè®®ï¼ˆå¦‚TCPï¼‰çš„ç‰¹æ€§æ¥å®ç°çš„æ•°æ®æµä¼ è¾“æ–¹å¼ï¼Œæ ¹æ®TCPç‰¹æ€§ï¼ŒåŒä¸€ä¸ªTCPè¿æ¥å¯ä»¥åŒæ—¶ä¼ è¾“å¤šæ¡æ•°æ®å’Œæ¥æ”¶å¤šæ¡æ•°æ®ï¼Œè€Œå®ç°è¿™ç§å¤šè·¯å¤ç”¨çš„æ–¹å¼å–å†³äºåº”ç”¨å±‚åè®®ï¼ˆå…¨åŒå·¥é€šä¿¡çš„åº”ç”¨å±‚åè®®ï¼Œæ¯”å¦‚HTTP2ï¼‰ã€‚å¤šè·¯æ˜¯æŒ‡å¤šä¸ªæ•°æ®æµï¼Œå¤ç”¨æ˜¯æŒ‡å¤ç”¨åŒä¸€ä¸ªèµ„æºï¼ˆè¿™ä¸ªèµ„æºæ”¾åˆ°å›¾4å°±æ˜¯æŒ‡selectå‡½æ•°ï¼Œæ”¾åˆ°é€šä¿¡æ–¹å¼é‡Œå°±æ˜¯æŒ‡TCPè¿æ¥ï¼‰ï¼Œå¯ä»¥å‚è€ƒå…¶åŸå§‹æ¦‚å¿µï¼šå¤šè·¯å¤ç”¨-ç™¾åº¦ç™¾ç§‘ã€‚ä»¥åŠè¿™ç¯‡çŸ¥ä¹ä¸Šçš„å›ç­”ï¼šIO å¤šè·¯å¤ç”¨æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ 2.6.2ï¼šselectã€pollã€epollå‡½æ•°ä¸Šè¿°ä¸‰ä¸ªå‡½æ•°å‡æä¾›IOå¤šè·¯å¤ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å®ƒä»¬ä¹‹é—´å­˜åœ¨å·®å¼‚æ€§ï¼Œä¸‹é¢ä¼šä»‹ç»å…·ä½“çš„åŒºåˆ«ï¼š selectï¼š select å‡½æ•°ç›‘è§†çš„fdåˆ†ä¸ºwritefdsã€readfdsã€exceptfdsä¸‰ç±»ï¼Œè°ƒç”¨åselectå‡½æ•°ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰fdå°±ç»ªï¼ˆå¯è¯»ã€å¯å†™ã€æˆ–exceptï¼‰ï¼Œæˆ–è¶…æ—¶ï¼ˆæŒ‡å®šç­‰å¾…æ—¶é—´ï¼Œå¦‚æœç«‹å³è¿”å›è®¾ä¸ºnullå³å¯ï¼‰ï¼Œå‡½æ•°è¿”å›ã€‚å½“selectå‡½æ•°è¿”å›åï¼Œå¯ä»¥é€šè¿‡éå†fdsetï¼Œæ¥æ‰¾åˆ°å·²ç»å°±ç»ªçš„fdã€‚ ä¼˜ç‚¹ï¼šè·¨å¹³å°æ”¯æŒï¼Œç›®å‰å‡ ä¹æ‰€æœ‰çš„å¹³å°éƒ½æ”¯æŒã€‚ ç¼ºç‚¹ï¼šå•ä¸ªè¿›ç¨‹å†…å…¶ç›‘è§†çš„fdå­˜åœ¨æœ€å¤§é™åˆ¶ï¼Œä¸€èˆ¬ä¸º1024ä¸ªï¼ˆlinux32ï¼‰æˆ–è€…2048ä¸ªï¼ˆlinux64ï¼‰ã€‚å¦å¤–ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯å…¶ä¼šä¸æ–­çš„è½®è¯¢fdsetï¼Œä¸ç®¡å­˜ä¸å­˜åœ¨æ´»è·ƒçš„socketï¼Œå®ƒéƒ½ä¼šå…¨éƒ¨éå†ä¸€éfdsetæ¥æŸ¥æ‰¾å°±ç»ªçš„fdï¼Œå¯¼è‡´æµªè´¹è®¸å¤šCPUçš„æ—¶é—´å»åšè¿™ä»¶äº‹ã€‚æœ€åä¸€ä¸ªç¼ºç‚¹æ˜¯å…¶å¯èƒ½ä¼šç»´æŠ¤ä¸€ä¸ªå­˜æ”¾å¤§é‡fdçš„æ•°æ®ç»“æ„ï¼Œè¿™æ ·ä¼šä½¿ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´åœ¨ä¼ é€’è¯¥ç»“æ„æ—¶å¤åˆ¶å¼€é”€è¿‡å¤§ã€‚ pollï¼š æœ¬è´¨ä¸Šå’Œselectæ²¡æœ‰åŒºåˆ«ï¼Œä½†æ˜¯å®ƒè§£å†³äº†selectç›‘è§†fdä¸ªæ•°çš„é™åˆ¶ã€‚ ä¼˜ç‚¹ï¼šå¯¹äºç›‘è§†çš„fdï¼Œé‡‡ç”¨é“¾è¡¨ç»“æ„å­˜å‚¨ï¼Œæ— ä¸ªæ•°é™åˆ¶ã€‚ ç¼ºç‚¹ï¼šåŸºæœ¬ä¸Šselectæœ‰çš„ç¼ºç‚¹å®ƒéƒ½æœ‰ï¼Œå…¶æ¬¡å®ƒè¿˜æœ‰ä¸ªç‰¹ç‚¹ï¼šæ°´å¹³è§¦å‘ï¼Œä¹Ÿå°±æ˜¯è¯´pollåˆ°çš„fdæ²¡æœ‰è¢«å¤„ç†æ‰ï¼Œä¸‹æ¬¡ä¾æ—§èƒ½è¢«pollåˆ°ã€‚ selectå’Œpollä¸€æ ·ï¼Œåœ¨å¤§é‡å®¢æˆ·ç«¯è¿æ¥è¿›æ¥æ—¶ï¼Œå®ƒä»¬çš„æ•ˆç‡ä¼šéšç€å®¢æˆ·ç«¯æ•°é‡è€Œçº¿æ€§ä¸‹é™ã€‚ epollï¼š Linux2.6å¼€å§‹æ”¯æŒçš„ä¸€ä¸ªå‡½æ•°ï¼Œæ˜¯å¯¹selectå’Œpollçš„å¢å¼ºç‰ˆæœ¬ã€‚ ä¼˜ç‚¹ï¼šæ²¡æœ‰ç›‘è§†fdä¸ªæ•°çš„é™åˆ¶ï¼Œä¸»åŠ¨é€šçŸ¥ï¼ˆå›è°ƒï¼‰æœºåˆ¶ï¼Œåªå…³æ³¨æ´»è·ƒçš„fdï¼Œä¸ç”¨åƒselectå’Œpollé‚£æ ·å…¨é‡éå†å»æ‰¾å°±ç»ªçš„fdï¼Œå› è€Œä¹Ÿä¸å­˜åœ¨éšç€å®¢æˆ·ç«¯æ•°é‡çš„å¢å¤šè€Œæ€§èƒ½ä¸‹é™çš„é—®é¢˜ã€‚æœ€åæ˜¯å†…å­˜æ‹·è´ï¼Œåˆ©ç”¨mmap()æ–‡ä»¶æ˜ å°„å†…å­˜åŠ é€Ÿä¸å†…æ ¸ç©ºé—´çš„æ¶ˆæ¯ä¼ é€’ï¼Œå³epollä½¿ç”¨mmapå‡å°‘å¤åˆ¶å¼€é”€ã€‚ ç¼ºç‚¹ï¼šåœ¨å¤§é‡å®¢æˆ·ç«¯è¿æ¥ï¼Œå¹¶ä¸”å¤§é‡æ´»è·ƒçš„fdæ—¶ï¼Œå…¶æ€§èƒ½å¯èƒ½è¿˜ä¸å¦‚select/pollã€‚ 2.7ï¼šä¿¡å·é©±åŠ¨å¼IOæ¨¡å‹ä¿¡å·é©±åŠ¨IOæ¨¡å‹å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š é€šè¿‡ä¸Šå›¾ï¼Œåœ¨ä¿¡å·é©±åŠ¨ IO æ¨¡å‹ä¸­ï¼Œåº”ç”¨ç¨‹åºä½¿ç”¨å¥—æ¥å£è¿›è¡Œä¿¡å·é©±åŠ¨ IOï¼Œå¹¶å®‰è£…ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œè¿›ç¨‹ç»§ç»­è¿è¡Œå¹¶ä¸ä¼šå‘ç”Ÿé˜»å¡ï¼› å½“æ•°æ®å‡†å¤‡å¥½æ—¶ï¼Œè¿›ç¨‹ä¼šæ”¶åˆ°ä¸€ä¸ª SIGIO ä¿¡å·ï¼Œå¯ä»¥åœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­è°ƒç”¨ IO æ“ä½œå‡½æ•°å¤„ç†æ•°æ®ã€‚ è¿™ç§æ¨¡å¼ä¸‹åœ¨å¤§é‡IOæ“ä½œæ—¶å¯èƒ½ä¼šå‘ç”Ÿä¿¡å·é˜Ÿåˆ—æº¢å‡ºè€Œå¯¼è‡´æ— æ³•é€šçŸ¥ã€‚åœ¨TCPä¸‹ï¼Œè¯¥æ¨¡å¼å‡ ä¹æ²¡ç”¨ï¼ŒTCPä¸‹å¯é€šçŸ¥çš„æ¡ä»¶è¿‡å¤šï¼Œæ¯ä¸€ä¸ªéƒ½è¿›è¡Œåˆ¤æ–­ä¼šæ¶ˆè€—æ‰å¤§é‡çš„èµ„æºã€‚ 2.8ï¼šå¼‚æ­¥IOæ¨¡å‹ï¼ˆAIOï¼‰ä¸Šé¢ä»‹ç»çš„å‡ ç§IOæ¨¡å‹ï¼Œå¯¹äºIOå¤„ç†æœ¬èº«è€Œè¨€ï¼Œéƒ½æ˜¯åŒæ­¥çš„ï¼Œåªæœ‰è¿™ä¸ªæ¨¡å‹ï¼Œé’ˆå¯¹IOå¤„ç†æœ¬èº«æ¥è®²ï¼Œæ˜¯å¼‚æ­¥çš„ã€‚ ä¸‹é¢æ¥çœ‹çœ‹æµç¨‹å›¾ï¼š ç”±ä¸Šå›¾çœ‹å‡ºï¼Œæ­¤æ¨¡å‹ä¸‹é¦–å…ˆç”±åº”ç”¨ç¨‹åºå‘ŠçŸ¥å†…æ ¸å¯åŠ¨æŸä¸ªæ“ä½œï¼Œå¹¶è®©å†…æ ¸åœ¨æ•´ä¸ªæ“ä½œåŒ…æ‹¬å°†æ•°æ®ä»å†…æ ¸æ‹·è´åˆ°åº”ç”¨ç¨‹åºçš„ç¼“å†²åŒºçš„è¿‡ç¨‹ä¸­ï¼Œå®Œæˆåé€šçŸ¥åº”ç”¨ç¨‹åºã€‚ è¿™è·Ÿä¸Šé¢çš„ä¿¡å·é©±åŠ¨IOæ¨¡å‹æœ‰æ‰€ä¸åŒï¼Œè¿™ä¸ªæ¨¡å‹é€šçŸ¥ç»™åº”ç”¨ç¨‹åºæ—¶ï¼ŒIOæ“ä½œå·²ç»å…¨éƒ¨å®Œæˆï¼Œåº”ç”¨ç¨‹åºç›´æ¥æ‹¿æ•°æ®å°±å¥½ï¼Œæ— éœ€å†åšä»»ä½•IOæ“ä½œï¼ˆè¿™å°±æ˜¯æ­¤æ¨¡å‹å«å¼‚æ­¥IOå¤„ç†çš„åŸå› ï¼‰ï¼Œè€Œä¿¡å·é©±åŠ¨é€šå¸¸æ˜¯è¿”å›ç»™åº”ç”¨ç¨‹åºä¸€ä¸ªæ•°æ®æŠ¥å‡†å¤‡çŠ¶æ€ï¼ŒçœŸæ­£çš„IOæ“ä½œä»éœ€è¦åº”ç”¨ç¨‹åºè¿›è¡Œã€‚ ç›®å‰AIOå¹¶ä¸å®Œå–„ï¼Œæœ€å¸¸ç”¨çš„é«˜æ€§èƒ½IOæ¨¡å‹ä»ç„¶æ˜¯IOå¤šè·¯å¤ç”¨æ¨¡å‹ã€‚ ä¸‰ã€æ€»ç»“è¿™å‡ ç§æ¨¡å‹é™¤äº†AIOå±äºå¼‚æ­¥IOä»¥å¤–ï¼Œå…¶ä½™çš„å‡ ç§å…¨éƒ½æ˜¯åŒæ­¥IOï¼ˆå³éœ€è¦åº”ç”¨ç¨‹åºä¸»åŠ¨è¿›è¡ŒIOæ“ä½œï¼‰ï¼Œè€Œæ˜¯å¦é˜»å¡åº”ç”¨ç¨‹åºå–å†³äºç¬¬ä¸€ä¸ªé˜¶æ®µçš„å¤„ç†æ–¹å¼ï¼Œå‰å‡ ç§IOæ¨¡å‹çš„åŒºåˆ«å…¨åœ¨äºç¬¬ä¸€é˜¶æ®µçš„å¤„ç†ã€‚ æœ¬æ–‡å‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/43933717","link":"/2019/03/19/Java%20NIO%E5%AD%A6%E4%B9%A0%E4%B8%8E%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%94%EF%BC%89%EF%BC%9A%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84IO%E6%A8%A1%E5%9E%8B/"},{"title":"åˆ©ç”¨CompletableFutureä¼˜åŒ–ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡","text":"ä¸€ã€çº¿ç¨‹æ± çš„Futureæ¨¡å¼åœ¨äº†è§£java8çš„CompletableFutureä¹‹å‰ï¼Œå…ˆé€šè¿‡Futureæ¥è§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œçœ‹ä¸ªä¾‹å­ï¼š å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªç½‘ç«™ï¼Œé¦–é¡µæœ‰é¡¶éƒ¨Bannerä½ã€å·¦è¾¹æ ã€å³è¾¹æ ã€ç”¨æˆ·ä¿¡æ¯å‡ å¤§æ¨¡å—éœ€è¦åŠ è½½ï¼Œç°åœ¨å‡ºä¸€ä¸ªæ¥å£ï¼Œè¦æ±‚åŒ…è£…å¹¶åå‡ºè¿™å‡ å¤§æ¨¡å—çš„å†…å®¹ å…ˆæ¥æŠ½è±¡ä¸€ä¸ªé¦–é¡µæ¥å£å¯¹è±¡ï¼š 1234567891011121314151617public class WebModule { private String top; //é¡¶éƒ¨Bannerä½ private String left; //å·¦è¾¹æ  private String right; //å³è¾¹æ  private String user; //ç”¨æˆ·ä¿¡æ¯ //...get...set... @Override public String toString() { return String.format(\"top: %s; left: %s; right: %s; user: %s\", top, left, right, user); }} ä»£ç å—1 ç°åœ¨æä¾›ä¸‹é¢å‡ ä¸ªä¸šåŠ¡æ–¹æ³•æ¥è·å–è¿™äº›ä¿¡æ¯ï¼š 1234567891011121314151617181920212223242526272829303132333435private String getTop() { // è¿™é‡Œå‡è®¾getTopéœ€è¦æ‰§è¡Œ200ms try { Thread.sleep(200L); } catch (InterruptedException e) { e.printStackTrace(); } return \"é¡¶éƒ¨bannerä½\"; } private String getLeft() { // è¿™é‡Œå‡è®¾getLeftéœ€è¦æ‰§è¡Œ50ms try { Thread.sleep(50L); } catch (InterruptedException e) { e.printStackTrace(); } return \"å·¦è¾¹æ \"; } private String getRight() { // è¿™é‡Œå‡è®¾getRightéœ€è¦æ‰§è¡Œ80ms try { Thread.sleep(80L); } catch (InterruptedException e) { e.printStackTrace(); } return \"å³è¾¹æ \"; } private String getUser() { // è¿™é‡Œå‡è®¾getUseréœ€è¦æ‰§è¡Œ100ms try { Thread.sleep(100L); } catch (InterruptedException e) { e.printStackTrace(); } return \"ç”¨æˆ·ä¿¡æ¯\"; } ä»£ç å—2 okï¼Œç°åœ¨æ¥å®ç°ä¸‹è¿™ä¸ªæ¥å£ï¼š 123456789// åŒæ­¥è·å–public WebModule getWebModuleMsgSync() { WebModule webModule = new WebModule(); webModule.setTop(getTop()); webModule.setLeft(getLeft()); webModule.setRight(getRight()); webModule.setUser(getUser()); return webModule;} ä»£ç å—3 ä¸Šé¢çš„ä»£ç ä¼šä¸€æ¬¡è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ¥èµ‹å€¼ï¼Œæœ€ç»ˆè¿”å›æ¥å£å¯¹è±¡ï¼Œè¿™ä¸ªæ–¹æ³•çš„æœ€ç»ˆè€—æ—¶ä¸ºå‡ ä¸ªä¸šåŠ¡æ–¹æ³•è€—æ—¶çš„æ€»å’Œï¼š 12é€šè¿‡åŒæ­¥æ–¹æ³•è·å–é¦–é¡µå…¨éƒ¨ä¿¡æ¯æ¶ˆè€—æ—¶é—´ï¼š435msç»“æœä¸ºï¼štop: é¡¶éƒ¨bannerä½; left: å·¦è¾¹æ ; right: å³è¾¹æ ; user: ç”¨æˆ·ä¿¡æ¯ 430mså·¦å³çš„æ‰§è¡Œæ—¶é—´ï¼Œå…¶å®è¿™å‡ ä¸ªæ¨¡å—æ˜¯ç›¸äº’ç‹¬ç«‹æ²¡æœ‰å½±å“çš„ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± çš„Futureæ¨¡å¼æ¥è¿›è¡Œå¤šçº¿ç¨‹å¤„ç†ä¼˜åŒ–ï¼š 12345678910111213// å¼‚æ­¥è·å–public WebModule getWebModuleMsgAsync() throws ExecutionException, InterruptedException { Future top = executorService.submit(this::getTop); Future left = executorService.submit(this::getLeft); Future right = executorService.submit(this::getRight); Future user = executorService.submit(this::getUser); WebModule webModule = new WebModule(); webModule.setTop(top.get()); webModule.setLeft(left.get()); webModule.setRight(right.get()); webModule.setUser(user.get()); return webModule;} ä»£ç å—4 è¿™å‡ ä¸ªæ–¹æ³•ä¼šè¢«å¼‚æ­¥æ‰§è¡Œï¼Œgetæ–¹æ³•ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æ‰§è¡Œç»“æŸï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š 12é€šè¿‡å¼‚æ­¥æ–¹æ³•è·å–é¦–é¡µå…¨éƒ¨ä¿¡æ¯æ¶ˆè€—æ—¶é—´ï¼š276msç»“æœä¸ºï¼štop: é¡¶éƒ¨bannerä½; left: å·¦è¾¹æ ; right: å³è¾¹æ ; user: ç”¨æˆ·ä¿¡æ¯ å¯ä»¥çœ‹åˆ°ï¼Œæ‰§è¡Œé€Ÿåº¦å‡ ä¹é™äº†è¿‘200msï¼Œè¿™å–å†³äºæœ€æ…¢çš„é‚£ä¸ªä»»åŠ¡çš„è€—æ—¶ã€‚ é€šè¿‡ä¸Šè¿°çš„ä¾‹å­å¯ä»¥å‘ç°ï¼Œå¾ˆå¤šç¨‹åºéƒ½æ˜¯å¯ä»¥é€šè¿‡å¼‚æ­¥å……åˆ†åˆ©ç”¨CPUèµ„æºçš„æ–¹å¼æ¥è¿›è¡Œä¼˜åŒ–å¤„ç†çš„ï¼Œå•çœ‹ä¸Šé¢çš„ç¨‹åºæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯ä»”ç»†æƒ³æƒ³ä¼šå‘ç°å¤ªè¿‡å±€é™ï¼Œå› ä¸ºå‡ ä¸ªæ¨¡å—ç›¸äº’ç‹¬ç«‹ï¼Œä½†åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½å­˜åœ¨Bæ–¹æ³•éœ€è¦æ‹¿åˆ°Aæ–¹æ³•çš„ç»“æœæ‰å¯ä»¥å¾€ä¸‹è¿›è¡Œçš„é—®é¢˜ï¼Œæ‰€ä»¥ä¸Šé¢çš„ç¨‹åºå°±ä¸å¤ªé€‚ç”¨äº†ï¼Œjava8å‡ºç°äº†ä»Šå¤©è¦è¯´çš„ä¸€ä¸ªå†…å®¹ï¼šCompletableFutureï¼Œè¯¥ç±»å¯ä»¥å¸®åŠ©ä½ å®ç°ä¸Šé¢æ‰€è¯´çš„ä»»åŠ¡é¡ºåºè°ƒåº¦ï¼Œä¸ç›¸å¹²çš„ç¨‹åºä¾ç„¶åœ¨å¼‚æ­¥ï¼Œç›¸å¹²çš„å­˜åœ¨å…ˆåé¡ºåºçš„å°†ä¼šé€šè¿‡ä¸€å®šçš„è®¾ç½®æ¥æ»¡è¶³è‡ªå·±çš„é¡ºåºæœŸæœ›ã€‚ äºŒã€CompletableFutureç°åœ¨å†æ¥å‡è®¾ä¸€ä¸ªä¾‹å­ï¼Œç°åœ¨å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•çš„è°ƒç”¨ï¼š zeroæ–¹æ³•ã€aæ–¹æ³•ã€bæ–¹æ³•ã€abæ–¹æ³•ã€cæ–¹æ³•ã€dæ–¹æ³•ã€eæ–¹æ³• å®šä¹‰å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536//å„ä¸ªæ–¹æ³•ï¼Œsleepå½“æˆæ˜¯æ‰§è¡Œæ—¶é—´private void zero() { sleep(100L); System.out.println(\"zeroæ–¹æ³•è§¦å‘ï¼\\n-----------------------------\");}private String a() { sleep(500L); return \"a\";}private String b(String a) { sleep(1000L); return a + \"b\";}private String c() { sleep(500L); return \"c\";}private String ab(String a, String b) { sleep(100L); return a + \"|\" + b;}private void d(String a) { sleep(1000L); System.out.println(\"dæ–¹æ³•è§¦å‘ï¼Œæ‹¿åˆ°çš„a = \" + a);}private String e(String a) { sleep(100L); return a + \"e\";} ä»£ç å—5 æ ¹æ®ä¸Šé¢çš„æ–¹æ³•å®šä¹‰ï¼Œå¯ä»¥æ•´ç†å‡ºæ¥å…¶æ‰§è¡Œå…³ç³»ï¼š zeroã€aã€céƒ½æ˜¯ç‹¬ç«‹è°ƒç”¨çš„æ–¹æ³•ï¼Œè€Œbã€dã€eæ–¹æ³•éƒ½éœ€è¦æ‹¿åˆ°açš„æ‰§è¡Œç»“æœå€¼æ‰èƒ½è§¦å‘ï¼Œabæ–¹æ³•åˆ™è¦æ±‚æ›´åŠ è‹›åˆ»ï¼Œéœ€è¦åŒæ—¶æ‹¿åˆ°aå’Œbçš„æ‰§è¡Œç»“æœæ‰å¯ä»¥è§¦å‘ï¼Œç°åœ¨å‡è®¾éœ€è¦æŠŠæ‰€æœ‰çš„æ–¹æ³•éƒ½è§¦å‘ä¸€éï¼Œæˆ‘ä»¬åˆæœŸæœ›é€šè¿‡å¼‚æ­¥çš„æ–¹å¼æ¥å°½å¯èƒ½çš„ä¼˜åŒ–ä»£ç ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœè¿˜ç”¨ä¸Šé¢ä¾‹å­é‡Œçš„æ–¹å¼ï¼Œææ€•å°±å¾ˆéš¾è¿›è¡Œä¸‹å»äº†ï¼Œå› ä¸ºå¾ˆå¤šæ–¹æ³•å­˜åœ¨ç›¸äº’ä¾èµ–çš„ç°è±¡ï¼Œä¸è¿‡ç°åœ¨æœ‰äº†CompletableFutureï¼Œè¿™ä¸ªé—®é¢˜å°±å¯ä»¥è§£å†³äº†ï¼Œæ¥çœ‹ä¸‹ä»£ç ï¼ˆæ–¹æ³•åŠä½œç”¨éƒ½å†™åœ¨æ³¨é‡Šä¸Šäº†ï¼Œä¸‹é¢çš„æ–‡ç« å°±ä¸å¤šåšè¯´æ˜äº†ï¼‰ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667public static void main(String[] args) throws ExecutionException, InterruptedException { long s = System.currentTimeMillis(); Test t = new Test(); //runAsyncç”¨äºæ‰§è¡Œæ²¡æœ‰è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡ CompletableFuture future0 = CompletableFuture.runAsync(t::zero) .exceptionally(e -&gt; { System.out.println(\"Zeroå‡ºé”™ï¼\"); return null; }); //è¿™é‡Œæ˜¯å¼‚å¸¸å¤„ç†ï¼ŒæŒ‡çš„æ˜¯è¯¥å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œä¸­å‡ºé”™ï¼Œåº”è¯¥åšçš„å¤„ç† //supplyAsyncæ–¹æ³•ç”¨äºæ‰§è¡Œå¸¦æœ‰è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡ CompletableFuture futureA = CompletableFuture.supplyAsync(t::a) .exceptionally(e -&gt; { System.out.println(\"æ–¹æ³•Aå‡ºé”™ï¼\"); return null; }); //thenComposeæ–¹æ³•ç”¨äºè¿æ¥ä¸¤ä¸ªCompletableFutureä»»åŠ¡ï¼Œå¦‚ä¸‹ä»£è¡¨futureAç»“æŸåå°†æ‰§è¡Œç»“æœäº¤ç”±å¦å¤–ä¸€ä¸ªCompletableFutureå¤„ç†ï¼Œç„¶åå°†æ‰§è¡Œé“¾è·¯æœ€ç»ˆèµ‹å€¼ç»™futureB CompletableFuture futureB = futureA.thenCompose(a -&gt; CompletableFuture.supplyAsync(() -&gt; t.b(a))) .exceptionally(e -&gt; { System.out.println(\"æ–¹æ³•Bå‡ºé”™ï¼\"); return null; }); //thenAcceptæ–¹æ³•ç”¨äºå°†ä¸€ä¸ªä»»åŠ¡çš„ç»“æœï¼Œä¼ ç»™éœ€è¦è¯¥ç»“æœçš„ä»»åŠ¡ï¼Œå¦‚ä¸‹è¡¨ç¤ºfutureDçš„æ‰§è¡Œéœ€è¦futureAçš„ç»“æœï¼Œä¸thenApplyä¸åŒçš„æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•æ²¡æœ‰æœ‰è¿”å›å€¼ CompletableFuture futureD = futureA.thenAccept(t::d); //thenApplyæ–¹æ³•ç”¨äºå°†ä¸€ä¸ªä»»åŠ¡çš„ç»“æœï¼Œä¼ ç»™éœ€è¦è¯¥ç»“æœçš„ä»»åŠ¡ï¼Œå¦‚ä¸‹è¡¨ç¤ºfutureEçš„æ‰§è¡Œéœ€è¦futureAçš„ç»“æœï¼Œä¸thenAcceptä¸åŒçš„æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•æœ‰è¿”å›å€¼ CompletableFuture futureE = futureA.thenApply(t::e) .exceptionally(e -&gt; { System.out.println(\"æ–¹æ³•Eå‡ºé”™ï¼\"); return null; }); /** * thenApplyæ–¹æ³•æ¦‚å¿µå®¹æ˜“ä¸thenComposeæ··æ·†ï¼Œæ¯•ç«Ÿæœ€ç»ˆç›®çš„å¾ˆç›¸ä¼¼ */ //thenCombineæ–¹æ³•ç”¨äºè¿æ¥å¤šä¸ªå¼‚æ­¥ä»»åŠ¡çš„ç»“æœï¼Œå¦‚ä¸‹abæ–¹æ³•éœ€è¦futureAå’ŒfutureBçš„æ‰§è¡Œç»“æœï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨thenCombineè¿›è¡Œè¿æ¥ //æ³¨æ„ï¼Œæ‰§è¡Œåˆ°abè¿™é‡Œï¼Œè¯´æ˜futureAå’ŒfutureBä¸€å®šå·²ç»æ‰§è¡Œå®Œäº† CompletableFuture futureAB = futureA.thenCombine(futureB, t::ab) .exceptionally(e -&gt; { System.out.println(\"æ–¹æ³•ABå‡ºé”™ï¼\"); return null; }); //å•çº¯çš„ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œä¸ä¾èµ–ä»»ä½•å…¶ä»–ä»»åŠ¡ CompletableFuture futureC = CompletableFuture.supplyAsync(t::c) .exceptionally(e -&gt; { System.out.println(\"æ–¹æ³•Cå‡ºé”™ï¼\"); return null; }); //allOfå¦‚æœé˜»å¡ç»“æŸåˆ™è¡¨ç¤ºæ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡Œç»“æŸäº† CompletableFuture.allOf(future0, futureA, futureB, futureAB, futureC, futureD, futureE).get(); System.out.println(\"æ–¹æ³•Zeroè¾“å‡ºï¼š\" + future0.get()); System.out.println(\"æ–¹æ³•Aè¾“å‡ºï¼š\" + futureA.get()); System.out.println(\"æ–¹æ³•Bè¾“å‡ºï¼š\" + futureB.get()); System.out.println(\"æ–¹æ³•ABè¾“å‡ºï¼š\" + futureAB.get()); System.out.println(\"æ–¹æ³•Cè¾“å‡ºï¼š\" + futureC.get()); System.out.println(\"æ–¹æ³•Dè¾“å‡ºï¼š\" + futureD.get()); System.out.println(\"æ–¹æ³•Eè¾“å‡ºï¼š\" + futureE.get()); System.out.println(\"è€—æ—¶ï¼š\" + (System.currentTimeMillis() - s) + \"ms\"); } ä»£ç å—6 è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š 1234567891011zeroæ–¹æ³•è§¦å‘ï¼-----------------------------dæ–¹æ³•è§¦å‘ï¼Œæ‹¿åˆ°çš„a = aæ–¹æ³•Zeroè¾“å‡ºï¼šnullæ–¹æ³•Aè¾“å‡ºï¼šaæ–¹æ³•Bè¾“å‡ºï¼šabæ–¹æ³•ABè¾“å‡ºï¼ša|abæ–¹æ³•Cè¾“å‡ºï¼šcæ–¹æ³•Dè¾“å‡ºï¼šnullæ–¹æ³•Eè¾“å‡ºï¼šaeè€—æ—¶ï¼š1668ms å¯ä»¥çœ‹åˆ°ï¼Œé€»è¾‘æ–¹é¢æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ï¼Œä¹ŸæŒ‰ç…§é¢„æœŸçš„é¡ºåºå’Œæ–¹å¼è¿›è¡Œäº†ï¼Œæ³¨æ„çœ‹è¿™é‡Œçš„è¿è¡Œæ—¶é—´ï¼Œçº¦ç­‰äº1600msï¼Œä¸ç¬¬ä¸€ä¸ªä¾‹å­æ—¶é•¿å–å†³äºæ‰§è¡Œæ—¶é—´æœ€é•¿çš„é‚£ä¸ªæ–¹æ³•ä¸åŒï¼Œä¸Šé¢çš„ä¾‹å­æ—¶é•¿å–å†³äºæœ‰åºçš„æ‰§è¡Œé“¾çš„è€—æ—¶æœ€é•¿çš„æ‰§è¡Œæ—¶é—´ï¼Œåˆ†æä¸‹ä¸Šé¢çš„ç¨‹åºï¼Œé¡ºåºé“¾æœ€é•¿çš„ï¼Œå°±æ˜¯abè¿™æ¡ï¼Œabéœ€è¦aå’Œbå…¨éƒ¨æ‰§è¡Œå®Œï¼Œè€Œbåˆä¾èµ–açš„ç»“æœï¼Œå› æ­¤abæ‰§è¡Œå®Œçš„æ—¶é—´å°±æ˜¯500+1000çš„æ—¶é—´ï¼ˆaéœ€è¦500msï¼Œbåˆéœ€è¦ç­‰å¾…aï¼Œ500msåbè§¦å‘ï¼Œbè‡ªèº«åˆéœ€è¦1000msï¼Œç­‰éƒ½ç»“æŸäº†ï¼Œå†è§¦å‘abæ–¹æ³•ï¼Œè€Œabæ–¹æ³•åˆéœ€è¦100msçš„æ‰§è¡Œæ—¶é—´ï¼Œå› æ­¤abæ˜¯æœ€é•¿çš„è€—æ—¶æ–¹æ³•ï¼Œabè€—æ—¶=500+1000+100ï¼‰ éœ€è¦è¯´æ˜çš„æ˜¯ä¸Šè¿°ä¾‹å­é‡Œç”¨åˆ°çš„æ–¹æ³•ï¼Œå‡ ä¹æ¯ä¸ªéƒ½æœ‰ä¸ªé‡è½½æ–¹æ³•ï¼Œç”¨æ¥ä¼ é€’ä¸€ä¸ªçº¿ç¨‹æ± å¯¹è±¡ï¼Œä¾‹å­é‡Œç”¨çš„éƒ½æ˜¯ä¸ä¼ çš„ï¼Œç”¨çš„æ˜¯å…¶å†…éƒ¨çš„ForkJoinPool.commonPool()ã€‚ CompletableFutureçš„ç”¨æ³•è¿˜æœ‰å¾ˆå¤šå¾ˆå¤šï¼Œè¾ƒå¸¸ç”¨çš„åº”è¯¥å°±æ˜¯ä¾‹å­é‡Œçš„å‡ ç§ï¼Œæ›´å¤šçš„ç”¨æ³•ä»¥åä¼šç»§ç»­è®°å½•åˆ°è¿™é‡Œã€‚","link":"/2019/03/14/%E5%88%A9%E7%94%A8CompletableFuture%E4%BC%98%E5%8C%96%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%89%A7%E8%A1%8C%E6%95%88%E7%8E%87/"},{"title":"å›¾è§£javaå¤šçº¿ç¨‹è®¾è®¡æ¨¡å¼ï¼ˆäºŒï¼‰","text":"ä¸€ã€join &amp; interruptè¿™ä¿©æ–¹æ³•å±äºçº¿ç¨‹å¯¹è±¡é‡Œçš„æ–¹æ³•ï¼Œå±äºçº¿ç¨‹æœ¬èº«çš„æ“ä½œã€‚ 1.1ï¼šjoinæ–¹æ³•ç”¨äºç­‰å¾…ä¸€ä¸ªçº¿ç¨‹çš„ç»ˆæ­¢ï¼Œç­‰å¾…æœŸé—´å°†ä¼šé˜»å¡ï¼Œç›´åˆ°è¢«ç­‰å¾…çš„çº¿ç¨‹ç»ˆæ­¢ç»“æŸã€‚ æ‰€ä»¥joinå¯ä»¥ç”¨æ¥åšå¤šä»»åŠ¡å¼‚æ­¥å¤„ç†ï¼Œæ¯”å¦‚è¿˜æ˜¯æ‹¿åˆ©ç”¨CompletableFutureä¼˜åŒ–ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡è¿™ç¯‡é‡Œçš„ç¬¬ä¸€ä¸ªä¾‹å­åšä¼˜åŒ–ï¼Œè¿™ç¯‡æ–‡ç« é‡Œä½¿ç”¨çº¿ç¨‹æ± çš„futureæ¨¡å¼è¿›è¡Œå¤šä»»åŠ¡å¼‚æ­¥å¤„ç†ï¼Œç°åœ¨ä½¿ç”¨joinæ”¹å†™ä¸‹ï¼š å†æ¥ç®€å•è´´ä¸‹è¿™å‡ ä¸ªæ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132333435private String getTop() { // è¿™é‡Œå‡è®¾getTopéœ€è¦æ‰§è¡Œ200ms try { Thread.sleep(200L); } catch (InterruptedException e) { e.printStackTrace(); } return \"é¡¶éƒ¨bannerä½\"; } private String getLeft() { // è¿™é‡Œå‡è®¾getLeftéœ€è¦æ‰§è¡Œ50ms try { Thread.sleep(50L); } catch (InterruptedException e) { e.printStackTrace(); } return \"å·¦è¾¹æ \"; } private String getRight() { // è¿™é‡Œå‡è®¾getRightéœ€è¦æ‰§è¡Œ80ms try { Thread.sleep(80L); } catch (InterruptedException e) { e.printStackTrace(); } return \"å³è¾¹æ \"; } private String getUser() { // è¿™é‡Œå‡è®¾getUseréœ€è¦æ‰§è¡Œ100ms try { Thread.sleep(100L); } catch (InterruptedException e) { e.printStackTrace(); } return \"ç”¨æˆ·ä¿¡æ¯\"; } ä»£ç å—1 ç„¶åç°åœ¨ä½¿ç”¨ç®€å•çš„çº¿ç¨‹åšå¼‚æ­¥å¤„ç†ï¼š 123456789101112131415161718192021222324// ç®€å•å¼‚æ­¥è·å– public WebModule getWebModuleMsgSimpleAsync() throws ExecutionException, InterruptedException { WebModule webModule = new WebModule(); Thread topTask = new Thread(() -&gt; webModule.setTop(this.getTop())); Thread leftTask = new Thread(() -&gt; webModule.setLeft(this.getLeft())); Thread rightTask = new Thread(() -&gt; webModule.setRight(this.getRight())); Thread userTask = new Thread(() -&gt; webModule.setUser(this.getUser())); //è§¦å‘å„ä¸ªå¼‚æ­¥ä»»åŠ¡ topTask.start(); leftTask.start(); rightTask.start(); userTask.start(); //ç­‰å¾…æ‰€æœ‰çš„ä»»åŠ¡å‡æ‰§è¡Œå®Œæ¯• topTask.join(); leftTask.join(); rightTask.join(); userTask.join(); return webModule; } ä»£ç å—2 æµ‹è¯•ä»£ç ï¼š 12345678@Test public void testSimpleASync() throws Exception { // åŒæ­¥æ–¹æ³•æµ‹è¯•ï¼Œé¢„ä¼°è€—æ—¶200ms long start = System.currentTimeMillis(); WebModule module = webHome.getWebModuleMsgSimpleAsync(); System.out.println(\"é€šè¿‡å¼‚æ­¥æ–¹æ³•è·å–é¦–é¡µå…¨éƒ¨ä¿¡æ¯æ¶ˆè€—æ—¶é—´ï¼š\" + (System.currentTimeMillis() - start) + \"ms\"); System.out.println(\"ç»“æœä¸ºï¼š\" + module.toString()); } ä»£ç å—3 æµ‹è¯•ç»“æœï¼š 12é€šè¿‡å¼‚æ­¥æ–¹æ³•è·å–é¦–é¡µå…¨éƒ¨ä¿¡æ¯æ¶ˆè€—æ—¶é—´ï¼š272msç»“æœä¸ºï¼štop: é¡¶éƒ¨bannerä½; left: å·¦è¾¹æ ; right: å³è¾¹æ ; user: ç”¨æˆ·ä¿¡æ¯ æ¯”é¢„ä¼°çš„è¦å¤š72msï¼Œç»è¿‡åæ¥çš„æµ‹è¯•ï¼Œå‘ç°è¿™72msè€—æ—¶å‘ç”Ÿåœ¨çº¿ç¨‹åˆ›å»ºçš„æ—¶å€™ï¼Œä»¥åŠåç»­çº¿ç¨‹çŠ¶æ€è½¬æ¢å¸¦æ¥çš„æ¶ˆè€—ï¼Œä¸‹é¢ç­‰å¾…å¼‚æ­¥ç»“æŸçš„æ—¶é—´çº¦ç­‰äº200msï¼Œç¬¦åˆé¢„æœŸã€‚ 1.2ï¼šinterruptæ–¹æ³•ç”¨äºä¸»åŠ¨ç»ˆæ­¢ä¸€ä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹æœ¬èº«è°ƒç”¨è¯¥æ–¹æ³•åï¼Œè§†ä¸ºå·²ç»ˆæ­¢çŠ¶æ€ï¼Œjoinè§£é™¤é˜»å¡ï¼Œä¸‹é¢æ¥ç”¨interruptå’Œjoinæ¥åšä¸ªå®éªŒï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445public class JoinTest { private boolean isStop = false; public static void main(String[] args) throws Exception { JoinTest test = new JoinTest(); Thread loopT = new Thread(test::loopTask); loopT.start(); sleep(2000L); //2såç»ˆæ­¢çº¿ç¨‹ test.setStop(true); long s = System.currentTimeMillis(); loopT.join(); System.out.println(\"çº¿ç¨‹ç»ˆæ­¢åï¼Œjoiné˜»å¡æ—¶é—´ä¸ºï¼š\" + (System.currentTimeMillis() - s)); System.out.println(\"end~\"); } public void setStop(boolean stop) { isStop = stop; } public void loopTask() { while (!isStop) { //è‹¥çŠ¶æ€ä¸ºfalseï¼Œåˆ™ç»§ç»­æ‰§è¡Œä¸‹é¢çš„é€»è¾‘ï¼Œæ¯éš”1sæ‰“å°ä¸€æ¬¡ sleep(1000L); System.out.println(\"loop trigger ~\"); } Thread.currentThread().interrupt(); //åœ¨è¿™é‡Œç»ˆæ­¢æ‰å½“å‰çº¿ç¨‹ //äº‹å®ä¸Šï¼Œåœ¨ç»ˆæ­¢æ‰çº¿ç¨‹åï¼Œè¿˜æœ‰æ¥ä¸‹æ¥çš„é€»è¾‘è¦æ‰§è¡Œ long s = System.currentTimeMillis(); for (int i = 0; i &lt; 1000000; i++) { int[] a = new int[100]; //æ¨¡æ‹Ÿè€—æ—¶æ“ä½œï¼Œè¿™é‡Œä¸èƒ½ç”¨sleepäº†ï¼Œå› ä¸ºå½“å‰çº¿ç¨‹å·²ç»è¢«ç»ˆæ­¢äº† } System.out.println(\"çº¿ç¨‹ç»ˆæ­¢åï¼Œé€»è¾‘å—è¿è¡Œæ—¶é—´ï¼š\" + (System.currentTimeMillis() - s)); } public static void sleep(long time) { try { Thread.sleep(time); } catch (InterruptedException e) { e.printStackTrace(); } }} ä»£ç å—4 æ‰§è¡Œç»“æœï¼š 12345loop trigger ~loop trigger ~çº¿ç¨‹ç»ˆæ­¢åï¼Œé€»è¾‘å—è¿è¡Œæ—¶é—´ï¼š129çº¿ç¨‹ç»ˆæ­¢åï¼Œjoiné˜»å¡æ—¶é—´ä¸ºï¼š129end~ å³ä¾¿çº¿ç¨‹è¢«ç»ˆæ­¢äº†ï¼Œåé¢çš„é€»è¾‘ä¹Ÿä¼šè§¦å‘ï¼Œjoinä¾æ—§ä¼šé€‰æ‹©é˜»å¡ï¼Œç›´åˆ°åç»­é€»è¾‘æ‰§è¡Œå®Œæ¯•ï¼Œäº‹å®ä¸Šï¼Œå¤§éƒ¨åˆ†ä»»åŠ¡éƒ½å¯ä»¥åŠæ—¶çš„ç»ˆæ­¢ï¼Œæ¯”å¦‚ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œå¼‚æ­¥å‡ºå»çš„ä»»åŠ¡ï¼Œæœ€ç»ˆéƒ½ä¼šæ‰§è¡Œå®Œæˆï¼Œçº¿ç¨‹å˜ä¸ºç»ˆæ­¢çŠ¶æ€ï¼Œjoinéƒ½å¯ä»¥é¡ºåˆ©ç»“æŸï¼Œä½†æ˜¯åè§‚ä¸Šä¾‹ï¼Œå¦‚æœæ²¡äººåŠæ—¶çš„è®¾ç½®isStopçš„å€¼ï¼Œç¨‹åºä¼šä¸€ç›´æ‰§è¡Œä¸‹å»ï¼Œæ²¡æœ‰ç»ˆæ­¢æ€ï¼Œjoinä¼šæ— æ­¢å¢ƒçš„ç»ˆæ­¢ä¸‹å»ï¼Œè¿™é‡Œæä¸€ä¸‹stopï¼Œçº¿ç¨‹çš„stopæ–¹æ³•å·²è¢«å®˜æ–¹æ ‡è®°ä¸ºä¸å»ºè®®ä½¿ç”¨çš„æ–¹æ³•ï¼Œå¦‚æœæŠŠä¸Šä¾‹çš„interruptçš„è°ƒç”¨æ¢æˆstopï¼Œæ¥çœ‹çœ‹å…¶è¿è¡Œç»“æœï¼š 1234loop trigger ~loop trigger ~çº¿ç¨‹ç»ˆæ­¢åï¼Œjoiné˜»å¡æ—¶é—´ä¸ºï¼š0end~ å¯ä»¥çœ‹åˆ°ï¼Œçº¿ç¨‹ç»ˆæ­¢åçš„åç»­é€»è¾‘å‡æ²¡æœ‰è§¦å‘ï¼Œç­‰äºè¯´stopæ˜¯ä¸€ç§å¾ˆç²—æš´çš„ç»ˆæ­¢çº¿ç¨‹çš„æ–¹å¼ï¼Œä¸€æ—¦è¢«stopï¼Œé‚£ä¹ˆé‡Œé¢çš„ä¸šåŠ¡é€»è¾‘å°†ç›´æ¥æ–­æ‰ï¼Œå› æ­¤å®˜æ–¹å¹¶ä¸æ¨èä½¿ç”¨è¯¥æ–¹æ³•æ¥ç»ˆæ­¢çº¿ç¨‹ã€‚ è€Œinterruptï¼Œä»…ä»…æ˜¯å¯¹ç›®æ ‡çº¿ç¨‹å‘é€äº†äº†ä¸€ä¸ªä¸­æ–­ä¿¡å·ï¼ˆæ”¹å˜äº†çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€è€Œå·²ï¼‰ï¼Œå½“ç›®æ ‡çº¿ç¨‹å†æ¬¡é€šè¿‡obj.waitã€thread.sleepã€thread.joinæ–¹æ³•è¿›å…¥é˜»å¡çŠ¶æ€æ—¶ï¼Œæ¥æ”¶åˆ°è¯¥ä¿¡å·ï¼Œå°±ä¼šæŠ›å‡ºInterruptedExceptionå¼‚å¸¸ï¼Œè¿™æ—¶å€™éœ€è¦ä¸šåŠ¡æ–¹è‡ªè¡Œå¤„ç†æˆ–è€…ç›´æ¥æŠ›å‡ºï¼Œä»¥ç»“æŸçº¿ç¨‹é˜»å¡çŠ¶æ€ï¼ˆè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯è¢«obj.waitæ–¹æ³•é˜»å¡æ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸éœ€è¦ç›®æ ‡çº¿ç¨‹å†æ¬¡è·å¾—å®ä¾‹å¯¹è±¡objçš„é”æ‰è¡Œï¼‰ã€‚ ä¸Šè¿°ä¸‰ä¸ªéœ€è¦èŠ±è´¹æ—¶é—´çš„æ–¹æ³•å‡æŠ›å‡ºäº†InterruptedExceptionå¼‚å¸¸ï¼Œé’ˆå¯¹è¿™äº›ç‰¹æ€§ï¼Œæƒ³è¦å®Œæˆä»¥ä¸‹æ“ä½œå°±éå¸¸æ–¹ä¾¿äº†ï¼š å–æ¶ˆwaitæ–¹æ³•ç­‰å¾…notify/notifyAllçš„å¤„ç† å–æ¶ˆåœ¨sleepæ–¹æ³•æŒ‡å®šæ—¶é—´å†…åœæ­¢çš„å¤„ç† å–æ¶ˆjoinæ–¹æ³•ç­‰å¾…å…¶ä»–çº¿ç¨‹ç»ˆæ­¢çš„å¤„ç† å–æ¶ˆä¹‹åæ‰€åšçš„å¤„ç†ï¼Œå–å†³äºéœ€æ±‚ï¼Œå¯èƒ½ä¼šç»ˆæ­¢çº¿ç¨‹ï¼Œæˆ–è€…é€šçŸ¥ç”¨æˆ·å·²å–æ¶ˆï¼Œæˆ–è€…ç»ˆæ­¢å½“å‰å¤„ç†è¿›å…¥ä¸‹ä¸€ä¸ªå¤„ç†é˜¶æ®µã€‚ äºŒã€çº¿ç¨‹çŠ¶æ€è¿ç§»å›¾ ä¸Šé¢çš„å›¾å±•ç¤ºå‡ºæ¥çš„çŠ¶æ€å¤ªå¤šå¤ªæ‚ï¼ŒåŸå› æ˜¯å®ƒååº”çš„æ˜¯jvmé‡Œçº¿ç¨‹çš„çŠ¶æ€è¿ç§»ï¼Œå¦‚æœæ¢ç®—æˆå®é™…å¯¹æ“ä½œç³»ç»Ÿå±‚é¢çš„çº¿ç¨‹çš„å½±å“ï¼ŒçŠ¶æ€åˆ™å°‘å¾—å¤šï¼Œè‡³å°‘æ— è®ºæ˜¯TIMED_WAITINGè¿˜æ˜¯BLOCKEDï¼Œå¯¹åº”åˆ°æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹èº«ä¸Šï¼Œé‚£å°±æ˜¯é˜»å¡ï¼ˆæˆ–ç§°ç­‰å¾…ï¼ŒWAITï¼‰ï¼Œç°åœ¨å°±æ“ä½œç³»ç»Ÿå±‚é¢çº¿ç¨‹çŠ¶æ€å˜åŒ–æ¥ç®€åŒ–ä¸€ä¸‹ä¸Šé¢çš„çŠ¶æ€è¿ç§»å›¾ï¼š è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯ï¼ŒJVMé‡Œçš„çº¿ç¨‹æœ¬è´¨ä¸Šå°±æ˜¯æ“ä½œç³»ç»Ÿé‡Œçš„çº¿ç¨‹ï¼Œå›¾1æ˜¯å‘Šè¯‰ä½ JVMé‡Œçº¿ç¨‹çš„çŠ¶æ€æœ‰å¤šå°‘ç§ï¼Œå…¶å®å°±æ˜¯æŒ‰ç…§å„ç§å½±å“çº¿ç¨‹çš„æ–¹æ³•ï¼ˆjoinã€waitã€notifyç­‰ï¼‰è¿›è¡Œäº†ç»†åˆ†ï¼Œè€Œå›¾2åˆ™å±•ç¤ºå‡ºäº†æ“ä½œç³»ç»Ÿå±‚é¢ä¸Šçš„çº¿ç¨‹çŠ¶æ€ï¼Œä¸Šé¢ä¹Ÿè¯´è¿‡ï¼Œå…¶å®æ— è®ºæ˜¯ç”±joinå¯¼è‡´çš„çº¿ç¨‹é˜»å¡ï¼Œè¿˜æ˜¯waitå¯¼è‡´çš„çº¿ç¨‹é˜»å¡ï¼Œå¯¹äºå®é™…çš„çº¿ç¨‹å½±å“æ€§è´¨éƒ½æ˜¯ä¸€æ ·çš„ï¼Œé‚£å°±æ˜¯é™·å…¥ç­‰å¾…ã€‚","link":"/2019/03/13/%E5%9B%BE%E8%A7%A3java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88%E4%BA%8C%EF%BC%89/"},{"title":"Java NIOå­¦ä¹ ä¸è®°å½•ï¼ˆå››ï¼‰ï¼š SocketChannelä¸BIOæœåŠ¡å™¨","text":"SocketChannelå¯ä»¥åˆ›å»ºè¿æ¥TCPæœåŠ¡çš„å®¢æˆ·ç«¯ï¼Œç”¨äºä¸ºæœåŠ¡å‘é€æ•°æ®ï¼ŒSocketChannelçš„å†™æ“ä½œå’Œè¿æ¥æ“ä½œåœ¨éé˜»å¡æ¨¡å¼ä¸‹ä¸ä¼šå‘ç”Ÿé˜»å¡ï¼Œè¿™ç¯‡æ–‡ç« é‡Œçš„å®¢æˆ·ç«¯é‡‡ç”¨SocketChannelå®ç°ï¼Œåˆ©ç”¨çº¿ç¨‹æ± æ¨¡æ‹Ÿå¤šä¸ªå®¢æˆ·ç«¯å¹¶å‘è®¿é—®æœåŠ¡ç«¯çš„æƒ…æ™¯ã€‚æœåŠ¡ç«¯ä»ç„¶é‡‡ç”¨ServerSocketæ¥å®ç°ï¼Œä¸»è¦ç”¨æ¥çœ‹ä¸‹é˜»å¡æ¨¡å¼ä¸‹çš„æœåŠ¡ç«¯åœ¨å¹¶å‘è®¿é—®æ—¶æ‰€åšå‡ºçš„çš„å¤„ç†ã€‚ ä¸€ã€ä½¿ç”¨SocketChannelå®ç°ä¸€ä¸ªå®¢æˆ·ç«¯1234567891011121314151617181920212223242526272829303132333435363738394041424344private static ExecutorService ctp = Executors.newCachedThreadPool(); public static void main(String[] args) { for (int i = 0; i &lt; 10; i++) { ctp.submit(IOTest::client); //å¹¶å‘åä¸ªå®¢æˆ·ç«¯è¿æ¥è¿‡å» } } public static void client() { ByteBuffer buffer = ByteBuffer.allocate(1024); //å®šä¹‰ç¼“å†²åŒº SocketChannel socketChannel = null; try { socketChannel = SocketChannel.open(); //æ‰“å¼€SocketChannel socketChannel.configureBlocking(false); //è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ socketChannel.connect(new InetSocketAddress(\"127.0.0.1\", 2333)); //è¿æ¥æœåŠ¡ while (true) { if(socketChannel.finishConnect()){ //è¿™é‡Œçš„finishConnectæ˜¯å°è¯•è¿æ¥ï¼Œæœ‰å¯èƒ½è¿”å›falseï¼Œå› æ­¤ä½¿ç”¨æ­»å¾ªç¯è¿›è¡Œè¿æ¥æ£€æŸ¥ï¼Œç¡®ä¿è¿æ¥å·²ç»æ­£å¸¸å»ºç«‹ã€‚ System.out.println(\"å®¢æˆ·ç«¯å·²è¿æ¥åˆ°æœåŠ¡å™¨\"); int i = 0; while (i &lt; 5) { TimeUnit.SECONDS.sleep(1); //éš”ä¸€ç§’é’Ÿå†™ä¸€æ¡ String info = \"æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬\" + (i++) + \"æ¡æ¶ˆæ¯\"; buffer.clear(); buffer.put(info.getBytes()); buffer.flip(); while (buffer.hasRemaining()) { socketChannel.write(buffer); //ç»™æœåŠ¡å†™æ¶ˆæ¯ } } break; } } } catch (IOException | InterruptedException e) { e.printStackTrace(); } finally { try { if (socketChannel != null) { System.out.println(\"å®¢æˆ·ç«¯Channelå…³é—­\"); socketChannel.close(); } } catch (IOException e) { e.printStackTrace(); } } ä»£ç å—1 ä¸Šé¢ä¼šåŒæ—¶äº§ç”Ÿ10ä¸ªå®¢æˆ·ç«¯å»è¿æ¥æœåŠ¡ç«¯ äºŒã€ä½¿ç”¨ServerSocketå®ç°ä¸€ä¸ªBIOçš„TCPæœåŠ¡12345678910111213141516171819202122232425262728293031323334ServerSocket serverSocket = null; int recvMsgSize = 0; InputStream in = null; try { serverSocket = new ServerSocket(2333); //å¼€ä¸€ä¸ªç›‘å¬2333ç«¯å£çš„TCPæœåŠ¡ byte[] recvBuf = new byte[1024]; while (true) { Socket clntSocket = serverSocket.accept(); //æ¢å¬æœ‰æ²¡æœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥è¿›æ¥ï¼Œæ²¡æœ‰å°±é˜»å¡ SocketAddress clientAddress = clntSocket.getRemoteSocketAddress(); //é€šè¿‡è·ŸæœåŠ¡è¿æ¥ä¸Šçš„å®¢æˆ·ç«¯socketï¼Œæ‹¿åˆ°å®¢æˆ·ç«¯åœ°å€ System.out.println(\"è¿æ¥æˆåŠŸï¼Œå¤„ç†å®¢æˆ·ç«¯ï¼š\" + clientAddress); in = clntSocket.getInputStream(); //æ•°æ®æµ while ((recvMsgSize = in.read(recvBuf)) != -1) { //è¯»å–å‘é€çš„æ•°æ®ï¼Œå½“å®¢æˆ·ç«¯æœªæ–­å¼€è¿æ¥ï¼Œä¸”ä¸å¾€æœåŠ¡ç«¯å‘æ•°æ®çš„æ—¶å€™ï¼Œè¯´æ˜ä¸€ç›´å¤„äºå‡†å¤‡è¯»çš„çŠ¶æ€ï¼Œä¼šä¸€ç›´é˜»å¡ä¸‹å»ï¼Œç›´åˆ°æœ‰æ•°æ®å†™å…¥ï¼ˆè¯»å°±ç»ªï¼‰ byte[] temp = new byte[recvMsgSize]; System.arraycopy(recvBuf, 0, temp, 0, recvMsgSize); System.out.println(\"æ”¶åˆ°å®¢æˆ·ç«¯\" + clientAddress + \"çš„æ¶ˆæ¯å†…å®¹ï¼š\" + new String(temp)); //æ‰“å°æ¶ˆæ¯ } System.out.println(\"-----------------------------------\"); } } catch (IOException e) { e.printStackTrace(); } finally { try { if (serverSocket != null) { System.out.println(\"socketå…³é—­ï¼\"); serverSocket.close(); } if (in != null) { System.out.println(\"streamè¿æ¥å…³é—­ï¼\"); in.close(); } } catch (IOException e) { e.printStackTrace(); } } ä»£ç å—2 è¿è¡Œä¸Šé¢çš„ä»£ç ï¼ŒæœåŠ¡ç«¯æ‰“å°å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334è¿æ¥æˆåŠŸï¼Œå¤„ç†å®¢æˆ·ç«¯ï¼š/127.0.0.1:54688æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:54688çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬0æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:54688çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬1æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:54688çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬2æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:54688çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬3æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:54688çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬4æ¡æ¶ˆæ¯-----------------------------------è¿æ¥æˆåŠŸï¼Œå¤„ç†å®¢æˆ·ç«¯ï¼š/127.0.0.1:54680æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:54680çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬0æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬1æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬2æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬3æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬4æ¡æ¶ˆæ¯-----------------------------------è¿æ¥æˆåŠŸï¼Œå¤„ç†å®¢æˆ·ç«¯ï¼š/127.0.0.1:54689æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:54689çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬0æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬1æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬2æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬3æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬4æ¡æ¶ˆæ¯-----------------------------------è¿æ¥æˆåŠŸï¼Œå¤„ç†å®¢æˆ·ç«¯ï¼š/127.0.0.1:54682æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:54682çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬0æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬1æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬2æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬3æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬4æ¡æ¶ˆæ¯-----------------------------------è¿æ¥æˆåŠŸï¼Œå¤„ç†å®¢æˆ·ç«¯ï¼š/127.0.0.1:54683æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:54683çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬0æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬1æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬2æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬3æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬4æ¡æ¶ˆæ¯-----------------------------------è¿æ¥æˆåŠŸï¼Œå¤„ç†å®¢æˆ·ç«¯ï¼š/127.0.0.1:54684æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:54684çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬0æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬1æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬2æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬3æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬4æ¡æ¶ˆæ¯-----------------------------------è¿æ¥æˆåŠŸï¼Œå¤„ç†å®¢æˆ·ç«¯ï¼š/127.0.0.1:54685æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:54685çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬0æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬1æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬2æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬3æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬4æ¡æ¶ˆæ¯-----------------------------------è¿æ¥æˆåŠŸï¼Œå¤„ç†å®¢æˆ·ç«¯ï¼š/127.0.0.1:54681æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:54681çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬0æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬1æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬2æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬3æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬4æ¡æ¶ˆæ¯-----------------------------------è¿æ¥æˆåŠŸï¼Œå¤„ç†å®¢æˆ·ç«¯ï¼š/127.0.0.1:54686æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:54686çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬0æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬1æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬2æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬3æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬4æ¡æ¶ˆæ¯-----------------------------------è¿æ¥æˆåŠŸï¼Œå¤„ç†å®¢æˆ·ç«¯ï¼š/127.0.0.1:54687æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:54687çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬0æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬1æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬2æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬3æ¡æ¶ˆæ¯æ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬4æ¡æ¶ˆæ¯----------------------------------- å¯ä»¥çœ‹åˆ°ï¼Œæ¶ˆæ¯æ˜¯æŒ‰ç…§é¡ºåºï¼Œä¸€ä¸ªä¸€ä¸ªè¿æ¥è¿›æ¥ï¼Œç„¶åå®Œæˆå¤„ç†çš„ï¼Œè‡³äºåé¢çš„æ¶ˆæ¯ä¸ºä»€ä¹ˆä¼šè¢«åˆå¹¶æˆä¸€ä¸ªï¼Œä¹Ÿæ˜¯è¿™ä¸ªåŸå› ï¼Œå› ä¸ºé˜»å¡ï¼Œæ‰€ä»¥ç­‰ç¬¬ä¸€ä¸ªè¿æ¥é€æ¡è¾“å‡ºå®Œæˆåï¼Œç¬¬äºŒä¸ªè¿æ¥è¿›æ¥ï¼Œè¿™æ—¶å¾ˆå¯èƒ½å®¢æˆ·ç«¯çš„SocketChannelå·²ç»å°†åæ¡æ¶ˆæ¯å…¨éƒ¨å†™å…¥channelï¼Œç­‰ç¬¬ä¸€ä¸ªè¿æ¥å¤„ç†å®Œæˆåï¼Œæ¥åˆ°ç¬¬äºŒæ¡æ¶ˆæ¯æ—¶å°±å·²ç»æ˜¯å…¨éƒ¨çš„æ¶ˆæ¯äº†ï¼Œå› æ­¤ä¸€æ¬¡æ€§è¾“å‡ºï¼Œåé¢çš„åˆå¹¶ä¹Ÿæ˜¯è¿™ä¸ªåŸå› ï¼ˆä¸»è¦å®¢æˆ·ç«¯ä½¿ç”¨NIOå®ç°ï¼Œå› æ­¤å†™å’Œè¿æ¥æœåŠ¡ä¸ä¼šå‘ç”Ÿé˜»å¡ï¼Œå› æ­¤åœ¨ç¬¬æ¬¡ä¸ªè¯·æ±‚æœåŠ¡ç«¯è¿˜åœ¨å¤„ç†æ—¶ï¼Œå…¶ä½™çš„å®¢æˆ·ç«¯æ•°æ®ä¹Ÿåœ¨æ‰§è¡Œå¹¶å†™å…¥é€šé“ï¼Œæœ€ç»ˆæœåŠ¡ç«¯å¤„ç†å®Œç¬¬ä¸€ä¸ªè¿æ¥ï¼Œç„¶åç»§ç»­æ¥æ”¶ç¬¬äºŒä¸ªè¿æ¥æ—¶ï¼Œæ•°æ®ä¾¿æ˜¯å®Œæ•´çš„5æ¡æ•°æ®äº†ï¼‰ã€‚ ä¸Šé¢çš„æœåŠ¡ç«¯æ˜¯ä¸€ä¸ªå…¸å‹çš„é˜»å¡IOçš„æœåŠ¡ï¼Œacceptåœ¨æ²¡æœ‰è¿æ¥è¿›æ¥æ—¶ä¼šå‘ç”Ÿé˜»å¡ï¼Œreadåœ¨å®¢æˆ·ç«¯è¿æ¥æ²¡å…³é—­ï¼Œä¸”ä¸å†å†™æ¶ˆæ¯æ—¶ï¼ŒæœåŠ¡ç«¯çš„readå°†ä¸€ç›´å¤„äºè¯»ç­‰å¾…çŠ¶æ€å¹¶é˜»å¡ï¼Œç›´åˆ°æ”¶åˆ°æ–°çš„æ¶ˆæ¯è½¬ä¸ºè¯»å°±ç»ªæ‰ä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼ˆè¿™å°±æ˜¯ä¸Šé¢ä¾‹å­é‡Œç¬¬ä¸€ä¸ªè¿›æ¥çš„è¿æ¥å¯ä»¥é€æ¡è¾“å‡ºçš„åŸå› ï¼‰ï¼Œå®Œå…¨ä¸²è¡ŒåŒ–ï¼Œè¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š ä¸‹é¢ï¼Œæ¥æ”¹é€ ä¸‹æœåŠ¡ç«¯ï¼Œè®©å…¶å¤„ç†èƒ½åŠ›æ›´å¥½ä¸€äº›ï¼Œé™¤äº†acceptï¼Œä¸‹é¢çš„å¤„ç†é€»è¾‘å…¨éƒ¨äº¤ç»™çº¿ç¨‹æ± å¤„ç†ï¼š 1234567891011121314151617181920212223while (true) { Socket clntSocket = serverSocket.accept(); //æ¢å¬æœ‰æ²¡æœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥è¿›æ¥ï¼Œæ²¡æœ‰å°±é˜»å¡ SocketAddress clientAddress = clntSocket.getRemoteSocketAddress(); //é€šè¿‡è·ŸæœåŠ¡è¿æ¥ä¸Šçš„å®¢æˆ·ç«¯socketï¼Œæ‹¿åˆ°å®¢æˆ·ç«¯åœ°å€ System.out.println(\"è¿æ¥æˆåŠŸï¼Œå¤„ç†å®¢æˆ·ç«¯ï¼š\" + clientAddress); ctp.execute(() -&gt; { int recvMsgSize = 0; InputStream in = null; //æ•°æ®æµ try { in = clntSocket.getInputStream(); while ((recvMsgSize = in.read(recvBuf)) != -1) { //è¯»å–å‘é€çš„æ•°æ®ï¼Œå½“å®¢æˆ·ç«¯æœªæ–­å¼€è¿æ¥ï¼Œä¸”ä¸å¾€æœåŠ¡ç«¯å‘æ•°æ®çš„æ—¶å€™ï¼Œè¯´æ˜ä¸€ç›´å¤„äºå‡†å¤‡è¯»çš„çŠ¶æ€ï¼Œä¼šä¸€ç›´é˜»å¡ä¸‹å»ï¼Œç›´åˆ°æœ‰æ•°æ®å†™å…¥ï¼ˆè¯»å°±ç»ªï¼‰ byte[] temp = new byte[recvMsgSize]; System.arraycopy(recvBuf, 0, temp, 0, recvMsgSize); System.out.println(\"æ”¶åˆ°å®¢æˆ·ç«¯\" + clientAddress + \"çš„æ¶ˆæ¯å†…å®¹ï¼š\" + new String(temp)); //æ‰“å°æ¶ˆæ¯ } System.out.println(\"-----------------------------------\"); } catch (IOException e) { e.printStackTrace(); } }); } ä»£ç å—3 è¿è¡Œç»“æœï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970è¿æ¥æˆåŠŸï¼Œå¤„ç†å®¢æˆ·ç«¯ï¼š/127.0.0.1:55259è¿æ¥æˆåŠŸï¼Œå¤„ç†å®¢æˆ·ç«¯ï¼š/127.0.0.1:55265è¿æ¥æˆåŠŸï¼Œå¤„ç†å®¢æˆ·ç«¯ï¼š/127.0.0.1:55266è¿æ¥æˆåŠŸï¼Œå¤„ç†å®¢æˆ·ç«¯ï¼š/127.0.0.1:55257è¿æ¥æˆåŠŸï¼Œå¤„ç†å®¢æˆ·ç«¯ï¼š/127.0.0.1:55260è¿æ¥æˆåŠŸï¼Œå¤„ç†å®¢æˆ·ç«¯ï¼š/127.0.0.1:55258è¿æ¥æˆåŠŸï¼Œå¤„ç†å®¢æˆ·ç«¯ï¼š/127.0.0.1:55261è¿æ¥æˆåŠŸï¼Œå¤„ç†å®¢æˆ·ç«¯ï¼š/127.0.0.1:55262è¿æ¥æˆåŠŸï¼Œå¤„ç†å®¢æˆ·ç«¯ï¼š/127.0.0.1:55263è¿æ¥æˆåŠŸï¼Œå¤„ç†å®¢æˆ·ç«¯ï¼š/127.0.0.1:55264æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55265çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬0æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55266çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬0æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55258çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬0æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55257çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬0æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55261çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬0æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55262çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬0æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55263çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬0æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55260çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬0æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55259çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬0æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55264çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬0æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55265çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬1æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55266çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬1æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55258çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬1æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55257çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬1æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55261çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬1æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55260çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬1æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55262çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬1æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55263çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬1æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55259çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬1æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55264çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬1æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55266çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬2æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55262çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬2æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55261çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬2æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55260çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬2æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55263çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬2æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55257çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬2æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55265çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬2æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55258çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬2æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55259çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬2æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55264çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬2æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55258çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬3æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55266çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬3æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55257çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬3æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55262çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬3æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55261çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬3æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55263çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬3æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55265çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬3æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55260çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬3æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55264çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬3æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55259çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬3æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55266çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬4æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55265çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬4æ¡æ¶ˆæ¯-----------------------------------æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55263çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬4æ¡æ¶ˆæ¯æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55261çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬4æ¡æ¶ˆæ¯-----------------------------------æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55260çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬4æ¡æ¶ˆæ¯-----------------------------------æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55262çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬4æ¡æ¶ˆæ¯-----------------------------------æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55257çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬4æ¡æ¶ˆæ¯----------------------------------------------------------------------æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55258çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬4æ¡æ¶ˆæ¯----------------------------------------------------------------------æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55264çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬4æ¡æ¶ˆæ¯-----------------------------------æ”¶åˆ°å®¢æˆ·ç«¯/127.0.0.1:55259çš„æ¶ˆæ¯å†…å®¹ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„ç¬¬4æ¡æ¶ˆæ¯----------------------------------- æ¶ˆæ¯è¢«åˆ†å¼€äº†ï¼Œæ¥æ”¶è¿æ¥è™½ç„¶ä»ç„¶æ˜¯ä¸²è¡Œï¼Œä½†å®é™…çš„å¤„ç†é€Ÿåº¦åœ¨å¤šçº¿ç¨‹çš„å¸®åŠ©ä¸‹å·²ç»æ¯”ä¹‹å‰å¿«å¾ˆå¤šäº†ï¼Œæµç¨‹å¦‚ä¸‹å›¾ï¼š ä¸‰ã€BIOæ€»ç»“ç»¼åˆçœ‹ä¸‹æ¥ï¼Œä¼ ç»Ÿçš„é˜»å¡IOï¼ŒæŒ‰ç…§å›¾2çš„æ–¹å¼è¿›è¡Œï¼Œè™½ç„¶åˆ©ç”¨å¤šçº¿ç¨‹é¿å…äº†readç­‰æ“ä½œçš„é˜»å¡å¯¹acceptçš„å½±å“ï¼Œæé«˜äº†å¤„ç†æ•ˆç‡ï¼Œä½†æƒ³è±¡ä¸‹ï¼Œå¦‚æœç°åœ¨å­˜åœ¨é«˜å¹¶å‘çš„æƒ…å†µï¼Œå›¾2çš„æ¨¡å‹å¦‚æœä¸ä½¿ç”¨çº¿ç¨‹æ± ï¼Œå°±ä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œä¼šå‘ç”Ÿå¤§é‡çš„çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå½±å“æ•´ä½“æ•ˆç‡ï¼Œå¹¶ä¸”ä¼šå½±å“æ–°çš„çº¿ç¨‹ï¼Œå¦‚æœä½¿ç”¨çº¿ç¨‹æ± ï¼Œè™½ç„¶æŸç§ç¨‹åº¦ä¸Šé¿å…äº†çº¿ç¨‹çš„åˆ›å»ºå’Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„é‡çº§ï¼Œä½†æ˜¯åœ¨å¤§é‡å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œä¼šå‘ç”Ÿæ’é˜Ÿï¼Œä¸€æ—¦å‘ç”Ÿæ’é˜Ÿï¼Œç´§æ¥ç€å°±ä¼šå½±å“åˆ°acceptã€‚","link":"/2019/03/08/Java%20NIO%E5%AD%A6%E4%B9%A0%E4%B8%8E%E8%AE%B0%E5%BD%95%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9A%20SocketChannel%E4%B8%8EBIO%E6%9C%8D%E5%8A%A1%E5%99%A8/"},{"title":"Java NIOå­¦ä¹ ä¸è®°å½•ï¼ˆä¸‰ï¼‰ï¼š Scatter&Gatherä»‹ç»åŠä½¿ç”¨","text":"ä¸Šä¸€ç¯‡çŸ¥é“äº†Bufferçš„å·¥ä½œæœºåˆ¶ï¼Œä»¥åŠFileChannelçš„ç®€å•ç”¨æ³•ï¼Œè¿™ä¸€ç¯‡ä»‹ç»ä¸‹Scatter&amp;Gather 1.Scatterï¼ˆåˆ†æ•£ï¼‰ç”¨äºæè¿°åœ¨Channelä¸­è¯»å–çš„æ•°æ®åˆ†æ•£åœ¨ä¸åŒçš„Bufferé‡Œã€‚ æ¥ç€ä¸Šä¸€ç¯‡çš„ä¾‹å­ï¼ˆruaæ–‡ä»¶å†…å®¹ä¸º123456789ï¼‰ï¼Œæ”¹é€ ä¸‹ä»£ç ï¼š 1234567891011121314151617181920212223readFile = new RandomAccessFile(\"D:\\\\rua.txt\", \"r\");FileChannel readChannel = readFile.getChannel();ByteBuffer first = ByteBuffer.allocate(2); //ç¬¬ä¸€å—bufferByteBuffer second = ByteBuffer.allocate(2); //ç¬¬äºŒå—bufferByteBuffer[] byteBuffers = {first, second};long bytesRead = readChannel.read(byteBuffers); //ä»é€šé“é‡Œè¯»å–æ•°æ®åˆ°Bufferå†…ï¼ˆæœ€å¤§ä¸è¶…è¿‡Bufferå®¹ç§¯ï¼‰while (bytesRead != -1) { //å½“è¯»ä¸åˆ°ä»»ä½•ä¸œè¥¿æ—¶è¿”å›-1 System.out.println(\"\\nheaderé‡Œçš„æ•°æ®------æ­¤æ—¶byteRead=\" + bytesRead); first.flip(); //åˆ‡æ¢åˆ°Bufferè¯»æ¨¡å¼ï¼Œè¯»æ¨¡å¼ä¸‹å¯ä»¥è¯»å–åˆ°ä¹‹å‰å†™å…¥Bufferçš„æ•°æ® while (first.hasRemaining()) { System.out.print(\"-\" + (char) first.get()); //ç¬¬ä¸€å—Bufferè¯»å‡ºçš„æ•°æ®ç”¨å‡å·åˆ†å‰²ï¼Œç”¨äºè·Ÿç¬¬äºŒå—åŒºåˆ† } first.clear(); System.out.println(\"\\nbodyé‡Œçš„æ•°æ®------æ­¤æ—¶byteRead=\" + bytesRead); second.flip(); while (second.hasRemaining()) { System.out.print(\"+\" + (char) second.get()); //ç¬¬äºŒå—Bufferè¯»å‡ºçš„æ•°æ®ç”¨åŠ å·åˆ†å‰²ï¼Œç”¨äºè·Ÿç¬¬ä¸€å—åŒºåˆ† } second.clear(); // åˆ‡æ¢å›Bufferçš„å†™æ¨¡å¼ System.out.println(\"\\n----------------------------------------------\"); bytesRead = readChannel.read(byteBuffers); //è·Ÿä¸Šé¢ä¸€æ ·ï¼Œå†æ¬¡ä»é€šé“è¯»å–æ•°æ®åˆ°Bufferä¸­}System.out.print(\"\\n-----------ç¨‹åºç»“æŸ\"); ä»£ç å—1 ä¸Šé¢çš„ä»£ç å¼€äº†ä¸¤ä¸ªBufferï¼Œç„¶åä¼ ç»™äº†Channel.readä¸€ä¸ªBufferæ•°ç»„ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š 12345678910111213141516171819headeré‡Œçš„æ•°æ®------æ­¤æ—¶byteRead=4-1-2bodyé‡Œçš„æ•°æ®------æ­¤æ—¶byteRead=4+3+4----------------------------------------------headeré‡Œçš„æ•°æ®------æ­¤æ—¶byteRead=4-5-6bodyé‡Œçš„æ•°æ®------æ­¤æ—¶byteRead=4+7+8----------------------------------------------headeré‡Œçš„æ•°æ®------æ­¤æ—¶byteRead=1-9bodyé‡Œçš„æ•°æ®------æ­¤æ—¶byteRead=1---------------------------------------------------------ç¨‹åºç»“æŸ å¯ä»¥çœ‹åˆ°ï¼Œæ–‡ä»¶é‡Œçš„å†…å®¹è¢«åˆ†æ®µåŠ è½½å‡ºæ¥äº†ï¼Œfirst bufferé‡Œé¦–é€‰è¯»å–ä¸€æ®µï¼Œç„¶åæ¥ç€second bufferå†æ¥ç€è¯»å–æ¥ä¸‹æ¥çš„ä¸€æ®µã€‚ä¸Šé¢ä¾‹å­ç¬¦åˆScatterçš„æè¿°ã€‚ çœ‹è¿‡ç½‘ä¸Šä¸€äº›æ–‡ç« ï¼Œè¯´çš„æœ€å¤šçš„ä¾‹å­å°±æ˜¯åè®®å¤´æ•°æ®ä½“åˆ†å¼€å¤„ç†çš„ä¾‹å­ï¼š å‡è®¾é€šè¿‡Channelè·å–åˆ°çš„æ•°æ®å­˜åœ¨å›ºå®šé•¿åº¦çš„åè®®å¤´ï¼Œä»¥åŠå·²çŸ¥æœ€å¤§é•¿åº¦é™åˆ¶çš„æ•°æ®ä½“ï¼Œå°±å¯ä»¥é€šè¿‡ä¸¤ä¸ªBufferæ¥æ¥æ”¶ï¼Œä¸€ä¸ªæ˜¯header bufferï¼Œä¸€ä¸ªæ˜¯body bufferï¼Œ ä½†è¿™ä¸ªå¯¹æ•°æ®è¦æ±‚å¾ˆä¸¥è‹›ï¼Œç»“åˆä¸Šé¢çš„ä¾‹å­ï¼Œä¸éš¾å‘ç°ï¼Œæƒ³è¦åšåˆ°å‡†ç¡®æ— è¯¯çš„å¤„ç†è¿™ä¸ªä¾‹å­ï¼Œå°±å¾—è¦æ±‚äº‹å…ˆå¿…é¡»çŸ¥é“headerçš„é•¿åº¦ï¼Œä»¥åŠæ•°æ®ä½“çš„æœ€å¤§é•¿åº¦ä¸Šé™ï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·å‘¢ï¼Ÿå› ä¸ºå¦‚æœä¸çŸ¥é“headerçš„é•¿åº¦ï¼Œé‚£ä¹ˆheader bufferå°±å¯èƒ½ä¼šè¯»åˆ°body bufferé‡Œçš„ä¸œè¥¿æˆ–è€…body bufferé‡Œè¯»åˆ°header bufferé‡Œçš„ä¸œè¥¿ï¼Œå¦‚æœä¸çŸ¥é“bodyçš„ä¸Šé™é•¿åº¦ï¼Œé‚£ä¹ˆå¦‚æœbodyæ•°æ®é•¿åº¦è¶…è¿‡äº†body bufferçš„é•¿åº¦ï¼Œbodyé‡Œçš„æ•°æ®å°±ä¼šå†æ¬¡è¯»åˆ°header bufferä¸­å»ï¼ˆè¿™ä¸ªå¯ä»¥ç»“åˆä¸Šé¢çš„ä¾‹å­ç†è§£ï¼‰ã€‚ 2.Gatherï¼ˆèšé›†ï¼‰ç”¨äºæè¿°åœ¨å°†ä¸åŒBufferé‡Œçš„æ•°æ®å†™åˆ°åŒä¸€ä¸ªChannelä¸­å»ã€‚ æ¥çœ‹ä¸ªä¾‹å­ï¼š 1234567891011readFile = new RandomAccessFile(\"D:\\\\haha.txt\", \"rw\");FileChannel channel = readFile.getChannel();ByteBuffer first = ByteBuffer.allocate(5); //ç¬¬ä¸€å—bufferByteBuffer second = ByteBuffer.allocate(5); //ç¬¬äºŒå—bufferfirst.put(\"aa\".getBytes());second.put(\"bb\".getBytes());first.flip();second.flip();ByteBuffer[] byteBuffers = {first, second};channel.write(byteBuffers);System.out.print(\"\\n-----------ç¨‹åºç»“æŸ\"); ä»£ç å—2 è¿è¡Œç»“æŸåï¼Œhaha.txté‡Œçš„å†…å®¹ä¸ºï¼š 1aabb å¯ä»¥çœ‹åˆ°ï¼Œæœ€ç»ˆå†™å…¥çš„æ•°æ®å°±æ˜¯æŒ‰ç…§é¡ºåºæŠŠä¸¤ä¸ªbufferé‡Œçš„å†…å®¹ä¼ è¾“è¿›å»äº†ã€‚ åŒæ ·çš„ï¼Œè¿˜æ˜¯ä»¥ç½‘ä¸Šçš„åè®®å¤´æ•°æ®ä½“çš„ä¾‹å­è¯´äº‹å„¿ï¼Œè¿™ä¸ªè·ŸScatterä¸‹çš„ä¼ è¾“æ–¹å¼æ¯”è¾ƒèµ·æ¥å°±ä¸ä¼šé‚£ä¹ˆä¸¥æ ¼äº†ï¼Œçœ‹åˆ°ä¸Šé¢ï¼Œåˆå§‹å®¹ç§¯ä¸º5ä¸ªå­—èŠ‚ï¼Œä½†å®é™…å†™åˆ°æ–‡ä»¶é‡Œçš„æ¯ä¸ªbufferä»ç„¶æ˜¯ä¸¤ä¸ªå­—èŠ‚ï¼Œå› ä¸ºGatheræ¨¡å¼ä¸‹ï¼ŒChannelè¯»å–Bufferæ•°æ®çš„æ—¶å€™ï¼Œåªä¼šè¯»å–positionåˆ°limité—´çš„æ•°æ®ï¼ˆå¯è¯»åŒºåŸŸï¼‰ï¼Œå› æ­¤è¿™é‡Œä¸ç”¨åƒå¤šBufferè¯»ä¸€æ ·è¦æ±‚é‚£ä¹ˆä¸¥æ ¼ï¼Œæˆ‘ä»¬å¯ä»¥éšæ„å®šä¹‰header bufferçš„é•¿åº¦ï¼Œåªè¦å¤§äºåè®®å¤´æœ¬èº«é•¿åº¦å³å¯ï¼Œbody bufferçš„è¦æ±‚å…¶å®æ˜¯åŒä¸Šï¼Œä¹Ÿæ˜¯å¤§äºæ•°æ®ä½“çš„é•¿åº¦ä¸Šé™å³å¯ã€‚ è¿™å°±æ˜¯Scatterå’ŒGatherçš„å…¨éƒ¨å†…å®¹äº†~å…¶å®ç®€å•ç†è§£ï¼Œå°±æ˜¯å¤šBufferæ“ä½œï¼Œä»¥åŠå¯¹ç½‘ä¸Šé‚£ä¸ªä¾‹å­ï¼Œè¿›è¡Œäº†æ›´è¯¦ç»†ä¸€ç‚¹çš„è¯´æ˜ã€‚","link":"/2019/03/07/Java%20NIO%E5%AD%A6%E4%B9%A0%E4%B8%8E%E8%AE%B0%E5%BD%95%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9A%20Scatter&Gather%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BD%BF%E7%94%A8/"},{"title":"Java NIOå­¦ä¹ ä¸è®°å½•ï¼ˆäºŒï¼‰ï¼šFileChannelä¸Bufferç”¨æ³•ä¸è¯´æ˜","text":"ä¸Šä¸€ç¯‡ç®€å•ä»‹ç»äº†NIOï¼Œè¿™ä¸€ç¯‡å°†ä»‹ç»FileChannelç»“åˆBufferçš„ç”¨æ³•ï¼Œä¸»è¦ä»‹ç»Buffer ä¸€ã€FileChannelä¾‹å­ä¸Šä¸€ç¯‡è¯´åˆ°ï¼Œè¿™ä¸ªChannelå±äºæ–‡ä»¶é€šé“ï¼Œä¸“é—¨è¯»å–æ–‡ä»¶ä¿¡æ¯ï¼ŒNIOè¯»å–æ–‡ä»¶å†…å®¹çš„ç®€å•çš„ä¾‹å­ï¼š 123456789101112131415161718192021222324252627public static void readFile() { RandomAccessFile file = null; try { file = new RandomAccessFile(\"D:\\\\rua.txt\", \"rw\"); FileChannel fileChannel = file.getChannel(); //è·å–æ–‡ä»¶é€šé“ ByteBuffer buf = ByteBuffer.allocate(2); //åˆ†é…å®¹ç§¯ä¸º2å­—èŠ‚çš„ä¸€å—Bufferï¼Œç”¨æ¥è¯»å–æ•°æ® int bytesRead = fileChannel.read(buf); //ä»é€šé“é‡Œè¯»å–æ•°æ®åˆ°Bufferå†…ï¼ˆæœ€å¤§ä¸è¶…è¿‡Bufferå®¹ç§¯ï¼‰ while (bytesRead != -1) { //å½“è¯»ä¸åˆ°ä»»ä½•ä¸œè¥¿æ—¶è¿”å›-1 buf.flip(); //åˆ‡æ¢åˆ°Bufferè¯»æ¨¡å¼ï¼Œè¯»æ¨¡å¼ä¸‹å¯ä»¥è¯»å–åˆ°ä¹‹å‰å†™å…¥Bufferçš„æ•°æ® while (buf.hasRemaining()) { //å¾ªç¯è¾“å‡ºBufferä¸­çš„æ•°æ® System.out.print((char) buf.get()); } buf.compact(); //æˆ–è€…è°ƒç”¨clearï¼Œåˆ‡æ¢å›Bufferçš„å†™æ¨¡å¼ bytesRead = fileChannel.read(buf); //è·Ÿä¸Šé¢ä¸€æ ·ï¼Œå†æ¬¡ä»é€šé“è¯»å–æ•°æ®åˆ°Bufferä¸­ } } catch (IOException e) { e.printStackTrace(); } finally { try { if (file != null) { file.close(); } } catch (IOException e) { e.printStackTrace(); } } } ä»£ç å—1 rua.txtæ–‡ä»¶å†…å®¹ä¸ºï¼š123456789 ä¸Šè¿°ä»£ç è¿è¡Œåè¾“å‡ºå¦‚ä¸‹ï¼š 1123456789 æ–‡ä»¶æ­£å¸¸è¯»å–ï¼Œå¯ä»¥ç»“åˆä¸Šé¢çš„æ³¨é‡Šï¼Œæ¥åˆ†æä¸‹è¿‡ç¨‹ï¼Œæ¥ä¸‹æ¥è¦åˆ©ç”¨ä¸Šé¢çš„ä¾‹å­ä»‹ç»Bufferçš„ä¸€äº›æ¦‚å¿µã€‚ äºŒã€Bufferçš„æ¦‚å¿µ2.1ï¼šBufferæ“ä½œçš„æ­¥éª¤ç¬¬ä¸€ç¯‡è¯´è¿‡ï¼ŒBufferæ˜¯ä¸€ä¸ªç¼“å†²åŒºï¼Œæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œè´Ÿè´£ä»é€šé“è¯»å–æ•°æ®æˆ–è€…å†™æ•°æ®ç»™é€šé“ï¼Œé€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°Bufferåœ¨è¯»å–é€šé“æ•°æ®æ—¶çš„å‡ ä¸ªæ­¥éª¤ï¼š step1ï¼šåˆ†é…ç©ºé—´ 1ByteBuffer.allocate(1024); //é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡allocateDirectoråˆ†é…ç©ºé—´ï¼ˆå…·ä½“ä¸äº†è§£ï¼Œå…ˆæ”¾ä¸€è¾¹ï¼Œå›å¤´è¡¥ï¼‰ ä»£ç å—2 step2ï¼šä»é€šé“è¯»å–æ•°æ®ï¼Œå†™å…¥Buffer 1int bytesRead = fileChannel.read(buf); ä»£ç å—3 step3ï¼šè¯»å–Bufferå†…çš„å†…å®¹ï¼Œåˆ‡æ¢å›Bufferè¯»æ¨¡å¼ 1buf.flip(); //åˆ‡æ¢åˆ°Bufferè¯»æ¨¡å¼ï¼Œè¯»æ¨¡å¼ä¸‹å¯ä»¥è¯»å–åˆ°ä¹‹å‰å†™å…¥Bufferçš„æ•°æ® ä»£ç å—4 step4ï¼šå¾ªç¯æ‰§è¡Œè¯»å†™æ“ä½œï¼Œæ¯å–å®Œä¸€æ¬¡Bufferä¸­çš„å€¼ï¼Œéƒ½åˆ‡æ¢å›å†™æ¨¡å¼ï¼Œå†æ¬¡ä»é€šé“è¯»å–æ•°æ®åˆ°Buffer 12345678while (bytesRead != -1) { //å½“è¯»ä¸åˆ°ä»»ä½•ä¸œè¥¿æ—¶è¿”å›-1 buf.flip(); //åˆ‡æ¢åˆ°Bufferè¯»æ¨¡å¼ï¼Œè¯»æ¨¡å¼ä¸‹å¯ä»¥è¯»å–åˆ°ä¹‹å‰å†™å…¥Bufferçš„æ•°æ® while (buf.hasRemaining()) { //å¾ªç¯è¾“å‡ºBufferä¸­çš„æ•°æ® System.out.print((char) buf.get()); } buf.compact(); //æˆ–è€…è°ƒç”¨clearï¼Œåˆ‡æ¢å›Bufferçš„å†™æ¨¡å¼ bytesRead = fileChannel.read(buf); //è·Ÿä¸Šé¢ä¸€æ ·ï¼Œå†æ¬¡ä»é€šé“è¯»å–æ•°æ®åˆ°Bufferä¸­} ä»£ç å—5 2.2ï¼šBufferè¯»å†™æµç¨‹è¯¦è§£2.2.1ï¼šé‡è¦å±æ€§çš„ä»‹ç»Bufferå…·å¤‡çš„å‡ ä¸ªé‡è¦æ¦‚å¿µï¼š capacityï¼šç¼“å†²åŒºæ•°ç»„çš„æ€»é•¿åº¦ï¼ˆå®¹ç§¯ï¼‰ positionï¼šä¸‹ä¸€ä¸ªéœ€è¦æ“ä½œçš„æ•°æ®å…ƒç´ çš„ä½ç½® limitï¼šç¼“å†²åŒºä¸å¯æ“ä½œçš„ä¸‹ä¸€ä¸ªå…ƒç´ çš„ä½ç½®ï¼Œlimit &lt;= capacity markï¼šç”¨äºè®°å½•positionçš„å‰ä¸€ä¸ªä½ç½®æˆ–é»˜è®¤æ˜¯-1 2.2.2ï¼šBufferå†…éƒ¨çš„æ“ä½œæµç¨‹ç»“åˆä¸Šé¢çš„æ¦‚å¿µï¼Œé™¤äº†markï¼ˆå†å¾€ä¸‹ä»‹ç»ï¼‰ï¼Œå…¶ä½™å‡ ä¸ªæŒ‡æ ‡çš„æ“ä½œå˜åŒ–å¦‚ä¸‹å›¾ï¼š åˆå§‹åŒ–ä¸€ä¸ªå®¹ç§¯ä¸º10çš„Bufferï¼Œåˆè¯†ä½ç½®limit = capacityï¼Œpositionä½äºç¬¬ä¸€ä¸ªä½ç½® å½“å®¹å™¨å†…å†™å…¥äº†5ä¸ªæ•°æ®å…ƒç´ ä¹‹åï¼Œpositionçš„ä½ç½®å˜åˆ°äº†ç¬¬6ä¸ªä½ç½®ï¼Œæ ‡è®°å½“å‰å†™å…¥åˆ°å“ªé‡Œäº† è¿™æ—¶å€™ä¸å†å†™å…¥æ•°æ®äº†ï¼Œå¼€å§‹åˆ‡æ¢å›Bufferçš„è¯»æ¨¡å¼ï¼ˆflipï¼‰ï¼Œå‘ç”Ÿçš„å˜åŒ–å¦‚ä¸‹ï¼š å‘ç°ï¼ŒåŸå…ˆè¯»æ¨¡å¼ä¸‹çš„positionçš„ä½ç½®è¢«limitæ›¿æ¢æ‰äº†ï¼Œè€Œpositionè¢«é‡ç½®ä¸ºäº†ç¬¬ä¸€ä¸ªä½ç½®ï¼Œè¿™æ˜¯å› ä¸ºç°åœ¨è¯»æ¨¡å¼ä¸‹æƒ³è¦è¯»å–ä¹‹å‰å†™å…¥çš„å†…å®¹ï¼Œä¸ºäº†ä¿è¯è¯»å–çš„æ•°æ®éƒ½æ˜¯å¯è¯»çš„ï¼ˆä¹‹å‰å†™å…¥çš„ï¼‰ï¼Œå°±éœ€è¦æœ‰ä¸€ä¸ªæ ‡è®°ï¼Œæ¥è®°å½•ä¹‹å‰å†™æ¨¡å¼ä¸‹ï¼Œæ“ä½œåˆ°å“ªé‡Œäº†ï¼Œpositionè¢«é‡ç½®ä¸ºç¬¬ä¸€ä¸ªä½ç½®ï¼Œä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼Œå› ä¸ºåˆ‡æ¢äº†è¯»æ¨¡å¼ï¼Œä»å¤´å¼€å§‹è¯»å–å·²å†™å…¥çš„æ•°æ®ã€‚ é€šè¿‡ä¸Šé¢çš„æè¿°ï¼Œæˆ‘ä»¬æ¸…æ¥šäº†bufferæ˜¯å¦‚ä½•åˆ©ç”¨positionã€limitã€capacityæ¥å®Œæˆè¯»å†™æ“ä½œçš„ï¼Œä¸‹é¢æˆ‘ä»¬æ¥ä»‹ç»ä¸‹å…·ä½“è¯»å†™æ“ä½œæ—¶Buferå‘ç”Ÿçš„æ“ä½œï¼š Bufferåˆ‡æ¢è¯»æ¨¡å¼çš„æ–¹æ³•æœ‰ï¼šflip Bufferåˆ‡æ¢å†™æ¨¡å¼çš„æ–¹æ³•æœ‰ï¼šclearã€compact Bufferè¯»æ•°æ®ï¼šget ä½¿ç”¨clearåˆ‡æ¢å›å†™æ¨¡å¼çš„æ—¶å€™ï¼Œpositionä¼šè¢«ç½®ä¸º0ï¼ˆä¹Ÿå°±æ˜¯æœ€åˆçš„ä½ç½®ï¼‰ï¼Œlimitç½®ä¸ºcapacityï¼ˆä¹Ÿå°±æ˜¯æœ€åçš„ä½ç½®ï¼‰ï¼Œæ„å‘³ç€åˆ‡æ¢å†™æ¨¡å¼ä¹‹å‰æœªè¯»çš„æ•°æ®ï¼Œå°†ä¼šè¢«æ–°ä¸€è½®çš„å†™å…¥è¦†ç›–ï¼Œå°±å†ä¹Ÿæ‰¾ä¸å›æ¥äº†ï¼Œæ‰€ä»¥é™¤clearè¿™ä¸ªæ“ä½œï¼ŒBufferè¿˜æä¾›äº†compactæ–¹æ³•æ¥åˆ‡æ¢è¯»æ¨¡å¼ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæŠŠæ‰€æœ‰æœªè¯»çš„æ•°æ®æ‹·è´åˆ°Bufferçš„èµ·å§‹ä½ç½®ï¼Œç„¶åpositionæŒ‡å‘æœ€åä¸€ä¸ªæœªè¯»æ•°æ®çš„åä¸€ä½ï¼Œè¿™æ ·ï¼Œä¸‹æ¬¡å¼€å¯è¯»æ¨¡å¼çš„æ—¶å€™ï¼Œpositionæ“ä½œåŒä¸Šï¼Œç½®ä¸º0ï¼Œå› æ­¤ä¹‹å‰æœªè¯»å®Œè¢«è½ä¸‹çš„æ•°æ®ä¹Ÿå°±åœ¨è¿™æ—¶å€™è¢«è¯»åˆ°äº†ã€‚ ä¸‹é¢æˆ‘ä»¬æ¥è¿˜åŸä¸‹è¿™ä¸ªè½¬æ¢è¿‡ç¨‹ï¼š èµ°åˆ°ä¸Šé¢çš„æ­¥éª¤åï¼Œæˆ‘ä»¬åˆ‡æ¢æˆå†™æ¨¡å¼ï¼Œä¸‹é¢è¿™ä¸ªå›¾åˆ†åˆ«è¡¨ç¤ºäº†clearå’Œcompactä¸¤ä¸ªæ–¹æ³•ä¸‹çš„ä¸¤ç§æ“ä½œï¼š æ ¹æ®å›¾4å’Œå›¾5ï¼Œç»“åˆä¸Šé¢çš„è¯ï¼Œæ›´å®¹æ˜“ç†è§£clearå’Œcompactä¸¤ç§æ–¹å¼åˆ‡æ¢å†™æ¨¡å¼æ‰€åšçš„å†…éƒ¨æ“ä½œï¼Œä»¥åŠä¸ºä»€ä¹ˆclearä¼šä¸¢æ•°æ®ï¼Œè€Œcompactä¸ä¼šã€‚ ä¸‹é¢é€šè¿‡ä¸€å¼€å§‹çš„ä¾‹å­ï¼ŒæŠŠä¸­é—´è¯»å–æ•°æ®çš„åœ°æ–¹ç¨å¾®åšä¸‹ä¿®æ”¹ï¼š 12345678910ByteBuffer buf = ByteBuffer.allocate(2);int bytesRead = readChannel.read(buf);while (bytesRead != -1) { buf.flip(); char result = (char) buf.get(); //è™½ç„¶è¯»è¿›æ¥äº†2ä¸ªå­—èŠ‚ï¼Œä½†è¿™é‡Œåªå–ä¸€ä¸ª System.out.print(result); buf.clear(); // ä½¿ç”¨clearåˆ‡æ¢å›Bufferçš„å†™æ¨¡å¼ bytesRead = readChannel.read(buf);}System.out.println(\"-----------ç¨‹åºç»“æŸ\"); ä»£ç å—6 è¾“å‡ºç»“æœï¼š 113579-----------ç¨‹åºç»“æŸ å‘ç°ä¸¢äº†ä¸€äº›æ•°æ®ï¼Œç°åœ¨æŠŠclearæ”¹æˆcompactï¼Œè¿è¡Œç»“æœä¸ºï¼š 112345678-----------ç¨‹åºç»“æŸ å‘ç°ï¼Œé™¤äº†9ï¼Œéƒ½è¾“å‡ºæ¥äº†ï¼ˆè‡³äº9ä¸ºå•¥æ²¡è¾“å‡ºï¼Œå› ä¸ºæ¯æ¬¡åªå–äº†ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®å‘€~ï¼‰ é‚£ä¹ˆï¼Œå¦‚æœåˆ‡æ¢åˆ°è¯»æ¨¡å¼ï¼Œä½†æ˜¯ä¸è¯»ï¼Œç„¶ååˆ‡æ¢å›å†™æ¨¡å¼ç»§ç»­å†™ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ æ”¹é€ ä¸Šè¿°ä»£ç å¦‚ä¸‹ï¼š 12345678ByteBuffer buf = ByteBuffer.allocate(2);int bytesRead = readChannel.read(buf);while (bytesRead != -1) { buf.flip(); buf.clear(); // ä¸è¯»ï¼Œç«‹åˆ»åˆ‡å›å†™æ¨¡å¼ bytesRead = readChannel.read(buf);}System.out.println(\"-----------ç¨‹åºç»“æŸ\"); ä»£ç å—7 è°ƒç”¨clearçš„æƒ…å†µä¸‹è¾“å‡ºï¼š 1-----------ç¨‹åºç»“æŸ è€Œè°ƒç”¨compactæ–¹æ³•ï¼Œå´å‘ç”Ÿé˜»å¡(æ­»å¾ªç¯)äº†ï¼Œç»“åˆä¹‹å‰çš„å›¾ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå¦‚æœä¸è¯»ï¼Œæ„å‘³ç€åœ¨compactä¸‹ä¼šæŠŠæœªè¯»çš„æ•°æ®copyåˆ°Bufferé‡Œï¼Œå¦‚æœä¸€ç‚¹éƒ½ä¸è¯»ï¼Œé‚£ä¹ˆæ„å‘³ç€è¢«copyçš„è¿™æ‰¹æ•°æ®ä¼šå æ»¡æ•´ä¸ªBufferï¼Œä»¥è‡³äºpositionæ²¡æœ‰ä¸‹ä¸€ä¸ªä½ç½®å¯ç”¨ï¼Œå°±ä¼šå‘ç”Ÿæ–‡ä»¶é‡Œçš„æ•°æ®æ²¡åŠæ³•è¢«å®‰æ’è¿›ç¼“å†²åŒºï¼ˆæ„å‘³ç€æ–‡ä»¶è¯»ä¸å®Œï¼‰ï¼ŒbytesReadä¸€ç›´ä¸ç­‰äº-1ï¼Œå‘ç”Ÿæ­»å¾ªç¯ã€‚ é€šè¿‡ä¸Šé¢çš„å›¾å’Œä¾‹å­ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç†æ¸…æ¥šè¯»æ¨¡å¼ã€å†™æ¨¡å¼ï¼ˆåŒ…å«ä¸åŒçš„åˆ‡æ¢æ–¹å¼ï¼‰ä¸‹çš„Bufferå†…éƒ¨å¤„ç†æ–¹å¼ã€‚ 2.3ï¼šBufferçš„å…¶ä»–æ“ä½œé™¤äº†ä¸Šé¢å‡ ç§å¸¸è§„ç”¨æ³•ï¼ŒBufferè¿˜æä¾›äº†å…¶ä»–çš„å‡ ä¸ªæ“ä½œæ–¹æ³• 2.3.1ï¼šrewindè¿™ä¸ªæ–¹æ³•å¯ä»¥åœ¨è¯»æ¨¡å¼ä¸‹ï¼Œé‡ç½®positionçš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨getæ‰§è¡Œåã€‚positionå‘ç”Ÿäº†ä½ç§»ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥é‡ç½®positionçš„ä½ç½®ä¸ºåˆå§‹ä½ç½®ï¼Œçœ‹ä¾‹å­ï¼š 12345678910ByteBuffer buf = ByteBuffer.allocate(2); //æ¯æ¬¡å¯è¯»å…¥ä¸¤ä¸ªå­—èŠ‚int bytesRead = readChannel.read(buf);while (bytesRead != -1) { buf.flip(); System.out.print((char) buf.get()); buf.rewind(); //é‡ç½®position System.out.print((char) buf.get());//è¿™æ—¶å€™è¯»åˆ°çš„æ•°æ®è·Ÿä¸Šé¢æ˜¯åŒä¸€ä¸ª buf.clear(); bytesRead = readChannel.read(buf); } ä»£ç å—8 è¿è¡Œç»“æœï¼š 11133557799 å¯ä»¥çœ‹åˆ°ï¼Œæ¯æ¬¡å¾ªç¯æ‹¿åˆ°ä¸¤ä¸ªå­—èŠ‚ï¼Œä½†ä¸¤æ¬¡è·å–çš„æ•°æ®éƒ½æ˜¯åŒä¸€ä¸ªï¼Œå› ä¸ºrewindæŠŠè¯»å–æ¸¸æ ‡é‡ç½®æˆåˆå§‹ä½ç½®äº†ï¼ˆä¹Ÿå³æ˜¯ä½ç½®0ï¼‰ â­ï¸ è¿™é‡Œè¯´ä¸‹ï¼Œå¦‚æœæŠŠä¸Šé¢çš„ç¬¬äºŒä¸ªgetæ–¹æ³•å»æ‰ï¼Œç„¶åæŠŠclearæ¨¡å¼æ”¹æˆcompactæ¨¡å¼åŒæ ·ä¹Ÿä¼šå‘ç”Ÿæ­»å¾ªç¯ï¼Œå› ä¸ºrewindé‡ç½®äº†æ¸¸æ ‡ï¼Œé‡ç½®ååˆæ²¡æœ‰getæ–¹æ³•å†æ¬¡è¯»å–ï¼Œå¯¼è‡´æŠŠæœ¬æ¬¡çš„ä¸¤ä¸ªå­—èŠ‚åˆå¤åˆ¶è¿›äº†Bufferï¼Œè·Ÿä¹‹å‰è¯´çš„ä¸è¯»ä¸€æ ·ï¼Œä¼šå¯¼è‡´Bufferæ²¡æœ‰å¤šä½™çš„ç©ºé—´æ”¾æ–‡ä»¶é‡Œçš„æ•°æ®ï¼Œå¯¼è‡´ä¸€ç›´è¯»ä¸å®Œï¼Œå‘ç”Ÿæ­»å¾ªç¯ã€‚ 2.3.2ï¼šmark &amp; resetè¿™ä¸¤ä¸ªæ–¹æ³•æ”¾åˆ°ä¸€èµ·è¯´ï¼Œå› ä¸ºmarkè·Ÿresetä¸æ”¾åœ¨ä¸€èµ·ä½¿ç”¨ï¼Œæ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚ markï¼šç”¨äºæ ‡è®°å½“å‰positionçš„ä½ç½® resetï¼šç”¨äºæ¢å¤è¢«markæ ‡è®°çš„positionçš„ä½ç½® ä¾‹å­ï¼š 1234567891011ByteBuffer buf = ByteBuffer.allocate(2);int bytesRead = readChannel.read(buf);while (bytesRead != -1) { buf.flip(); buf.mark(); //æ ‡è®°å½“å‰ä½ç½®ï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯åˆå§‹ä½ç½® System.out.print((char) buf.get()); //è¯»å–åˆ°äº†åˆè¯†ä½ç½®æ•°æ® buf.reset(); //é‡ç½®positionåˆ°markæ ‡è®°æ—¶é‚£ä¸ªå€¼ System.out.print((char) buf.get()); //è¿™é‡Œç”±äºè¢«resetäº†ï¼Œå› æ­¤è¾“å‡ºçš„è¿˜æ˜¯åˆè¯†ä½ç½®çš„æ•°æ® buf.clear(); bytesRead = readChannel.read(buf);} ä»£ç å—9 è¾“å‡ºç»“æœï¼š 11133557799 ä¼šå‘ç°ï¼Œä¸Šä¸‹ä¸¤ä¸ªæ‰“å°éƒ½æ˜¯æ˜¯ä¸€æ ·çš„æ•°æ®ã€‚å˜›ï¼Œè¿˜æ˜¯è·Ÿä¸Šé¢ä¸€æ ·ï¼Œå†å›é¡¾ä¸€ä¸‹ï¼Œè¿™é‡Œå¦‚æœç”¨compactä¼šæ€ä¹ˆæ“ä½œï¼Ÿå¦‚æœä½¿ç”¨compactä¼šæ‰“å°å¦‚ä¸‹è¯­å¥ï¼š 11122334455667788 è¿™ä¸ªç°åœ¨ä¹Ÿå¾ˆå¥½ç†è§£äº†ï¼Œå› ä¸ºé‡ç½®äº†ä½ç½®æ‰€ä»¥æ¯ä¸ªæ•°æ®è¢«æ‰“å°äº†ä¸¤æ¬¡ï¼Œç”±äºmarkçš„åŸå› ï¼Œæ¯æ¬¡å®é™…ä¸Šç›¸å½“äºåªè¯»äº†ä¸€ä¸ªæ•°æ®ï¼Œæ‰€ä»¥å‰©ä¸‹çš„ä¸€ä¸ªæ•°æ®è¢«é¡ºå»¶åˆ°ä¸‹æ¬¡å¾ªç¯é‡Œæ‰“å°ï¼Œä»¥æ­¤ç±»æ¨ã€‚ 2.3.3ï¼šequals &amp; compareTo equalsï¼šç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªBufferæ˜¯å¦ç›¸ç­‰ï¼Œåˆ¤ç­‰æ¡ä»¶ä¸º ç±»å‹ç›¸åŒï¼ˆbyteã€charç­‰ï¼‰ å‰©ä½™å…ƒç´ ä¸ªæ•°ç›¸ç­‰ å‰©ä½™å…ƒç´ ç›¸åŒ compareToï¼šæ¯”è¾ƒä¸¤ä¸ªBufferä¸­å‰©ä½™å…ƒç´ çš„å¤§å°ï¼Œå¦‚æœæ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼Œåˆ™è®¤ä¸ºbuffer1å°äºbuffer2ï¼š buffer1ä¸­ç¬¬ä¸€ä¸ªä¸buffer2ä¸ç›¸ç­‰çš„å…ƒç´ å°äºbuffer2çš„é‚£ä¸ªå…ƒç´  æ‰€æœ‰å…ƒç´ ç›¸åŒï¼Œä½†æ˜¯buffer1å…ˆæ¯”buffer2è€—å°½ ä¸‰ã€å®ä¾‹ï¼šè¾¹è¯»è¾¹å†™ä¾‹å­ï¼šå°†rua.txté‡Œçš„å†…å®¹åœ¨è¯»çš„åŒæ—¶å†™å…¥æ–‡ä»¶haha.txté‡Œ 12345678910111213readFile = new RandomAccessFile(\"D:\\\\rua.txt\", \"r\");writeFile = new RandomAccessFile(\"D:\\\\haha.txt\", \"rw\");FileChannel readChannel = readFile.getChannel(); //è·å–åªè¯»æ–‡ä»¶é€šé“FileChannel writeChannel = writeFile.getChannel(); //è·å–å†™æ–‡ä»¶é€šé“ByteBuffer readBuf = ByteBuffer.allocate(2); //åˆ†é…å®¹ç§¯ä¸º2å­—èŠ‚çš„ä¸€å—Bufferï¼Œç”¨æ¥è¯»å–æ•°æ®int bytesRead = readChannel.read(readBuf); //ä»é€šé“é‡Œè¯»å–æ•°æ®åˆ°Bufferå†…ï¼ˆæœ€å¤§ä¸è¶…è¿‡Bufferå®¹ç§¯ï¼‰while (bytesRead != -1) { //å½“è¯»ä¸åˆ°ä»»ä½•ä¸œè¥¿æ—¶è¿”å›-1 readBuf.flip(); //åˆ‡æ¢åˆ°Bufferè¯»æ¨¡å¼ï¼Œè¯»æ¨¡å¼ä¸‹å¯ä»¥è¯»å–åˆ°ä¹‹å‰å†™å…¥Bufferçš„æ•°æ® writeChannel.write(readBuf); //å°†ç°åœ¨çš„bufferé‡Œçš„æ•°æ®å†™åˆ°æ–‡ä»¶haha.txté‡Œ readBuf.compact(); // åˆ‡æ¢å›Bufferçš„å†™æ¨¡å¼ bytesRead = readChannel.read(readBuf); //è·Ÿä¸Šé¢ä¸€æ ·ï¼Œå†æ¬¡ä»é€šé“è¯»å–æ•°æ®åˆ°Bufferä¸­} ä»£ç å—10 ç»“æœhaha.txté‡Œçš„å†…å®¹ä¸ºï¼š123456789 å››ã€Bufferçš„åˆ†ç±» ç±»åˆ« è§£é‡Š ByteBuffer æ”¯æŒå­˜æ”¾å­—èŠ‚ç±»å‹æ•°æ®ï¼ŒæŠ½è±¡ç±»ï¼Œæœ‰DirectByteBufferã€HeapByteBufferã€MappedByteBufferä¸¤ä¸ªå­ç±»ï¼Œä¸‹é¢è¿›è¡Œè¯´æ˜ CharBuffer æ”¯æŒå­˜æ”¾charç±»å‹æ•°æ® DoubleBuffer æ”¯æŒå­˜æ”¾doubleç±»å‹æ•°æ® FloatBuffer æ”¯æŒå­˜æ”¾floatç±»å‹æ•°æ® IntBuffer æ”¯æŒå­˜æ”¾intç±»å‹æ•°æ® LongBuffer æ”¯æŒå­˜æ”¾longç±»å‹æ•°æ® ShortBuffer æ”¯æŒå­˜æ”¾shortç±»å‹æ•°æ® è¡¨1 é€šè¿‡ä¸Šè¡¨å¯ä»¥çœ‹åˆ°ï¼ŒBufferæœ‰å¾ˆå¤šå®ç°ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†éƒ½å¯¹åº”ä¸€ç§åŸºæœ¬ç±»å‹ï¼ŒByteBufferæ¯”è¾ƒç‰¹æ®Šï¼Œä¸‹é¢ä»‹ç»ä¸‹å®ƒçš„ä¸¤ä¸ªå­ç±»ã€‚ ByteBufferâ€”-&gt;HeapByteBuffer ç›´æ¥é€šè¿‡byteæ•°ç»„å®ç°çš„åœ¨javaå †ä¸Šçš„ç¼“å†²åŒºã€‚ ByteBufferâ€”-&gt;DirectByteBuffer ç›´æ¥åœ¨javaå †å¤–ç”³è¯·çš„ä¸€å—å†…å­˜ï¼Œå°†æ–‡ä»¶æ˜ å°„åˆ°è¯¥å†…å­˜ç©ºé—´ï¼Œåœ¨å¤§æ–‡ä»¶è¯»å†™æ–¹é¢çš„æ•ˆç‡éå¸¸é«˜ã€‚ ByteBufferâ€”â€“&gt;MappedByteBuffer åŒæ ·å†™æ•ˆç‡éå¸¸é«˜ã€‚ å…³äºè¿™å‡ ä¸ªBufferåç»­ä¼šä¸“é—¨æ•´ç†ä¸€ç¯‡æ–‡ç« æ¥å†™ã€‚","link":"/2019/03/05/Java%20NIO%E5%AD%A6%E4%B9%A0%E4%B8%8E%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9AFileChannel%E4%B8%8EBuffer%E7%94%A8%E6%B3%95%E4%B8%8E%E8%AF%B4%E6%98%8E/"},{"title":"Java NIOå­¦ä¹ ä¸è®°å½•ï¼ˆä¸€ï¼‰ï¼šåˆè¯†NIO","text":"å·¥ä½œä¸­æœ‰äº›åœ°æ–¹é—´æ¥ç”¨åˆ°äº†nettyï¼Œnettyæ˜¯ä¸€ä¸ªNIOæ¡†æ¶ï¼Œå¯¹äºNIOå´ä¸æ˜¯é‚£ä¹ˆç†Ÿæ‚‰ï¼Œè¿™ä¸ªç³»åˆ—çš„æ–‡ç« æ˜¯æˆ‘åœ¨å­¦ä¹ NIOæ—¶çš„ä¸€ä¸ªè®°å½•ï¼Œä¹ŸæœŸå¾…è‡ªå·±å¯ä»¥æ›´å¥½çš„æŒæ¡NIOã€‚ ä¸€ã€NIOæ˜¯ä»€ä¹ˆï¼Ÿä¸€ç»„ç”±æ“ä½œç³»ç»Ÿæä¾›çš„åº•å±‚APIï¼Œjavaæ”¯æŒå¯¹å®ƒä»¬çš„å°è£…ï¼Œæˆ‘ä»¬éœ€è¦åšçš„æ˜¯åˆ©ç”¨javaæ¥ä½¿ç”¨å®ƒä»¬ã€‚éé˜»å¡å¼IOï¼Œä¸ä¼ ç»Ÿçš„BIOï¼ˆé˜»å¡å¼IOï¼‰ä¸åŒï¼ŒNIOå¯ä»¥é€šè¿‡é€šé“ï¼ˆChannelsï¼‰æ¥ç›‘å¬å„é€šé“çš„åŠ¨ä½œï¼Œä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å®Œæˆå¯¹å¤šä¸ªé€šé“çš„åŠ¨ä½œç›‘å¬ï¼Œè¿™äº›åŠ¨ä½œåŒ…æ‹¬è¿æ¥å°±ç»ªã€å†™å°±ç»ªã€è¯»å°±ç»ªç­‰ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå»ºç«‹è¿æ¥è¿™ä¸ªåŠ¨ä½œåœ¨BIOä¸­ä¼šå‘ç”Ÿé˜»å¡ï¼Œç›´åˆ°è¿æ¥å»ºç«‹å®Œæˆï¼Œè€Œåœ¨NIOä¸­ï¼Œå»ºè¿åªæ˜¯å•çº¿ç¨‹é‡ŒSelectorç›‘å¬çš„ä¸€ä¸ªåŠ¨ä½œï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨å»ºç«‹è¿æ¥ä¹‹å‰ï¼ˆå³å»ºè¿å°±ç»ªä¹‹å‰ï¼‰ï¼Œè¿™ä¸ªçº¿ç¨‹æ˜¯å¯ä»¥ç»§ç»­å¤„ç†å…¶ä»–åŠ¨ä½œçš„ï¼ˆæ¯”å¦‚è¯»ã€å†™ç­‰ç­‰ï¼‰ã€‚æ²¡æœ‰ä¼ ç»ŸIOåœ¨IOäº¤äº’æ—¶çš„é˜»å¡ç°è±¡ï¼Œä»…é€šè¿‡ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†nå¤šIOé€šé“ï¼ˆChannelsï¼‰ï¼Œå¤§å¤§æå‡äº†ç¨‹åºçš„å¤„ç†èƒ½åŠ›ã€‚ äºŒã€NIOæ ¸å¿ƒç»„æˆéƒ¨åˆ†2.1ï¼šChannels &amp; Bufferè¿™ä¸¤ä¸ªæ”¾åœ¨ä¸€èµ·è®²ï¼ŒChannelæ˜¯æŒ‡å„ç§IOé€šé“ï¼ˆåŒ…æ‹¬Fileã€Socketç­‰ï¼‰ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºåŒå‘IOæµï¼Œå³ï¼šChannelæ—¢å¯ä»¥å°†è‡ªå·±çš„å†…å®¹è¯»åˆ°Bufferä¸­ï¼Œä¹Ÿå¯ä»¥ä»Bufferä¸­è¯»å–æ•°æ®å†™å…¥åˆ°è‡ªå·±é‡Œé¢ã€‚å…¶æ¬¡ï¼ŒChannelå¹¶ä¸ä¸€å®šæ˜¯åŒå‘çš„ï¼Œä¸€ä¸ªChannelå¦‚æœå®ç°å®šä¹‰read( )æ–¹æ³•çš„ ReadableByteChannel æ¥å£,è€Œå¦ä¸€ä¸ª Channel ç±»ä¹Ÿè®¸å®ç° WritableByteChannel æ¥å£ä»¥æä¾›write( )æ–¹æ³•ã€‚å®ç°è¿™ä¸¤ç§æ¥å£å…¶ä¸­ä¹‹ä¸€çš„ç±»éƒ½æ˜¯å•å‘çš„ï¼Œåªèƒ½åœ¨å•ä¸ªæ–¹å‘ä¸Šä¼ è¾“æ•°æ®ã€‚å¦‚æœä¸€ä¸ªç±»åŒæ—¶å®ç°è¿™ä¸¤ä¸ªæ¥å£,é‚£ä¹ˆå®ƒæ˜¯åŒå‘çš„,å¯ä»¥åŒå‘ä¼ è¾“æ•°æ®ï¼ˆè¯»&amp;å†™ï¼‰ã€‚ ç»“åˆä¸Šé¢æè¿°ï¼ŒBufferæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œè´Ÿè´£å­˜å‚¨ä»Channelé‡Œè¯»åˆ°çš„æ•°æ®æˆ–è€…å­˜å‚¨å‡†å¤‡å†™å…¥Channelçš„æ•°æ®ï¼Œå±äºä¸€ä¸ªç¼“å†²åŒºã€‚ å¸¸è§çš„Channelï¼š FileChannelï¼šæ–‡ä»¶é€šé“ DatagramChannelï¼šä¸€ä¸ªèƒ½æ”¶å‘UDPåŒ…çš„é€šé“ã€‚å› ä¸ºUDPæ˜¯æ— è¿æ¥çš„ç½‘ç»œåè®®ï¼Œæ‰€ä»¥ä¸èƒ½åƒå…¶å®ƒé€šé“é‚£æ ·è¯»å–å’Œå†™å…¥ã€‚å®ƒå‘é€å’Œæ¥æ”¶çš„æ˜¯æ•°æ®åŒ… SocketChannelï¼šä¸€ä¸ªè¿æ¥åˆ°TCPç½‘ç»œå¥—æ¥å­—çš„é€šé“ ServerSocketChannelï¼šä¸€ä¸ªå¯ä»¥ç›‘å¬æ–°è¿›æ¥çš„TCPè¿æ¥çš„é€šé“ å¸¸è§çš„Bufferï¼š ByteBufferã€CharBufferã€DoubleBufferã€FloatBufferã€IntBufferã€LongBufferã€ShortBuffer å¯ä»¥å‘ç°ï¼Œæ¶µç›–äº†åŸºæœ¬ä¼ è¾“çš„æ•°æ®ç±»å‹ã€‚ 2.2ï¼šSelectorå¯ä»¥ç†è§£ä¸ºâ€œChanneläº‹ä»¶é€‰æ‹©å¤„ç†å™¨â€ï¼Œç¬¬ä¸€éƒ¨åˆ†æœ‰æåˆ°è¯´NIOå±äºéé˜»å¡å¼IOï¼Œå…³é”®ç‚¹åœ¨äºSelectorå¯ä»¥è¿è¡Œäºä¸€ä¸ªå•çº¿ç¨‹é‡Œï¼Œç„¶åé€šè¿‡ä¸€ä¸ªæ­»å¾ªç¯ï¼ˆé˜»å¡æ–¹æ³•ï¼‰æ¥ç›‘å¬æ³¨å†Œåˆ°é€‰æ‹©å™¨å†…çš„Channelçš„äº‹ä»¶ï¼ˆæ³¨æ„è¿™é‡Œï¼Œä¸€ä¸ªChannelçš„äº‹ä»¶æƒ³è¦è¢«é€‰æ‹©å™¨ç›‘å¬åˆ°ï¼Œåˆ™è¦æ±‚è¯¥Channelå¿…é¡»æ³¨å†Œåˆ°é€‰æ‹©å™¨é‡Œï¼‰ï¼Œè¿™äº›äº‹ä»¶ä¸Šé¢ä¹Ÿæåˆ°è¿‡åŒ…å«ï¼šè¿æ¥å°±ç»ªã€å†™å°±ç»ªã€è¯»å°±ç»ªç­‰ã€‚è¿™äº›åŠ¨ä½œå…¨éƒ¨ç”±Channelè‡ªå·±å®Œæˆï¼Œä»€ä¹ˆæ—¶å€™å®Œæˆäº†é€šçŸ¥é€‰æ‹©å™¨å»è¿›è¡Œç›¸åº”çš„é€»è¾‘å¤„ç†å³å¯ï¼Œè€Œä¸å¿…é˜»å¡åœ¨IOäº¤äº’ä¸Šï¼ˆä¹Ÿæ˜¯ä¸ä¼ ç»ŸBIOä¸åŒçš„ç‚¹ï¼‰ï¼Œé€‰æ‹©å™¨å·¥ä½œå¦‚ä¸‹å›¾ï¼š æœ¬ç¯‡ç®€å•ä»‹ç»äº†ä¸‹NIOï¼Œæ¥ä¸‹æ¥å°†ä¼šä»‹ç»å…·ä½“å¦‚ä½•å»ä½¿ç”¨","link":"/2019/03/05/Java%20NIO%E5%AD%A6%E4%B9%A0%E4%B8%8E%E8%AE%B0%E5%BD%95%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E5%88%9D%E8%AF%86NIO/"},{"title":"ç®€å•å·¥å‚æ¨¡å¼&ç­–ç•¥æ¨¡å¼-ç®€ä»‹ä¸åŒºåˆ«","text":"å‰è¨€ï¼šä¸¤ç§æ¨¡å¼çš„ç›¸ä¼¼ç‚¹ä¸ä¸åŒç‚¹ä¸å¾—ä¸è¯´ï¼Œè¿™ä¸¤ç§æ¨¡å¼çœŸçš„å¾ˆåƒã€‚ ç›¸ä¼¼ç‚¹ï¼šéƒ½ç”¨åˆ°äº†é¢å‘å¯¹è±¡çš„ç»§æ‰¿ã€å¤šæ€ã€æŠ½è±¡ï¼Œéƒ½æ‹¥æœ‰ç›¸ä¼¼çš„ç»“æ„ã€‚ ä¸åŒç‚¹ï¼šå·¥å‚æ¨¡å¼ä»…æä¾›å…·ä½“çš„å®ä¾‹å¯¹è±¡ï¼Œæ€ä¹ˆä½¿ç”¨è¿™ä¸ªå¯¹è±¡æ˜¯clientçš„è‡ªç”±ï¼Œç­–ç•¥æ¨¡å¼clientå¯ä»¥é€šè¿‡ç­–ç•¥ç±»æ¥å†³å®šä½¿ç”¨å“ªä¸ªå®ä¾‹çš„å“ªä¸ªæ–¹æ³•ã€‚ ä¸€ã€ä¸¤ç§æ¨¡å¼çš„å…¬å…±ç›¸åŒéƒ¨åˆ†ä¸‹é¢ï¼Œæˆ‘ä»¬å‡è®¾æœ‰ä¸€å°çº¢ç™½æœºï¼Œé‡Œé¢æœ‰ä¸€äº›æ¸¸æˆï¼Œæ¯ä¸ªæ¸¸æˆæ‹¥æœ‰playï¼ˆç©ï¼‰å’Œuninstallï¼ˆå¸è½½ï¼‰ä¸¤ä¸ªæ–¹æ³•ã€‚ æŒ‰ç…§å·¥å‚å’Œç­–ç•¥æ¨¡å¼ï¼Œæˆ‘ä»¬æŠ½è±¡å‡ºæ¥ä¸€ä¸ªGameæ¥å£ï¼š 1234567public interface Game { void play(); void uninstall();} ä»£ç å—1 ç„¶åï¼Œæˆ‘ä»¬å‡è®¾æ¸¸æˆæœºé‡Œæœ‰é­‚æ–—ç½—ã€é©¬æˆå›¢ã€é»˜è®¤çš„ä¿„ç½—æ–¯æ–¹å—ä¸‰æ¬¾æ¸¸æˆï¼Œæ¯ä¸ªæ¸¸æˆæœ‰ä¸åŒçš„ç©æ³•å’Œå¸è½½ç®—æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142// é­‚æ–—ç½—ï¼Œå®ç°Gamepublic class Hundouluo implements Game { @Override public void play() { System.out.println(\"æ¸¸æˆï¼šé­‚æ–—ç½—...playing\"); } @Override public void uninstall() { System.out.println(\"æ¸¸æˆï¼šé­‚æ–—ç½—...å¸è½½\"); }}// é©¬æˆå›¢ï¼Œå®ç°Gamepublic class Maxituan implements Game { @Override public void play() { System.out.println(\"æ¸¸æˆï¼šé©¬æˆå›¢...playing\"); } @Override public void uninstall() { System.out.println(\"æ¸¸æˆï¼šé©¬æˆå›¢...å¸è½½\"); }}// é»˜è®¤çš„ä¿„ç½—æ–¯æ–¹å—ï¼Œå®ç°Gamepublic class Default implements Game { @Override public void play() { System.out.println(\"æ¸¸æˆï¼šä¿„ç½—æ–¯æ–¹å—...playing\"); } @Override public void uninstall() { System.out.println(\"æ¸¸æˆï¼šä¿„ç½—æ–¯æ–¹å—...å¸è½½\"); }} ä»£ç å—2 okï¼Œå·¥å‚æ¨¡å¼å’Œç­–ç•¥æ¨¡å¼çš„ç›¸åŒéƒ¨åˆ†å°±å·²ç»å†™å¥½äº†ï¼Œé€šè¿‡ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°è¿™ä¸¤ç§æ¨¡å¼éƒ½æ˜¯éœ€è¦æŠŠç›¸åŒçš„éƒ¨åˆ†æŠ½è±¡å‡ºæ¥ï¼Œé€šè¿‡å¤šæ€æ¥å®ä¾‹åŒ–ä¸åŒçš„å¯¹è±¡ï¼Œè°ƒç”¨å…¶å¯¹åº”çš„å®ç°ã€‚ äºŒã€ä¸¤ç§æ¨¡å¼çš„ä¸åŒéƒ¨åˆ†çš„å®ç°2.1ï¼šå·¥å‚æ¨¡å¼å·¥å‚éœ€è¦ä¸€ä¸ªå·¥å‚ç±»ï¼Œç”¨æ¥è¿”å›å…·ä½“çš„å®ä¾‹å¯¹è±¡ç”¨ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314public class GameFactory { public static Game getGame(String name) { switch (name) { //æ ¹æ®ä¼ æ¥çš„æ¸¸æˆåï¼ˆè¿™é‡Œå·æ‡’ç”¨äº†é¦–å­—æ¯ï¼‰ï¼Œæ¥å®ä¾‹åŒ–å…·ä½“çš„å¯¹è±¡ case \"hdl\": return new Hundouluo(); case \"mxt\": return new Maxituan(); default: return new Default(); } }} ä»£ç å—3 2.2ï¼šç­–ç•¥æ¨¡å¼ç­–ç•¥æ¨¡å¼éœ€è¦ç­–ç•¥ç±»æ¥å°è£…å…·ä½“çš„è¡Œä¸ºï¼ˆæ–¹æ³•ï¼‰ï¼Œå¹¶ä¸”è¿˜å¯ä»¥æŒ‡å®šä½¿ç”¨å“ªä¸ªå®ä¾‹çš„å“ªä¸ªè¡Œä¸ºï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839// ä¸ºäº†å’Œå·¥å‚åšå……åˆ†çš„åŒºåˆ†ï¼Œè¿™é‡Œå®šä¹‰äº†ä¸¤ä¸ªç±»å‹çš„contextï¼Œåˆ†åˆ«ç»´æŠ¤ä¸€ä¸ªè¡Œä¸ºç®—æ³•ï¼ˆä¹Ÿå°±æ˜¯æ–¹æ³•å‡½æ•°ï¼Œå…¶æ¬¡å»ºç«‹ä¸¤ä¸ªcontextæ˜¯ä¸ºäº†è¯´æ˜é—®é¢˜ï¼Œå®é™…ä½¿ç”¨æ—¶å¯èƒ½ä¸éœ€è¦è¿™ä¹ˆå¤šï¼‰// ç”¨æ¥ç»´æŠ¤playè¿™ä¸ªç®—æ³•çš„å®ç°public class PlayContext { private Game game; public PlayContext() { this.game = new Default(); } public PlayContext(Game game) { this.game = game; // è¿™é‡Œæ ¹æ®ä¼ å…¥çš„å…·ä½“å®ä¾‹èµ‹å€¼ } public void trigger() { this.game.play(); // è¿™é‡Œæ˜¯å¯¹è¡Œä¸ºçš„å°è£…ï¼Œåªæä¾›playæ–¹æ³•çš„è§¦å‘ }}// ç”¨æ¥ç»´æŠ¤uninstallè¿™ä¸ªç®—æ³•çš„å®ç°public class UninstallContext { private Game game; public UninstallContext() { this.game = new Default(); } public UninstallContext(Game game) { this.game = game; // è¿™é‡Œæ ¹æ®ä¼ å…¥çš„å…·ä½“å®ä¾‹èµ‹å€¼ } public void trigger() { this.game.uninstall(); // è¿™é‡Œæ˜¯å¯¹è¡Œä¸ºçš„å°è£…ï¼Œåªæä¾›uninstallæ–¹æ³•çš„è§¦å‘ }} ä»£ç å—4 æµ‹è¯•ä»£ç ï¼š 1234new PlayContext(new Hundouluo()).trigger();new UninstallContext(new Hundouluo()).trigger();new PlayContext(new Maxituan()).trigger();new UninstallContext(new Maxituan()).trigger(); ä»£ç å—5 è¿è¡Œç»“æœï¼š 1234æ¸¸æˆï¼šé­‚æ–—ç½—...playingæ¸¸æˆï¼šé­‚æ–—ç½—...å¸è½½æ¸¸æˆï¼šé©¬æˆå›¢...playingæ¸¸æˆï¼šé©¬æˆå›¢...å¸è½½ é€šè¿‡ä¸Šé¢çš„å®éªŒï¼Œå’Œå¯¹æ¯”ï¼Œä¼šå‘ç°ï¼Œå·¥å‚æ¨¡å¼æ˜¯ç®€å•çš„å¯¹å®ä¾‹çš„å°è£…ï¼Œè€Œç­–ç•¥æ¨¡å¼æ›´åœ¨æ„çš„æ˜¯å¯¹å…·ä½“å®ä¾‹çš„å…·ä½“è¡Œä¸ºï¼ˆæ–¹æ³•ï¼‰çš„å°è£…ã€‚ è¿˜æœ‰ä¸€ç§æƒ…å†µå°±æ˜¯åˆ©ç”¨å·¥å‚æ¨¡å¼çš„æ€æƒ³ï¼Œå®ç°çš„ç­–ç•¥æ¨¡å¼ï¼Œæˆ‘ä»¬ç°åœ¨æ¥æ”¹é€ ä¸‹ä¸Šé¢çš„PlayContextæºç ï¼š 1234567891011121314151617181920212223242526public class PlayContext { private Game game; public PlayContext() { this.game = new Default(); } public PlayContext(String name) { switch (name) { //æ ¹æ®ä¼ æ¥çš„æ¸¸æˆåï¼ˆè¿™é‡Œå·æ‡’ç”¨äº†é¦–å­—æ¯ï¼‰ï¼Œæ¥å®ä¾‹åŒ–å…·ä½“çš„å¯¹è±¡ case \"hdl\": this.game = new Hundouluo(); break; case \"mxt\": this.game = new Maxituan(); break; default: this.game = new Default(); } } public void trigger() { this.game.play(); // è¿™é‡Œæ˜¯å¯¹è¡Œä¸ºçš„å°è£…ï¼Œåªæä¾›playæ–¹æ³•çš„è§¦å‘ }} ä»£ç å—6 æµ‹è¯•ç±»ï¼š 1234new PlayContext(\"hdl\").trigger();new UninstallContext(new Hundouluo()).trigger();new PlayContext(\"mxt\").trigger();new UninstallContext(new Maxituan()).trigger(); ä»£ç å—7 æµ‹è¯•ç»“æœï¼š 1234æ¸¸æˆï¼šé­‚æ–—ç½—...playingæ¸¸æˆï¼šé­‚æ–—ç½—...å¸è½½æ¸¸æˆï¼šé©¬æˆå›¢...playingæ¸¸æˆï¼šé©¬æˆå›¢...å¸è½½ ä¸‰ã€æ€»ç»“ç­–ç•¥æ¨¡å¼æ˜¯ä¸€ç§å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•çš„æ–¹æ³•ï¼Œæ‰€æœ‰è¿™äº›ç®—æ³•å®Œæˆçš„éƒ½æ˜¯ç›¸åŒçš„å·¥ä½œï¼Œåªæ˜¯å®ç°ä¸åŒï¼Œå®ƒå¯ä»¥ä»¥ç›¸åŒçš„æ–¹å¼è°ƒç”¨æ‰€æœ‰ç®—æ³•ï¼Œå‡å°‘äº†å„ç§ç®—æ³•ç±»ä¸ä½¿ç”¨ç®—æ³•ç±»ä¹‹é—´çš„è€¦åˆã€‚ å·¥å‚æ¨¡å¼ä»…æä¾›å¯¹åº”çš„å®ä¾‹ï¼Œä¸å¯¹å…¶æ–¹æ³•åšå°è£…ï¼Œå‡å°‘äº†å…·ä½“å®ç°çš„å®ä¾‹ä¸ä½¿ç”¨å®ä¾‹çš„ä¸šåŠ¡æ–¹çš„è€¦åˆã€‚ ï¼ˆâ†‘æè¿°å¾…æ”¹è¿›ï¼‰","link":"/2019/02/27/%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F&%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F-%E7%AE%80%E4%BB%8B%E4%B8%8E%E5%8C%BA%E5%88%AB/"},{"title":"å›¾è§£javaå¤šçº¿ç¨‹è®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰","text":"å»å¹´çœ‹å®Œçš„ã€Šå›¾è§£javaå¤šçº¿ç¨‹è®¾è®¡æ¨¡å¼ã€‹ï¼Œå¯æƒœå½“æ—¶æ²¡åšç¬”è®°ï¼Œå¯¼è‡´åæ¥å¿˜äº†è®¸å¤šä¸œè¥¿ï¼Œæ‰“ç®—å†æ¸©ä¹ ä¸‹è¿™æœ¬ä¹¦ï¼Œé¡ºä¾¿åœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹~ ä¸€ã€é¡ºåºæ‰§è¡Œã€å¹¶è¡Œã€å¹¶å‘ é¡ºåºæ‰§è¡Œï¼šå¤šä¸ªæ“ä½œæŒ‰ç…§é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚ å¹¶è¡Œï¼šå¤šä¸ªä»»åŠ¡åŒæ—¶è¿›è¡Œï¼ŒåŒä¸€æ—¶é—´å†…å¯ä»¥æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œè¿™ç§æ–¹å¼ï¼Œå«åšå¹¶è¡Œæ‰§è¡Œï¼Œæ¯”å¦‚å¤šæ ¸å¤„ç†å™¨ï¼Œå¤šä¸ªæ ¸å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡ã€‚ å¹¶å‘ï¼šå¤šä¸ªä»»åŠ¡é€šè¿‡åˆ‡åˆ†æ—¶é—´æ®µï¼Œæ¥è¾¾åˆ°â€œåŒæ—¶è¿›è¡Œâ€çš„æ•ˆæœï¼Œæ¯”å¦‚å•æ ¸å¤„ç†å™¨ï¼Œåœ¨â€œåŒæ—¶â€å¤„ç†å¤šä¸ªä»»åŠ¡æ—¶ï¼Œå°±ä¼šä¸åœçš„åˆ‡æ¢æ¥æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ï¼Œä¸å¯èƒ½æœ‰åŒä¸€æ—¶é—´æ‰§è¡Œä¸åŒä»»åŠ¡çš„æƒ…å†µã€‚ ä¸‹é¢å¼•ç”¨åˆ«äººçš„ä¸€å¥è¯æ¥è¯´æ˜ä¸‹å¹¶è¡Œå’Œå¹¶å‘ï¼š å¹¶å‘æ˜¯ä¸¤ä¸ªä»»åŠ¡å¯ä»¥åœ¨é‡å çš„æ—¶é—´æ®µå†…å¯åŠ¨ï¼Œè¿è¡Œå’Œå®Œæˆã€‚å¹¶è¡Œæ˜¯ä»»åŠ¡åœ¨åŒä¸€æ—¶é—´è¿è¡Œï¼Œä¾‹å¦‚ï¼Œåœ¨å¤šæ ¸å¤„ç†å™¨ä¸Šï¼Œå¹¶å‘æ˜¯ç‹¬ç«‹æ‰§è¡Œè¿‡ç¨‹çš„ç»„åˆï¼Œè€Œå¹¶è¡Œæ˜¯åŒæ—¶æ‰§è¡Œï¼ˆå¯èƒ½ç›¸å…³çš„ï¼‰è®¡ç®—ã€‚ å¹¶å‘æ˜¯ä¸€æ¬¡å¤„ç†å¾ˆå¤šäº‹æƒ…ï¼Œå¹¶è¡Œæ˜¯åŒæ—¶åšå¾ˆå¤šäº‹æƒ…ã€‚ åº”ç”¨ç¨‹åºå¯ä»¥æ˜¯å¹¶å‘çš„ï¼Œä½†ä¸æ˜¯å¹¶è¡Œçš„ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œä½†æ˜¯æ²¡æœ‰ä¸¤ä¸ªä»»åŠ¡åœ¨åŒä¸€æ—¶åˆ»æ‰§è¡Œã€‚åº”ç”¨ç¨‹åºå¯ä»¥æ˜¯å¹¶è¡Œçš„ï¼Œä½†ä¸æ˜¯å¹¶å‘çš„ï¼Œè¿™æ„å‘³ç€å®ƒåŒæ—¶å¤„ç†å¤šæ ¸CPUä¸­çš„ä»»åŠ¡çš„å¤šä¸ªå­ä»»åŠ¡ã€‚ä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥å³ä¸æ˜¯å¹¶è¡Œçš„ï¼Œä¹Ÿä¸æ˜¯å¹¶å‘çš„ï¼Œè¿™æ„å‘³ç€å®ƒä¸€æ¬¡ä¸€ä¸ªåœ°å¤„ç†æ‰€æœ‰ä»»åŠ¡ã€‚åº”ç”¨ç¨‹åºå¯ä»¥å³æ˜¯å¹¶è¡Œçš„ä¹Ÿæ˜¯å¹¶å‘çš„ï¼Œè¿™æ„å‘³ç€å®ƒåŒæ—¶åœ¨å¤šæ ¸CPUä¸­åŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡ã€‚ äºŒã€synchronizedä¿®é¥°ç¬¦å½“æˆ‘ä»¬è¯´ä¸€ä¸ªçº¿ç¨‹è·å¾—é”ä»¥åï¼Œåˆ™æ„å‘³ç€è¿™ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œå½“å‰å¯¹è±¡ï¼ˆæˆ–ç±»ï¼‰é‡Œçš„synchronizedæ–¹æ³•ï¼Œè€Œä¸”ä»–çº¿ç¨‹åˆ™éœ€è¦æ’é˜Ÿç­‰å¾…è¯¥çº¿ç¨‹é‡Šæ”¾é”ä»¥åæ‰å¯èƒ½è·å¾—é”ï¼Œè¿›è€Œæ‰§è¡Œé”é‡Œé¢çš„ç¨‹åºã€‚ synchronizedä¿®é¥°åï¼Œå­˜åœ¨å¯¹è±¡é”å’Œç±»é”ä¸¤ç§ç±»å‹ã€‚ 2.1ï¼šå¯¹è±¡é”123synchronized (this){ ...ç•¥} ä»£ç å—1 2.2ï¼šç±»é”123synchronized (XXX.class){ ...ç•¥} ä»£ç å—2 2.3ï¼šåŒºåˆ«å’Œä½œç”¨åŸŸå¯¹è±¡é”æŒ‡çš„æ˜¯å½“å‰çº¿ç¨‹è·å¾—äº†æŸä¸ªå®ä¾‹çš„é”ï¼Œå‡å¦‚æœ‰ä¸ªWordç±»ï¼Œæœ‰Aã€Bä¸¤ä¸ªåŒæ­¥æ–¹æ³•ï¼ŒCå±äºæ™®é€šæ–¹æ³•ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š å¯ä»¥å‘ç°ï¼Œå¯¹è±¡é”çš„ä½œç”¨åŸŸåªé’ˆå¯¹å½“å‰å¯¹è±¡ç”Ÿæ•ˆï¼Œå°±åƒw1å’Œw2é‡Œçš„Aæ–¹æ³•å¯ä»¥è¢«ä¸åŒçš„çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œä½†æ˜¯åŒä¸€ä¸ªå¯¹è±¡å†…çš„åŒæ­¥å—ï¼Œå´åªå…è®¸æŒæœ‰å½“å‰å¯¹è±¡é”çš„çº¿ç¨‹æ‰§è¡Œï¼Œå¦‚t2ã€t3å‡è¢«æŒ¡åœ¨äº†å¤–é¢ï¼Œå½“t1é‡Šæ”¾é”ä»¥åï¼Œt2ã€t3æ‰ä¼šé‡æ–°ç«äº‰é”ï¼Œç«äº‰åˆ°é”ä»¥åå°±ä¼šæ‰§è¡Œè‡ªå·±æƒ³è¦æ‰§è¡Œçš„åŒæ­¥é€»è¾‘ã€‚ ç±»é”æŒ‡çš„æ˜¯å½“å‰çº¿ç¨‹è·å¾—äº†æŸä¸ªç±»çš„é”ï¼Œè¿˜æ˜¯Wordç±»ï¼Œæœ‰Aã€Bä¸¤ä¸ªstaticæ–¹æ³•ï¼ˆé™æ€æ–¹æ³•å±äºç±»æ–¹æ³•ï¼ŒåŠ synchronizedä¿®é¥°ç¬¦åç­‰æ•ˆäºä¸Šé¢æåˆ°çš„synchronized(Word.class))ï¼ŒCå±äºæ™®é€šstaticæ–¹æ³•ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š è·Ÿä¸Šé¢ç›¸æ¯”è¾ƒï¼Œè¿™é‡Œçš„t5å—åˆ°äº†t1çš„å½±å“ï¼Œå› ä¸ºt1è·å¾—äº†Wordç±»çš„é”ï¼Œw1å’Œw2å…±å±ä¸€ä¸ªç±»ï¼Œå› æ­¤t1è·å¾—ç±»é”ä»¥åï¼Œå…¶ä»–çº¿ç¨‹æƒ³è¦è®¿é—®è¿™ä¸ªç±»é‡Œçš„åŒæ­¥å—ï¼Œå°±å¾—ç­‰åˆ°t1é‡Šæ”¾é”ä»¥åæ‰å¯ä»¥ç»§ç»­ç«äº‰é”ç„¶åæ‰§è¡Œè‡ªå·±æƒ³è¦æ‰§è¡Œçš„åŒæ­¥é€»è¾‘ã€‚ ä¸‰ã€çº¿ç¨‹é—´çš„é€šä¿¡3.1ï¼šWaitè¿™å‡ ä¸ªæ–¹æ³•æ˜¯å±äºæ¯ä¸ªå®ä¾‹å¯¹è±¡çš„ï¼Œæ‰€æœ‰å®ä¾‹éƒ½æ‹¥æœ‰ä¸€ä¸ªâ€œç­‰å¾…é˜Ÿåˆ—â€ï¼ˆè™šæ‹Ÿæ¦‚å¿µï¼Œå®ä¾‹é‡Œå¹¶ä¸å­˜åœ¨è¯¥å­—æ®µï¼‰ï¼Œå®ƒæ˜¯åœ¨å®ä¾‹çš„waitæ–¹æ³•è°ƒç”¨åå­˜æ”¾åœæ­¢æ“ä½œçº¿ç¨‹çš„é˜Ÿåˆ—ã€‚æ‰§è¡Œwaitæ–¹æ³•åï¼Œçº¿ç¨‹è¿›å…¥å½“å‰å®ä¾‹çš„â€œç­‰å¾…é˜Ÿåˆ—â€ï¼Œä»¥ä¸‹å‡ ç§æƒ…å†µå¯ä»¥è®©çº¿ç¨‹é€€å‡ºâ€œç­‰å¾…é˜Ÿåˆ—â€ï¼š å…¶ä»–çº¿ç¨‹è°ƒç”¨notifyã€notifyAllæ–¹æ³•æ¥å°†å…¶å”¤é†’ å…¶ä»–çº¿ç¨‹è°ƒç”¨interruptæ¥å°†å…¶å”¤é†’ waitæ–¹æ³•æœ¬èº«è¶…æ—¶ å½“æ‰§è¡Œäº†ä¸‹é¢çš„ä»£ç ï¼š 1obj.wait(); ä»£ç å—3 æˆ‘ä»¬å¯ä»¥è¯´å½“å‰çº¿ç¨‹åœ¨objä¸Šå‘ç”Ÿäº†ç­‰å¾…ï¼Œå½“å‰çº¿ç¨‹è¿›å…¥äº†objçš„â€œç­‰å¾…é˜Ÿåˆ—â€ï¼Œæ­¤æ—¶å½“å‰çº¿ç¨‹ä¼šè®©å‡ºé”ï¼Œè®©å…¶ä»–çº¿ç¨‹ç»§ç»­ç«äº‰è·å¾—è¯¥å®ä¾‹çš„é”ï¼ˆå› æ­¤è¿™é‡Œæœ‰ä¸ªè§„åˆ™ï¼Œè°ƒç”¨waitçš„çº¿ç¨‹å¿…é¡»æŒæœ‰å½“å‰å®ä¾‹å¯¹è±¡çš„é”ï¼‰ è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š 3.2ï¼šnotifyç°åœ¨å…ˆæ¥ä»‹ç»ä¸‹notifyï¼Œè¯¥æ–¹æ³•ä¼šå°†ç­‰å¾…é˜Ÿåˆ—é‡Œçš„çº¿ç¨‹å–å‡ºï¼Œè®©å…¶é€€å‡ºç­‰å¾…å¹¶å‚ä¸é”ç«äº‰ç„¶åç»§ç»­æ‰§è¡Œä¸Šæ¬¡waitåæ²¡æœ‰æ‰§è¡Œå®Œçš„è¯­å¥ã€‚æ•´ä½“è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¯ä»¥çœ‹åˆ°ï¼Œt1åœ¨è¢«æŒ‚èµ·åï¼Œä¼šå› ä¸ºt2è°ƒç”¨äº†åŒå®ä¾‹çš„notifyæ–¹æ³•ï¼Œè€Œè®©t1è¢«ä»ç­‰å¾…é˜Ÿåˆ—é‡Œé‡Šæ”¾ï¼Œé‡æ–°åŠ å…¥åˆ°æ‰€å¾—ç«äº‰åŠ›ï¼Œt2æ‰§è¡Œå®Œæ¯•åé‡Šæ”¾é”ï¼Œé”åˆå†æ¬¡è¢«t1ç«äº‰åˆ°ï¼Œt1å°†ç»§ç»­æ‰§è¡Œä¸Šæ¬¡è¢«æŒ‚èµ·æ—¶åé¢æœªæ‰§è¡Œå®Œçš„è¯­å¥ã€‚ éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œå¦‚æœç­‰å¾…é˜Ÿåˆ—é‡Œçš„çº¿ç¨‹æ˜¯å¤šä¸ªï¼Œé‚£ä¹ˆè¢«å”¤é†’çš„é‚£ä¸€ä¸ªï¼Œå°†ä¼šæ˜¯ç­‰å¾…é˜Ÿåˆ—é‡Œæ‰€æœ‰çº¿ç¨‹éšæœºçš„ä¸€ä¸ªï¼Œä¸ä¼šç‰¹å®šå“ªä¸€ä¸ªçº¿ç¨‹ä¼šè¢«å”¤èµ·ã€‚ 3.3ï¼šnotifyAllæ¥ä¸‹æ¥ä»‹ç»notifyAllæ–¹æ³•ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°†ç­‰å¾…é˜Ÿåˆ—é‡Œçš„çº¿ç¨‹å…¨éƒ¨å”¤èµ·ï¼Œç„¶åè¿™äº›çº¿ç¨‹å°†å…¨éƒ¨åŠ å…¥åˆ°é”ç«äº‰ï¼Œç«äº‰åˆ°ï¼Œç»§ç»­å®Œæˆä¸Šæ¬¡è¢«æŒ‚èµ·æ—¶æœªæ‰§è¡Œå®Œæ¯•çš„æ“ä½œï¼Œæµç¨‹å›¾å¦‚ä¸‹ï¼š è¯´æ˜ï¼Œå½“çº¿ç¨‹è°ƒç”¨å®ä¾‹çš„waitã€notifyã€notifyAllæ–¹æ³•æœ‰ä¸ªå¤§å‰æï¼Œå°±æ˜¯å¿…é¡»è¦æ±‚è¯¥çº¿ç¨‹æ‹¥æœ‰è¯¥å®ä¾‹çš„é”ï¼Œå¦åˆ™ä¼šæŠ›IllegalMonitorStateExceptionå¼‚å¸¸ã€‚ åœ¨ç¼–å†™ç¨‹åºæ—¶ï¼Œæ˜¯è¯¥é€‰æ‹©notifyè¿˜æ˜¯é€‰æ‹©notifyAllï¼Ÿè¿™ä¸ªå¯ä»¥æŒ‡å‡ºçš„æ˜¯ï¼ŒnotifyAllå¾€å¾€æ›´åŠ å¥å£®ï¼Œè€Œnotifyç”±äºå”¤èµ·çš„çº¿ç¨‹å°‘ï¼Œå› æ­¤æ•ˆç‡ä¼šæ›´é«˜ï¼Œä½†æ˜¯å­˜åœ¨ç¨‹åºåœæ­¢çš„é£é™©ã€‚ é™„ä¸Šä½¿ç”¨waitã€notifyè¿›è¡Œçº¿ç¨‹é€šä¿¡çš„ä¾‹å­ï¼š åˆ©ç”¨ReentrantLockç®€å•å®ç°ä¸€ä¸ªé˜»å¡é˜Ÿåˆ— javaè®¾è®¡æ¨¡å¼ï¼šç®€å•å®ç°ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼","link":"/2019/02/26/%E5%9B%BE%E8%A7%A3java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88%E4%B8%80%EF%BC%89/"},{"title":"ThreadLocalç³»åˆ—ï¼ˆä¸‰ï¼‰-TransmittableThreadLocalçš„ä½¿ç”¨åŠåŸç†è§£æ","text":"ä¸€ã€åŸºæœ¬ä½¿ç”¨é¦–å…ˆï¼ŒTTLæ˜¯ç”¨æ¥è§£å†³ITLè§£å†³ä¸äº†çš„é—®é¢˜è€Œè¯ç”Ÿçš„ï¼Œæ‰€ä»¥TTLä¸€å®šæ˜¯æ”¯æŒçˆ¶çº¿ç¨‹çš„æœ¬åœ°å˜é‡ä¼ é€’ç»™å­çº¿ç¨‹è¿™ç§åŸºæœ¬æ“ä½œçš„ï¼ŒITLä¹Ÿå¯ä»¥åšåˆ°ï¼Œä½†æ˜¯å‰é¢æœ‰è®²è¿‡ï¼ŒITLåœ¨çº¿ç¨‹æ± çš„æ¨¡å¼ä¸‹ï¼Œå°±æ²¡åŠæ³•å†æ­£ç¡®ä¼ é€’äº†ï¼Œæ‰€ä»¥TTLåšå‡ºçš„æ”¹è¿›å°±æ˜¯å³ä¾¿æ˜¯åœ¨çº¿ç¨‹æ± æ¨¡å¼ä¸‹ï¼Œä¹Ÿå¯ä»¥å¾ˆå¥½çš„å°†çˆ¶çº¿ç¨‹æœ¬åœ°å˜é‡ä¼ é€’ä¸‹å»ï¼Œå…ˆæ¥çœ‹ä¸ªä¾‹å­ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103// éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨TTLçš„æ—¶å€™ï¼Œè¦æƒ³ä¼ é€’çš„å€¼ä¸å‡ºé—®é¢˜ï¼Œçº¿ç¨‹æ± å¿…é¡»å¾—ç”¨TTLåŠ ä¸€å±‚ä»£ç†ï¼ˆä¸‹é¢ä¼šè®²è¿™æ ·åšçš„ç›®çš„ï¼‰ private static ExecutorService executorService = TtlExecutors.getTtlExecutorService(Executors.newFixedThreadPool(2)); private static ThreadLocal tl = new TransmittableThreadLocal&lt;&gt;(); //è¿™é‡Œé‡‡ç”¨TTLçš„å®ç° public static void main(String[] args) { new Thread(() -&gt; { String mainThreadName = \"main_01\"; tl.set(1); executorService.execute(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(1), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }); executorService.execute(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(1), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }); executorService.execute(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(1), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }); sleep(1L); //ç¡®ä¿ä¸Šé¢çš„ä¼šåœ¨tl.setæ‰§è¡Œä¹‹å‰æ‰§è¡Œ tl.set(2); // ç­‰ä¸Šé¢çš„çº¿ç¨‹æ± ç¬¬ä¸€æ¬¡å¯ç”¨å®Œäº†ï¼Œçˆ¶çº¿ç¨‹å†ç»™è‡ªå·±èµ‹å€¼ executorService.execute(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(2), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }); executorService.execute(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(2), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }); executorService.execute(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(2), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }); System.out.println(String.format(\"çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", Thread.currentThread().getName(), tl.get())); }).start(); new Thread(() -&gt; { String mainThreadName = \"main_02\"; tl.set(3); executorService.execute(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(3), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }); executorService.execute(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(3), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }); executorService.execute(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(3), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }); sleep(1L); //ç¡®ä¿ä¸Šé¢çš„ä¼šåœ¨tl.setæ‰§è¡Œä¹‹å‰æ‰§è¡Œ tl.set(4); // ç­‰ä¸Šé¢çš„çº¿ç¨‹æ± ç¬¬ä¸€æ¬¡å¯ç”¨å®Œäº†ï¼Œçˆ¶çº¿ç¨‹å†ç»™è‡ªå·±èµ‹å€¼ executorService.execute(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(4), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }); executorService.execute(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(4), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }); executorService.execute(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(4), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }); System.out.println(String.format(\"çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", Thread.currentThread().getName(), tl.get())); }).start(); } private static void sleep(long time) { try { Thread.sleep(time); } catch (InterruptedException e) { e.printStackTrace(); } } ä»£ç å—1 è¿è¡Œç»“æœï¼š 1234567891011121314çº¿ç¨‹åç§°-Thread-2, å˜é‡å€¼=4æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(3), çˆ¶çº¿ç¨‹åç§°-main_02, å­çº¿ç¨‹åç§°-pool-1-thread-1, å˜é‡å€¼=3çº¿ç¨‹åç§°-Thread-1, å˜é‡å€¼=2æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(1), çˆ¶çº¿ç¨‹åç§°-main_01, å­çº¿ç¨‹åç§°-pool-1-thread-2, å˜é‡å€¼=1æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(1), çˆ¶çº¿ç¨‹åç§°-main_01, å­çº¿ç¨‹åç§°-pool-1-thread-1, å˜é‡å€¼=1æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(3), çˆ¶çº¿ç¨‹åç§°-main_02, å­çº¿ç¨‹åç§°-pool-1-thread-2, å˜é‡å€¼=3æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(3), çˆ¶çº¿ç¨‹åç§°-main_02, å­çº¿ç¨‹åç§°-pool-1-thread-2, å˜é‡å€¼=3æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(1), çˆ¶çº¿ç¨‹åç§°-main_01, å­çº¿ç¨‹åç§°-pool-1-thread-1, å˜é‡å€¼=1æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(2), çˆ¶çº¿ç¨‹åç§°-main_01, å­çº¿ç¨‹åç§°-pool-1-thread-2, å˜é‡å€¼=2æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(4), çˆ¶çº¿ç¨‹åç§°-main_02, å­çº¿ç¨‹åç§°-pool-1-thread-1, å˜é‡å€¼=4æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(4), çˆ¶çº¿ç¨‹åç§°-main_02, å­çº¿ç¨‹åç§°-pool-1-thread-1, å˜é‡å€¼=4æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(4), çˆ¶çº¿ç¨‹åç§°-main_02, å­çº¿ç¨‹åç§°-pool-1-thread-2, å˜é‡å€¼=4æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(2), çˆ¶çº¿ç¨‹åç§°-main_01, å­çº¿ç¨‹åç§°-pool-1-thread-1, å˜é‡å€¼=2æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(2), çˆ¶çº¿ç¨‹åç§°-main_01, å­çº¿ç¨‹åç§°-pool-1-thread-2, å˜é‡å€¼=2 ç¨‹åºæœ‰äº›å•°å—¦ï¼Œä¸ºäº†è¯´æ˜é—®é¢˜ï¼ŒåŠ äº†å¾ˆå¤šè¯´æ˜ï¼Œä½†è‡³å°‘é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œä¸éš¾å‘ç°ï¼Œä¸¤ä¸ªä¸»çº¿ç¨‹é‡Œéƒ½ä½¿ç”¨çº¿ç¨‹æ± å¼‚æ­¥ï¼Œè€Œä¸”å€¼åœ¨ä¸»çº¿ç¨‹é‡Œè¿˜å‘ç”Ÿè¿‡æ”¹å˜ï¼Œæµ‹è¯•ç»“æœå±•ç¤ºä¸€åˆ‡æ­£å¸¸ï¼Œç”±æ­¤å¯ä»¥çŸ¥é“TTLåœ¨ä½¿ç”¨çº¿ç¨‹æ± çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥å¾ˆå¥½çš„å®Œæˆä¼ é€’ï¼Œè€Œä¸”ä¸ä¼šå‘ç”Ÿé”™ä¹±ã€‚ é‚£ä¹ˆæ˜¯ä¸æ˜¯å¯¹æ™®é€šçº¿ç¨‹å¼‚æ­¥ä¹Ÿæœ‰è¿™ä¹ˆå¥½çš„æ”¯æ’‘å‘¢ï¼Ÿ æ”¹é€ ä¸‹ä¸Šé¢çš„æµ‹è¯•ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192private static ThreadLocal tl = new TransmittableThreadLocal&lt;&gt;(); public static void main(String[] args) { new Thread(() -&gt; { String mainThreadName = \"main_01\"; tl.set(1); new Thread(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(1), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }).start(); new Thread(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(1), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }).start(); new Thread(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(1), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }).start(); sleep(1L); //ç¡®ä¿ä¸Šé¢çš„ä¼šåœ¨tl.setæ‰§è¡Œä¹‹å‰æ‰§è¡Œ tl.set(2); // ç­‰ä¸Šé¢çš„çº¿ç¨‹æ± ç¬¬ä¸€æ¬¡å¯ç”¨å®Œäº†ï¼Œçˆ¶çº¿ç¨‹å†ç»™è‡ªå·±èµ‹å€¼ new Thread(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(2), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }).start(); new Thread(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(2), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }).start(); new Thread(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(2), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }).start(); System.out.println(String.format(\"çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", Thread.currentThread().getName(), tl.get())); }).start(); new Thread(() -&gt; { String mainThreadName = \"main_02\"; tl.set(3); new Thread(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(3), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }).start(); new Thread(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(3), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }).start(); new Thread(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(3), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }).start(); sleep(1L); //ç¡®ä¿ä¸Šé¢çš„ä¼šåœ¨tl.setæ‰§è¡Œä¹‹å‰æ‰§è¡Œ tl.set(4); // ç­‰ä¸Šé¢çš„çº¿ç¨‹æ± ç¬¬ä¸€æ¬¡å¯ç”¨å®Œäº†ï¼Œçˆ¶çº¿ç¨‹å†ç»™è‡ªå·±èµ‹å€¼ new Thread(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(4), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }).start(); new Thread(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(4), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }).start(); new Thread(() -&gt; { sleep(1L); System.out.println(String.format(\"æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(4), çˆ¶çº¿ç¨‹åç§°-%s, å­çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", mainThreadName, Thread.currentThread().getName(), tl.get())); }).start(); System.out.println(String.format(\"çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", Thread.currentThread().getName(), tl.get())); }).start(); } ä»£ç å—2 ç›¸æ¯”ä»£ç å—1ï¼Œè¿™ä¸€æ®µçš„å¼‚æ­¥å…¨éƒ½æ˜¯æ™®é€šå¼‚æ­¥ï¼Œæœªé‡‡ç”¨çº¿ç¨‹æ± çš„æ–¹å¼è¿›è¡Œå¼‚æ­¥ï¼Œçœ‹ä¸‹è¿è¡Œç»“æœï¼š 1234567891011121314æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(4), çˆ¶çº¿ç¨‹åç§°-main_02, å­çº¿ç¨‹åç§°-Thread-14, å˜é‡å€¼=4æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(1), çˆ¶çº¿ç¨‹åç§°-main_01, å­çº¿ç¨‹åç§°-Thread-5, å˜é‡å€¼=1çº¿ç¨‹åç§°-Thread-1, å˜é‡å€¼=2æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(1), çˆ¶çº¿ç¨‹åç§°-main_01, å­çº¿ç¨‹åç§°-Thread-3, å˜é‡å€¼=1æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(2), çˆ¶çº¿ç¨‹åç§°-main_01, å­çº¿ç¨‹åç§°-Thread-11, å˜é‡å€¼=2æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(3), çˆ¶çº¿ç¨‹åç§°-main_02, å­çº¿ç¨‹åç§°-Thread-6, å˜é‡å€¼=3æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(4), çˆ¶çº¿ç¨‹åç§°-main_02, å­çº¿ç¨‹åç§°-Thread-12, å˜é‡å€¼=4æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(4), çˆ¶çº¿ç¨‹åç§°-main_02, å­çº¿ç¨‹åç§°-Thread-10, å˜é‡å€¼=4æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(3), çˆ¶çº¿ç¨‹åç§°-main_02, å­çº¿ç¨‹åç§°-Thread-8, å˜é‡å€¼=3æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(3), çˆ¶çº¿ç¨‹åç§°-main_02, å­çº¿ç¨‹åç§°-Thread-4, å˜é‡å€¼=3æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å‰(1), çˆ¶çº¿ç¨‹åç§°-main_01, å­çº¿ç¨‹åç§°-Thread-7, å˜é‡å€¼=1çº¿ç¨‹åç§°-Thread-2, å˜é‡å€¼=4æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(2), çˆ¶çº¿ç¨‹åç§°-main_01, å­çº¿ç¨‹åç§°-Thread-9, å˜é‡å€¼=2æœ¬åœ°å˜é‡æ”¹å˜ä¹‹å(2), çˆ¶çº¿ç¨‹åç§°-main_01, å­çº¿ç¨‹åç§°-Thread-13, å˜é‡å€¼=2 okï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¾¾åˆ°äº†è·Ÿç¬¬ä¸€ä¸ªæµ‹è¯•ä¸€è‡´çš„ç»“æœã€‚ åˆ°è¿™é‡Œï¼Œé€šè¿‡ä¸Šè¿°ä¸¤ä¸ªä¾‹å­ï¼ŒTTLçš„åŸºæœ¬ä½¿ç”¨ï¼Œä»¥åŠå…¶è§£å†³çš„é—®é¢˜ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†åˆæ­¥çš„äº†è§£ï¼Œä¸‹é¢æˆ‘ä»¬æ¥è§£æä¸€ä¸‹å…¶å†…éƒ¨åŸç†ï¼Œçœ‹çœ‹TTLæ˜¯æ€ä¹ˆå®Œæˆå¯¹ITLçš„ä¼˜åŒ–çš„ã€‚ äºŒã€åŸç†åˆ†æå…ˆæ¥çœ‹TTLé‡Œé¢çš„å‡ ä¸ªé‡è¦å±æ€§åŠæ–¹æ³• TTLå®šä¹‰ï¼š 1public class TransmittableThreadLocal extends InheritableThreadLocal ä»£ç å—3 å¯ä»¥çœ‹åˆ°ï¼ŒTTLç»§æ‰¿äº†ITLï¼Œæ„å‘³ç€TTLé¦–å…ˆå…·å¤‡ITLçš„åŠŸèƒ½ã€‚ å†æ¥çœ‹çœ‹ä¸€ä¸ªé‡è¦å±æ€§holderï¼š 12345678910111213141516/** * è¿™æ˜¯ä¸€ä¸ªITLç±»å‹çš„å¯¹è±¡ï¼ŒæŒæœ‰ä¸€ä¸ªå…¨å±€çš„WeakMapï¼ˆweakMapçš„keyæ˜¯å¼±å¼•ç”¨ï¼ŒåŒTLä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸ºäº†è§£å†³å†…å­˜æ³„æ¼çš„é—®é¢˜ï¼‰ï¼Œé‡Œé¢å­˜æ”¾äº†TTLå¯¹è±¡ * å¹¶ä¸”é‡å†™äº†initialValueå’ŒchildValueæ–¹æ³•ï¼Œå°¤å…¶æ˜¯childValueï¼Œå¯ä»¥çœ‹åˆ°åœ¨å³å°†å¼‚æ­¥æ—¶çˆ¶çº¿ç¨‹çš„å±æ€§æ˜¯ç›´æ¥ä½œä¸ºåˆå§‹åŒ–å€¼èµ‹å€¼ç»™å­çº¿ç¨‹çš„æœ¬åœ°å˜é‡å¯¹è±¡ï¼ˆTTLï¼‰çš„ */ private static InheritableThreadLocal&lt;Map&lt;TransmittableThreadLocal&lt;?&gt;, ?&gt;&gt; holder = new InheritableThreadLocal&lt;Map&lt;TransmittableThreadLocal&lt;?&gt;, ?&gt;&gt;() { @Override protected Map&lt;TransmittableThreadLocal&lt;?&gt;, ?&gt; initialValue() { return new WeakHashMap&lt;TransmittableThreadLocal&lt;?&gt;, Object&gt;(); } @Override protected Map&lt;TransmittableThreadLocal&lt;?&gt;, ?&gt; childValue(Map&lt;TransmittableThreadLocal&lt;?&gt;, ?&gt; parentValue) { return new WeakHashMap&lt;TransmittableThreadLocal&lt;?&gt;, Object&gt;(parentValue); } }; ä»£ç å—4 å†æ¥çœ‹ä¸‹setå’Œgetï¼š 123456789101112131415161718192021222324//ä¸‹é¢çš„æ–¹æ³•å‡å±äºTTLç±»@Override public final void set(T value) { super.set(value); if (null == value) removeValue(); else addValue(); } @Override public final T get() { T value = super.get(); if (null != value) addValue(); return value; } private void removeValue() { holder.get().remove(this); //ä»holderæŒæœ‰çš„mapå¯¹è±¡ä¸­ç§»é™¤ } private void addValue() { if (!holder.get().containsKey(this)) { holder.get().put(this, null); //ä»holderæŒæœ‰çš„mapå¯¹è±¡ä¸­æ·»åŠ  } } ä»£ç å—5 TTLé‡Œå…ˆäº†è§£ä¸Šè¿°çš„å‡ ä¸ªæ–¹æ³•åŠå¯¹è±¡ï¼Œå¯ä»¥çœ‹å‡ºï¼Œå•çº¯çš„ä½¿ç”¨TTLæ˜¯è¾¾ä¸åˆ°æ”¯æŒçº¿ç¨‹æ± æœ¬åœ°å˜é‡çš„ä¼ é€’çš„ï¼Œé€šè¿‡ç¬¬ä¸€éƒ¨åˆ†çš„ä¾‹å­ï¼Œå¯ä»¥å‘ç°ï¼Œé™¤äº†è¦å¯ç”¨TTLï¼Œè¿˜éœ€è¦é€šè¿‡TtlExecutors.getTtlExecutorServiceåŒ…è£…ä¸€ä¸‹çº¿ç¨‹æ± æ‰å¯ä»¥ï¼Œé‚£ä¹ˆï¼Œä¸‹é¢å°±æ¥çœ‹çœ‹åœ¨ç¨‹åºå³å°†é€šè¿‡çº¿ç¨‹æ± å¼‚æ­¥çš„æ—¶å€™ï¼ŒTTLå¸®æˆ‘ä»¬åšäº†å“ªäº›æ“ä½œï¼ˆè¿™ä¸€éƒ¨åˆ†æ˜¯TTLæ”¯æŒçº¿ç¨‹æ± ä¼ é€’çš„æ ¸å¿ƒéƒ¨åˆ†ï¼‰ï¼š é¦–å…ˆæ‰“å¼€åŒ…è£…ç±»ï¼Œçœ‹ä¸‹executeæ–¹æ³•åœ¨æ‰§è¡Œæ—¶åšäº†äº›ä»€ä¹ˆã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849// æ­¤æ–¹æ³•å±äºçº¿ç¨‹æ± åŒ…è£…ç±»ExecutorTtlWrapper@Override public void execute(@Nonnull Runnable command) { executor.execute(TtlRunnable.get(command)); //è¿™é‡Œä¼šæŠŠRannableåŒ…è£…ä¸€å±‚ï¼Œè¿™æ˜¯å…³é”®ï¼Œæœ‰äº›é€»è¾‘å¤„ç†ï¼Œéœ€è¦åœ¨runä¹‹å‰æ‰§è¡Œ } // å¯¹åº”ä¸Šé¢çš„getæ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªTtlRunnableå¯¹è±¡ï¼Œå±äºTtLRannableåŒ…è£…ç±» @Nullable public static TtlRunnable get(@Nullable Runnable runnable) { return get(runnable, false, false); } // å¯¹åº”ä¸Šé¢çš„getæ–¹æ³• @Nullable public static TtlRunnable get(@Nullable Runnable runnable, boolean releaseTtlValueReferenceAfterRun, boolean idempotent) { if (null == runnable) return null; if (runnable instanceof TtlEnhanced) { // è‹¥å‘ç°å·²ç»æ˜¯ç›®æ ‡ç±»å‹äº†ï¼ˆè¯´æ˜å·²ç»è¢«åŒ…è£…è¿‡äº†ï¼‰ç›´æ¥è¿”å› // avoid redundant decoration, and ensure idempotency if (idempotent) return (TtlRunnable) runnable; else throw new IllegalStateException(\"Already TtlRunnable!\"); } return new TtlRunnable(runnable, releaseTtlValueReferenceAfterRun); //æœ€ç»ˆåˆå§‹åŒ– } // å¯¹åº”ä¸Šé¢çš„TtlRunnableæ–¹æ³• private TtlRunnable(@Nonnull Runnable runnable, boolean releaseTtlValueReferenceAfterRun) { this.capturedRef = new AtomicReference&lt;Object&gt;(capture()); //è¿™é‡Œå°†æ•è·åçš„çˆ¶çº¿ç¨‹æœ¬åœ°å˜é‡å­˜å‚¨åœ¨å½“å‰å¯¹è±¡çš„capturedRefé‡Œ this.runnable = runnable; this.releaseTtlValueReferenceAfterRun = releaseTtlValueReferenceAfterRun; } // å¯¹åº”ä¸Šé¢çš„captureæ–¹æ³•ï¼Œç”¨äºæ•è·å½“å‰çº¿ç¨‹ï¼ˆçˆ¶çº¿ç¨‹ï¼‰é‡Œçš„æœ¬åœ°å˜é‡ï¼Œæ­¤æ–¹æ³•å±äºTTLçš„é™æ€å†…éƒ¨ç±»Transmitter @Nonnull public static Object capture() { Map&lt;TransmittableThreadLocal&lt;?&gt;, Object&gt; captured = new HashMap&lt;TransmittableThreadLocal&lt;?&gt;, Object&gt;(); for (TransmittableThreadLocal&lt;?&gt; threadLocal : holder.get().keySet()) { // holderé‡Œç›®å‰å­˜æ”¾çš„k-vé‡Œçš„keyï¼Œå°±æ˜¯éœ€è¦ä¼ ç»™å­çº¿ç¨‹çš„TTLå¯¹è±¡ captured.put(threadLocal, threadLocal.copyValue()); } return captured; // è¿™é‡Œè¿”å›çš„è¿™ä¸ªå¯¹è±¡ï¼Œå°±æ˜¯å½“å‰å°†è¦ä½¿ç”¨çº¿ç¨‹æ± å¼‚æ­¥å‡ºæ¥çš„å­çº¿ç¨‹ï¼Œæ‰€ç»§æ‰¿çš„æœ¬åœ°å˜é‡åˆé›† } // å¯¹åº”ä¸Šé¢çš„copyValueï¼Œç®€å•çš„å°†TTLå¯¹è±¡é‡Œçš„å€¼è¿”å›ï¼ˆç»“åˆä¹‹å‰çš„æºç å¯ä»¥çŸ¥é“getæ–¹æ³•å…¶å®å°±æ˜¯è·å–å½“å‰çº¿ç¨‹ï¼ˆçˆ¶çº¿ç¨‹ï¼‰é‡Œçš„å€¼ï¼Œè°ƒç”¨super.getæ–¹æ³•ï¼‰ private T copyValue() { return copy(get()); } protected T copy(T parentValue) { return parentValue; } ä»£ç å—6 ç»“åˆä¸Šè¿°ä»£ç ï¼Œå¤§è‡´çŸ¥é“äº†åœ¨çº¿ç¨‹æ± å¼‚æ­¥ä¹‹å‰éœ€è¦åšçš„äº‹æƒ…ï¼Œå…¶å®å°±æ˜¯æŠŠå½“å‰çˆ¶çº¿ç¨‹é‡Œçš„æœ¬åœ°å˜é‡å–å‡ºæ¥ï¼Œç„¶åèµ‹å€¼ç»™RannableåŒ…è£…ç±»é‡Œçš„capturedRefå±æ€§ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œä¸‹é¢ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œæˆ‘ä»¬å¤§è‡´ä¸Šå¯ä»¥çŒœå‡ºæ¥äº†ï¼Œæ¥ä¸‹æ¥å¤§æ¦‚ç‡ä¼šåœ¨runæ–¹æ³•é‡Œï¼Œå°†è¿™äº›æ•è·åˆ°çš„å€¼èµ‹ç»™å­çº¿ç¨‹çš„holderèµ‹å¯¹åº”çš„TTLå€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹RannableåŒ…è£…ç±»é‡Œçš„runæ–¹æ³•æ˜¯æ€ä¹ˆå®ç°çš„ï¼š 1234567891011121314151617181920//runæ–¹æ³•å±äºRannableçš„åŒ…è£…ç±»TtlRunnable@Override public void run() { Object captured = capturedRef.get(); // è·å–ç”±ä¹‹å‰æ•è·åˆ°çš„çˆ¶çº¿ç¨‹å˜é‡é›† if (captured == null || releaseTtlValueReferenceAfterRun &amp;&amp; !capturedRef.compareAndSet(captured, null)) { throw new IllegalStateException(\"TTL value reference is released after run!\"); } /** * é‡ç‚¹æ–¹æ³•replayï¼Œæ­¤æ–¹æ³•ç”¨æ¥ç»™å½“å‰å­çº¿ç¨‹èµ‹æœ¬åœ°å˜é‡ï¼Œè¿”å›çš„backupæ˜¯æ­¤å­çº¿ç¨‹åŸæ¥å°±æœ‰çš„æœ¬åœ°å˜é‡å€¼ï¼ˆåŸç”Ÿæœ¬åœ°å˜é‡ï¼Œä¸‹é¢ä¼šè¯¦ç»†è®²ï¼‰ï¼Œ * backupç”¨äºæ¢å¤æ•°æ®ï¼ˆå¦‚æœä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œæ„å‘³ç€è¯¥å­çº¿ç¨‹ä¼šå½’è¿˜çº¿ç¨‹æ± ï¼Œé‚£ä¹ˆéœ€è¦å°†å…¶åŸç”Ÿæœ¬åœ°å˜é‡å±æ€§æ¢å¤ï¼‰ */ Object backup = replay(captured); try { runnable.run(); // æ‰§è¡Œå¼‚æ­¥é€»è¾‘ } finally { restore(backup); // ç»“åˆä¸Šé¢å¯¹äºreplayçš„è§£é‡Šï¼Œä¸éš¾ç†è§£ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯ç”¨æ¥æ¢å¤åŸæœ‰å€¼çš„ } } ä»£ç å—7 æ ¹æ®ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†TTLåœ¨å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå‰ï¼Œä¼šå…ˆè¿›è¡Œèµ‹å€¼æ“ä½œï¼ˆå°±æ˜¯æ‹¿ç€å¼‚æ­¥å‘ç”Ÿæ—¶æ•è·åˆ°çš„çˆ¶çº¿ç¨‹çš„æœ¬åœ°å˜é‡ï¼Œèµ‹ç»™è‡ªå·±ï¼‰ï¼Œå½“ä»»åŠ¡æ‰§è¡Œå®Œï¼Œå°±æ¢å¤åŸç”Ÿçš„è‡ªå·±æœ¬èº«çš„çº¿ç¨‹å˜é‡å€¼ã€‚ ä¸‹é¢æ¥å…·ä½“çœ‹è¿™ä¿©æ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677//ä¸‹é¢çš„æ–¹æ³•å‡å±äºTTLçš„é™æ€å†…éƒ¨ç±»Transmittable@Nonnull public static Object replay(@Nonnull Object captured) { @SuppressWarnings(\"unchecked\") Map&lt;TransmittableThreadLocal&lt;?&gt;, Object&gt; capturedMap = (Map&lt;TransmittableThreadLocal&lt;?&gt;, Object&gt;) captured; //ä½¿ç”¨æ­¤çº¿ç¨‹å¼‚æ­¥æ—¶æ•è·åˆ°çš„çˆ¶çº¿ç¨‹é‡Œçš„æœ¬åœ°å˜é‡å€¼ Map&lt;TransmittableThreadLocal&lt;?&gt;, Object&gt; backup = new HashMap&lt;TransmittableThreadLocal&lt;?&gt;, Object&gt;(); //å½“å‰çº¿ç¨‹åŸç”Ÿçš„æœ¬åœ°å˜é‡ï¼Œç”¨äºä½¿ç”¨å®Œçº¿ç¨‹åæ¢å¤ç”¨ //æ³¨æ„ï¼šè¿™é‡Œå¾ªç¯çš„æ˜¯å½“å‰å­çº¿ç¨‹åŸç”Ÿçš„æœ¬åœ°å˜é‡é›†åˆï¼Œä¸æœ¬æ–¹æ³•ç›¸åï¼Œrestoreæ–¹æ³•é‡Œå¾ªç¯è¿™ä¸ªholderæ˜¯æŒ‡ï¼šè¯¥çº¿ç¨‹è¿è¡ŒæœŸé—´äº§ç”Ÿçš„å˜é‡+çˆ¶çº¿ç¨‹ç»§æ‰¿æ¥çš„å˜é‡ for (Iterator&lt;? extends Map.Entry&lt;TransmittableThreadLocal&lt;?&gt;, ?&gt;&gt; iterator = holder.get().entrySet().iterator(); iterator.hasNext(); ) { Map.Entry&lt;TransmittableThreadLocal&lt;?&gt;, ?&gt; next = iterator.next(); TransmittableThreadLocal&lt;?&gt; threadLocal = next.getKey(); backup.put(threadLocal, threadLocal.get()); // æ‰€æœ‰åŸç”Ÿçš„æœ¬åœ°å˜é‡éƒ½æš‚æ—¶å­˜å‚¨åœ¨backupé‡Œï¼Œç”¨äºä¹‹åæ¢å¤ç”¨ /** * æ£€æŸ¥ï¼Œå¦‚æœæ•è·åˆ°çš„çº¿ç¨‹å˜é‡é‡Œï¼Œä¸åŒ…å«å½“å‰åŸç”Ÿå˜é‡å€¼ï¼Œåˆ™ä»å½“å‰åŸç”Ÿå˜é‡é‡Œæ¸…é™¤æ‰ï¼Œå¯¹åº”çš„çº¿ç¨‹æœ¬åœ°å˜é‡ä¹Ÿæ¸…æ‰ * è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¼šå°†åŸç”Ÿå˜é‡ä¿å­˜åœ¨backupé‡Œçš„åŸå› ï¼Œä¸ºäº†æ¢å¤åŸç”Ÿå€¼ä½¿ç”¨ * é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿™é‡Œè¦æ¸…é™¤æ‰å‘¢ï¼Ÿå› ä¸ºä»ä½¿ç”¨è¿™ä¸ªå­çº¿ç¨‹åšå¼‚æ­¥é‚£é‡Œï¼Œæ•è·åˆ°çš„æœ¬åœ°å˜é‡å¹¶ä¸åŒ…å«åŸç”Ÿçš„å˜é‡ï¼Œå½“å‰çº¿ç¨‹ * åœ¨åšä»»åŠ¡æ—¶çš„é¦–è¦ç›®æ ‡ï¼Œæ˜¯å°†çˆ¶çº¿ç¨‹é‡Œçš„å˜é‡å®Œå…¨ä¼ é€’ç»™ä»»åŠ¡ï¼Œå¦‚æœä¸æ¸…é™¤è¿™ä¸ªå­çº¿ç¨‹åŸç”Ÿçš„æœ¬åœ°å˜é‡ï¼Œ * æ„å‘³ç€å¾ˆå¯èƒ½ä¼šå½±å“åˆ°ä»»åŠ¡é‡Œå–å€¼çš„å‡†ç¡®æ€§ã€‚ * * æ‰“ä¸ªæ¯”æ–¹ï¼Œæœ‰ttlå¯¹è±¡tlï¼Œè¿™ä¸ªtlåœ¨çº¿ç¨‹æ± çš„æŸä¸ªå­çº¿ç¨‹é‡Œå­˜åœ¨å¯¹åº”çš„å€¼2ï¼Œå½“æŸä¸ªä¸»çº¿ç¨‹ä½¿ç”¨è¯¥å­çº¿ç¨‹åšå¼‚æ­¥ä»»åŠ¡æ—¶ * tlè¿™ä¸ªå¯¹è±¡åœ¨å½“å‰ä¸»çº¿ç¨‹é‡Œæ²¡æœ‰å€¼ï¼Œé‚£ä¹ˆå¦‚æœä¸è¿›è¡Œä¸‹é¢è¿™ä¸€æ­¥çš„æ“ä½œï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨è¯¥å­çº¿ç¨‹åšçš„ä»»åŠ¡é‡Œå°±å¯ä»¥é€šè¿‡ * è¯¥tlå¯¹è±¡å–åˆ°å€¼2ï¼Œä¸ç¬¦åˆé¢„æœŸ */ if (!capturedMap.containsKey(threadLocal)) { iterator.remove(); threadLocal.superRemove(); } } // è¿™ä¸€æ­¥å°±æ˜¯ç›´æ¥æŠŠçˆ¶çº¿ç¨‹æœ¬åœ°å˜é‡èµ‹å€¼ç»™å½“å‰çº¿ç¨‹äº†ï¼ˆè¿™ä¸€æ­¥èµ·å°±åˆ·æ–°äº†holderé‡Œçš„å€¼äº†ï¼Œå…·ä½“å¾€ä¸‹çœ‹è¯¥æ–¹æ³•ï¼Œåœ¨å¼‚æ­¥çº¿ç¨‹è¿è¡ŒæœŸé—´ï¼Œè¿˜å¯èƒ½äº§ç”Ÿåˆ«çš„æœ¬åœ°å˜é‡ï¼Œæ¯”å¦‚åœ¨çœŸæ­£çš„runæ–¹æ³•å†…çš„ä¸šåŠ¡ä»£ç ï¼Œå†ç”¨ä¸€ä¸ªtlå¯¹è±¡è®¾ç½®ä¸€ä¸ªå€¼ï¼‰ setTtlValuesTo(capturedMap); // è¿™ä¸ªæ–¹æ³•å±äºæ‰©å±•æ–¹æ³•ï¼Œttlæœ¬èº«æ”¯æŒé‡å†™å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå‰åçš„æ“ä½œï¼Œè¿™é‡Œä¸å†å…·ä½“èµ˜è¿° doExecuteCallback(true); return backup; } // ç»“åˆä¹‹å‰RannableåŒ…è£…ç±»çš„runæ–¹æ³•æ¥çœ‹ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯ä½¿ç”¨ä¸Šé¢replayè®°å½•ä¸‹çš„åŸç”Ÿçº¿ç¨‹å˜é‡åšæ¢å¤ç”¨çš„ public static void restore(@Nonnull Object backup) { @SuppressWarnings(\"unchecked\") Map&lt;TransmittableThreadLocal&lt;?&gt;, Object&gt; backupMap = (Map&lt;TransmittableThreadLocal&lt;?&gt;, Object&gt;) backup; // call afterExecute callback doExecuteCallback(false); // æ³¨æ„ï¼Œè¿™é‡Œçš„holderå–å‡ºæ¥çš„ï¼Œå®é™…ä¸Šæ˜¯replayæ–¹æ³•è®¾ç½®è¿›å»çš„å…³äºçˆ¶çº¿ç¨‹é‡Œçš„æ‰€æœ‰å˜é‡ï¼ˆç»“åˆä¸Šé¢æ¥çœ‹ï¼Œå°±æ˜¯ï¼šè¯¥çº¿ç¨‹è¿è¡ŒæœŸé—´äº§ç”Ÿçš„å˜é‡+çˆ¶çº¿ç¨‹ç»§æ‰¿æ¥çš„å˜é‡ï¼‰ for (Iterator&lt;? extends Map.Entry&lt;TransmittableThreadLocal&lt;?&gt;, ?&gt;&gt; iterator = holder.get().entrySet().iterator(); iterator.hasNext(); ) { Map.Entry&lt;TransmittableThreadLocal&lt;?&gt;, ?&gt; next = iterator.next(); TransmittableThreadLocal&lt;?&gt; threadLocal = next.getKey(); /** * åŒæ ·çš„ï¼Œå¦‚æœå­çº¿ç¨‹åŸç”Ÿå˜é‡ä¸åŒ…å«æŸä¸ªçˆ¶çº¿ç¨‹ä¼ æ¥çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå°±åˆ é™¤ï¼Œå¯ä»¥æ€è€ƒä¸‹ï¼Œè¿™é‡Œçš„æ¸…é™¤è·Ÿä¸Šé¢replayé‡Œçš„æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ * è¿™é‡Œä¼šæŠŠä¸å±äºåŸç”Ÿå˜é‡çš„å¯¹è±¡ç»™åˆ é™¤æ‰ï¼ˆè¿™é‡Œè¢«åˆ é™¤æ‰çš„å¯èƒ½æ˜¯çˆ¶çº¿ç¨‹ç»§æ‰¿ä¸‹æ¥çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯å¼‚æ­¥ä»»åŠ¡åœ¨æ‰§è¡Œæ—¶äº§ç”Ÿçš„æ–°å€¼ï¼‰ */ if (!backupMap.containsKey(threadLocal)) { iterator.remove(); threadLocal.superRemove(); } } // åŒæ ·è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè¿›è¡Œå€¼çš„æ¢å¤ setTtlValuesTo(backupMap); } // çœŸæ­£ç»™å½“å‰å­çº¿ç¨‹èµ‹å€¼çš„æ–¹æ³•ï¼Œå¯¹åº”ä¸Šé¢çš„setTtlValuesToæ–¹æ³• private static void setTtlValuesTo(@Nonnull Map&lt;TransmittableThreadLocal&lt;?&gt;, Object&gt; ttlValues) { for (Map.Entry&lt;TransmittableThreadLocal&lt;?&gt;, Object&gt; entry : ttlValues.entrySet()) { @SuppressWarnings(\"unchecked\") TransmittableThreadLocal&lt;Object&gt; threadLocal = (TransmittableThreadLocal&lt;Object&gt;) entry.getKey(); threadLocal.set(entry.getValue()); //èµ‹å€¼ï¼Œæ³¨æ„ï¼Œä»è¿™é‡Œå¼€å§‹ï¼Œå­çº¿ç¨‹çš„holderé‡Œçš„å€¼ä¼šè¢«é‡æ–°èµ‹å€¼åˆ·æ–°ï¼Œå¯ä»¥å‚ç…§ä¸Šé¢ttlçš„setæ–¹æ³•çš„å®ç° } } ä»£ç å—8 okï¼Œåˆ°è¿™é‡ŒåŸºæœ¬ä¸ŠæŠŠTTLæ¯”è¾ƒæ ¸å¿ƒçš„ä»£ç çœ‹å®Œäº†ï¼Œä¸‹é¢æ•´ç†ä¸‹æ•´ä¸ªæµç¨‹ï¼Œè¿™æ˜¯å®˜æ–¹ç»™å‡ºçš„æ—¶åºå›¾ï¼š ä¸Šå›¾ç¬¬ä¸€è¡ŒæŒ‡çš„æ˜¯ç±»åç§°ï¼Œä¸‹é¢çš„æµç¨‹æŒ‡çš„æ˜¯ç±»æ‰€åšçš„äº‹æƒ…ï¼Œæ ¹æ®ä¸Šé¢ç½—åˆ—å‡ºæ¥çš„æºç ï¼Œç»“åˆè¿™ä¸ªæ—¶åºå›¾ï¼Œå¯ä»¥æ¯”è¾ƒç›´è§‚ä¸€äº›çš„ç†è§£æ•´ä¸ªæµç¨‹ã€‚ ä¸‰ã€TTLä¸­çº¿ç¨‹æ± å­çº¿ç¨‹åŸç”Ÿå˜é‡çš„äº§ç”Ÿè¿™ä¸€èŠ‚æ˜¯ä¸ºäº†éªŒè¯ä¸Šé¢replayå’Œrestoreï¼Œç°åœ¨é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥éªŒè¯ä¸‹ï¼Œå…ˆæŠŠæºç downä¸‹æ¥ï¼Œåœ¨æºç çš„restoreå’Œreplayä¸Šåˆ†åˆ«åŠ ä¸Šè¾“å‡ºè¯­å¥ï¼Œéå†holderï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657//replayå‰åæ‰“å°holderé‡Œé¢çš„å€¼public static Object replay(@Nonnull Object captured) { @SuppressWarnings(\"unchecked\") Map&lt;TransmittableThreadLocal&lt;?&gt;, Object&gt; capturedMap = (Map&lt;TransmittableThreadLocal&lt;?&gt;, Object&gt;) captured; Map&lt;TransmittableThreadLocal&lt;?&gt;, Object&gt; backup = new HashMap&lt;TransmittableThreadLocal&lt;?&gt;, Object&gt;(); System.out.println(\"--------------------replayå‰ç½®ï¼Œå½“å‰æ‹¿åˆ°çš„holderé‡Œçš„TTLåˆ—è¡¨\"); for (Iterator&lt;? extends Map.Entry&lt;TransmittableThreadLocal&lt;?&gt;, ?&gt;&gt; iterator = holder.get().entrySet().iterator(); iterator.hasNext(); ) { Map.Entry&lt;TransmittableThreadLocal&lt;?&gt;, ?&gt; next = iterator.next(); TransmittableThreadLocal&lt;?&gt; threadLocal = next.getKey(); System.out.println(String.format(\"replayå‰ç½®é‡Œæ‹¿åˆ°åŸç”Ÿçš„ttl_k=%s, ttl_value=%s\", threadLocal.hashCode(), threadLocal.get())); } for...//ä»£ç çœç•¥ï¼Œå…·ä½“çœ‹ä¸Šé¢ setTtlValuesTo(capturedMap); doExecuteCallback(true); System.out.println(\"--------------------replyåç½®ï¼Œå½“å‰æ‹¿åˆ°çš„holderé‡Œçš„TTLåˆ—è¡¨\"); for (Iterator&lt;? extends Map.Entry&lt;TransmittableThreadLocal&lt;?&gt;, ?&gt;&gt; iterator = holder.get().entrySet().iterator(); iterator.hasNext(); ) { Map.Entry&lt;TransmittableThreadLocal&lt;?&gt;, ?&gt; next = iterator.next(); TransmittableThreadLocal&lt;?&gt; threadLocal = next.getKey(); System.out.println(String.format(\"replayåç½®é‡Œæ‹¿åˆ°åŸç”Ÿçš„ttl_k=%s, ttl_value=%s\", threadLocal.hashCode(), threadLocal.get())); } return backup; }//restoreå‰åæ‰“å°holderé‡Œé¢çš„å€¼public static void restore(@Nonnull Object backup) { @SuppressWarnings(\"unchecked\") Map&lt;TransmittableThreadLocal&lt;?&gt;, Object&gt; backupMap = (Map&lt;TransmittableThreadLocal&lt;?&gt;, Object&gt;) backup; // call afterExecute callback doExecuteCallback(false); System.out.println(\"--------------------restoreå‰ç½®ï¼Œå½“å‰æ‹¿åˆ°çš„holderé‡Œçš„TTLåˆ—è¡¨\"); for (Iterator&lt;? extends Map.Entry&lt;TransmittableThreadLocal&lt;?&gt;, ?&gt;&gt; iterator = holder.get().entrySet().iterator(); iterator.hasNext(); ) { Map.Entry&lt;TransmittableThreadLocal&lt;?&gt;, ?&gt; next = iterator.next(); TransmittableThreadLocal&lt;?&gt; threadLocal = next.getKey(); System.out.println(String.format(\"restoreå‰ç½®é‡Œæ‹¿åˆ°å½“å‰çº¿ç¨‹å†…å˜é‡ï¼Œttl_k=%s, ttl_value=%s\", threadLocal.hashCode(), threadLocal.get())); } for...//çœç•¥ä»£ç ï¼Œå…·ä½“å…·ä½“çœ‹ä¸Šé¢ setTtlValuesTo(backupMap); System.out.println(\"--------------------restoreåç½®ï¼Œå½“å‰æ‹¿åˆ°çš„holderé‡Œçš„TTLåˆ—è¡¨\"); for (Iterator&lt;? extends Map.Entry&lt;TransmittableThreadLocal&lt;?&gt;, ?&gt;&gt; iterator = holder.get().entrySet().iterator(); iterator.hasNext(); ) { Map.Entry&lt;TransmittableThreadLocal&lt;?&gt;, ?&gt; next = iterator.next(); TransmittableThreadLocal&lt;?&gt; threadLocal = next.getKey(); System.out.println(String.format(\"restoreåç½®é‡Œæ‹¿åˆ°å½“å‰çº¿ç¨‹å†…å˜é‡ï¼Œttl_k=%s, ttl_value=%s\", threadLocal.hashCode(), threadLocal.get())); } } ä»£ç å—9 ä»£ç è¿™æ ·åšçš„ç›®çš„ï¼Œå°±æ˜¯è¦è¯´æ˜çº¿ç¨‹æ± æ‰€è°“çš„åŸç”Ÿæœ¬åœ°å˜é‡æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Œä»¥åŠreplayå’Œrestoreæ˜¯æ€ä¹ˆè®¾ç½®å’Œæ¢å¤çš„ï¼Œä¸‹é¢æ¥çœ‹ä¸ªç®€å•çš„ä¾‹å­ï¼š 123456789101112131415161718192021private static ExecutorService executorService = TtlExecutors.getTtlExecutorService(Executors.newFixedThreadPool(1)); private static ThreadLocal tl = new TransmittableThreadLocal(); private static ThreadLocal tl2 = new TransmittableThreadLocal(); public static void main(String[] args) throws InterruptedException { tl.set(1); tl2.set(2); executorService.execute(new Runnable() { @Override public void run() { try { Thread.sleep(1000L); } catch (InterruptedException e) { e.printStackTrace(); } } }); } ä»£ç å—10 è¿è¡Œç»“æœå¦‚ä¸‹ï¼š 123456789101112--------------------replayå‰ç½®ï¼Œå½“å‰æ‹¿åˆ°çš„holderé‡Œçš„TTLåˆ—è¡¨replayå‰ç½®é‡Œæ‹¿åˆ°åŸç”Ÿçš„ttl_k=1259475182, ttl_value=2replayå‰ç½®é‡Œæ‹¿åˆ°åŸç”Ÿçš„ttl_k=929338653, ttl_value=1--------------------replyåç½®ï¼Œå½“å‰æ‹¿åˆ°çš„holderé‡Œçš„TTLåˆ—è¡¨replayåç½®é‡Œæ‹¿åˆ°åŸç”Ÿçš„ttl_k=1259475182, ttl_value=2replayåç½®é‡Œæ‹¿åˆ°åŸç”Ÿçš„ttl_k=929338653, ttl_value=1--------------------restoreå‰ç½®ï¼Œå½“å‰æ‹¿åˆ°çš„holderé‡Œçš„TTLåˆ—è¡¨restoreå‰ç½®é‡Œæ‹¿åˆ°å½“å‰çº¿ç¨‹å†…å˜é‡ï¼Œttl_k=1259475182, ttl_value=2restoreå‰ç½®é‡Œæ‹¿åˆ°å½“å‰çº¿ç¨‹å†…å˜é‡ï¼Œttl_k=929338653, ttl_value=1--------------------restoreåç½®ï¼Œå½“å‰æ‹¿åˆ°çš„holderé‡Œçš„TTLåˆ—è¡¨restoreåç½®é‡Œæ‹¿åˆ°å½“å‰çº¿ç¨‹å†…å˜é‡ï¼Œttl_k=1259475182, ttl_value=2restoreåç½®é‡Œæ‹¿åˆ°å½“å‰çº¿ç¨‹å†…å˜é‡ï¼Œttl_k=929338653, ttl_value=1 æˆ‘ä»¬ä¼šå‘ç°ï¼ŒåŸç”Ÿå€¼äº§ç”Ÿäº†ï¼Œä»å¼‚æ­¥å¼€å§‹ï¼Œå°±ç¡®å®šäº†çº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹å…·å¤‡äº†1å’Œ2çš„å€¼ï¼Œé‚£ä¹ˆï¼Œå†æ¥æ”¹åŠ¨ä¸‹ä¸Šé¢çš„æµ‹è¯•ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031public static void main(String[] args) throws InterruptedException { tl.set(1); executorService.execute(new Runnable() { @Override public void run() { try { Thread.sleep(100L); } catch (InterruptedException e) { e.printStackTrace(); } } }); Thread.sleep(1000L); tl2.set(2);//è¾ƒç¬¬ä¸€æ¬¡æ¢ä¸‹ä½ç½®ï¼Œæ¢åˆ°ç¬¬ä¸€æ¬¡ä½¿ç”¨çº¿ç¨‹æ± åæ‰§è¡Œï¼ˆè¿™æ„å‘³ç€ä¸‹é¢è¿™æ¬¡å¼‚æ­¥ä¸ä¼šå†è§¦å‘Threadçš„initæ–¹æ³•äº†ï¼‰ System.out.println(\"---------------------------------------------------------------------------------\"); executorService.execute(new Runnable() { @Override public void run() { try { Thread.sleep(1000L); } catch (InterruptedException e) { e.printStackTrace(); } } }); } ä»£ç å—11 è¿è¡Œç»“æœä¸ºï¼š 12345678910111213141516171819--------------------replayå‰ç½®ï¼Œå½“å‰æ‹¿åˆ°çš„holderé‡Œçš„TTLåˆ—è¡¨replayå‰ç½®é‡Œæ‹¿åˆ°åŸç”Ÿçš„ttl_k=929338653, ttl_value=1--------------------replyåç½®ï¼Œå½“å‰æ‹¿åˆ°çš„holderé‡Œçš„TTLåˆ—è¡¨replayåç½®é‡Œæ‹¿åˆ°åŸç”Ÿçš„ttl_k=929338653, ttl_value=1--------------------restoreå‰ç½®ï¼Œå½“å‰æ‹¿åˆ°çš„holderé‡Œçš„TTLåˆ—è¡¨restoreå‰ç½®é‡Œæ‹¿åˆ°å½“å‰çº¿ç¨‹å†…å˜é‡ï¼Œttl_k=929338653, ttl_value=1--------------------restoreåç½®ï¼Œå½“å‰æ‹¿åˆ°çš„holderé‡Œçš„TTLåˆ—è¡¨restoreåç½®é‡Œæ‹¿åˆ°å½“å‰çº¿ç¨‹å†…å˜é‡ï¼Œttl_k=929338653, ttl_value=1-----------------------------------------------------------------------------------------------------replayå‰ç½®ï¼Œå½“å‰æ‹¿åˆ°çš„holderé‡Œçš„TTLåˆ—è¡¨replayå‰ç½®é‡Œæ‹¿åˆ°åŸç”Ÿçš„ttl_k=929338653, ttl_value=1--------------------replyåç½®ï¼Œå½“å‰æ‹¿åˆ°çš„holderé‡Œçš„TTLåˆ—è¡¨replayåç½®é‡Œæ‹¿åˆ°åŸç”Ÿçš„ttl_k=1020371697, ttl_value=2replayåç½®é‡Œæ‹¿åˆ°åŸç”Ÿçš„ttl_k=929338653, ttl_value=1--------------------restoreå‰ç½®ï¼Œå½“å‰æ‹¿åˆ°çš„holderé‡Œçš„TTLåˆ—è¡¨restoreå‰ç½®é‡Œæ‹¿åˆ°å½“å‰çº¿ç¨‹å†…å˜é‡ï¼Œttl_k=1020371697, ttl_value=2restoreå‰ç½®é‡Œæ‹¿åˆ°å½“å‰çº¿ç¨‹å†…å˜é‡ï¼Œttl_k=929338653, ttl_value=1--------------------restoreåç½®ï¼Œå½“å‰æ‹¿åˆ°çš„holderé‡Œçš„TTLåˆ—è¡¨restoreåç½®é‡Œæ‹¿åˆ°å½“å‰çº¿ç¨‹å†…å˜é‡ï¼Œttl_k=929338653, ttl_value=1 å¯ä»¥å‘ç°ï¼Œç¬¬ä¸€æ¬¡å¼‚æ­¥æ—¶ï¼Œåªæœ‰ä¸€ä¸ªå€¼è¢«ä¼ é€’äº†ä¸‹å»ï¼Œç„¶åç¬¬äºŒæ¬¡å¼‚æ­¥ï¼Œæ–°åŠ äº†ä¸€ä¸ªtl2çš„å€¼ï¼Œä½†æ˜¯çœ‹ç¬¬äºŒæ¬¡å¼‚æ­¥çš„æ‰“å°ï¼Œä¼šå‘ç°ï¼Œrestoreæ¢å¤åï¼Œä»ç„¶æ˜¯ç¬¬ä¸€æ¬¡å¼‚æ­¥å‘ç”Ÿæ—¶æ”¾è¿›å»çš„é‚£ä¸ªtlçš„å€¼ã€‚ é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼ŒåŸºæœ¬å¯ä»¥ç¡®è®¤ï¼Œæ‰€è°“çº¿ç¨‹æ± å†…çº¿ç¨‹çš„æœ¬åœ°åŸç”Ÿå˜é‡ï¼Œå…¶å®æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨çº¿ç¨‹æ—¶è¢«ä¼ é€’è¿›å»çš„å€¼ï¼Œæˆ‘ä»¬ä¹‹å‰æœ‰è¯´è¿‡TTLæ˜¯ç»§æ‰¿è‡³ITLçš„ï¼Œä¹‹å‰çš„æ–‡ç« ä¹Ÿè¯´è¿‡ï¼Œçº¿ç¨‹æ± ç¬¬ä¸€æ¬¡å¯ç”¨æ—¶æ˜¯ä¼šè§¦å‘Threadçš„initæ–¹æ³•çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ç¬¬ä¸€æ¬¡å¼‚æ­¥æ—¶æ‹¿åˆ°çš„ä¸»çº¿ç¨‹çš„å˜é‡ä¼šè¢«ä¼ é€’ç»™å­çº¿ç¨‹ï¼Œä½œä¸ºå­çº¿ç¨‹çš„åŸç”Ÿæœ¬åœ°å˜é‡ä¿å­˜èµ·æ¥ï¼Œåç»­æ˜¯replayæ“ä½œå’Œrestoreæ“ä½œä¹Ÿæ˜¯å›´ç»•ç€è¿™ä¸ªåŸç”Ÿå˜é‡ï¼ˆå³åŸç”Ÿholderé‡Œçš„å€¼ï¼‰æ¥è¿›è¡Œè®¾ç½®ã€æ¢å¤çš„ï¼Œè®¾ç½®çš„æ˜¯å½“å‰çˆ¶çº¿ç¨‹æ•è·åˆ°çš„æœ¬åœ°å˜é‡ï¼Œæ¢å¤çš„æ˜¯å­çº¿ç¨‹åŸç”Ÿæœ¬åœ°å˜é‡ã€‚ holderé‡ŒæŒæœ‰çš„å¯ä»¥ç†è§£å°±æ˜¯å½“å‰çº¿ç¨‹å†…çš„æ‰€æœ‰æœ¬åœ°å˜é‡ï¼Œå½“å­çº¿ç¨‹å°†å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œä¼šæ‰§è¡Œrestoreè¿›è¡Œæ¢å¤åŸç”Ÿæœ¬åœ°å˜é‡ï¼Œå…·ä½“å‚ç…§ä¸Šé¢çš„ä»£ç å’Œæµ‹è¯•ä»£ç ã€‚ å››ã€æ€»ç»“åˆ°è¿™é‡ŒåŸºæœ¬ä¸Šç¡®è®¤äº†TTLæ˜¯å¦‚ä½•è¿›è¡Œçº¿ç¨‹æ± ä¼ å€¼çš„ï¼Œä»¥åŠè¢«åŒ…è£…çš„runæ–¹æ³•æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ä¹‹å‰ï¼Œä¼šä½¿ç”¨replayè¿›è¡Œè®¾ç½®çˆ¶çº¿ç¨‹é‡Œçš„æœ¬åœ°å˜é‡ç»™å½“å‰å­çº¿ç¨‹ï¼Œä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œä¼šè°ƒç”¨restoreæ¢å¤è¯¥å­çº¿ç¨‹åŸç”Ÿçš„æœ¬åœ°å˜é‡ï¼ˆç›®å‰åŸç”Ÿæœ¬åœ°å˜é‡çš„äº§ç”Ÿï¼Œå°±åªç¢°åˆ°ä¸Šè¿°æµ‹è¯•ä»£ç ä¸­çš„è¿™ä¸€ç§æƒ…å†µï¼Œå³çº¿ç¨‹ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶é€šè¿‡ITLå±æ€§ä»¥åŠThreadçš„initæ–¹æ³•ä¼ ç»™å­çº¿ç¨‹ï¼Œè¿˜ä¸å¤ªæ¸…æ¥šæœ‰æ²¡æœ‰å…¶ä»–æ–¹å¼è®¾ç½®ï¼‰ã€‚ å…¶å®ï¼Œæ­£å¸¸ç¨‹åºé‡Œæƒ³è¦å®Œæˆçº¿ç¨‹æ± ä¸Šä¸‹æ–‡ä¼ é€’ï¼Œä½¿ç”¨TLå°±è¶³å¤Ÿäº†ï¼Œæˆ‘ä»¬å¯ä»¥æ•ˆä»¿TTLåŒ…è£…çº¿ç¨‹æ± å¯¹è±¡çš„åŸç†ï¼Œè¿›è¡Œå€¼ä¼ é€’ï¼Œå¼‚æ­¥ä»»åŠ¡ç»“æŸåï¼Œå†removeï¼Œä»¥æ­¤ç±»æ¨æ¥å®Œæˆçº¿ç¨‹æ± å€¼ä¼ é€’ï¼Œä¸è¿‡è¿™ç§æ–¹å¼è¿‡äºå•çº¯ï¼Œä¸”è¦æ±‚ä¸Šä¸‹æ–‡ä¸ºåªè¯»å¯¹è±¡ï¼Œå¦åˆ™å­çº¿ç¨‹å­˜åœ¨å†™æ“ä½œï¼Œå°±ä¼šå‘ç”Ÿä¸Šä¸‹æ–‡æ±¡æŸ“ã€‚ TTLé¡¹ç›®åœ°å€ï¼ˆå¯ä»¥è¯¦ç»†äº†è§£ä¸‹å®ƒçš„å…¶ä»–ç‰¹æ€§å’Œç”¨æ³•ï¼‰ï¼šhttps://github.com/alibaba/transmittable-thread-local","link":"/2019/02/20/ThreadLocal%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%89%EF%BC%89-TransmittableThreadLocal%E7%9A%84%E4%BD%BF%E7%94%A8%E5%8F%8A%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/"},{"title":"ThreadLocalç³»åˆ—ï¼ˆäºŒï¼‰-InheritableThreadLocalçš„ä½¿ç”¨åŠåŸç†è§£æ","text":"ä¸€ã€åŸºæœ¬ä½¿ç”¨æˆ‘ä»¬ç»§ç»­æ¥çœ‹ä¹‹å‰å†™çš„ä¾‹å­ï¼š 123456789101112131415161718private static ThreadLocal tl = new ThreadLocal&lt;&gt;();public static void main(String[] args) throws Exception { tl.set(1); System.out.println(String.format(\"å½“å‰çº¿ç¨‹åç§°: %s, mainæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: %s\", Thread.currentThread().getName(), tl.get())); fc(); new Thread(() -&gt; { fc(); }).start(); Thread.sleep(1000L); //ä¿è¯ä¸‹é¢fcæ‰§è¡Œä¸€å®šåœ¨ä¸Šé¢å¼‚æ­¥ä»£ç ä¹‹åæ‰§è¡Œ fc(); //ç»§ç»­åœ¨ä¸»çº¿ç¨‹å†…æ‰§è¡Œï¼ŒéªŒè¯ä¸Šé¢é‚£ä¸€æ­¥æ˜¯å¦å¯¹ä¸»çº¿ç¨‹ä¸Šä¸‹æ–‡å†…å®¹é€ æˆå½±å“ } private static void fc() { System.out.println(String.format(\"å½“å‰çº¿ç¨‹åç§°: %s, fcæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: %s\", Thread.currentThread().getName(), tl.get())); } ä»£ç å—1 è¾“å‡ºä¸ºï¼š 1234å½“å‰çº¿ç¨‹åç§°: main, mainæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: 1å½“å‰çº¿ç¨‹åç§°: main, fcæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: 1å½“å‰çº¿ç¨‹åç§°: Thread-0, fcæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: nullå½“å‰çº¿ç¨‹åç§°: main, fcæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: 1 æˆ‘ä»¬ä¼šå‘ç°ï¼Œçˆ¶çº¿ç¨‹çš„æœ¬åœ°å˜é‡æ˜¯æ— æ³•ä¼ é€’ç»™å­çº¿ç¨‹çš„ï¼Œè¿™å½“ç„¶æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºçº¿ç¨‹æœ¬åœ°å˜é‡æ¥å°±ä¸åº”è¯¥ç›¸äº’æœ‰äº¤é›†ï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬çš„ç¡®æ˜¯éœ€è¦å­çº¿ç¨‹é‡Œä»ç„¶å¯ä»¥è·å–åˆ°çˆ¶çº¿ç¨‹é‡Œçš„æœ¬åœ°å˜é‡ï¼Œç°åœ¨å°±éœ€è¦å€ŸåŠ©TLçš„ä¸€ä¸ªå­ç±»ï¼šInheritableThreadLocalï¼ˆä¸‹é¢ç®€ç§°ITLï¼‰ï¼Œæ¥å®Œæˆä¸Šè¿°è¦æ±‚ ç°åœ¨æˆ‘ä»¬å°†ä¾‹å­é‡Œçš„ 1private static ThreadLocal tl = new ThreadLocal&lt;&gt;(); ä»£ç å—2 æ”¹ä¸ºï¼š 1private static ThreadLocal tl = new InheritableThreadLocal&lt;&gt;(); ä»£ç å—3 ç„¶åæˆ‘ä»¬å†æ¥è¿è¡Œä¸‹ç»“æœï¼š 1234å½“å‰çº¿ç¨‹åç§°: main, mainæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: 1å½“å‰çº¿ç¨‹åç§°: main, fcæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: 1å½“å‰çº¿ç¨‹åç§°: Thread-0, fcæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: 1å½“å‰çº¿ç¨‹åç§°: main, fcæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: 1 å¯ä»¥å‘ç°ï¼Œå­çº¿ç¨‹é‡Œå·²ç»å¯ä»¥è·å¾—çˆ¶çº¿ç¨‹é‡Œçš„æœ¬åœ°å˜é‡äº†ã€‚ ç»“åˆä¹‹å‰è®²çš„TLçš„å®ç°ï¼Œç®€å•ç†è§£èµ·æ¥å¹¶ä¸éš¾ï¼ŒåŸºæœ¬å¯ä»¥è®¤å®šï¼Œæ˜¯åœ¨åˆ›å»ºå­çº¿ç¨‹çš„æ—¶å€™ï¼Œçˆ¶çº¿ç¨‹çš„ThreadLocalMapï¼ˆä¸‹é¢ç®€ç§°TLMapï¼‰é‡Œçš„å€¼é€’ç»™äº†å­çº¿ç¨‹ï¼Œå­çº¿ç¨‹é’ˆå¯¹ä¸Šè¿°tlå¯¹è±¡æŒæœ‰çš„k-vè¿›è¡Œäº†copyï¼Œå…¶å®è¿™é‡Œä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šå¯¹è±¡copyï¼Œåªæ˜¯ç»™vçš„å€¼å¤šäº†ä¸€æ¡å­çº¿ç¨‹TLMapçš„å¼•ç”¨è€Œå·²ï¼Œvçš„å€¼åœ¨çˆ¶å­çº¿ç¨‹é‡ŒæŒ‡å‘çš„å‡æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œå› æ­¤ä»»æ„çº¿ç¨‹æ”¹äº†è¿™ä¸ªå€¼ï¼Œå¯¹å…¶ä»–çº¿ç¨‹æ˜¯å¯è§çš„ï¼Œä¸ºäº†éªŒè¯è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹é€ ä»¥ä¸Šæµ‹è¯•ä»£ç ï¼š 12345678910111213141516171819202122232425private static ThreadLocal tl = new InheritableThreadLocal&lt;&gt;(); private static ThreadLocal tl2 = new InheritableThreadLocal&lt;&gt;(); public static void main(String[] args) throws Exception { tl.set(1); Hello hello = new Hello(); hello.setName(\"init\"); tl2.set(hello); System.out.println(String.format(\"å½“å‰çº¿ç¨‹åç§°: %s, mainæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: tl = %sï¼Œtl2.name = %s\", Thread.currentThread().getName(), tl.get(), tl2.get().getName())); fc(); new Thread(() -&gt; { Hello hello1 = tl2.get(); hello1.setName(\"init2\"); fc(); }).start(); Thread.sleep(1000L); //ä¿è¯ä¸‹é¢fcæ‰§è¡Œä¸€å®šåœ¨ä¸Šé¢å¼‚æ­¥ä»£ç ä¹‹åæ‰§è¡Œ fc(); //ç»§ç»­åœ¨ä¸»çº¿ç¨‹å†…æ‰§è¡Œï¼ŒéªŒè¯ä¸Šé¢é‚£ä¸€æ­¥æ˜¯å¦å¯¹ä¸»çº¿ç¨‹ä¸Šä¸‹æ–‡å†…å®¹é€ æˆå½±å“ } private static void fc() { System.out.println(String.format(\"å½“å‰çº¿ç¨‹åç§°: %s, fcæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: tl = %sï¼Œtl2.name = %s\", Thread.currentThread().getName(), tl.get(), tl2.get().getName())); } ä»£ç å—4 è¾“å‡ºç»“æœä¸ºï¼š 1234å½“å‰çº¿ç¨‹åç§°: main, mainæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: tl = 1ï¼Œtl2.name = initå½“å‰çº¿ç¨‹åç§°: main, fcæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: tl = 1ï¼Œtl2.name = initå½“å‰çº¿ç¨‹åç§°: Thread-0, fcæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: tl = 1ï¼Œtl2.name = init2å½“å‰çº¿ç¨‹åç§°: main, fcæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: tl = 1ï¼Œtl2.name = init2 å¯ä»¥ç¡®è®¤ï¼Œå­çº¿ç¨‹é‡ŒæŒæœ‰çš„æœ¬åœ°å˜é‡è·Ÿçˆ¶çº¿ç¨‹é‡Œé‚£ä¸ªæ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚ äºŒã€åŸç†åˆ†æé€šè¿‡ä¸Šè¿°çš„æµ‹è¯•ä»£ç ï¼ŒåŸºæœ¬å¯ä»¥ç¡®å®šçˆ¶çº¿ç¨‹çš„TLMapè¢«ä¼ é€’åˆ°äº†ä¸‹ä¸€çº§ï¼Œé‚£ä¹ˆæˆ‘ä»¬åŸºæœ¬å¯ä»¥ç¡®è®¤ITLæ˜¯TLæ´¾ç”Ÿå‡ºæ¥ä¸“é—¨è§£å†³çº¿ç¨‹æœ¬åœ°å˜é‡çˆ¶ä¼ å­é—®é¢˜çš„ï¼Œé‚£ä¹ˆä¸‹é¢é€šè¿‡æºç æ¥åˆ†æä¸€ä¸‹ITLåˆ°åº•æ˜¯æ€ä¹ˆå®Œæˆè¿™ä¸ªæ“ä½œçš„ã€‚ å…ˆæ¥äº†è§£ä¸‹Threadç±»ï¼Œä¸ŠèŠ‚è¯´åˆ°ï¼Œå…¶å®æœ€ç»ˆçº¿ç¨‹æœ¬åœ°å˜é‡æ˜¯é€šè¿‡TLMapå­˜å‚¨åœ¨Threadå¯¹è±¡å†…çš„ï¼Œé‚£ä¹ˆæ¥çœ‹ä¸‹Threadå¯¹è±¡å†…å…³äºTLMapçš„ä¸¤ä¸ªå±æ€§ï¼š 12ThreadLocal.ThreadLocalMap threadLocals = null;ThreadLocal.ThreadLocalMap inheritableThreadLocals = null; ä»£ç å—5 Threadç±»é‡Œå…¶å®æœ‰ä¸¤ä¸ªTLMapå±æ€§ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯æ™®é€šTLå¯¹è±¡ä¸ºå…¶èµ‹å€¼ï¼Œç¬¬äºŒä¸ªåˆ™ç”±ITLå¯¹è±¡ä¸ºå…¶èµ‹å€¼ï¼Œæ¥çœ‹ä¸‹TLçš„setæ–¹æ³•çš„å®ç°ï¼Œè¿™æ¬¡é’ˆå¯¹è¯¥æ–¹æ³•ä»‹ç»ä¸‹TLå­ç±»çš„ç›¸å…³æ–¹æ³•å®ç°ï¼š 123456789101112131415161718192021// TLçš„setæ–¹æ³•ï¼Œå¦‚æœæ˜¯å­ç±»çš„å®ç°ï¼Œé‚£ä¹ˆè·å–ï¼ˆgetMapï¼‰å’Œåˆå§‹åŒ–èµ‹å€¼ï¼ˆcreateMapï¼‰éƒ½æ˜¯ITLå¯¹è±¡é‡Œçš„æ–¹æ³• // å…¶ä½™æ“ä½œä¸å˜ï¼ˆå› ä¸ºhashè®¡ç®—ã€æŸ¥æ‰¾ã€æ‰©å®¹éƒ½æ˜¯TLMapé‡Œéœ€è¦åšçš„ï¼Œè¿™é‡Œå­ç±»ITLåªèµ·åˆ°ä¸€ä¸ªä¸ºThreadå¯¹è±¡é‡Œå“ªä¸ªTLMapå±æ€§èµ‹å€¼çš„ä½œç”¨ï¼‰ public void set(T value) { Thread t = Thread.currentThread(); ThreadLocal.ThreadLocalMap map = getMap(t); if (map != null) map.set(this, value); else createMap(t, value); } // ITLé‡ŒgetMapæ–¹æ³•çš„å®ç° ThreadLocal.ThreadLocalMap getMap(Thread t) { return t.inheritableThreadLocals; //è¿”å›çš„å…¶å®æ˜¯Threadå¯¹è±¡çš„inheritableThreadLocalså±æ€§ } // ITLé‡ŒcreateMapæ–¹æ³•çš„å®ç° void createMap(Thread t, T firstValue) { // ä¹Ÿæ˜¯ç»™Threadçš„inheritableThreadLocalså±æ€§èµ‹å€¼ t.inheritableThreadLocals = new ThreadLocal.ThreadLocalMap(this, firstValue); } ä»£ç å—6 è€ŒinheritableThreadLocalsé‡Œçš„ä¿¡æ¯é€šè¿‡Threadçš„initæ–¹æ³•æ˜¯å¯ä»¥è¢«ä¼ é€’ä¸‹å»çš„ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142// åˆå§‹åŒ–ä¸€ä¸ªThreadå¯¹è±¡æ—¶çš„ä»£ç æ®µï¼ˆThreadç±»çš„initæ–¹æ³•ï¼‰ Thread parent = currentThread(); if (parent.inheritableThreadLocals != null){ //å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœçˆ¶çº¿ç¨‹å­˜åœ¨inheritableThreadLocalsçš„æ—¶å€™ï¼Œä¼šèµ‹å€¼ç»™å­çº¿ç¨‹ï¼ˆå½“å‰æ­£åœ¨è¢«åˆå§‹åŒ–çš„çº¿ç¨‹ï¼‰ // åˆ©ç”¨çˆ¶çº¿ç¨‹çš„TLMapå¯¹è±¡ï¼Œåˆå§‹åŒ–ä¸€ä¸ªTLMapï¼Œèµ‹å€¼ç»™è‡ªå·±çš„inheritableThreadLocalsï¼ˆè¿™å°±æ„å‘³ç€è¿™ä¸ªTLMapé‡Œçš„å€¼ä¼šä¸€ç›´è¢«ä¼ é€’ä¸‹å»ï¼‰ this.inheritableThreadLocals = ThreadLocal.createInheritedMap(parent.inheritableThreadLocals); } // çœ‹ä¸‹TLé‡Œå¯¹åº”çš„æ–¹æ³• static ThreadLocal.ThreadLocalMap createInheritedMap(ThreadLocal.ThreadLocalMap parentMap) { return new ThreadLocal.ThreadLocalMap(parentMap); //è¿™é‡Œå°±å¼€å§‹åˆå§‹åŒ–TLMapå¯¹è±¡äº† } // æ ¹æ®parentMapæ¥è¿›è¡Œåˆå§‹åŒ–å­çº¿ç¨‹çš„TLMapå¯¹è±¡ private ThreadLocalMap(ThreadLocal.ThreadLocalMap parentMap) { ThreadLocal.ThreadLocalMap.Entry[] parentTable = parentMap.table; //æ‹¿åˆ°çˆ¶çº¿ç¨‹é‡Œçš„å“ˆå¸Œè¡¨ int len = parentTable.length; setThreshold(len); // è®¾ç½®é˜ˆå€¼ï¼ˆå…·ä½“æ–¹æ³•å‚è€ƒä¸Šä¸€ç¯‡ï¼‰ table = new ThreadLocal.ThreadLocalMap.Entry[len]; for (int j = 0; j &lt; len; j++) { ThreadLocal.ThreadLocalMap.Entry e = parentTable[j]; //å°†çˆ¶çº¿ç¨‹é‡Œçš„Entryå–å‡º if (e != null) { @SuppressWarnings(\"unchecked\") ThreadLocal&lt;Object&gt; key = (ThreadLocal&lt;Object&gt;) e.get(); //è·å–key if (key != null) { Object value = key.childValue(e.value); //è·å–value ThreadLocal.ThreadLocalMap.Entry c = new ThreadLocal.ThreadLocalMap.Entry(key, value); //æ ¹æ®k-vé‡æ–°ç”Ÿæˆä¸€ä¸ªEntry int h = key.threadLocalHashCode &amp; (len - 1); //è®¡ç®—å“ˆå¸Œå€¼ while (table[h] != null) h = nextIndex(h, len); //çº¿æ€§æ¢æŸ¥è§£å†³å“ˆå¸Œå†²çªé—®é¢˜ï¼ˆå…·ä½“æ–¹æ³•å‚è€ƒä¸Šä¸€ç¯‡ï¼‰ table[h] = c; //æ‰¾åˆ°åˆé€‚çš„ä½ç½®åè¿›è¡Œèµ‹å€¼ size++; } } } } // ITLé‡Œçš„childValueçš„å®ç° protected T childValue(T parentValue) { return parentValue; //ç›´æ¥å°†çˆ¶çº¿ç¨‹é‡Œçš„å€¼è¿”å› } ä»£ç å—7 ä¸‰ã€ITLæ‰€å¸¦æ¥çš„çš„é—®é¢˜çœ‹è¿‡ä¸Šè¿°ä»£ç åï¼Œç°åœ¨å…³äºITLçš„å®ç°æˆ‘ä»¬åŸºæœ¬ä¸Šæœ‰äº†æ¸…æ™°çš„è®¤è¯†äº†ï¼Œæ ¹æ®å…¶å®ç°æ€§è´¨ï¼Œå¯ä»¥æ€»ç»“å‡ºåœ¨ä½¿ç”¨ITLæ—¶å¯èƒ½å­˜åœ¨çš„é—®é¢˜ï¼š 3.1ï¼šçº¿ç¨‹ä¸å®‰å…¨ å†™åœ¨å‰é¢ï¼šè¿™é‡Œè®¨è®ºçš„çº¿ç¨‹ä¸å®‰å…¨å¯¹è±¡ä¸åŒ…å«Integerç­‰ç±»å‹ï¼Œå› ä¸ºè¿™ç§å¯¹è±¡è¢«é‡æ–°èµ‹å€¼ï¼Œå˜æ‰çš„æ˜¯æ•´ä¸ªå¼•ç”¨ï¼Œè¿™é‡Œè¯´çš„æ˜¯é‚£ç§ä¸æ”¹å˜å¯¹è±¡å¼•ç”¨ï¼Œç›´æ¥å¯ä»¥ä¿®æ”¹å…¶å†…å®¹çš„å¯¹è±¡ï¼ˆå…¸å‹çš„å°±æ˜¯è‡ªå®šä¹‰å¯¹è±¡çš„setæ–¹æ³•ï¼‰ å¦‚æœè¯´çº¿ç¨‹æœ¬åœ°å˜é‡æ˜¯åªè¯»å˜é‡ä¸ä¼šå—åˆ°å½±å“ï¼Œä½†æ˜¯å¦‚æœæ˜¯å¯å†™çš„ï¼Œé‚£ä¹ˆä»»æ„å­çº¿ç¨‹é’ˆå¯¹æœ¬åœ°å˜é‡çš„ä¿®æ”¹éƒ½ä¼šå½±å“åˆ°ä¸»çº¿ç¨‹çš„æœ¬åœ°å˜é‡ï¼ˆæœ¬è´¨ä¸Šæ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼‰ï¼Œå‚è€ƒä¸Šé¢çš„ç¬¬ä¸‰ä¸ªä¾‹å­ï¼Œå­çº¿ç¨‹å†™å…¥åä¼šè¦†ç›–æ‰ä¸»çº¿ç¨‹çš„å˜é‡ï¼Œä¹Ÿæ˜¯é€šè¿‡è¿™ä¸ªç»“æœï¼Œæˆ‘ä»¬ç¡®è®¤äº†å­çº¿ç¨‹TLMapé‡Œå˜é‡æŒ‡å‘çš„å¯¹è±¡å’Œçˆ¶çº¿ç¨‹æ˜¯åŒä¸€ä¸ªã€‚ 3.2ï¼šçº¿ç¨‹æ± ä¸­å¯èƒ½å¤±æ•ˆæŒ‰ç…§ä¸Šè¿°å®ç°ï¼Œåœ¨ä½¿ç”¨çº¿ç¨‹æ± çš„æ—¶å€™ï¼ŒITLä¼šå®Œå…¨å¤±æ•ˆï¼Œå› ä¸ºçˆ¶çº¿ç¨‹çš„TLMapæ˜¯é€šè¿‡initä¸€ä¸ªThreadçš„æ—¶å€™è¿›è¡Œèµ‹å€¼ç»™å­çº¿ç¨‹çš„ï¼Œè€Œçº¿ç¨‹æ± åœ¨æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡æ—¶å¯èƒ½ä¸å†éœ€è¦åˆ›å»ºæ–°çš„çº¿ç¨‹äº†ï¼Œå› æ­¤ä¹Ÿå°±ä¸ä¼šå†ä¼ é€’çˆ¶çº¿ç¨‹çš„TLMapç»™å­çº¿ç¨‹äº†ã€‚ é’ˆå¯¹ä¸Šè¿°2ï¼Œæˆ‘ä»¬æ¥åšä¸ªå®éªŒï¼Œæ¥è¯æ˜ä¸‹çŒœæƒ³ï¼š 123456789101112131415161718192021// ä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿï¼Œæˆ‘ä»¬å‡å®šçº¿ç¨‹æ± é‡Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹ private static ExecutorService executorService = Executors.newFixedThreadPool(1); private static ThreadLocal tl = new InheritableThreadLocal&lt;&gt;(); public static void main(String[] args) { tl.set(1); System.out.println(String.format(\"çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", Thread.currentThread().getName(), tl.get())); executorService.execute(()-&gt;{ System.out.println(String.format(\"çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", Thread.currentThread().getName(), tl.get())); }); executorService.execute(()-&gt;{ System.out.println(String.format(\"çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", Thread.currentThread().getName(), tl.get())); }); System.out.println(String.format(\"çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", Thread.currentThread().getName(), tl.get())); } ä»£ç å—8 è¾“å‡ºç»“æœä¸ºï¼š 1234çº¿ç¨‹åç§°-main, å˜é‡å€¼=1çº¿ç¨‹åç§°-pool-1-thread-1, å˜é‡å€¼=1çº¿ç¨‹åç§°-main, å˜é‡å€¼=1çº¿ç¨‹åç§°-pool-1-thread-1, å˜é‡å€¼=1 ä¼šå‘ç°ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå’Œæˆ‘ä»¬é¢„æƒ³çš„å¹¶ä¸ä¸€æ ·ï¼ŒåŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºçº¿ç¨‹æ± æœ¬èº«å­˜åœ¨ä¸€ä¸ªåˆå§‹åŒ–çš„è¿‡ç¨‹ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™å‘ç°é‡Œé¢çš„çº¿ç¨‹æ•°ï¼ˆworkeræ•°ï¼‰å°‘äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œä¼šè¿›è¡Œåˆ›å»ºçº¿ç¨‹ï¼Œæ—¢ç„¶æ˜¯åˆ›å»ºçº¿ç¨‹ï¼Œä¸€å®šä¼šæ‰§è¡ŒThreadçš„initæ–¹æ³•ï¼Œå‚è€ƒä¸Šé¢æåˆ°çš„æºç ï¼Œåœ¨ç¬¬ä¸€æ¬¡å¯ç”¨çº¿ç¨‹æ± çš„æ—¶å€™ï¼Œç±»ä¼¼åšäº†ä¸€æ¬¡new Threadçš„æ“ä½œï¼Œå› æ­¤æ˜¯æ²¡æœ‰ä»€ä¹ˆé—®é¢˜çš„ï¼Œçˆ¶çº¿ç¨‹çš„TLMapä¾ç„¶å¯ä»¥ä¼ é€’ä¸‹å»ã€‚ ç°åœ¨æˆ‘ä»¬æ”¹é€ ä¸‹ä»£ç ï¼ŒæŠŠtl.set(1)æ”¹åˆ°ç¬¬ä¸€æ¬¡å¯ç”¨çº¿ç¨‹æ± çš„ä¸‹é¢ä¸€è¡Œï¼Œç„¶åå†çœ‹çœ‹ï¼š 12345678910111213141516public static void main(String[] args) throws Exception{ System.out.println(String.format(\"çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", Thread.currentThread().getName(), tl.get())); executorService.execute(()-&gt;{ System.out.println(String.format(\"çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", Thread.currentThread().getName(), tl.get())); }); tl.set(1); // ç­‰ä¸Šé¢çš„çº¿ç¨‹æ± ç¬¬ä¸€æ¬¡å¯ç”¨å®Œäº†ï¼Œçˆ¶çº¿ç¨‹å†ç»™è‡ªå·±èµ‹å€¼ executorService.execute(()-&gt;{ System.out.println(String.format(\"çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", Thread.currentThread().getName(), tl.get())); }); System.out.println(String.format(\"çº¿ç¨‹åç§°-%s, å˜é‡å€¼=%s\", Thread.currentThread().getName(), tl.get())); } ä»£ç å—9 è¾“å‡ºç»“æœä¸ºï¼š 1234çº¿ç¨‹åç§°-main, å˜é‡å€¼=nullçº¿ç¨‹åç§°-main, å˜é‡å€¼=1çº¿ç¨‹åç§°-pool-1-thread-1, å˜é‡å€¼=nullçº¿ç¨‹åç§°-pool-1-thread-1, å˜é‡å€¼=null å¾ˆæ˜æ˜¾ï¼Œç¬¬ä¸€æ¬¡å¯ç”¨æ—¶æ²¡æœ‰é€’è¿›å»çš„å€¼ï¼Œåœ¨åç»­çš„å­çº¿ç¨‹å¯åŠ¨æ—¶å°±å†ä¹Ÿä¼ é€’ä¸è¿›å»äº†ã€‚ å°¾å£°ä½†æ˜¯ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­æˆ‘ä»¬å¤§å¤šæ•°é‡‡ç”¨çº¿ç¨‹æ± è¿›è¡Œåšå¼‚æ­¥ä»»åŠ¡ï¼Œå‡å¦‚çœŸçš„éœ€è¦ä¼ é€’ä¸»çº¿ç¨‹çš„æœ¬åœ°å˜é‡ï¼Œä½¿ç”¨ITLçš„é—®é¢˜æ˜¾ç„¶æ˜¯å¾ˆå¤§çš„ï¼Œå› ä¸ºæ˜¯æœ‰æå¤§å¯èƒ½æ€§æ‹¿ä¸åˆ°ä»»ä½•å€¼çš„ï¼Œæ˜¾ç„¶åœ¨å®é™…é¡¹ç›®ä¸­ï¼ŒITLçš„ä½ç½®å®åœ¨æ˜¯å°´å°¬ï¼Œæ‰€ä»¥åœ¨å¯ç”¨çº¿ç¨‹æ± çš„æƒ…å†µä¸‹ï¼Œä¸å»ºè®®ä½¿ç”¨ITLåšå€¼ä¼ é€’ã€‚ä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œé˜¿é‡Œåšäº†transmittable-thread-localï¼ˆTTLï¼‰æ¥è§£å†³çº¿ç¨‹æ± å¼‚æ­¥å€¼ä¼ é€’é—®é¢˜ï¼Œä¸‹ä¸€ç¯‡ï¼Œæˆ‘ä»¬å°†ä¼šåˆ†æTTLçš„ç”¨æ³•åŠåŸç†ã€‚","link":"/2019/02/19/ThreadLocal%E7%B3%BB%E5%88%97%EF%BC%88%E4%BA%8C%EF%BC%89-InheritableThreadLocal%E7%9A%84%E4%BD%BF%E7%94%A8%E5%8F%8A%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/"},{"title":"ThreadLocalç³»åˆ—ï¼ˆä¸€ï¼‰-ThreadLocalçš„ä½¿ç”¨åŠåŸç†è§£æ","text":"é¡¹ç›®ä¸­æˆ‘ä»¬å¦‚æœæƒ³è¦æŸä¸ªå¯¹è±¡åœ¨ç¨‹åºè¿è¡Œä¸­çš„ä»»æ„ä½ç½®è·å–åˆ°ï¼Œå°±éœ€è¦å€ŸåŠ©ThreadLocalæ¥å®ç°ï¼Œè¿™ä¸ªå¯¹è±¡ç§°ä½œçº¿ç¨‹çš„æœ¬åœ°å˜é‡ï¼Œä¸‹é¢å°±ä»‹ç»ä¸‹ThreadLocalæ˜¯å¦‚ä½•åšåˆ°çº¿ç¨‹å†…æœ¬åœ°å˜é‡ä¼ é€’çš„ï¼Œ ä¸€ã€åŸºæœ¬ä½¿ç”¨å…ˆæ¥çœ‹ä¸‹åŸºæœ¬ç”¨æ³•ï¼š 1234567891011121314private static ThreadLocal tl = new ThreadLocal&lt;&gt;();public static void main(String[] args) throws Exception { tl.set(1); System.out.println(String.format(\"å½“å‰çº¿ç¨‹åç§°: %s, mainæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: %s\", Thread.currentThread().getName(), tl.get())); fc(); new Thread(ThreadLocalTest::fc).start();}private static void fc() { System.out.println(String.format(\"å½“å‰çº¿ç¨‹åç§°: %s, fcæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: %s\", Thread.currentThread().getName(), tl.get()));} ä»£ç å—1 è¿è¡Œç»“æœï¼š 123å½“å‰çº¿ç¨‹åç§°: main, mainæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: 1å½“å‰çº¿ç¨‹åç§°: main, fcæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: 1å½“å‰çº¿ç¨‹åç§°: Thread-0, fcæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: null å¯ä»¥çœ‹åˆ°ï¼Œmainçº¿ç¨‹å†…ä»»æ„åœ°æ–¹éƒ½å¯ä»¥é€šè¿‡ThreadLocalè·å–åˆ°å½“å‰çº¿ç¨‹å†…è¢«è®¾ç½®è¿›å»çš„å€¼ï¼Œè€Œè¢«å¼‚æ­¥å‡ºå»çš„fcè°ƒç”¨ï¼Œå´ç”±äºæ›¿æ¢äº†æ‰§è¡Œçº¿ç¨‹ï¼Œè€Œæ‹¿ä¸åˆ°ä»»ä½•æ•°æ®å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å†æ¥æ”¹é€ ä¸‹ä¸Šè¿°ä»£ç ï¼Œåœ¨å¼‚æ­¥å‘ç”Ÿä¹‹å‰ï¼Œç»™Thread-0çº¿ç¨‹ä¹Ÿè®¾ç½®ä¸€ä¸ªä¸Šä¸‹æ–‡æ•°æ®ï¼š 12345678910111213141516171819private static ThreadLocal tl = new ThreadLocal&lt;&gt;(); public static void main(String[] args) throws Exception { tl.set(1); System.out.println(String.format(\"å½“å‰çº¿ç¨‹åç§°: %s, mainæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: %s\", Thread.currentThread().getName(), tl.get())); fc(); new Thread(()-&gt;{ tl.set(2); //åœ¨å­çº¿ç¨‹é‡Œè®¾ç½®ä¸Šä¸‹æ–‡å†…å®¹ä¸º2 fc(); }).start(); Thread.sleep(1000L); //ä¿è¯ä¸‹é¢fcæ‰§è¡Œä¸€å®šåœ¨ä¸Šé¢å¼‚æ­¥ä»£ç ä¹‹åæ‰§è¡Œ fc(); //ç»§ç»­åœ¨ä¸»çº¿ç¨‹å†…æ‰§è¡Œï¼ŒéªŒè¯ä¸Šé¢é‚£ä¸€æ­¥æ˜¯å¦å¯¹ä¸»çº¿ç¨‹ä¸Šä¸‹æ–‡å†…å®¹é€ æˆå½±å“ } private static void fc() { System.out.println(String.format(\"å½“å‰çº¿ç¨‹åç§°: %s, fcæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: %s\", Thread.currentThread().getName(), tl.get())); } ä»£ç å—2 è¿è¡Œç»“æœä¸ºï¼š 1234å½“å‰çº¿ç¨‹åç§°: main, mainæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: 1å½“å‰çº¿ç¨‹åç§°: main, fcæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: 1å½“å‰çº¿ç¨‹åç§°: Thread-0, fcæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: 2å½“å‰çº¿ç¨‹åç§°: main, fcæ–¹æ³•å†…è·å–çº¿ç¨‹å†…æ•°æ®ä¸º: 1 å¯ä»¥çœ‹åˆ°ï¼Œä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹éƒ½å¯ä»¥è·å–åˆ°è‡ªå·±çš„é‚£ä»½ä¸Šä¸‹æ–‡é‡Œçš„å†…å®¹ï¼Œè€Œä¸”äº’ä¸å½±å“ã€‚ äºŒã€åŸç†åˆ†æokï¼Œä¸Šé¢é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ThreadLocalï¼ˆä»¥ä¸‹ç®€ç§°TLï¼‰å…·ä½“çš„ç”¨æ³•ï¼Œè¿™é‡Œå…ˆä¸è®¨è®ºå®ƒå®è´¨ä¸Šèƒ½ç»™æˆ‘ä»¬å¸¦æ¥ä»€ä¹ˆå¥½å¤„ï¼Œå…ˆçœ‹çœ‹å…¶å®ç°åŸç†ï¼Œç­‰è¿™äº›å·®ä¸å¤šäº†è§£å®Œäº†ï¼Œæˆ‘å†é€šè¿‡æˆ‘æ›¾ç»åšè¿‡çš„ä¸€ä¸ªé¡¹ç›®ï¼Œå»è¯´æ˜TLçš„ä½œç”¨ä»¥åŠåœ¨ä¼ä¸šçº§é¡¹ç›®é‡Œçš„ç”¨å¤„ã€‚ æˆ‘ä»¥å‰åœ¨ä¸äº†è§£TLçš„æ—¶å€™ï¼Œæƒ³ç€å¦‚æœè®©è‡ªå·±å®ç°ä¸€ä¸ªè¿™ç§åŠŸèƒ½çš„è½®å­ï¼Œè‡ªå·±ä¼šæ€ä¹ˆåšï¼Œé‚£æ—¶å€™çš„æƒ³æ³•å¾ˆå•çº¯ï¼Œè§‰å¾—é€šè¿‡ä¸€ä¸ªMapå°±å¯ä»¥è§£å†³ï¼ŒMapçš„keyè®¾ç½®ä¸ºThread.currentThread()ï¼Œvalueè®¾ç½®ä¸ºå½“å‰çº¿ç¨‹çš„æœ¬åœ°å˜é‡å³å¯ï¼Œä½†åæ¥æƒ³æƒ³å°±è§‰å¾—ä¸å¤ªç°å®äº†ï¼Œå®é™…é¡¹ç›®ä¸­å¯èƒ½å­˜åœ¨å¤§é‡çš„å¼‚æ­¥çº¿ç¨‹ï¼Œå¯¹äºå†…å­˜çš„å¼€é”€æ˜¯ä¸å¯ä¼°é‡çš„ï¼Œè€Œä¸”è¿˜æœ‰ä¸ªä¸¥é‡çš„é—®é¢˜ï¼Œçº¿ç¨‹æ˜¯è¿è¡Œç»“æŸåå°±é”€æ¯çš„ï¼Œå¦‚æœæŒ‰ç…§ä¸Šè¿°çš„å®ç°æ–¹æ¡ˆï¼Œmapå†…æ˜¯ä¸€ç›´æŒæœ‰è¿™ä¸ªçº¿ç¨‹çš„å¼•ç”¨çš„ï¼Œå¯¼è‡´æ˜æ˜æ‰§è¡Œç»“æŸçš„çº¿ç¨‹å¯¹è±¡ä¸èƒ½è¢«jvmå›æ”¶ï¼Œé€ æˆå†…å­˜æ³„æ¼ï¼Œæ—¶é—´ä¹…äº†ï¼Œä¼šç›´æ¥OOMã€‚ æ‰€ä»¥ï¼Œjavaé‡Œçš„å®ç°è‚¯å®šä¸æ˜¯è¿™ä¹ˆç®€å•çš„ï¼Œä¸‹é¢ï¼Œå°±æ¥çœ‹çœ‹javaé‡Œçš„å…·ä½“å®ç°å§ã€‚ å…ˆæ¥äº†è§£ä¸‹ï¼ŒTLçš„åŸºæœ¬å®ç°ï¼Œä¸ºäº†é¿å…ä¸Šè¿°ä¸­å‡ºç°çš„é—®é¢˜ï¼ŒTLå®é™…ä¸Šæ˜¯æŠŠæˆ‘ä»¬è®¾ç½®è¿›å»çš„å€¼ä»¥k-vçš„æ–¹å¼æ”¾åˆ°äº†æ¯ä¸ªThreadå¯¹è±¡å†…ï¼ˆTLå¯¹è±¡åškï¼Œè®¾ç½®çš„å€¼åšvï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒTLå¯¹è±¡ä»…ä»…èµ·åˆ°ä¸€ä¸ªæ ‡è®°ã€å¯¹Threadå¯¹è±¡ç»´æŠ¤çš„mapèµ‹å€¼çš„ä½œç”¨ã€‚ å…ˆä»setæ–¹æ³•çœ‹èµ·ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455public void set(T value) { Thread t = Thread.currentThread(); //è·å–å½“å‰çº¿ç¨‹ ThreadLocal.ThreadLocalMap map = getMap(t); //è·å–åˆ°å½“å‰çº¿ç¨‹æŒæœ‰çš„ThreadLocalMapå¯¹è±¡ if (map != null) map.set(this, value); //ç›´æ¥setå€¼ï¼Œå…·ä½“æ–¹æ³•åœ¨ä¸‹é¢ else createMap(t, value); // ä¸ºç©ºå°±ç»™å½“å‰çº¿ç¨‹åˆ›å»ºä¸€ä¸ªThreadLocalMapå¯¹è±¡ï¼Œèµ‹å€¼ç»™Threadå¯¹è±¡ï¼Œå…·ä½“æ–¹æ³•åœ¨ä¸‹é¢ } ThreadLocal.ThreadLocalMap getMap(Thread t) { return t.threadLocals; //æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªThreadLocalMapï¼Œkeyä¸ºTLå¯¹è±¡ï¼ˆå…¶å®æ˜¯æ ¹æ®å¯¹è±¡hashè®¡ç®—å‡ºæ¥çš„å€¼ï¼‰ï¼Œvalueä¸ºè¯¥çº¿ç¨‹åœ¨æ­¤TLå¯¹è±¡ä¸‹å­˜å‚¨çš„å†…å®¹å€¼ } private void set(ThreadLocal&lt;?&gt; key, Object value) { ThreadLocal.ThreadLocalMap.Entry[] tab = table; //è·å–å­˜å‚¨k-vå¯¹è±¡çš„æ•°ç»„ï¼ˆæ•£åˆ—è¡¨ï¼‰ int len = tab.length; int i = key.threadLocalHashCode &amp; (len-1); //æ ¹æ®TLå¯¹è±¡çš„hashCodeï¼ˆä¹Ÿæ˜¯ç‰¹æ®Šè®¡ç®—å‡ºæ¥çš„ï¼Œä¿è¯æ¯ä¸ªTLå¯¹è±¡çš„hashCodeä¸åŒï¼‰è®¡ç®—å‡ºä¸‹æ ‡ for (ThreadLocal.ThreadLocalMap.Entry e = tab[i]; e != null; e = tab[i = nextIndex(i, len)]) { //çº¿æ€§æ¢æŸ¥æ³•è§£å†³å“ˆå¸Œå†²çªé—®é¢˜ï¼Œå‘ç°ä¸‹æ ‡iå·²ç»æœ‰Entryäº†ï¼Œåˆ™å°±æŸ¥çœ‹i+1ä½ç½®å¤„æ˜¯å¦æœ‰å€¼ï¼Œä»¥æ­¤ç±»æ¨ ThreadLocal&lt;?&gt; k = e.get(); //è·å–k if (k == key) { //è‹¥kå°±æ˜¯å½“å‰TLå¯¹è±¡ï¼Œåˆ™ç›´æ¥ä¸ºå…¶valueèµ‹å€¼ e.value = value; return; } if (k == null) { //è‹¥kä¸ºç©ºï¼Œåˆ™è®¤ä¸ºæ˜¯å¯å›æ”¶çš„Entryï¼Œåˆ™åˆ©ç”¨å½“å‰kå’Œvalueç»„æˆæ–°çš„Entryæ›¿æ¢æ‰è¯¥å¯å›æ”¶Entry replaceStaleEntry(key, value, i); return; } } //forå¾ªç¯æ‰§è¡Œå®Œæ²¡æœ‰ç»ˆæ­¢ç¨‹åºï¼Œè¯´æ˜é‡åˆ°äº†ç©ºæ§½ï¼Œè¿™ä¸ªæ—¶å€™ç›´æ¥newå¯¹è±¡èµ‹å€¼å³å¯ tab[i] = new ThreadLocal.ThreadLocalMap.Entry(key, value); int sz = ++size; if (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold) //è¿™é‡Œç”¨æ¥æ¸…ç†æ‰kä¸ºnullçš„åºŸå¼ƒEntry rehash(); //å¦‚æœæ²¡æœ‰å‘ç”Ÿæ¸…é™¤Entryå¹¶ä¸”sizeè¶…è¿‡é˜ˆå€¼ï¼ˆé˜ˆå€¼ = æœ€å¤§é•¿åº¦ * 2/3ï¼‰ï¼Œåˆ™è¿›è¡Œæ‰©å®¹ } //ç›´æ¥ä¸ºå½“å‰Threadåˆå§‹åŒ–å®ƒçš„ThreadLocalMapå¯¹è±¡ void createMap(Thread t, T firstValue) { t.threadLocals = new ThreadLocal.ThreadLocalMap(this, firstValue); } ThreadLocalMap(ThreadLocal&lt;?&gt; firstKey, Object firstValue) { table = new ThreadLocal.ThreadLocalMap.Entry[INITIAL_CAPACITY]; //åˆå§‹åŒ–æ•°ç»„ int i = firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - 1); //è®¡ç®—åˆå§‹ä½ç½® table[i] = new ThreadLocal.ThreadLocalMap.Entry(firstKey, firstValue); //å› ä¸ºåˆå§‹åŒ–ä¸å­˜åœ¨hashå†²çªï¼Œç›´æ¥new size = 1; setThreshold(INITIAL_CAPACITY); //ç»™é˜ˆå€¼èµ‹å€¼ï¼Œä¸Šé¢å·²ç»æåŠï¼Œé˜ˆå€¼ = æœ€å¤§é•¿åº¦ * 2/3 } ä»£ç å—3 é€šè¿‡ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬å¤§è‡´äº†è§£äº†TLåœ¨setå€¼çš„æ—¶å€™å‘ç”Ÿçš„ä¸€äº›æ“ä½œï¼Œç»“åˆä¹‹å‰è¯´çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šçš„æ˜¯ï¼ŒTLå…¶å®å¯¹äºçº¿ç¨‹æ¥è¯´ï¼Œåªæ˜¯ä¸€ä¸ªæ ‡è¯†ï¼Œè€ŒçœŸæ­£çº¿ç¨‹çš„æœ¬åœ°å˜é‡è¢«ä¿å­˜åœ¨æ¯ä¸ªçº¿ç¨‹å¯¹è±¡çš„ThreadLocalMapé‡Œï¼Œè¿™ä¸ªmapé‡Œç»´æŠ¤ç€ä¸€ä¸ªEntry[]çš„æ•°ç»„ï¼ˆæ•£åˆ—è¡¨ï¼‰ï¼ŒEntryæ˜¯ä¸ªk-vç»“æ„çš„å¯¹è±¡ï¼ˆå¦‚å›¾1-1ï¼‰ï¼Œkä¸ºTLå¯¹è±¡ï¼Œvä¸ºå¯¹åº”TLä¿å­˜åœ¨è¯¥çº¿ç¨‹å†…çš„æœ¬åœ°å˜é‡å€¼ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„ké’ˆå¯¹TLå¯¹è±¡çš„å¼•ç”¨æ˜¯ä¸ªå¼±å¼•ç”¨ï¼Œæ¥çœ‹ä¸‹æºç ï¼š 123456789static class Entry extends WeakReference&lt;ThreadLocal&lt;?&gt;&gt; { /** The value associated with this ThreadLocal. */ Object value; Entry(ThreadLocal&lt;?&gt; k, Object v) { super(k); value = v; } } ä»£ç å—4 ä¸ºä»€ä¹ˆè¿™é‡Œéœ€è¦å¼±å¼•ç”¨å‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€å¼ å›¾ï¼Œç»“åˆä¸Šé¢çš„ä»‹ç»å’Œè¿™å¼ å›¾ï¼Œæ¥äº†è§£TLå’ŒThreadé—´çš„å…³ç³»ï¼š å›¾ä¸­è™šçº¿è¡¨ç¤ºå¼±å¼•ç”¨ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿ ç®€å•æ¥è¯´ï¼Œä¸€ä¸ªTLå¯¹è±¡è¢«åˆ›å»ºå‡ºæ¥ï¼Œå¹¶ä¸”è¢«ä¸€ä¸ªçº¿ç¨‹æ”¾åˆ°è‡ªå·±çš„ThreadLocalMapé‡Œï¼Œå‡å¦‚TLå¯¹è±¡å¤±å»åŸæœ‰çš„å¼ºå¼•ç”¨ï¼Œä½†æ˜¯è¯¥çº¿ç¨‹è¿˜æ²¡æœ‰æ­»äº¡ï¼Œå¦‚æœkä¸æ˜¯å¼±å¼•ç”¨ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€TLå¹¶ä¸èƒ½è¢«å›æ”¶ï¼Œç°åœ¨kä¸ºå¼±å¼•ç”¨ï¼Œé‚£ä¹ˆåœ¨TLå¤±å»å¼ºå¼•ç”¨çš„æ—¶å€™ï¼Œgcå¯ä»¥ç›´æ¥å›æ”¶æ‰å®ƒï¼Œå¼±å¼•ç”¨å¤±æ•ˆï¼Œè¿™å°±æ˜¯ä¸Šé¢ä»£ç é‡Œä¼šè¿›è¡Œæ£€æŸ¥ï¼Œk=nullçš„æ¸…é™¤é‡Šæ”¾å†…å­˜çš„åŸå› ï¼ˆè¿™ä¸ªå¯ä»¥å‚è€ƒä¸‹é¢expungeStaleEntryæ–¹æ³•ï¼Œè€Œä¸”setã€getã€removeéƒ½ä¼šè°ƒç”¨è¯¥æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯TLé˜²æ­¢å†…å­˜æ³„æ¼æ‰€åšçš„å¤„ç†ï¼‰ã€‚ ç»¼ä¸Šï¼Œç®€å•æ¥è¯´è¿™ä¸ªå¼±å¼•ç”¨å°±æ˜¯ç”¨æ¥è§£å†³ç”±äºä½¿ç”¨TLä¸å½“å¯¼è‡´çš„å†…å­˜æ³„æ¼é—®é¢˜çš„ï¼Œå‡å¦‚æ²¡æœ‰å¼±å¼•ç”¨ï¼Œé‚£ä¹ˆä½ åˆç”¨åˆ°äº†çº¿ç¨‹æ± ï¼ˆæ± åŒ–åçº¿ç¨‹ä¸ä¼šè¢«é”€æ¯ï¼‰ï¼Œç„¶åTLå¯¹è±¡åˆæ˜¯å±€éƒ¨çš„ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´çº¿ç¨‹æ± å†…çº¿ç¨‹é‡Œçš„ThreadLocalMapå­˜åœ¨å¤§é‡çš„æ— æ„ä¹‰çš„TLå¯¹è±¡å¼•ç”¨ï¼Œé€ æˆè¿‡å¤šæ— æ„ä¹‰çš„Entryå¯¹è±¡ï¼Œå› ä¸ºå³ä¾¿è°ƒç”¨äº†setã€getç­‰æ–¹æ³•æ£€æŸ¥k=nullï¼Œä¹Ÿæ²¡æœ‰ä½œç”¨ï¼Œè¿™å°±å¯¼è‡´äº†å†…å­˜æ³„æ¼ï¼Œé•¿æ—¶é—´è¿™æ ·æœ€ç»ˆå¯èƒ½å¯¼è‡´OOMï¼Œæ‰€ä»¥TLçš„å¼€å‘è€…ä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œå°±å°†ThreadLocalMapé‡Œå¯¹TLå¯¹è±¡çš„å¼•ç”¨æ”¹ä¸ºå¼±å¼•ç”¨ï¼Œä¸€æ—¦TLå¯¹è±¡å¤±å»å¼ºå¼•ç”¨ï¼ŒTLå¯¹è±¡å°±ä¼šè¢«å›æ”¶ï¼Œé‚£ä¹ˆè¿™é‡Œçš„å¼±å¼•ç”¨æŒ‡å‘çš„å€¼å°±ä¸ºnullï¼Œç»“åˆä¸Šé¢è¯´çš„ï¼Œè°ƒç”¨æ“ä½œæ–¹æ³•æ—¶ä¼šæ£€æŸ¥k=nullçš„Entryè¿›è¡Œå›æ”¶ï¼Œä»è€Œé¿å…äº†å†…å­˜æ³„æ¼çš„å¯èƒ½æ€§ã€‚ å› ä¸ºTLè§£å†³äº†å†…å­˜æ³„æ¼çš„é—®é¢˜ï¼Œå› æ­¤å³ä¾¿æ˜¯å±€éƒ¨å˜é‡çš„TLå¯¹è±¡ä¸”å¯ç”¨çº¿ç¨‹æ± æŠ€æœ¯ï¼Œä¹Ÿæ¯”è¾ƒéš¾é€ æˆå†…å­˜æ³„æ¼çš„é—®é¢˜ï¼Œè€Œä¸”æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„åœºæ™¯å°±åƒä¸€å¼€å§‹çš„ç¤ºä¾‹ä»£ç ä¸€æ ·ï¼Œä¼šåˆå§‹åŒ–ä¸€ä¸ªå…¨å±€çš„staticçš„TLå¯¹è±¡ï¼Œè¿™å°±æ„å‘³ç€è¯¥å¯¹è±¡åœ¨ç¨‹åºè¿è¡ŒæœŸé—´éƒ½ä¸ä¼šå­˜åœ¨å¼ºå¼•ç”¨æ¶ˆå¤±çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸åŒçš„TLå¯¹è±¡ç»™ä¸åŒçš„Threadé‡Œçš„ThreadLocalMapèµ‹å€¼ï¼Œé€šå¸¸ä¼šsetå€¼ï¼ˆè¦†ç›–åŸæœ‰å€¼ï¼‰ï¼Œå› æ­¤åœ¨ä½¿ç”¨çº¿ç¨‹æ± çš„æ—¶å€™ä¹Ÿä¸ä¼šé€ æˆé—®é¢˜ï¼Œå¼‚æ­¥å¼€å§‹ä¹‹å‰setå€¼ï¼Œç”¨å®Œä»¥åremoveï¼ŒTLå¯¹è±¡å¯ä»¥å¤šæ¬¡å¾—åˆ°ä½¿ç”¨ï¼Œå¯ç”¨çº¿ç¨‹æ± çš„æƒ…å†µä¸‹å¦‚æœä¸è¿™æ ·åšï¼Œå¾ˆå¯èƒ½ä¸šåŠ¡é€»è¾‘ä¹Ÿä¼šå‡ºé—®é¢˜ï¼ˆä¸€ä¸ªçº¿ç¨‹å­˜åœ¨ä¹‹å‰æ‰§è¡Œç¨‹åºæ—¶é—ç•™ä¸‹æ¥çš„æœ¬åœ°å˜é‡ï¼Œä¸€æ—¦è¿™ä¸ªçº¿ç¨‹è¢«å†æ¬¡åˆ©ç”¨ï¼Œgetæ—¶å°±ä¼šæ‹¿åˆ°ä¹‹å‰çš„è„å€¼ï¼‰ï¼› è¯´å®Œäº†setï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹getï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445public T get() { Thread t = Thread.currentThread(); ThreadLocal.ThreadLocalMap map = getMap(t); //è·å–çº¿ç¨‹å†…çš„ThreadLocalMapå¯¹è±¡ if (map != null) { ThreadLocal.ThreadLocalMap.Entry e = map.getEntry(this); //æ ¹æ®å½“å‰TLå¯¹è±¡ï¼ˆkeyï¼‰è·å–å¯¹åº”çš„Entry if (e != null) { @SuppressWarnings(\"unchecked\") T result = (T)e.value; return result; //ç›´æ¥è¿”å›valueå³å¯ } } return setInitialValue(); //å¦‚æœå‘ç°å½“å‰çº¿ç¨‹è¿˜æ²¡æœ‰ThreadLocalMapå¯¹è±¡ï¼Œåˆ™è¿›è¡Œåˆå§‹åŒ– } private ThreadLocal.ThreadLocalMap.Entry getEntry(ThreadLocal&lt;?&gt; key) { int i = key.threadLocalHashCode &amp; (table.length - 1); //è®¡ç®—ä¸‹æ ‡ ThreadLocal.ThreadLocalMap.Entry e = table[i]; if (e != null &amp;&amp; e.get() == key) //æ ¹æ®ä¸‹æ ‡è·å–çš„Entryå¯¹è±¡å¦‚æœkeyä¹Ÿç­‰äºå½“å‰TLå¯¹è±¡ï¼Œåˆ™ç›´æ¥è¿”å›ç»“æœå³å¯ return e; else return getEntryAfterMiss(key, i, e); //ä¸Šé¢è¯´è¿‡ï¼Œæœ‰äº›æƒ…å†µä¸‹å­˜åœ¨ä¸‹æ ‡å†²çªçš„é—®é¢˜ï¼ŒTLæ˜¯é€šè¿‡çº¿æ€§æ¢æŸ¥æ³•æ¥è§£å†³çš„ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿä¸€æ ·ï¼Œå¦‚æœä¸Šé¢æ²¡æ‰¾åˆ°ï¼Œåˆ™ç»§ç»­é€šè¿‡ä¸‹æ ‡ç´¯åŠ çš„æ–¹å¼ç»§ç»­å¯»æ‰¾ } private ThreadLocal.ThreadLocalMap.Entry getEntryAfterMiss(ThreadLocal&lt;?&gt; key, int i, ThreadLocal.ThreadLocalMap.Entry e) { ThreadLocal.ThreadLocalMap.Entry[] tab = table; int len = tab.length; while (e != null) { ThreadLocal&lt;?&gt; k = e.get(); //ç»§ç»­ç´¯åŠ ä¸‹æ ‡çš„æ–¹å¼ä¸€ç‚¹ç‚¹çš„å¾€ä¸‹æ‰¾ if (k == key) //æ‰¾åˆ°äº†å°±è¿”å›å‡ºå»ç»“æœ return e; if (k == null) //è¿™é‡Œä¹Ÿä¼šæ£€æŸ¥k==nullçš„Entryï¼Œæ»¡è¶³å°±æ‰§è¡Œåˆ é™¤æ“ä½œ expungeStaleEntry(i); else //å¦åˆ™ç»§ç»­ç´¯åŠ ä¸‹æ ‡æŸ¥æ‰¾ i = nextIndex(i, len); e = tab[i]; } return null; //æ‰¾ä¸åˆ°è¿”å›null } //è¿™é‡Œä¹Ÿæ”¾ä¸€ä¸‹nextIndexæ–¹æ³• private static int nextIndex(int i, int len) { return ((i + 1 &lt; len) ? i + 1 : 0); } ä»£ç å—5 æœ€åå†æ¥çœ‹çœ‹removeæ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556public void remove() { ThreadLocal.ThreadLocalMap m = getMap(Thread.currentThread()); if (m != null) m.remove(this); //æ¸…é™¤æ‰å½“å‰çº¿ç¨‹ThreadLocalMapé‡Œä»¥å½“å‰TLå¯¹è±¡ä¸ºkeyçš„Entry } private void remove(ThreadLocal&lt;?&gt; key) { ThreadLocal.ThreadLocalMap.Entry[] tab = table; int len = tab.length; int i = key.threadLocalHashCode &amp; (len-1); //è®¡ç®—ä¸‹æ ‡ for (ThreadLocal.ThreadLocalMap.Entry e = tab[i]; e != null; e = tab[i = nextIndex(i, len)]) { if (e.get() == key) { //æ‰¾åˆ°ç›®æ ‡Entry e.clear(); //æ¸…é™¤å¼±å¼•ç”¨ expungeStaleEntry(i); //é€šè¿‡è¯¥æ–¹æ³•å°†è‡ªå·±æ¸…é™¤ return; } } } private int expungeStaleEntry(int staleSlot) { //å‚æ•°ä¸ºç›®æ ‡ä¸‹æ ‡ ThreadLocal.ThreadLocalMap.Entry[] tab = table; int len = tab.length; tab[staleSlot].value = null; //é¦–å…ˆå°†ç›®æ ‡valueæ¸…é™¤ tab[staleSlot] = null; size--; // Rehash until we encounter null ThreadLocal.ThreadLocalMap.Entry e; int i; // ç”±ç›®æ ‡ä¸‹æ ‡å¼€å§‹å¾€åé€ä¸ªæ£€æŸ¥ï¼Œk==nullçš„æ¸…é™¤æ‰ï¼Œä¸ç­‰äºnullçš„è¦è¿›è¡Œrehash for (i = nextIndex(staleSlot, len); (e = tab[i]) != null; i = nextIndex(i, len)) { ThreadLocal&lt;?&gt; k = e.get(); if (k == null) { e.value = null; tab[i] = null; size--; } else { int h = k.threadLocalHashCode &amp; (len - 1); if (h != i) { tab[i] = null; // Unlike Knuth 6.4 Algorithm R, we must scan until // null because multiple entries could have been stale. while (tab[h] != null) h = nextIndex(h, len); tab[h] = e; } } } return i; } ä»£ç å—6 ç›®å‰ä¸»è¦æ–¹æ³•setã€getã€removeå·²ç»ä»‹ç»å®Œäº†ï¼ŒåŒ…å«å…¶å†…éƒ¨å­˜åœ¨çš„å¼±å¼•ç”¨çš„ä½œç”¨ï¼Œä»¥åŠå®é™…é¡¹ç›®ä¸­å»ºè®®çš„ç”¨æ³•ï¼Œä»¥åŠä¸ºä»€ä¹ˆè¦è¿™æ ·ç”¨ï¼Œä¹Ÿè¿›è¡Œäº†ç®€è¦çš„è¯´æ˜ï¼Œä¸‹é¢ä¸€ç¯‡ä¼šè¿›è¡Œä»‹ç»InheritableThreadLocalçš„ç”¨æ³•ä»¥åŠå…¶åŸç†æ€§åˆ†æã€‚","link":"/2019/02/15/ThreadLocal%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%80%EF%BC%89-ThreadLocal%E7%9A%84%E4%BD%BF%E7%94%A8%E5%8F%8A%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/"},{"title":"åˆ©ç”¨ReentrantLockç®€å•å®ç°ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—","text":"å€ŸåŠ©JUCé‡Œçš„ReentrantLockå®ç°ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ç»“æ„ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677package demo.concurrent.lock.queue;import java.util.concurrent.locks.Condition;import java.util.concurrent.locks.ReentrantLock;/** * @author sunqinwen * @version \\: SimpleQueue.java,v 0.1 2019-01-16 14:47 * åˆ©ç”¨é‡å…¥é”å’Œé‡å…¥é”çš„çº¿ç¨‹è°ƒåº¦å®ç°çš„ç®€å•é˜»å¡é˜Ÿåˆ— */public class SimpleQueue { private static ReentrantLock lock = new ReentrantLock(); private T[] nodes; private int tail = 0; // å…¥å…ƒç´ ä¸‹æ ‡ private int count = 0; // å…ƒç´ ä¸ªæ•° private int head = 0; // å‡ºå…ƒç´ ä¸‹æ ‡ public SimpleQueue(int size) { nodes = (T[]) new Object[size]; } private static Condition notFull = lock.newCondition(); private static Condition notEmpty = lock.newCondition(); public void put(T t) { try { lock.lock(); if (count == nodes.length) { // é˜Ÿåˆ—å·²æ»¡ï¼Œé˜»å¡ System.out.println(\"ç›®å‰é˜Ÿåˆ—å·²æ»¡ï¼Œç­‰å¾…å–å€¼ä¸­\"); notFull.await(); } if (tail &gt; (nodes.length - 1)) { // å½“å‰æ¸¸æ ‡å€¼å·²ç»å¤§äºæ•°ç»„æ¸¸æ ‡æœ€å¤§å€¼äº†ï¼Œåˆ™ä»0å¼€å§‹è®¡ç®— tail = 0; } nodes[tail] = t; // ç»™å½“å‰æ¸¸æ ‡ä½èµ‹å€¼ count++; // å…¥å…ƒç´ å…ƒç´ ä¸ªæ•°+1 tail++; // æ¸¸æ ‡å€¼+1 notEmpty.signalAll(); // èµ°åˆ°è¿™é‡Œè¯´æ˜é˜Ÿåˆ—å†…è‡³å°‘æœ‰ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™å”¤é†’å–å€¼ } catch (Exception e) { e.printStackTrace(); } finally { lock.unlock(); } } public T take() { T t = null; try { lock.lock(); if (count == 0) { // é˜Ÿåˆ—å·²ç©ºï¼Œç­‰å¾…åŠ å€¼ System.out.println(\"ç›®å‰é˜Ÿåˆ—å·²ç©ºï¼Œç­‰å¾…å…¥å€¼ä¸­\"); notEmpty.await(); } if (head &gt; (nodes.length - 1)) { // è‹¥å–å€¼æ¸¸æ ‡å¤§äºæ¸¸æ ‡æœ€å¤§å€¼ï¼Œåˆ™ä»0å¼€å§‹è®¡ç®— head = 0; } t = nodes[head]; // æ‹¿åˆ°å…ƒç´ å€¼ nodes[head] = null; // æ¸…ç©ºåŸæœ‰ä½ç½®ä¸Šçš„å€¼ head++; // å–å€¼æ¸¸æ ‡+1 count--; // å…ƒç´ ä¸ªæ•°-1 notFull.signalAll(); // èµ°åˆ°è¿™é‡Œè¯´æ˜é˜Ÿåˆ—è‡³å°‘æœ‰ä¸€ä¸ªç©ºä½ï¼Œåˆ™å”¤é†’å…¥å€¼ } catch (Exception e) { e.printStackTrace(); } finally { lock.unlock(); } return t; }} ä»£ç å—1 ä»¥ä¸Šä¸ºä¸»è¦ä»£ç ï¼Œä¸‹é¢è¿›è¡Œç®€å•çš„æµ‹è¯•ï¼š 12345678910111213141516171819202122232425262728293031@Testpublic void simpleQueueTest() throws Exception { executorService.execute(() -&gt; { simpleQueue.put(1); simpleQueue.put(2); simpleQueue.put(3); simpleQueue.put(4); simpleQueue.put(5); simpleQueue.put(6); simpleQueue.put(7); simpleQueue.put(8); simpleQueue.put(9); simpleQueue.put(10); simpleQueue.put(11); simpleQueue.put(12); }); Thread.sleep(5000L); executorService.execute(() -&gt; { Integer r; while ((r = simpleQueue.take()) != null) { System.out.println(r); } }); Thread.sleep(5000L);} ä»£ç å—2 è¿è¡Œç»“æœï¼š 123456789101112131415161718ç›®å‰é˜Ÿåˆ—å·²æ»¡ï¼Œç­‰å¾…å–å€¼ä¸­ç›®å‰é˜Ÿåˆ—å·²æ»¡ï¼Œç­‰å¾…å–å€¼ä¸­12ç›®å‰é˜Ÿåˆ—å·²æ»¡ï¼Œç­‰å¾…å–å€¼ä¸­3ç›®å‰é˜Ÿåˆ—å·²æ»¡ï¼Œç­‰å¾…å–å€¼ä¸­456789ç›®å‰é˜Ÿåˆ—å·²ç©ºï¼Œç­‰å¾…å…¥å€¼ä¸­101112ç›®å‰é˜Ÿåˆ—å·²ç©ºï¼Œç­‰å¾…å…¥å€¼ä¸­","link":"/2019/02/12/%E5%88%A9%E7%94%A8ReentrantLock%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97/"},{"title":"æ·±å…¥ç†è§£mapç³»åˆ—-HashMapï¼ˆä¸€ï¼‰","text":"Mapç³»åˆ—ä¹‹HashMapï¼ˆæºç åŸºäºjava8ï¼‰ HashMapæ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„mapå®ç°ä¹‹ä¸€ï¼Œè¿™ç¯‡æ–‡ç« å°†ä¼šä»‹ç»HashMapå†…éƒ¨æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠå†…éƒ¨çš„æ•°æ®ç»“æ„æ˜¯æ€æ ·çš„ ä¸€ã€æ•°æ®ç»“æ„ç®€å›¾ äºŒã€æºç è§£æé¦–å…ˆçœ‹ä¸‹Mapæ¥å£é‡Œå¸¸ç”¨çš„å‡ ä¸ªæ–¹æ³•ï¼š 1234V put(K key, V value);V get(Object key);V remove(Object key);boolean containsKey(Object key); ä»£ç å—1 ä¸Šé¢æ˜¯å¸¸ç”¨çš„ä¸»è¦æ“ä½œæ–¹æ³•ï¼Œä¸‹é¢æ¥çœ‹ä¸‹mapçš„åŸºæœ¬å­˜å‚¨å•ä½Entryï¼š 12345678910111213interface Entry&lt;K,V&gt; { K getKey(); //è¿”å›å½“å‰å­˜å‚¨æ•°æ®é‡Œçš„key V getValue(); //è¿”å›å½“å‰å­˜å‚¨æ•°æ®é‡Œçš„value V setValue(V value); //ç»™valueèµ‹å€¼ boolean equals(Object o); //é‡å†™equalsæ–¹æ³• int hashCode(); //é‡å†™hashCodeæ–¹æ³• } ä»£ç å—2 ç„¶åæˆ‘ä»¬æ¥çœ‹ä¸‹HashMapé‡Œå¯¹è¯¥æ¥å£çš„å®ç°ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243// åŸºæœ¬å­˜å‚¨ç»“æ„ï¼Œå¯ä»¥çœ‹å‡ºæ¥è¿™æ˜¯ä¸€ä¸ªç®€å•çš„é“¾è¡¨ç»“æ„ï¼Œè¿™é‡Œçš„å®ç°ç±»å«Nodestatic class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; { final int hash; //æ ¹æ®keyè®¡ç®—å‡ºæ¥çš„å“ˆå¸Œå€¼ final K key; //æ•°æ®é”® V value; //æ•°æ®å€¼ Node&lt;K,V&gt; next; //ä¸‹ä¸€ä¸ªæ•°æ®èŠ‚ç‚¹ Node(int hash, K key, V value, Node&lt;K,V&gt; next) { this.hash = hash; this.key = key; this.value = value; this.next = next; } public final K getKey() { return key; } public final V getValue() { return value; } public final String toString() { return key + \"=\" + value; } public final int hashCode() { return Objects.hashCode(key) ^ Objects.hashCode(value); } public final V setValue(V newValue) { V oldValue = value; value = newValue; return oldValue; } // åˆ¤ç­‰ï¼Œè¦æ±‚kï¼Œvå¿…é¡»æ»¡è¶³ç›¸ç­‰æ‰è¡Œ public final boolean equals(Object o) { if (o == this) return true; if (o instanceof Map.Entry) { Map.Entry e = (Map.Entry)o; if (Objects.equals(key, e.getKey()) &amp;&amp; Objects.equals(value, e.getValue())) return true; } return false; } } ä»£ç å—3 æˆ‘ä»¬å†æ¥çœ‹çœ‹hashå€¼çš„è®¡ç®—ï¼Œåœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œå“ˆå¸Œå€¼å–å†³äº†æ•£åˆ—åº¦ï¼Œæœ€ç»ˆæ’å…¥çš„æ•°æ®ä¼šåˆ†å¸ƒåˆ°å“ªä¸ªæ•°ç»„ä¸‹æ ‡ä¸‹ï¼Œhashå€¼èµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨ï¼š 1234static final int hash(Object key) { int h; return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16); } ä»£ç å—4 ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å…·ä½“æ’å…¥æ•°æ®æ—¶åšçš„æ“ä½œï¼Œå…·ä½“è§£é‡Šå·²ç»åŠ ä¸Šæ³¨é‡Šï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) { HashMap.Node&lt;K,V&gt;[] tab; //å­˜å‚¨é“¾è¡¨çš„æ•°ç»„ç»“æ„ HashMap.Node&lt;K,V&gt; p; //è¢«æ’å…¥çš„å…ƒç´ é“¾è¡¨å¤´éƒ¨å…ƒç´  int n, i; //nè¡¨ç¤ºå½“å‰å“ˆå¸Œè¡¨æ•°ç»„é•¿åº¦ï¼Œiè¡¨ç¤ºæœ¬æ¬¡æ’å…¥å…ƒç´ è¢«åˆ†é…çš„ä¸‹æ ‡ if ((tab = table) == null || (n = tab.length) == 0) { //è¡¨ç¤ºå“ˆå¸Œè¡¨æ•°ç»„è¿˜æœªè¢«åˆå§‹åŒ– n = (tab = resize()).length; //åˆå§‹åŒ–ï¼Œresizeç”¨æ¥æ‰©å®¹ } //è¡¨ç¤ºå½“å‰ï¼ˆä¸‹æ ‡ç”±æœ€å¤§ä¸‹æ ‡å€¼å’Œå½“å‰å…ƒç´ å“ˆå¸Œå€¼ä½è¿ç®—å¾—å‡ºï¼‰ä½ç½®è¿˜æ²¡æœ‰ä»»ä½•é“¾è¡¨ç»“æ„ï¼Œè¿™æ—¶ç›´æ¥åˆå§‹åŒ–å³å¯ if ((p = tab[i = (n - 1) &amp; hash]) == null) { tab[i] = newNode(hash, key, value, null); } else { // å¦åˆ™ï¼Œéœ€è¦è¿›è¡Œé“¾è¡¨æ•°æ®æ’å…¥çš„æ“ä½œï¼Œæ³¨æ„ç°åœ¨på·²ç»æ˜¯è®¡ç®—å‡ºæ¥çš„é“¾è¡¨å¤´å…ƒç´ äº† HashMap.Node&lt;K,V&gt; e; K k; if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) { e = p; // è‹¥å‘ç°æ’å…¥çš„æ•°æ®è·Ÿpå“ˆå¸Œå€¼ã€keyå®Œå…¨ä¸€è‡´ï¼Œåˆ™ç›´æ¥è®©æ–°æ’å…¥çš„æ•°æ®ç­‰äºpå³å¯ } else if (p instanceof HashMap.TreeNode){ // ç»“åˆä¸‹é¢çš„ä»£ç ï¼Œé“¾è¡¨æ·±åº¦å¤§äº8åï¼Œå°±æ˜¯ä¸ªçº¢é»‘æ ‘ç»“æ„äº†ï¼Œè¿™æ—¶å¯ç”¨ä¸‹é¢çš„ä»£ç åŠ å…¥æ–°æ•°æ® e = ((HashMap.TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); } else { // è¯´æ˜æ’å…¥çš„æ˜¯æ–°å…ƒç´  for (int binCount = 0; ; ++binCount) { // éå†é“¾è¡¨ if ((e = p.next) == null) { p.next = newNode(hash, key, value, null); //æ’å…¥é“¾è¡¨å°¾éƒ¨ if (binCount &gt;= TREEIFY_THRESHOLD - 1) // java8æ–°å¼•å…¥çš„æ¦‚å¿µï¼Œå½“é“¾è¡¨æ·±åº¦å¤§äº8æ—¶ï¼Œå°±è½¬æ¢ä¸ºçº¢é»‘æ ‘ç»“æ„äº† treeifyBin(tab, hash); break; } if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) { break; // è‹¥å‘ç°éå†è¿‡ç¨‹ä¸­å­˜åœ¨ä¸æ’å…¥å€¼ä¸€è‡´çš„ï¼Œç›´æ¥break } p = e; } } if (e != null) { // è¯´æ˜æœªæˆåŠŸæ’å…¥ V oldValue = e.value; if (!onlyIfAbsent || oldValue == null) e.value = value; afterNodeAccess(e); return oldValue; // è¿”å›å·²å­˜åœ¨çš„æ—§å€¼ } } ++modCount; if (++size &gt; threshold) { //æ–°æ’å…¥å€¼åï¼Œæ»¡è¶³æ‰©å®¹æ¡ä»¶åˆ™è¿›è¡Œæ‰©å®¹ resize(); //æ‰©å®¹ } afterNodeInsertion(evict); return null; } ä»£ç å—5 ç”±äºjava8åšäº†æ ¹æ®å…ƒç´ æ•°é‡ï¼Œè½¬æ¢æˆçº¢é»‘æ ‘ç»“æ„çš„ä¼˜åŒ–å¤„ç†ï¼Œæ‰€ä»¥ä¸Šè¿°ä»£ç ä¸­ä¼šæºæ‚ä¸€äº›ç›¸å…³çš„ä»£ç ï¼Œè¿™é‡Œå…ˆä¸ç”¨å…³å¿ƒï¼Œæˆ‘ä»¬æŒ‰ç…§æœ€åŸºæœ¬çš„å“ˆå¸Œè¡¨ç»“æ„æ¥çœ‹å°±è¡Œï¼Œä¸‹ä¸€è®²å°†ä¼šåˆ†æçº¢é»‘æ ‘ç»“æ„ã€‚ æˆ‘ä»¬æ¥ä¸‹æ¥æ¥çœ‹ä¸‹getæ–¹æ³•ï¼š 1234public V get(Object key) { Node&lt;K,V&gt; e; return (e = getNode(hash(key), key)) == null ? null : e.value;} ä»£ç å—6 ç„¶ågetNodeæ–¹æ³•ï¼š 1234567891011121314151617181920212223242526final HashMap.Node&lt;K,V&gt; getNode(int hash, Object key) { HashMap.Node&lt;K,V&gt;[] tab; //å“ˆå¸Œè¡¨æ•°ç»„ HashMap.Node&lt;K,V&gt; first, e; //æ ¹æ®hashæŸ¥æ‰¾æ•°ç»„å†…çš„ç¬¬ä¸€ä¸ªå…ƒç´  int n; K k; // nè¡¨ç¤ºæ•°ç»„é•¿åº¦ if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (first = tab[(n - 1) &amp; hash]) != null) { // æ ¹æ®ä¸‹æ ‡ï¼ˆä¸‹æ ‡ç”±æœ€å¤§ä¸‹æ ‡å€¼å’Œå½“å‰å…ƒç´ å“ˆå¸Œå€¼ä½è¿ç®—å¾—å‡ºï¼‰è·å–å½“å‰å¯¹åº”ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆé“¾è¡¨æˆ–è€…çº¢é»‘æ ‘çš„æ ¹å…ƒç´ ï¼‰ if (first.hash == hash &amp;&amp; // æ£€æŸ¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„keyæ˜¯å¦ç­‰äºå½“å‰æŸ¥æ‰¾çš„keyï¼Œè‹¥ç­‰ï¼Œç›´æ¥è¿”å› ((k = first.key) == key || (key != null &amp;&amp; key.equals(k)))){ return first; } // å¦åˆ™ç»§ç»­éå†æŸ¥æ‰¾ if ((e = first.next) != null) { if (first instanceof HashMap.TreeNode) { //çº¢é»‘æ ‘ç»“æ„çš„æŸ¥è¯¢ return ((HashMap.TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key); } // æ™®é€šé“¾è¡¨ç»“æ„éå†æŸ¥è¯¢ï¼ŒæŸ¥åˆ°ç›´æ¥è¿”å› do { if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))){ return e; } } while ((e = e.next) != null); } } return null; } ä»£ç å—7 ok,ä¸Šé¢è¯´å®Œäº†putå’Œgetï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸‹removeï¼Œä¹Ÿæ˜¯å…ˆæŠ›å¼€çº¢é»‘æ ‘ä¸è°ˆï¼Œåªçœ‹é“¾è¡¨éƒ¨åˆ†ï¼Œä¼šå¾ˆå®¹æ˜“ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950public V remove(Object key) { HashMap.Node&lt;K, V&gt; e; return (e = removeNode(hash(key), key, null, false, true)) == null ? null : e.value; }final HashMap.Node&lt;K, V&gt; removeNode(int hash, Object key, Object value, boolean matchValue, boolean movable) { HashMap.Node&lt;K, V&gt;[] tab; //å“ˆå¸Œè¡¨æ•°ç»„ HashMap.Node&lt;K, V&gt; p; //éœ€è¦è¢«ç§»é™¤çš„å…ƒç´ æ‰€å±çš„æ ¹å…ƒç´  int n, index; //nè¡¨ç¤ºæ•°ç»„é•¿åº¦ï¼Œindexè¡¨ç¤ºéœ€è¦è¢«ç§»é™¤å…ƒç´ æ ¹å…ƒç´ ä½äºæ•°ç»„çš„ä¸‹æ ‡å€¼ if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (p = tab[index = (n - 1) &amp; hash]) != null) { HashMap.Node&lt;K, V&gt; node = null, e; // nodeè¡¨ç¤ºæœ€ç»ˆéœ€è¦è¢«ç§»é™¤çš„å…ƒç´  K k; V v; if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) { node = p; // è‹¥æ ¹å…ƒç´ å°±ç­‰äºéœ€è¦è¢«ç§»é™¤çš„å…ƒç´ ï¼Œåˆ™ç›´æ¥å°†nodeèµ‹å€¼ä¸ºp } else if ((e = p.next) != null) { // å¦åˆ™ç»§ç»­å¾€ä¸‹æŸ¥æ‰¾ï¼Œç»“æ„ä¾ç„¶åˆ†ä¸ºä¸¤ç§ï¼Œçº¢é»‘æ ‘æš‚ä¸çœ‹ if (p instanceof HashMap.TreeNode) { node = ((HashMap.TreeNode&lt;K, V&gt;) p).getTreeNode(hash, key); } else { do { if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) { node = e; break; // æ‰¾åˆ°å¯¹åº”çš„å…ƒç´ ï¼Œbreak } p = e; // æ‰¾ä¸åˆ°å¯¹åº”å…ƒç´ æ—¶ï¼Œè®©pä¸€ç›´ä¸‹ç§»ï¼ˆe.nextï¼‰ } while ((e = e.next) != null); } } if (node != null &amp;&amp; (!matchValue || (v = node.value) == value || (value != null &amp;&amp; value.equals(v)))) { if (node instanceof HashMap.TreeNode) { //çº¢é»‘æ ‘ç§»é™¤ ((HashMap.TreeNode&lt;K, V&gt;) node).removeTreeNode(this, tab, movable); } else if (node == p) { // å¾…ç§»é™¤å…ƒç´ ç­‰äºæ ¹å…ƒç´ æ—¶ï¼Œç›´æ¥è®©å¯¹åº”ä¸‹æ ‡ä¸‹çš„æ•°ç»„å…ƒç´ èµ‹å€¼ä¸ºæ ¹å…ƒç´ çš„ä¸‹ä¸€ä¸ªå€¼ tab[index] = node.next; } else { //å¦åˆ™ï¼Œå°±è¿›è¡Œé“¾è¡¨æ­£å¸¸åˆ é™¤é€»è¾‘ï¼Œè®©è¢«ç§»é™¤å…ƒç´ çš„å‰ä¸€ä¸ªå…ƒç´ ï¼ˆä¸ºä»€ä¹ˆç°åœ¨çš„pæ˜¯å‰ä¸€ä¸ªå…ƒç´ å‘¢ï¼Ÿå› ä¸ºåœ¨ä¸Šè¿°do whileæ“ä½œæ—¶å·²ç»é‡æ–°èµ‹å€¼äº†ï¼‰çš„ä¸‹ä¸€ä¸ªå€¼æŒ‡å‘è¢«ç§»é™¤å…ƒç´ çš„ä¸‹ä¸€ä¸ªå€¼ p.next = node.next; } ++modCount; --size; afterNodeRemoval(node); return node; } } return null; } ä»£ç å—8 å¥½äº†ï¼Œç›®å‰åŸºæœ¬ä¸ŠæŠŠé‡è¦çš„ä¸€äº›æ“ä½œç»™ä»‹ç»å®Œäº†ï¼Œç°åœ¨å†çœ‹ä¸‹containsKayè¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æåº¦ç®€å•ï¼Œç›´æ¥è°ƒç”¨getNodeæ–¹æ³•åˆ¤ç©ºå³å¯ï¼š 123public boolean containsKey(Object key) { return getNode(hash(key), key) != null;} ä»£ç å—9 æœ¬ç¯‡çš„ä¾§é‡ç‚¹åœ¨äºHashMapåœ¨ä½¿ç”¨çº¯é“¾è¡¨æ—¶çš„æ’å…¥ã€ç§»é™¤ã€æŸ¥æ‰¾æ–¹å¼ï¼Œä¸‹ä¸€ç¯‡å°†ä¼šä»‹ç»HashMapå¦‚ä½•æ‰©å®¹æ•°ç»„ã€ä»¥åŠåœ¨å¯ç”¨çº¢é»‘æ ‘ç»“æ„ä¸‹ï¼Œä¼šå¦‚ä½•åšæ’å…¥ã€ç§»é™¤ã€æŸ¥æ‰¾è¿™å‡ ç§æ“ä½œæ–¹å¼ã€‚","link":"/2019/02/12/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3map%E7%B3%BB%E5%88%97-HashMap%EF%BC%88%E4%B8%80%EF%BC%89/"},{"title":"Rediså°è®°-å†…å­˜è§£æ&å†…å­˜æ¶ˆè€—ç¯‡","text":"å‰ç½®ï¼šrediså†…å­˜æŒ‡æ ‡ æ³¨ï¼šæœ¬æ–‡é»˜è®¤è¯»è€…å·²åˆæ­¥å­¦ä¼šä½¿ç”¨redisäº†ã€‚ é¦–å…ˆæˆ‘ä»¬é€šè¿‡infoå‘½ä»¤æŸ¥çœ‹ç›¸å…³æŒ‡æ ‡ï¼Œå…¶ä¸­å‡ ä¸ªmemoryçš„é‡è¦æŒ‡æ ‡æ•´ç†å‡ºæ¥å¦‚ä¸‹ï¼š å±æ€§ è§£é‡Š used_memory rediså†…éƒ¨å­˜å‚¨çš„æ‰€æœ‰æ•°æ®çš„å†…å­˜æ€»å ç”¨é‡ï¼ˆè‡ªèº«å†…å­˜+å¯¹è±¡å†…å­˜+ç¼“å†²å†…å­˜ï¼‰ used_memory_ress redisè¿›ç¨‹å ç”¨çš„æ€»ç‰©ç†å†…å­˜ mem_fragmentation_ratio used_memory_ressä¸used_memoryçš„æ¯”å€¼ï¼Œå³ä¸ºå†…å­˜ç¢ç‰‡ç‡ mem_allocator å†…å­˜åˆ†é…å™¨ï¼Œé»˜è®¤ä¸ºjemalloc è¡¨1 ä¸€ã€ç¢ç‰‡ç‡ å½“å†…å­˜ç¢ç‰‡ç‡ &gt; 1æ—¶ï¼Œè¯´æ˜redisè¿›ç¨‹å ç”¨ç‰©ç†å†…å­˜çš„æ€»é‡å¤§äºRediså®é™…å­˜å‚¨æ•°æ®ï¼ˆè¡¨1ç¬¬ä¸€è¡Œï¼‰çš„å†…å­˜å ç”¨é‡ï¼Œæº¢å‡ºæ¥çš„éƒ¨åˆ†å†…å­˜è¢«å†…å­˜ç¢ç‰‡æ¶ˆè€—ï¼Œå¦‚æœæº¢å‡ºéƒ¨åˆ†è¿‡å¤§ï¼Œåˆ™è¯´æ˜å†…å­˜ç¢ç‰‡ç‡ä¸¥é‡ã€‚ ç›¸åçš„ï¼Œå¦‚æœç¢ç‰‡ç‡ &lt; 1æ—¶ï¼Œåˆ™è¯´æ˜Rediså­˜å‚¨çš„æ•°æ®æ€»é‡å·²ç»è¶…å‡ºäº†redisè¿›ç¨‹å ç”¨å†…å­˜çš„æ€»é‡ï¼Œé€ æˆè¿™ç§æƒ…å†µæ˜¯å› ä¸ºæ“ä½œç³»ç»ŸæŠŠRediså†…å­˜äº¤æ¢è‡³ç¡¬ç›˜å¯¼è‡´ï¼ˆswapï¼‰ï¼Œç”±äºç¡¬ç›˜è¯»å–é€Ÿåº¦è¿œè¿œæ…¢ä¸å†…å­˜ï¼Œå› æ­¤è¿™ç§æƒ…å†µä¸‹redisæ€§èƒ½æå·®ï¼Œå¯èƒ½å‡ºç°åƒµæ­»ã€‚ äºŒã€rediså†…å­˜æ¶ˆè€—çš„å‡ ä¸ªæ¥æº2.1ï¼šè‡ªèº«å†…å­˜rediså¯åŠ¨åè‡ªèº«è¿è¡Œæ‰€éœ€å†…å­˜ï¼› 2.2ï¼šå¯¹è±¡å†…å­˜å†…å­˜å ç”¨æœ€å¤§çš„ä¸€éƒ¨åˆ†ï¼Œè¿™é‡Œé¢å­˜å‚¨çš„å°±æ˜¯ç”¨æˆ·è‡ªèº«çš„æ•°æ®ï¼ˆä¸šåŠ¡æ•°æ®ï¼‰ï¼Œæ•°æ®ä»¥key-valueç±»å‹å­˜å‚¨ï¼Œå†…å­˜æ¶ˆè€—å¯è¡¨ç¤ºä¸ºï¼škeyå†…å­˜+valueå†…å­˜ã€‚ 2.3ï¼šç¼“å†²å†…å­˜ä¸»è¦ç”±å®¢æˆ·ç«¯ç¼“å†²åŒº+å¤åˆ¶ç§¯å‹ç¼“å†²åŒº+AOFç¼“å†²åŒºç»„æˆï¼Œå…·ä½“è§£é‡Šå¦‚ä¸‹ï¼š å®¢æˆ·ç«¯ç¼“å†²åŒºæŒ‡çš„æ˜¯æ‰€æœ‰æ¥å…¥redisæœåŠ¡å™¨çš„TCPè¿æ¥çš„è¾“å…¥å’Œè¾“å‡ºç¼“å†²ï¼Œè¾“å…¥ç¼“å†²æ— æ³•è¢«æ§åˆ¶ï¼Œæœ€å¤§ç©ºé—´ä¸º1Gï¼Œè¶…è¿‡ç«‹å³æ–­å¼€è¿æ¥ï¼Œè¾“å‡ºç¼“å†²é€šè¿‡client-output-buffer-limitæ§åˆ¶ã€‚ å¤åˆ¶ç§¯å‹ç¼“å†²åŒºæŒ‡çš„æ˜¯redisåœ¨2.8ç‰ˆæœ¬ä»¥åæä¾›äº†ä¸€å—å¯ä»¥é‡å¤åˆ©ç”¨çš„å›ºå®šå¤§å°çš„ç¼“å†²åŒºï¼Œç”¨æ¥å®ç°éƒ¨åˆ†å¤åˆ¶åŠŸèƒ½ï¼Œä½¿ç”¨repl-backlog-sizeå‚æ•°æ§åˆ¶ï¼Œé»˜è®¤1MBï¼ˆä¸»ä»ç»“æ„ä¸‹ï¼Œä¸»èŠ‚ç‚¹åªå­˜åœ¨ä¸€ä¸ªè¯¥ç¼“å†²åŒºï¼Œä»èŠ‚ç‚¹å…±ç”¨ï¼Œé‚£æ—¶å¯ä»¥è®¾ç½®è¾ƒå¤§çš„ç¼“å†²åŒºç©ºé—´ï¼‰ï¼Œè¯¥ç¼“å†²åŒºå¯ä»¥é¿å…å…¨é‡å¤åˆ¶ã€‚ AOFç¼“å†²åŒºç”¨äºå­˜å‚¨åœ¨redisé‡å†™æœŸé—´ä¿å­˜æœ€è¿‘çš„å†™å…¥å‘½ä»¤ï¼Œæ— æ³•æ§åˆ¶ï¼Œé€šå¸¸å–å†³äºAOFé‡å†™æ—¶é—´ä»¥åŠå†™å…¥å‘½ä»¤é‡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å¾ˆå°ã€‚ 2.4ï¼šå†…å­˜ç¢ç‰‡redisé»˜è®¤çš„å†…å­˜åˆ†é…å™¨æ˜¯jemallocï¼Œå¯é€‰çš„è¿˜æœ‰glibcå’Œtcmallocï¼›å†…å­˜åˆ†é…å™¨ä¸ºäº†æ›´å¥½çš„ç®¡ç†ä»¥åŠé‡å¤åˆ©ç”¨å†…å­˜ï¼Œåˆ†é…ç­–ç•¥ä¸€èˆ¬é‡‡ç”¨å›ºå®šèŒƒå›´çš„å†…å­˜å—è¿›è¡Œåˆ†é…ï¼›å› æ­¤ï¼Œæˆ‘ä»¬åœ¨å­˜å‚¨ä¸€å—5kbçš„å†…å®¹æ—¶ï¼Œå†…å­˜åˆ†é…å™¨å¯èƒ½ä¼šä¸ºæˆ‘ä»¬åˆ†é…8kbçš„å—å­˜å‚¨ï¼Œå‰©ä¸‹çš„3kbä¸èƒ½å†æ¬¡åˆ†é…ç»™å…¶ä»–å¯¹è±¡å­˜å‚¨ï¼Œå› è€Œæ²¦ä¸ºäº†å†…å­˜ç¢ç‰‡ï¼›jemallocå¯¹ç¢ç‰‡åŒ–é—®é¢˜åšäº†ä¼˜åŒ–ï¼Œä¸€èˆ¬æ¥è®²ç¢ç‰‡åŒ–ç‡ä¿æŒåœ¨1.03å·¦å³ã€‚ å¯èƒ½é€ æˆå†…å­˜ç¢ç‰‡ç‡è¿‡é«˜çš„åœºæ™¯ï¼š é¢‘ç¹çš„æ›´æ–°æ“ä½œï¼Œä¾‹å¦‚é¢‘ç¹å¯¹å·²å­˜åœ¨çš„é”®åšappendã€setrangeç­‰æ“ä½œï¼› å¤§é‡è¿‡æœŸé”®åˆ é™¤ï¼Œé”®å¯¹è±¡è¿‡æœŸåˆ é™¤åé‡Šæ”¾çš„ç©ºé—´æ— æ³•å¾—åˆ°å……åˆ†çš„åˆ©ç”¨ï¼Œå¯¼è‡´ç¢ç‰‡ç‡ä¸Šå‡ã€‚ è§£å†³åŠæ³•ï¼š æ•°æ®å¯¹é½ï¼Œå°½é‡é‡‡ç”¨æ•°å­—ç±»å‹æˆ–å›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²ï¼ˆå¤§éƒ¨åˆ†ä¸šåŠ¡åœºæ™¯ä¸æ»¡è¶³è¿™ç§æ–¹å¼ï¼‰ï¼› é‡å¯ï¼Œé‡å¯èŠ‚ç‚¹å¯ä»¥ä½¿å†…å­˜é‡æ•´ç†ï¼Œåˆ©ç”¨é«˜å¯ç”¨çš„ç»“æ„ï¼ˆèŠ‚ç‚¹é›†ç¾¤+ä¸»ä»ç»“æ„ï¼‰ï¼Œå°†ç¢ç‰‡ç‡è¿‡é«˜çš„èŠ‚ç‚¹ä¸»èŠ‚ç‚¹è½¬æ¢ä¸ºä»èŠ‚ç‚¹ï¼Œç„¶åè¿›è¡Œå®‰å…¨é‡å¯ã€‚ 2.5ï¼šå­è¿›ç¨‹å†…å­˜æ¶ˆè€—å­è¿›ç¨‹å†…å­˜æ¶ˆè€—æŒ‡çš„æ˜¯æ‰§è¡ŒAOF/RDBé‡å†™æ—¶redisåˆ›å»ºçš„å­è¿›ç¨‹å†…å­˜æ¶ˆè€—ï¼›redisæ‰§è¡Œforkæ“ä½œäº§ç”Ÿçš„å­è¿›ç¨‹å†…å­˜å ç”¨é‡å¯¹å¤–è¡¨ç°ä¸ºä¸çˆ¶è¿›ç¨‹ç›¸åŒï¼Œç†è®ºä¸Šéœ€è¦ä¸€å€çš„ç‰©ç†å†…å­˜æ¥å®Œæˆé‡å†™çš„æ“ä½œã€‚ä½†æ˜¯linuxå…·å¤‡å†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼ˆcopy-on-writeï¼‰ï¼Œçˆ¶å­è¿›ç¨‹ä¼šå…±äº«ç›¸åŒçš„ç‰©ç†å†…å­˜é¡µï¼Œå½“çˆ¶è¿›ç¨‹å¤„ç†å†™è¯·æ±‚æ—¶ä¼šå¯¹éœ€è¦ä¿®æ”¹çš„é¡µå¤åˆ¶å‡ºä¸€ä»½å‰¯æœ¬æ¥å®Œæˆå†™æ“ä½œï¼Œè€Œå­è¿›ç¨‹ä¾ç„¶è¯»å–forkæ—¶æ•´ä¸ªçˆ¶è¿›ç¨‹çš„å†…å­˜å¿«ç…§ï¼Œæ€»ç»“ï¼š å­è¿›ç¨‹å¹¶ä¸éœ€è¦æ¶ˆè€—ä¸€å€çš„çˆ¶è¿›ç¨‹å†…å­˜ï¼Œå®é™…æ¶ˆè€—æ ¹æ®æœŸé—´å†™å…¥å‘½ä»¤é‡å†³å®šï¼Œä½†ä¾ç„¶è¦é¢„ç•™å‡ºä¸€äº›å†…å­˜é˜²æ­¢æº¢å‡ºï¼› éœ€è¦è®¾ç½®sysctl vm.overcommit_memory = 1å…è®¸å†…æ ¸å¯ä»¥åˆ†é…æ‰€æœ‰çš„ç‰©ç†å†…å­˜ï¼Œé˜²æ­¢redisè¿›ç¨‹æ‰§è¡Œforkæ—¶å› å‰©ä½™å†…å­˜ä¸è¶³å¯¼è‡´å¤±è´¥ï¼› æ’æŸ¥å½“å‰ç³»ç»Ÿæ˜¯å¦æ”¯æŒå¼€å¯THPï¼Œå¦‚æœå¼€å¯å»ºè®®å…³é—­ï¼Œé˜²æ­¢copy-on-writeæœŸé—´å†…å­˜è¿‡åº¦æ¶ˆè€—ã€‚","link":"/2017/08/12/Redis%E5%B0%8F%E8%AE%B0-%E5%86%85%E5%AD%98%E8%A7%A3%E6%9E%90&%E5%86%85%E5%AD%98%E6%B6%88%E8%80%97%E7%AF%87/"},{"title":"æ•°æ®åº“äº‹åŠ¡çš„éš”ç¦»çº§åˆ«","text":"ä¸€ã€æ•°æ®åº“äº‹åŠ¡çš„å‡ ä¸ªç‰¹æ€§1.1ï¼šåŸå­æ€§æœ€åŸºæœ¬çš„ç‰¹æ€§ï¼Œæ„æ€æ˜¯åœ¨ä¸€ä¸ªäº‹åŠ¡å†…é‡Œæ‰€æœ‰å…³äºæ•°æ®åº“çš„æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼›æˆåŠŸæ—¶æ„å‘³ç€æœ¬æ¬¡æ“ä½œæ‰€æœ‰æ•°æ®åº“ç›¸å…³çš„å†™æ“ä½œå…¨éƒ¨æŒä¹…åŒ–ï¼Œæ— æ³•æ›´æ”¹ï¼Œå¤±è´¥æ„å‘³ç€æœ¬æ¬¡æ“ä½œç›¸å¯¹äºæ“ä½œå‰å¯¹æ•°æ®åº“æ²¡æœ‰ä»»ä½•å½±å“å’Œæ”¹å˜ã€‚ 1.2ï¼šä¸€è‡´æ€§æŒ‡çš„æ˜¯ä¸€æ¬¡å®Œæ•´çš„äº‹åŠ¡å¿…é¡»å°†æ•°æ®åº“çš„ä¸€ä¸ªä¸€è‡´çŠ¶æ€è½¬å˜åˆ°å¦å¤–ä¸€ä¸ªä¸€è‡´çŠ¶æ€ã€‚ ä¸€è‡´æ€§å†™ ä¾‹å¦‚ï¼šäº‹åŠ¡Aè¦åšçš„æ“ä½œæ˜¯å°†Aã€Bã€Cä¸‰ä¸ªè®°å½•ä¿®æ”¹ä¸ºDã€Eã€Fï¼Œé‚£ä¹ˆAã€Bã€Câ€”â€“&gt;Dã€Eã€Fçš„è¿‡ç¨‹å°±æ»¡è¶³äº†äº‹åŠ¡ä¸€è‡´æ€§ï¼Œä½†æ˜¯å¦‚æœå‡ºç°ç±»ä¼¼ï¼šAã€Bã€Câ€”-&gt;Dã€Eã€Cï¼ˆAã€Bä¿®æ”¹æˆåŠŸï¼Œä½†æ˜¯Cæœªä¿®æ”¹ï¼‰åˆ™è®¤å®šè¿èƒŒäº†äº‹åŠ¡çš„ä¸€è‡´æ€§ï¼Œç®€å•ç†è§£ä¸€è‡´æ€§å°±æ˜¯æŒ‡äº‹åŠ¡çš„â€œåˆå§‹çŠ¶æ€â€åˆ°â€œä¿®æ”¹å®ŒæˆçŠ¶æ€â€ä¸â€œç›®æ ‡çŠ¶æ€ä¸€è‡´â€ã€‚ ä¸€è‡´æ€§è¯» äº‹åŠ¡Aåœ¨æŸä¸€åˆ»å‘èµ·æŸ¥è¯¢è¯·æ±‚ï¼Œé‚£ä¹ˆæŸ¥è¯¢ç»“æœæ˜¯ä»¥é‚£ä¸€åˆ»ä¸ºå‡†ï¼Œä¿è¯äº†æ•°æ®åœ¨æŸ¥è¯¢ä¸€åˆ»çš„ä¸€è‡´æ€§ã€‚ 1.3ï¼šæŒä¹…æ€§æŒ‡ä¸€æ¬¡äº‹åŠ¡çš„æˆåŠŸæäº¤å¯¹æ•°æ®åº“é€ æˆçš„ä¿®æ”¹æ˜¯æ°¸ä¹…æ€§çš„ã€‚ 1.4ï¼šéš”ç¦»æ€§å½“å¤šä¸ªç”¨æˆ·å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œæ•°æ®åº“ä¸ºæ¯ä¸€ä¸ªç”¨æˆ·å¼€å¯çš„äº‹åŠ¡ä¸å¯ä»¥è¢«å…¶ä»–äº‹åŠ¡æ‰€å½±å“ï¼Œä¹Ÿå°±æ˜¯è¯´å¹¶å‘äº‹åŠ¡é—´è¦ç›¸äº’ç‹¬ç«‹ä¸å—åˆ°å¹²æ‰°ã€‚å…³äºéš”ç¦»æ€§åˆ†äº†é›†ä¸­éš”ç¦»ç­‰çº§ï¼Œæœ¬ç¯‡æ–‡ç« å°†è¯¦ç»†ä»‹ç»è¿™å‡ ç§éš”ç¦»ç­‰çº§ã€‚ äºŒã€äº‹åŠ¡å¹¶å‘æ—¶çš„éš”ç¦»çº§åˆ«2.1ï¼šRead Uncommittedï¼ˆè¯»æœªæäº¤ï¼‰è¿™ä¸ªéš”ç¦»çº§åˆ«ä¸‹æœªè¢«æäº¤çš„äº‹åŠ¡ä¸‹æ‰€åšçš„ä»»ä½•æ“ä½œéƒ½å¯ä»¥è¢«å…¶ä»–äº‹åŠ¡æ‰€è¯»å–åˆ°ï¼Œè¿™æ—¶å€™ä¼šé€ æˆæ•°æ®çš„è„è¯»ã€å¹»è¯»ã€ä¸å¯é‡å¤è¯»é—®é¢˜ã€‚ 2.2ï¼šRead Committedï¼ˆè¯»å·²æäº¤ï¼‰è¿™ä¸ªéš”ç¦»çº§åˆ«ä¸‹æœªè¢«æäº¤çš„æ“ä½œä¸å¯ä»¥è¢«å…¶ä»–äº‹åŠ¡æ‰€è¯»å–åˆ°ï¼Œç®€å•æ¥è®²å°±æ˜¯å•ä¸ªäº‹åŠ¡é‡Œçš„å†…å®¹åœ¨äº‹åŠ¡æˆåŠŸæäº¤ä¹‹å‰ï¼Œæ˜¯ä¸ä¼šè¢«å…¶ä»–äº‹åŠ¡æ‰€è¯»å–ï¼ˆå‘ç°ï¼‰åˆ°çš„ï¼Œä½†æ˜¯è¿™æ ·åŒæ ·ä¼šå‡ºç°å¹»è¯»ã€ä¸å¯é‡å¤è¯»ç°è±¡ã€‚ ä¸¾ä¸ªæ —å­ï¼šäº‹åŠ¡T1è¦å¯¹Cè¡¨åšæ·»åŠ æ“ä½œï¼ŒåŒæ—¶äº‹åŠ¡T2é‡Œè¦è¯»å–Cè¡¨ï¼ŒT2ç¬¬ä¸€æ¬¡è¯»å–Cè¡¨æ—¶è¿”å›1æ¡æ•°æ®ï¼Œè¿™æ—¶T1æ‰§è¡Œå®Œæ¯•ï¼Œé‚£ä¹ˆT2å¦‚æœå†æ¬¡å–ä¸€æ¬¡Cè¡¨æ•°æ®å°±ä¼šå‘ç°å¤šå‡ºä¸€æ¡æ•°æ®ã€‚ 2.3ï¼šRepeatable Readï¼ˆå¯é‡è¯»ï¼‰Mysqlé»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼Œè¿™ä¸ªéš”ç¦»çº§åˆ«ä¸‹åŒä¸€äº‹åŠ¡è¯»å–åˆ°çš„æ•°æ®ä¸€è‡´ï¼ˆç®€å•ç‚¹è¯´å°±æ˜¯T1ä¸€æ—¦å¼€å§‹ï¼Œè¯»å–åˆ°æ•°æ®å¦‚æœä¸­é—´è¢«T2ä¿®æ”¹ï¼Œé‚£ä¹ˆT1å†æ¬¡è¯»å–è¯¥æ•°æ®æ˜¯å’Œç¬¬ä¸€æ¬¡è¯»å–æ—¶ä¸€æ ·çš„ï¼‰ï¼Œå› æ­¤ï¼Œåœ¨è¯¥éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸ä¼šé€ æˆè„è¯»ã€ä¸å¯é‡å¤è¯»ï¼Œä½†ä¾æ—§ä¼šé€ æˆå¹»è¯»ç°è±¡ã€‚ 2.4ï¼šSerializableï¼ˆä¸²è¡Œï¼‰æœ€é«˜éš”ç¦»çº§åˆ«ï¼Œä¼šä¸ºæ¯ä¸ªäº‹åŠ¡æ’åºï¼ˆä¸ºæ¯æ¡æ•°æ®éƒ½åŠ ä¸Šé”ï¼‰ï¼Œä½¿ä¹‹æ‰§è¡Œä¸²è¡ŒåŒ–ï¼Œä¸å¯èƒ½äº§ç”Ÿå†²çªï¼Œå› æ­¤è§£å†³äº†è„è¯»ã€å¹»è¯»ã€ä¸å¯é‡å¤è¯»é—®é¢˜ï¼Œä½†æ˜¯ä¼šé€ æˆé”ç«äº‰ç”šè‡³è¶…æ—¶ï¼Œä¸€èˆ¬ä¸ä¼šé‡‡ç”¨è¿™ç§æç«¯çš„éš”ç¦»æœºåˆ¶ã€‚ ä¸‰ã€äº‹åŠ¡å¹¶å‘è¿‡ç¨‹ä¸­äº§ç”Ÿçš„é—®é¢˜3.1ï¼šè„è¯»ä¸€ä¸ªäº‹åŠ¡è¯»å–åˆ°äº†å¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¸­æœªæäº¤çš„æ•°æ®ã€‚ 3.2ï¼šä¸å¯é‡å¤è¯»ä¸€ä¸ªäº‹åŠ¡è¯»å–åˆ°äº†å¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¸­æäº¤çš„ä¿®æ”¹æ‰çš„æ•°æ®ã€‚ 3.3ï¼šå¹»è¯»ä¸€ä¸ªäº‹åŠ¡è¯»å–åˆ°äº†å¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¸­æ·»åŠ çš„æ•°æ®ã€‚ Tipï¼šä¸å¯é‡å¤è¯»å’Œå¹»è¯»çš„åŒºåˆ«åœ¨äºç€é‡ç‚¹ä¸€ä¸ªæ˜¯updateï¼Œä¸€ä¸ªæ˜¯insert å››ã€å„ç§éš”ç¦»çº§åˆ«ä¸‹å¯¹åº”çš„é—®é¢˜é€šè¿‡è®¾ç½®ä¸åŒçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå¯ä»¥é¿å…äº‹åŠ¡å¹¶å‘æ—¶æ‰€é€ æˆçš„éƒ¨åˆ†é—®é¢˜ã€‚ æ€»ç»“å››ç§éš”ç¦»çº§åˆ«æ‰€é€ æˆå’Œé¿å…çš„é—®é¢˜ï¼ˆè¯·å…ˆçœ‹ä»¥ä¸Šå†…å®¹åå†çœ‹æ­¤è¡¨ï¼‰ï¼š éš”ç¦»çº§åˆ« è„è¯» ä¸å¯é‡å¤è¯» å¹»è¯» Read Uncommitted æ˜¯ æ˜¯ æ˜¯ Read Committed å¦ æ˜¯ æ˜¯ Repeatable Read å¦ å¦ æ˜¯ Serializable å¦ å¦ å¦ è¡¨1","link":"/2017/04/10/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/"},{"title":"ç®€å•å®ç°ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼","text":"æœ¬å®ä¾‹ä¸­å•ç‹¬ä¸ºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å„å¼€è¾Ÿä¸€ä¸ªçº¿ç¨‹ä½œä¸ºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„æ‰§è¡Œçº¿ç¨‹ï¼Œåœ¨ç”Ÿäº§è€…æ¶ˆè´¹è€…è®¾è®¡æ¨¡å¼ä¸­å­˜åœ¨ä¸€ä¸ªæ•°æ®ç¼“å†²åŒºï¼Œä½¿ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„â€œç”Ÿäº§â€å’Œâ€œæ¶ˆè´¹â€åŠ¨ä½œéƒ½åœ¨è¯¥ç¼“å†²åŒºè¿›è¡Œï¼Œè¿™æ ·åšçš„ç›®çš„å°±æ˜¯ä¿è¯äº†ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„å®Œç¾è§£è€¦ï¼Œè¯•æƒ³ä¸€ä¸‹å¦‚æœæ²¡äº†è¿™ä¸ªç¼“å†²åŒºï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸­çš„æ–¹æ³•äº’è°ƒï¼Œé‚£ä¹ˆä¸¤ä¸ªç±»çš„å…³è”åº¦ï¼ˆè€¦åˆåº¦ï¼‰å°±ä¼šå¾ˆé«˜ï¼Œä¸€æ—¦ä¸€ä¸ªå‘ç”Ÿå˜åŒ–ï¼ŒåŠ¿å¿…ä¼šå½±å“å¦å¤–ä¸€ä¸ªï¼› ä¸‹é¢å¼€å§‹æˆ‘ä»¬çš„å®ä¾‹ï¼š é¦–å…ˆæ˜¯ç”Ÿäº§è€…çš„ä»£ç ï¼š 12345678910111213141516171819202122/** * ç”Ÿäº§è€… */public class Product implements Runnable{ private Queue queue; public Product(Queue queue){ this.queue = queue; } @Override public void run() { try{ for(int i = 0; i &lt; 10; i++){ queue.product(\"Product------\" + \"No.\" + i);//å¼€å§‹ç”Ÿäº§ } }catch (Exception e){ e.printStackTrace(); } }} ä»£ç å—1 è¿™æ˜¯æ¶ˆè´¹è€…ï¼š 12345678910111213141516171819202122/** * æ¶ˆè´¹è€… */public class Consumer implements Runnable{ private Queue queue; public Consumer(Queue queue){ this.queue = queue; } @Override public void run() { try{ for(int i = 0; i &lt; 10; i++){ System.out.println(\"already gone : \" + queue.consumer());//å¼€å§‹æ¶ˆè´¹ } }catch (Exception e){ e.printStackTrace(); } }} ä»£ç å—2 è¿™æ˜¯ç¼“å†²åŒºï¼Œå‡ ä¹æ‰€æœ‰çš„é€»è¾‘éƒ½æ˜¯åœ¨è¿™é‡Œå®ç°çš„ï¼š 123456789101112131415161718192021222324252627282930313233343536373839/** * é˜Ÿåˆ—ç¼“å†²åŒº */public class Queue { private Object signal = new Object();//å½“å‰çº¿ç¨‹çš„æŒ‚èµ·å’Œæ‰§è¡Œæ ‡è®° private boolean isFull = false;//é˜Ÿåˆ—æ˜¯å¦å·²æ»¡ private List list = new ArrayList&lt;&gt;();//é˜Ÿåˆ— public void product(String msg) throws Exception{ synchronized (signal){ if(!isFull){//å¦‚æœæ²¡æœ‰æ»¡ï¼Œæ‰§è¡Œå¦‚ä¸‹ä»£ç  list.add(msg);//åŠ è¿›é˜Ÿåˆ— isFull = true; System.out.println(\"Product One !\"); signal.notify();//å”¤é†’å½“å‰æ¶ˆè´¹è€…é‡Œé¢è¢«æŒ‚èµ·çš„çº¿ç¨‹ } signal.wait();//å¦åˆ™ï¼Œå¦‚æœå½“å‰æ»¡äº†ï¼Œè¯´æ˜æ¶ˆè´¹è€…æ­£åœ¨æ¶ˆè´¹ï¼ŒæŒ‚èµ·å½“å‰ç”Ÿäº§çº¿ç¨‹ } } public String consumer() throws Exception{ synchronized (signal){ if(!isFull){ //ä¸æ»¡ï¼Œè¯´æ˜ç”Ÿäº§è€…æ­£åœ¨ç”Ÿäº§ï¼Œåº”å½“æŒ‚èµ·consumerçº¿ç¨‹ System.out.println(\"Empty Product !\"); signal.wait(); } isFull = false;//å·²æ¶ˆè´¹ï¼Œé˜Ÿåˆ—è¢«æ ‡è®°ä¸ºä¸æ»¡çŠ¶æ€ signal.notify();//é€šçŸ¥ç”Ÿäº§è€… } //æ¶ˆè´¹ï¼ˆè¯»å–ï¼‰ String result = \"\"; if(list.size() &gt; 0){ result = this.list.get(list.size() - 1); this.list.remove(list.size() - 1); } return result; }} ä»£ç å—3 ä¸Šé¢è¿™ä¸ªæ¨¡å¼åˆ©ç”¨javaç°æœ‰çš„é˜»å¡é˜Ÿåˆ—å¾ˆå®¹æ˜“å®ç°ï¼Œå¯ä»¥é¿å…ä¸Šè¿°ä»£ç ä¸­å¾ˆå¤§ä¸€éƒ¨åˆ†ä»£ç ï¼ˆçº¿ç¨‹çš„æŒ‚èµ·ã€å”¤é†’ã€é˜Ÿåˆ—å¼¹å‡ºæ•°æ®ç­‰ï¼‰","link":"/2016/04/15/%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0%E7%94%9F%E4%BA%A7%E8%80%85%E5%92%8C%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%BC%8F/"},{"title":"ç®€å•æ¨¡æ‹Ÿspringçš„iocå’Œaop","text":"springæœ€æ ¸å¿ƒçš„éƒ¨åˆ†è«è¿‡äºiocå’Œaopäº†ï¼Œä¸‹é¢æ¥ç®€å•æ¨¡æ‹Ÿä¸‹è¿™ä¸¤ç§æ€æƒ³ psï¼šå¦‚æœæœ‰å“ªé‡Œç†è§£çš„ä¸å¯¹æˆ–è€…ä»£ç ä¸Šæœ‰ç‘•ç–µçš„åœ°æ–¹æ¬¢è¿å¤§å®¶æŒ‡æ­£ï¼Œå¤§å®¶äº’ç›¸å­¦ä¹ ï¼Œè¿˜æœ‰å°±æ˜¯è¿™åªæ˜¯æ¨¡ä»¿ä¸€ä¸‹springæ€æƒ³ï¼Œåªæ˜¯æŠŠäº‹åŠ¡ç®¡ç†å’Œbeanç®¡ç†ç®€å•æ¨¡ä»¿ä¸€ä¸‹ï¼Œå®Œå…¨ä¸ä»£è¡¨springï¼Œå¦‚æœæƒ³æ·±å…¥ç†è§£è¯·çœ‹springæºç  ä¸‹é¢å°±å¼€å§‹è¿›è¡Œç®€å•çš„æ¨¡æ‹Ÿã€‚ è¿™ä¸ªé¡¹ç›®ä¸æ˜¯webé¡¹ç›®ï¼Œåªæ˜¯ä¸€ä¸ªç®€å•çš„javaé¡¹ç›®ï¼Œæµ‹è¯•ç”¨junitï¼ŒåºŸè¯ä¸å¤šè¯´äº†ï¼Œä¸‹é¢ä¸Šä»£ç ï¼š é¡¹ç›®çš„ç›®å½•ç»“æ„ï¼š è¯´æ˜ï¼šå›¾ä¸­åˆ’çº¢çº¿çš„éƒ¨åˆ†éƒ½æ˜¯æ ¸å¿ƒéƒ¨åˆ† çº¢çº¿éƒ¨åˆ†è¯´æ˜ï¼š BeanFactoryï¼šæ‰€æœ‰beançš„æ ¸å¿ƒç”Ÿæˆå™¨ï¼ˆspringå®¹å™¨ï¼‰ ConnBeanï¼šjdbcè¿æ¥ç”Ÿæˆå™¨ï¼ˆæ²¡ç”¨è¿æ¥æ± å“¦~ï¼‰ Transactionï¼šäº‹åŠ¡ç®¡ç†çš„ä»£ç†ç±» beans.propertiesï¼šé…ç½®æ–‡ä»¶ å…¶ä½™çš„æ²¡åˆ’çº¿çš„å°±æ˜¯domainã€daoã€serviceã€controllerè¿™äº›webåŸºæœ¬å±‚æ¬¡ç»“æ„ï¼Œå¾…ä¼šä¼šè¯´ ä¸»è¦å‡ ä¸ªç±»çš„ä»£ç ï¼š â‘  BeanFactoryï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546package sun.juwin.factory;import java.io.BufferedReader;import java.io.InputStreamReader;import java.util.HashMap;/** * æœ¬ç±»ç”¨æ¥è¯»å–é…ç½®æ–‡ä»¶ä¸­çš„ä¿¡æ¯å¯¹æ¯ä¸ªæ¥å£å¯¹è±¡ç”Ÿæˆå…·ä½“çš„å®ç° * ä¸»è¦æ˜¯å°†æ¥å£ä½œä¸ºkeyï¼Œå®ä¾‹ä½œä¸ºvalueå­˜å‚¨è¿›å»ï¼Œè¿™æ˜¯ä¸ªå•ä¾‹ï¼Œ * springé»˜è®¤ä¸ºæ¯ä¸ªå±‚æ¬¡ç”Ÿæˆå®ç°ä¹Ÿæ˜¯å•ä¾‹ï¼Œä½†å¯ä»¥é€šè¿‡@Scope * æ¥æŒ‡å®šï¼Œæˆ‘ä»¬ç®€å•æ¨¡ä»¿ä¸€ä¸‹ï¼Œåªæ˜¯å•ä¾‹ */public class BeanFactory { private static HashMap&lt;String, Object&gt; mapResult; public static HashMap&lt;String, Object&gt; getBean() { if (mapResult == null) { synchronized (BeanFactory.class) {//åŒé‡æ£€æŸ¥çš„å•ä¾‹ï¼Œé˜²æ­¢å¤šçº¿ç¨‹è®¿é—®æ—¶å¤šæ¬¡newå¯¹è±¡ if (mapResult == null) { BufferedReader bf = null; String line = null; try { /** *ä¸‹é¢è¿™å¥ä»£ç é€šè¿‡æµæ¥è¯»å–èµ„æºåŒ…ä¸‹é¢çš„é…ç½®æ–‡ä»¶ï¼Œä¸ºäº†çœå»ä¸å¿…è¦çš„éº»çƒ¦ï¼Œ * æˆ‘ä»¬æ²¡æœ‰ç”¨xmlï¼Œè€Œæ˜¯ç”¨äº†properties */ InputStreamReader inputStreamReader = new InputStreamReader(BeanFactory.class.getClassLoader().getResourceAsStream(\"beans.properties\")); bf = new BufferedReader(inputStreamReader); mapResult = new HashMap&lt;&gt;(); while ((line = bf.readLine()) != null) {//æ¯æ¬¡ä»…è¯»ä¸€è¡Œ if (\"\".equals(line)){//æœ‰å¯èƒ½è¯»åˆ°æ¢è¡Œæ—¶éš”äº†ä¸€è¡Œï¼ˆå³åªæœ‰ä¸€ä¸ªæ¢è¡Œç¬¦ï¼‰ continue; } String[] point = line.trim().split(\"=\");//æŒ‰ç…§ç­‰å·æ‹¼æ¥ if (point.length &gt; 2) { throw new Exception(\"beansæ–‡ä»¶æ ¼å¼ä¸å¯¹ï¼\"); } Object obj = Class.forName(point[1].trim()).newInstance();//åå°„å®ä¾‹åŒ–å‡ºç›®æ ‡å¯¹è±¡ mapResult.put(point[0].trim(), obj);//ç„¶åä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å…¥ } } catch (Exception e) { e.printStackTrace(); } } } } return mapResult; }} ä»£ç å—1 ä¸Šé¢çš„ç±»å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ¥å®ä¾‹åŒ–ä¸åŒçš„å¯¹è±¡ï¼Œç¬¦åˆiocæœ€åŸºæœ¬çš„æ€æƒ³ï¼Œä¸‹é¢è®©æˆ‘ä»¬æ¥çœ‹çœ‹é…ç½®æ–‡ä»¶beans.propertiesçš„å†…å®¹å§ï¼š 12userDao = sun.juwin.dao.impl.UserDaoImpluserDetailDao = sun.juwin.dao.impl.UserDetailDaoImpl è¿™é‡Œé¢åªæœ‰ä¸¤å¥è¯ï¼ŒæŒ‡å®šdaoå±‚æ¥å£å¯¹è±¡çš„å®ç°ç±»çš„è·¯å¾„ï¼Œå…¶å®å·²ç»å¾ˆæ¥è¿‘springçš„xmlé‡Œå¯¹beançš„é…ç½®äº†ï¼Œåªä¸è¿‡è¿™é‡Œæ˜¯propertiesæ–‡ä»¶ï¼Œç®€åŒ–äº†è®¸å¤š â‘¡ TransactionProxyä»£ç†ç±»ï¼š 123456789101112131415161718192021222324252627282930313233343536package sun.juwin.proxy.transctional;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;import java.sql.Connection;/** * äº‹åŠ¡ä»£ç†ç±»ï¼Œé€šè¿‡è¿™ä¸ªç±»å¯ä»¥ä¸ºè¦æ‰§è¡Œçš„æ–¹æ³•åŠ ä¸Šäº‹åŠ¡ç®¡ç† */public class TransactionProxy implements InvocationHandler { private Object targetObj; public Object getTargetObj(Object targetObj){ this.targetObj = targetObj; return Proxy.newProxyInstance(this.targetObj.getClass().getClassLoader(), this.targetObj.getClass().getInterfaces(), this); } /*ä¸‹é¢è¿™ä¸ªæ–¹æ³•ä¼šåœ¨è¢«ä»£ç†ç±»æ‰§è¡Œæ–¹æ³•æ—¶è°ƒç”¨ï¼Œæ‹¿åˆ°è¢«ä»£ç†ç±»çš„è¦æ‰§è¡Œçš„methodå¯¹è±¡*/ @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { Object result = null; Connection connection = (Connection)args[0];//è¦æ±‚ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯conn try{ connection.setAutoCommit(false);//å¼€å¯äº‹åŠ¡ result = method.invoke(this.targetObj, args);//æ‰§è¡Œç›®æ ‡æ–¹æ³• connection.commit();//äº‹åŠ¡æäº¤ System.out.print(\"commit success!\"); }catch (Exception e){ connection.rollback();//äº‹åŠ¡å›æ»š System.err.println(\"rollback!\"); e.printStackTrace(); }finally { connection.close();//å…³é—­è¿æ¥ System.out.println(\"connection closed!\"); } return result; }} ä»£ç å—2 è¯´æ˜ï¼šjavaåœ¨1.3ç‰ˆæœ¬çš„æ—¶å€™å°±ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç”¨ä½œä»£ç†ç±»å®ç°çš„æ¥å£InvacationHandlerï¼Œé€šè¿‡å®ç°è¿™ä¸ªæ¥å£å¯ä»¥å¾ˆéšæ„çš„å†™ä¸€ä¸ªè€¦åˆåº¦ç‰¹åˆ«ä½çš„åŠ¨æ€ä»£ç†ç±»ï¼ˆå³è¿™ä¸€ä¸ªä»£ç†ç±»å¯ä»¥ä»£ç†ä»»ä½•ç±»ï¼‰ â‘¢ ConnBeanï¼Œç”¨æ¥ç”Ÿæˆä¸€ä¸ªæ•°æ®åº“è¿æ¥å¯¹è±¡ï¼Œåœ¨ä¸ç”¨è¿æ¥æ± çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç”¨ThreadLocalè¿›è¡Œå°è£…ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324package sun.juwin.db;import java.sql.Connection;import java.sql.DriverManager;/*åŸå§‹äº§ç”Ÿæ•°æ®åº“è¿æ¥çš„ç±»*/public class ConnBean { private static ThreadLocal conn = new ThreadLocal&lt;&gt;(); private ConnBean(){} public static Connection getConn(){ Connection connection = conn.get(); if(connection == null){ synchronized (ConnBean.class){//ç”±äºç”¨åˆ°äº†ThreadLocalï¼Œå› æ­¤è¯¥å•ä¾‹ä»…ä»…ç›¸å¯¹äºå½“å‰çº¿ç¨‹æ˜¯å•ä¾‹çš„ if(connection == null){ try{ Connection realConn = DriverManager.getConnection(\"jdbc:mysql://localhost:3306/db_useradd\", \"root\", \"\"); conn.set(realConn); }catch (Exception e){ e.printStackTrace(); } } } } return conn.get();//è¿”å›ç»™å½“å‰çº¿ç¨‹ä¸€ä¸ªConnectionå¯¹è±¡ }} ä»£ç å—3 ä»¥ä¸Šå°±æ˜¯æ ¸å¿ƒçš„ä¸€äº›å®ç°ä»£ç ï¼Œä¸‹é¢è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬çš„ä¸šåŠ¡å§ï¼š å®ä½“ç±»ï¼šUserï¼ŒUserDetailï¼Œè¦æ±‚æ·»åŠ ä¸€ä¸ªUserçš„åŒæ—¶è¦æ·»åŠ ä¸€ä¸ªUserDetail Userï¼š 1234private Long id;private String userName;private String address;private int money; ä»£ç å—4 UserDetailï¼š 123private Long id;private int age;private String realname; ä»£ç å—5 daoå±‚çš„æ¥å£å’Œå®ç°ï¼š UserDaoï¼š 123public interface UserDao { public void save(User user, Connection conn)throws Exception;} ä»£ç å—6 UserDaoImplï¼š 123456789101112public class UserDaoImpl implements UserDao{ @Override public void save(User user, Connection conn) throws Exception { Statement statement = conn.createStatement();//ä¸ºäº†çœå»ä¸å¿…è¦çš„éº»çƒ¦ï¼Œæˆ‘ä»¬ä¸ç”¨é¢„ç¼–è¯‘è¯­å¥ String sql = \"insert into tb_user (userName, address, money) values ('\" + user.getUserName() + \"', '\" + user.getAddress() + \"', \" + user.getMoney() + \")\"; statement.executeUpdate(sql); statement.close(); }} ä»£ç å—7 UserDetailDaoï¼š 123public interface UserDetailDao { public void save(UserDetail userDetail, Connection connection) throws Exception;} ä»£ç å—8 UserDetailDaoImplï¼š 12345678910public class UserDetailDaoImpl implements UserDetailDao { @Override public void save(UserDetail userDetail, Connection connection) throws Exception { Statement statement = connection.createStatement(); String sql = \"insert into user_detail (age, realname) values (\" +userDetail.getAge()+\", '\" +userDetail.getRealname()+\"')\"; statement.executeUpdate(sql); }} ä»£ç å—9 UserServiceï¼š 123public interface UserService { public void saveService(Connection connection, User user) throws Exception;} ä»£ç å—10 UserServiceImplï¼š 123456789101112131415161718192021222324/** * ä¸šåŠ¡å±‚ * juwin * 2015-12-04 */public class UserServiceImpl implements UserService { //ä¸‹é¢çš„daoå±‚å®ä¾‹ç”±BeanFactoryé€šè¿‡propertiesé…ç½®æ–‡ä»¶å¸®æˆ‘ä»¬ç”Ÿæˆå¯¹åº”çš„å®ä¾‹å¯¹è±¡ private UserDao userDao = (UserDao) BeanFactory.getBean().get(\"userDao\"); private UserDetailDao userDetailDao = (UserDetailDao) BeanFactory.getBean().get(\"userDetailDao\"); @Override public void saveService( Connection connection, User user)throws Exception { /** * è¿™ä¸ªä¸šåŠ¡å±‚æ–¹æ³•æ‰§è¡Œäº†ä¸¤ä¸ªdaoå±‚æ–¹æ³•ï¼Œå¯ä»¥çœ‹åšä¸€ä¸ªäº‹åŠ¡ï¼Œ * ä»»æ„ä¸€ä¸ªdaoå±‚è°ƒç”¨è¿‡ç¨‹ä¸­å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œæ•´ä¸ªä¸šåŠ¡æ–¹æ³•è¿›è¡Œçš„æ‰€æœ‰daoå±‚æ“ä½œå°±ä¼šå›æ»š */ userDao.save(user, connection); /*è¦æ±‚åœ¨æ·»åŠ userçš„åŒæ—¶ç”Ÿäº§ä¸€ä¸ªå¯¹åº”çš„detailï¼Œè¿™é‡Œå·ä¸ªæ‡’ï¼Œå°±è‡ªå·±newä¸€ä¸ªUserDetailå¯¹è±¡å§*/ UserDetail userDetail = new UserDetail(); userDetail.setAge(22); userDetail.setRealname(\"juwin\"); userDetailDao.save(userDetail, connection); throw new Exception(\"æ‹¦-è·¯-è™\");//è¿™ä¸ªå¼‚å¸¸æ˜¯ç”¨æ¥æµ‹è¯•äº‹åŠ¡ä¼šä¸ä¼šå›æ»šçš„ï¼Œæ­£å¸¸æƒ…å†µä¸‹ä¸åŠ è¿™ä¸ª }} ä»£ç å—11 UserControllerï¼š 12345678910111213141516171819202122/** * ç¨‹åºå…¥å£ï¼Œç±»ä¼¼äºcontrollerå±‚ */public class UserController { public void SaveUser(User user)throws Exception{ /** * è¿™ä¸€æ­¥å¾ˆå…³é”®ï¼Œä¸ºæ¯ä¸€ä¸ªæ‰§è¡Œè¿™ä¸ªæ“ä½œçš„çº¿ç¨‹åˆ†é…ä¸€ä¸ªconnectionè¿æ¥å¯¹è±¡ * è¯´æ˜ï¼šåœ¨å®é™…webå¼€å‘ä¸­å®¢æˆ·ç«¯é€šè¿‡å‘é€httpè¯·æ±‚åˆ°ä¸šåŠ¡åå°ï¼Œè¿™æ—¶å€™tomcatä¼šä¸ºè¿™æ¬¡è¯·æ±‚åˆ†é…ä¸€ä¸ªçº¿ç¨‹ * å› æ­¤å°±å‡ºç°äº†å¹¶å‘ç”šè‡³å¹¶è¡Œçš„ç°è±¡ï¼Œå‡è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¦‚æœåªæ˜¯åˆ©ç”¨å•ä¾‹å†™ä¸€ä¸ªç”Ÿæˆconnectionå¯¹è±¡çš„æ–¹æ³•ï¼Œ * é‚£ä¹ˆå¤šçº¿ç¨‹å¹¶å‘è®¿é—®çš„æ—¶å€™å°±æœ‰å¯èƒ½å‡ºç°ï¼šçº¿ç¨‹1åˆ©ç”¨å®Œconnectionå¯¹è±¡å°†å…¶çŠ¶æ€ä¿®æ”¹ä¸ºcloseï¼Œè€Œæ­¤æ—¶çº¿ç¨‹2 * ä¹Ÿè¦ç”¨connectionï¼Œè¿™æ—¶å€™å°±ä¼šæŠ¥â€œconnectionå·²ç»å…³é—­â€çš„å¼‚å¸¸ * å› æ­¤æˆ‘ä»¬é‡‡ç”¨ThreadLocalï¼Œä¸ºå•ç‹¬ä¸€ä¸ªçº¿ç¨‹ç”Ÿæˆä¸€ä¸ªå•ä¾‹çš„connectionå¯¹è±¡ */ Connection connection = ConnBean.getConn(); /** * ä¸‹é¢è¿™ä¸ªå®ä¾‹è¦åŠ ä¸€å±‚äº‹åŠ¡ä»£ç†ï¼Œå°±æ˜¯è®©TransactionProxyè¿™ä¸ªä»£ç†ç±»æ…åˆä¸€ä¸‹ï¼Œ * è¿™æ ·æˆ‘ä»¬å†åˆ©ç”¨serviceå±‚å¯¹è±¡è°ƒç”¨ä»»ä½•æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šåŠ ä¸Šäº‹åŠ¡ç®¡ç†äº† */ UserService userService = (UserService) new TransactionProxy().getTargetObj(new UserServiceImpl()); userService.saveService(connection,user); }} ä»£ç å—12 æµ‹è¯•ç±»ï¼š 123456789101112public class UserAddTest { @Test public void Test1() throws Exception{ User user = new User(); user.setUserName(\"weixiaojie1993\"); user.setAddress(\"beijing\"); user.setMoney(1); UserController userController = new UserController(); userController.SaveUser(user); System.out.print(\"Done !\"); }} ä»£ç å—13 okï¼Œå¤§åŠŸå‘Šæˆäº†ï¼Œç°åœ¨è®©æˆ‘ä»¬ç”¨junitæ¥æµ‹è¯•ä¸€ä¸‹å§ï¼š serviceå±‚ä¸åŠ ï¼š 1throw new Exception(\"æ‹¦-è·¯-è™\"); ä»£ç å—14 æ‰§è¡Œç»“æœï¼š å¯ä»¥çœ‹å‡ºæ¥äº‹åŠ¡å·²ç»æäº¤äº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ•°æ®åº“é‡Œé¢çš„å˜åŒ–ï¼š tb_userè¡¨ï¼š user_detailè¡¨ï¼š ç„¶ååœ¨ä¸šåŠ¡å±‚åŠ ä¸Šï¼š 1throw new Exception(\"æ‹¦-è·¯-è™\"); ä»£ç å—15 è¿è¡Œç»“æœï¼š ä»”ç»†è§‚å¯Ÿåˆ’ç»¿è‰²çº¿çš„éƒ¨åˆ†å°±èƒ½å‘ç°ï¼Œäº‹åŠ¡å·²ç»å›æ»šäº†ï¼Œçœ‹æ•°æ®åº“è¡¨ä¹Ÿæ˜¯æ²¡æœ‰è®°å½•çš„ æˆ‘ä»¬ä¸»é”®idç”±äºæ˜¯é€’å¢çš„ï¼Œå› æ­¤æˆ‘ä»¬è¿˜è¦ç¡®å®šä¸€ä¸‹äº‹åŠ¡æ˜¯ä¸æ˜¯çœŸçš„å›æ»šäº†ï¼Œæˆ‘ä»¬æŠŠå¼‚å¸¸ä»£ç å»æ‰ï¼Œç„¶åå†å¾€é‡Œé¢æ’å…¥æˆåŠŸä¸€æ¬¡æ•°æ®ï¼Œè¿è¡Œåçš„æ•°æ®åº“è¡¨è®°å½•å¦‚ä¸‹ï¼š tb_userï¼š user_detailï¼š å¤§å®¶ä»”ç»†çœ‹idï¼Œå·²ç»æ˜¯3äº†ï¼Œè¯´æ˜åŸæ¥äº‹åŠ¡æˆåŠŸå›æ»šäº† è¯´æ˜ï¼šå…¶å®connectionå¯¹è±¡ä¸å¿…æ¯æ¬¡éƒ½ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ–¹æ³•ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†æ›´æ¸…æ¥šçš„å±•ç¤ºconnectionçš„æµå‘ï¼Œå…¶å®æˆ‘ä»¬ç”¨ThreadLocalå°è£…æˆä¸€ä¸ªå•ä¾‹çš„æ—¶å€™å°±å·²ç»æ³¨å®šäº†æœ¬æ¬¡è®¿é—®ï¼ˆå³å½“å‰çº¿ç¨‹ä»controllerå±‚è°ƒç”¨åˆ°daoå±‚ï¼‰æ‰€æœ‰getåˆ°çš„connectionå¯¹è±¡éƒ½æ˜¯åŒä¸€ä¸ªï¼› æœ€åï¼Œä¸ªäººæ„Ÿè§‰è¿™ä¸ªç¨‹åºæœ‰ä¸ªéå¸¸è¦å‘½çš„åœ°æ–¹ï¼Œå°±æ˜¯æˆ‘è¦ç»™serviceå±‚åŠ äº‹åŠ¡ä»£ç†ï¼Œè¿™æ ·å°±å¯¼è‡´äº†seviceå±‚çš„å¯¹è±¡ä¸èƒ½é€šè¿‡é…ç½®æ–‡ä»¶æ¥å®ä¾‹åŒ–ï¼Œæ­£åœ¨çº ç»“ä¸­ã€‚ã€‚ä»¥åè¿˜ä¼šä¼˜åŒ–ï¼Œè¿™åªæ˜¯ç®€å•å®ç°ä»¥ä¸‹ï¼ŒçœŸæ­£çš„springè¦å¤æ‚çš„å¤šå¾—å¤šï¼Œç¬¬ä¸€æ¬¡åœ¨å¼€æºä¸­å›½å‘è¡¨åšå®¢ï¼Œä»¥åä¹Ÿä¼šå¤šå‘ä¸€äº›ï¼Œå¤§å®¶äº’ç›¸å­¦ä¹ ~","link":"/2015/12/04/%E7%AE%80%E5%8D%95%E6%A8%A1%E6%8B%9Fspring%E7%9A%84ioc%E5%92%8Caop/"},{"title":"javaå®ç°äºŒå‰æ ‘","text":"å®šä¹‰ä¸€ä¸ªèŠ‚ç‚¹ä¸‹é¢æœ€å¤šæ‹¥æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œå¹¶ä¸”ä¸¤ä¸ªå­èŠ‚ç‚¹åˆ†ä¸ºå·¦å€¼å’Œå³å€¼ï¼Œå·¦å€¼æ¯”çˆ¶èŠ‚ç‚¹è¦å°ï¼Œå³å€¼æ¯”çˆ¶èŠ‚ç‚¹è¦å¤§ javaå®ç°ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥åˆ©ç”¨javaå®ç°ä¸€æ£µå¦‚ä¸‹å›¾ä¸­çš„äºŒå‰æ ‘ï¼š å¤§å®¶å¯ä»¥æ ¹æ®æˆ‘çš„æè¿°åˆ†æä¸€ä¸‹è¿™æ£µäºŒå‰æ ‘ ä¸‹é¢å°±æ¥å†™ä»£ç å®ç°è¿™æ£µäºŒå‰æ ‘ï¼š é¦–å…ˆæ˜¯è¦å»ºç«‹ä¸€ä¸ªèŠ‚ç‚¹ç±»Nodeï¼š 123456789101112131415161718192021222324252627282930313233343536package Tree;/** * èŠ‚ç‚¹ç±» * @author javadaodechengxuyuan * */public class Node { private long value; private Node leftNode;//èŠ‚ç‚¹ä¸‹é¢çš„å·¦èŠ‚ç‚¹ private Node RightNode;//èŠ‚ç‚¹ä¸‹é¢çš„å³èŠ‚ç‚¹ //æ„é€ å™¨ public Node(long value){ this.value=value; } public long getValue() { return value; } public void setValue(long value) { this.value = value; } public Node getLeftNode() { return leftNode; } public void setLeftNode(Node leftNode) { this.leftNode = leftNode; } public Node getRightNode() { return RightNode; } public void setRightNode(Node rightNode) { RightNode = rightNode; }} ä»£ç å—1 è¿™æ˜¯äºŒå‰æ ‘ç±»ï¼Œå°±æ˜¯è¿™ä¸ªç±»ç”¨æ¥æ“ä½œèŠ‚ç‚¹ç±»çš„ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051package Tree;/** * @author javadaodechengxuyuan * äºŒå‰æ ‘ï¼šæ¯ä¸ªèŠ‚ç‚¹æœ‰æœ€å¤šä¸¤ä¸ªåˆ†å‰ï¼Œ * åˆ†åˆ«ä½œä¸ºçˆ¶èŠ‚ç‚¹çš„å·¦å€¼å’Œå³å€¼ï¼Œéµå¾ªå·¦å°å³å¤§çš„è§„åˆ™è¿›è¡Œåˆ†å‰ */public class Tree { private Node root; private Node current; private Node parent; /** * @author javadaodechengxuyuan * ä¸ºä¸€é¢—äºŒå‰æ ‘æ·»åŠ èŠ‚ç‚¹ */ public void insert(long value){//ä¸ºäºŒå‰æ ‘æ’å…¥æ–°çš„èŠ‚ç‚¹ //åˆ›å»ºæ–°çš„èŠ‚ç‚¹ Node newNode=new Node(value); //åˆ›å»ºå®Œåå°±è¯¥è€ƒè™‘æŠŠè¿™ä¸ªèŠ‚ç‚¹æ”¾åœ¨å“ªé‡Œäº†ï¼Œä¸‹é¢è¿™äº›ä»£ç å°±æ˜¯ç”¨æ¥åˆ¤æ–­å°†è¿™ä¸ªèŠ‚ç‚¹æ”¾åœ¨å“ªé‡Œçš„ if(root==null){ this.root=newNode;//å¦‚æœrootä¸ºç©ºï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡è°ƒç”¨æ·»åŠ æ—¶åº”ç»™rootåˆå§‹åŒ– }else{ this.current=root;//åˆå§‹åŒ–current while(true){//è¿›å…¥æ­»å¾ªç¯ï¼Œä¸€ç›´ç­‰åˆ°ç»™newNodeæ‰¾åˆ°åˆé€‚çš„ä½ç½®æ—¶è¿›è¡Œç»ˆæ­¢æ­»å¾ªç¯ if(this.current.getValue()&gt;value){//æ¯”rootå°ï¼Œæ”¾åœ¨å·¦ä¾§ this.parent=this.current;//è®©parentä¸€ç›´ä¿ç•™æœ¬æ¬¡çš„current this.current=this.current.getLeftNode(); if(this.current==null){//å¦‚æœå½“å‰çš„å·¦å€¼ä¸ºç©ºï¼Œé‚£ä¹ˆå°±ç»ˆæ­¢å¾ªç¯å¹¶èµ‹å€¼ç»™è¿™ä¸ªå·¦å€¼ this.parent.setLeftNode(newNode);//å°†è¿™ä¸ªæ–°èŠ‚ç‚¹æ”¾åœ¨è¿™ä¸ªä½ç½® return;//æœ€ç»ˆæ‰¾åˆ°åˆé€‚ä½ç½®ï¼Œæ­»å¾ªç¯ç»ˆæ­¢ } }else{//æ¯”rootå¤§ï¼Œæ”¾åœ¨å³ä¾§ this.parent=this.current;//è®©parentä¸€ç›´ä¿ç•™æœ¬æ¬¡çš„current this.current=this.current.getRightNode();//å°†å½“å‰çš„èŠ‚ç‚¹é‡æ–°èµ‹å€¼ç»™ä¸‹ä¸€æ¬¡éœ€è¦æ¯”è¾ƒçš„èŠ‚ç‚¹ if(this.current==null){//å¦‚æœå½“å‰çš„å³å€¼ä¸ºç©ºï¼Œé‚£ä¹ˆå°±ç»ˆæ­¢å¾ªç¯å¹¶èµ‹å€¼ç»™è¿™ä¸ªå·¦å€¼ this.parent.setRightNode(newNode);//å°†è¿™ä¸ªæ–°èŠ‚ç‚¹æ”¾åœ¨è¿™ä¸ªä½ç½® return;//æœ€ç»ˆæ‰¾åˆ°åˆé€‚ä½ç½®ï¼Œæ­»å¾ªç¯ç»ˆæ­¢ } } } } } public Node getRoot() { return root; } public void setRoot(Node root) { this.root = root; }} ä»£ç å—2 è¿™æ˜¯æµ‹è¯•ç±»ï¼š 12345678910111213141516171819202122package Tree;/** * æµ‹è¯•ç±» * @author javadaodechengxuyuan * */public class Test { public static void main(String args[]){ Tree t=new Tree(); t.insert(10);//æ ¹èŠ‚ç‚¹ t.insert(20); t.insert(15); t.insert(9); t.insert(35); System.out.print(t.getRoot().getValue()+\"ã€\");//ç¬¬0å±‚ï¼šæ ¹èŠ‚ç‚¹ System.out.print(t.getRoot().getLeftNode().getValue()+\"ã€\");//ç¬¬ä¸€å±‚å·¦å€¼ System.out.print(t.getRoot().getRightNode().getValue()+\"ã€\");//ç¬¬ä¸€å±‚å³å€¼ System.out.print(t.getRoot().getRightNode().getLeftNode().getValue()+\"ã€\");//ç¬¬äºŒå±‚å·¦å€¼ System.out.print(t.getRoot().getRightNode().getRightNode().getValue());//ç¬¬äºŒå±‚å³å€¼ //è¾“å‡ºç»“æœåº”ä¸ºï¼š10ã€9ã€20ã€15ã€35 }} ä»£ç å—3 è¾“å‡ºç»“æœåº”è¯¥ä¸ºï¼š 110ã€9ã€20ã€15ã€35 è¿™åªæ˜¯ç®€å•çš„æ’å…¥åŠŸèƒ½ï¼Œä¸‹ä¸€èŠ‚æˆ‘ä¼šå†™å¦‚ä½•æŸ¥æ‰¾äºŒå‰æ ‘çš„èŠ‚ç‚¹ä»¥åŠåˆ é™¤èŠ‚ç‚¹ã€è¿˜æœ‰å¦‚ä½•éå†ä¸€æ£µäºŒå‰æ ‘","link":"/2014/07/04/java%E5%AE%9E%E7%8E%B0%E4%BA%8C%E5%8F%89%E6%A0%91/"},{"title":"åˆ©ç”¨javaå®ç°ä¸€ä¸ªç®€å•çš„é“¾è¡¨ç»“æ„","text":"å®šä¹‰æ‰€è°“é“¾è¡¨å°±æ˜¯æŒ‡åœ¨æŸèŠ‚ç‚¹å­˜å‚¨æ•°æ®çš„è¿‡ç¨‹ä¸­è¿˜è¦æœ‰ä¸€ä¸ªå±æ€§ç”¨æ¥æŒ‡å‘ä¸‹ä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹ï¼Œè¿™æ ·çš„æ•°æ®å­˜å‚¨æ–¹å¼å«åšé“¾è¡¨ é“¾è¡¨çš„ä¼˜ç¼ºç‚¹ä¼˜ç‚¹ï¼šæ˜“äºå­˜å‚¨å’Œåˆ é™¤ ç¼ºç‚¹ï¼šæŸ¥è¯¢èµ·æ¥è¾ƒéº»çƒ¦ javaå®ç°ä¸‹é¢æˆ‘ä»¬ç”¨javaæ¥å®ç°å¦‚ä¸‹é“¾è¡¨ç»“æ„ï¼š é¦–å…ˆå®šä¹‰èŠ‚ç‚¹ç±»ï¼š 123456789101112131415161718192021222324252627282930package LinkTest;/** * é“¾è¡¨èŠ‚ç‚¹ç±» * @author admin * */public class Node { private int value;//å­˜å‚¨æ•°æ® private Node next;//ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ /** * å®šä¹‰æ„é€ å™¨ * @param vlaue * @param value */ public Node(int value){ this.value=value; } public int getValue() { return value; } public void setValue(int value) { this.value = value; } public Node getNext() { return next; } public void setNext(Node next) { this.next = next; }} ä»£ç å—1 ç„¶åå®šä¹‰ä¸€ä¸ªé“¾è¡¨ç±»ï¼š æ³¨æ„ï¼šéå†é“¾è¡¨å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯æ™®é€šæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯é€’å½’æ–¹æ³•ï¼Œéƒ½å¯ä»¥éå†å‡ºæ¥ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546package LinkTest;/** * é“¾è¡¨ * @author admin * */public class Link { private Node current; private Node root; public void insert(int vlaue){ Node newNode=new Node(vlaue); if(this.current==null){ this.current=newNode; this.root=this.current; }else{ this.current.setNext(newNode); this.current=this.current.getNext(); } } //æ™®é€šéå† public void getList(){ this.current=this.root; while(this.current!=null){ System.out.print(this.current.getValue()); this.current=this.current.getNext(); if(this.current!=null){ System.out.print(\"-------&gt;\"); } } } //é€’å½’éå† public void getList2(){ DG(this.root); } //é€’å½’æ–¹æ³• public void DG(Node node){ System.out.print(node.getValue()+\"-----&gt;\"); if(node.getNext()!=null){ DG(node.getNext()); }else{ return; } }} ä»£ç å—2 æµ‹è¯•ç±»ï¼š 123456789101112131415161718package LinkTest;/** * æµ‹è¯•ç±» * @author admin * */public class Test { public static void main(String[] args){ Link l=new Link(); l.insert(1); l.insert(4); l.insert(5); l.insert(6); l.insert(9); l.insert(8); l.getList(); }} ä»£ç å—3 æµ‹è¯•ç±»è¿è¡Œç»“æœï¼š 11-------&gt;4-------&gt;5-------&gt;6-------&gt;9-------&gt;8 è¿™æ ·æˆ‘ä»¬å°±ç”¨javaå®ç°äº†ä¸€ä¸ªç®€å•çš„é“¾è¡¨ç»“æ„ã€‚","link":"/2014/07/04/%E5%88%A9%E7%94%A8java%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E9%93%BE%E8%A1%A8%E7%BB%93%E6%9E%84/"},{"title":"æµæºæ¸¸è®°-20200517","text":"â± æ—…è¡Œæ—¶é—´çº¿ï¼š2020-05-15 ~ 2020-05-17 ğŸŒ åœ°ç‚¹ï¼šæ²³å—çœ Â· æµæºå¸‚ ğŸŒ¿ æ™¯ç‚¹ï¼šé»„æ²³ä¸‰å³¡ã€ç‹å±‹å±± âšœï¸ çº§åˆ«ï¼šAAAA å‡ºå‘ï¼ˆ2020.05.15ï¼‰ ç•™å®¿ï¼ˆ2020.05.15ï¼‰ é»„æ²³ä¸‰å³¡ç…§ç‰‡å¢™ï¼ˆ2020.05.16ï¼‰ è€è¡—ç…§ç‰‡å¢™ï¼ˆ2020.05.16ï¼‰ ç‹å±‹å±±ç…§ç‰‡å¢™ï¼ˆ2020.05.17ï¼‰","link":"/2020/06/08/%E6%B5%8E%E6%BA%90%E6%B8%B8%E8%AE%B0/"},{"title":"JVMåŸºç¡€å›é¡¾è®°å½•ï¼ˆå››ï¼‰ï¼šç±»æ–‡ä»¶","text":"ä¸€ã€JAVAçš„å¹³å°æ— å…³æ€§æˆ‘ä»¬æœ€å¼€å§‹å­¦ä¹ javaçš„æ—¶å€™äº†è§£åˆ°javaä»£ç æ–‡ä»¶å¿…é¡»ç»è¿‡javacçš„ç¼–è¯‘ï¼Œç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶æ‰å¯ä»¥è¢«JVMè¯†åˆ«å¹¶è¿è¡Œï¼Œè€ŒJVMåˆ™æ‹¥æœ‰å¤šç§æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬ï¼š æ­£æ˜¯å› ä¸ºè¿™äº›ä¸åŒæ“ä½œç³»ç»Ÿä¸‹çš„JVMç‰ˆæœ¬ï¼Œä½¿å¾—æˆ‘ä»¬è¢«ç¼–è¯‘åçš„å­—èŠ‚ç æ–‡ä»¶å¯ä»¥è¢«ä¸åŒæ“ä½œç³»ç»Ÿä¸Šçš„JVMè¯†åˆ«å¹¶è¿è¡Œï¼Œç»§è€Œå®ç°è·¨å¹³å°ã€‚ äºŒã€å­—èŠ‚ç æ–‡ä»¶ç»„æˆå­—èŠ‚ç æ–‡ä»¶æ˜¯ç»è¿‡ç¼–è¯‘å™¨ç¼–è¯‘åçš„classæ–‡ä»¶ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç§°ä¸ºClassç±»æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å†…çš„å†…å®¹ä½ æ˜¯çœ‹ä¸æ‡‚çš„ï¼Œå®ƒæ˜¯ä»¥æŸç§é¡ºåºå †å çš„äºŒè¿›åˆ¶æµç»„æˆçš„æ–‡ä»¶ï¼Œä»¥å­—èŠ‚ï¼ˆbyteï¼‰ä¸ºåŸºæœ¬å•ä½ï¼Œæˆ‘ä»¬å­¦ä¹ javaåŸºç¡€æ—¶çŸ¥é“ï¼Œå•å­—èŠ‚å æœ‰8ä¸ªbitä½ï¼Œè™½ç„¶ä½ å¾ˆéš¾çœ‹æ‡‚ï¼Œä½†å¯¹äºJVMæ¥è¯´å´å¯ä»¥å¾ˆå®¹æ˜“çš„è§£æè¿™ç±»æ–‡ä»¶ï¼Œè¿™é‡Œå…ˆä¸è°ˆå®ƒå¦‚ä½•è§£æï¼Œæˆ‘ä»¬æœ¬æ¬¡åªè¯´æ˜è¿™ä¸ªæ–‡ä»¶é‡Œéƒ½æ”¾äº†äº›ä»€ä¹ˆä¸œè¥¿ï¼Œæ¥ä¸‹æ¥ä¼šç»“åˆå®ä¾‹æ¥è¯¦ç»†è¯´æ˜ã€‚ ä¸Šé¢åˆšè¯´è¿‡ï¼Œæ–‡ä»¶å†…éƒ¨çš„åŸºæœ¬å•ä½æ˜¯å­—èŠ‚ï¼ˆ8bitï¼‰ï¼Œåˆ©ç”¨è¿™äº›å­—èŠ‚æ•°æ®æ‰€å¤„çš„å…ˆåé¡ºåºï¼Œæ¥å†³å®šClassæ–‡ä»¶é‡Œä¸åŒçš„æ•°æ®é¡¹ï¼ŒJVMåœ¨åšå­—èŠ‚ç åŠ è½½åˆ†æçš„æ—¶å€™ä¹Ÿæ˜¯æŒ‰ç…§è¿™ä¸ªé¡ºåºæ¥è¿›è¡Œçš„ï¼Œè¿™å°±åƒæ˜¯ä¸€ç§åºåˆ—åŒ–çš„æ–¹å¼ï¼Œè€ŒJVMåŠ è½½è§£æå®ƒçš„æ—¶å€™ï¼Œç›¸å½“äºåœ¨åšååºåˆ—åŒ–ï¼Œè¿™ä¸ªåœ¨æœ¬èŠ‚ä¸åšæ¢è®¨ï¼Œç•™åˆ°ç±»åŠ è½½ç« èŠ‚ä¼šè¯¦ç»†è¯´æ˜ã€‚ å­—èŠ‚ç æ–‡ä»¶é‡Œå­˜å‚¨çš„æ•°æ®ç±»å‹åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œä¸€ç§æ˜¯åŸºæœ¬çš„æ— ç¬¦å·æ•°å­—ç±»å‹ï¼Œå¦å¤–ä¸€ç§åˆ™æ˜¯ç±»ä¼¼Cè¯­è¨€ä¸­ç»“æ„ä½“çš„ä¸€ç§ä¸œè¥¿ï¼Œæˆ‘ä»¬ç®¡å®ƒå«è¡¨ï¼Œè¡¨å¯èƒ½åŒ…å«æ— ç¬¦å·æ•°å­—ï¼Œä¹Ÿå¯èƒ½åŒ…å«å¦å¤–ä¸€ä¸ªè¡¨ï¼Œä¹Ÿå¯èƒ½ç”±æ— ç¬¦å·æ•°å­—å’Œå…¶ä»–è¡¨å…±åŒç»„æˆï¼ˆå…¶å®ä¹Ÿå¾ˆåƒjavaé‡Œçš„ç±»å¯¹å§ï¼Ÿå¯èƒ½åªåŒ…å«åŸºæœ¬ç±»å‹çš„å±æ€§ï¼Œä¹Ÿå¯èƒ½åŒ…å«å¦å¤–ä¸€ä¸ªç±»çš„å¯¹è±¡å±æ€§ï¼Œè™½ç„¶å®ƒè·Ÿç±»å®Œå…¨ä¸æ˜¯ä¸€å›äº‹ï¼Œä½†ä¸ºäº†ä¾¿äºç†è§£ï¼Œå¯ä»¥è¿™æ ·æƒ³ï¼‰ ç”±äºå­—èŠ‚ç æ–‡ä»¶çš„â€œååºåˆ—åŒ–â€è¿‡ç¨‹éå¸¸çš„å•çº¯ï¼Œå°±æ˜¯ä»å‰å¾€åè¯»ï¼Œé‚£ä¹ˆClassæ–‡ä»¶ä¸­çš„æ— ç¬¦å·æ•°å’Œè¡¨çš„å †å é¡ºåºå°±æ˜¾å¾—éå¸¸é‡è¦ï¼Œè¿™å…¶å®æ˜¯ä¸€ç§javaè™šæ‹Ÿæœºçº¦å®šå¥½çš„åè®®ï¼Œæ¯”å¦‚Classæ–‡ä»¶è¯»è¿›æ¥çš„äºŒè¿›åˆ¶æµï¼Œå‰4ä¸ªå­—èŠ‚ä¸€å®šæ˜¯æŸä¸ªå…·ä½“çš„å­—æ®µï¼Œç´§æ¥ç€å¾€å2ä¸ªå­—èŠ‚ä¸€å®šæ˜¯å¦å¤–ä¸€ä¸ªå­—æ®µï¼Œå°±è¿™æ ·ï¼Œè¿™ä¸ªäºŒè¿›åˆ¶å­—èŠ‚æµè¢«åè®®åˆ‡åˆ†æˆäº†å…·ä½“çš„ç»„ï¼Œæ¯ä¸€ä¸ªç»„éƒ½ä»£è¡¨ç€ä¸åŒå«ä¹‰çš„å­—æ®µã€‚ ä¸‰ã€å‰ä¸‰ä¸ªå­—èŠ‚ç»„ï¼šé­”æ•°ã€æ¬¡ç‰ˆæœ¬å·ã€ä¸»ç‰ˆæœ¬å·é€šè¿‡ç¬¬äºŒèŠ‚çš„äº†è§£ï¼Œæˆ‘ä»¬çŸ¥é“äº†Classæ–‡ä»¶å°±æ˜¯å­—èŠ‚ä¸å­—èŠ‚çš„é¡ºåºå †å æ’åˆ—ï¼Œç„¶åæŒ‰ç…§å­—èŠ‚ç çº¦å®šåè®®è¿›è¡Œä»¥å­—èŠ‚ä¸ºå•ä½åˆ†ç»„ï¼Œæ¯ä¸€ç»„çš„æ•°æ®ä»£è¡¨ç€ä¸åŒçš„å«ä¹‰ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹ä¸‹å­—èŠ‚ç æ–‡ä»¶çš„å¤´éƒ¨ä¸‰ä¸ªç»„éƒ½åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆå§ï¼š ä¸Šå›¾å±•ç¤ºçš„å°±æ˜¯Classæ–‡ä»¶å¼€å¤´å‡ ä¸ªå­—èŠ‚è¢«çº¦å®šåˆ†ç»„çš„æƒ…å†µï¼Œå…¶å®åé¢æ›´å¤æ‚çš„è¡¨ä¹Ÿæ˜¯æŒ‰ç…§ç±»ä¼¼çš„æ–¹å¼åšçš„ã€‚ æ— ç¬¦å·æ•°æŒ‰ç…§ä¸åŒæ•°é‡çš„å­—èŠ‚åˆ†ç»„ï¼Œå½¢æˆäº†ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œéœ€è¦å ç”¨4ä¸ªå­—èŠ‚æ‰èƒ½å­˜ä¸‹çš„å­—æ®µçš„ç±»å‹è¢«ç§°ä¸ºu4ï¼Œè€Œåªéœ€è¦å ç”¨2ä¸ªå­—èŠ‚çš„å­—æ®µç±»å‹è¢«ç§°ä¸ºu2ï¼Œå›¾2ä¸­â€œé­”æ•°â€å°±å¯ä»¥è¢«è¯´æˆæ˜¯ä¸€ä¸ªu4ç±»å‹çš„æ•°å­—ï¼Œè€Œæ¬¡ç‰ˆæœ¬å·å’Œä¸»ç‰ˆæœ¬å·åˆ™ä¸ºu2ã€‚ é­”æ•°ï¼ˆmagicï¼‰ï¼šç¡®å®šå½“å‰æ–‡ä»¶æ˜¯å¦æ˜¯ä¸€ä¸ªå¯ä»¥è¢«jvmåŠ è½½çš„Classæ–‡ä»¶ï¼ˆåƒmp3ã€pdfç­‰æ–‡ä»¶ï¼Œå¼€å¤´ä¸€æ ·ä¹Ÿä¼šæœ‰ç±»ä¼¼çš„é­”æ•°ï¼‰ ä¸»ç‰ˆæœ¬å·ï¼ˆmajor_versionï¼‰&amp;æ¬¡ç‰ˆæœ¬å·ï¼ˆminor_versionï¼‰ï¼šç”¨æ¥è®°å½•å½“å‰Classæ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼Œæ¯ä¸ªç‰ˆæœ¬çš„jdkç¼–è¯‘è¿‡çš„Classæ–‡ä»¶ï¼Œä¼šä¿æœ‰å…¶ç‰ˆæœ¬å·ä¿¡æ¯ï¼Œå­¦ä¹ javaåŸºç¡€çš„æ—¶å€™éƒ½äº†è§£è¿‡ï¼Œjavaæ˜¯è‡ªä¸Šå‘ä¸‹å…¼å®¹çš„ï¼Œæ¯”å¦‚jdk1.8ç¼–è¯‘å‡ºæ¥çš„Classæ–‡ä»¶ä¸å¯ä»¥è¢«1.7ç‰ˆæœ¬çš„è™šæ‹ŸæœºåŠ è½½è¿è¡Œï¼Œä½†jdk1.7ç¼–è¯‘å‡ºæ¥çš„Classæ–‡ä»¶å´å¯ä»¥è¢«1.8ç‰ˆæœ¬çš„è™šæ‹ŸæœºåŠ è½½è¿è¡Œï¼Œè‡³äºèƒ½ä¸èƒ½è¢«åŠ è½½çš„ç¬¬ä¸€é“åï¼Œå°±æ˜¯æŒ‰ç…§è¿™ä¿©ç‰ˆæœ¬å·è¿›è¡Œåˆ¤æ–­çš„ã€‚ å››ã€å¸¸é‡æ± å›¾2é‡Œæˆ‘ä»¬è‡³å°‘å·²ç»çŸ¥é“äº†é­”æ•°ã€æ¬¡ç‰ˆæœ¬å·ã€ä¸»ç‰ˆæœ¬å·è¿™ä¸‰ä¸ªå­—æ®µï¼Œå¾€åçš„åˆ™è¢«çœç•¥äº†ã€‚å¾€åæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®ƒæ˜¯éå¸¸å¤æ‚ä¸”åºå¤§çš„ä¸€ä¸ªåˆ†ç»„é›†åˆï¼Œè¢«ç§°ä¸ºå¸¸é‡æ± ï¼ˆæ³¨æ„ï¼Œè¿™ä¸ªå¸¸é‡æ± æ˜¯æŒ‡Classæ–‡ä»¶å†…çš„å¸¸é‡æ± ï¼Œä»–ä»¬ä¼šè¢«Classæ–‡ä»¶å†…ä¸€äº›ç´¢å¼•é¡¹ç»™ç´¢å¼•åˆ°ï¼Œä¸æ˜¯è¿è¡ŒæœŸçš„é‚£ä¸ªJVMå¸¸é‡æ± ï¼‰å®ƒä»¬ä½äºä¸»ç‰ˆæœ¬å·åé¢ï¼Œç¬¬ä¸€é¡¹æ˜¯ä¸€ä¸ªu2ç±»å‹çš„æ•°å­—ï¼Œè¡¨ç¤ºæœ‰å‡ ä¸ªå¸¸é‡è¡¨å¦‚å›¾ï¼š 4.1ï¼šæ± é‡Œå¸¸é‡çš„åˆ†ç±»å¸¸é‡æ± é‡Œçš„å¸¸é‡æŒ‰ç…§ç±»å‹è¢«åˆ†ä¸ºäº†ä¸¤å¤§ç±»ï¼šå­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œè€Œç¬¦å·å¼•ç”¨åˆå¾€ä¸‹ç»†åˆ†äº†å‡ ä¸ªåˆ†ç±»ï¼Œå¦‚å›¾ï¼š 4.1.1ï¼šå­—é¢é‡å¾ˆç®€å•çš„æ¦‚å¿µï¼Œç±»ä¼¼äºå¸¸é‡ï¼Œä¸‹é¢çš„åˆ†èŠ‚å°†ä¼šè¯¦ç»†ä»‹ç»ï¼Œä¸»è¦æ˜¯ç±»ä¼¼è¯­è¨€å±‚é¢çš„åŸºæœ¬ç±»å‹ï¼Œæ¯”å¦‚intã€floatã€doubleè¿™äº›ï¼Œéƒ½æœ‰å¯¹åº”çš„å­—é¢é‡å¸¸é‡è¡¨ï¼šCONSTANT_Integer_infoã€CONSTANT_Float_infoã€CONSTANT_Double_info 4.1.2ï¼šç¬¦å·å¼•ç”¨ç¬¦å·å¼•ç”¨éƒ½æ˜¯ä»¥å­—ç¬¦ä¸²çš„æ–¹å¼å­˜å‚¨åœ¨å¸¸é‡æ± é‡Œçš„ï¼Œå®ƒä»¬é€šå¸¸ç”¨æ¥æè¿°ç±»çš„å…¨é™å®šåã€æ–¹æ³•å’Œå­—æ®µçš„åç§°ä»¥åŠæè¿°ç¬¦ï¼Œå› æ­¤è¢«åˆ†äº†ä¸‰ç±». ç±»å’Œæ¥å£çš„å…¨é™å®šåç¬¬ä¸€ç±»å«å…¨é™å®šåï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªç±»å«ï¼šcom.bilibili.test.Testï¼Œåˆ™å®ƒçš„å…¨é™å®šåä¸ºï¼šcom/bilibili/test/Test å­—æ®µã€æ–¹æ³•çš„ç®€å•åç§°å’Œæè¿°ç¬¦ç›¸å¯¹æ¥è¯´ï¼Œå­—æ®µå’Œæ–¹æ³•çš„æè¿°ç¬¦æ›´ä¸ºå¤æ‚ï¼Œæˆ‘ä»¬å¾—é€šè¿‡å®é™…çš„ä¾‹å­æ¥è¯´æ˜é—®é¢˜ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªç±»é‡Œé¢æœ‰å­—æ®µä»¥åŠæ–¹æ³•ï¼Œå­—æ®µæœ‰å®ƒè‡ªå·±å£°æ˜çš„ç±»å‹ä»¥åŠåç§°ï¼Œè€Œæ–¹æ³•åˆ™æ›´åŠ å¤æ‚ï¼Œå®ƒå­˜åœ¨å…¥å‚ã€è¿”å›ã€åç§°ï¼Œå› æ­¤è¦æƒ³ç”¨æè¿°ç¬¦è¿™æ ·çš„å­—ç¬¦ä¸²æ¥æè¿°ä¸€ä¸ªå­—æ®µæˆ–è€…ä¸€ä¸ªæ–¹æ³•ï¼Œå¾€å¾€éœ€è¦ä¸€å®šçš„æ ¼å¼ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å…¶æ ¼å¼å§ã€‚ å…ˆè¯´å­—æ®µï¼Œå‡å¦‚æˆ‘çš„ç±»é‡Œæœ‰ä¸ªå­—æ®µæ˜¯intå‹ï¼Œåç§°ä¸ºnumï¼Œåç§°æ²¡ä»€ä¹ˆå¥½è¯´çš„å°±æ˜¯numï¼Œä½†å®ƒçš„ç±»å‹æè¿°ç¬¦å´æ˜¯ï¼šI ä¸ºä»€ä¹ˆintå‹çš„æ•°æ®çš„ç±»å‹æè¿°ç¬¦æ˜¯Iï¼Ÿé‚£doubleå‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬å°±åˆ—å‡ºæ‰€æœ‰ç±»å‹å¯¹åº”çš„æè¿°ç¬¦çš„æ˜ å°„å…³ç³»è¡¨ï¼Œåé¢æ›´å¤æ‚çš„æ–¹æ³•æè¿°ç¬¦ä¹Ÿå¯ä»¥ç”¨åˆ°è¿™ä¸ªè¡¨ï¼š ç±»å‹ æè¿°ç¬¦ byte B char C double D float F int I long J short S boolean Z referenceï¼ˆå¼•ç”¨ç±»å‹ï¼‰ Lï¼Œæ ¼å¼ä¸ºLç±»å‹å…¨é™å®šå;ï¼Œä¾‹å¦‚Objectç±»å‹çš„å¼•ç”¨å˜é‡å¯è¡¨ç¤ºä¸ºï¼šLjava/lang/Object; arrayï¼ˆæ•°ç»„ï¼‰ [ï¼Œæ ¼å¼ä¸ºï¼š[ç±»å‹æè¿°ç¬¦ï¼Œæ¯”å¦‚int[]å¯ä»¥è¡¨ç¤ºä¸º[Iï¼Œå†æ¯”å¦‚Object[]å¯ä»¥è¡¨ç¤ºä¸º[Ljava/lang/Object;ï¼Œé«˜ç»´æ•°ç»„ï¼Œåªéœ€è¦å¤šåŠ ä¸€ä¸ª[å³å¯ï¼Œæ¯”å¦‚int[][]å¯ä»¥è¡¨ç¤ºä¸º[[I voidï¼ˆæ–¹æ³•æè¿°ç¬¦ç‹¬æœ‰ï¼Œç”¨äºå½¢å®¹æ–¹æ³•çš„æ— å‚æ•°è¿”å›ç±»å‹ï¼‰ V è¡¨1 okï¼Œäº†è§£å®Œå„ç§ç±»å‹çš„æè¿°ç¬¦è§„åˆ™ï¼Œå†æ¥ä¸€éå¼€å§‹é‚£ä¸ªå­—æ®µæè¿°ç¬¦ä¸ºIå°±å¯ä»¥å¾ˆå®¹æ˜“ç†è§£äº†ï¼Œä¸‹é¢æ¥ç»§ç»­äº†è§£ä¸‹æ–¹æ³•çš„æè¿°ç¬¦ï¼Œè¿™ä¸ªå°±æ›´ä¸ºå¤æ‚ï¼Œå…¶æ ¼å¼ä¸ºï¼š 1(å‚æ•°1ç±»å‹æè¿°ç¬¦ å‚æ•°2ç±»å‹æè¿°ç¬¦...)è¿”å›å€¼ç±»å‹æè¿°ç¬¦ ä¸‹é¢é€šè¿‡å‡ ä¸ªä¾‹å­æ¥è¯´æ˜æ–¹æ³•æè¿°ç¬¦ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©ä½ ç†è§£ï¼š æ–¹æ³•å®šä¹‰ æè¿°ç¬¦ int getId() ()I double getPrice(Object[] o, double price) ([Ljava/lang/Object;D)D void setId() ()V void setId(int id) (I)V è¡¨2 é‚£ä¹ˆå­—æ®µæˆ–æ–¹æ³•çš„åç§°åŠæè¿°ç¬¦å­˜åœ¨å“ªä¸ªåœ°æ–¹å‘¢ï¼Ÿæ¥ä¸‹æ¥è¦ä»‹ç»çš„ä¸€ä¸ªå«åšCONSTANT_NameAndType_infoçš„å¸¸é‡è¡¨å°±æ˜¯ä¸“é—¨å­˜æ”¾è¿™ä¿©æ•°æ®çš„ï¼Œå®ƒçš„å†…éƒ¨ç»“æ„è¯·å‚è€ƒ``é‡Œå¯¹å®ƒçš„ä»‹ç»ã€‚ å¸¸é‡æ± é‡Œçš„æ¯ä¸€é¡¹éƒ½æ˜¯ä¸ªè¡¨ï¼Œä¸‹é¢ï¼Œæˆ‘ä»¬æ¥æ·±å±‚æ¬¡æ¢è®¨ä¸‹å¸¸é‡æ± é‡Œçš„æ¯ä¸€ä¸ªè¡¨çš„ç»“æ„~ 4.2ï¼šCONSTANT_Utf8_infoï¼ˆUTF-8ç¼–ç çš„å­—ç¬¦ä¸²ï¼‰è¿™ä¸ªè¡¨çš„è¯¦ç»†ç»“æ„å¦‚ä¸‹ï¼š å³ä¾¿æ˜¯è¡¨ï¼Œä¹Ÿæ˜¯æŒ‰ç…§ç±»ä¼¼çš„æ–¹å¼å †å çš„ï¼Œåç»­å‡ ç§ç±»å‹ä¹Ÿæ˜¯ç±»ä¼¼ã€‚ åŸºæœ¬ä¸Šå¸¸é‡æ± é‡Œçš„è¡¨ç¬¬ä¸€ä¸ªå­—èŠ‚éƒ½æ˜¯tagï¼Œtagåœ¨å›¾4ä¸­å·²ç»è§£é‡Šè¿‡äº†ï¼Œå®ƒç”¨æ¥åŒºåˆ†å½“å‰è¡¨å±äºä»€ä¹ˆç±»å‹çš„è¡¨ï¼Œæ¯”å¦‚æœ¬èŠ‚é‡Œtag=1ï¼Œè§„èŒƒé‡Œtagä¸º1çš„è¡¨å°±æ˜¯CONSTANT_Utf8_infoï¼Œå½“è™šæ‹ŸæœºçŸ¥é“äº†è¡¨ä¸ºCONSTANT_Utf8_infoï¼Œé‚£ä¹ˆå¾ˆè‡ªç„¶çš„åé¢ä¸¤ä¸ªå­—èŠ‚è‚¯å®šæ˜¯lengthï¼Œè‡³äºå…¶å†…å®¹ï¼Œè‚¯å®šå°±æ˜¯lengthåé¢çš„å­—èŠ‚äº†ï¼Œç„¶åæˆªå–lengthé•¿åº¦çš„å­—èŠ‚ï¼Œå°±æ˜¯è¿™ä¸ªCONSTANT_Utf8_infoæ‰€å­˜æ”¾çš„å®é™…å†…å®¹ã€‚ 4.3ï¼šCONSTANT_Integer_infoï¼ˆæ•´å‹å­—é¢é‡ï¼‰ç›´æ¥ä¸Šå›¾ï¼š å­¦è¿‡javaçš„äººéƒ½çŸ¥é“intå‹æ•°æ®å 4å­—èŠ‚ï¼Œ32ä½ï¼Œç°åœ¨é€šè¿‡ä¸Šå›¾å­—èŠ‚ç çš„åˆ†é…å¯ä»¥è¯å®ï¼Œä¸‹é¢çš„å­—é¢é‡ä¹Ÿå¤§ä½“ç›¸åŒã€‚ 4.4ï¼šCONSTANT_Float_infoï¼ˆæµ®ç‚¹å‹å­—é¢é‡ï¼‰ 4.5ï¼šCONSTANT_Long_infoï¼ˆé•¿æ•´å‹å­—é¢é‡ï¼‰ 4.6ï¼šCONSTANT_Double_infoï¼ˆåŒç²¾æµ®ç‚¹å‹å­—é¢é‡ï¼‰ åˆ°è¿™é‡Œï¼ŒåŸºæœ¬ç±»å‹å°±ä»‹ç»å®Œäº†ï¼Œé€šè¿‡å¯¹2.3.2 ~ 2.3.5çš„äº†è§£ï¼Œå¯ä»¥å‘ç°ï¼ŒåŸºæœ¬ç±»å‹æ˜¯å¾ˆç®€å•çš„ç±»å‹ï¼Œè€Œä¸”å…¶å®é™…å†…å®¹ç¬¦åˆjavaé‡ŒåŸºæœ¬ç±»å‹æ‰€å ä½æ•°ã€‚ 4.7ï¼šCONSTANT_Class_infoï¼ˆç±»ã€æ¥å£çš„ç¬¦å·å¼•ç”¨ï¼‰ è¿™é‡Œè¦è¯¦ç»†ä»‹ç»ä¸‹indexè¿™ä¸ªå±æ€§ï¼Œå› ä¸ºåœ¨åé¢çš„è¡¨ä¸­ï¼Œè¿™ä¸ªå­—æ®µå‡ºç°çš„é¢‘ç‡ä¼šéå¸¸é«˜ã€‚ è¿™ä¸ªå­—æ®µä»£è¡¨äº†ä¸€ä¸ªå†…å®¹çš„ç´¢å¼•ï¼Œå®ƒç´¢çš„è°çš„å¼•å‘¢ï¼Ÿç­”æ¡ˆè¿˜æ˜¯å¸¸é‡æ± ï¼Œä¸¾ä¸ªä¾‹å­å§ï¼ŒClass_infoæ˜¯ä¸€ä¸ªç”¨æ¥æè¿°ç±»æˆ–è€…æ¥å£å…¨é™å®šåçš„è¡¨ï¼Œæ—¢ç„¶æ˜¯å…¨é™å®šåï¼Œé‚£è‚¯å®šæ˜¯ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆindexæŒ‡å‘çš„è‚¯å®šæ˜¯å¸¸é‡æ± é‡Œä¸€å¼ CONSTANT_Utf8_infoçš„è¡¨ï¼Œç°åœ¨è®©æˆ‘ä»¬å‡è®¾ä¸€ä¸ªå¸¸é‡æ± ï¼Œé‡Œé¢å·²ç»æ’åˆ—å¥½äº†å„ç§è¡¨æ•°æ®ï¼ŒæŒ‰ç…§å¸¸é‡æ± ç´¢å¼•å€¼ä»1å¼€å§‹ï¼Œå› æ­¤æŒ‰ç…§è§„åˆ™ï¼Œç»˜åˆ¶å‡ºä¸‹å›¾ï¼š å½“Class_infoçš„indexå±æ€§å°±æ˜¯ç”¨æ¥æŒ‡å‘å¸¸é‡æ± ä¸­æŸä¸€ä¸ªè¡¨çš„ï¼Œä¾‹å¦‚ä¸Šå›¾é‡Œindex=2ï¼Œåˆ™æ„å‘³ç€å¸¸é‡æ± é‡Œç´¢å¼•ä¸‹æ ‡ä¸º2çš„è¡¨çš„å†…å®¹ï¼Œå°±æ˜¯Class_infoçš„å†…å®¹ï¼Œå¼€å¤´è¯´è¿‡ï¼Œå°±æ˜¯ç±»æˆ–æ¥å£çš„å…¨é™å®šåã€‚ 4.8ï¼šCONSTANT_String_infoï¼ˆå­—ç¬¦ä¸²ç±»å‹å­—é¢é‡ï¼‰ 4.9ï¼šCONSTANT_NameAndType_infoï¼ˆå­—æ®µã€æ–¹æ³•çš„éƒ¨åˆ†ç¬¦å·å¼•ç”¨ï¼‰ä¹‹å‰ä»‹ç»äº†å¸¸é‡æ± é‡Œå­˜æ”¾çš„å­—æ®µã€æ–¹æ³•éƒ½æ˜¯å­˜åœ¨åç§°ä»¥åŠæè¿°ç¬¦çš„ï¼Œæœ¬èŠ‚ä»‹ç»çš„è¿™ä¸ªç»“æ„å°±æ˜¯ç”¨æ¥å­˜æ”¾è¿™ä¸¤é¡¹å†…å®¹çš„ï¼ˆå¯¹å­—æ®µæˆ–æ–¹æ³•çš„åç§°åŠæè¿°ç¬¦ä¸ç†Ÿæ‚‰çš„è¯ï¼Œå»ºè®®åŠ å¼ºç†è§£ä¸‹å›¾4ã€è¡¨1ã€è¡¨2é‡Œçš„å†…å®¹ï¼‰ è¯¥ç»“æ„å­˜å‚¨äº†æŸä¸ªå­—æ®µæˆ–æ–¹æ³•çš„åç§°ç´¢å¼•å’Œæè¿°ç¬¦ç´¢å¼•ï¼Œé‚£è‚¯å®šæœ‰å…·ä½“çš„æŸä¸ªå­—æ®µæˆ–æ–¹æ³•çš„è¡¨é‡Œä¼šç´¢å¼•å‘å®ƒï¼Œæ¥ä¸‹æ¥è¦ä»‹ç»çš„CONSTANT_Fieldref_infoå’ŒCONSTANT_Methodref_infoï¼Œå‡æœ‰æŒ‡å‘å®ƒçš„ç´¢å¼•å­—æ®µã€‚ 4.10ï¼šCONSTANT_Fieldref_infoï¼ˆç±»ä¸­å¼•ç”¨å­—æ®µçš„ç¬¦å·å¼•ç”¨ï¼‰è¿™ä¸ªå¸¸é‡ä¸“é—¨ç”¨æ¥æè¿°ç±»å†…è¢«å¼•ç”¨åˆ°çš„å±æ€§ï¼ŒåŒ…å«ä½ è‡ªå®šä¹‰çš„å‡ºç°åœ¨è¯¥ç±»çš„å±æ€§ï¼Œä¹ŸåŒ…å«è¯¥ç±»é‡Œæ–¹æ³•è°ƒç”¨æ—¶ä½¿ç”¨çš„åˆ«çš„ç±»çš„å±æ€§ã€‚ å­—æ®µçš„ç¬¦å·å¼•ç”¨è¡¨ï¼Œé™¤äº†è¦æè¿°å£°æ˜è‡ªå·±çš„ç±»æˆ–æ¥å£ï¼Œè¿˜éœ€è¦ç´¢å¼•åˆ°å…·ä½“çš„CONSTANT_NameAndType_infoï¼Œè¿™ä¸ªè¡¨é‡Œä¸Šé¢ä»‹ç»è¿‡ï¼Œå†…å«ä¸€ä¸ªåç§°å’Œå…·ä½“çš„æè¿°ç¬¦ï¼Œä¸‹æ–¹çš„æ–¹æ³•ç¬¦å·å¼•ç”¨ä¹Ÿæ˜¯åŒæ ·çš„ç»“æ„ï¼Œå³ä¸€ä¸ªå­—æ®µæˆ–æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ç­‰äºï¼šå£°æ˜è¯¥å­—æ®µæˆ–æ–¹æ³•çš„ç±»æˆ–æ¥å£çš„å…¨é™å®šå + è¯¥å­—æ®µæˆ–æ–¹æ³•çš„åç§° + è¯¥å­—æ®µæˆ–æ–¹æ³•çš„æè¿°ç¬¦ 4.11ï¼šCONSTANT_Methodref_infoï¼ˆç±»ä¸­å¼•ç”¨æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ï¼‰è¿™ä¸ªå¸¸é‡ä¸“é—¨ç”¨æ¥æè¿°ç±»å†…è¢«å¼•ç”¨åˆ°çš„æ–¹æ³•ï¼Œæ¯”å¦‚ä½ åœ¨Aç±»é‡Œå®šä¹‰äº†ä¸€ä¸ªå«test()çš„æ–¹æ³•ï¼Œè¿™ä¸ªtestæ–¹æ³•å¹¶ä¸ä¼šåœ¨å¸¸é‡æ± å­˜åœ¨ä¸€ä¸ªCONSTANT_Methodref_infoï¼Œå¦‚æœä½ å†å®šä¹‰ä¸€ä¸ªæ–¹æ³•test2()ï¼Œè®©å®ƒè°ƒç”¨testæ–¹æ³•ï¼Œè¿™æ—¶testæ–¹æ³•ç›¸å½“äºè¢«å¼•ç”¨ï¼Œè¿™æ—¶å°±æ‹¥æœ‰äº†å¯¹åº”çš„Methodref_info. å†æ¯”å¦‚ï¼Œä½ æ–¹æ³•é‡Œç»å¸¸ä¼šè°ƒç”¨ä¸€äº›ä¾èµ–åŒ…çš„ç±»æ–¹æ³•ï¼Œæ¯”å¦‚æœ€å¸¸ç”¨çš„System.out.printlnï¼Œè¿™ä¸ªè¿‡ç¨‹ç›¸å½“äºä½ ä½¿ç”¨äº†outå¯¹è±¡çš„printlnæ–¹æ³•ï¼Œæ­¤æ—¶å½“å‰ç±»çš„å­—èŠ‚ç å¸¸é‡æ± ä¾¿ä¼šæœ‰ä¸€ä¸ªprintlnçš„Methodref_infoå‡ºç°ï¼ŒåŒæ—¶ä¹Ÿä¼šæœ‰ä¸€ä¸ªå«outçš„Fieldref_infoå‡ºç°ã€‚ï¼ˆè¿™äº›å‡ä¼šåœ¨å®æˆ˜ç¯‡è®²è§£ï¼‰ çº é”™ï¼Œå›¾é‡Œç¬¬ä¸€ä¸ªinfoå—é‡Œçš„å†…å®¹åº”è¯¥æ˜¯â€œMethodref_infoçš„tagå€¼ä¸º10â€ 4.12ï¼šCONSTANT_InterfaceMethodref_infoï¼ˆæ¥å£ä¸­æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ï¼‰ æˆªæ­¢åˆ°ç›®å‰ï¼Œå¸¸è§çš„11ç§å¸¸é‡å·²ç»ä»‹ç»å®Œäº†ï¼Œä¸‹é¢å†ä»‹ç»3ç§JDK1.7å¼•å…¥çš„æ–°å¸¸é‡ã€‚ 4.13ï¼šCONSTANT_MethodHandle_infoï¼ˆè¡¨ç¤ºæ–¹æ³•å¥æŸ„ï¼‰è¿™ä¸ªå¸¸é‡æ˜¯1.7æ–°å¢çš„ç‰¹æ€§ï¼Œå³æ–¹æ³•å¥æŸ„ï¼Œå¯ä»¥å’Œä¸‹æ–¹MethodTypeç»“åˆä½¿ç”¨ï¼Œç”¨æ³•è¿™é‡Œæš‚æ—¶ä¸è¯´ï¼Œä½ å¯ä»¥ç®€å•ç†è§£ï¼Œå®ƒæ˜¯ç±»ä¼¼åå°„çš„åŠŸèƒ½ï¼Œå¯ä»¥æŒ‡å®šè°ƒç”¨å“ªä¸ªå¯¹è±¡çš„å“ªä¸ªæ–¹æ³•ã€‚ä½†ä¸åŒäºåå°„ï¼Œå®ƒå¯ä»¥åœ¨ç¼–è¯‘æœŸå°±æŒ‡å®šå¥½æ–¹æ³•è°ƒç”¨ï¼Œè€Œä¸æ˜¯è¿è¡ŒæœŸï¼Œè¿™ç›¸æ¯”åå°„è¦å®‰å…¨çš„å¤šã€‚ 4.14ï¼šCONSTANT_MethodType_infoï¼ˆæ ‡è¯†æ–¹æ³•ç±»å‹ï¼‰å¾…è¡¥å…¨ğŸ˜‚ 4.15ï¼šCONSTANT_InvokeDynamic_infoï¼ˆåŠ¨æ€æ–¹æ³•è°ƒç”¨ç‚¹ï¼‰å¾…è¡¥å…¨ğŸ˜‚ äº”ã€è®¿é—®æ ‡å¿—ç´§æŒ¨ç€å¸¸é‡æ± åé¢çš„ä¸¤ä¸ªå­—èŠ‚ï¼Œä»£è¡¨è®¿é—®æ ‡å¿—ï¼ˆaccess_flagsï¼‰ï¼Œå› ä¸ºå…¶å…·å¤‡2ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥å®ƒæœ‰16ä¸ªbitä½å¯ä»¥åˆ©ç”¨ï¼Œæ¯ä¸ªä½ç½®çš„0æˆ–1ä»£è¡¨ä¸åŒçš„å«ä¹‰ï¼Œå½“å‰åªå®šä¹‰äº†8ä¸ªï¼Œå¦‚ä¸‹ï¼š å…­ã€ç»§æ‰¿å…³ç³»æ¥ç€access_flagåé¢ï¼Œæœ‰æè¿°æœ¬ç±»ç»§æ‰¿å…³ç³»çš„å‡ ä¸ªå˜é‡ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š å­¦è¿‡javaçš„äººéƒ½çŸ¥é“ï¼Œjavaç±»å…è®¸å•ç»§æ‰¿å’Œå¤šå®ç°ï¼Œå› æ­¤å›¾ä¸­super_classåªæœ‰ä¸€ä¸ªï¼Œinterfaceå´å¯¹åº”äº†ä¸€ä¸ªé›†åˆï¼Œå½“ç„¶ï¼Œå®ƒä»¬éƒ½åªæ˜¯u2ç±»å‹çš„ç´¢å¼•è€Œå·²ï¼ŒæŒ‡å‘å¸¸é‡æ± é‡Œçš„CONSTANT_Class_infoï¼ˆå‚è€ƒ4.7ï¼‰ ä¸ƒã€å­—æ®µè¡¨é›†åˆæˆ‘ä»¬ç¦»å¼€äº†ç»§æ‰¿å…³ç³»åï¼Œç´§æŒ¨ç€çš„å°±æ˜¯å­—æ®µè¡¨é›†åˆã€‚å­—æ®µè¡¨ï¼Œå³ç±»ï¼ˆæˆ–æ¥å£ï¼‰é‡Œå£°æ˜çš„å˜é‡ï¼Œå˜é‡åˆ†ä¸ºé™æ€å˜é‡ï¼ˆç±»å˜é‡ï¼‰ä»¥åŠæˆå‘˜å˜é‡ï¼ˆå®ä¾‹å˜é‡ï¼‰ã€‚ ç°åœ¨è¯¦ç»†ä»‹ç»ä¸‹å›¾ä¸­è™šçº¿éƒ¨åˆ†ï¼Œè¿™å››ä¸ªu2ç±»å‹çš„å­—æ®µä»¥åŠå±æ€§è¡¨ï¼ˆattribute_infoï¼‰é›†åˆä»£è¡¨äº†ä¸€ä¸ªfield_infoè¡¨ï¼Œå®ƒçš„è¿™äº›å­—æ®µè§£é‡Šå¦‚ä¸‹ï¼š 7.1ï¼šaccess_flagsè¿™ä¸ªå­—æ®µä¹Ÿå«access_flagsï¼Œè·Ÿä¹‹å‰Classæœ¬èº«çš„access_flagsæ‰€å…·å¤‡çš„æ„ä¹‰ä¸€æ ·ï¼Œå®ƒæ˜¯ç”¨æ¥æè¿°å­—æ®µçš„è®¿é—®æ ‡å¿—ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ¯ä¸€ä½ä»£è¡¨ä»€ä¹ˆæ„æ€å§ï¼š 7.2ï¼šname_index &amp; descriptor_indexname_indexå’Œdescriptor_indexéƒ½æ˜¯ç´¢å¼•å€¼ï¼Œå‰è€…æŒ‡å‘å¸¸é‡æ± é‡Œä¸€ä¸ªCONSTANT_Utf8_infoï¼Œç”¨æ¥è¡¨ç¤ºè¯¥å­—æ®µçš„ç®€å•åç§°ï¼Œåè€…ä¹Ÿæ˜¯æŒ‡å‘å¸¸é‡æ± é‡Œä¸€ä¸ªCONSTANT_Utf8_infoï¼Œä½†å®ƒç”¨æ¥è¡¨ç¤ºå­—æ®µçš„æè¿°ç¬¦ï¼ˆä»€ä¹ˆæ˜¯ç®€å•åç§°ï¼Œä»€ä¹ˆæ˜¯æè¿°ç¬¦ï¼Ÿè¯·å‚è€ƒ4.1.2ï¼‰ 7.3ï¼šattributes_count &amp; attribute_infosè¿™æ®µä¿¡æ¯å¾ˆå¤æ‚ï¼Œä»£è¡¨å±æ€§è¡¨ï¼Œattributes_countä»£è¡¨åé¢è·Ÿå‡ ä¸ªå±æ€§è¡¨ï¼Œattribute_infosä»£è¡¨å±æ€§è¡¨é›†åˆï¼Œå±æ€§è¡¨æ˜¯å¾ˆå¤æ‚çš„ä¸€å—å†…å®¹ï¼ŒClassæ–‡ä»¶ã€å­—æ®µè¡¨ã€æ–¹æ³•è¡¨ï¼Œç”šè‡³Codeå±æ€§è¡¨éƒ½å¯ä»¥æºå¸¦è‡ªå·±çš„å±æ€§è¡¨é›†åˆï¼Œå±æ€§è¡¨çš„ç§ç±»å¾ˆç¹å¤šï¼Œåœ¨9.1èŠ‚ä¼šåˆ—ä¸¾ä¸€ä¸ªä¸æœ¬èŠ‚ï¼ˆæ–¹æ³•è¡¨ï¼‰ç›¸å…³çš„å±æ€§è¡¨ConstantValueçš„ç»“æ„ã€‚ å…«ã€æ–¹æ³•è¡¨é›†åˆç¦»å¼€å­—æ®µè¡¨åï¼Œç´§æŒ¨ç€çš„å°±æ˜¯æ–¹æ³•è¡¨é›†åˆï¼Œå®ƒå‡ ä¹è·Ÿå­—æ®µè¡¨ç»“æ„ä¸€è‡´ã€‚æ–¹æ³•è¡¨ï¼Œå³ç±»ï¼ˆæˆ–æ¥å£ï¼‰é‡Œå£°æ˜çš„æ–¹æ³•ï¼ŒåŒæ ·çš„ï¼Œæ–¹æ³•åˆ†ä¸ºé™æ€æ–¹æ³•ï¼ˆç±»æ–¹æ³•ï¼‰ä»¥åŠæˆå‘˜æ–¹æ³•ï¼ˆå®ä¾‹æ–¹æ³•ï¼‰ã€‚ åŒæ ·çš„ï¼Œæ¥ä»‹ç»ä¸‹å›¾ä¸­è™šçº¿éƒ¨åˆ†ï¼Œè¿™å››ä¸ªu2ç±»å‹çš„å­—æ®µä»¥åŠå±æ€§è¡¨ï¼ˆattribute_infoï¼‰é›†åˆä»£è¡¨äº†ä¸€ä¸ªmethod_infoè¡¨ï¼Œå®ƒçš„è¿™äº›å­—æ®µè§£é‡Šå¦‚ä¸‹ï¼š 8.1ï¼šaccess_flagsä¸å¤šè¯´äº†ï¼Œå‰é¢é‡åˆ°å¾ˆå¤šæ¬¡äº†ï¼Œå®ƒç”¨æ¥æè¿°æ–¹æ³•çš„è®¿é—®æ ‡å¿—ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ¯ä¸€ä½ä»£è¡¨ä»€ä¹ˆæ„æ€å§ï¼š 8.2ï¼šname_index &amp; descriptor_indexè·Ÿå­—æ®µè¡¨å¯¹åº”çš„å­—æ®µä½œç”¨ç›¸åŒï¼Œname_indexå’Œdescriptor_indexéƒ½æ˜¯ç´¢å¼•å€¼ï¼Œå‰è€…æŒ‡å‘å¸¸é‡æ± é‡Œä¸€ä¸ªCONSTANT_Utf8_infoï¼Œç”¨æ¥è¡¨ç¤ºè¯¥æ–¹æ³•çš„ç®€å•åç§°ï¼Œåè€…ä¹Ÿæ˜¯æŒ‡å‘å¸¸é‡æ± é‡Œä¸€ä¸ªCONSTANT_Utf8_infoï¼Œä½†å®ƒç”¨æ¥è¡¨ç¤ºæ–¹æ³•çš„æè¿°ç¬¦ï¼ˆä»€ä¹ˆæ˜¯ç®€å•åç§°ï¼Œä»€ä¹ˆæ˜¯æè¿°ç¬¦ï¼Ÿè¯·å‚è€ƒ4.1.2ï¼‰ 8.3ï¼šattributes_count &amp; attribute_infoså±æ€§è¡¨ï¼Œåœ¨7.3èŠ‚æåˆ°è¿‡ï¼Œè¿™é‡Œçš„ä¿©å±æ€§è·Ÿå­—æ®µè¡¨é‡Œçš„æ„æ€ä¸€æ ·ï¼Œä½†åœ¨æœ¬èŠ‚ä½ å¯èƒ½ä¼šå¥½å¥‡ï¼Œæ–¹æ³•è¡¨å®šä¹‰äº†æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦ï¼Œé‚£ä¹ˆæ–¹æ³•çš„ä»£ç è·‘å“ªé‡Œå»äº†ï¼Ÿå…¶å®æ–¹æ³•æœ¬èº«çš„ä»£ç ä¼šè¢«ç¼–è¯‘æˆå­—èŠ‚ç æŒ‡ä»¤ï¼Œå­˜æ”¾åœ¨æ¯ä¸ªæ–¹æ³•åé¢çš„æŸä¸ªå±æ€§è¡¨é‡Œï¼Œè€Œè¿™ä¸ªå±æ€§è¡¨å°±æ˜¯Codeï¼Œåœ¨åç»­çš„9.2é‡Œä¼šè¯¦ç»†ä»‹ç»ï¼Œè¿™é‡Œåªéœ€è¦è®°ä½å®ƒæ˜¯å‡ºç°åœ¨æœ¬èŠ‚ï¼ˆæ–¹æ³•è¡¨ï¼‰è¿™ä¸ªä½ç½®çš„å³å¯ã€‚ ä¹ã€å±æ€§è¡¨å‰é¢ä¸¤èŠ‚æˆ–å¤šæˆ–å°‘æåˆ°è¿‡å±æ€§è¡¨ï¼Œè¿™æ˜¯å¾ˆå¤æ‚ä¹Ÿå¾ˆé‡è¦çš„ä¸€ä¸ªè¡¨ç»“æ„ï¼Œä¸‹é¢æ¥çœ‹ä¸‹å®ƒçš„åŸºæœ¬ç»„æˆï¼š ä¸ç®¡å±æ€§è¡¨å¤šä¹ˆå¤æ‚ï¼Œå®ƒå¼€å§‹çš„ä¸¤ä¸ªå±æ€§æ€»æ˜¯attribute_name_indexå’Œattribute_lengthï¼Œå…·ä½“å«ä¹‰å¦‚å›¾æ‰€ç¤ºã€‚ æœ¬èŠ‚åªå°‘é‡ä»‹ç»å‡ ä¸ªå¾ˆé‡è¦çš„å±æ€§è¡¨ï¼Œæ›´è¯¦ç»†çš„å±æ€§è¡¨å¯ä»¥æŸ¥é˜…https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.7 9.1ï¼šConstantValueå…ˆå›çœ‹ä¸‹7.3ï¼Œè¯¥å±æ€§è¡¨ä»…ä½œç”¨åœ¨å­—æ®µè¡¨ä¸Šï¼Œç”¨æ¥è¡¨ç¤ºä¸€ä¸ªstatic finalå­—æ®µçš„åˆå§‹å€¼ï¼Œä¸”è¦æ±‚è¯¥å­—æ®µå¿…é¡»æ˜¯åŸºæœ¬ç±»å‹æˆ–Stringç±»å‹æ‰å¯ä»¥ç”¨è¯¥è¡¨è¡¨ç¤ºåˆå§‹å€¼ï¼Œä¸ºä»€ä¹ˆï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸‹è¯¥è¡¨çš„ç»“æ„ï¼š å› ä¸ºconstantvalue_indexæŒ‡å‘çš„ä¸€å®šå¸¸é‡æ± é‡ŒæŸå­—é¢é‡ï¼Œå› æ­¤å®ƒåªèƒ½æ˜¯CONSTANT_Long_infoã€CONSTANT_Float_infoã€CONSTANT_Double_infoã€CONSTANT_Integer_infoã€CONSTANT_String_infoé‡Œçš„ä¸€ç§ï¼Œæ‰€ä»¥åªæœ‰è¢«å£°æ˜ä¸ºstatic finalçš„åŸºæœ¬ç±»å‹å’ŒStringç±»å‹çš„å­—æ®µï¼Œæ‰å¯èƒ½å­˜åœ¨æ­¤å±æ€§è¡¨ï¼Œç”¨æ¥ä»£è¡¨å…¶åˆå§‹åŒ–å€¼ã€‚ 9.2ï¼šCodeè¿™ç»å¯¹æ˜¯æœ€é«˜èƒ½çš„ä¸€ä¸ªå±æ€§è¡¨ï¼Œæˆ‘ä»¬è¯¦ç»†æ¥è§£æä¸‹ï¼Œä»å®ƒçš„åå­—å°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œå®ƒä»£è¡¨çš„æ˜¯ä¸€ä¸ªæ–¹æ³•çš„ä»£ç å±æ€§ï¼Œå±äºæ–¹æ³•è¡¨ï¼ˆè¿™ç‚¹è¯·ç‰¢è®°ï¼‰ï¼Œè¿™åœ¨8.3é‡Œæåˆ°è¿‡ï¼Œæˆ‘ä»¬å†™çš„ç¨‹åºä»£ç æœ€ç»ˆä¼šè¢«javacç¼–è¯‘æˆå­—èŠ‚ç æŒ‡ä»¤ï¼Œè€Œè¿™äº›æŒ‡ä»¤å°±å­˜å‚¨åœ¨Codeå±æ€§è¡¨å†…ï¼Œå®ƒçš„ç»“æ„æ˜¯æ€æ ·çš„å‘¢ï¼Ÿçœ‹å›¾ï¼š è¿™é‡Œé¢æœ‰å¾ˆå¤šç»†èŠ‚ï¼Œæˆ‘ä»¬æ¥é€ä¸€ä»‹ç»ä¸‹ï¼Œå°±ä»max_stackå¼€å§‹å§~ 9.2.1ï¼šmax_stackè¿™ä¸ªå€¼è·Ÿæ“ä½œæ•°æ ˆæœ‰å…³ç³»ï¼Œä»£è¡¨å®ƒçš„æœ€å¤§æ·±åº¦ï¼Œå½“jvmå¤„äºè¿è¡ŒæœŸçš„æ—¶å€™ï¼Œä¼šæ ¹æ®è¿™ä¸ªå€¼æ¥åˆ†é…æ ˆå¸§ä¸­æ“ä½œæ•°æ ˆçš„æ·±åº¦ã€‚ï¼ˆæ ˆå¸§æ˜¯åç»­æ–‡ç« å°†ä¼šä»‹ç»çš„æ¦‚å¿µï¼Œè¿è¡ŒæœŸæ—¶æ¯ä¸€ä¸ªCodeæ¨¡å—ï¼Œéƒ½ä¼šä¸ä¹‹å¯¹åº”ä¸€ä¸ªæ ˆå¸§ç»“æ„ï¼Œå¯é€šè¿‡10.2.5.1èŠ‚äº†è§£å…¶åŸºæœ¬æ¦‚å¿µï¼‰ 9.2.2ï¼šmax_localsè¿™ä¸ªå€¼ä¹Ÿæ˜¯å›´ç»•ç€è¿è¡ŒæœŸæ ˆå¸§æ¥ç”Ÿæ•ˆçš„ï¼Œå®ƒä»£è¡¨æ ˆå¸§é‡Œå±€éƒ¨å˜é‡è¡¨æ‰€éœ€çš„å­˜å‚¨ç©ºé—´ã€‚ä»€ä¹ˆæ˜¯å±€éƒ¨å˜é‡è¡¨ï¼Ÿæ—©æœŸæ¥è§¦javaæ—¶å°±çŸ¥é“ï¼Œæ¯ä¸ªæ–¹æ³•å†…äº§ç”Ÿçš„å¯¹è±¡ã€å˜é‡æˆ‘ä»¬éƒ½ç§°ä¹‹ä¸ºå±€éƒ¨å˜é‡ï¼Œå®ƒä»¬ä¼šåœ¨è¿è¡ŒæœŸè¢«æš‚å­˜å…¥æ–¹æ³•æ‰€å±æ ˆå¸§é‡Œçš„å±€éƒ¨å˜é‡è¡¨ä¸­ï¼Œæ–¹ä¾¿æ“ä½œæ•°æ ˆå­˜å–ä¸æ“ä½œï¼Œè€Œå®ƒéœ€è¦å¤šå°‘å­˜å‚¨å¤§å°å‘¢ï¼Ÿå°±æ˜¯é è¿™ä¸ªå€¼æ¥å†³å®šçš„ï¼Œç»“åˆ9.2.1å¯ä»¥çŸ¥é“ï¼Œä¸€ä¸ªjavaæ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨å¤§å°ã€æ“ä½œæ•°æ ˆæœ€å¤§æ·±åº¦éƒ½æ˜¯åœ¨ç¼–è¯‘æœŸå°±å·²ç»ç¡®å®šäº†çš„ã€‚ é‚£ä¹ˆï¼Œå­˜å‚¨å¤§å°çš„å•ä½åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ˜¯å­—èŠ‚ï¼ˆbyteï¼‰å—ï¼Ÿæ¯”å¦‚max_localsä¸º5ï¼Œä»£è¡¨çš„æ˜¯5byteçš„å­˜å‚¨ç©ºé—´å—ï¼Ÿ å¹¶ä¸æ˜¯ï¼Œå®ƒæ˜¯ä¸€ä¸ªå«åšSlotçš„ä¸œè¥¿ï¼Œmax_locals=5ï¼Œä»£è¡¨éœ€è¦åˆ†é…5ä¸ªSlotã€‚ä¸‹é¢æ¥ä»‹ç»ä¸‹Slotã€‚ Slotæœ‰32ä¸ªbitä½ï¼Œæ„æ€å°±æ˜¯è¯´æ¯ä¸ªSlotå 4å­—èŠ‚ï¼Œå› æ­¤ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªå±€éƒ¨å˜é‡æ˜¯intå‹ï¼Œé‚£ä¹ˆå®ƒå°±å 1ä¸ªSlotç©ºé—´ï¼Œå¦‚æœæ˜¯floatæˆ–è€…longä¹‹ç±»çš„ï¼Œé‚£å°±éœ€è¦ä¸¤ä¸ªSlotã€‚ é‚£ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥å¾ˆå®¹æ˜“æ¨ç®—å‡ºä¸€ä¸ªæ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨çš„å®¹é‡åˆ°åº•éœ€è¦å¤šå¤§äº†ï¼š æ€»Sloté‡ = æ‰€æœ‰å±€éƒ¨å˜é‡æ‰€ç”¨çš„å­—èŠ‚é‡ / 4 ä½†æ˜¯ï¼Œè¿™æ ·æ˜¯ä¸å¯¹çš„ï¼å› ä¸ºæ ¹æ®æ¯ä¸ªå±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸä¸åŒï¼ŒSlotæ˜¯å¯ä»¥è¢«å¤ç”¨çš„ï¼Œè¿™ç‚¹å¾ˆé‡è¦ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­ï¼š ä»£ç å—112345678910111213public int slot(int a) { //å…¥å‚aï¼Œä¸ºaåˆ†é…ä¸€ä¸ªSlot int b = 1; //ä¸ºbåˆ†é…ä¸€ä¸ªSlot if (a == 1) { int c = a + b; //ä¸ºcåˆ†é…ä¸€ä¸ªSlotï¼Œä½†æ˜¯æ³¨æ„ï¼Œcçš„ä½œç”¨åŸŸåªæœ‰ifåŸŸ b = c; } //ç¦»å¼€ifåŸŸï¼Œä¸ºcåˆ†é…é‚£ä¸ªSlotä¼šè¢«å®Œå…¨é—²ç½®å‡ºæ¥ï¼Œå› ä¸ºcåœ¨ä¹‹åçš„é€»è¾‘ä¸­å†ä¹Ÿæ— æ³•ä½¿ç”¨äº† int d = b; //åæ­£cçš„é‚£ä¸ªSloté—²ç€ä¹Ÿæ˜¯æµªè´¹ï¼Œä¸å¦‚ç»™æ¥ä¸‹æ¥çš„å˜é‡ç”¨ï¼Œè¿™é‡Œdå°±å¯ä»¥å¤ç”¨cçš„Slot return d;} è¿™æ®µä»£ç ä¸€å…±æœ‰aã€bã€cã€då››ä¸ªintå‹å˜é‡ï¼Œç†è®ºä¸Šéœ€è¦åˆ†é…4ä¸ªSlotå­˜å‚¨ï¼Œä½†å®é™…åªåˆ†é…äº†3ä¸ªï¼Œå…·ä½“åŸå› è¯·å‚è€ƒä»£ç ä¸­çš„æ³¨é‡Šï¼Œè¿™ç§åˆ©ç”¨javaè¯­æ³•æ¥èŠ‚çœSlotçš„åšæ³•è¿˜æ˜¯ç›¸å½“èªæ˜çš„ã€‚ 9.2.3ï¼šå­—èŠ‚ç æŒ‡ä»¤å‚è€ƒå›¾25ï¼Œç¦»å¼€äº†max_stackå’Œmax_localsï¼Œç´§æ¥ç€å°±è¿›å…¥äº†ä¸€ä¸ªéå¸¸å†—é•¿çš„åŒºåŸŸï¼Œé‚£å°±æ˜¯codeåŒºåŸŸï¼Œå®ƒæ˜¯ä½ å†™çš„javaç¨‹åºè¢«ç¿»è¯‘æˆçš„ä¸€ä¸ªä¸ªæŒ‡ä»¤ç ï¼Œæ˜¯æœ€é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯ç›´æ¥å¯ä»¥è¢«javaç¨‹åºå‘˜æ“æ§çš„éƒ¨åˆ†ã€‚ å­—èŠ‚ç æŒ‡ä»¤å¤§å…¨ï¼šhttps://luisstruggle.github.io/blog/javaSE7-JVM.html åç»­ä¼šä»¥æŸä¸ªå®ä¾‹çš„å­—èŠ‚ç æŒ‡ä»¤é›†æ¥åˆ†æè¿™äº›æŒ‡ä»¤æ˜¯å¦‚ä½•åœ¨æ ˆå¸§é‡Œè¿è¡Œçš„ï¼ˆè™½ç„¶æ˜¯è¿è¡ŒæœŸçš„ä¸œè¥¿ï¼Œä½†è¿˜æ˜¯æƒ³åœ¨è¿™ä¸€èŠ‚åšä¸‹ç®€å•çš„è¯´æ˜ï¼‰ åã€å®æˆ˜10.1ï¼šå¿«é€Ÿå›é¡¾ç»ˆäºæŠŠå­—èŠ‚ç çš„è¯¦ç»†å†…å®¹è®²å®Œäº†ï¼Œå¤ªå¤šå¤ªé•¿ï¼Œä¸Šé¢æ˜¯è¯¦ç»†ä»‹ç»ï¼Œä¸‹é¢å°±é€šè¿‡ä¸€å¼ å›¾ç®€å•å›é¡¾ä¸€ä¸‹å­—èŠ‚ç æ–‡ä»¶çš„å †å é¡ºåºå’Œå†…å®¹ç§ç±»ï¼š 10.2ï¼šå­—èŠ‚ç åˆ†æå®æˆ˜10.2.1ï¼šæºä»£ç æœ¬ç¯‡ä¼šé€šè¿‡ä»¥ä¸‹å®ä¾‹æ¥å…·ä½“è§£æå­—èŠ‚ç ç»„æˆï¼š ä»£ç å—212345678910111213141516171819202122232425262728293031323334353637383940package sun.juwin.test;public class Test { public static final int j; //å£°æ˜ä¸€ä¸ªç±»å˜é‡jï¼Œå…¶åœ¨é™æ€å—é‡Œè¿›è¡Œåˆå§‹åŒ– public static final int k = 5; //å†å£°æ˜ä¸€ä¸ªç±»å˜é‡kï¼Œå¹¶ç›´æ¥åˆå§‹åŒ–ä¸º5 private int i; //åŒ…å«ä¸€ä¸ªæˆå‘˜å˜é‡ static { //é™æ€å—ï¼Œç›¸å½“äºç±»æœ¬èº«çš„æ„é€ å™¨ j = 6; } public Test() { //åŒ…å«ä¸¤ä¸ªé‡è½½æ„é€ å™¨ System.out.println(\"Test init !\"); //æ³¨æ„ï¼Œè¿™é‡Œè°ƒç”¨äº†outå¯¹è±¡çš„printlnæ–¹æ³• } public Test(int i) { this(); //åœ¨è¿™é‡Œä¸»åŠ¨è§¦å‘ä¸€æ¬¡æ— å‚æ„é€ å™¨ this.i = i; //ç»™iå±æ€§èµ‹å€¼ } public static int getK() { //ç±»æ–¹æ³•ï¼Œè¿”å›ç±»å±æ€§kçš„å€¼ï¼ˆé™æ€æ–¹æ³•çš„å…¥å‚ä¸ä¼šéšå¼ä¼ å…¥thisä½œä¸ºå‚æ•°ï¼‰ return k; } public int sum_i(int a, int b) { //æˆå‘˜æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼ ä¿©å€¼ï¼Œè¿”å›iå’Œè¿™ä¿©å€¼ä¹‹å’Œçš„å’Œï¼ˆæˆå‘˜æ–¹æ³•çš„å…¥å‚ä¼šéšå¼ä¼ å…¥thisä½œä¸ºå‚æ•°ï¼‰ return i + sum(a, b); } public int sum(int x, int y) { //æˆå‘˜æ–¹æ³•ï¼Œè®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œ return x + y; } public int sum2(int x, int y) { //æˆå‘˜æ–¹æ³•ï¼Œä½œç”¨è·Ÿä¸Šé¢çš„sumä¸€æ ·ï¼Œä½†è¿™ä¸ªæ–¹æ³•ä¼šå¤šå‡ºä¸€ä¸ªSlotæ¥å­˜resultè¿™ä¸ªå±€éƒ¨å˜é‡ int result = x + y; return result; }} 10.2.2ï¼šå­—èŠ‚ç ä¿¡æ¯é¦–å…ˆæˆ‘ä»¬åˆ©ç”¨javacå°†å…¶ç¼–è¯‘æˆå­—èŠ‚ç æ–‡ä»¶ï¼ˆæˆ‘è¿™é‡Œä½¿ç”¨jdk11ç‰ˆæœ¬åšçš„ç¼–è¯‘ï¼‰ï¼Œç„¶ååˆ©ç”¨javapæŒ‡ä»¤ï¼Œè¾“å‡ºå…¶å­—èŠ‚ç ä¿¡æ¯ï¼š javac&amp;javapæŒ‡ä»¤12javac -g Test.java //ç¼–è¯‘(-gä¼šå¸®å¿™æŠŠè°ƒè¯•ä¿¡æ¯ä¹Ÿç¼–è¯‘è¿›å»ï¼Œä¸ºäº†è¯´æ˜Slotï¼Œæˆ‘ä»¬éœ€è¦è¿™ä¸ª)javap -v -p Test //è¾“å‡ºå­—èŠ‚ç è¯¦ç»†ä¿¡æ¯ï¼Œ-vè¡¨ç¤ºè¾“å‡ºè¯¦ç»†ä¿¡æ¯ï¼Œ-pè¡¨ç¤ºè¾“å‡ºæ‰€æœ‰çš„å­—æ®µå’Œæ–¹æ³•(ä¸åŠ è¿™ä¸ªçš„è¯publicä»¥ä¸‹çš„å­—æ®µæ–¹æ³•æ— æ³•å±•ç¤º) javapè¿™ä¸ªæŒ‡ä»¤æ˜¯å¹²å˜›çš„å‘¢ï¼Ÿå®ƒå®é™…ä¸Šæ˜¯å°†ç¼–è¯‘å¥½çš„å­—èŠ‚ç æ–‡ä»¶åç¼–è¯‘ï¼Œç„¶åè¾“å‡ºå­—èŠ‚ç æ–‡ä»¶é‡Œå„æ•°æ®é¡¹çš„è¯¦ç»†ä¿¡æ¯ï¼Œç›¸æ¯”ç›´æ¥å»è¯»äºŒè¿›åˆ¶çš„å­—èŠ‚ç æ–‡ä»¶ï¼Œjavapè¾“å‡ºçš„å­—èŠ‚ç è¯¦ç»†ä¿¡æ¯æ›´åŠ é€šä¿—æ˜“è¯»ã€‚ ç°åœ¨æ¥çœ‹ä¸‹ä»£ç å—2çš„å­—èŠ‚ç è¯¦ç»†ä¿¡æ¯ï¼ˆå¤ªå†—é•¿äº†ï¼Œåé¢ä¼šæ‹†è§£è¯´æ˜ï¼‰ï¼š ä»£ç å—3123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199 Compiled from \"Test.java\"public class sun.juwin.test.Test minor version: 0 major version: 55 flags: (0x0021) ACC_PUBLIC, ACC_SUPER this_class: #7 // sun/juwin/test/Test super_class: #10 // java/lang/Object interfaces: 0, fields: 3, methods: 7, attributes: 1Constant pool: #1 = Methodref #10.#39 // java/lang/Object.\"&lt;init&gt;\":()V #2 = Fieldref #40.#41 // java/lang/System.out:Ljava/io/PrintStream; #3 = String #42 // Test init ! #4 = Methodref #43.#44 // java/io/PrintStream.println:(Ljava/lang/String;)V #5 = Methodref #7.#39 // sun/juwin/test/Test.\"&lt;init&gt;\":()V #6 = Fieldref #7.#45 // sun/juwin/test/Test.i:I #7 = Class #46 // sun/juwin/test/Test #8 = Methodref #7.#47 // sun/juwin/test/Test.sum:(II)I #9 = Fieldref #7.#48 // sun/juwin/test/Test.j:I #10 = Class #49 // java/lang/Object #11 = Utf8 j #12 = Utf8 I #13 = Utf8 k #14 = Utf8 ConstantValue #15 = Integer 5 #16 = Utf8 i #17 = Utf8 &lt;init&gt; #18 = Utf8 ()V #19 = Utf8 Code #20 = Utf8 LineNumberTable #21 = Utf8 LocalVariableTable #22 = Utf8 this #23 = Utf8 Lsun/juwin/test/Test; #24 = Utf8 (I)V #25 = Utf8 getK #26 = Utf8 ()I #27 = Utf8 sum_i #28 = Utf8 (II)I #29 = Utf8 a #30 = Utf8 b #31 = Utf8 sum #32 = Utf8 x #33 = Utf8 y #34 = Utf8 sum2 #35 = Utf8 result #36 = Utf8 &lt;clinit&gt; #37 = Utf8 SourceFile #38 = Utf8 Test.java #39 = NameAndType #17:#18 // \"&lt;init&gt;\":()V #40 = Class #50 // java/lang/System #41 = NameAndType #51:#52 // out:Ljava/io/PrintStream; #42 = Utf8 Test init ! #43 = Class #53 // java/io/PrintStream #44 = NameAndType #54:#55 // println:(Ljava/lang/String;)V #45 = NameAndType #16:#12 // i:I #46 = Utf8 sun/juwin/test/Test #47 = NameAndType #31:#28 // sum:(II)I #48 = NameAndType #11:#12 // j:I #49 = Utf8 java/lang/Object #50 = Utf8 java/lang/System #51 = Utf8 out #52 = Utf8 Ljava/io/PrintStream; #53 = Utf8 java/io/PrintStream #54 = Utf8 println #55 = Utf8 (Ljava/lang/String;)V{ public static final int j; descriptor: I flags: (0x0019) ACC_PUBLIC, ACC_STATIC, ACC_FINAL public static final int k; descriptor: I flags: (0x0019) ACC_PUBLIC, ACC_STATIC, ACC_FINAL ConstantValue: int 5 private int i; descriptor: I flags: (0x0002) ACC_PRIVATE public sun.juwin.test.Test(); descriptor: ()V flags: (0x0001) ACC_PUBLIC Code: stack=2, locals=1, args_size=1 0: aload_0 1: invokespecial #1 // Method java/lang/Object.\"&lt;init&gt;\":()V 4: getstatic #2 // Field java/lang/System.out:Ljava/io/PrintStream; 7: ldc #3 // String Test init ! 9: invokevirtual #4 // Method java/io/PrintStream.println:(Ljava/lang/String;)V 12: return LineNumberTable: line 15: 0 line 16: 4 line 17: 12 LocalVariableTable: Start Length Slot Name Signature 0 13 0 this Lsun/juwin/test/Test; public sun.juwin.test.Test(int); descriptor: (I)V flags: (0x0001) ACC_PUBLIC Code: stack=2, locals=2, args_size=2 0: aload_0 1: invokespecial #5 // Method \"&lt;init&gt;\":()V 4: aload_0 5: iload_1 6: putfield #6 // Field i:I 9: return LineNumberTable: line 20: 0 line 21: 4 line 22: 9 LocalVariableTable: Start Length Slot Name Signature 0 10 0 this Lsun/juwin/test/Test; 0 10 1 i I public static int getK(); descriptor: ()I flags: (0x0009) ACC_PUBLIC, ACC_STATIC Code: stack=1, locals=0, args_size=0 0: iconst_5 1: ireturn LineNumberTable: line 25: 0 public int sum_i(int, int); descriptor: (II)I flags: (0x0001) ACC_PUBLIC Code: stack=4, locals=3, args_size=3 0: aload_0 1: getfield #6 // Field i:I 4: aload_0 5: iload_1 6: iload_2 7: invokevirtual #8 // Method sum:(II)I 10: iadd 11: ireturn LineNumberTable: line 29: 0 LocalVariableTable: Start Length Slot Name Signature 0 12 0 this Lsun/juwin/test/Test; 0 12 1 a I 0 12 2 b I public int sum(int, int); descriptor: (II)I flags: (0x0001) ACC_PUBLIC Code: stack=2, locals=3, args_size=3 0: iload_1 1: iload_2 2: iadd 3: ireturn LineNumberTable: line 33: 0 LocalVariableTable: Start Length Slot Name Signature 0 4 0 this Lsun/juwin/test/Test; 0 4 1 x I 0 4 2 y I public int sum2(int, int); descriptor: (II)I flags: (0x0001) ACC_PUBLIC Code: stack=2, locals=4, args_size=3 0: iload_1 1: iload_2 2: iadd 3: istore_3 4: iload_3 5: ireturn LineNumberTable: line 37: 0 line 38: 4 LocalVariableTable: Start Length Slot Name Signature 0 6 0 this Lsun/juwin/test/Test; 0 6 1 x I 0 6 2 y I 4 2 3 result I static {}; descriptor: ()V flags: (0x0008) ACC_STATIC Code: stack=1, locals=0, args_size=0 0: bipush 6 2: putstatic #9 // Field j:I 5: return LineNumberTable: line 12: 0 line 13: 5}SourceFile: \"Test.java\" å¤ªé•¿äº†ï¼Œæˆ‘ä»¬æ¥å°†ä¸Šé¢çš„å­—èŠ‚ç ä¿¡æ¯æ‹†è§£ä¸€ä¸‹è¿›è¡Œè¯¦ç»†åˆ†æã€‚ 10.2.3ï¼šå­—èŠ‚ç -å¤´éƒ¨ä»£ç å—4 å¤´éƒ¨12345678 Compiled from \"Test.java\"public class sun.juwin.test.Test minor version: 0 //è¿™æ˜¯æ¬¡ç‰ˆæœ¬å· major version: 55 //è¿™æ˜¯ä¸»ç‰ˆæœ¬å· flags: (0x0021) ACC_PUBLIC, ACC_SUPER //è¿™æ˜¯è®¿é—®æ ‡å¿—ï¼Œå°†0x0021è½¬æ¢æˆäºŒè¿›åˆ¶ï¼Œå†è·Ÿå›¾17ä¸€ä¸€å¯¹åº”ï¼Œå°±å¯ä»¥å¾—å‡ºACC_PUBLICå’ŒACC_SUPERçš„ç»“è®º this_class: #7 //#7æ˜¯ä¸ªå¸¸é‡æ± ç´¢å¼•ï¼Œå…¶å€¼ä¸ºsun/juwin/test/Testï¼Œä»£è¡¨è¯¥ç±»çš„å…¨é™å®šå super_class: #10 //#10ä¹Ÿæ˜¯ä¸ªå¸¸é‡æ± ç´¢å¼•ï¼Œå…¶å€¼ä¸ºjava/lang/Objectï¼Œä»£è¡¨è¯¥ç±»çš„çˆ¶ç±»å…¨é™å®šåï¼Œé»˜è®¤ä¸ºObjectï¼Œå¦‚æœçœŸçš„ç»§æ‰¿äº†å…¶ä»–çˆ¶ç±»ï¼Œåˆ™è¯¥å€¼ä¸ºå¯¹åº”çˆ¶ç±»çš„å…¨é™å®šå interfaces: 0, fields: 3, methods: 7, attributes: 1 //è¯¥ç±»å®ç°äº†0ä¸ªæ¥å£ï¼Œå…±æœ‰3ä¸ªå­—æ®µï¼ˆiã€jã€kï¼‰ï¼Œ7ä¸ªæ–¹æ³•ï¼ˆé™æ€å—ã€Test()ã€Test(int i)ã€getKã€sum_iã€sumã€sum2ï¼‰ï¼Œ1ä¸ªattributesï¼Ÿï¼Ÿè¿™ä¸ªæˆ‘è‡ªå·±æ²¡ææ‡‚ï¼Œå¦‚æœæŒ‡ä»£å±æ€§è¡¨ï¼Œé‚£è¿œä¸æ­¢1ä¸ªï¼Œå¦‚æœä¸æ˜¯æŒ‡å±æ€§è¡¨ï¼Œé‚£æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ 10.2.3ï¼šå­—èŠ‚ç -å¸¸é‡æ± ä»£ç å—5 å¸¸é‡æ± 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657Constant pool: //ä¸‹é¢å°±æ˜¯å¤§æ‚çƒ©çš„å¸¸é‡æ± äº†ï¼Œ#xxä»£è¡¨ä¸€ä¸ªç´¢å¼•ï¼Œæ‰€ä»¥çœ‹å¾—æ—¶å€™éœ€è¦æ‰¾åºå·çš„æŒ‰ç…§è¿™ä¸ªå€¼æ‰¾å°±è¡Œäº†ã€‚//è¿™é‡Œè¯´ä¸€ä¸‹XXXrefï¼Œåœ¨4.10å’Œ4.11ä»‹ç»è¿‡ï¼Œå®ƒä»¬æ˜¯æŒ‡åœ¨è¯¥ç±»å†…è¢«å¼•ç”¨åˆ°çš„å­—æ®µæˆ–æ–¹æ³•ï¼Œå› æ­¤åƒSystem.outå°±æ˜¯ä¸€ä¸ªFieldRefï¼Œè€Œprintlnå°±æ˜¯ä¸€ä¸ªMethodRefï¼ŒåŒæ ·çš„åœ¨sum_iæ–¹æ³•é‡Œæœ‰å¯¹sumæ–¹æ³•çš„è°ƒç”¨ï¼Œå› æ­¤sumæ–¹æ³•ä¹Ÿæ˜¯ä¸€ä¸ªMethodRef #1 = Methodref #10.#39 //ç”±äºè¯¥ç±»æ„é€ å™¨è¢«è°ƒç”¨æ—¶ä¼šè§¦å‘å…¶çˆ¶ç±»æ„é€ å™¨çš„è°ƒç”¨ï¼Œå› æ­¤çˆ¶ç±»æ„é€ å™¨æ˜¯ä¸€ä¸ªMethodRefï¼Œå…¶å€¼ä¸ºï¼šjava/lang/Object.\"&lt;init&gt;\":()Vï¼ˆå‰é¢ä¸ºè¯¥æ–¹æ³•æ‰€å±ç±»çš„å…¨é™å®šåï¼Œåé¢ä¸ºè¯¥æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦ï¼Œ#39å¯ä»¥å¾€ä¸‹æ‰¾ï¼Œæ˜¯ä¸ªNameAndTypeï¼‰ #2 = Fieldref #40.#41 //ä¸€ä¸ªè¢«è¯¥ç±»å¼•ç”¨çš„å±æ€§ï¼Œè¿™ä¸ªæ‰¾æ³•ç±»ä¼¼ä¸Šé¢çš„MethodRefï¼Œå…¶å€¼ä¸ºï¼šjava/lang/System.out:Ljava/io/PrintStream;å³ï¼šTest()æ–¹æ³•é‡Œçš„System.outå±æ€§ #3 = String #42 //Stringå­—é¢é‡ï¼ŒæŒ‡å‘å†…å®¹ä¸º\"Test init !\"çš„Utf8_info #4 = Methodref #43.#44 //å€¼ä¸ºjava/io/PrintStream.println:(Ljava/lang/String;)Vï¼Œå› ä¸ºprintlnè¢«æˆ‘ä»¬æ‰€å¼•ç”¨ï¼Œæ‰€ä»¥å®ƒä¹Ÿæˆä¸ºäº†è¯¥ç±»çš„ä¸€ä¸ªMethodRef #5 = Methodref #7.#39 //è¯¥ç±»çš„ä¸€ä¸ªæ— å‚æ„é€ å™¨ï¼Œå€¼ä¸ºsun/juwin/test/Test.\"&lt;init&gt;\":()Vï¼Œå› ä¸ºæˆ‘ä»¬çš„æœ‰å‚æ„é€ å™¨å¼•ç”¨äº†å®ƒï¼Œæ‰€ä»¥å®ƒä¹Ÿæ˜¯MethodRefï¼Œä¸‹é¢çš„å„ç±»Refä»¥æ­¤ç±»æ¨ #6 = Fieldref #7.#45 //å€¼ä¸ºsun/juwin/test/Test.i:I #7 = Class #46 //è¯¥ç±»çš„å…¨é™å®šåï¼ŒæŒ‡å‘çš„å€¼ä¸ºsun/juwin/test/Test #8 = Methodref #7.#47 //å€¼ä¸ºsun/juwin/test/Test.sum:(II)I #9 = Fieldref #7.#48 //å€¼ä¸ºsun/juwin/test/Test.j:I #10 = Class #49 //çˆ¶ç±»çš„å…¨é™å®šåï¼Œå®ƒå·²ç»è¢«#1å¼•ç”¨è¿‡ä¸€æ¬¡äº†ï¼Œå€¼ä¸ºjava/lang/Object #11 = Utf8 j //å­—æ®µjçš„ç®€å•åç§°æ–‡æœ¬å€¼ï¼Œåº”è¢«æŸä¸ªå­—æ®µè¡¨ç´¢å¼•ï¼Œå‚è€ƒ7.2 #12 = Utf8 I //å­—æ®µçš„æè¿°ç¬¦æ–‡æœ¬å€¼ï¼ŒåŒæ ·åº”è¢«æŸä¸ªå­—æ®µè¡¨ç´¢å¼•ï¼Œå‚è€ƒ7.2ï¼Œåªéœ€è¦ä¸€ä¸ªIå³å¯ï¼Œå› ä¸ºæœ¬ç±»æ‰€å®šä¹‰çš„å±æ€§åªæœ‰intä¸€ä¸ªç±»å‹ #13 = Utf8 k //å­—æ®µkçš„ç®€å•åç§°æ–‡æœ¬å€¼ #14 = Utf8 ConstantValue //å±æ€§è¡¨åç§°æ–‡æœ¬å€¼ï¼Œåº”è¢«æŸä¸ªå±æ€§è¡¨ç´¢å¼•ï¼Œå‚è€ƒ9.1 #15 = Integer 5 //æŸIntegerå­—é¢é‡çš„å€¼ï¼Œæœ¬ä¾‹ä¸­è¢«å±æ€§kçš„ConstantValueç´¢å¼•ï¼Œå‚è€ƒ9.1 #16 = Utf8 i //å­—æ®µiçš„ç®€å•åç§°æ–‡æœ¬å€¼ #17 = Utf8 &lt;init&gt; //è¯¥ç±»æ„é€ æ–¹æ³•çš„ç®€å•åç§°æ–‡æœ¬å€¼ï¼Œåº”è¢«æŸä¸ªæ–¹æ³•è¡¨ç´¢å¼•ï¼Œå‚è€ƒ8.2 #18 = Utf8 ()V //æŸæ–¹æ³•çš„æè¿°ç¬¦æ–‡æœ¬å€¼ï¼Œ()Vä»£è¡¨æ— å‚æ— è¿”å›å€¼ï¼ˆæè¿°ç¬¦è§„åˆ™å‚è€ƒ4.1.2ï¼‰ï¼Œåº”è¢«æŸä¸ªæ–¹æ³•è¡¨ç´¢å¼•ï¼Œå‚è€ƒ8.2 #19 = Utf8 Code //å±æ€§è¡¨åç§°æ–‡æœ¬å€¼ï¼Œåº”è¢«æŸä¸ªå±æ€§è¡¨ç´¢å¼•ï¼Œå‚è€ƒ9.2 #20 = Utf8 LineNumberTable //å±æ€§è¡¨åç§°æ–‡æœ¬å€¼ï¼Œåº”è¢«æŸä¸ªå±æ€§è¡¨ç´¢å¼•ï¼ŒLineNumberTableæ˜¯Codeå±æ€§è¡¨çš„ä¸€éƒ¨åˆ†ï¼Œå‚è€ƒ9.2 #21 = Utf8 LocalVariableTable //å±æ€§è¡¨åç§°æ–‡æœ¬å€¼ï¼Œåº”è¢«æŸä¸ªå±æ€§è¡¨ç´¢å¼•ï¼ŒLocalVariableTableæ˜¯Codeå±æ€§è¡¨çš„ä¸€éƒ¨åˆ†ï¼Œå‚è€ƒ9.2 #22 = Utf8 this //å­—æ®µthisçš„ç®€å•åç§°ï¼ˆthiså±äºéšå¼å­—æ®µï¼‰ #23 = Utf8 Lsun/juwin/test/Test; //å­—æ®µæè¿°ç¬¦æ–‡æœ¬å€¼ï¼Œæ‰€æœ‰ç±»å‹ä¸ºsun/juwin/test/Testç±»å‹çš„å­—æ®µï¼Œéƒ½å¯ä»¥ä½¿ç”¨è¯¥å€¼ä½œä¸ºè‡ªå·±çš„æè¿°ç¬¦ #24 = Utf8 (I)V //æŸä¸ªå…¥å‚ä¸ºä¸€ä¸ªintå‹æ— è¿”å›å€¼çš„æ–¹æ³•æè¿°ç¬¦æ–‡æœ¬å€¼ï¼Œæœ¬ä¾‹å­æŒ‡Test(int i)æ–¹æ³• #25 = Utf8 getK //getKæ–¹æ³•çš„ç®€å•åç§°æ–‡æœ¬å€¼ #26 = Utf8 ()I //æŸä¸ªæ— å‚è¿”å›intæ•°æ®çš„æ–¹æ³•çš„æè¿°ç¬¦æ–‡æœ¬å€¼ï¼Œæœ¬ä¾‹å¯ä»¥æŒ‡ä»£getK()æ–¹æ³• #27 = Utf8 sum_i //sum_iæ–¹æ³•çš„ç®€å•åç§°æ–‡æœ¬å€¼ #28 = Utf8 (II)I //æŸä¸ªå…¥å‚ä¸ºä¸¤ä¸ªintå‹ï¼Œè¿”å›ä¸€ä¸ªintå‹å€¼çš„æ–¹æ³•çš„æè¿°ç¬¦æ–‡æœ¬å€¼ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œå¯ä»¥ç”¨æ¥ä½œsum_iã€sumã€sum2çš„æè¿°ç¬¦ #29 = Utf8 a //è¿™ç§ä½äºå±€éƒ¨å˜é‡è¡¨çš„å˜é‡åï¼Œéƒ½æ˜¯åœ¨å¼€å¯è°ƒè¯•æ¨¡å¼æ—¶ï¼ˆjavac -gï¼‰ç¼–è¯‘çš„classæ–‡ä»¶æ‰æœ‰ï¼Œæ™®é€šjavacæ˜¯æ²¡æœ‰çš„ï¼Œä¸‹æ–¹bã€xã€yã€resultåŒç† #30 = Utf8 b #31 = Utf8 sum //sumæ–¹æ³•çš„ç®€å•åç§°æ–‡æœ¬å€¼ #32 = Utf8 x #33 = Utf8 y #34 = Utf8 sum2 //sum2æ–¹æ³•çš„ç®€å•åç§°æ–‡æœ¬å€¼ #35 = Utf8 result #36 = Utf8 &lt;clinit&gt; //ç±»åˆå§‹åŒ–æ–¹æ³•çš„ç®€å•åç§°ï¼Œå°±æ˜¯é™æ€å—ï¼Œé™æ€å—è¢«è®¤ä¸ºæ˜¯ç±»æœ¬èº«çš„\"æ„é€ å™¨\"ï¼Œå¦‚æœæ²¡æœ‰é™æ€å—ï¼Œé‚£ä¹ˆä¹Ÿä¸ä¼šæœ‰è¿™ä¸ªæ–¹æ³• #37 = Utf8 SourceFile #38 = Utf8 Test.java //æœ¬ç±»æºæ–‡ä»¶åç§° #39 = NameAndType #17:#18 //å·²ç»è¢«#1å’Œ#5çš„MethodRefå¼•ç”¨ï¼Œå…¶å€¼ä¸ºï¼š\"&lt;init&gt;\":()V #40 = Class #50 //ç±»é™å®šåï¼šjava/lang/Systemï¼Œè¢«#2å¼•ç”¨ #41 = NameAndType #51:#52 //è¢«#2å¼•ç”¨ï¼Œå…¶å€¼ä¸ºï¼šout:Ljava/io/PrintStream;å³ï¼šSystem.outè¿™ä¸ªå±æ€§çš„åç§°å’Œæè¿°ç¬¦ #42 = Utf8 Test init ! //Test()æ–¹æ³•é‡Œçš„å­—ç¬¦ä¸²æ–‡æœ¬å€¼ï¼Œè¢«#3å¼•ç”¨ #43 = Class #53 //ç±»é™å®šåï¼šjava/io/PrintStreamï¼Œè¢«#4å¼•ç”¨ #44 = NameAndType #54:#55 //è¢«#4å¼•ç”¨ï¼Œå…¶å€¼ä¸ºï¼šprintln:(Ljava/lang/String;)Vï¼Œå³ï¼šout.printlnè¿™ä¸ªæ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦ #45 = NameAndType #16:#12 //è¢«#6å¼•ç”¨ï¼Œå…¶å€¼ä¸ºï¼ši:Iï¼Œå³è¯¥å®ä¾‹ä¸­iè¿™ä¸ªæˆå‘˜å˜é‡çš„åç§°å’Œæè¿°ç¬¦ #46 = Utf8 sun/juwin/test/Test //ç±»å…¨é™å®šåçš„æ–‡æœ¬å€¼ï¼Œè¢«#7å¼•ç”¨ #47 = NameAndType #31:#28 //è¢«#8å¼•ç”¨ï¼Œå…¶å€¼ä¸ºï¼šsum:(II)Iï¼Œå³è¯¥å®ä¾‹ä¸­sumæ–¹æ³•çš„ç®€å•åç§°å’Œæè¿°ç¬¦ #48 = NameAndType #11:#12 //è¢«#9å¼•ç”¨ï¼Œå…¶å€¼ä¸ºï¼šj:Iï¼Œå³è¯¥å®ä¾‹ä¸­jè¿™ä¸ªç±»å˜é‡çš„åç§°å’Œæè¿°ç¬¦ #49 = Utf8 java/lang/Object //ç±»å…¨é™å®šåçš„æ–‡æœ¬å€¼ï¼Œè¢«#10å¼•ç”¨ #50 = Utf8 java/lang/System //ç±»å…¨é™å®šåæ–‡æœ¬å€¼ï¼Œè¢«#40å¼•ç”¨ #51 = Utf8 out //å±æ€§ç®€å•åç§°æ–‡æœ¬å€¼ï¼Œè¢«#41å¼•ç”¨ #52 = Utf8 Ljava/io/PrintStream; //å±æ€§çš„æè¿°ç¬¦æ–‡æœ¬å€¼ï¼Œè¢«#41å¼•ç”¨ #53 = Utf8 java/io/PrintStream //ç±»å…¨é™å®šåçš„æ–‡æœ¬å€¼ï¼Œè¢«#43å¼•ç”¨ #54 = Utf8 println //æ–¹æ³•ç®€å•åç§°æ–‡æœ¬å€¼ï¼Œè¢«#44å¼•ç”¨ #55 = Utf8 (Ljava/lang/String;)V //æ–¹æ³•æè¿°ç¬¦çš„æ–‡æœ¬å€¼ï¼Œè¢«#44å¼•ç”¨ 10.2.4ï¼šå­—èŠ‚ç -å­—æ®µè¡¨çœ‹å®Œäº†æœ€ä¸ºå¤æ‚çš„å¸¸é‡æ± ï¼Œä¸‹é¢æ¥çœ‹ä¸‹å­—æ®µè¡¨éƒ¨åˆ†ï¼Œè¿™éƒ¨åˆ†ç®€å•è®¸å¤šï¼š ä»£ç å—6 å­—æ®µè¡¨123456789101112public static final int j; //ç±»å˜é‡j descriptor: I //æè¿°ç¬¦ï¼ŒæŒ‡å‘#12 flags: (0x0019) ACC_PUBLIC, ACC_STATIC, ACC_FINAL //å‚è€ƒ7.1,å°†åå…­è¿›åˆ¶çš„0x0019è½¬æˆäºŒè¿›åˆ¶åçœ‹çœ‹å“ªäº›bitä½æ˜¯1å“ªäº›å°±æ˜¯å®ƒçš„ä¿®é¥°ç¬¦ï¼Œæ˜¾ç„¶æ˜¯ACC_PUBLICã€ACC_STATICã€ACC_FINALpublic static final int k; //ç±»å˜é‡k descriptor: I flags: (0x0019) ACC_PUBLIC, ACC_STATIC, ACC_FINAL ConstantValue: int 5 //å‚è€ƒ9.1ï¼Œå¦‚æœä¸€ä¸ªstatic finalçš„å¸¸é‡æœ‰ç›´æ¥çš„åˆå§‹å€¼ï¼Œé‚£ä¹ˆå¿…å®šè·Ÿä¸€ä¸ªConstantValueçš„å±æ€§è¡¨private int i; //æˆå‘˜å˜é‡i descriptor: I flags: (0x0002) ACC_PRIVATE 10.2.5ï¼šå­—èŠ‚ç -æ–¹æ³•è¡¨ psï¼šæƒ³ç”¨æ›´åŠ ç®€æ´çš„æ–¹å¼çœ‹æ–¹æ³•æŒ‡ä»¤çš„è¯ï¼Œå»ºè®®ä½¿ç”¨javap -cã€‚æœ¬èŠ‚åªæŒ‘é€‰ä»£ç å—2å®ä¾‹ä¸­çš„å‡ ä¸ªå…·æœ‰ä»£è¡¨æ€§çš„æ–¹æ³•æ¥è¯´æ˜ã€‚ ä¸‹é¢å°±æ˜¯æˆ‘ä»¬çš„æ–¹æ³•è¡¨äº†ï¼Œå†…éƒ¨ä¼šåŒ…å«Codeè¿™ä¸ªæ¶µç›–æ–¹æ³•ä¸»è¦é€»è¾‘çš„æŒ‡ä»¤ç ï¼Œæˆ‘ä»¬è¿™èŠ‚ä¼šä¸€ç‚¹ç‚¹åˆ†æè¿™äº›æŒ‡ä»¤æ˜¯å¦‚ä½•åœ¨æ“ä½œæ•°æ ˆé‡Œè¿è¡Œçš„ï¼ˆæ“ä½œæ•°æ ˆæ˜¯è¿è¡ŒæœŸè¦å­¦çš„ä¸€ä¸ªç»“æ„ï¼Œå…ˆåšä¸ªäº†è§£ï¼Œå®ƒä½äºæ ˆå¸§å†…ï¼Œä¸»è¦è´Ÿè´£æ‰§è¡ŒCodeæŒ‡ä»¤ç ï¼‰ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼šæ ˆæ˜¯ä¸€ç§å…ˆè¿›åå‡ºçš„æ•°æ®ç»“æ„ï¼Œæ—¢ç„¶æ“ä½œæ•°æ ˆæ˜¯æ ˆï¼Œé‚£ä¹ˆå¿…ç„¶æ»¡è¶³è¿™ä¸€ç‚¹ç‰¹æ€§ã€‚ 10.2.5.1ï¼šæ— å‚æ„é€ å™¨-Test()javapè¾“å‡ºçš„è¯¦ç»†ä¿¡æ¯ï¼š ä»£ç å—7 æ–¹æ³•è¡¨-Test()123456789101112131415161718public sun.juwin.test.Test(); //Testæ–¹æ³•ï¼ŒCodeåŒºåŸŸçš„æŒ‡ä»¤é›†æ˜¯å¦‚ä½•åœ¨æ“ä½œæ•°æ ˆè¿è¡Œçš„ï¼Ÿè¯·çœ‹å›¾27 descriptor: ()V //æ–¹æ³•æè¿°ç¬¦ï¼ŒæŒ‡å‘#18 flags: (0x0001) ACC_PUBLIC //å‚è€ƒ8.1 Code: stack=2, locals=1, args_size=1 //ä¾æ¬¡ä¸ºï¼šæœ€å¤§æ ˆæ·±ã€é€»è¾‘Slotæ•°é‡ï¼ˆå®é™…ä¸Šå¯èƒ½å°‘äºè¿™ä¸ªï¼Œå› ä¸ºSlotå¯å¤ç”¨ï¼‰ã€å‚æ•°sizeï¼Œæˆå‘˜æ–¹æ³•é»˜è®¤ä¼ å…¥thisï¼Œæ‰€ä»¥å³ä¾¿Test()é‡Œæ²¡æœ‰å‚æ•°ï¼Œè¿™é‡Œargs_sizeä¹Ÿæ˜¯1 0: aload_0 //å–this 1: invokespecial #1 //è°ƒç”¨æ–¹æ³•ï¼šjava/lang/Object.\"&lt;init&gt;\":()V 4: getstatic #2 //è·å–ç±»å±æ€§ï¼šjava/lang/System.out:Ljava/io/PrintStream; 7: ldc #3 //ldcæ˜¯æŒ‡ä»å¸¸é‡æ± ä¸­å–å€¼ï¼Œæ”¾å…¥æ“ä½œæ•°æ ˆï¼Œå€¼ä¸ºï¼šTest init ! 9: invokevirtual #4 //è°ƒç”¨æ–¹æ³•ï¼šjava/io/PrintStream.println:(Ljava/lang/String;)V 12: return //è¿”å›æŒ‡ä»¤ï¼Œç”¨äºç»ˆæ­¢ç¨‹åº LineNumberTable: line 15: 0 //æºä»£ç 15è¡Œå¯¹åº”æŒ‡ä»¤ç ç¬¬0è¡Œï¼Œå‰©ä¸‹çš„ç±»æ¨å³å¯ï¼ˆè¿™é‡Œæºä»£ç ä»¥ä»£ç å—2ä¸ºå‡†ï¼‰ line 16: 4 line 17: 12 LocalVariableTable: Start Length Slot Name Signature //è¿™é‡Œåªæœ‰ä¸€ä¸ªSlotï¼Œå®ƒçš„ä¸‹æ ‡ä¸º0 0 13 0 this Lsun/juwin/test/Test; å…ˆæ¥çœ‹ä¸‹å…¶æºä»£ç ï¼š ä»£ç å—81234public Test() { //éšå¼ä¼ å…¥thisä½œå‚æ•° super(); //éšå¼è°ƒäº†çˆ¶ç±»æ„é€ å™¨ System.out.println(\"Test init !\"); //è¾“å‡ºä¸€æ®µè¯} å®ƒå¯¹åº”çš„æŒ‡ä»¤ç å‚è€ƒä»£ç å—7-Codeéƒ¨åˆ† å½“ä¸€ä¸ªçº¿ç¨‹è¿è¡Œåˆ°æ­¤æ–¹æ³•ï¼Œä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªæ ˆå¸§ã€‚ æ ˆå¸§çš„åŸºæœ¬æ¦‚å¿µ æ ˆå¸§æ˜¯ç”¨äºæ”¯æŒjvmè¿›è¡Œæ–¹æ³•è°ƒç”¨å’Œæ–¹æ³•æ‰§è¡Œçš„æ•°æ®ç»“æ„ï¼Œå®ƒæ˜¯è¿è¡ŒæœŸä¿å­˜åœ¨è™šæ‹Ÿæœºæ ˆä¸­çš„æ ˆå…ƒç´ ï¼Œæ˜¯çº¿ç¨‹è¿è¡Œçš„åŸºæœ¬å•å…ƒï¼Œç”±æ‰§è¡Œå¼•æ“è§¦å‘æ‰§è¡Œå…¶å†…éƒ¨ä¿å­˜çš„å­—èŠ‚ç æŒ‡ä»¤ï¼ˆè¿™é‡Œæ‰§è¡Œå¼•æ“åœ¨æ‰§è¡Œä»£ç æ—¶è¿˜åˆ†ä¸ºè§£é‡Šæ‰§è¡Œå’Œç¼–è¯‘æ‰§è¡Œï¼‰ã€‚æ ˆå¸§ç”±å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€è¿æ¥ã€æ–¹æ³•è¿”å›åœ°å€ã€é™„åŠ ä¿¡æ¯ç»„æˆ Test()æ–¹æ³•æ ˆå¸§ç»“æ„å¦‚å›¾ï¼š ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•åœ¨è¿è¡Œæ—¶ï¼Œæ ˆå¸§å†…éƒ¨æ˜¯å¦‚ä½•å˜åŒ–çš„ï¼š æ ˆå¸§åˆå§‹çŠ¶æ€ï¼šå…¥å‚é¦–å…ˆå¡«å……è¿›å±€éƒ¨å˜é‡è¡¨ è§£é‡Šï¼šé¦–å…ˆTestæ–¹æ³•æ˜¯ä¸€ä¸ªéé™æ€æ–¹æ³•ï¼Œå…¶æ–¹æ³•ç¬¬ä¸€ä¸ªå…¥å‚å°±æ˜¯thisè¿™ä¸ªreferenceç±»å‹çš„å˜é‡ï¼Œå› æ­¤aload_0å°±æ˜¯å°†è¯¥å˜é‡æ¨å‘æ“ä½œæ•°æ ˆçš„æ ˆé¡¶ã€‚ ç¬¬ä¸€æ­¥ï¼šaload_0ï¼Œä»£è¡¨å°†å±€éƒ¨å˜é‡è¡¨å†…ç¬¬0ä¸ªSlotå†…ä¿å­˜çš„å˜é‡å…¥æ ˆ ç¬¬äºŒæ­¥ï¼šinvokespecialï¼Œä»£è¡¨ä¸€æ¬¡æ„é€ æ–¹æ³•çš„è°ƒç”¨ï¼Œæ ¹æ®ä»£ç å—7å¯çŸ¥è¿™é‡Œè°ƒç”¨çš„æ˜¯å…¶çˆ¶ç±»çš„æ„é€ æ–¹æ³• éšç€Objectæ„é€ æ–¹æ³•è§¦å‘ï¼Œéšä¹‹åˆäº§ç”Ÿäº†ä¸€ä¸ªObjectæ„é€ å™¨çš„æ ˆå¸§ï¼Œç”¨æ¥æ‰§è¡Œçˆ¶ç±»æ„é€ å™¨é€»è¾‘ï¼Œä¼ å…¥çš„æ˜¯å­ç±»å¯¹è±¡æŒ‡é’ˆthisï¼Œè¿™ç‚¹è¦è®°ä½ã€‚ä¸ºäº†ä¼˜åŒ–å†…å­˜ï¼Œjvmå¼€å‘è€…ä»¬ç»å¸¸ä¼šå°†æ–°å¼€æ ˆå¸§çš„å±€éƒ¨å˜é‡è¡¨å’Œä¸Šä¸€æ ˆå¸§çš„æ“ä½œæ•°æ ˆå…±äº«ä¸€äº›æ•°æ®ï¼Œå…±äº«æ˜¯å®Œå…¨æŒ‰ç…§ä¸‹ä¸€æ ˆå¸§æ¥æ”¶çš„å‚æ•°ä¸ªæ•°æ¥çš„ï¼Œæ¯”å¦‚ä¸‹ä¸€æ ˆå¸§éœ€è¦5ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå½“å‰æ ˆå¸§æ“ä½œæ•°æ ˆä»æ ˆé¡¶å¼€å§‹å¾€ä¸‹æ•°5ä¸ªï¼Œå…¨éƒ¨ä¼šå…±äº«è¿›ä¸‹ä¸€æ ˆå¸§çš„å±€éƒ¨å˜é‡è¡¨é‡Œã€‚ è¿˜æœ‰ä¸€ç‚¹éœ€è¦è¯´æ˜ä¸€ä¸‹ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨ä¸€ä¸ªå¯¹è±¡çš„æ„é€ å™¨è¢«è§¦å‘æ—¶ï¼Œå®ƒçš„çˆ¶ç±»æ„é€ å™¨é¦–å…ˆä¼šè¢«è§¦å‘ï¼Œæ­¤æ—¶å¾ˆå¤šäººè®¤ä¸ºçˆ¶ç±»è·Ÿå­ç±»ä¸€æ ·ï¼Œè‚¯å®šä¹Ÿæ˜¯è¢«newäº†ä¸€æ¬¡ï¼Œå…¶å®ä¸ç„¶ï¼Œé›†åˆå›¾29å’Œå›¾30å¯çŸ¥ï¼Œåœ¨Testç±»çš„æ„é€ å™¨è¢«è§¦å‘ä¹‹å‰ï¼Œå°±å·²ç»å­˜åœ¨thisæŒ‡é’ˆäº†ï¼Œé‚£æ„å‘³ç€ç±»å¯¹è±¡å·²ç»äº§ç”Ÿäº†ï¼Œå› æ­¤æ„é€ å™¨æ˜¯åœ¨å¯¹è±¡äº§ç”Ÿåä¸»åŠ¨è§¦å‘çš„ï¼Œè€Œçˆ¶ç±»ä¹Ÿæ²¡æœ‰è¢«newï¼Œä»…ä»…æ˜¯è§¦å‘äº†ä¸€ä¸‹å®ƒçš„æ„é€ å™¨è€Œå·²ï¼Œä½ å¯ä»¥ç†è§£ï¼Œä¸€ä¸ªå­ç±»å¯¹è±¡ï¼Œå…¶å®å°±æ˜¯åŒ…å«äº†å…¶çˆ¶ç±»å…¬å…±æ–¹æ³•çš„ç±»ï¼Œä¸å­˜åœ¨å¯¹è±¡åµŒå¥—çš„æƒ…å†µï¼ˆå³ä¸€ä¸ªå­ç±»çš„å¯¹è±¡æ˜¯ä¸ä¼šåŒ…å«ä¸€ä¸ªçˆ¶ç±»å¯¹è±¡çš„ï¼‰ï¼Œè¿™ä¸ªåœ¨ç¬¬å…­èŠ‚ä¼šè¯¦ç»†è®²ï¼Œæœ¬èŠ‚åšä¸ªé¢„çƒ­å³å¯ã€‚ æœ€åéšç€æ–°å¼€æ ˆå¸§è¿è¡Œç»“æŸï¼Œçº¿ç¨‹åˆä¼šå†æ¬¡å›åˆ°å½“å‰æ ˆå¸§ï¼Œå¹¶å°†å½“å‰æ ˆå¸§å†…çš„æ“ä½œæ•°æ ˆå…±äº«éƒ¨åˆ†æ¸…ç©ºï¼Œè‹¥ä¸‹ä¸€æ ˆå¸§æœ‰è¿”å›å€¼ï¼Œåˆ™å°†è¯¥å€¼å­˜å…¥å½“å‰æ ˆå¸§çš„æ ˆé¡¶ï¼Œå¦åˆ™ä¸è¿›è¡Œå…¶ä»–æ“ä½œã€‚è¯´åˆ°è¿™é‡Œä¹ŸçŸ¥é“ä¸ºä»€ä¹ˆæ ˆå¸§ä¹Ÿæ˜¯æ ˆäº†ï¼Œå…ˆè¿›å…¥çš„æ ˆå¸§æœ€åæ‰ä¼šæ‰§è¡Œå®Œï¼Œè¶Šæ˜¯æ–°å¼€çš„æ ˆå¸§è¶Šå…ˆç»“æŸï¼Œè¿™ä¼¼ä¹ä¹Ÿæ˜¯æ ˆçš„ç‰¹æ€§ã€‚ ç¬¬ä¸‰æ­¥ï¼šgetstaticï¼Œç”¨æ¥è·å–æŸä¸ªç±»çš„é™æ€å±æ€§ï¼Œç”±ä»£ç å—7å¯çŸ¥ï¼Œè¿™é‡Œæ˜¯ä»ç±»å¸¸é‡æ± é‡Œè·å–åˆ°çš„PrintStreamç±»å‹çš„Systemç±»çš„outé™æ€å±æ€§ï¼Œå³System.outã€‚ æç¤ºï¼šgetstaticçš„æ‰§è¡Œæµç¨‹åº”ä¸ºï¼šä»å¸¸é‡æ± è·å–å¸¸é‡çš„æè¿°ç¬¦ï¼Œç„¶åæ ¹æ®æè¿°ç¬¦é‡ŒæŒ‡ç¤ºçš„ç±»å’Œå±æ€§åï¼Œå»å¯¹åº”çš„ç±»é‡Œæ‹¿åˆ°è¯¥å±æ€§çš„å€¼ã€‚ ç¬¬å››æ­¥ï¼šldcï¼Œç”±ä»£ç å—7å¯çŸ¥ï¼Œè¿™æ˜¯ä»å¸¸é‡æ± é‡ŒåŠ è½½Stringç±»å‹å­—é¢é‡â€œTest init !â€å…¥æ ˆ ç¬¬äº”æ­¥ï¼šinvokevirtualï¼Œä»£è¡¨äº†ä¸€æ¬¡è™šæ–¹æ³•çš„è°ƒç”¨ï¼Œæœ¬ä¾‹æŒ‡çš„æ˜¯å¯¹outå¯¹è±¡çš„printlnæ–¹æ³•çš„è°ƒç”¨ ç»“åˆä¸Šå›¾æ¥æ€è€ƒä¸‹printlnçš„ä¸¤ä¸ªå‚æ•°ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æ˜ç¡®ä¸€ç‚¹ï¼Œprintlnä¸æ˜¯é™æ€æ–¹æ³•ï¼Œå› æ­¤å®ƒä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸€å®šæ˜¯â€œthisâ€ï¼Œå³å¯¹è±¡å¼•ç”¨ï¼Œå…¶å®ä»»ä½•éé™æ€æ–¹æ³•çš„è®¿é—®éƒ½æ˜¯å¦‚æ­¤ï¼Œéœ€è¦çŸ¥é“è‡ªå·±çš„å¯¹è±¡æ˜¯å“ªä½ï¼Œå¦åˆ™æ²¡æ„ä¹‰ï¼Œé‚£ä¹ˆé’ˆå¯¹printlnè¿™ä¸ªæ–¹æ³•çš„â€œthisâ€ï¼Œåˆæ˜¯è°å‘¢ï¼Ÿç­”æ¡ˆæ˜¯outï¼Œæˆ‘ä»¬æ˜¯ç”¨outå¯¹è±¡è°ƒç”¨çš„å®ƒï¼Œæ‰€ä»¥è¿™é‡Œç¬¬ä¸€ä¸ªå…¥å‚ä¸€å®šæ˜¯outå¯¹è±¡ï¼Œç¬¬äºŒä¸ªå…¥å‚åˆ™æ˜¯â€œTest init !â€ï¼Œæ‰€ä»¥ä¸Šå›¾ä¸­å…±äº«ç»™ä¸‹æ¸¸æ ˆå¸§çš„ä¸€å…±æœ‰ä¿©ï¼Œå·²ç”¨çº¢æ¡†æ ‡å‡ºã€‚ ç¬¬å…­æ­¥ï¼šreturnï¼Œæ–¹æ³•æ‰§è¡Œç»“æŸï¼Œæ ˆå¸§å‡ºè®©ï¼Œå°±ä¸ç”»å›¾äº†ã€‚ åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†ä¸€ç»„æŒ‡ä»¤ç çš„æ‰§è¡Œè¿‡ç¨‹è§£æã€‚ 10.2.5.2ï¼šsum_i(int a, int b)å†æ¥åˆ†æä¸€ä¸ªæ–¹æ³•çš„æ‰§è¡Œæµç¨‹ï¼Œæˆ‘ä»¬æŠŠjavapçš„ä¿¡æ¯ä¸¢å‡ºæ¥ï¼ˆè¿™é‡Œå°±ä¸åŠ æ³¨é‡Šäº†ï¼‰ï¼š ä»£ç å—91234567891011121314151617181920public int sum_i(int, int); descriptor: (II)I flags: (0x0001) ACC_PUBLIC Code: stack=4, locals=3, args_size=3 0: aload_0 1: getfield #6 // Field i:I 4: aload_0 5: iload_1 6: iload_2 7: invokevirtual #8 // Method sum:(II)I 10: iadd 11: ireturn LineNumberTable: line 29: 0 LocalVariableTable: Start Length Slot Name Signature 0 12 0 this Lsun/juwin/test/Test; 0 12 1 a I 0 12 2 b I å®ƒçš„æºä»£ç å¦‚ä¸‹ï¼š ä»£ç å—10123public int sum_i(int a, int b) { return i + sum(a, b);} å®ƒæœ‰3ä¸ªå‚æ•°ï¼Œè¿˜å‘ç”Ÿè¿‡ä¸€æ¬¡æ–¹æ³•è°ƒç”¨ï¼Œæœ€åè¿˜è¦å°†æ–¹æ³•è¿”å›çš„å€¼å†åŠ ä¸Šiå±æ€§ï¼Œç„¶åå°†ç»“æœè¿”å›å‡ºå»ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸ªæ–¹æ³•çš„è¿è¡Œè¿‡ç¨‹ã€‚ è€æ ·å­ï¼Œæ¥çœ‹ä¸‹æ ˆå¸§åˆå§‹çŠ¶æ€ï¼šå…¥å‚é¦–å…ˆå¡«å……è¿›å±€éƒ¨å˜é‡è¡¨ è¿™æ˜¯ä¸ªéé™æ€æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¾ç„¶æ˜¯è¯¥æ–¹æ³•å¯¹åº”ç±»çš„æŸä¸ªå¯¹è±¡çš„å¼•ç”¨æŒ‡é’ˆï¼ˆå³thisï¼‰ï¼Œå‰©ä¸‹ä¸¤ä¸ªå‚æ•°å°±æ˜¯æºä»£ç é‡Œçš„aå’Œbã€‚ ç¬¬ä¸€æ­¥ï¼šaload_0ï¼Œä»£è¡¨å°†å±€éƒ¨å˜é‡è¡¨å†…ç¬¬0ä¸ªSlotå†…ä¿å­˜çš„å˜é‡å…¥æ ˆï¼Œå³thiså…¥æ ˆï¼Œå› ä¸ºæ¥ä¸‹æ¥çš„getfieldæŒ‡ä»¤è¦ç”¨åˆ°ï¼Œè¿™è·Ÿéé™æ€æ–¹æ³•éœ€è¦thisçš„é“ç†ä¸€æ ·ï¼Œè·å–æŸä¸ªéé™æ€çš„å±æ€§ï¼Œä¹Ÿéœ€è¦çŸ¥é“æ˜¯å“ªä¸ªå¯¹è±¡ï¼Œæ‰èƒ½å–åˆ°å¯¹åº”çš„å€¼ï¼Œè¿™å°±æ˜¯éé™æ€å±æ€§å’Œæ–¹æ³•ä¸é™æ€å±æ€§æ–¹æ³•æœ€å¤§çš„åŒºåˆ«ã€‚ ç¬¬äºŒæ­¥ï¼šgetfieldï¼Œè¿™ä¸ªæŒ‡ä»¤ç”¨æ¥è·å–æŸå¯¹è±¡çš„æŸä¸ªå±æ€§å€¼ï¼Œæœ¬ä¾‹ä¸­ä¸ºi æç¤ºï¼šgetfieldæ‰§è¡Œæµç¨‹ï¼šä»å¸¸é‡æ± è·å–å±æ€§çš„æè¿°ç¬¦ï¼Œç„¶åæ ¹æ®æè¿°ç¬¦é‡ŒæŒ‡ç¤ºçš„ç±»å’Œå±æ€§åï¼Œå»å¯¹åº”çš„ç±»å¯¹è±¡é‡Œæ‹¿åˆ°è¯¥å±æ€§çš„å€¼ã€‚ï¼ˆå›¾ä¸­ç¬¬2æ­¥å°±æ˜¯åˆ©ç”¨å½“å‰æ ˆé¡¶çš„thisï¼Œæ¥æ‰“å…¥å…¶å†…éƒ¨ï¼Œå°†å…¶å¯¹åº”å±æ€§içš„å€¼å–å‡ºï¼Œå¹¶è®¾ç½®å…¥æ ˆé¡¶ï¼Œæ›¿æ¢æ‰åŸæ¥çš„thisï¼‰ ç¬¬ä¸‰æ­¥ï¼šaload_0ï¼Œå†æ¬¡å°†å±€éƒ¨å˜é‡è¡¨å†…ç¬¬0ä¸ªSlotå†…ä¿å­˜çš„å˜é‡å…¥æ ˆ ç¬¬å››æ­¥ï¼šå°†å…¥å‚aå’Œbå…¥æ ˆ ç¬¬äº”æ­¥ï¼šinvokevirtualï¼Œè™šæ–¹æ³•è°ƒç”¨ï¼Œæœ¬ä¾‹æŒ‡çš„æ˜¯å¯¹sumæ–¹æ³•çš„è°ƒç”¨ï¼Œé€šè¿‡å®ä¾‹ä»£ç å¯çŸ¥ï¼Œsumæ–¹æ³•æ‹¥æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œå³thisã€aã€bï¼Œå› æ­¤å¼€æ ˆå¸§æ—¶éœ€è¦å…±äº«å½“å‰æ ˆå¸§è‡ªæ ˆé¡¶å¾€ä¸‹æ•°3ä¸ªæ ˆä½ä½œä¸ºæ–°æ ˆå¸§çš„å…¥å‚ æ³¨æ„ï¼Œsumæ–¹æ³•æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œè¿”å›å€¼ä¸ºaå’Œbç›¸åŠ çš„ç»“æœï¼Œæœ€ç»ˆsumæ ˆå¸§æ‰§è¡Œå®Œæ¯•å†æ¬¡å›åˆ°sum_iæ ˆå¸§æ—¶ï¼Œä¼šå°†å…¶è¿”å›ç»“æœå…¥æ ˆï¼Œæœ€ç»ˆsumæ‰§è¡Œå®Œæ¯•åçš„æƒ…å†µå¦‚ä¸‹ï¼š ç¬¬å…­æ­¥ï¼šiaddï¼Œå°†æ ˆé¡¶ä¸¤intå‹æ•°å€¼ç›¸åŠ ï¼Œå¹¶ä¸”å…¶è¿ç®—ç»“æœå…¥æ ˆ ç¬¬ä¸ƒæ­¥ï¼šireturnï¼Œå°†ç°åœ¨ä½äºæ ˆé¡¶çš„æ•°æ®è¿”å›å‡ºå»ç»™ä¸Šæ¸¸çš„æ ˆå¸§ï¼Œå°±ä¸ç”»å›¾äº†ã€‚ åˆ°ç›®å‰ï¼Œsum_iæ–¹æ³•çš„æ‰§è¡Œæµç¨‹å°±å‰–æå®Œæ¯•ã€‚ åä¸€ã€å°ç»“æœ¬ç« ä»‹ç»äº†Classæ–‡ä»¶æœ¬èº«çš„ç»„æˆä»¥åŠå®ƒå†…éƒ¨æ•°æ®çš„å †å æ–¹å¼ï¼Œè¿˜ä»‹ç»äº†è¿è¡ŒæœŸæŒ‡ä»¤ç æ˜¯æ€ä¹ˆè¢«æ‰§è¡Œå¼•æ“æ‰€è¿è¡Œçš„ï¼Œå¯ä»¥å°è¯•åˆ©ç”¨è¿™äº›çŸ¥è¯†ï¼Œåˆ†ææ—¥å¸¸ä¸­è¾ƒä¸ºå¤æ‚çš„ç±»çš„å­—èŠ‚ç æ–‡ä»¶ï¼Œç†Ÿæ‚‰å­—èŠ‚ç æŒ‡ä»¤å¯¹äºæˆ‘ä»¬ç†è§£æ—¥å¸¸javaä»£ç çš„ä¸€äº›â€œç‰¹æ®Šæ€§è´¨â€æœ‰ä¸€å®šçš„ç§¯æä½œç”¨ã€‚","link":"/2020/05/06/JVM%E5%9F%BA%E7%A1%80%E5%9B%9E%E9%A1%BE%E8%AE%B0%E5%BD%95%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9A%E7%B1%BB%E6%96%87%E4%BB%B6/"},{"title":"LV5-6ï¼šjavaå¹¶å‘åŒ…-jucçš„ç®€å•ä»‹ç»","text":"ä¸€ã€çº¿ç¨‹æ± 1.1ï¼šç®€å•ä»‹ç»å‰é¢ç®€å•æäº†ä¸€å˜´çº¿ç¨‹æ± ï¼Œå›æƒ³ä¸‹æˆ‘ä»¬å‰å‡ èŠ‚å†…å®¹æåˆ°çš„çº¿ç¨‹åˆ›å»ºï¼š ä»£ç å—112Thread t1 = new Thread();t1.start(); //æ¯«æ— æ„ä¹‰çš„ä¸€ä¸ªçº¿ç¨‹è¢«åˆ›å»ºå¹¶è§¦å‘äº†ï¼Œè¿™ä¸ªçº¿ç¨‹ä¸ä¼šæ‰§è¡Œä»»ä½•é€»è¾‘ è¿™æ®µç®€å•çš„ä»£ç ï¼Œä¼šåœ¨è¿è¡Œçš„æ—¶å€™å‘æ“ä½œç³»ç»Ÿç”³è¯·å¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼Œå½“æˆ‘ä»¬åˆ©ç”¨è¿™ä¸ªçº¿ç¨‹æŠŠæˆ‘ä»¬çš„ä¸šåŠ¡ä»£ç è¿è¡Œå®Œï¼Œçº¿ç¨‹å°±ä¼šè¢«é”€æ¯ï¼Œå†æ¬¡ä¼šè®®ä¸€ä¸‹çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸé‚£å¼ å›¾ã€‚ ä½†æ˜¯çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå½“æˆ‘ä»¬çš„ç¨‹åºé‡Œå­˜åœ¨å¤§é‡å¼€å¯-å…³é—­çº¿ç¨‹è¿™ç§æ“ä½œæ—¶ï¼Œå¯¹äºç³»ç»Ÿæœ¬èº«æ˜¯ä¸€ç§æµªè´¹ï¼Œå…¶æ¬¡ï¼Œå¼€å¯çº¿ç¨‹æ˜¯æœ‰æ€§èƒ½å¼€é”€çš„ï¼Œæ‰€ä»¥æœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥è®©çº¿ç¨‹åˆ›å»ºä¹‹åï¼Œå°±ä¸å†æ­»äº¡ï¼Œè€Œæ˜¯ç”¨çš„æ—¶å€™ç›´æ¥å»ä¸€ä¸ªåœ°æ–¹æ‹¿ï¼Œç”¨å®Œäº†ä¹Ÿä¸å†é”€æ¯å®ƒï¼Œè€Œæ˜¯é‡æ–°æ”¾å›å»ï¼Œç­‰å¾…åˆ«çš„åœ°æ–¹ä½¿ç”¨å‘¢ï¼Ÿ çº¿ç¨‹æ± è¯ç”Ÿäº†ï¼ è·Ÿå®ƒçš„åå­—ä¸€æ ·ï¼Œå®ƒæ˜¯ä¸ªç”¨æ¥å­˜æ”¾çº¿ç¨‹å¯¹è±¡çš„æ± å­ï¼Œæœ€å¼€å§‹å°±ä¼šå¾€é‡Œé¢æ”¾ä¸€å®šé‡çš„çº¿ç¨‹ï¼Œåˆ«äººéœ€è¦ä½¿ç”¨çº¿ç¨‹çš„æ—¶å€™ï¼Œå®ƒä¾¿ä»æ± å­é‡Œå–åˆ°ä¸€ä¸ªé—²ç½®çš„çº¿ç¨‹ç”¨æ¥ç»™åˆ«äººä½¿ç”¨ï¼Œåˆ«äººç”¨å®Œäº†ï¼Œå°±å›æ”¶è¿™ä¸ªçº¿ç¨‹ï¼Œæ¥ä¸‹æ¥ç»™åˆ«äººç”¨ã€‚ 1.2ï¼šåˆå§‹åŒ–çº¿ç¨‹æ± ç®€å•è®°ä¸€ä¸‹ï¼Œæœ‰ä¸‹é¢ä¸‰ç§å¿«é€Ÿåˆå§‹åŒ–çº¿ç¨‹æ± å¯¹è±¡çš„æ–¹æ³•ï¼š Executors.newCachedThreadPool()ï¼šæ— é™çº¿ç¨‹æ± ã€‚ Executors.newFixedThreadPool(nThreads)ï¼šåˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ã€‚ Executors.newSingleThreadExecutor()ï¼šåˆ›å»ºå•ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚ æˆ‘ä»¬ç›®å‰ç”¨newCachedThreadPoolçš„æƒ…å†µæ¯”è¾ƒå¤šï¼Œå®ƒå¯ä»¥æ— é™åˆ›å»ºçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹è¢«åˆ›å»ºåéƒ½å¯ä»¥æ´»60sçš„æ—¶é—´ï¼ŒæœŸé—´å¯ä»¥è¢«åå¤ä½¿ç”¨ã€‚ ä¾‹å­ï¼š ä»£ç å—2123456789101112131415161718public class Test { //å…¨å±€å£°æ˜ä¸€ä¸ªçº¿ç¨‹æ±  private static ExecutorService threadPool = Executors.newCachedThreadPool(); public static void main(String[] args) { //ç›´æ¥å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥è¿è¡Œasyncæ–¹æ³• Thread t = new Thread(Test::async); t.start(); //ä½¿ç”¨çº¿ç¨‹æ± æä¾›çš„çº¿ç¨‹è¿è¡Œasyncæ–¹æ³• threadPool.execute(Test::async); //åˆ©ç”¨executeæ–¹æ³•è§¦å‘çº¿ç¨‹è¿è¡Œ } public static void async() { System.out.println(\"çº¿ç¨‹åä¸º\" + Thread.currentThread().getName() + \"æ­£åœ¨è¿è¡Œ...\"); }} äºŒã€ReentrantLock2.1ï¼šç®€ä»‹å‰é¢è®²äº†ä½¿ç”¨synchronizedåŒæ­¥å—æ¥è§£å†³å¤šçº¿ç¨‹ä¸‹æ“ä½œåŒä¸€å—èµ„æºçš„å®‰å…¨æ€§é—®é¢˜ï¼Œç°åœ¨ï¼Œæ¥è®¤è¯†jucä¸‹åŒæ ·å¯ä»¥å®ç°åŒæ­¥æ§åˆ¶çš„é”ï¼šReentrantLock ReentrantLockå®ç°äº†Lockæ¥å£ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œç›¸æ¯”synchronizedåªæ”¯æŒéå…¬å¹³é”çš„ç‰¹æ€§ï¼Œå®ƒæ”¯æŒçµæ´»é…ç½®é”ç«äº‰çš„å…¬å¹³å’Œéå…¬å¹³æ¨¡å¼ï¼Œä»€ä¹ˆæ˜¯é”ç«äº‰çš„å…¬å¹³ä¸éå…¬å¹³å‘¢ï¼Ÿæˆ‘ä»¬ç»§ç»­æ¥æ‹¿ä¹‹å‰çš„æµç¨‹å›¾ä¸¾ä¾‹ï¼š 2.2ï¼šç”¨æ³•ä»£ç å—31234567891011121314151617181920212223242526272829public class Word { //å…¨å±€å£°æ˜ä¸€ä¸ªé‡å…¥é”ä½œä¸ºæˆå‘˜å˜é‡ï¼Œè¿™æ ·ï¼Œä½¿ç”¨è¿™ä¸ªå˜é‡æ§åˆ¶çš„åŒæ­¥å—å°±è·ŸåŸå…ˆçš„å¯¹è±¡é”åŠŸèƒ½ç›¸åŒï¼Œåªåœ¨åŒä¸€ä¸ªå¯¹è±¡ä¸‹ç”Ÿæ•ˆ private ReentrantLock lock = new ReentrantLock(false); //å‚æ•°ä»£è¡¨å¯ç”¨å…¬å¹³æˆ–è€…éå…¬å¹³çš„é”ç«äº‰æ¨¡å¼ï¼Œæˆ‘ä»¬è¿™é‡Œè®¾ç½®ä¸ºéå…¬å¹³ //å£°æ˜ä¸ºstaticçš„æƒ…å†µä¸‹ï¼Œè·Ÿä¹‹å‰çš„ç±»é”ç›¸ä¼¼ï¼Œåªè¦å±äºè¿™ä¸ªç±»ï¼Œè¿™ä¸ªé”åˆ™å…¨ç”Ÿæ•ˆ private static ReentrantLock lockAll = new ReentrantLock(false); //å¯¹è±¡é”ï¼Œç›¸åŒå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®æ‰ä¼šç”Ÿæ•ˆ public void A() { lock.lock(); try { System.out.println(\"Aæ–¹æ³•è¢«è°ƒç”¨\"); } finally { lock.unlock(); //é‡Šæ”¾é”ï¼Œä¸ºäº†ä¿è¯é”é‡Šæ”¾ä¸€å®šä¼šè¢«æ‰§è¡Œï¼Œä¸€èˆ¬æ”¾åˆ°finallyå—é‡Œ } } //ç±»é”ï¼Œåªè¦æ˜¯Wordå¯¹è±¡ï¼Œè¢«å¤šä¸ªçº¿ç¨‹è®¿é—®æ—¶éƒ½ä¼šä¸Šé” public void B() { lockAll.lock(); try { System.out.println(\"Bæ–¹æ³•è¢«è°ƒç”¨\"); } finally { lock.unlock(); } } } 2.3ï¼šawaitã€signalã€signalAllåŒæ ·çš„ReentrantLockä¹Ÿæ”¯æŒçº¿ç¨‹é€šä¿¡ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ReentrantLockæ¥æ”¹å†™ä¸‹å‰é¢çš„é‚£ä¸ªé˜»å¡é˜Ÿåˆ—ï¼š ä»£ç å—41234567891011121314151617181920212223242526272829303132333435//é˜»å¡é˜Ÿåˆ—ç±»public class BlockQueue { private List&lt;String&gt; msgs = new LinkedList&lt;&gt;(); private ReentrantLock lock = new ReentrantLock(false); //ä¸åŒäºsynchronizedå¯ä»¥åˆ©ç”¨å¯¹è±¡é‡Œçš„waitå’Œnotifyï¼Œæƒ³è¦åˆ©ç”¨ReentrantLockå®ç°çº¿ç¨‹é€šä¿¡ï¼Œéœ€è¦ä½¿ç”¨lockå¯¹è±¡ç”Ÿæˆä¸€ä¸ªconditionå¯¹è±¡ private Condition condition = lock.newCondition(); public void put(String msg) { lock.lock(); //å°†synchronizedåŒæ­¥å—æ¢æˆlockçš„æ–¹å¼è¿›è¡Œ try { msgs.add(msg); //å­˜æ”¾è¿› condition.signalAll(); //æ•ˆæœç­‰äºnotifyAll } finally { lock.unlock(); } } public String get() { lock.lock(); try { if (msgs.size() == 0) { try { condition.await(); //æ•ˆæœç­‰äºwait } catch (InterruptedException e) { e.printStackTrace(); } } return msgs.remove(msgs.size() - 1); } finally { lock.unlock(); } }} è¿è¡Œæ•ˆæœè·Ÿä¹‹å‰æ˜¯ä¸€æ ·çš„ã€‚ ä¸‰ã€åˆ©ç”¨çº¿ç¨‹æ± çš„Futureæ¨¡å¼åšåˆ°è·Ÿjoinä¸€æ ·çš„æ•ˆæœè¿˜æ˜¯å‰é¢ä¼˜åŒ–å¤§é¦–é¡µçš„ä¾‹å­ï¼Œæˆ‘ä»¬ä¸åœ¨å°†Daoå±‚çš„ä»£ç åˆ—å‡ºæ¥ï¼Œæˆ‘ä»¬ä»…çœ‹serviceå±‚çš„å¼‚æ­¥å®ç°ï¼Œå¯¹æ¯”ä¸‹ä¸åŒï¼š ä»£ç å—5123456789101112131415161718192021222324// å¼‚æ­¥è·å–ï¼Œé€šè¿‡å¤šçº¿ç¨‹ä¼˜åŒ–æ€§èƒ½public WebModule getWebModuleMsgSimpleAsync() throws InterruptedException { WebModule webModule = new WebModule(); Thread topTask = new Thread(() -&gt; webModule.setTop(moduleDao.getTop())); Thread leftTask = new Thread(() -&gt; webModule.setLeft(moduleDao.getLeft())); Thread rightTask = new Thread(() -&gt; webModule.setRight(moduleDao.getRight())); Thread userTask = new Thread(() -&gt; webModule.setUser(moduleDao.getUser())); //è§¦å‘å„ä¸ªå¼‚æ­¥ä»»åŠ¡ topTask.start(); leftTask.start(); rightTask.start(); userTask.start(); //ç­‰å¾…æ‰€æœ‰çš„ä»»åŠ¡å‡æ‰§è¡Œå®Œæ¯• topTask.join(); leftTask.join(); rightTask.join(); userTask.join(); return webModule;} è¿™æ˜¯æˆ‘ä»¬ä½¿ç”¨æ™®é€šæ–¹å¼åˆ›å»ºçº¿ç¨‹ï¼Œç„¶åä½¿ç”¨joinæ¥å®Œæˆçš„å¼‚æ­¥ä»»åŠ¡è°ƒåº¦ï¼Œç»“åˆæœ€å¼€å§‹è¯´çš„æœ‰å…³çº¿ç¨‹æ± çš„ä¼˜ç‚¹æ¥çœ‹è¿™ä¸ªæµç¨‹ï¼Œä¼šå‘ç°æˆ‘ä»¬ä¸€ä¸‹å­å°±åˆ›å»ºäº†4ä¸ªçº¿ç¨‹ï¼Œè¿™æ˜¯æœ‰å¼€é”€çš„ï¼Œé‚£ä¹ˆçº¿ç¨‹æ± æ˜¯å¦ä¹Ÿèƒ½å®Œæˆç±»ä¼¼è¿™ç§æ“ä½œå‘¢ï¼Ÿ ä»£ç å—612345678910111213//çº¿ç¨‹æ± Futureæ¨¡å¼å®Œæˆå¼‚æ­¥æ“ä½œpublic WebModule getWebModuleMsgAsync() throws ExecutionException, InterruptedException { Future&lt;String&gt; top = threadPool.submit(moduleDao::getTop); Future&lt;String&gt; left = threadPool.submit(moduleDao::getLeft); Future&lt;String&gt; right = threadPool.submit(moduleDao::getRight); Future&lt;String&gt; user = threadPool.submit(moduleDao::getUser); WebModule webModule = new WebModule(); webModule.setTop(top.get()); webModule.setLeft(left.get()); webModule.setRight(right.get()); webModule.setUser(user.get()); return webModule;} ä¸Šé¢çš„ä»£ç å°±æ˜¯æˆ‘ä»¬åˆ©ç”¨çº¿ç¨‹æ± æ”¹é€ åçš„ä»£ç å—5ï¼Œå®ƒçš„è¿è¡Œæ•ˆæœæ˜¯å’Œä»£ç å—5ä¸€è‡´çš„ã€‚ å››ã€å¼‚æ­¥ä»»åŠ¡ç¼–æ’ï¼šCompletableFutureæœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ‹¿åˆ°æŸä¸ªæ–¹æ³•çš„ç»“æœåå†å»æ‹¿ç€è¿™ä¸ªç»“æœå»è°ƒç”¨åˆ«çš„æ–¹æ³•ï¼Œè¿™æ—¶å°±ä¸èƒ½ç›²ç›®ä½¿ç”¨joinæˆ–è€…çº¿ç¨‹æ± æ¥åšå¼‚æ­¥ï¼Œjucæä¾›äº†æ›´é«˜çº§çš„ç±»ï¼šCompletableFuture è¯¦ç»†ç”¨æ³•è¯·æŸ¥çœ‹é™„ä»¶ï¼šåˆ©ç”¨CompletableFutureä¼˜åŒ–ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡","link":"/2020/04/02/LV5-6%EF%BC%9Ajava%E5%B9%B6%E5%8F%91%E5%8C%85-juc%E7%9A%84%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/"},{"title":"LV5-5ï¼šçº¿ç¨‹è°ƒåº¦ï¼šjoinã€yieldã€sleepã€interrupt","text":"ä¸€ã€ç®€ä»‹è¿™äº›æ–¹æ³•å±äºçº¿ç¨‹å¯¹è±¡é‡Œçš„æ–¹æ³•ï¼Œå±äºçº¿ç¨‹æœ¬èº«çš„æ“ä½œã€‚ joinï¼šç”¨äºç­‰å¾…ä¸€ä¸ªçº¿ç¨‹çš„ç»ˆæ­¢ï¼Œç­‰å¾…æœŸé—´å°†ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°è¢«ç­‰å¾…çš„çº¿ç¨‹ç»ˆæ­¢ç»“æŸã€‚ yieldï¼šç”¨äºçº¿ç¨‹è®©æ­¥ï¼Œè§¦å‘äº†æ­¤æ–¹æ³•çš„çº¿ç¨‹ä¼šè¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šè®©å‡ºCPUçš„è°ƒåº¦ä¸€ä¸‹ï¼Œè®©CPUè½¬å»å…¶ä»–çº¿ç¨‹ã€‚ sleepï¼šå¼ºåˆ¶å½“å‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°ä¼‘çœ æœŸç»“æŸï¼Œæ‰ä¼šå†æ¬¡è¿›å…¥è¿è¡ŒçŠ¶æ€ã€‚ interruptï¼šç»ˆæ­¢å½“å‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ã€‚ äºŒã€ç”¨æ³•2.1ï¼šjoinå‰é¢è¯´è¿‡å®ƒç®€å•çš„ç”¨æ³•ï¼Œæ¥çœ‹ä¸ªä¾‹å­ï¼š ä»£ç å—1123456789101112131415161718192021222324252627282930313233public static void main(String[] args) throws Exception { System.out.println(\"mainçº¿ç¨‹å¼€å§‹è¿è¡Œ\"); Thread t1 = new Thread(() -&gt; { try { Thread.sleep(1000L); //è®©å½“å‰çº¿ç¨‹é˜»å¡1s System.out.println(\"çº¿ç¨‹1è¿è¡Œç»“æŸ\"); } catch (InterruptedException e) { e.printStackTrace(); } }); Thread t2 = new Thread(() -&gt; { try { Thread.sleep(5000L); //è®©å½“å‰çº¿ç¨‹é˜»å¡5s System.out.println(\"çº¿ç¨‹2è¿è¡Œç»“æŸ\"); } catch (InterruptedException e) { e.printStackTrace(); } }); //çº¿ç¨‹1å’Œ2å¯åŠ¨ t1.start(); t2.start(); //åˆ©ç”¨joinï¼Œå¯ä»¥è®©mainçº¿ç¨‹å¿…é¡»ç­‰åˆ°å®ƒä»¬ä¿©çº¿ç¨‹è¿è¡Œå®Œæ¯•åæ‰ä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œ t1.join(); t2.join(); System.out.println(\"mainçº¿ç¨‹è¿è¡Œç»“æŸ\"); } è¿è¡Œç»“æœï¼š æœ€ç»ˆè¿è¡Œç»“æœå‘Šè¯‰æˆ‘ä»¬ï¼Œç”±äºt1å’Œt2åœ¨mainçº¿ç¨‹é‡Œjoinï¼Œå› æ­¤mainçº¿ç¨‹åœ¨joinå¤„å¿…é¡»è¦ç­‰åˆ°t1å’Œt2éƒ½è¿è¡Œç»“æŸåæ‰ä¼šç»§ç»­å¾€ä¸‹è¿è¡Œã€‚ å®ƒçš„æµç¨‹åƒæ˜¯ä¸‹é¢è¿™æ ·ï¼š æ­¤æ—¶mainæ–¹æ³•æ€»è€—æ—¶çº¦ç­‰äº5sã€‚ åŸºäºè¿™ç§æµç¨‹ç†è§£ï¼Œæˆ‘ä»¬è®©t1å’Œt2è°ƒç”¨joinå‰ï¼Œè®©mainçº¿ç¨‹é˜»å¡6sï¼ˆè¶…è¿‡t1å’Œt2å¹¶å‘è¿è¡Œçš„æ€»è€—æ—¶ï¼‰ï¼Œæ­¤æ—¶joinä¾¿ä¸å†é˜»å¡mainçº¿ç¨‹äº†ï¼Œå› ä¸ºt1å’Œt2å·²ç»æ‰§è¡Œç»“æŸäº†ï¼š ç›¸æ¯”å›¾2ï¼Œmainçº¿ç¨‹é˜»å¡çš„æ—¶é—´ç”šè‡³è¿˜å¤šå‡ºäº†ä¸€æˆªï¼Œæ­¤æ—¶æ€»è¿è¡Œæ—¶é—´çº¦ä¸º6sã€‚ 2.2ï¼šã€å®ä¾‹ã€‘åˆ©ç”¨joinä¼˜åŒ–ä¸€ä¸ªå¤§é¦–é¡µæ¥å£çš„æ•ˆç‡å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªç½‘ç«™ï¼Œé¦–é¡µæœ‰é¡¶éƒ¨Bannerä½ã€å·¦è¾¹æ ã€å³è¾¹æ ã€ç”¨æˆ·ä¿¡æ¯å‡ å¤§æ¨¡å—éœ€è¦åŠ è½½ï¼Œç°åœ¨å‡ºä¸€ä¸ªæ¥å£ï¼Œè¦æ±‚åŒ…è£…å¹¶åå‡ºè¿™å‡ å¤§æ¨¡å—çš„å†…å®¹ã€‚ å…ˆæ¥æŠ½è±¡ä¸€ä¸ªé¦–é¡µæ¥å£å¯¹è±¡ï¼š ä»£ç å—21234567891011121314151617public class WebModule { private String top; //é¡¶éƒ¨Bannerä½ private String left; //å·¦è¾¹æ  private String right; //å³è¾¹æ  private String user; //ç”¨æˆ·ä¿¡æ¯ //...get...set... @Override public String toString() { return String.format(\"top: %s; left: %s; right: %s; user: %s\", top, left, right, user); }} å®šä¹‰æˆ‘ä»¬çš„daoå±‚ï¼Œæˆ‘ä»¬åˆ©ç”¨sleepæ¥æ¨¡æ‹Ÿå®é™…çš„æ–¹æ³•è€—æ—¶ï¼š ä»£ç å—3123456789101112131415161718192021222324252627282930313233343536373839public class ModuleDao { public String getTop() { // è¿™é‡Œå‡è®¾getTopéœ€è¦æ‰§è¡Œ200ms try { Thread.sleep(200L); } catch (InterruptedException e) { e.printStackTrace(); } return \"é¡¶éƒ¨bannerä½\"; } public String getLeft() { // è¿™é‡Œå‡è®¾getLeftéœ€è¦æ‰§è¡Œ50ms try { Thread.sleep(50L); } catch (InterruptedException e) { e.printStackTrace(); } return \"å·¦è¾¹æ \"; } public String getRight() { // è¿™é‡Œå‡è®¾getRightéœ€è¦æ‰§è¡Œ80ms try { Thread.sleep(80L); } catch (InterruptedException e) { e.printStackTrace(); } return \"å³è¾¹æ \"; } public String getUser() { // è¿™é‡Œå‡è®¾getUseréœ€è¦æ‰§è¡Œ100ms try { Thread.sleep(100L); } catch (InterruptedException e) { e.printStackTrace(); } return \"ç”¨æˆ·ä¿¡æ¯\"; } } æˆ‘ä»¬å†å®šä¹‰ä¸€ä¸ªserviceå±‚ï¼Œæä¾›ä¸¤ä¸ªæ–¹æ³•ï¼Œå®ƒä»¬çš„ç›®çš„éƒ½æ˜¯é€šè¿‡daoå±‚æä¾›çš„æ•°æ®ï¼Œå°è£…æˆWebModuleå¯¹è±¡è¿”å›ç»™ç½‘å…³å±‚ï¼ˆcontrollerå±‚ï¼‰ï¼š ä»£ç å—412345678910111213141516171819202122232425262728293031323334353637383940public class ModuleService { private ModuleDao moduleDao = new ModuleDao(); // åŒæ­¥è·å– public WebModule getWebModuleMsgSync() { WebModule webModule = new WebModule(); webModule.setTop(moduleDao.getTop()); webModule.setLeft(moduleDao.getLeft()); webModule.setRight(moduleDao.getRight()); webModule.setUser(moduleDao.getUser()); return webModule; } // åŒæ­¥è·å–ï¼Œé€šè¿‡å¤šçº¿ç¨‹ä¼˜åŒ–æ€§èƒ½ public WebModule getWebModuleMsgSimpleAsync() throws InterruptedException { WebModule webModule = new WebModule(); Thread topTask = new Thread(() -&gt; webModule.setTop(moduleDao.getTop())); Thread leftTask = new Thread(() -&gt; webModule.setLeft(moduleDao.getLeft())); Thread rightTask = new Thread(() -&gt; webModule.setRight(moduleDao.getRight())); Thread userTask = new Thread(() -&gt; webModule.setUser(moduleDao.getUser())); //è§¦å‘å„ä¸ªå¼‚æ­¥ä»»åŠ¡ topTask.start(); leftTask.start(); rightTask.start(); userTask.start(); //ç­‰å¾…æ‰€æœ‰çš„ä»»åŠ¡å‡æ‰§è¡Œå®Œæ¯• topTask.join(); leftTask.join(); rightTask.join(); userTask.join(); return webModule; } } æˆ‘ä»¬ç”¨controllerå±‚æ¥æµ‹è¯•ä¸‹ï¼š ä»£ç å—51234567891011121314151617181920212223242526//åªæ˜¯æ¨¡æ‹Ÿï¼Œå…¶å®ç½‘å…³å±‚åº”è¯¥æ˜¯servletæˆ–è€…spring bootçš„controllerï¼ˆåç»­ä¼šè®¤è¯†åˆ°ï¼‰public class ModuleController { private ModuleService moduleService = new ModuleService(); public WebModule getWebModuleMsgSync() { return moduleService.getWebModuleMsgSync(); } public WebModule getWebModuleMsgSimpleAsync() throws InterruptedException { return moduleService.getWebModuleMsgSimpleAsync(); } public static void main(String[] args) throws Exception { ModuleController moduleController = new ModuleController(); long start = System.currentTimeMillis(); //è·å–ç³»ç»Ÿå½“å‰æ—¶é—´æˆ³ï¼Œms moduleController.getWebModuleMsgSync(); //åŒæ­¥è·å–å„ä¸ªæ¨¡å—çš„æ–¹æ³• System.out.println(\"åŒæ­¥è·å–å„ä¸ªæ¨¡å—ï¼Œæ‰€éœ€æ—¶é—´ä¸ºï¼š\" + (System.currentTimeMillis() - start) + \"ms\"); long start2 = System.currentTimeMillis(); moduleController.getWebModuleMsgSimpleAsync(); //å¼‚æ­¥è·å–å„ä¸ªæ¨¡å—çš„æ–¹æ³• System.out.println(\"å¼‚æ­¥è·å–å„ä¸ªæ¨¡å—ï¼Œæ‰€éœ€æ—¶é—´ä¸ºï¼š\" + (System.currentTimeMillis() - start2) + \"ms\"); }} è¿è¡Œç»“æœå¦‚ä¸‹ï¼š ä»£ç å—612åŒæ­¥è·å–å„ä¸ªæ¨¡å—ï¼Œæ‰€éœ€æ—¶é—´ä¸ºï¼š442mså¼‚æ­¥è·å–å„ä¸ªæ¨¡å—ï¼Œæ‰€éœ€æ—¶é—´ä¸ºï¼š207ms æˆ‘ä»¬åˆ©ç”¨å¤šçº¿ç¨‹å¼‚æ­¥+joinçš„æ–¹å¼ï¼Œå°†ä»£ç æ€§èƒ½ä¼˜åŒ–äº†è¶³è¶³1å€å¤šã€‚ æˆ‘ä»¬å†ä½¿ç”¨æ‰§è¡Œæµç¨‹å›¾æ¥è¯´æ˜ä¸‹å®ƒä»¬çš„è¿è¡Œæµç¨‹ï¼š åŒæ­¥æ–¹æ³•getWebModuleMsgSyncçš„è¿è¡Œæµç¨‹ å¼‚æ­¥æ–¹æ³•getWebModuleMsgSimpleAsyncçš„è¿è¡Œæµç¨‹ è¯·ç»“åˆä»£ç å’Œæµç¨‹å›¾ï¼Œä»”ç»†ç†è§£ä¸‹joinã€‚æˆªæ­¢åˆ°ç›®å‰ï¼Œä½ å·²ç»ä¼šç”¨å¤šçº¿ç¨‹ä¼˜åŒ–ä¸€ä¸ªæ…¢æ¥å£äº†~ 2.3ï¼šsleepå°±ä¸æƒ³è¯´å•¥äº†ï¼Œæˆ‘ä»¬å‰é¢çš„ä¾‹å­åœ¨ä¸æ–­çš„ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œåªéœ€è¦çŸ¥é“ï¼Œä½ åœ¨ä»»ä½•åœ°æ–¹å†™ä¸ŠThread.sleep(xxx);è¿™æ®µä»£ç ï¼Œå°±æ˜¯åœ¨è®©è¿è¡Œè¯¥æ®µä»£ç çš„çº¿ç¨‹é˜»å¡ï¼ˆä¼‘çœ ï¼‰ã€‚ 2.4ï¼šinterrupt&amp;stopéƒ½ç”¨äºä¸»åŠ¨ç»ˆæ­¢ä¸€ä¸ªçº¿ç¨‹ï¼ŒåŒºåˆ«åœ¨äºï¼Œinterruptæ¯”è¾ƒæ¸©å’Œï¼Œstopå±äºæš´åŠ›å…³åœï¼Œæˆ‘ä»¬ä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥çœ‹ä¸‹å®ƒä»¬çš„åŒºåˆ«ã€‚ çº¿ç¨‹æœ¬èº«è°ƒç”¨è¿™ä¿©æ–¹æ³•åï¼Œè§†ä¸ºå·²ç»ˆæ­¢çŠ¶æ€ï¼Œä¸‹é¢æ¥ç”¨interruptå’Œjoinæ¥åšä¸ªå®éªŒï¼š ä»£ç å—7123456789101112131415161718192021222324252627282930313233343536373839404142434445public class JoinTest { private boolean isStop = false; public static void main(String[] args) throws Exception { JoinTest test = new JoinTest(); Thread loopT = new Thread(test::loopTask); //test::loopTaskç­‰äºtest.loopTask() loopT.start(); sleep(2000L); //2såç»ˆæ­¢çº¿ç¨‹ test.setStop(true); long s = System.currentTimeMillis(); loopT.join(); System.out.println(\"çº¿ç¨‹ç»ˆæ­¢åï¼Œjoiné˜»å¡æ—¶é—´ä¸ºï¼š\" + (System.currentTimeMillis() - s)); System.out.println(\"end~\"); } public void setStop(boolean stop) { isStop = stop; } public void loopTask() { while (!isStop) { //è‹¥çŠ¶æ€ä¸ºfalseï¼Œåˆ™ç»§ç»­æ‰§è¡Œä¸‹é¢çš„é€»è¾‘ï¼Œæ¯éš”1sæ‰“å°ä¸€æ¬¡ sleep(1000L); System.out.println(\"loop trigger ~\"); } Thread.currentThread().interrupt(); //åœ¨è¿™é‡Œç»ˆæ­¢æ‰å½“å‰çº¿ç¨‹ //äº‹å®ä¸Šï¼Œåœ¨ç»ˆæ­¢æ‰çº¿ç¨‹åï¼Œè¿˜æœ‰æ¥ä¸‹æ¥çš„é€»è¾‘è¦æ‰§è¡Œ long s = System.currentTimeMillis(); for (int i = 0; i &lt; 1000000; i++) { int[] a = new int[100]; //æ¨¡æ‹Ÿè€—æ—¶æ“ä½œï¼Œè¿™é‡Œä¸èƒ½ç”¨sleepäº†ï¼Œå› ä¸ºå½“å‰çº¿ç¨‹å·²ç»è¢«ç»ˆæ­¢äº† } System.out.println(\"çº¿ç¨‹ç»ˆæ­¢åï¼Œé€»è¾‘å—è¿è¡Œæ—¶é—´ï¼š\" + (System.currentTimeMillis() - s)); } public static void sleep(long time) { try { Thread.sleep(time); } catch (InterruptedException e) { e.printStackTrace(); } } } è¿è¡Œç»“æœå¦‚ä¸‹ï¼š ä»£ç å—812345loop trigger ~loop trigger ~çº¿ç¨‹ç»ˆæ­¢åï¼Œé€»è¾‘å—è¿è¡Œæ—¶é—´ï¼š98çº¿ç¨‹ç»ˆæ­¢åï¼Œjoiné˜»å¡æ—¶é—´ä¸ºï¼š114end~ é€šè¿‡interruptç»ˆæ­¢çº¿ç¨‹ï¼Œå³ä¾¿çº¿ç¨‹è¢«ç»ˆæ­¢äº†ï¼Œåé¢çš„é€»è¾‘ä¹Ÿä¼šè§¦å‘ï¼Œjoinä¾æ—§ä¼šé€‰æ‹©é˜»å¡ï¼Œç›´åˆ°åç»­é€»è¾‘æ‰§è¡Œå®Œæ¯•ï¼Œäº‹å®ä¸Šï¼Œå¤§éƒ¨åˆ†ä»»åŠ¡éƒ½å¯ä»¥åŠæ—¶çš„ç»ˆæ­¢ï¼Œæ¯”å¦‚ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œå¼‚æ­¥å‡ºå»çš„ä»»åŠ¡ï¼Œæœ€ç»ˆéƒ½ä¼šæ‰§è¡Œå®Œæˆï¼Œçº¿ç¨‹å˜ä¸ºç»ˆæ­¢çŠ¶æ€ï¼Œjoinéƒ½å¯ä»¥é¡ºåˆ©ç»“æŸï¼Œä½†æ˜¯åè§‚ä¸Šä¾‹ï¼Œå¦‚æœæ²¡äººåŠæ—¶çš„è®¾ç½®isStopçš„å€¼ï¼Œç¨‹åºä¼šä¸€ç›´æ‰§è¡Œä¸‹å»ï¼Œæ²¡æœ‰ç»ˆæ­¢æ€ï¼Œjoinä¼šæ— æ­¢å¢ƒçš„ç»ˆæ­¢ä¸‹å»ã€‚ è€Œstopï¼Œçº¿ç¨‹çš„stopæ–¹æ³•å·²è¢«å®˜æ–¹æ ‡è®°ä¸ºâ€œä¸å»ºè®®ä½¿ç”¨â€çš„æ–¹æ³•ï¼Œå¦‚æœæŠŠä¸Šä¾‹çš„interruptçš„è°ƒç”¨æ¢æˆstopï¼Œæ¥çœ‹çœ‹å…¶è¿è¡Œç»“æœï¼š ä»£ç å—91234loop trigger ~loop trigger ~çº¿ç¨‹ç»ˆæ­¢åï¼Œjoiné˜»å¡æ—¶é—´ä¸ºï¼š0end~ å¯ä»¥çœ‹åˆ°ï¼Œçº¿ç¨‹ç»ˆæ­¢åçš„åç»­é€»è¾‘å‡æ²¡æœ‰è§¦å‘ï¼Œå‰é¢è¯´è¿‡ï¼Œstopæ˜¯ä¸€ç§å¾ˆç²—æš´çš„ç»ˆæ­¢çº¿ç¨‹çš„æ–¹å¼ï¼Œä¸€æ—¦è¢«stopï¼Œé‚£ä¹ˆé‡Œé¢çš„ä¸šåŠ¡é€»è¾‘å°†ç›´æ¥æ–­æ‰ï¼Œå› æ­¤å®˜æ–¹å¹¶ä¸æ¨èä½¿ç”¨è¯¥æ–¹æ³•æ¥ç»ˆæ­¢çº¿ç¨‹ã€‚ è€Œinterruptï¼Œä»…ä»…æ˜¯å¯¹ç›®æ ‡çº¿ç¨‹å‘é€äº†äº†ä¸€ä¸ªä¸­æ–­ä¿¡å·ï¼ˆæ”¹å˜äº†çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€è€Œå·²ï¼‰ï¼Œå½“ç›®æ ‡çº¿ç¨‹å†æ¬¡é€šè¿‡obj.waitã€thread.sleepã€thread.joinæ–¹æ³•è¿›å…¥é˜»å¡çŠ¶æ€æ—¶ï¼Œæ¥æ”¶åˆ°è¯¥ä¿¡å·ï¼Œå°±ä¼šæŠ›å‡ºInterruptedExceptionå¼‚å¸¸ï¼Œè¿™æ—¶å€™éœ€è¦ä¸šåŠ¡æ–¹è‡ªè¡Œå¤„ç†æˆ–è€…ç›´æ¥æŠ›å‡ºï¼Œä»¥ç»“æŸçº¿ç¨‹é˜»å¡çŠ¶æ€ï¼ˆè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯è¢«obj.waitæ–¹æ³•é˜»å¡æ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸éœ€è¦ç›®æ ‡çº¿ç¨‹å†æ¬¡è·å¾—å®ä¾‹å¯¹è±¡objçš„é”æ‰è¡Œï¼‰ã€‚ ä¸Šè¿°ä¸‰ä¸ªâ€œéœ€è¦èŠ±è´¹æ—¶é—´â€çš„æ–¹æ³•å‡æŠ›å‡ºäº†InterruptedExceptionå¼‚å¸¸ï¼Œé’ˆå¯¹è¿™äº›ç‰¹æ€§ï¼Œæƒ³è¦å®Œæˆä»¥ä¸‹æ“ä½œå°±éå¸¸æ–¹ä¾¿äº†ï¼š å–æ¶ˆwaitæ–¹æ³•ç­‰å¾…notify/notifyAllçš„å¤„ç† å–æ¶ˆåœ¨sleepæ–¹æ³•æŒ‡å®šæ—¶é—´å†…åœæ­¢çš„å¤„ç† å–æ¶ˆjoinæ–¹æ³•ç­‰å¾…å…¶ä»–çº¿ç¨‹ç»ˆæ­¢çš„å¤„ç† å–æ¶ˆä¹‹åæ‰€åšçš„å¤„ç†ï¼Œå–å†³äºéœ€æ±‚ï¼Œå¯èƒ½ä¼šç»ˆæ­¢çº¿ç¨‹ï¼Œæˆ–è€…é€šçŸ¥ç”¨æˆ·å·²å–æ¶ˆï¼Œæˆ–è€…ç»ˆæ­¢å½“å‰å¤„ç†è¿›å…¥ä¸‹ä¸€ä¸ªå¤„ç†é˜¶æ®µã€‚ 2.5ï¼šyieldé€šè¿‡å‰é¢çš„ç†è§£ï¼Œæˆ‘ä»¬çŸ¥é“çº¿ç¨‹æ˜¯é CPUé€šè¿‡æ¥å›åˆ‡æ¢æ‰§è¡Œçš„æ–¹å¼æ¥æ‰§è¡Œå¤šä¸ªçº¿ç¨‹çš„ï¼Œé‚£ä¹ˆä½ çŸ¥é“ä½ çš„çº¿ç¨‹é€šè¿‡ä»£ç è°ƒç”¨startåï¼Œä¼šå‘ç”Ÿå“ªäº›çŠ¶æ€å˜åŒ–å—ï¼Ÿ é¦–å…ˆï¼Œstartè§¦å‘çº¿ç¨‹åï¼Œçº¿ç¨‹çŠ¶æ€è¿›å…¥è¿è¡ŒçŠ¶æ€ï¼Œè€Œæˆ‘ä»¬å‰é¢è®²è¿‡CPUæ˜¯æ¥å›åˆ‡æ¢è¿è¡Œçº¿ç¨‹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é’ˆå¯¹â€è¢«è°ƒåº¦åˆ°â€œå’Œâ€ç­‰å¾…è¢«è°ƒåº¦â€œä¸¤ç§æƒ…å†µåˆå¯¹è¿è¡ŒçŠ¶æ€åˆåšäº†ç»†åˆ†ï¼Œå³è¿è¡Œä¸­å’Œå°±ç»ªï¼š âš ï¸ è¯·åŠ¡å¿…ä»”ç»†è·Ÿç€å›¾ä¸­çš„åºå·é¡ºåºæ¢³ç†ä¸€éè¿™ä¸ªæµç¨‹ï¼Œå¯¹ä¹‹åçš„çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸç†è§£èµ·æ¥å¾ˆæœ‰å¸®åŠ© ä¸ºä»€ä¹ˆè¦è¯´è¿™ä¸ªå‘¢ï¼Ÿå› ä¸ºå®ƒå¯ä»¥å¸®ä½ ç†è§£yieldï¼Œyieldè¢«å½“å‰çº¿ç¨‹è§¦å‘åï¼Œé¦–å…ˆå½“å‰çº¿ç¨‹ä¼šç›´æ¥è¿›å…¥â€å°±ç»ªçŠ¶æ€â€œï¼Œä½ å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œå½“å‰çº¿ç¨‹åšå‡ºyieldè°ƒç”¨ä¹‹åï¼Œä¼šå°†æœ¬è¯¥è°ƒåº¦åˆ°å®ƒçš„CPUâ€è®©å‡ºå»â€œï¼Œè®©CPUé‡æ–°è°ƒåº¦ä¸€æ¬¡ï¼Œæ³¨æ„æˆ‘è¿™é‡Œè¯´çš„æ˜¯é‡æ–°è°ƒåº¦ä¸€æ¬¡ï¼Œæ‰€ä»¥å³ä¾¿è°ƒç”¨äº†yieldï¼Œä¸‹æ¬¡CPUä»ç„¶æœ‰æ¦‚ç‡è°ƒåº¦åˆ°å®ƒï¼Œæ¥çœ‹ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼š çœ‹åˆ°äº†å—ï¼Ÿä»»æ„çº¿ç¨‹åªè¦è‡ªè¡Œè§¦å‘è‡ªå·±çš„yieldæ–¹æ³•ï¼Œå°±ä¼šç«‹é©¬è®©è‡ªå·±å˜æˆå°±ç»ªæ€ï¼Œç„¶åè®©CPUé‡æ–°é€‰æ‹©çº¿ç¨‹è°ƒåº¦ï¼Œé‡æ–°è°ƒåº¦æ„å‘³ç€å¯èƒ½ä¼šè°ƒåº¦åˆ°å…¶å®ƒçº¿ç¨‹ï¼Œä¹Ÿå¯èƒ½å†æ¬¡è°ƒåº¦åˆ°è‡ªå·±ï¼Œå¦‚æœå†æ¬¡è°ƒåº¦åˆ°è‡ªå·±ï¼ˆå¦‚å›¾ä¸­çš„æƒ…å†µ2ï¼‰ï¼Œé‚£ä¹ˆå°±åªèƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œå’¯ï¼Œç­‰äºyieldæ— ç”¨ï¼Œå¦‚æœè°ƒåº¦åˆ°åˆ«äººï¼ˆå¦‚å›¾ä¸­çš„æƒ…å†µ1ï¼‰åˆ™yieldæœ‰æ„ä¹‰ï¼Œå› ä¸ºä½ ç¡®å®è®©å‡ºäº†CPUè®©åˆ«äººè¿›å…¥è¿è¡Œæ€äº†ã€‚ å°±ä¸ä¸¾ä¾‹å­äº†ï¼Œä½ ä¹Ÿçœ‹åˆ°äº†ï¼Œyieldçš„æ„ä¹‰æ˜¯è¿™æ ·çš„ï¼Œæœ¬å°±ä¸å¥½ä¸¾ä¾‹ï¼Œä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹ä¸€å®šè¦æ¢³ç†æ¸…æ¥šï¼Œè‡³å°‘ä½ è¦çŸ¥é“çº¿ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€çš„æ—¶å€™ï¼Œåˆæ ¹æ®CPUè°ƒåº¦çŠ¶æ€ç»†åˆ†äº†å°±ç»ªå’Œè¿è¡Œä¸­çŠ¶æ€ã€‚ ä¸‰ã€çº¿ç¨‹çŠ¶æ€è¿ç§»å›¾æˆªæ­¢ç›®å‰ï¼Œæˆ‘ä»¬çŸ¥é“ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•æ”¹å˜è‡ªå·±çš„è¿è¡ŒçŠ¶æ€ï¼š é€šè¿‡startè®©è‡ªå·±å˜æˆè¿è¡Œä¸­çŠ¶æ€ã€‚è€Œè¿è¡Œä¸­çŠ¶æ€åˆæ ¹æ®æœ‰æ²¡æœ‰è¢«CPUè°ƒåº¦åˆ°åˆ†æˆäº†å°±ç»ªæ€å’Œè¿è¡Œä¸­ä¸¤ä¸ªçŠ¶æ€ é€šè¿‡sleepè®©è‡ªå·±é™·å…¥é˜»å¡çŠ¶æ€ï¼Œé˜»å¡çŠ¶æ€æ„å‘³ç€CPUä¸ä¼šå†è°ƒåº¦åˆ°å®ƒï¼Œé™¤éå®ƒè§£é™¤é˜»å¡å˜ä¸ºå°±ç»ªçŠ¶æ€ é€šè¿‡è°ƒç”¨å…¶å®ƒçº¿ç¨‹çš„joinæ–¹æ³•è®©è‡ªå·±åœ¨å…¶å®ƒçº¿ç¨‹ç»“æŸå‰é™·å…¥é˜»å¡çŠ¶æ€ï¼Œå…¶å®ƒçº¿ç¨‹ç»“æŸåï¼Œè‡ªå·±å†æ¬¡ç”±é˜»å¡å˜ä¸ºå°±ç»ªçŠ¶æ€ é€šè¿‡æŸä¸ªå¯¹è±¡çš„waitæ–¹æ³•ï¼Œè®©è‡ªå·±å¤„äºé˜»å¡çŠ¶æ€ï¼Œç„¶åå†æ¬¡é€šè¿‡åŒä¸€å¯¹è±¡çš„notifyè§¦å‘ï¼Œè®©è‡ªå·±å˜æˆå°±ç»ªçŠ¶æ€ é€šè¿‡yieldè®©è‡ªå·±è®©å‡ºæ­£åœ¨è°ƒåº¦è‡ªå·±çš„CPUï¼Œè®©è‡ªå·±ç›´æ¥è¿›å…¥å°±ç»ªçŠ¶æ€ é€šè¿‡interruptæˆ–è€…stopè®©è‡ªå·±å˜æˆç»ˆæ­¢çŠ¶æ€ æˆ‘ä»¬ç»“åˆä¸Šé¢çš„å…­æ¡ä¿¡æ¯ï¼Œæ•´ç†ä¸‹ä¸€ä¸ªçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œåº”è¯¥åŒ…å«å“ªå‡ ä¸ªçŠ¶æ€ï¼š è¿è¡ŒçŠ¶æ€ï¼ˆåˆç»†åˆ†ä¸ºå°±ç»ªå’Œè¿è¡Œä¸­ä¸¤ä¸ªå°çŠ¶æ€ï¼‰ã€é˜»å¡çŠ¶æ€ã€ç»ˆæ­¢çŠ¶æ€ è®©æˆ‘ä»¬æ¥ç”»ä¸‹çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œæˆ–è€…å«çº¿ç¨‹çŠ¶æ€è½¬æ¢å›¾ï¼š","link":"/2020/04/02/LV5-5%EF%BC%9A%E7%BA%BF%E7%A8%8B%E8%B0%83%E5%BA%A6%EF%BC%9Ajoin%E3%80%81yield%E3%80%81sleep%E3%80%81interrupt/"},{"title":"LV5-4ï¼šçº¿ç¨‹é€šä¿¡ï¼šwaitã€notifyã€notifyall","text":"ä¸€ã€Objectç±»é‡Œå¯¹çº¿ç¨‹å®æ–½æ§åˆ¶çš„æ–¹æ³•å‰é¢è¯´è¿‡ï¼ŒObjectæ˜¯æ‰€æœ‰ç±»çš„çˆ¶ç±»ï¼Œå®ƒè‡ªå¸¦equalsã€hashCodeç­‰æ–¹æ³•ï¼Œæˆ‘ä»¬è¿™æ¬¡æ¥ä»‹ç»å‡ ä¸ªæ–°çš„æˆå‘˜æ–¹æ³•ï¼š è¿™èŠ‚è¦è®²çš„waitã€notifyã€notifyalléƒ½æ˜¯Objecté‡Œè‡ªå¸¦çš„æ–¹æ³•ï¼Œé€šè¿‡è¿™äº›æ–¹æ³•å¯ä»¥æ§åˆ¶å½“å‰æ­£åœ¨è¿è¡Œè¿™ä¸ªå¯¹è±¡çš„çº¿ç¨‹ï¼Œå¦‚ä½•æ§åˆ¶ï¼Ÿå¾€ä¸‹çœ‹~ äºŒã€åˆ©ç”¨çº¿ç¨‹æ§åˆ¶æ–¹æ³•å®Œæˆçº¿ç¨‹é€šä¿¡ä¸Šè¿°å‡ ä¸ªæ–¹æ³•æ˜¯å±äºæ¯ä¸ªå®ä¾‹å¯¹è±¡çš„ï¼Œæ‰€æœ‰å®ä¾‹éƒ½æ‹¥æœ‰ä¸€ä¸ªâ€œç­‰å¾…é˜Ÿåˆ—â€ï¼ˆè™šæ‹Ÿæ¦‚å¿µï¼Œå®ä¾‹é‡Œå¹¶ä¸å­˜åœ¨è¯¥å­—æ®µï¼‰ï¼Œå®ƒæ˜¯åœ¨å®ä¾‹çš„waitæ–¹æ³•è°ƒç”¨åå­˜æ”¾åœæ­¢æ“ä½œçº¿ç¨‹çš„é˜Ÿåˆ—ã€‚æ‰§è¡Œwaitæ–¹æ³•åï¼Œçº¿ç¨‹è¿›å…¥å½“å‰å®ä¾‹çš„â€œç­‰å¾…é˜Ÿåˆ—â€ï¼Œä»¥ä¸‹å‡ ç§æƒ…å†µå¯ä»¥è®©çº¿ç¨‹é€€å‡ºâ€œç­‰å¾…é˜Ÿåˆ—â€ï¼š å…¶ä»–çº¿ç¨‹è°ƒç”¨notifyã€notifyAllæ–¹æ³•æ¥å°†å…¶å”¤é†’ å…¶ä»–çº¿ç¨‹è°ƒç”¨interruptæ¥å°†å…¶å”¤é†’ waitæ–¹æ³•æœ¬èº«è¶…æ—¶ 2.1ï¼šwaitå½“æ‰§è¡Œäº†ä¸‹é¢çš„ä»£ç ï¼š ä»£ç å—11obj.wait(); æˆ‘ä»¬å¯ä»¥è¯´å½“å‰çº¿ç¨‹åœ¨objä¸Šå‘ç”Ÿäº†ç­‰å¾…ï¼Œå½“å‰çº¿ç¨‹è¿›å…¥äº†objçš„â€œç­‰å¾…é˜Ÿåˆ—â€ï¼Œæ­¤æ—¶å½“å‰çº¿ç¨‹ä¼šè®©å‡ºé”ï¼Œè®©å…¶ä»–çº¿ç¨‹ç»§ç»­ç«äº‰è·å¾—è¯¥å®ä¾‹çš„é”ï¼ˆå› æ­¤è¿™é‡Œæœ‰ä¸ªè§„åˆ™ï¼Œè°ƒç”¨waitçš„çº¿ç¨‹å¿…é¡»æŒæœ‰å½“å‰å®ä¾‹å¯¹è±¡çš„é”ï¼‰ âš ï¸ æ™®é€šä¸åŠ synchronizedçš„æ–¹æ³•ä¹Ÿå¯ä»¥ä½¿ç”¨waitï¼Œè¿™åœ¨ç¼–è¯‘å™¨æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯è¿è¡ŒæœŸä¼šæŠ¥IllegalMonitorStateExceptionå¼‚å¸¸ã€‚ è¿˜æ˜¯ä»¥å‰é¢æè¿‡çš„Wordå¯¹è±¡ä¸ºä¾‹ï¼Œä½†æ˜¯ç°åœ¨Aè¿™ä¸ªæ–¹æ³•é‡Œè°ƒç”¨äº†waitæ–¹æ³•ï¼Œè¿™æ—¶å¤šçº¿ç¨‹è®¿é—®æ—¶è¿‡ç¨‹å°±å˜æˆäº†ä¸‹å›¾ï¼š 2.2ï¼šnotifyç°åœ¨å…ˆæ¥ä»‹ç»ä¸‹notifyï¼Œè¯¥æ–¹æ³•ä¼šå°†ç­‰å¾…é˜Ÿåˆ—é‡Œçš„çº¿ç¨‹å–å‡ºï¼Œè®©å…¶é€€å‡ºç­‰å¾…å¹¶å‚ä¸é”ç«äº‰ç„¶åç»§ç»­æ‰§è¡Œä¸Šæ¬¡waitåæ²¡æœ‰æ‰§è¡Œå®Œçš„è¯­å¥ã€‚æ•´ä½“è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¯ä»¥çœ‹åˆ°ï¼Œt1åœ¨è¢«æŒ‚èµ·åï¼Œä¼šå› ä¸ºt2è°ƒç”¨äº†åŒå®ä¾‹çš„notifyæ–¹æ³•ï¼Œè€Œè®©t1è¢«ä»ç­‰å¾…é˜Ÿåˆ—é‡Œé‡Šæ”¾ï¼Œé‡æ–°åŠ å…¥åˆ°æ‰€å¾—ç«äº‰åŠ›ï¼Œt2æ‰§è¡Œå®Œæ¯•åé‡Šæ”¾é”ï¼Œé”åˆå†æ¬¡è¢«t1ç«äº‰åˆ°ï¼Œt1å°†ç»§ç»­æ‰§è¡Œä¸Šæ¬¡è¢«æŒ‚èµ·æ—¶åé¢æœªæ‰§è¡Œå®Œçš„è¯­å¥ã€‚ éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œå¦‚æœç­‰å¾…é˜Ÿåˆ—é‡Œçš„çº¿ç¨‹æ˜¯å¤šä¸ªï¼Œé‚£ä¹ˆè¢«å”¤é†’çš„é‚£ä¸€ä¸ªï¼Œå°†ä¼šæ˜¯ç­‰å¾…é˜Ÿåˆ—é‡Œæ‰€æœ‰çº¿ç¨‹éšæœºçš„ä¸€ä¸ªï¼Œä¸ä¼šç‰¹å®šå“ªä¸€ä¸ªçº¿ç¨‹ä¼šè¢«å”¤èµ·ã€‚ 2.3ï¼šnotifyAllæ¥ä¸‹æ¥ä»‹ç»notifyAllæ–¹æ³•ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°†ç­‰å¾…é˜Ÿåˆ—é‡Œçš„çº¿ç¨‹å…¨éƒ¨å”¤èµ·ï¼Œç„¶åè¿™äº›çº¿ç¨‹å°†å…¨éƒ¨åŠ å…¥åˆ°é”ç«äº‰ï¼Œç«äº‰åˆ°ï¼Œç»§ç»­å®Œæˆä¸Šæ¬¡è¢«æŒ‚èµ·æ—¶æœªæ‰§è¡Œå®Œæ¯•çš„æ“ä½œï¼Œæµç¨‹å›¾å¦‚ä¸‹ï¼š è¯´æ˜ï¼Œå½“çº¿ç¨‹è°ƒç”¨å®ä¾‹çš„waitã€notifyã€notifyAllæ–¹æ³•æœ‰ä¸ªå¤§å‰æï¼Œå°±æ˜¯å¿…é¡»è¦æ±‚è¯¥çº¿ç¨‹æ‹¥æœ‰è¯¥å®ä¾‹çš„é”ï¼Œå¦åˆ™ä¼šæŠ›IllegalMonitorStateExceptionå¼‚å¸¸ã€‚ åœ¨ç¼–å†™ç¨‹åºæ—¶ï¼Œæ˜¯è¯¥é€‰æ‹©notifyè¿˜æ˜¯é€‰æ‹©notifyAllï¼Ÿè¿™ä¸ªå¯ä»¥æŒ‡å‡ºçš„æ˜¯ï¼ŒnotifyAllå¾€å¾€æ›´åŠ å¥å£®ï¼Œè€Œnotifyç”±äºå”¤èµ·çš„çº¿ç¨‹å°‘ï¼Œå› æ­¤æ•ˆç‡ä¼šæ›´é«˜ï¼Œä½†æ˜¯å­˜åœ¨ç¨‹åºåœæ­¢çš„é£é™©ã€‚ ä¸‰ã€å®ä¾‹3.1ï¼šwait+notifyçš„ç®€å•ä¾‹å­ä»¥å›¾4é‡Œçš„Wordå¯¹è±¡ä¸ºä¾‹ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªWordç±»å®šä¹‰å‡ºæ¥ï¼š ä»£ç å—212345678910111213public class Word { public synchronized void A() throws Exception { System.out.println(\"Aæ–¹æ³• waitè§¦å‘å‰\"); this.wait(); //å°†ç«äº‰åˆ°å¯¹è±¡é”åè¿è¡Œåˆ°è¿™é‡Œçš„çº¿ç¨‹ï¼Œæ”¾å…¥åˆ°è‡ªå·±çš„waité˜Ÿåˆ—ï¼Œè®©å®ƒå¤„äº\"æŒ‚èµ·\"çš„çŠ¶æ€ System.out.println(\"Aæ–¹æ³• waitè§¦å‘å\"); } public synchronized void B() { System.out.println(\"Bæ–¹æ³•è¢«è§¦å‘~\"); this.notifyAll(); }} æµ‹è¯•ç±»ï¼Œæˆ‘ä»¬å¼€å¯ä¸¤ä¸ªçº¿ç¨‹æ¥è®¿é—®åŒä¸€ä¸ªwordå¯¹è±¡é‡Œçš„åŒæ­¥æ–¹æ³•ï¼š ä»£ç å—31234567891011121314151617181920212223public static void main(String[] args) throws Exception { Word w1 = new Word(); Thread t1 = new Thread(()-&gt;{ try { w1.A(); //ç¬¬ä¸€ä¸ªçº¿ç¨‹è§¦å‘w1å¯¹è±¡çš„Aæ–¹æ³• } catch (Exception e) { e.printStackTrace(); } }); Thread t2 = new Thread(()-&gt;{ try { w1.B(); //ç¬¬äºŒä¸ªçº¿ç¨‹è§¦å‘w1å¯¹è±¡çš„Bæ–¹æ³• } catch (Exception e) { e.printStackTrace(); } }); t1.start(); Thread.sleep(1000L); //t1å¯åŠ¨åmainçº¿ç¨‹ç¡çœ ä¸€ç§’ï¼Œç¡®ä¿t1å¯ä»¥æŠ¢åˆ°w1çš„å¯¹è±¡é” t2.start();} è¿™ä¸ªè¿è¡Œç»“æœä¸ºï¼š ä»£ç å—4123Aæ–¹æ³• waitè§¦å‘å‰Bæ–¹æ³•è¢«è§¦å‘~Aæ–¹æ³• waitè§¦å‘å çœ‹åˆ°äº†å—ï¼Ÿæ˜æ˜t1æŠ¢åˆ°äº†å¯¹è±¡é”ï¼Œä½†æ˜¯åªè¿è¡Œäº†Aæ–¹æ³•waitå‰é¢çš„éƒ¨åˆ†ï¼Œè¿™æ—¶å› ä¸ºè¿è¡Œåˆ°waitæ—¶è¢«æŒ‚èµ·ï¼Œé‡Šæ”¾é”ï¼Œç„¶å1såt2æŠ¢åˆ°é”ï¼Œè¿è¡ŒBæ–¹æ³•ï¼Œç„¶åè§¦å‘Bæ–¹æ³•é‡Œçš„notifyAllåï¼Œæ‰€æœ‰æ”¾åˆ°w1å¯¹è±¡ç­‰å¾…é˜Ÿåˆ—é‡Œçš„çº¿ç¨‹è¢«å”¤èµ·ï¼Œé‡æ–°åŠ å…¥åˆ°é”ç«äº‰é‡Œå»ï¼Œæ­¤æ—¶t1å†æ¬¡ç«äº‰åˆ°w1çš„å¯¹è±¡é”ï¼Œç„¶åæŠŠè‡ªå·±æ²¡æ‰§è¡Œå®Œçš„æ–¹æ³•æ ˆæ‰§è¡Œå®Œã€‚ 3.2ï¼šåˆ©ç”¨çº¿ç¨‹é€šä¿¡å®ç°é˜»å¡é˜Ÿåˆ—å¤§ä½“æµç¨‹å¦‚ä¸‹ï¼š ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æœ‰ä¸€ä¸ªå…¬å…±ç¼“å†²å¸¦ï¼Œæˆ‘ä»¬ç®¡å®ƒå«åšæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¯ä»¥ç”±å¤šä¸ªç”Ÿäº§è€…å¾€å®ƒé‡Œé¢ç”Ÿäº§æ•°æ®ï¼Œå¯ä»¥ç”±å¤šä¸ªæ¶ˆè´¹è€…è·å–ï¼Œå½“é˜Ÿåˆ—å†…æ— æ¶ˆæ¯å¯è¯»æ—¶ï¼Œæ‰€æœ‰æ¶ˆè´¹è€…é™·å…¥ç­‰å¾…ï¼Œç­‰å¾…æ–°çš„æ¶ˆæ¯åˆ°æ¥ï¼š æ ¹æ®è¿™ä¸ªç»“æ„çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æœ¬èŠ‚æ‰€å­¦waitå’Œnotifyæ¥ç¼–å†™ã€‚ å®šä¹‰é˜»å¡é˜Ÿåˆ—ç±»ï¼Œæ ¹æ®æˆ‘ä»¬ä¸Šé¢çš„æè¿°ï¼Œä¸€ä¸ªç»„çš„é˜Ÿåˆ—åº”è¯¥å…·å¤‡ç”Ÿäº§å’Œè·å–çš„èƒ½åŠ›ï¼š ä»£ç å—512345678910111213141516171819202122//é˜»å¡é˜Ÿåˆ—ç±»public class BlockQueue { private List&lt;String&gt; msgs = new LinkedList&lt;&gt;(); //ç”¨äºå­˜æ”¾ç”Ÿäº§è€…ç”Ÿäº§çš„æ¶ˆæ¯çš„ç»“æ„ //å› ä¸ºæ”¯æŒå¤šä¸ªç”Ÿäº§è€…å¾€é‡Œé¢ç”Ÿäº§æ•°æ®ï¼Œä¹‹å‰è¯´è¿‡ArrayListçº¿ç¨‹ä¸å®‰å…¨ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦ç»™è¿™ä¸ªæ–¹æ³•åŠ é” public synchronized void put(String msg) { msgs.add(msg); //å­˜æ”¾è¿› this.notifyAll(); //ç”Ÿäº§å®Œå°±é€šçŸ¥æ¶ˆè´¹è€…ä»¬ï¼Œè®©å®ƒä»¬çŸ¥é“æœ‰æ¶ˆæ¯å¯ä»¥æ¶ˆè´¹äº†~ } public synchronized String get() { if (msgs.size() == 0) { try { this.wait(); //å¦‚æœç”Ÿäº§è€…ç”Ÿäº§çš„æ¶ˆæ¯éƒ½è¢«æ¶ˆè´¹è€…æ‹¿å®Œäº†ï¼Œé‚£ä¹ˆæ¶ˆè´¹è€…æƒ³å†æ‹¿çš„æ—¶å€™å°±åªèƒ½é™·å…¥ç­‰å¾…ï¼Œç­‰å¾…ç”Ÿäº§è€…å†æ¬¡ç”Ÿäº§ä¿¡æ¯ } catch (InterruptedException e) { e.printStackTrace(); } } return msgs.remove(msgs.size() - 1); }} æˆ‘ä»¬æ¥å¼€å¯å‡ ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥å½“æˆæ˜¯ç”Ÿäº§è€…ç¨‹åºå’Œæ¶ˆè´¹è€…ç¨‹åºï¼Œåˆ†åˆ«å¯¹BlockQueueå¯¹è±¡è¿›è¡Œç”Ÿäº§-æ¶ˆè´¹çš„æ“ä½œï¼š ä»£ç å—6123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051public static void main(String[] args) throws Exception { BlockQueue queue = new BlockQueue(); Thread p1 = new Thread(() -&gt; { queue.put(\"1å·ç”Ÿäº§è€…ç”Ÿäº§çš„æ¶ˆæ¯\"); }); Thread p2 = new Thread(() -&gt; { queue.put(\"2å·ç”Ÿäº§è€…ç”Ÿäº§çš„æ¶ˆæ¯\"); }); Thread p3 = new Thread(() -&gt; { queue.put(\"3å·ç”Ÿäº§è€…ç”Ÿäº§çš„æ¶ˆæ¯\"); }); p1.start(); p2.start(); p3.start(); //æ­¤æ—¶è¿™ä¸‰ä¸ªä»£è¡¨ç€ç”Ÿäº§è€…çš„çº¿ç¨‹è¢«å¯åŠ¨ï¼Œæ„å‘³ç€é˜Ÿåˆ—é‡Œçš„listå·²ç»æœ‰äº†ä¸‰æ¡æ•°æ® Thread c1 = new Thread(() -&gt; { System.out.println(\"æ¶ˆè´¹è€…1æ¶ˆè´¹åˆ°çš„æ¶ˆæ¯ï¼š\" + queue.get()); //æ¶ˆè´¹è€…çº¿ç¨‹ä»é˜»å¡é˜Ÿåˆ—é‡Œè·å–æ¶ˆæ¯ }); Thread c2 = new Thread(() -&gt; { System.out.println(\"æ¶ˆè´¹è€…2æ¶ˆè´¹åˆ°çš„æ¶ˆæ¯ï¼š\" + queue.get()); //æ¶ˆè´¹è€…çº¿ç¨‹ä»é˜»å¡é˜Ÿåˆ—é‡Œè·å–æ¶ˆæ¯ }); Thread c3 = new Thread(() -&gt; { System.out.println(\"æ¶ˆè´¹è€…3æ¶ˆè´¹åˆ°çš„æ¶ˆæ¯ï¼š\" + queue.get()); //æ¶ˆè´¹è€…çº¿ç¨‹ä»é˜»å¡é˜Ÿåˆ—é‡Œè·å–æ¶ˆæ¯ }); c1.start(); c2.start(); c3.start(); //æ­¤æ—¶è¿™ä¸‰ä¸ªä»£è¡¨ç€æ¶ˆè´¹è€…çš„çº¿ç¨‹è¢«å¯åŠ¨ï¼Œè‹¥æ‰§è¡Œå®Œæ¯•ï¼Œåˆ™æ„å‘³ç€é˜Ÿåˆ—é‡Œçš„listå·²å˜æˆç©ºå€¼ //æ­¤æ—¶é˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯å·²ç»è¢«æ¶ˆè´¹å®Œï¼Œç°åœ¨æˆ‘ä»¬å†å¼€å¯ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œè®©å®ƒç»§ç»­è·å–æ¶ˆæ¯ï¼ˆæ­¤æ—¶ä¾¿ä¼šé™·å…¥ç­‰å¾…ï¼‰ Thread c4 = new Thread(() -&gt; { System.out.println(\"æ¶ˆè´¹è€…4æ¶ˆè´¹åˆ°çš„æ¶ˆæ¯ï¼š\" + queue.get()); //ç”±äºæ¶ˆæ¯ç©ºäº†ï¼Œå› æ­¤è¯¥æ¶ˆè´¹è€…çº¿ç¨‹ä¼šé™·å…¥queueå¯¹è±¡çš„ç­‰å¾…é˜Ÿåˆ—ï¼ŒæŒ‚èµ·è‡ªå·± }); c4.start(); Thread.sleep(5000L); //ç­‰å¾…5såï¼Œæˆ‘ä»¬å†å¼€å¯ä¸€ä¸ªç”Ÿäº§è€…çº¿ç¨‹ï¼Œè®©å®ƒäº§ç”Ÿä¸€æ¡æ¶ˆæ¯ Thread p4 = new Thread(() -&gt; { queue.put(\"4å·ç”Ÿäº§è€…ç”Ÿäº§çš„æ¶ˆæ¯\"); }); p4.start();} è¿è¡Œç»“æœï¼š è¿™ä¸ªæµç¨‹ï¼Œå¦‚æœå¯¹çº¿ç¨‹é€šä¿¡è¿˜ä¸æ˜¯å¾ˆç†Ÿæ‚‰çš„è¯å°±éœ€è¦ä»”ç»†åˆ†æä¸€ä¸‹ğŸ˜","link":"/2020/04/01/LV5-4%EF%BC%9A%E7%BA%BF%E7%A8%8B%E9%80%9A%E4%BF%A1%EF%BC%9Await%E3%80%81notify%E3%80%81notifyall/"},{"title":"LV5-3ï¼šjavaé‡Œçš„åŒæ­¥é”","text":"ä¸€ã€ä¸ºä»€ä¹ˆä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ1.1ï¼šç”¨æˆ·å¦‚ä½•è®¿é—®æˆ‘çš„ç¨‹åºï¼Ÿæˆ‘ä»¬å‰é¢äº†è§£äº†javaå¦‚ä½•å¼€å¯ä¸€ä¸ªçº¿ç¨‹åšå¼‚æ­¥å¤„ç†ï¼Œä¹ŸçŸ¥é“äº†åœ¨å®é™…çš„é¡¹ç›®é‡Œï¼Œæˆ‘ä»¬å†™çš„çš„webç¨‹åºä¹Ÿè¢«tomcatå®‰æ’æˆäº†å¤šçº¿ç¨‹è°ƒç”¨çš„ç¨‹åºã€‚ å¦‚æœç°åœ¨åªæœ‰ä¸€ä¸ªç”¨æˆ·è®¿é—®æˆ‘ä»¬çš„webç¨‹åºï¼Œè¿™ä¸ªè¿‡ç¨‹å†é’ˆå¯¹tomcatç»†åŒ–ä¸‹ï¼Œå¦‚ä¸‹ï¼š tomcatæ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚çš„æµç¨‹å¤§è‡´å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥åŒæ—¶æ¥æ”¶å’Œå“åº”å¤šä¸ªç”¨æˆ·çš„è¯·æ±‚å’Œå“åº”ï¼Œå½“è¯·æ±‚æ•°æ®åŒ…è¿›å…¥æˆ‘ä»¬çš„tomcatæ—¶ï¼Œå®ƒä¼šä»å®ƒè‡ªå¸¦çš„çº¿ç¨‹æ± é‡Œå–å‡ºä¸€ä¸ªç©ºé—²çš„çº¿ç¨‹ï¼Œç”¨äºæ‰§è¡Œå…·ä½“çš„servleté€»è¾‘ï¼Œä¹Ÿå°±æ˜¯ä½ å†™çš„ä¸šåŠ¡ç¨‹åºã€‚ çº¿ç¨‹æ± ï¼šäº‹å…ˆç”³è¯·å¥½ä¸€æ‰¹çº¿ç¨‹ï¼Œå­˜æ”¾åˆ°ä¸€ä¸ªç»“æ„é‡Œï¼ˆå¯ä»¥æ˜¯æ•°ç»„ï¼Œä¹Ÿå¯ä»¥æ˜¯é›†åˆï¼Œèƒ½å­˜çº¿ç¨‹å¯¹è±¡å°±è¡Œï¼‰ï¼Œè¿™æ ·å°±ä¸ç”¨æ¯æ¬¡è¿›æ¥ä¸€ä¸ªè¯·æ±‚å°±å»å‘æ“ä½œç³»ç»Ÿç”³è¯·ä¸€ä¸ªçº¿ç¨‹ï¼Œç”³è¯·çº¿ç¨‹å¼€é”€æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œäº‹å…ˆå¼€å¯ä¸€æ‰¹æ”¾åˆ°ä¸€ä¸ªç»“æ„é‡Œï¼Œç”¨çš„æ—¶å€™ç›´æ¥æ‹¿æ¥ç”¨å³å¯ï¼Œè¿™ç§æŠ€æœ¯å«æ± åŒ–æŠ€æœ¯ï¼Œä¹‹åçš„æ•°æ®åº“è¿æ¥æ± ä¹Ÿå±äºä¸€ç§æ± åŒ–æŠ€æœ¯ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯é¿å…å¼€é”€å¤§çš„æ“ä½œï¼Œè®©å®ƒä»¬äº‹å…ˆå‡†å¤‡å¥½ï¼Œä¸è‡³äºç”¨çš„æ—¶å€™ç°ç”¨ç°ç”³è¯·ï¼Œå¯ä»¥æå‡ç¨‹åºæ•ˆç‡ã€‚ æ³¨æ„ï¼Œçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿå±‚é¢çš„ä¸œè¥¿ï¼Œåªæ˜¯æ¯ç§è¯­è¨€éƒ½æ”¯æŒç”³è¯·ï¼Œåƒjavaä¹‹å‰çš„new Threadè¯­å¥åœ¨åˆ›å»ºä¸€ä¸ªThreadå¯¹è±¡çš„åŒæ—¶ï¼Œä¹Ÿä¼šå‘æ“ä½œç³»ç»Ÿç”³è¯·åˆ›å»ºä¸€ä¸ªå®é™…çš„çº¿ç¨‹å‡ºæ¥ï¼ŒThreadç±»å…¶å®åªæ˜¯å¯¹ç”³è¯·çš„çº¿ç¨‹çš„æŠ½è±¡ï¼Œä½ å¯ä»¥é€šè¿‡è¿™ä¸ªç±»æ¥æ“çºµå…·ä½“çš„çº¿ç¨‹ï¼Œå°±åƒä½ å¯ä»¥åˆ©ç”¨HttpServletRequestç±»åœ¨Servletåœºæ™¯é‡Œæ“ä½œHTTPåè®®ä¿¡æ¯ä¸€æ ·ã€‚ å›¾1é‡Œtomcatçš„å¤„ç†æ¨¡å¼åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯ä¸€æ¬¡è¯·æ±‚ï¼Œè¯•æƒ³ä¸€ä¸‹ï¼Œä½ è¿™ä¸ªtomcatç¨‹åºæ”¾åˆ°æœåŠ¡å™¨ä¸Šæ˜¯è¦ç»™å…¨å›½äººæ°‘è®¿é—®çš„ï¼Œæˆ‘ä»¬æ¥ç»“åˆå‹æµ‹æ¥ç†è§£ï¼Œæˆ‘ä»¬å•æœºä¸€ä¸ªæ¥å£çš„å‹æµ‹æˆç»©åœ¨500qpsæˆ‘ä»¬éƒ½ä¼šè§‰å¾—è¶…çº§ä½ï¼Œè€Œæˆ‘ä»¬çš„æ¥å£å¹³å‡å“åº”æ—¶é—´åœ¨20msï¼Œå¦‚æœå°±æ˜¯ä¸€ä¸ªç”¨æˆ·è®¿é—®æˆ‘ä»¬çš„tomcatï¼Œå®Œæˆåå†è®©ç¬¬äºŒä¸ªç”¨æˆ·è®¿é—®ï¼Œä»¥æ­¤ç±»æ¨ï¼Œè¿™æ ·æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ï¼Œè®©æˆ‘ä»¬åšä¸ªæ•°å­¦é¢˜ï¼Œæ¯ä¸ªç”¨æˆ·è®¿é—®æˆ‘ä»¬è¿™ä¸ªæ¥å£éƒ½æ¶ˆè€—20msï¼Œ1sæ˜¯1000msï¼Œå¦‚æœæ˜¯æŒ‰ç…§æ’é˜Ÿè®¿é—®çš„æ–¹å¼ï¼Œ1såªèƒ½å¤„ç†ï¼ˆ1000/20 = 50ï¼‰ä¸ªç”¨æˆ·çš„è¯·æ±‚ï¼Œç„¶è€Œæˆ‘ä»¬è§‰å¾—è¿™ç§æ¥å£ï¼Œä¸å‹åˆ°1000qpséƒ½ç®—æ˜¯éå¸¸éå¸¸ä½çš„æˆç»©ã€‚æ—¢ç„¶æ˜¯è¿™æ ·ï¼Œtomcatåœ¨å¤„ç†ç”¨æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œå°±ä¸å¯èƒ½æ˜¯å¤„ç†å®Œä¸€ä¸ªå†å¤„ç†ä¸€ä¸ªï¼Œä¸€å®šæ˜¯ä¸€èµ·å¤„ç†çš„ï¼ŒåŸºäºæ­¤ï¼Œæˆ‘ä»¬å¼•å‡ºå¤šçº¿ç¨‹ä¸‹çš„tomcatå¤„ç†æ¨¡å¼ï¼Œæ¥çœ‹ä¸‹å¤šçº¿ç¨‹æ¨¡å¼ä¸‹çš„tomcatè¿è¡Œæ–¹å¼ï¼Œæ‹¿ä¹‹å‰çš„ä¾‹å­StudentInfoControlleræ¥è¯´äº‹ï¼š é€šè¿‡å›¾2å¯ä»¥æ›´æ¸…æ™°çš„çœ‹åˆ°ï¼Œå¤šä¸ªç”¨æˆ·åŒæ—¶è®¿é—®ä½ çš„webç¨‹åºæ—¶çš„æ ·å­ï¼Œå¯ä»¥çœ‹åˆ°è¿›æ¥çš„è¯·æ±‚éƒ½æ˜¯è¢«ä»çº¿ç¨‹æ± é‡Œå–åˆ°çš„çº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„ï¼Œæ¢å¥è¯è¯´ï¼Œä¸‹é¢çš„ä»£ç æ˜¯ä¼šè¢«å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„ï¼š ä»£ç å—11234567891011121314151617public class StudentInfoController extends HttpServlet { private StudentDao studentDao = new StudentDao(); @Override protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { resp.setContentType(\"application/json\"); try { Student result = studentDao.getStudentInfo(); resp.getOutputStream().write(JSON.toJSONBytes(result)); resp.setStatus(200); } catch (Exception e) { e.printStackTrace(); resp.setStatus(500); } }} 1.2ï¼šçº¿ç¨‹å®‰å…¨é—®é¢˜å…ˆè®°ä½1.1å…³äºtomcatçš„è®¿é—®åˆ†å‘æ¨¡å¼ã€‚æˆ‘ä»¬ç°åœ¨æ¥çœ‹ä¸‹çº¿ç¨‹å®‰å…¨é—®é¢˜ä¸»è¦æ˜¯æŒ‡ä»€ä¹ˆã€‚ çº¿ç¨‹å®‰å…¨é—®é¢˜ä¸»è¦æ˜¯æŒ‡å¤šæ¡çº¿ç¨‹å¯¹åŒä¸€ä¸ªå…¬å…±èµ„æºçš„æ“ä½œï¼Œå¯¼è‡´çš„ä¸€ç³»åˆ—â€è¿åå¸¸è§„â€œçš„äº‹æƒ…ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œç°åœ¨æ¥å®šä¹‰ä¸€ä¸ªç±»ï¼š ä»£ç å—2123456789101112public class Adder { private int i = 0; public void incre() { i++; } public int getI() { return i; }} ç±»å¾ˆç®€å•ï¼Œæœ‰ä¸€ä¸ªå«içš„å±æ€§ï¼Œincreæ–¹æ³•ç”¨æ¥ç»™è‡ªå·±è¿™ä¸ªå±æ€§åš+1æ“ä½œï¼ŒgetIç”¨äºè¿”å›è¿™ä¸ªå±æ€§å€¼ã€‚ æ¥ç¼–å†™ä¸‹mainæ–¹æ³•ï¼Œæˆ‘ä»¬è®©åŒä¸€ä¸ªAdderå¯¹è±¡è¢«ä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹åšincreçš„è°ƒç”¨ï¼š ä»£ç å—3123456789101112131415161718192021222324public static void main(String[] args) throws Exception { Adder adder = new Adder(); Thread t1 = new Thread(() -&gt; { for (int j = 0; j &lt; 1000; j++) { adder.incre(); //ç¬¬ä¸€ä¸ªçº¿ç¨‹è®©Adderå¯¹è±¡é‡Œçš„iè‡ªå¢1000æ¬¡ } }); Thread t2 = new Thread(() -&gt; { for (int j = 0; j &lt; 2000; j++) { adder.incre(); //ç¬¬äºŒä¸ªçº¿ç¨‹è®©Adderå¯¹è±¡é‡Œçš„iè‡ªå¢2000æ¬¡ } }); //å¯åŠ¨çº¿ç¨‹ t1.start(); t2.start(); //åˆ©ç”¨çº¿ç¨‹ç¡çœ ï¼Œè®©mainçº¿ç¨‹ç¡çœ 2sï¼Œç­‰å¾…ä¸Šé¢ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯• Thread.sleep(2000L); System.out.println(adder.getI()); } ç¬¬ä¸€ä¸ªçº¿ç¨‹è®©iè‡ªå¢1000æ¬¡ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹è®©iè‡ªå¢2000æ¬¡ï¼Œæˆ‘ä»¬è¿™æ—¶æ¥çŒœä¸€ä¸‹æœ€ç»ˆè¿è¡Œç»“æœåº”è¯¥æ˜¯å¤šå°‘ï¼Ÿ3000å—ï¼Ÿæ˜¯çš„ï¼Œçœ‹é€»è¾‘æ˜¯3000æ²¡é”™ï¼å¯æ˜¯è¿è¡Œä¸‹ï¼Œå¤šè¿è¡Œå‡ éï¼Œå°±ä¼šå‘ç°è¯¡å¼‚çš„äº‹æƒ…å‘ç”Ÿäº†ï¼š ä»£ç å—4123456216026983000300028633000 æˆ‘è¿è¡Œäº†6æ¬¡ï¼Œå¾—åˆ°çš„ç»“æœè®©äººæƒŠè®¶ï¼Œä¸ä»…ä¸å®Œå…¨æ­£ç¡®ï¼Œç”šè‡³å¾ˆâ€éšæœºâ€œï¼Œè¿™ä¾¿æ˜¯çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ è¿˜è®°å¾—ä¸€å¼€å§‹è¯´çš„å—ï¼Ÿé€ æˆçº¿ç¨‹å®‰å…¨é—®é¢˜çš„åŸå› ä¸»è¦æ˜¯å› ä¸ºå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œåŒä¸€å…¬å…±èµ„æºé€ æˆçš„ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼ŒAdderçš„å¯¹è±¡å°±æ˜¯ä¸ªå…¬å…±èµ„æºï¼Œè‡ªç„¶å®ƒå†…éƒ¨çš„iå±æ€§ä¹Ÿæ˜¯ä¸ªå…¬å…±èµ„æºäº†ã€‚é‚£è¿™ç§çº¿ç¨‹å®‰å…¨é—®é¢˜åˆ°åº•æ˜¯å¦‚ä½•å¯¼è‡´çš„å‘¢ï¼Ÿæˆ‘ä»¬æ ¹æ®æœ¬ä¾‹è¿›è¡Œåˆ†æä¸€ä¸‹ï¼š å¦‚å›¾æ‰€ç¤ºï¼Œä»¿ç…§increçš„é€»è¾‘ï¼Œåšäº†ä¸€ä¸ªæµç¨‹å›¾ï¼Œincreçš„é€»è¾‘ä¸€å®šæ˜¯å…ˆä»Adderå¯¹è±¡é‡Œæ‹¿åˆ°içš„å€¼ï¼Œç„¶ååš+1è®¡ç®—ï¼Œç„¶åå°†è®¡ç®—ç»“æœé‡æ–°å†™å›å¯¹è±¡çš„iå±æ€§ï¼Œè¿™æ²¡é—®é¢˜ï¼Œåœ¨å•çº¿ç¨‹ä¸‹è¿è¡Œè‰¯å¥½ï¼Œä½†æ˜¯ç°åœ¨çº¿ç¨‹2ä¹Ÿåšç±»ä¼¼çš„æ“ä½œï¼Œè¿™æ—¶å°±æœ‰é—®é¢˜äº†ï¼Œå› ä¸ºæŸä¸€æ—¶åˆ»ï¼Œä»å†…å­˜å–åˆ°çš„iå€¼å¯èƒ½æ˜¯ç›¸åŒçš„ï¼Œä¾‹å¦‚ç¬¬ä¸€æ¬¡è°ƒç”¨increæ–¹æ³•æ—¶ï¼Œçº¿ç¨‹1å’Œçº¿ç¨‹2åŒæ—¶å–içš„å€¼ï¼Œæ­¤æ—¶éƒ½æ˜¯0ï¼Œç„¶åå„è‡ªå®Œæˆincreçš„è°ƒç”¨ï¼Œå†å°†iå†™å›å¯¹è±¡ï¼Œå‘ç°é—®é¢˜äº†å—ï¼Ÿè™½ç„¶çº¿ç¨‹1å’Œçº¿ç¨‹2éƒ½æ‰§è¡Œäº†increæ–¹æ³•ï¼Œä½†æœ€ç»ˆä¿©çº¿ç¨‹å†™å›å†…å­˜çš„içš„å€¼éƒ½æ˜¯1ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆç»“æœä¼šä¸å‡†çš„åŸå› ï¼Œä¸è¿‡ä½ ä¼šå‘ç°ï¼Œç»“æœé™¤äº†ä¸å‡†ï¼Œå®ƒè¿˜éšæœºï¼Œè¿™å°±ç‰µæ‰¯åˆ°å¤šçº¿ç¨‹è°ƒç”¨çš„ä¸€ä¸ªéšæœºæ€§ï¼Œçº¿ç¨‹æ˜¯ç‹¬ç«‹çš„ã€åŒæ—¶è¿è¡Œçš„ï¼Œæ‰€ä»¥æˆ‘å‰é¢æè¿°çš„é—®é¢˜æœ‰å¯èƒ½å‘ç”Ÿï¼Œä¹Ÿæœ‰å¯èƒ½ä¸å‘ç”Ÿï¼Œä½†åªè¦å‘ç”Ÿä¸€æ¬¡ï¼Œå°±è¶³ä»¥å½±å“ç»“æœçš„å‡†ç¡®æ€§ï¼Œè€Œå‘ç”Ÿçš„æ¬¡æ•°åˆæ˜¯éšæœºçš„ï¼Œè¿™ä¹Ÿæ˜¯ç»“æœä¸ºä»€ä¹ˆéšæœºçš„åŸå› ã€‚ äºŒã€synchronizeå…³é”®è¯çš„ä½œç”¨2.1ï¼šsynchronizeæ˜¯å¹²å•¥çš„ï¼Ÿé¦–å…ˆå®ƒæ˜¯ä¸ªæ–¹æ³•çš„ä¿®é¥°è¯ï¼Œå¯ä»¥ä¿®é¥°æˆå‘˜æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ä¿®é¥°é™æ€æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥å•ç‹¬ä½œä¸ºåŸŸæ¥ä¿®é¥°ä¸€ä¸ªä»£ç å—ï¼Œè¢«å®ƒä¿®é¥°çš„æ–¹æ³•æˆ–ä»£ç å—ï¼Œç›¸å½“äºåŠ äº†ä¸ªåŒæ­¥é”ï¼Œåœ¨è¢«å¤šçº¿ç¨‹è®¿é—®æ—¶ï¼Œçº¿ç¨‹ä¼šå‘ç”Ÿâ€æ’é˜Ÿâ€œï¼Œä¹Ÿå°±æ˜¯åé¢ä¼šè¯´çš„é”ç«äº‰ï¼Œä»è€Œä¿è¯ä¸€ä¸ªæ–¹æ³•åœ¨å¤šçº¿ç¨‹æ–¹æ³•ä¸‹æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¿è¡Œå®ƒã€‚ 2.2ï¼šå¯¹è±¡é”2.2.1ï¼šåˆ©ç”¨å¯¹è±¡é”è§£å†³Adderç±»çš„ç´¯åŠ é—®é¢˜ä½œç”¨åœ¨å¯¹è±¡ä¸Šçš„åŒæ­¥é”ï¼Œä»¥å¯¹è±¡å®ä¾‹ä¸ºå•ä½ç»™è®¿é—®å®ƒçš„çº¿ç¨‹è¿›è¡Œâ€æ’é˜Ÿâ€œï¼Œæˆ‘ä»¬ä¸Šé¢çš„ä¾‹å­å°±ç¬¦åˆè¿™ç§è§„åˆ™ï¼Œæˆ‘ä»¬ç°åœ¨è®©ä¸Šé¢çš„increæ–¹æ³•å˜æˆä¸€ä¸ªåŒæ­¥æ–¹æ³•ï¼ˆè¢«synchronizeä¿®é¥°çš„æ–¹æ³•ï¼Œè¢«ç§°ä½œåŒæ­¥æ–¹æ³•ï¼‰ï¼š ä»£ç å—5123456789101112public class Adder { private int i = 0; public synchronized void incre() { //æ”¹æˆåŒæ­¥æ–¹æ³• i++; } public int getI() { return i; }} ç°åœ¨å†æ¥æµ‹è¯•ä¸‹ä»£ç å—3é‡Œçš„å†…å®¹ï¼š ä»£ç å—6123456300030003000300030003000 äº‹å®ä¸Šï¼Œincreæ–¹æ³•åŠ äº†é”ä¹‹åï¼Œä¸ç®¡è¿è¡Œå‡ éï¼Œç¨‹åºå§‹ç»ˆéƒ½æ˜¯æ­£ç¡®çš„3000æ¬¡ã€‚ ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå†è¯•ç€ç†è§£ä¸‹å›¾3ï¼Œçœ‹çœ‹ä¸åŠ é”çš„æ—¶å€™æ˜¯æ€ä¹ˆå¯¼è‡´æœ€ç»ˆç»“æœä¸æ­£ç¡®çš„ï¼Ÿå°±æ˜¯å› ä¸ºä¸¤ä¸ªçº¿ç¨‹åŒä¸€æ—¶åˆ»è®¿é—®ç»Ÿä¸€èµ„æºå¯¼è‡´çš„ï¼Œé‚£ä¹ˆå†ç»“åˆæˆ‘ä»¬2.1ä¸­æ‰€æè¿°çš„ï¼ŒåŠ äº†synchronizeçš„æ–¹æ³•ï¼Œåœ¨æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®è‡ªå·±çš„æ—¶å€™ï¼Œåªæ”¾è¡Œä¸€ä¸ªï¼Œå¦å¤–ä¸€ä¸ªæ’é˜Ÿï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•é‡Šæ”¾æ‰é”åï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹æ‰å¯èƒ½è¿›å…¥ï¼š ç”±äºé”çš„æ§åˆ¶ï¼Œæˆ‘ä»¬å¦‚å›¾3é‡Œçš„çº¿ç¨‹å®‰å…¨æ€§é—®é¢˜è¢«è§£å†³äº†~ æœ¬ä¾‹ä¸­çš„é”å±äºåŒæ­¥é”é‡Œçš„å¯¹è±¡é”ï¼Œå®ƒçš„ä½œç”¨åŸŸä»…é™äºå¯¹è±¡æœ¬èº«ï¼Œä¸€ä¸ªçº¿ç¨‹è¦æƒ³è®¿é—®å®ƒå†…éƒ¨è¢«synchronizeä¿®é¥°äº†çš„æ–¹æ³•ã€ä»£ç å—ï¼Œåˆ™å¿…é¡»è¦è·å–å½“å‰å¯¹è±¡çš„é”ï¼Œå°±åƒå›¾4ä¸­é‚£æ ·ã€‚ ä»£ç å—7123456789101112131415161718192021public class ObjectLock { private int i = 0; public synchronized void incre() { i++; } public synchronized void decre() { i--; } public void setI(int i) { System.out.println(\"æˆ‘ä¸åœ¨åŒæ­¥å—å†…ï¼Œæˆ‘å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è§¦å‘è¿è¡Œ\"); //è¿™æ—¶åŒæ­¥å—ï¼Œåªæœ‰çº¿ç¨‹ç«äº‰åˆ°å¯¹è±¡é”æ—¶æ‰èƒ½è®¿é—® synchronized (this) { //åŒæ­¥ä»£ç å—ï¼Œæ‹¬å·é‡Œå£°æ˜ä¸ºthisï¼Œä»£è¡¨è¿™ä¸ªä»£ç å—ä¸Šçš„é”æ˜¯å¯¹è±¡é” this.i = i; } } } å¦‚ä¸Šï¼Œä»»ä½•çº¿ç¨‹è¦æƒ³è°ƒç”¨increã€decreã€setIçš„åŒæ­¥ä»£ç å—ï¼Œéƒ½å¿…é¡»è¦ç«äº‰åˆ°å½“å‰ObjectLockå¯¹è±¡çš„å¯¹è±¡é”ï¼Œå¦åˆ™æ’é˜Ÿç­‰å¾…åˆ«çš„çº¿ç¨‹é‡Šæ”¾ã€‚ 2.2.2ï¼šå¯¹è±¡é”çš„ä½œç”¨åŸŸé€šè¿‡å‰é¢çš„äº†è§£ï¼Œå¯¹è±¡é”æŒ‡çš„æ˜¯å½“å‰çº¿ç¨‹è·å¾—äº†æŸä¸ªå®ä¾‹çš„é”ï¼Œç„¶åå¯¹å…¶å†…éƒ¨â€ä¸Šäº†é”â€œçš„èµ„æºçš„è®¿é—®ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œæœ‰ä¸ªWordç±»ï¼Œæœ‰Aã€Bä¸¤ä¸ªåŒæ­¥æ–¹æ³•ï¼ŒCå±äºæ™®é€šæ–¹æ³•ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š å¯ä»¥å‘ç°ï¼Œå¯¹è±¡é”çš„ä½œç”¨åŸŸåªé’ˆå¯¹å½“å‰å¯¹è±¡ç”Ÿæ•ˆï¼Œå°±åƒw1å’Œw2é‡Œçš„Aæ–¹æ³•å¯ä»¥è¢«ä¸åŒçš„çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œä½†æ˜¯åŒä¸€ä¸ªå¯¹è±¡å†…çš„åŒæ­¥å—ï¼Œå´åªå…è®¸æŒæœ‰å½“å‰å¯¹è±¡é”çš„çº¿ç¨‹æ‰§è¡Œï¼Œå¦‚t2ã€t3å‡è¢«æŒ¡åœ¨äº†å¤–é¢ï¼Œå½“t1é‡Šæ”¾é”ä»¥åï¼Œt2ã€t3æ‰ä¼šé‡æ–°ç«äº‰é”ï¼Œç«äº‰åˆ°é”ä»¥åå°±ä¼šæ‰§è¡Œè‡ªå·±æƒ³è¦æ‰§è¡Œçš„åŒæ­¥é€»è¾‘ã€‚ è¿™è·Ÿæˆ‘ä»¬åé¢è¦è¯´çš„ç±»é”å¾ˆä¸ä¸€æ ·ã€‚ 2.3ï¼šç±»é”è·Ÿå¯¹è±¡é”çš„ç›®æ ‡æ˜¯ä¸€è‡´çš„ï¼Œå°±æ˜¯æ§åˆ¶çº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œä¸å¯¹è±¡é”ä¸åŒçš„æ˜¯ï¼Œå®ƒæ˜¯æŒ‰ç…§ç±»æ¥è¿›è¡Œä¸Šé”çš„ï¼Œå°±åƒæ™®é€šæ–¹æ³•å’Œstaticæ–¹æ³•ä¸€æ ·ï¼Œä¸€ä¸ªå±äºå¯¹è±¡èŒƒç•´çš„ï¼Œä¸€ä¸ªå±äºç±»èŒƒç•´çš„ã€‚ ä¸€èˆ¬ä½¿ç”¨synchronizeä¿®é¥°çš„staticæ–¹æ³•ï¼Œæˆ–è€…è¿™æ ·å£°æ˜åŒæ­¥å—ï¼š ä»£ç å—8123synchronized (XXX.class){ //è·Ÿå¯¹è±¡é”ç”¨thisåšå£°æ˜ä¸ä¸€æ ·ï¼Œç±»é”ä½¿ç”¨classæœ¬èº«åšå£°æ˜ ...ç•¥} ç±»é”çš„ä½œç”¨åŸŸè·Ÿå¯¹è±¡é”ä¸å¤ªä¸€æ ·ï¼Œæ”¹é€ ä¸‹Wordç±»ï¼Œè®©å…¶æ–¹æ³•éƒ½å˜æˆé™æ€çš„ï¼Œå›¾5é‡Œçš„è®¿é—®å°±è¦å˜æˆä¸‹é¢è¿™æ ·ï¼š è·Ÿä¸Šé¢ç›¸æ¯”è¾ƒï¼Œè¿™é‡Œçš„t5å—åˆ°äº†t1çš„å½±å“ï¼Œå› ä¸ºt1è·å¾—äº†Wordç±»çš„é”ï¼Œw1å’Œw2å…±å±ä¸€ä¸ªç±»ï¼Œå› æ­¤t1è·å¾—ç±»é”ä»¥åï¼Œå…¶ä»–çº¿ç¨‹æƒ³è¦è®¿é—®è¿™ä¸ªç±»é‡Œçš„åŒæ­¥å—ï¼Œå°±å¾—ç­‰åˆ°t1é‡Šæ”¾é”ä»¥åæ‰å¯ä»¥ç»§ç»­ç«äº‰é”ç„¶åæ‰§è¡Œè‡ªå·±æƒ³è¦æ‰§è¡Œçš„åŒæ­¥é€»è¾‘ã€‚ 2.4ï¼šæ­»é”æ­»é”å°±æ˜¯æŒ‡ä¸¤ä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”èµ„æºçš„ç°è±¡ï¼Œä¸¾ä¸ªä¾‹å­ï¼šçº¿ç¨‹1æŒæœ‰å¯¹è±¡açš„å¯¹è±¡é”ï¼Œçº¿ç¨‹2æŒæœ‰å¯¹è±¡bçš„å¯¹è±¡é”ï¼Œæ­¤æ—¶aå¯¹è±¡é‡Œéœ€è¦è°ƒç”¨bå¯¹è±¡çš„åŒæ­¥æ–¹æ³•ï¼Œè€Œå¯¹è±¡bä¹Ÿéœ€è¦è°ƒç”¨å¯¹è±¡açš„åŒæ­¥æ–¹æ³•ï¼Œè¿™æ—¶çº¿ç¨‹1åœ¨ç­‰ç€è·å–å¯¹è±¡bçš„å¯¹è±¡é”ï¼Œçº¿ç¨‹2ç­‰ç€è·å–å¯¹è±¡açš„å¯¹è±¡é”ï¼Œäº’ä¸æ’’æ‰‹ï¼Œæ­¤æ—¶å°±å¯¼è‡´ç¨‹åºå‘ç”Ÿäº†æ­»é”ï¼Œæˆ‘ä»¬é€šè¿‡ä»£ç æ¥è¯´æ˜ä¸‹è¿™ä¸ªé—®é¢˜ï¼š å®šä¹‰ä¸€ä¸ªDeadLockç±»ï¼š ä»£ç å—912345678910111213141516171819202122232425262728public static void main(String[] args) { Object a = new Object(); //ä¸ºäº†ä¾¿äºè¯´æ˜é—®é¢˜ï¼Œæˆ‘ä»¬éšä¾¿newä¸ªaå¯¹è±¡ Object b = new Object(); //ä¸ºäº†ä¾¿äºè¯´æ˜é—®é¢˜ï¼Œæˆ‘ä»¬éšä¾¿newä¸ªbå¯¹è±¡ Thread t1 = new Thread(() -&gt; { synchronized (a) { System.out.println(\"çº¿ç¨‹1å·²ç»è·å–åˆ°äº†aå¯¹è±¡çš„å¯¹è±¡é”ï¼Œè¿›å…¥åŒæ­¥å—~\"); //å‡è®¾æ¥ä¸‹æ¥éœ€è¦è·å–bå¯¹è±¡çš„å¯¹è±¡é”æ‰èƒ½æ­£å¸¸è¿è¡Œ synchronized (b) { System.out.println(\"çº¿ç¨‹1å·²ç»è·å–åˆ°äº†bçš„å¯¹è±¡é”ï¼Œè¿›å…¥åŒæ­¥å—~\"); } } }); Thread t2 = new Thread(() -&gt; { synchronized (b) { System.out.println(\"çº¿ç¨‹2å·²ç»è·å–åˆ°äº†bå¯¹è±¡çš„å¯¹è±¡é”ï¼Œè¿›å…¥åŒæ­¥å—~\"); //å‡è®¾æ¥ä¸‹æ¥éœ€è¦è·å–aå¯¹è±¡çš„å¯¹è±¡é”æ‰èƒ½æ­£å¸¸è¿è¡Œ synchronized (a) { System.out.println(\"çº¿ç¨‹2å·²ç»è·å–åˆ°äº†açš„å¯¹è±¡é”ï¼Œè¿›å…¥åŒæ­¥å—~\"); } } }); t1.start(); t2.start();} è¿™ä¸ªç¨‹åºè¾“å‡ºï¼š ä»£ç å—1012çº¿ç¨‹1å·²ç»è·å–åˆ°äº†aå¯¹è±¡çš„å¯¹è±¡é”ï¼Œè¿›å…¥åŒæ­¥å—~çº¿ç¨‹2å·²ç»è·å–åˆ°äº†bå¯¹è±¡çš„å¯¹è±¡é”ï¼Œè¿›å…¥åŒæ­¥å—~ ç„¶åé˜»å¡ï¼Œä¸€ç›´é˜»å¡ï¼Œè¿™ä¿©çº¿ç¨‹ç®—æ˜¯åºŸäº†ï¼Œè¿™å°±æ˜¯æ­»é”ï¼Œçº¿ç¨‹1å’Œçº¿ç¨‹2å„è‡ªç­‰ç€å¯¹æ–¹é‡Šæ”¾è‡ªå·±éœ€è¦çš„é”ï¼Œå¯æ˜¯è¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºåŒæ­¥å—ä¸æ‰§è¡Œå®Œé”æ˜¯æ²¡åŠæ³•é‡Šæ”¾çš„ã€‚ ä¸‰ã€é”çš„ç§ç±»æœ‰å“ªäº›ï¼Ÿsynchronizeå±äºå“ªä¸€ç§ï¼Ÿé”çš„åˆ†ç±»å¤ªå¤šå¤ªæ‚ï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥é€šè¿‡ç¾å›¢æŠ€æœ¯å›¢é˜Ÿè¿™ç¯‡æ–‡ç« æ¥äº†è§£ï¼šä¸å¯ä¸è¯´çš„Javaâ€œé”â€äº‹ synchronizedåœ¨å®ç°ä¸Šå±äºä¸€ç§å¯é‡å…¥çš„éå…¬å¹³é”ï¼Œä¹‹åä¼šç»“åˆjavaåº•å±‚æœ‰å…³synchronizedçš„å®ç°æ¥ç»™å…·ä½“çš„è¯´ä¸€è¯´åŒæ­¥é”ã€‚","link":"/2020/04/01/LV5-3%EF%BC%9Ajava%E9%87%8C%E7%9A%84%E5%90%8C%E6%AD%A5%E9%94%81/"},{"title":"LV5-2ï¼šå¹¶å‘&å¹¶è¡Œ","text":"ä¸¤å¼ å›¾æ¥ç†è§£å¹¶å‘å’Œå¹¶è¡Œï¼š å¦‚æœåªæœ‰ä¸€ä¸ªCPUï¼Œé€šè¿‡CPUè°ƒåº¦åˆ‡æ¢çº¿ç¨‹ä¸Šä¸‹æ–‡ï¼Œæˆ‘ä»¬è®¤ä¸ºï¼Œåœ¨ä»»æ„ä¸€ä¸ªæ—¶åˆ»ï¼Œå„ä¸ªçº¿ç¨‹æœ‰ä¸”åªèƒ½è¿è¡Œä¸€ä¸ªï¼Œè¿™ä¸ªå«å¹¶å‘ã€‚ ç›¸åçš„ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªæˆ–è€…æ›´å¤šçš„CPUï¼Œé‚£ä¹ˆå°±ä¼šæ˜¯ä¸‹é¢è¿™æ ·ï¼š ä¸¤ä¸ªCPUä¸€èµ·è°ƒåº¦çš„æ—¶å€™ï¼Œæ€»ä¼šå‡ºç°ä¸€äº›â€åŒæ—¶è¢«è°ƒåº¦è¿è¡Œâ€œçš„çº¿ç¨‹ï¼Œæ¯”å¦‚ä¸Šå›¾çš„çº¢è‰²â­ï¸æ ‡è®°çš„éƒ¨åˆ†ï¼Œå®ƒä»¬ç¡®å®åœ¨åŒä¸€æ—¶åˆ»éƒ½è¢«è°ƒåº¦åˆ°å¹¶ä¸”å¼€å§‹è¿è¡Œäº†ï¼Œæˆ‘ä»¬ç§°è¿™ç§å› å¤šCPUè°ƒåº¦è€Œäº§ç”Ÿçš„çº¿ç¨‹è¿è¡Œæ—¶é—´é‡å çš„ç°è±¡å«å¹¶è¡Œã€‚ å¹¶è¡Œå¿…é¡»è¦æœ‰å¤šä¸ªCPUï¼Œèƒ½å¹¶è¡Œçš„ä¸€å®šèƒ½å¹¶å‘ï¼Œå¦‚æœä½ åªæœ‰ä¸€ä¸ªCPUï¼Œé‚£ä¹ˆä½ åªèƒ½æ˜¯å¹¶å‘äº†ï¼Œä¸å¯èƒ½å¹¶è¡Œã€‚","link":"/2020/04/01/LV5-2%EF%BC%9A%E5%B9%B6%E5%8F%91&%E5%B9%B6%E8%A1%8C/"},{"title":"LV5-1ï¼šè¿›ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿçº¿ç¨‹åˆæ˜¯ä»€ä¹ˆï¼Ÿ","text":"ä¸€ã€çº¿ç¨‹çš„ç®€å•è®¤è¯†è¿˜è®°å¾—è‡ªå·±å†™çš„mainæ–¹æ³•å—ï¼Ÿå®ƒåœ¨è¢«è¿è¡Œçš„é‚£ä¸€åˆ»å°±ç­‰äºä½ å¯åŠ¨äº†ä¸€ä¸ªjavaçº¿ç¨‹ï¼Œåªä¸è¿‡å®ƒç»“æŸçš„å¾ˆå¿«ï¼Œå› ä¸ºæˆ‘ä»¬çš„mainæ–¹æ³•é‡Œçš„é€»è¾‘æ‰§è¡Œå®Œå®ƒå°±ç»“æŸæ‰äº†ï¼Œç®€å•æ¥è¯´å°±æ˜¯è¿™ä¸ªçº¿ç¨‹å®Œæˆäº†å®ƒçš„ä½¿å‘½ï¼Œå¯ä»¥å½“åœºå»ä¸–äº†ã€‚ å†æ¥å‘æ•£ä¸‹æ€ç»´ï¼Œè¿˜è®°å¾—æˆ‘ä»¬å†™è¿‡çš„xxxç®¡ç†ç³»ç»Ÿå—ï¼Ÿä¸ºä»€ä¹ˆä½ å¯ä»¥ä¸€ç›´è¾“æŒ‡ä»¤ï¼Œå®ƒä¸€ç›´è¿è¡Œï¼Ÿæˆ‘ä»¬çœ‹åº·åº·ä»£ç ï¼š ä»£ç å—112345678910111213141516171819202122public static void main(String[] args) { StudentSystemView view = new StudentSystemView(); while (true) { //è¿™é‡Œæ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼ int opNum = view.home(); if (opNum == 0) { //ç»ˆæ­¢ç¨‹åº break; } else if (opNum == 1) { //éœ€è¦æ–°å¢å­¦ç”Ÿä¿¡æ¯ view.addStudent(); } else if (opNum == 2) { view.updateStudent(); } else if (opNum == 3) { view.delStudent(); } else if (opNum == 4) { view.getStudentById(); } else if (opNum == 5) { view.getAllStudents(); } else { System.out.println(\"è¯·è¾“å…¥æœ‰æ•ˆçš„æŒ‡ä»¤ï¼\"); } }} çœ‹ç¬¬ä¸‰è¡Œï¼Œä»€ä¹ˆæ˜¯æ­»å¾ªç¯å‘¢ï¼Ÿæ­»å¾ªç¯å°±æ˜¯æŒ‡ä¸€ä¸ªå¾ªç¯ä½“æœ¬èº«å¹¶ä¸ä¼šä¸»åŠ¨ç»“æŸï¼Œæ¯”å¦‚ä¾‹å­é‡Œçš„while(true)ï¼Œæˆ‘ä»¬å‰é¢è®²è¿‡whileçš„è¯­æ³•å«ä¹‰ï¼Œå½“ä¸€ä¸ªæ¡ä»¶æ»¡è¶³æ—¶ï¼Œå°±ç»§ç»­å¾ªç¯ï¼Œå½“è¿™ä¸ªæ¡ä»¶æ’ç­‰äºtrueï¼Œé‚£ä¹ˆæ„å‘³ç€è¿™ä¸ªå¾ªç¯ç¨‹åºä¼šä¸€ç›´æ‰§è¡Œä¸‹å»ï¼Œç›´åˆ°ä½ è¾“å…¥äº†æŒ‡ä»¤0ï¼Œé€šè¿‡breakå…³é”®è¯ç»ˆæ­¢å¾ªç¯ä½“æ‰ç®—çœŸæ­£ç¦»å¼€äº†è¿™ä¸ªæ­»å¾ªç¯ã€‚ ä¸ºä»€ä¹ˆè¦è¯´è¿™ä¸ªä¾‹å­ï¼Ÿå› ä¸ºå®ƒæ›´èƒ½ç›´è§‚çš„è¡¨è¾¾â€œçº¿ç¨‹â€è¿™ä¸ªä¸œè¥¿ï¼Œæˆ‘ä»¬æ¥è§£é‡Šä¸€ä¸‹çº¿ç¨‹ï¼š çº¿ç¨‹å°±æ˜¯è¿è¡Œä»£ç é€»è¾‘çš„æœ€åŸºæœ¬å•ä½ï¼Œæ¯ä¸€æ®µä»£ç é€»è¾‘ï¼Œéƒ½éœ€è¦çº¿ç¨‹æ¨åŠ¨å®ƒè¢«è¿è¡Œã€‚ å½“ä½ è¿è¡Œmainæ–¹æ³•æ—¶ï¼Œjvmå°±å·²ç»è‡ªåŠ¨å¼€å¯ä¸€ä¸ªçº¿ç¨‹å¸®ä½ è¿è¡Œä½ mainæ–¹æ³•é‡Œçš„ä»£ç äº†ï¼Œå› ä¸ºwhile(true)ä¸ä¼šè½»æ˜“ç»“æŸï¼Œæ‰€ä»¥è¿™ä¸ªçº¿ç¨‹ä¸ä¼šè½»æ˜“ç»“æŸï¼Œå¦‚æœä½ è¾“å…¥0ï¼Œbreakæ„å‘³ç€è·³å‡ºå¾ªç¯ä½“ï¼Œé‚£ä¹ˆä»£ç é€»è¾‘ä¹Ÿå°±è¿è¡Œå®Œæ¯•äº†ï¼Œæ­¤æ—¶çº¿ç¨‹è‡ªåŠ¨é”€æ¯ã€‚ ä½ ä¹‹å‰å†™è¿‡çš„ä»»ä½•ä»£ç éƒ½æ˜¯ï¼Œåªæ˜¯å®ƒä»¬ä¸åƒä¸Šé¢çš„æ­»å¾ªç¯é‚£æ ·ç”±äºè‡ªèº«é€»è¾‘ç‰¹ç‚¹ä¸ä¼šè®©è¿™ä¸ªçº¿ç¨‹ç«‹åˆ»é”€æ¯ï¼Œç¨‹åºä¸€æ—¦è¿è¡Œå®Œæ¯•ï¼Œçº¿ç¨‹ä¹Ÿå°±éšä¹‹é”€æ¯äº†ã€‚ äºŒã€å¤šçº¿ç¨‹ä¸€ä¸ªmainæ–¹æ³•è¢«è¿è¡Œåå¼€å¯è¿è¡Œå®ƒçš„çº¿ç¨‹ï¼Œæˆ‘ä»¬ç®¡è¿™ä¸ªçº¿ç¨‹å«â€ä¸»çº¿ç¨‹â€œï¼Œå…¶å®æ²¡å¿…è¦åˆ†é‚£ä¹ˆç»†ï¼Œåç§°ä¸é‡è¦ï¼Œåªéœ€è¦è®°ä½ï¼Œåœ¨ä»»æ„çº¿ç¨‹é‡Œéƒ½å¯ä»¥äº§ç”Ÿå­çº¿ç¨‹æ¥å¸®åŠ©ä½ åšä¸€äº›â€å¼‚æ­¥åŒ–â€œçš„æ“ä½œã€‚ 2.1ï¼šå¦‚ä½•å¼€å¯å­çº¿ç¨‹ï¼Ÿåœ¨javaé‡Œå¼€å¯å­çº¿ç¨‹çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬åªåˆ—ä¸¾ç°åœ¨æœ€å¸¸ç”¨çš„ï¼š ä»£ç å—2123456789public static void main(String[] args) { Thread t1 = new Thread(); t1.start(); //æ¯«æ— æ„ä¹‰çš„ä¸€ä¸ªçº¿ç¨‹è¢«åˆ›å»ºå¹¶è§¦å‘äº†ï¼Œè¿™ä¸ªçº¿ç¨‹ä¸ä¼šæ‰§è¡Œä»»ä½•é€»è¾‘ //é€šè¿‡ä¸‹é¢çš„æ–¹å¼å¯ä»¥åŠ ä¸Šä½ çš„é€»è¾‘ä»£ç ï¼Œè®©ç¨‹åºå˜å¾—æœ‰æ„ä¹‰ new Thread(() -&gt; { //è¿™é‡ŒåŠ ä¸Šä½ éœ€è¦å¼‚æ­¥çš„é€»è¾‘å— }).start();} è¿™æ ·è¯´å¤ªè™šäº†ï¼Œæˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­ï¼š ä»£ç å—31234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253public static void main(String[] args) { Thread t1 = new Thread(() -&gt; { int i = 1; //çº¿ç¨‹å†…è®¡æ•°å™¨ while (true) { try { Thread.sleep(100L); //çº¿ç¨‹ç¡çœ 100ms System.out.println(\"çº¿ç¨‹1ç¬¬\" + i + \"æ¬¡æ‰“å°\"); i++; if (i &gt; 10) { System.out.println(\"çº¿ç¨‹1æ‰“å°å®Œæ¯•~\"); break; } } catch (InterruptedException e) { e.printStackTrace(); } } }); t1.start(); //å¯åŠ¨çº¿ç¨‹1 Thread t2 = new Thread(() -&gt; { int i = 1; //çº¿ç¨‹å†…è®¡æ•°å™¨ while (true) { try { Thread.sleep(100L); //çº¿ç¨‹ç¡çœ 100ms System.out.println(\"çº¿ç¨‹2ç¬¬\" + i + \"æ¬¡æ‰“å°\"); i++; if (i &gt; 15) { System.out.println(\"çº¿ç¨‹2æ‰“å°å®Œæ¯•~\"); break; } } catch (InterruptedException e) { e.printStackTrace(); } } }); t2.start(); int i = 1; while (true) { try { Thread.sleep(100L); //çº¿ç¨‹ç¡çœ 100ms System.out.println(\"mainæ–¹æ³•çº¿ç¨‹ç¬¬\" + i + \"æ¬¡æ‰“å°\"); i++; if (i &gt; 12) { System.out.println(\"mainæ–¹æ³•çº¿ç¨‹æ‰“å°å®Œæ¯•~\"); break; } } catch (InterruptedException e) { e.printStackTrace(); } }} è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ‰“å°ï¼š ä»£ç å—412345678910111213141516171819202122232425262728293031323334353637383940çº¿ç¨‹1ç¬¬1æ¬¡æ‰“å°mainæ–¹æ³•çº¿ç¨‹ç¬¬1æ¬¡æ‰“å°çº¿ç¨‹2ç¬¬1æ¬¡æ‰“å°çº¿ç¨‹1ç¬¬2æ¬¡æ‰“å°çº¿ç¨‹2ç¬¬2æ¬¡æ‰“å°mainæ–¹æ³•çº¿ç¨‹ç¬¬2æ¬¡æ‰“å°çº¿ç¨‹2ç¬¬3æ¬¡æ‰“å°çº¿ç¨‹1ç¬¬3æ¬¡æ‰“å°mainæ–¹æ³•çº¿ç¨‹ç¬¬3æ¬¡æ‰“å°mainæ–¹æ³•çº¿ç¨‹ç¬¬4æ¬¡æ‰“å°çº¿ç¨‹2ç¬¬4æ¬¡æ‰“å°çº¿ç¨‹1ç¬¬4æ¬¡æ‰“å°mainæ–¹æ³•çº¿ç¨‹ç¬¬5æ¬¡æ‰“å°çº¿ç¨‹1ç¬¬5æ¬¡æ‰“å°çº¿ç¨‹2ç¬¬5æ¬¡æ‰“å°çº¿ç¨‹2ç¬¬6æ¬¡æ‰“å°çº¿ç¨‹1ç¬¬6æ¬¡æ‰“å°mainæ–¹æ³•çº¿ç¨‹ç¬¬6æ¬¡æ‰“å°çº¿ç¨‹2ç¬¬7æ¬¡æ‰“å°mainæ–¹æ³•çº¿ç¨‹ç¬¬7æ¬¡æ‰“å°çº¿ç¨‹1ç¬¬7æ¬¡æ‰“å°mainæ–¹æ³•çº¿ç¨‹ç¬¬8æ¬¡æ‰“å°çº¿ç¨‹2ç¬¬8æ¬¡æ‰“å°çº¿ç¨‹1ç¬¬8æ¬¡æ‰“å°çº¿ç¨‹2ç¬¬9æ¬¡æ‰“å°mainæ–¹æ³•çº¿ç¨‹ç¬¬9æ¬¡æ‰“å°çº¿ç¨‹1ç¬¬9æ¬¡æ‰“å°çº¿ç¨‹1ç¬¬10æ¬¡æ‰“å°çº¿ç¨‹1æ‰“å°å®Œæ¯•~mainæ–¹æ³•çº¿ç¨‹ç¬¬10æ¬¡æ‰“å°çº¿ç¨‹2ç¬¬10æ¬¡æ‰“å°çº¿ç¨‹2ç¬¬11æ¬¡æ‰“å°mainæ–¹æ³•çº¿ç¨‹ç¬¬11æ¬¡æ‰“å°çº¿ç¨‹2ç¬¬12æ¬¡æ‰“å°mainæ–¹æ³•çº¿ç¨‹ç¬¬12æ¬¡æ‰“å°mainæ–¹æ³•çº¿ç¨‹æ‰“å°å®Œæ¯•~çº¿ç¨‹2ç¬¬13æ¬¡æ‰“å°çº¿ç¨‹2ç¬¬14æ¬¡æ‰“å°çº¿ç¨‹2ç¬¬15æ¬¡æ‰“å°çº¿ç¨‹2æ‰“å°å®Œæ¯•~ æ˜¯ä¸æ˜¯è§‰å¾—æ‚ä¹±æ— ç« ï¼Ÿæ²¡å…³ç³»ï¼Œæˆ‘ä»¬æ¥è¯•å›¾ä½¿ç”¨æµç¨‹å›¾æ¥è¯´æ˜ä¸‹å®ƒçš„è¿è¡Œè¿‡ç¨‹ï¼š æˆ‘ä»¬è¿™ä¸ªç¨‹åºé‡Œï¼Œä¸€å…±åŒ…å«ä¸‰ä¸ªçº¿ç¨‹ï¼š è¿è¡Œmainæ–¹æ³•çš„çº¿ç¨‹ è¿è¡Œçº¿ç¨‹1é€»è¾‘å—çš„çº¿ç¨‹ è¿è¡Œçº¿ç¨‹2é€»è¾‘å—çš„çº¿ç¨‹ å®ƒä»¬ä¸€èµ·è¿è¡Œï¼Œç„¶åå„è‡ªæ‰§è¡Œè‡ªå·±çš„é€»è¾‘ï¼š å¦‚å›¾å¯çŸ¥ï¼Œçº¿ç¨‹æ˜¯è¿è¡Œç¨‹åºå—çš„æœ€åŸºæœ¬å•ä½ï¼Œä¸€æ—¦çº¿ç¨‹å¯åŠ¨åï¼Œå®ƒæ˜¯è·Ÿå…¶ä»–çº¿ç¨‹ä¸€èµ·è¿è¡Œçš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä½ çœ‹åˆ°çš„å¤„ç†ç»“æœé‚£ä¹ˆæ‚ä¹±æ— ç« çš„åŸå› ï¼Œä½†æ˜¯ä½ ä¼šå‘ç°ï¼Œå®ƒå°±åªæ˜¯æ‚ä¹±è€Œå·²ï¼Œä»”ç»†çœ‹æ¯ä¸ªçº¿ç¨‹çš„æ‰“å°ç»“æœï¼Œå®ƒæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œä»ç„¶å¯ä»¥ä¿è¯æ¯ä¸ªçº¿ç¨‹é‡Œçš„é€»è¾‘æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚ çº¿ç¨‹æ˜¯å¦‚ä½•çœ‹èµ·æ¥â€åŒæ—¶â€œè¿è¡Œçš„å‘¢ï¼Ÿè®©æˆ‘ä»¬æ¥çœ‹å¼ å›¾ï¼š çœ‹èµ·æ¥åœ¨ä¸€èµ·æ‰§è¡Œçš„åŸå› ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬è¿è¡Œç¨‹åºçš„æ ¸å¿ƒï¼Œä¹Ÿå°±æ˜¯CPUï¼Œå®ƒåœ¨ä¸æ–­çš„åˆ‡æ¢çº¿ç¨‹ä¸Šä¸‹æ–‡ï¼Œè®©è¿™ä¸‰ä¸ªçº¿ç¨‹â€çœ‹èµ·æ¥åœ¨åŒæ—¶è¿è¡Œâ€œï¼Œä½ åªéœ€è¦å…³æ³¨ç»¿çº¿éƒ¨åˆ†å³å¯ï¼Œå› ä¸ºä¸ç®¡CPUå¦‚ä½•åˆ‡æ¢è‡ªå·±åˆ°ä¸åŒçš„çº¿ç¨‹è¿è¡Œç¨‹åºï¼Œä½†å®é™…äººè‚‰çœ¼çœ‹åˆ°çš„å°±æ˜¯ï¼Œå®ƒä»¬éƒ½åœ¨åŒæ—¶è¿è¡Œï¼Œä½†ä½ è¦çŸ¥é“ï¼Œè¿™æ˜¯CPUåˆ‡æ¢ç€çº¿ç¨‹çš„ä¸Šä¸‹æ–‡æ¥è¿è¡Œçš„ï¼Œæˆ‘ä»¬å¸¸è¯´çš„CPUåˆ©ç”¨ç‡ä¸é«˜çš„é—®é¢˜ä¸»è¦å°±æ˜¯æˆ‘ä»¬åˆ©ç”¨å•çº¿ç¨‹æˆ–è¾ƒå°‘çš„çº¿ç¨‹å®Œæˆåºå¤§å¤æ‚çš„ç¨‹åºï¼Œæ²¡æœ‰å……åˆ†åˆ©ç”¨å¤šçº¿ç¨‹çš„ä¼˜åŠ¿å»è§£å†³é—®é¢˜ã€‚ 2.2ï¼šå¤šçº¿ç¨‹ä¸java webæˆ‘ä»¬åˆšåˆšè®²äº†mainæ–¹æ³•ï¼Œå›å¿†ä¸€ä¸‹æˆ‘ä»¬å‰é¢è¯´è¿‡çš„tomcatï¼Œæˆ‘ä»¬çš„servletç¨‹åºæ˜¯å¦‚ä½•è¢«è§¦å‘è¿è¡Œçš„å‘¢ï¼Ÿæˆ‘ä»¬å†æ¥è´´ä¸€ä¸‹ä¹‹å‰servletçš„ä»£ç ï¼Œè¿™æ¬¡æˆ‘ä»¬æ‰“å°ä¸€ä¸‹è¿è¡Œå®ƒçš„çº¿ç¨‹çš„åå­—ï¼š ä»£ç å—5123456789101112131415161718public class StudentInfoController extends HttpServlet { private StudentDao studentDao = new StudentDao(); @Override protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { resp.setContentType(\"application/json\"); try { Student result = studentDao.getStudentInfo(); resp.getOutputStream().write(JSON.toJSONBytes(result)); resp.setStatus(200); System.out.println(Thread.currentThread().getName()); //ä½¿ç”¨çº¿ç¨‹ç±»çš„currentThreadé™æ€æ–¹æ³•å¯ä»¥å–åˆ°æ‰§è¡Œå½“å‰ä»£ç çš„çº¿ç¨‹å¯¹è±¡ } catch (Exception e) { e.printStackTrace(); resp.setStatus(500); } }} æˆ‘ä»¬åœ¨æ¥å£å‘ç”Ÿè°ƒç”¨æ—¶å°è¯•æ‰“å°ä¸€ä¸‹æ‰§è¡Œè¯¥æ¥å£çš„çº¿ç¨‹çš„åå­—ã€‚ è¿è¡Œæ‰“å°å¦‚ä¸‹ï¼š ä»£ç å—61http-nio-8081-exec-5 å®ƒçš„åå­—å«http-nio-xxxxï¼Œè¿™æ˜¯tomcatè¿è¡Œæ—¶ï¼Œç”¨æ¥åˆ†é…æ‰§è¡Œä¸šåŠ¡é€»è¾‘çš„çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å†™çš„ä¸šåŠ¡ä»£ç è¢«æ”¾è¿›tomcatèº«ä½“åï¼Œå°±å…¨éƒ¨ç”±tomcatè§¦å‘äº†ï¼Œæ‰€ä»¥è¿è¡Œæˆ‘ä»¬servletç¨‹åºçš„çº¿ç¨‹è‚¯å®šéƒ½ç”±tomcatåˆ†é…ã€‚ è¿™è·Ÿæ‰§è¡Œmainæ–¹æ³•è¿˜ä¸ä¸€æ ·ï¼Œmainæ–¹æ³•æ˜¯ç›´æ¥ç”±jvmåˆ†é…çš„ï¼Œè€Œtomcatä¸»ç¨‹åºè‚¯å®šä¹Ÿæ˜¯jvmåˆ†é…çº¿ç¨‹è¿è¡Œçš„ï¼ˆä¹‹å‰è¯´è¿‡tomcatæœ¬èº«ä¹Ÿæ˜¯javaå†™çš„ï¼‰ï¼Œç„¶åtomcatè‡ªå·±ä½œä¸ºç‹¬ç«‹è¿è¡Œçš„ç¨‹åºï¼Œå°±åƒæˆ‘ä»¬å¼€å§‹ä¸¾çš„é‚£ä¸ªmainæ–¹æ³•çš„ä¾‹å­ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥äº§ç”Ÿçº¿ç¨‹ï¼Œç”¨æ¥è¿è¡Œæˆ‘ä»¬çš„servletã€‚é‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥åœ¨æˆ‘ä»¬çš„æ¥å£é‡Œå¼€çº¿ç¨‹å¼‚æ­¥å¤„ç†ä¸€äº›äº‹æƒ…å‘¢ï¼Ÿæ¯”å¦‚æˆ‘ä»¬ç°åœ¨æ¥å£é‡Œæœ‰ä¸€æ®µä»£ç ï¼Œå‡è®¾éœ€è¦è€—æ—¶200msï¼Œä½†æ˜¯æˆ‘ä»¬è¿™ä¸ªæ¥å£çš„å“åº”æ—¶é—´è¦æ±‚ä¸è¶…è¿‡100msï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿå¼‚æ­¥å°±æ˜¯æœ€å¥½çš„åŠæ³•ï¼š ä»£ç å—712345678910111213141516@Overrideprotected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { resp.setContentType(\"application/json\"); try { Student result = studentDao.getStudentInfo(); //ä¸‹é¢è¿™æ®µä»£ç è€—æ—¶å¾ˆä¹…ï¼Œä¸€ä¸‹å­è¦200msï¼Œä½†æˆ‘ä»¬è¿™ä¸ªæ¥å£éœ€è¦åœ¨100mså°±è¿”å›ï¼Œè€Œä¸”è¿™æ®µè€—æ—¶è¾ƒä¹…çš„é€»è¾‘è¿˜ä¸å½±å“ä½ çš„ä¸»ä¸šåŠ¡æµç¨‹äº¤äº’ Thread.sleep(200); //è¿™é‡Œç”¨çº¿ç¨‹ç¡çœ çš„æ–¹å¼æ¨¡æ‹Ÿè¿è¡Œæ—¶é—´200msçš„ç¨‹åºæ®µ resp.getOutputStream().write(JSON.toJSONBytes(result)); resp.setStatus(200); } catch (Exception e) { e.printStackTrace(); resp.setStatus(500); }} å¦‚ä¸Šï¼Œåˆ©ç”¨sleepæ¨¡æ‹Ÿäº†ä¸€æ®µè¿è¡Œè¶…æ…¢çš„ä»£ç å—ï¼Œæ³¨æ„è¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿï¼ˆâš ï¸ æ³¨ï¼šç±»ä¼¼è¿™ç§ä»£ç é€»è¾‘ç‰¹åˆ«å¤æ‚çš„ä»£ç åªå¯èƒ½å‡ºç°åœ¨Serviceå±‚ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†è¯´æ˜é—®é¢˜å†™åœ¨äº†ç½‘å…³ä¹Ÿå°±æ˜¯servletå±‚ï¼‰ã€‚æ€ä¹ˆä¼˜åŒ–å‘¢ï¼Ÿé¦–å…ˆä¸Šé¢å·²ç»è¯´äº†ï¼Œè¿™æ®µä»£ç æ˜¯æ¯æ¬¡éƒ½ä¼šè¿è¡Œï¼Œä½†æ˜¯å®ƒä¸å½±å“student_infoçš„è¾“å‡ºï¼Œé‚£ä¹ˆå°±å¾ˆé€‚åˆæŠŠå®ƒå¼‚æ­¥å‡ºå»ï¼Œè¿™æ ·æ”¹å³å¯ï¼š ä»£ç å—812345678910111213141516171819202122@Overrideprotected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { resp.setContentType(\"application/json\"); try { Student result = studentDao.getStudentInfo(); //å¼‚æ­¥ new Thread(() -&gt; { try { Thread.sleep(200); } catch (Exception e) { e.printStackTrace(); } }).start(); resp.getOutputStream().write(JSON.toJSONBytes(result)); resp.setStatus(200); } catch (Exception e) { e.printStackTrace(); resp.setStatus(500); }} è¿™æ ·ï¼Œæˆ‘ä»¬è¿™ä¸ªæ¥å£çš„é‚£200msçš„å¤æ‚é€»è¾‘å°±ä¼šåœ¨ä¸å½±å“æˆ‘ä»¬ä¸»é¢˜é€»è¾‘çš„å“åº”é€Ÿåº¦çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡åˆ«çš„çº¿ç¨‹å»è¿è¡Œäº†~ ä¸‰ã€è¿›ç¨‹å‰é¢è®²å®Œäº†çº¿ç¨‹ï¼Œä½ å°±äº†è§£äº†ï¼Œå®ƒæ˜¯è¿è¡Œç¨‹åºæ—¶çš„æœ€å°å•ä½ï¼Œç”±CPUæ¥è´Ÿè´£è§¦å‘æ‰§è¡Œï¼Œå®ƒæ˜¯æœ‰çŠ¶æ€çš„ï¼Œå®ƒå¯ä»¥è¢«startè§¦å‘è¿›å…¥è¿è¡ŒçŠ¶æ€ï¼Œä¹Ÿå¯ä»¥é€šè¿‡sleepæ¥ç”±è¿è¡ŒçŠ¶æ€å˜æˆç¡çœ çŠ¶æ€ã€‚é‚£ä¹ˆè¿›ç¨‹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ ç®€å•æ¥è¯´ï¼Œtomcatæ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªmainæ–¹æ³•åœ¨è¿è¡Œæ—¶æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œä½ çš„QQæ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œä½ çš„æµè§ˆå™¨ä¹Ÿæ˜¯ï¼›è¿›ç¨‹å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„è¿è¡Œç€çš„ä¸€ä¸ªä¸ªç¨‹åºï¼Œç¨‹åºåŒ…å«éœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤ç ï¼ˆæˆ‘ä»¬å†™çš„javaæºä»£ç è¢«ç¼–è¯‘åä¹Ÿæ˜¯ä¸€ä¸ªä¸ªçš„æŒ‡ä»¤ï¼Œä½ å¯ä»¥ç†è§£å®ƒå°±æ˜¯ä½ ç¼–å†™çš„ç¨‹åºï¼‰ï¼ŒåŒ…å«å¤šä¸ªçº¿ç¨‹ï¼ˆçº¿ç¨‹æ˜¯è¿è¡Œè¿™äº›æŒ‡ä»¤ç çš„æœ€å°å•ä½ï¼Œç”±CPUä¸æ–­åˆ‡æ¢çº¿ç¨‹ä¸Šä¸‹æ–‡æ¥å®Œæˆè¿è¡Œï¼‰ã€‚ ä½ å¯ä»¥åˆ©ç”¨çº¿ç¨‹åšå¾ˆå¤šç¥å¥‡çš„äº‹æƒ…ï¼Œæˆ‘ä»¬åœ¨åé¢çš„æ–‡ç« é‡Œå°†ä¼šä»‹ç»åˆ°ã€‚","link":"/2020/03/31/LV5-1%EF%BC%9A%E8%BF%9B%E7%A8%8B%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%E7%BA%BF%E7%A8%8B%E5%8F%88%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/"},{"title":"LV4-5ï¼šç½‘ç»œé€šä¿¡ã€åè®®ã€åºåˆ—åŒ–ã€ç¨‹åºä¹‹é—´çš„è”ç³»","text":"âš“ï¸ å‰æ’æç¤ºï¼š æœ¬ç¯‡ç¬¬ä¸€éƒ¨åˆ†çš„å¤§éƒ¨åˆ†å†…å®¹æ¥æºï¼š https://www.bilibili.com/video/BV1EW411u7th?p=28 https://www.bilibili.com/video/BV1EW411u7th?p=29 https://www.bilibili.com/video/BV1EW411u7th?p=30 æœ¬ç¯‡ç¬¬ä¸€éƒ¨åˆ†ä»…åšè®¡ç®—æœºç½‘ç»œçš„ç®€å•ä»‹ç»ï¼Œæ—¨åœ¨å¸®åŠ©ä½ æ¢³ç†ä½ å†™çš„javaä¸šåŠ¡ç¨‹åºåœ¨å…¨å±€å……å½“ä¸€ä¸ªæ€æ ·çš„åœ°ä½ï¼Œå¦å¤–ä¸€ä¸ªç›®çš„æ˜¯ä¸ºäº†å¼•å…¥tomcatä¸java webç¨‹åºï¼Œè¿˜æœ‰httpæ˜¯æ€ä¹ˆå›äº‹ï¼Œå¸¸è¯´çš„å»ºè¿å’Œä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹åˆæ˜¯æŒ‡ä»€ä¹ˆï¼ˆå¦‚æœä½ æ˜¯è®¡ç®—æœºç§‘ç­çš„è¯ï¼Œå¯¹è¿™äº›åº”è¯¥ä¼šæ¯”è¾ƒç†Ÿæ‚‰ï¼Œå¦‚æœå¿˜äº†ä¹Ÿä¸è¦ç´§ï¼Œè¿™é‡Œä¼šå†é‡æ–°å¸®ä½ æ¢³ç†ä¸€ä¸‹ï¼‰ã€‚çœ‹æ‡‚ç¬¬ä¸€éƒ¨åˆ†åï¼Œä½ ä¼šå¾ˆå®¹æ˜“çš„ç†è§£tomcatæ˜¯ä»€ä¹ˆï¼Œæµè§ˆå™¨æ˜¯ä»€ä¹ˆï¼Œç„¶åä½ ç”šè‡³å¯ä»¥å‘æ•£ä¸‹æ€ç»´ï¼Œæˆ‘ä»¬å¸¸è¯´çš„RPCæ¡†æ¶åˆæ˜¯å•¥ã€‚çœ‹æ‡‚ç¬¬ä¸€éƒ¨åˆ†åï¼Œç¬¬äºŒéƒ¨åˆ†çš„åºåˆ—åŒ–ä»¥åŠä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–ä»¥åŠjsonæ˜¯ä»€ä¹ˆå°±æ›´åŠ å®¹æ˜“ç†è§£äº†ï¼Œä¹‹ååˆ©ç”¨SDKè¿æ¥æ“ä½œmysqlã€redisç­‰æœåŠ¡ç«¯ï¼Œä½ ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“ç†è§£ï¼Œçœ‹æ‡‚ç¬¬ä¸€éƒ¨åˆ†åï¼Œä½ å¯ä»¥å°è¯•è‡ªå­¦ä¸‹javaçš„å¥—æ¥å­—Socketéƒ¨åˆ†çš„å†…å®¹ï¼Œå½“ç„¶æ²¡å…´è¶£ä¹Ÿå¯ä»¥ä¸å­¦ï¼Œå› ä¸ºå¹¸è¿çš„æ˜¯ï¼Œtomcatç­‰webæœåŠ¡å™¨ç¨‹åºå·²ç»å¸®ä½ è§„é¿æ‰è¿™éƒ¨åˆ†çš„å¼€å‘äº†ï¼Œä½ è¦åšçš„æ˜¯ä¸šåŠ¡ä»£ç çš„å¼€å‘ ä¸€ã€ç½‘ç»œå‘å±•å²ä½ åœ¨è®¡ç®—æœºä¸Šè¯·æ±‚ä¸€ä¸ªç½‘ç«™çš„æ•°æ®ï¼Œéœ€è¦å‘èµ·ä¸€ä¸ªhttpè¯·æ±‚ï¼Œç„¶åä½ ä¼ è¾“çš„å‚æ•°ä»¥åŠpathä¿¡æ¯æ¼‚æ´‹è¿‡æµ·è·‘åˆ°è¯¥ç½‘ç«™çš„æœåŠ¡å™¨ä¸Šï¼ˆrequestï¼‰ï¼ŒæœåŠ¡å™¨æ”¶åˆ°ä½ çš„è¯·æ±‚åï¼Œæ‰¾åˆ°å¯¹åº”çš„ç¨‹åºï¼Œè§£æå‡ºæ¥ä½ ä¼ çš„å‚æ•°å’Œpathï¼Œè¿™ä¸ªæ—¶å€™è¯¥ç¨‹åºå†…éƒ¨å¯¹åº”pathçš„é€»è¾‘å°†è¢«è§¦å‘ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œä½ å·²ç»æˆåŠŸè¿›å…¥æœåŠ¡ç«¯ç¨‹åºçš„å†…éƒ¨äº†ï¼Œç»è¿‡ä¸€ç³»åˆ—å†…éƒ¨é€»è¾‘çš„å¤„ç†ï¼ŒæœåŠ¡ç«¯å°†å¤„ç†ç»“æœå†æ¬¡é€šè¿‡httpåè®®å°†æ•°æ®åŒ…å‘é€åˆ°ä½ çš„ç”µè„‘ä¸Šï¼ˆresponseï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹åœ¨ç½‘ç»œç•…é€šå’Œå¯¹æ–¹æœåŠ¡ç«¯ç¨‹åºæ²¡æœ‰ç“¶é¢ˆçš„æ¡ä»¶ä¸‹ï¼Œå¯èƒ½åœ¨æçŸ­çš„æ—¶é—´å†…å°±ä¼šå®Œæˆï¼ˆä»¥æ¯«ç§’ç”šè‡³çº³ç§’è®¡ï¼‰ï¼Œå³ä¾¿çœŸå®çš„æœåŠ¡å™¨å¯èƒ½ç¦»ä½ å‡ ç™¾å…¬é‡Œã€‚ è¿™ä¸ªè¿‡ç¨‹é‡Œå‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿ 1.1ï¼šå±€åŸŸç½‘1.1.1ï¼šä»¥å¤ªç½‘ç®€ä»‹æ¯«æ— ç–‘é—®ï¼Œç”¨æˆ·åœ¨å…¨çƒç½‘ç»œä¸­å‘é€å’Œæ¥æ”¶ä¿¡æ¯çš„èƒ½åŠ›ï¼Œæ°¸è¿œæ”¹å˜äº†è¿™ä¸ªä¸–ç•Œã€‚150å¹´å‰ï¼Œå‘ä¸€å°ä¿¡ä»¶ä»ä¼¦æ•¦åˆ°åŠ å·è¦èŠ±2~3å‘¨ï¼Œè€Œä¸”è¿˜æ˜¯ç‰¹å¿«é‚®ä»¶ï¼Œå¦‚ä»Šï¼Œç”µå­é‚®ä»¶åªè¦å‡ åˆ†ä¹‹ä¸€ç§’ï¼Œæ—¶å»¶æ”¹å˜äº†ä¸Šç™¾ä¸‡å€ï¼ŒæŒ¯å…´äº†å…¨çƒç»æµï¼Œå¸®åŠ©ç°ä»£ä¸–ç•Œåœ¨éå¸ƒå…¨çƒçš„å…‰çº¤ä¸­å¿«é€Ÿå‘å±•ã€‚ä½ å¯èƒ½è§‰å¾—è®¡ç®—æœºå’Œç½‘ç»œå¯†åˆ‡ç›¸å…³ï¼Œä½†äº‹å®ä¸Šï¼Œ1970å¹´ä»¥å‰ï¼Œå¤§å¤šæ•°è®¡ç®—æœºæ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œç„¶è€Œï¼Œå› ä¸ºå¤§å‹è®¡ç®—æœºå¼€å§‹éšå¤„å¯è§ï¼Œå»‰ä»·æœºå™¨å¼€å§‹å‡ºç°åœ¨ä¹¦æ¡Œä¸Šï¼Œåˆ†äº«æ•°æ®å’Œèµ„æºæ¸æ¸å˜å¾—æœ‰ç”¨èµ·æ¥ï¼Œé¦–ä¸ªè®¡ç®—æœºç½‘ç»œå‡ºç°äº†ã€‚ ç¬¬ä¸€ä¸ªè®¡ç®—æœºç½‘ç»œå‡ºç°åœ¨1950~1960å¹´ä»£ï¼Œé€šå¸¸åœ¨å…¬å¸æˆ–ç ”ç©¶å®¤å†…éƒ¨ä½¿ç”¨ï¼Œä¸ºäº†æ–¹ä¾¿ä¿¡æ¯äº¤æ¢ï¼Œæ¯”æŠŠçº¸å¡æˆ–ç£å¸¦é€åˆ°å¦ä¸€æ ‹æ¥¼é‡Œæ›´å¿«é€Ÿå¯é ï¼Œè¿™å«â€œçƒé‹ç½‘ç»œâ€ï¼Œç¬¬äºŒä¸ªå¥½å¤„æ˜¯èƒ½å…±äº«ç‰©ç†èµ„æºï¼Œä¸¾ä¸ªä¾‹å­ï¼Œä¸å…¶æ¯å°ç”µè„‘é…ä¸€å°æ‰“å°æœºï¼Œå¤§å®¶å¯ä»¥å…±äº«ä¸€å°è”ç½‘çš„æ‰“å°æœºï¼Œæ—©æœŸç½‘ç»œä¹Ÿä¼šå…±äº«å­˜å‚¨ç©ºé—´ï¼Œå› ä¸ºæ¯å°ç”µè„‘éƒ½é…å­˜å‚¨å™¨å¤ªè´µäº†ï¼Œè®¡ç®—æœºè¿‘è·ç¦»æ„æˆçš„å°å‹ç½‘ç»œå«åšå±€åŸŸç½‘ï¼Œç®€ç§°LANï¼Œå±€åŸŸç½‘èƒ½å°åˆ°æ˜¯åŒä¸€ä¸ªæˆ¿é—´é‡Œçš„ä¸¤å°æœºå™¨ï¼Œæˆ–å¤§åˆ°æ ¡å›­é‡Œçš„ä¸Šåƒå°æœºå™¨ï¼Œå°½ç®¡å¼€å‘å’Œéƒ¨ç½²äº†å¾ˆå¤šä¸åŒçš„LANæŠ€æœ¯ï¼Œå…¶ä¸­æœ€è‘—åå’ŒæˆåŠŸçš„æ˜¯â€œä»¥å¤ªç½‘â€ï¼ˆè‹±æ–‡åç§°ï¼šEthernetï¼‰ï¼Œå¼€å‘äº1970å¹´ä»£ï¼Œåœ¨æ–½ä¹çš„â€œå¸•æ´›é˜¿å°”æ‰˜ç ”ç©¶ä¸­å¿ƒâ€è¯ç”Ÿï¼Œä»Šå¤©ä»è¢«å¹¿æ³›ä½¿ç”¨ã€‚ä»¥å¤ªç½‘çš„æœ€ç®€å•å½¢å¼æ˜¯ï¼šä¸€æ¡ä»¥å¤ªç½‘ç”µçº¿è¿æ¥æ•°å°è®¡ç®—æœºï¼š 1.1.2ï¼šæ•°æ®ä¼ è¾“å½“ä¸€å°è®¡ç®—æœºè¦ä¼ æ•°æ®ç»™å¦ä¸€å°è®¡ç®—æœºæ—¶ï¼Œå®ƒä»¥ç”µä¿¡å·å½¢å¼ï¼Œå°†æ•°æ®ä¼ å…¥ç”µç¼†ï¼Œå½“ç„¶ï¼Œç”±äºç”µç¼†æ˜¯å…±äº«çš„ï¼Œè¿åœ¨åŒä¸€ä¸ªç½‘ç»œé‡Œçš„å…¶ä»–è®¡ç®—æœºä¹Ÿèƒ½çœ‹å¾—åˆ°æ•°æ®ï¼š å¦‚å›¾2ç”±Aå‘å‡ºçš„æ•°æ®ä¼šè¢«BCDEFæ¥åˆ°ï¼Œæ­£å› å¦‚æ­¤ï¼Œå®ƒä»¬ä¸çŸ¥é“Aå‘å‡ºçš„è¿™äº›æ•°æ®æ˜¯ç»™å®ƒä»¬ä¸­çš„å“ªä¸€ä¸ªçš„ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»¥å¤ªç½‘éœ€è¦æ¯å°è®¡ç®—æœºæœ‰å”¯ä¸€çš„åª’ä½“è®¿é—®æ§åˆ¶åœ°å€ï¼Œç®€ç§°MACåœ°å€ï¼Œè¿™ä¸ªåœ°å€æ”¾åˆ°æ•°æ®çš„å¤´éƒ¨ï¼Œä½œä¸ºæ•°æ®çš„å‰ç¼€å‘é€åˆ°ç½‘ç»œä¸­ï¼Œæ‰€ä»¥è®¡ç®—æœºåªéœ€è¦ç›‘å¬ä»¥å¤ªç½‘ç”µç¼†ï¼Œåªæœ‰åŒ¹é…åˆ°è‡ªå·±çš„MACåœ°å€æ‰å»å¤„ç†æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹å¦‚ä¸‹ï¼š è¿™è¿ä½œçš„å¾ˆå¥½ï¼Œç°åœ¨åˆ¶é€ çš„æ¯ä¸€å°è®¡ç®—æœºéƒ½è‡ªå¸¦å”¯ä¸€MACåœ°å€ç”¨äºä»¥å¤ªç½‘å’Œæ— çº¿ç½‘ç»œã€‚ å¤šå°ç”µè„‘å…±äº«ä¸€ä¸ªä¼ è¾“åª’ä»‹ï¼Œè¿™ç§æ–¹æ³•å«åšâ€œè½½æ³¢ä¾¦å¬å¤šè·¯è®¿é—®â€ï¼Œç®€ç§°â€œCSMAâ€ï¼Œè¿™é‡Œçš„è½½ä½“æŒ‡çš„å°±æ˜¯è¿è¾“æ•°æ®çš„å…±äº«åª’ä»‹ï¼Œä»¥å¤ªç½‘çš„è½½ä½“æ˜¯é“œçº¿ï¼ŒWIFIçš„è½½ä½“æ˜¯ä¼ æ’­æ— çº¿ç”µæ³¢çš„ç©ºæ°”ã€‚å¾ˆå¤šè®¡ç®—æœºåŒæ—¶ä¾¦å¬è½½ä½“ï¼Œæ‰€ä»¥å«â€œä¾¦å¬â€å’Œå¤šè·¯è®¿é—®ï¼Œè€Œè½½ä½“ä¼ è¾“æ•°æ®çš„é€Ÿåº¦å«â€œå¸¦å®½â€ã€‚ 1.1.3ï¼šå†²çªåŸŸä¸å¹¸çš„æ˜¯ï¼Œä½¿ç”¨å…±äº«è½½ä½“æœ‰ä¸ªå¾ˆå¤§çš„å¼Šç«¯ï¼Œå½“ç½‘ç»œæµé‡è¾ƒå°æ—¶ï¼Œè®¡ç®—æœºå¯ä»¥ç­‰å¾…è½½ä½“æ¸…ç©ºï¼Œç„¶åä¼ é€æ•°æ®ï¼Œä½†éšç€ç½‘ç»œæµé‡çš„ä¸Šå‡ï¼Œä¸¤å°è®¡ç®—æœºæƒ³è¦åŒæ—¶å†™å…¥æ•°æ®çš„æ¦‚ç‡ä¹Ÿä¼šä¸Šå‡ï¼Œæ¯”å¦‚Aæœºå’ŒFæœºåŒæ—¶å‘å‡ºä¸€ä¸ªæ•°æ®åŒ…ï¼š çœ‹ï¼Œå…±äº«è½½ä½“å†²çªäº†ã€‚å°±åƒä¸¤ä¸ªäººæ‰“ç”µè¯ï¼Œä»–ä»¬åŒæ—¶åœ¨ç”µè¯é‡Œè®²è¯ä¸€æ ·ã€‚å¹¸è¿çš„æ˜¯ï¼Œè®¡ç®—æœºèƒ½å¤Ÿç›‘å¬ç”µçº¿ä¸­çš„ä¿¡å·æ£€æµ‹è¿™äº›å†²çªï¼Œæœ€æ˜æ˜¾çš„è§£å†³åŠæ³•æ˜¯åœæ­¢ä¼ è¾“ï¼Œç­‰å¾…ç½‘ç»œç©ºé—²ï¼Œç„¶åå†è¯•ä¸€æ¬¡ï¼Œé—®é¢˜æ˜¯ï¼Œå…¶ä»–è®¡ç®—æœºä¹Ÿæ‰“ç®—è¿™æ ·åšï¼Œå…¶ä»–ç­‰å¾…ç€çš„è®¡ç®—æœºå¯èƒ½åœ¨ä»»ä½•åœé¡¿é—´éš™é—¯å…¥ï¼Œå¯¼è‡´è¶Šæ¥è¶Šå¤šå†²çªï¼Œå¾ˆå¿«æ¯ä¸ªäººéƒ½ä¸€ä¸ªæ¥ä¸€ä¸ªçš„è®²è¯ï¼Œè€Œä¸”æœ‰ä¸€å †äº‹è¦è¯´ï¼Œå°±åƒåœ¨å®¶åº­èšé¤æ—¶å’Œç”·æœ‹å‹åˆ†æ‰‹ä¸€æ ·ï¼Œè¿™å¯ä¸æ˜¯ä¸ªå¥½ä¸»æ„ã€‚ä»¥å¤ªç½‘æœ‰ä¸ªè¶…ç®€å•æœ‰æ•ˆçš„æ–¹æ³•ï¼Œå½“è®¡ç®—æœºæ£€æµ‹åˆ°å†²çªï¼Œå°±ä¼šåœ¨é‡ä¼ ä¹‹å‰ç­‰å¾…ä¸€å°æ®µæ—¶é—´ï¼Œå› ä¸ºè¦ä¸¾ä¾‹ï¼Œå‡è®¾æ˜¯ä¸€ç§’å¥½äº†ï¼Œå½“ç„¶ï¼Œå¦‚æœæ‰€æœ‰çš„è®¡ç®—æœºéƒ½ç”¨åŒæ ·çš„ç­‰å¾…æ—¶é—´æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºå®ƒä»¬ä¼šåœ¨1så†æ¬¡å†²çªï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶é—´æ˜¯éšæœºçš„ï¼Œè¿™æ ·å°±ä¿è¯äº†æ¯å°æœºå™¨ä¸‹æ¬¡é‡è¯•çš„æ—¶é—´éƒ½ä¸ä¸€æ ·ï¼Œç„¶åå¤§å¹…åº¦é™ä½å†²çªæ¦‚ç‡ï¼Œè¿™æœ‰ç”¨ï¼Œä½†ä¸èƒ½å®Œå…¨è§£å†³é—®é¢˜ï¼Œæ‰€ä»¥è¦ç”¨å¦ä¸€ä¸ªå°æŠ€å·§ï¼Œæ­£å¦‚æˆ‘åˆšæ‰è¯´çš„ï¼Œå¦‚æœä¸€å°è®¡ç®—æœºåœ¨ä¼ è¾“æ•°æ®æœŸé—´æ£€æµ‹åˆ°å†²çªï¼Œä¼šç­‰1ç§’+éšæœºæ—¶é—´ï¼Œç„¶è€Œå¦‚æœå†æ¬¡å‘ç”Ÿå†²çªï¼Œåˆ™è¡¨æ˜æœ‰ç½‘ç»œæ‹¥å¡ï¼Œè¿™æ¬¡ä¸å†ç­‰1sï¼Œè€Œæ˜¯2sï¼Œå¦‚æœå†æ¬¡å‘ç”Ÿå†²çªï¼Œåˆ™ç­‰4sã€8sã€16sä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æˆåŠŸä¼ è¾“ä¸ºæ­¢ã€‚å› ä¸ºè®¡ç®—æœºçš„è¿™ç§é€€é¿ç­–ç•¥ï¼Œå†²çªæ¬¡æ•°å‡å°‘äº†ï¼Œæ•°æ®å†æ¬¡æµåŠ¨ï¼Œç½‘ç»œå†æ¬¡ç•…é€šäº†ï¼Œå®¶åº­æ™šé¤æœ‰æ•‘äº†~è¿™ç§æŒ‡æ•°çº§å¢é•¿ç­‰å¾…æ—¶é—´çš„æ–¹æ³•å«åšï¼šæŒ‡æ•°é€€é¿ã€‚ä»¥å¤ªç½‘å’ŒWiFiéƒ½ç”¨è¿™ç§æ–¹æ³•ï¼Œå¾ˆå¤šå…¶ä»–ä¼ è¾“åè®®ä¹Ÿç”¨ã€‚ ä½†å³ä¾¿æœ‰äº†æŒ‡æ•°é€€é¿è¿™ç§æŠ€å·§ï¼Œæƒ³ç”¨ä¸€æ ¹ç½‘çº¿è¿é€šæ•´ä¸ªå¤§å­¦çš„è®¡ç®—æœºæ˜¯ä¸å¯èƒ½çš„ï¼Œä¸ºäº†å‡å°‘å†²çª+æå‡æ•ˆç‡ï¼Œæˆ‘ä»¬éœ€è¦å‡å°‘åŒä¸€è½½ä½“ä¸­è®¾å¤‡çš„æ•°é‡ï¼Œè½½ä½“å’Œè®¾å¤‡ç»Ÿç§°â€œå†²çªåŸŸâ€ï¼ˆä¸Šé¢çš„ä¾‹å­å°±æ˜¯ä¸€ä¸ªå†²çªåŸŸï¼Œå› ä¸º6ä¸ªè®¾å¤‡å…±äº«ä¸€ä¸ªè½½ä½“ï¼‰ 1.1.4ï¼šåˆ©ç”¨äº¤æ¢æœºé™ä½å†²çªåŸŸå¤§å°ä»ç„¶ä»¥ä¸Šé¢çš„ä¾‹å­ä¸ºåŸºç¡€ï¼Œä¾‹å­ä¸­å†²çªåŸŸè®¾å¤‡æ•°é‡ä¸º6ï¼Œæˆ‘ä»¬åˆ©ç”¨äº¤æ¢æœºæŠŠå®ƒæ‹†ä¸ºä¸¤ä¸ªå†²çªåŸŸï¼Œè¿™æ ·ï¼Œå•ä½å†²çªåŸŸå†…è®¾å¤‡æ•°é‡å°±ä¼šé™ä½ï¼Œå†²çªå‘ç”Ÿçš„æ¦‚ç‡ä¹Ÿä¼šå¤§å¹…ä¸‹é™ï¼š äº¤æ¢æœºä½äºä¸¤ä¸ªæ›´å°çš„ç½‘ç»œä¹‹é—´ï¼Œå¿…è¦æ—¶æ‰åœ¨ä¸¤ä¸ªç½‘ç»œé—´ä¼ æ•°æ®ï¼Œäº¤æ¢æœºä¼šè®°å½•ä¸€ä¸ªMACåœ°å€åˆ—è¡¨ï¼Œè®°å½•å“ªä¸ªMACåœ°å€ä½äºå“ªè¾¹çš„ç½‘ç»œï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ç°åœ¨è®©Aå‘é€æ•°æ®åˆ°Cï¼Œäº¤æ¢æœºä¼šæ§åˆ¶ä¸å†è®©DEFæ¥æ”¶åˆ°æ•°æ®ï¼š å¦‚æœåŒæ—¶Eæƒ³è¦å‘é€æ•°æ®åˆ°Fï¼Œç½‘ç»œå°±ä¾ç„¶æ˜¯ç©ºçš„ï¼Œä¸ä¼šè·ŸAâ†’Cè¿™ä¸ªç½‘ç»œä¼ è¾“å†²çªã€‚é‚£å¦‚æœFæƒ³è¦ä¼ æ•°æ®ç»™Aå‘¢ï¼Ÿè¿™æ—¶ä»ç„¶è·Ÿä¹‹å‰æ˜¯ä¸€æ ·çš„ï¼Œæ•´ä¸ªé€šé“éƒ½ä¼šè¢«å ç”¨ï¼š å¤§å‹çš„è®¡ç®—æœºç½‘ç»œä¹Ÿæ˜¯è¿™æ ·æ„å»ºçš„ï¼ŒåŒ…æ‹¬å¤§çš„ç½‘ç»œï¼šäº’è”ç½‘ï¼Œä¹Ÿæ˜¯ç”±å¤šä¸ªè¿åœ¨ä¸€èµ·çš„ç¨å°çš„ç½‘ç»œç»„æˆï¼Œä½¿ä¸åŒç½‘ç»œé—´ä¿¡æ¯äº’ç›¸ä¼ é€’ã€‚ è¿™äº›å¤§å‹ç½‘ç»œæ¯”è¾ƒæœ‰è¶£çš„ä¸€ç‚¹æ˜¯ä»ä¸€ä¸ªåœ°ç‚¹åˆ°å¦ä¸€ä¸ªåœ°ç‚¹é€šå¸¸æœ‰å¤šæ¡çº¿è·¯ï¼Œè¿™å°±å¸¦å‡ºäº†å¦ä¸€ä¸ªè¯é¢˜ï¼šè·¯ç”±ã€‚ 1.1.5ï¼šè·¯ç”±è¿æ¥ä¸¤ä¸ªç›¸éš”é¥è¿œçš„è®¡ç®—æœºæˆ–è€…ç½‘ç»œï¼Œæœ€ç®€å•çš„åŠæ³•å°±æ˜¯åˆ†é…ä¸€æ¡ä¸“ç”¨çš„é€šä¿¡çº¿è·¯ï¼Œæ—©æœŸç”µè¯ç³»ç»Ÿå°±æ˜¯è¿™æ ·è¿ä½œçš„ï¼Œæ¯”å¦‚å¦‚æœåœ¨1910å¹´çš„åŒ—äº¬å’Œä¸Šæµ·ï¼ŒåŒ—äº¬çš„å°æ˜æƒ³è¦æ‰“ç”µè¯ç»™ä¸Šæµ·çš„å°çº¢ï¼Œè€ŒåŒ—äº¬åˆ°ä¸Šæµ·çš„ç”µè¯çº¿åªæœ‰5æ¡ï¼š è¿™å«â€œç”µè·¯äº¤æ¢â€ï¼Œå› ä¸ºæ˜¯è¦æŠŠç”µè·¯è¿æ¥åˆ°æ­£ç¡®çš„ç›®çš„åœ°ï¼Œèƒ½ç”¨æ˜¯èƒ½ç”¨ï¼Œä½†æ˜¯ä¸çµæ´»ï¼Œè€Œä¸”ä»·æ ¼æ˜‚è´µï¼Œå› ä¸ºæ€»æœ‰é—²ç½®çº¿è·¯ï¼Œå¥½å¤„æ˜¯ï¼Œå¦‚æœæœ‰ä¸€æ¡ä¸“å±äºè‡ªå·±çš„çº¿è·¯ï¼Œä½ å¯ä»¥æœ€å¤§é™åº¦çš„éšæ„ä½¿ç”¨ï¼Œæ— éœ€å…±äº«ï¼Œå› æ­¤å†›é˜Ÿã€é“¶è¡Œå’Œå…¶ä»–ä¸€äº›æœºæ„ä¾ç„¶ä¼šè´­ä¹°ä¸“ç”¨çº¿è·¯æ¥è¿æ¥æ•°æ®ä¸­å¿ƒã€‚ ä¼ è¾“æ•°æ®çš„å¦ä¸€ç§æ–¹æ³•æ˜¯â€œæŠ¥æ–‡äº¤æ¢â€ï¼ŒæŠ¥æ–‡äº¤æ¢å°±åƒé‚®æ”¿ç³»ç»Ÿä¸€æ ·ï¼Œä¸åƒä¹‹å‰Aå’ŒBæœ‰ä¸€æ¡ä¸“æœ‰çº¿è·¯ï¼Œè€Œæ˜¯ä¿¡æ¯ä¼šç»è¿‡å¥½å‡ ä¸ªç«™ç‚¹ï¼Œæ¯”å¦‚ä»åŒ—äº¬å‘ä¸€å°ä¿¡åˆ°ä¸Šæµ·å¯èƒ½ä¼šä¸­è½¬ä»¥ä¸‹çº¿è·¯ï¼š æ¯ä¸€ä¸ªç«™ç‚¹éƒ½çŸ¥é“ä¸‹ä¸€ä¸ªç«™ç‚¹å°†ä¼šå‘å¾€å“ªé‡Œï¼Œå› ä¸ºç«™ç‚¹æœ‰è¡¨æ ¼ï¼Œè®°å½•åˆ°å„ä¸ªç›®çš„åœ°ï¼Œä¿¡ä»¶è¯¥æ€ä¹ˆä¼ ã€‚æŠ¥æ–‡äº¤æ¢çš„å¥½å¤„æ˜¯å¯ä»¥ä½¿ç”¨ä¸åŒçš„è·¯ç”±ä½¿ä¿¡ä»¶ä¼ è¾“æ›´å¯é æ›´èƒ½å®¹é”™ï¼Œæ¯”å¦‚è®©å›¾9ä¸­çš„æµå—ç«™ç‚¹æ–­è·¯ï¼Œé‚£ä¹ˆæ­¤æ—¶æ¢å¦å¤–ä¸€æ¡ä¼ è¾“çº¿è·¯ä»ç„¶æ˜¯okçš„ï¼Œè™½ç„¶ä¸æ˜¯æœ€ä¼˜è§£ï¼Œä½†ç¡®å®è§£å†³äº†ç°åœ¨æµå—ç«™ç‚¹æ— æ³•å·¥ä½œçš„é—®é¢˜ï¼š çœ‹ï¼Œè½¬éƒ‘å·çº¿è·¯ä¹Ÿæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œè‡³å°‘ä½ çš„ä¿¡ä»¶æœ€ç»ˆè¿˜æ˜¯é¡ºåˆ©åˆ°è¾¾äº†ä¸Šæµ·ã€‚ åœ¨ä¸Šé¢é€é‚®ä»¶è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¯ä¸ªåŸå¸‚é‚®å±€ç«™ç‚¹å°±åƒè·¯ç”±å™¨ä¸€æ ·ï¼Œæ¶ˆæ¯æ²¿ç€è·¯ç”±è·³è½¬çš„æ¬¡æ•°å«â€œè·³æ•°â€ï¼Œè®°å½•è·³æ•°å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå¯ä»¥åˆ†è¾¨å‡ºè·¯ç”±é—®é¢˜ã€‚ ç°åœ¨å‡è®¾åŒ—äº¬ä¼ è¾“ä¿¡æ¯åˆ°ä¸Šæµ·ï¼Œå‡è®¾è½¬è‡³éƒ‘å·ï¼Œéƒ‘å·è®¤ä¸ºå»å¾€ä¸Šæµ·çš„æœ€å¿«çº¿è·¯åº”è¯¥æ˜¯ä¸­è½¬æµå—è¿™æ¡ï¼Œä½†æ˜¯æµå—è®¤ä¸ºå»å¾€ä¸Šæµ·çš„æœ€ä½³è·¯çº¿åº”è¯¥æ˜¯éƒ‘å·ï¼Œè¿™å°±ç³Ÿç³•äº†ï¼Œå› ä¸ºä¸¤ä¸ªåŸå¸‚çœ‹åˆ°çš„ç›®çš„åœ°éƒ½æ˜¯ä¸Šæµ·ï¼Œå®ƒä»¬äº’ç›¸è®¤ä¸ºå¯¹æ–¹æ˜¯â€œæœ€ä¼˜è§£â€ï¼Œç„¶åè¿™ä¸ªä¿¡æ¯åœ¨æµå—å’Œéƒ‘å·ä¹‹é—´è½¬æ¥è½¬å»ï¼š å›¾ä¸­çš„é—®é¢˜ä¸ä»…æµªè´¹å¸¦å®½ï¼Œè€Œä¸”è¿™ç§è·¯ç”±é”™è¯¯éœ€è¦è¢«ä¿®å¤ã€‚è¿™ç§é”™è¯¯ä¼šè¢«æ£€æµ‹åˆ°ï¼Œå› ä¸ºè·³æ•°è¢«è®°å½•åœ¨æ¶ˆæ¯ä¸­ï¼Œä¼ è¾“æ—¶ä¼šæ›´æ–°è·³æ•°ï¼Œå¦‚æœçœ‹åˆ°æŸæ¡æ¶ˆæ¯çš„è·³æ•°å¾ˆé«˜ï¼Œå°±å¯ä»¥çŸ¥é“è·¯ç”±è‚¯å®šå“ªé‡Œå‡ºé”™äº†ï¼Œè¿™å«åšâ€œè·³æ•°é™åˆ¶â€ã€‚ æŠ¥æ–‡äº¤æ¢çš„ç¼ºç‚¹ä¹‹ä¸€æ˜¯æœ‰æ—¶æŠ¥æ–‡æ¯”è¾ƒå¤§ï¼Œä¼šå µå¡ç½‘ç»œï¼Œå› ä¸ºè¦æŠŠæ•´ä¸ªæŠ¥æ–‡ä»ä¸€ç«™è½¬åˆ°ä¸‹ä¸€ç«™åï¼Œæ‰èƒ½ç»§ç»­ä¼ é€’å…¶ä»–æŠ¥æ–‡ï¼Œä¼ è¾“ä¸€ä¸ªå¤§æ–‡ä»¶æ—¶ï¼Œæ•´æ¡è·¯éƒ½å µå¡äº†ï¼Œè¿™æ—¶å³ä¾¿ä½ æœ‰ä¸€ä¸ªåªæœ‰1kbçš„ç”µå­é‚®ä»¶è¦ä¼ è¾“ï¼Œä¹Ÿåªèƒ½ç­‰å¤§æ–‡ä»¶ä¼ å®Œï¼Œæˆ–æ˜¯é€‰å¦ä¸€æ¡æ•ˆç‡ç¨ä½çš„çº¿è·¯ï¼Œè¿™å°±ç³Ÿäº†ï¼Œè§£å†³æ–¹æ³•æ˜¯å°†å¤§æŠ¥æ–‡åˆ†æˆå¾ˆå¤šå°å—ï¼Œè¿™äº›å°æ•°æ®å—å°±æ˜¯â€œæ•°æ®åŒ…â€ï¼Œå°±åƒæŠ¥æ–‡äº¤æ¢ï¼Œæ¯ä¸ªæ•°æ®åŒ…éƒ½æœ‰ç›®æ ‡åœ°å€ï¼Œå› æ­¤è·¯ç”±å™¨çŸ¥é“ä¸‹ä¸€ç«™è¯¥å‘å¾€å“ªé‡Œï¼ŒæŠ¥æ–‡å…·ä½“æ ¼å¼ç”±â€œäº’è”ç½‘åè®®â€å®šä¹‰ï¼Œç®€ç§°IPï¼Œè¿™ä¸ªæ ‡å‡†åˆ›å»ºäº1970å¹´ä»£ï¼Œæ¯å°è”ç½‘çš„è®¡ç®—æœºéƒ½éœ€è¦æœ‰ä¸€ä¸ªè‡ªå·±çš„IPåœ°å€ï¼Œä½ å¯èƒ½è§è¿‡ï¼Œä»¥ç‚¹åˆ†å‰²çš„4ç»„æ•°å­—ï¼Œä¾‹120.92.174.135å°±æ˜¯å“”å“©å“”å“©ä¸€ä¸ªæœåŠ¡å™¨çš„IPåœ°å€ã€‚ æ•°ç™¾ä¸‡è®¡ç®—æœºåœ¨ç½‘ç»œä¸Šä¸æ–­äº¤æ¢æ•°æ®ï¼Œç“¶é¢ˆçš„å‡ºç°å’Œæ¶ˆå¤±æ˜¯æ¯«ç§’çº§çš„ï¼Œè·¯ç”±å™¨ä¼šå¹³è¡¡å’Œå…¶ä»–è·¯ç”±å™¨ä¹‹é—´çš„è´Ÿè½½ï¼Œä»¥ç¡®ä¿ä¼ è¾“å¯ä»¥å¿«é€Ÿå¯é ï¼Œè¿™å«åšâ€œé˜»å¡æ§åˆ¶â€ï¼Œæœ‰æ—¶åŒä¸€ä¸ªæŠ¥æ–‡çš„ä¸åŒæ•°æ®åŒ…ä¼šç»è¿‡ä¸åŒçš„çº¿è·¯ï¼š æœ€ç»ˆä¸Šæµ·æ”¶åˆ°äº†å…¨éƒ¨ç”±åŒ—äº¬å‘å‡ºçš„æ•°æ®ï¼Œä½†æ˜¯å››ä¸ªæ•°æ®åŒ…ä¼ è¿‡æ¥æ—¶ç»å†çš„è·¯ç”±è·¯å¾„å¯èƒ½ä¸ä¸€æ ·ï¼ˆå›¾ä¸­çº¿è·¯é¢œè‰²å¯¹åº”å…·ä½“æ•°æ®åŒ…é¢œè‰²ï¼‰ã€‚ ä½†æ˜¯æ‹†åŒ…æ„å‘³ç€æœ‰å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼šåˆ°è¾¾é¡ºåºé—®é¢˜ã€‚è¿™å¯¹äºä¸€äº›è½¯ä»¶æ¥è¯´è¿™æ˜¯ä¸ªå¤§é—®é¢˜ï¼Œæ¯”å¦‚å›¾12é‡Œæœ€ç»ˆåˆ°è¾¾é¡ºåºå˜æˆäº†ä¸‹é¢è¿™æ ·ï¼š è¿™è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå¹¸è¿çš„æ˜¯ï¼Œåœ¨IPåè®®ä¹‹ä¸Šè¿˜æœ‰å…¶ä»–çš„åè®®ï¼Œä¾‹å¦‚TCP/IPï¼Œå°±å¯ä»¥è§£å†³ä¹±åºé—®é¢˜ï¼ˆTCP/IPä¸‹èŠ‚ä¼šè¯´ï¼‰ã€‚ å°†æ•°æ®æ‹†åˆ†æˆå¤šä¸ªå°æ•°æ®åŒ…ï¼Œç„¶åé€šè¿‡çµæ´»çš„è·¯ç”±ä¼ é€’ï¼Œéå¸¸é«˜æ•ˆä¸”å¯å®¹é”™ï¼Œå¦‚ä»Šäº’è”ç½‘å°±æ˜¯è¿™ä¹ˆè¿è¡Œçš„ï¼Œè¿™å«åšâ€åˆ†ç»„äº¤æ¢â€œï¼Œæœ‰ä¸ªå¥½å¤„æ˜¯ï¼Œå®ƒæ˜¯å»ä¸­å¿ƒåŒ–çš„ï¼Œæ²¡æœ‰ä¸­å¿ƒæƒå¨æœºæ„ï¼Œæ²¡æœ‰å•ç‚¹å¤±è´¥é—®é¢˜ï¼Œäº‹å®ä¸Šï¼Œåœ¨å†·æˆ˜æ—¶æœŸæœ‰æ ¸æ”»å‡»å¨èƒï¼Œæ‰€ä»¥åˆ›é€ äº†åˆ†ç»„äº¤æ¢ï¼Œå¦‚ä»Šï¼Œå…¨çƒçš„è·¯ç”±å™¨ååŒå·¥ä½œï¼Œæ‰¾å‡ºé«˜æ•ˆçš„çº¿è·¯ï¼Œç”¨å„ç§æ ‡å‡†åè®®è¿è¾“æ•°æ®ï¼Œæ¯”å¦‚â€å› ç‰¹ç½‘æ§åˆ¶æ¶ˆæ¯åè®®â€œï¼ˆICMPï¼‰å’Œâ€è¾¹ç•Œç½‘å…³åè®®â€œï¼ˆBGPï¼‰ï¼Œä¸–ç•Œä¸Šç¬¬ä¸€ä¸ªåˆ†ç»„äº¤æ¢ç½‘ç»œä»¥åŠç°ä»£äº’è”ç½‘çš„ç¥–å…ˆæ˜¯â€ARPANETâ€œã€‚ äº’è”ç½‘éå¸¸å¿«é€Ÿçš„å‘å±•ï¼Œå¦‚ä»Šä¸å†åªæœ‰å‡ åå°è®¡ç®—æœºè”ç½‘ï¼Œæ®ä¼°è®¡ï¼Œæœ‰æ¥è¿‘100äº¿å°è”ç½‘è®¾å¤‡ï¼Œè€Œä¸”äº’è”ç½‘ä¼šæŒç»­å¿«é€Ÿå‘å±•ï¼Œç‰¹åˆ«æ˜¯å¦‚ä»Šæ™ºèƒ½è®¾å¤‡å±‚å‡ºä¸ç©·ï¼Œæ¯”å¦‚è”ç½‘å†°ç®±ã€æ’æ¸©å™¨ï¼Œä»¥åŠå…¶ä»–æ™ºèƒ½å®¶ç”µï¼Œå®ƒä»¬ç»„æˆäº†â€ç‰©è”ç½‘â€œã€‚ 1.2ï¼šå¹¿åŸŸç½‘&amp;é«˜çº§åè®®1.2.1ï¼šå¹¿åŸŸç½‘è®¡ç®—æœºæƒ³è¦ä»ç½‘ç»œé‡Œè·å–ä¸€æ®µä¿¡æ¯ï¼Œé¦–å…ˆè¦è¿åˆ°å±€åŸŸç½‘ï¼Œä¹Ÿå«LANï¼Œä½ å®¶WiFiè¿æ¥ç€çš„æ‰€æœ‰è®¾å¤‡ï¼Œç»„æˆäº†å±€åŸŸç½‘ï¼Œå±€åŸŸç½‘å†åˆ°å¹¿åŸŸç½‘ï¼Œå¹¿åŸŸç½‘ä¹Ÿå«WANï¼ŒWANçš„è·¯ç”±å™¨ä¸€èˆ¬å±äºä½ çš„â€äº’è”ç½‘æœåŠ¡æä¾›å•†â€œï¼Œç®€ç§°ISPï¼Œä¸­å›½è¿™ç§æä¾›å•†ä¸»è¦æœ‰ï¼šä¸­å›½ç”µä¿¡ã€ä¸­å›½ç§»åŠ¨ã€ä¸­å›½è”é€šç­‰ï¼Œå¹¿åŸŸç½‘é‡Œï¼Œå…ˆè¿æ¥åˆ°ä¸€ä¸ªåŒºåŸŸæ€§è·¯ç”±å™¨ï¼Œè¿™ä¸ªè·¯ç”±å™¨å¯èƒ½è¦†ç›–äº†ä¸€ä¸ªè¡—åŒºï¼Œç„¶åå†è¿åˆ°ä¸€ä¸ªæ›´å¤§çš„WANï¼Œå¯èƒ½è¦†ç›–äº†æ•´ä¸ªåŸå¸‚ï¼Œå¯èƒ½ä¼šå†è·³å‡ æ¬¡ï¼Œä½†æœ€ç»ˆåˆ°è¾¾äº’è”ç½‘ä¸»å¹²ï¼Œäº’è”ç½‘ä¸»å¹²ç”±ä¸€ç¾¤è¶…å¤§å‹ã€å¸¦å®½è¶…é«˜çš„è·¯ç”±å™¨ç»„æˆã€‚ ä¸ºäº†ä»ä¸€ä¸ªç½‘ç«™è·å–åˆ°htmlä¿¡æ¯æˆ–è€…æ¥å£ä¿¡æ¯ï¼Œè¯·æ±‚æ•°æ®åŒ…è¦å…ˆåˆ°äº’è”ç½‘ä¸»å¹²ï¼Œæ²¿ç€ä¸»å¹²åˆ°è¾¾æœ‰å¯¹åº”å†…å®¹çš„ç›®æ ‡ç½‘ç«™æœåŠ¡å™¨ï¼Œè¯·æ±‚æ•°æ®åŒ…åˆ°ä»ä½ çš„ç”µè„‘è·³åˆ°ç›®æ ‡ç½‘ç«™æœåŠ¡å™¨ï¼Œå¯èƒ½è¦è·³ä¸ªåå‡ æ¬¡ï¼Œè®©åæ‰¾åˆ°å¯¹åº”çš„ç¨‹åºï¼Œå°†ç¨‹åºå†…å¯¹åº”è·¯å¾„é‡Œç›®æ ‡htmlæ–‡ä»¶æˆ–jsonæ¥å£æ•°æ®å†æŒ‰ç…§ç±»ä¼¼çš„æ–¹å¼ä¼ é€å›ä½ çš„ç”µè„‘ä¸Š. ä¸ŠèŠ‚è®²åˆ°ï¼Œå¤§çš„æ•°æ®ä¼šè¢«æ‹†åˆ†æˆä¸€ä¸ªä¸ªçš„å°æ•°æ®åŒ…ï¼Œç„¶åç»è¿‡ä¸åŒçš„è·¯ç”±çº¿è·¯ï¼Œæœ€ç»ˆæŠµè¾¾ç›®çš„åœ°ï¼Œæ•°æ®åŒ…è¦æƒ³åœ¨äº’è”ç½‘ä¸Šä¼ è¾“å°±è¦ç¬¦åˆâ€äº’è”ç½‘åè®®â€œçš„æ ‡å‡†ï¼Œç®€ç§°IPï¼Œå°±åƒé‚®å¿«é€’ä¸€æ ·ï¼Œå¿«ä»¶çš„æ‰“åŒ…ã€é‡é‡éƒ½æ˜¯è¦ç¬¦åˆå¿«é€’å…¬å¸æ ‡å‡†çš„ï¼Œæ¯”å¦‚æ¯ä¸ªé‚®åŒ…å¿…é¡»è¦æœ‰å‘ä»¶åœ°å€å’Œç›®æ ‡åœ°å€ï¼Œè€Œä¸”åœ°å€æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼ˆå°±åƒä¸­å›½åœ°åä¸­æŒ‰ç…§çœ/å¸‚/å¿/é•‡/æ‘çš„è§„åˆ™ï¼Œæ²¡æœ‰ä»»ä½•ä¸€ä¸ªåœ°åæ˜¯å®Œå…¨é‡å¤çš„ï¼‰ï¼Œå¹¶ä¸”è¦æ±‚é‚®åŒ…çš„å¤§å°å’Œé‡é‡ä¹Ÿç¬¦åˆæ ‡å‡†ï¼Œè¿åè¿™äº›æ ‡å‡†å’Œè§„èŒƒï¼Œé‚®åŒ…å°†æ— æ³•è¢«é‚®å¯„ï¼Œäº‹å®ä¸Šï¼ŒIPæ•°æ®åŒ…ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå› ä¸ºIPæ˜¯ä¸€ä¸ªéå¸¸åº•å±‚çš„åè®®ã€‚ æ•°æ®åŒ…çš„å¤´éƒ¨åªæœ‰ç›®æ ‡åœ°å€ï¼š ä»”ç»†çœ‹ä¸Šå›¾çš„åŒ…ç»“æ„ï¼Œè¿™æ„å‘³ç€è¿™ä¸ªæ•°æ®åŒ…æŠµè¾¾ç›®æ ‡æœºå™¨åï¼Œå¯¹æ–¹å¹¶ä¸çŸ¥é“è¦æŠŠè¿™ä¸ªæœåŠ¡åŒ…ç»™è‡ªå·±çš„å“ªä¸ªç¨‹åºï¼ˆæ˜¯ç»™tomcatè¿™ä¸ªhttpæœåŠ¡ç¨‹åºå‘¢ï¼Ÿè¿˜æ˜¯ç»™è‡ªå·±çš„æ–‡ä»¶å¤„ç†ç¨‹åºå‘¢ï¼Ÿä¸çŸ¥é“ï¼Œå› ä¸ºä½ åªæœ‰ä¸€ä¸ªIPå¤´ï¼Œå®ƒåªèƒ½ä¿è¯ä½ çš„æ•°æ®å¯ä»¥åˆ°è¾¾ç›®æ ‡æœºå™¨ï¼‰ï¼Œå› æ­¤éœ€è¦åœ¨IPä¹‹ä¸Šï¼Œå¼€å‘æ›´åŠ é«˜çº§çš„åè®®ã€‚ 1.2.2ï¼šUDPåè®®è¿™äº›é«˜çº§åè®®é‡Œæœ€ç®€å•æœ€å¸¸è§çš„å«â€ç”¨æˆ·æ•°æ®æŠ¥åè®®â€œï¼Œç®€ç§°UDPï¼Œæœ‰äº†è¿™ä¸ªåè®®ï¼Œæˆ‘ä»¬çš„æ•°æ®åŒ…è¿›åŒ–æˆäº†ä¸‹é¢è¿™æ ·ï¼š UDPåè®®å¤´ä½äºæ•°æ®çš„å‰é¢ï¼Œè¿™ä¸ªåè®®å¤´é‡ŒåŒ…å«ä¸€äº›å¾ˆé‡è¦çš„ä¿¡æ¯ï¼š çœ‹ï¼Œæˆ‘ä»¬ç†Ÿæ‚‰çš„ç«¯å£å·å‡ºç°äº†ã€‚æ¯ä¸ªæƒ³è®¿é—®ç½‘ç»œçš„ç¨‹åºéƒ½è¦å‘æ“ä½œç³»ç»Ÿç”³è¯·ä¸€ä¸ªç«¯å£å·ï¼Œæ¯”å¦‚tomcatè¿™ä¸ªjavaå¼€å‘çš„httpç¨‹åºé»˜è®¤ç«¯å£å·å°±æ˜¯8080ï¼Œå¯¹å¤–æä¾›httpæœåŠ¡çš„nginxç¨‹åºçš„é»˜è®¤ç«¯å£å·å°±æ˜¯80ï¼Œå½“ä¸€ä¸ªæ•°æ®åŒ…åˆ°è¾¾æ—¶ï¼Œæ¥æ”¶æ–¹çš„æ“ä½œç³»ç»Ÿå°±ä¼šè¯»å–UDPå¤´é‡Œçš„ç«¯å£å·ï¼Œå¦‚æœçœ‹åˆ°PORT=8080ï¼Œé‚£ä¹ˆå°±æŠŠæ•°æ®åŒ…äº¤ç»™tomcatï¼Œå¦‚æœæ˜¯80ï¼Œåˆ™äº¤ç»™nginxï¼Œçœ‹ï¼Œåˆ°ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¿©åè®®äº’ç›¸é…åˆï¼Œå®Œæˆä¸€ä¸ªå®¢æˆ·ç«¯åˆ°ä¸€ä¸ªæœåŠ¡ç«¯ä¸ŠæŸä¸ªç¨‹åºçš„è®¿é—®äº†ã€‚ â­ï¸ æ€»ç»“ï¼š IPè´Ÿè´£æŠŠæ•°æ®åŒ…é€åˆ°æ­£ç¡®çš„è®¡ç®—æœº UDPè´Ÿè´£æŠŠæ•°æ®åŒ…é€åˆ°æ­£ç¡®çš„ç¨‹åº æˆ‘ä»¬çœ‹åˆ°å›¾16é‡ŒUDPå¤´é™¤äº†PORTï¼Œæˆ‘è¿˜åˆ—å‡ºäº†ä¸€ä¸ªå«CHECK_NUMçš„ä¸œè¥¿ï¼Œå®ƒå«åšâ€æ ¡éªŒå’Œâ€œï¼Œç”¨äºæ£€æŸ¥æ•°æ®æ˜¯å¦æ­£ç¡®ï¼Œæ­£å¦‚æ ¡éªŒå’Œè¿™ä¸ªåå­—æ‰€æš—ç¤ºçš„ï¼Œæ£€æŸ¥æ–¹å¼æ˜¯æŠŠæ•°æ®æ±‚å’Œæ¥å¯¹æ¯”ï¼Œä»¥ä¸‹æ˜¯ä¸ªç®€å•çš„ä¾‹å­ï¼š å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ ¡éªŒå’Œåªæ˜¯ä¸€ä¸ª16ä½çš„æ•°ï¼ˆbitä½ï¼‰ï¼Œä¸€æ—¦ç´¯åŠ å’Œè¶…è¿‡16ä½æ‰€èƒ½è¡¨è¾¾çš„æœ€å¤§èŒƒå›´ï¼Œè·Ÿæˆ‘ä»¬å‰é¢è®²ä½è¿ç®—æ—¶çš„ä½æº¢å‡ºä¸€æ ·ï¼Œèˆå¼ƒé«˜ä½ï¼Œä¿ç•™ä½ä½ã€‚æ ¡éªŒå’Œç”¨æ¥åˆ¤æ–­æ•°æ®çš„å‡†ç¡®æ€§ï¼Œå¦‚æœæ¥æ”¶æ–¹æ”¶åˆ°çš„æ•°æ®è®¡ç®—å‡ºçš„æ ¡éªŒå’Œè·Ÿå‘é€æ–¹ä¸ä¸€è‡´ï¼Œåˆ™è¯´æ˜æ•°æ®è¢«ç¯¡æ”¹è¿‡æˆ–ç”±äºç”µç¼†æ³¢åŠ¨å¯¼è‡´æ•°æ®æŸåè¿‡ã€‚ä¸å¹¸çš„æ˜¯ï¼ŒUDPä¸æä¾›æ•°æ®ä¿®å¤æˆ–è€…æ•°æ®é‡å‘çš„æœºåˆ¶ï¼ˆåˆ’é‡ç‚¹ï¼‰ï¼Œæ¥æ”¶åˆ°å¯¹æ–¹æ•°æ®æŸååï¼Œä¸€èˆ¬åªæ˜¯æ‰”æ‰ï¼ˆä¸¢åŒ…ï¼‰ï¼Œè€Œä¸”UDPæ— æ³•å¾—çŸ¥æ•°æ®åŒ…æ˜¯å¦åˆ°è¾¾ï¼Œå‘é€æ–¹å‘é€æ•°æ®åæ— æ³•æ„ŸçŸ¥å¯¹æ–¹æ˜¯å¦å·²ç»æ¥æ”¶åˆ°ï¼Œè¿™äº›ç‰¹å¾å¬èµ·æ¥å¾ˆç³Ÿç³•ï¼Œä½†æœ‰äº›ç¨‹åºå…¶å®å¹¶ä¸åœ¨æ„è¿™äº›é—®é¢˜ï¼Œå› ä¸ºUDPåˆç®€å•åˆå¿«ï¼Œå¯¹äºé‚£äº›æœ‰ç€é«˜ä¼ è¾“æ€§èƒ½ä½å®Œæ•´æ€§çš„ç³»ç»Ÿï¼ˆæ¯”å¦‚æˆ‘ä»¬çš„æ—¥å¿—ç³»ç»Ÿå’Œé“¾è·¯è¿½è¸ªç³»ç»Ÿï¼‰ï¼Œä½¿ç”¨UDPåè®®å¼€å‘æœåŠ¡ç«¯æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œä½†æ˜¯é’ˆå¯¹ä¸šåŠ¡æœåŠ¡ï¼Œå¯¹æ•°æ®æœ‰ç€é«˜ç²¾å‡†æ€§ï¼Œä¸å…è®¸ä¸¢åŒ…çš„å‘ç”Ÿï¼Œå¯¹æ•°æ®å®Œæ•´æ€§è¦æ±‚æé«˜ï¼Œåˆ™ä¸å»ºè®®ä½¿ç”¨UDPï¼Œæ¯”å¦‚javaå¼€å‘çš„tomcat httpæœåŠ¡ç¨‹åºï¼Œå®ƒå°±ä¸æ˜¯åŸºäºUDPåè®®å®Œæˆé€šä¿¡ä¼ è¾“çš„ã€‚ å¦‚æœéœ€è¦ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œå³ï¼šæ‰€æœ‰æ•°æ®å¿…é¡»åˆ°è¾¾ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨â€ä¼ è¾“æ§åˆ¶åè®®â€œï¼Œç®€ç§°TCPã€‚ 1.2.3ï¼šTCP/IPåè®®TCPå’ŒUDPä¸€æ ·ï¼Œå¤´éƒ¨ä¹Ÿåœ¨å­˜æ•°æ®å‰é¢ï¼Œå°±åƒUDPä¸€æ ·ï¼ŒTCPå¤´éƒ¨ä¹Ÿæœ‰â€ç«¯å£å·â€œå’Œâ€æ ¡éªŒå’Œâ€œï¼Œä½†TCPæœ‰æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬è¿™é‡Œåªä»‹ç»é‡è¦çš„å‡ ä¸ªï¼š TCPæ•°æ®åŒ…æœ‰åºå·ï¼Œ15å·åæ˜¯16å·ï¼Œ16å·åæ˜¯17å·ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå‘ä¸Šç™¾ä¸‡ä¸ªæ•°æ®åŒ…ä¹Ÿæ˜¯æœ‰å¯èƒ½çš„ï¼ˆäº‹å®ä¸Šï¼ŒTCPåœ¨å»ºè¿æ—¶ä¼šç¡®å®šåˆå§‹åºåˆ—å·ï¼Œè¢«ç§°ä½œInitial Sequence Numberï¼Œç®€ç§°ISNï¼Œè¿™ä¸ªåºå·æ˜¯æ ¹æ®ç³»ç»Ÿæ—¶é—´æ¥çš„ï¼Œä¸‹é¢å»ºè¿ä¸‰æ¬¡æ¡æ‰‹ä¼šè®²åˆ°ï¼‰ï¼Œè¿˜è®°å¾—ä¸Šé¢å›¾13é‡Œçš„æ‹†åŒ…åçš„åˆ°è¾¾é¡ºåºé”™ä¹±çš„é—®é¢˜å—ï¼Ÿåºå·å¯ä»¥ä½¿æ¥æ”¶æ–¹æŠŠæ•°æ®åŒ…æ’åˆ—æˆæ­£ç¡®çš„é¡ºåºï¼Œå³ä½¿åˆ°è¾¾é¡ºåºä¸åŒï¼ŒTCPåè®®ä¹Ÿèƒ½æŠŠé¡ºåºæ’å¯¹ã€‚ TCPè¦æ±‚æ¥æ”¶æ–¹çš„ç”µè„‘æ”¶åˆ°æ•°æ®åŒ…å¹¶ä¸”â€æ ¡éªŒå’Œâ€œæ£€æŸ¥æ— è¯¯åï¼ˆæ•°æ®æ²¡æœ‰æŸåï¼‰ç»™å‘é€æ–¹å‘ä¸€ä¸ªç¡®è®¤ç ï¼Œä»£è¡¨æ”¶åˆ°äº†ï¼Œç¡®è®¤ç ç®€ç§°ACKï¼Œå¾—çŸ¥ä¸Šä¸€ä¸ªæ•°æ®åŒ…æˆåŠŸæŠµè¾¾åï¼Œå‘é€æ–¹ä¼šå‘ä¸‹ä¸€ä¸ªæ•°æ®åŒ…ï¼š æ•°æ®åŒ…2åœ¨ç¬¬ä¸€æ¬¡å‘é€æ—¶å¯èƒ½ç”±äºç½‘ç»œå»¶è¿Ÿï¼Œå¯èƒ½ä¸­é€”å‘é€å¤±è´¥ï¼Œè¿™ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯å‘é€æ–¹ç¡®å®æ²¡æœ‰æ”¶åˆ°æ¥æ”¶æ–¹çš„ACKæ¶ˆæ¯ï¼Œæ­¤æ—¶å‘é€å‘ä¼šé‡è¯•ã€‚æ³¨æ„ï¼Œè¿™æ ·æœ‰å¯èƒ½å‘é€é‡å¤çš„æ•°æ®åŒ…ï¼Œå› ä¸ºæ²¡æœ‰æ”¶åˆ°ACKå¹¶ä¸æ„å‘³ç€æ¥æ”¶æ–¹100%æ²¡æœ‰æ”¶åˆ°æ•°æ®åŒ…2ï¼Œå¥½åœ¨æˆ‘ä»¬æœ‰TCPåºåˆ—å·ï¼Œå¦‚æœæ”¶åˆ°é‡å¤åºåˆ—å·çš„æ•°æ®åŒ…å°±ä¼šåˆ æ‰ï¼Œåªä¿ç•™ä¸€ä¸ªã€‚å›¾18é‡Œçœ‹åˆ°çš„æ˜¯ä¸€ä¸ªä¸ªçš„æ•°æ®åŒ…å‘é€ï¼Œä½†äº‹å®ä¸Šï¼ŒTCPæ˜¯æ”¯æŒå¤šä¸ªæ•°æ®åŒ…åŒæ—¶å‘é€çš„ç„¶åæ”¶å–å¤šä¸ªACKç çš„ï¼Œè¿™å¤§å¤§å¢åŠ äº†æ•ˆç‡ï¼Œä¸ç”¨æµªè´¹æ—¶é—´ç­‰å¾…ç¡®è®¤ç ï¼š æœ‰æ„æ€çš„æ˜¯ï¼Œç¡®è®¤ç çš„æˆåŠŸç‡å’Œæ¥å›æ—¶é—´å¯ä»¥æ¨æµ‹ç½‘ç»œçš„æ‹¥å µç¨‹åº¦ï¼ŒTCPåˆ©ç”¨è¿™ä¸ªä¿¡æ¯ï¼Œè°ƒæ•´åŒæ—¶å‘åŒ…çš„æ•°é‡ï¼Œè§£å†³æ‹¥å µé—®é¢˜ï¼ˆå¯ä»¥äº†è§£ä¸‹TCPçš„çª—å£æ»‘åŠ¨åè®®ï¼‰ï¼Œç®€å•æ¥è¯´ï¼ŒTCPå¯ä»¥å¤„ç†ä¹±åºå’Œä¸¢å¤±æ•°æ®åŒ…é—®é¢˜ï¼Œä¸¢äº†å°±é‡å‘ï¼Œæ­¤å¤–è¿˜å¯ä»¥æ ¹æ®æ‹¥å µæƒ…å†µè‡ªåŠ¨è°ƒæ•´ä¼ è¾“ç‡ï¼Œç›¸å½“å‰å®³ã€‚ä½ å¯èƒ½ä¼šå¥‡æ€ªï¼Œæ—¢ç„¶TCPé‚£ä¹ˆå‰å®³ï¼Œä¸ºä»€ä¹ˆè¿˜æœ‰äººç”¨UDPå‘¢ï¼ŸTCPæœ€å¤§çš„ç¼ºç‚¹æ˜¯é‚£äº›ACKç¡®è®¤ç ï¼Œäº¤äº’çš„æ•°æ®åŒ…çš„æ•°é‡ç¿»äº†ä¸€å€ï¼Œä½†å¹¶æ²¡æœ‰ä¼ è¾“æ›´å¤šä¿¡æ¯ï¼Œæœ‰æ—¶å€™è¿™ç§ä»£ä»·æ˜¯ä¸å€¼å¾—çš„ï¼Œç‰¹åˆ«æ˜¯å¯¹æ—¶é—´è¦æ±‚å¾ˆé«˜çš„ç¨‹åºï¼Œæ¯”å¦‚å‰é¢æåˆ°çš„æ—¥å¿—ç³»ç»Ÿå’Œé“¾è·¯è¿½è¸ªç³»ç»Ÿï¼Œå®ƒä»¬å¯èƒ½å¯¹æ•°æ®å®Œæ•´æ€§è¦æ±‚æ²¡æœ‰ä¸šåŠ¡ç³»ç»Ÿé‚£ä¹ˆé«˜ï¼Œä½†æ˜¯ä¼ è¾“æ€§èƒ½ä¸€å®šè¦ä¿è¯é«˜é€Ÿï¼Œè¿™æ—¶å€™å°±ç‰¹åˆ«é€‚åˆUDPä¼ è¾“åè®®ã€‚å›¾18å’Œå›¾19éƒ½æ˜¯åœ¨TCPå»ºè¿åçš„æ•°æ®ä¼ è¾“é˜¶æ®µï¼Œåœ¨è¿™ä¹‹å‰ï¼Œä½ è¦æƒ³åœ¨TCP/IPä¸Šä¼ è¾“æ•°æ®é¦–å…ˆè¦åšçš„å°±æ˜¯å»ºè¿ï¼Œå»ºè¿éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œå¦‚æœæ•°æ®ä¼ è¾“å®Œæ¯•ï¼Œæ•°æ®å‘é€æ–¹ä¸ä¼šå†å’Œæ•°æ®æ¥æ”¶æ–¹æœ‰ä»»ä½•äº¤äº’ï¼Œè¿™æ˜¯å…¶ä¸­ä¸€æ–¹ä¼šæ–­å¼€è¿™ä¸ªè¿æ¥ï¼Œè¿™æ—¶åˆéœ€è¦é€šè¿‡å››æ¬¡æŒ¥æ‰‹æ¥æ–­å¼€è¿æ¥ï¼šä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹ 1.2.4ï¼šDNSæœåŠ¡è¿™ä¸ªå¤§å®¶åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ï¼Œç®€å•æ¥è¯´å°±æ˜¯äº’è”ç½‘çš„ä¸€ä¸ªç‰¹æ®ŠæœåŠ¡ï¼Œè´Ÿè´£æŠŠåŸŸåå’ŒæŸä¸ªIPåœ°å€å¯¹åº”èµ·æ¥ï¼Œæˆ‘ä»¬å¹¶ä¸å¸Œæœ›åœ¨è®¿é—®ç½‘ç«™æ—¶è¾“å…¥ä¸€å¤§ä¸²çš„æ•°å­—ï¼Œå¾€å¾€æˆ‘ä»¬å¸Œæœ›æ¯ä¸ªç½‘ç«™éƒ½æœ‰ä¸ªè‡ªå·±çš„åå­—ï¼Œæ¯•ç«Ÿbilibili.comè®°èµ·æ¥å¯æ¯”ä»€ä¹ˆxxx.xxxx.xxx.xxå®¹æ˜“å¤šäº†ã€‚DNSå°±æ˜¯åšè¿™ä¸ªçš„ï¼Œå®ƒå¯ä»¥å°†ä½ è®°ä¸‹æ¥çš„åŸŸåè§£æå‡ºæ¥å®ƒå¯¹åº”çš„IPåœ°å€ï¼Œä¸€èˆ¬DNSæœåŠ¡å™¨æ˜¯äº’è”ç½‘ä¾›åº”å•†æä¾›çš„ï¼ŒDNSä¼šæŸ¥è¡¨ï¼Œå¦‚æœåŸŸåå­˜åœ¨ï¼Œå°±è¿”å›IPåœ°å€ã€‚ä½ åœ¨æµè§ˆå™¨è¾“å…¥bilibili.comå°±ä¼šè§£æåˆ°å…·ä½“çš„ä¸€ä¸ªIPåœ°å€ï¼Œç„¶åæµè§ˆå™¨ä¼šç»™è¿™ä¸ªIPåœ°å€å‘è¯·æ±‚ï¼Œæ¯ä¸ªè¯·æ±‚çš„æ•°æ®ä¼ è¾“éƒ½ä¼šåŸºäºä¸€ä¸ªæˆ–å¤šä¸ªTCPè¿æ¥å®Œæˆï¼Œä¸Šå±‚è§£ææ•°æ®çš„å·¥ä½œåˆ™äº¤ç»™HTTPè¿™ä¸ªåº”ç”¨å±‚åè®®å»åšã€‚ 1.2.5ï¼šç½‘ç»œåè®®åˆ†å±‚ç‰©ç†å±‚ï¼šä¹‹å‰è¯´è¿‡çš„ç”µç¼†ã€æ— çº¿ç”µä¿¡å·è¿™äº›å±äºç‰©ç†å±‚ æ•°æ®é“¾è·¯å±‚ï¼šè´Ÿè´£æ“æ§ç‰©ç†å±‚ï¼Œæ•°æ®é“¾è·¯å±‚æœ‰åŒ…å«åª’ä½“è®¿é—®æ§åˆ¶åœ°å€ï¼ˆMACåœ°å€ï¼‰ï¼Œç¢°æ’æ£€æµ‹ï¼ˆä¹‹å‰è¯´è¿‡çš„ä¼ è¾“å†²çªï¼‰ï¼ŒæŒ‡æ•°é€€é¿ä»¥åŠä¸€äº›å…¶ä»–çš„åº•å±‚åè®®ï¼Œåœ¨å¾€ä¸Šä¸€å±‚æ˜¯ç½‘ç»œå±‚ã€‚ ç½‘ç»œå±‚ï¼šè´Ÿè´£å„ç§æŠ¥æ–‡äº¤æ¢å’Œè·¯ç”± ä¼ è¾“å±‚ï¼šä¸Šé¢åˆšè®²çš„TCPå’ŒUDPéƒ½å±äºä¼ è¾“å±‚åè®®ï¼Œå…·ä½“æ¥è¯´ä¼ è¾“å±‚è´Ÿè´£åœ¨è®¡ç®—æœºä¹‹é—´è¿›è¡Œç‚¹å¯¹ç‚¹çš„ä¼ è¾“ï¼ˆport to portï¼‰ï¼Œè€Œä¸”è¿˜ä¼šæ£€æµ‹å’Œä¿®å¤é”™è¯¯ã€‚ ä¼šè¯å±‚ï¼šåˆ©ç”¨TCP/UDPæ¥åˆ›å»ºè¿æ¥ï¼Œä¼ é€’ä¿¡æ¯ï¼Œç„¶åå…³æ‰è¿æ¥ï¼Œè¿™ä¸€æ•´å¥—å«â€ä¼šè¯â€œ è¡¨ç¤ºå±‚&amp;åº”ç”¨ç¨‹åºå±‚ï¼šHTMLè§£ç ã€æµè§ˆå™¨ç­‰ã€‚ è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¯¦ç»†çš„åˆ†å±‚ç»“æ„å›¾ï¼Œç›®å‰æœ‰ä¸¤ç§åˆ†å±‚æ–¹å¼ï¼Œæˆ‘åˆ—ä¸¾å‡ºä¸€äº›å…·ä½“çš„å®ç°åè®®ï¼š è¿™ä¸ªæ¦‚å¿µæ€§æ¡†æ¶ï¼ŒæŠŠç½‘ç»œé€šä¿¡åˆ’åˆ†æˆå¤šå±‚ï¼Œæ¯ä¸€å±‚å¤„ç†å„è‡ªçš„é—®é¢˜ï¼Œå¦‚æœä¸åˆ†å±‚ï¼Œç›´æ¥ä»ä¸Šåˆ°ä¸‹æåœ¨ä¸€èµ·å®ç°ç½‘ç»œé€šä¿¡ï¼Œæ˜¯å®Œå…¨ä¸å¯èƒ½çš„ï¼Œçœ‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿæ˜¯æŠ½è±¡&amp;åˆ†å±‚ï¼Œè·Ÿjavaé‡Œçš„æŠ½è±¡åˆ†å±‚ä¸€æ ·ï¼Œè½¯ä»¶åˆ†å±‚ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼Œé€šè¿‡æŠ½è±¡å’Œåˆ†å±‚è®©ç§‘å­¦å®¶å’Œå·¥ç¨‹å¸ˆä»¬èƒ½å„è‡ªåˆ†å·¥åŒæ—¶æ”¹è¿›å¤šä¸ªå±‚ï¼Œä¸è¢«æ•´ä½“å¤æ‚åº¦éš¾å€’ã€‚ ä½†æˆ‘ä»¬ç›®å‰ä¼šä»¥TCP/IPåè®®ä¸ºä¸­å¿ƒåˆ†çš„ç²’åº¦æ›´åŠ ç²—ï¼Œåªæœ‰å››å±‚ï¼š åº”ç”¨å±‚ï¼šæœ€æ¥è¿‘æˆ‘ä»¬è½¯ä»¶å¼€å‘çš„ä¸€å±‚ï¼Œéœ€è¦è½¯ä»¶å·¥ç¨‹å¸ˆäº²è‡ªè®¾è®¡å®ç°çš„ä¸€å±‚ï¼Œæˆ‘ä»¬å¸¸è§çš„æœ‰HTTPã€HTTP2ã€FTPã€‚ ä¼ è¾“å±‚ï¼šåˆ©ç”¨åº”ç”¨å±‚åè®®æ‰“åŒ…å¥½çš„æ•°æ®ï¼Œé€šè¿‡ä¼ è¾“å±‚ä¼ è¾“ï¼Œå°±è·Ÿæˆ‘ä»¬å‰é¢è§£æTCPå’ŒUDPå·¥ä½œæµç¨‹æ—¶æ˜¯ä¸€æ ·çš„ï¼Œå®ƒä»¬åªç”¨æ¥å‘é€æ•°æ®åŒ…ã€‚ ç½‘ç»œå±‚ï¼šè´Ÿè´£å°†æ•°æ®åŒ…è¿é€è‡³äº’è”ç½‘ï¼Œä¼ è¾“åˆ°ç›®æ ‡æœºå™¨ã€‚ ç½‘é™…æ¥å£å±‚ï¼šåŒ…å«äº†æ•°æ®é“¾è·¯å±‚å’Œç‰©ç†å±‚ã€‚ 1.3ï¼šä¸‡ç»´ç½‘1.3.1ï¼šä¸‡ç»´ç½‘ç®€ä»‹ä¸‡ç»´ç½‘ä¸æ˜¯äº’è”ç½‘ï¼ä¸‡ç»´ç½‘ä¸æ˜¯äº’è”ç½‘ï¼ä¸‡ç»´ç½‘ä¸æ˜¯äº’è”ç½‘ï¼å°½ç®¡äººä»¬ç»å¸¸æ··ç”¨è¿™ä¸¤ä¸ªè¯ï¼Œä¸‡ç»´ç½‘åœ¨äº’è”ç½‘ä¹‹ä¸Šè¿è¡Œï¼Œäº’è”ç½‘ä¹‹ä¸Šè¿˜æœ‰Aç«™Bç«™ã€çŸ¥ä¹å¾®åšã€ç‹è€…è£è€€ç­‰ï¼Œäº’è”ç½‘æ˜¯ä¼ é€’æ•°æ®çš„ç®¡é“ï¼Œå„ç§ç¨‹åºéƒ½ä¼šç”¨ï¼Œå…¶ä¸­ä¼ è¾“æœ€å¤šæ•°æ®çš„ç¨‹åºæ˜¯ä¸‡ç»´ç½‘ï¼Œåˆ†å¸ƒåœ¨å…¨çƒä¸Šç™¾ä¸‡ä¸ªæœåŠ¡å™¨ä¸Šï¼Œä½ å¯ä»¥ç”¨æµè§ˆå™¨è®¿é—®ä¸‡ç»´ç½‘ï¼Œæœ¬èŠ‚ä¼šè¯¦ç»†ä»‹ç»ä¸‡ç»´ç½‘ã€‚ 1.3.2ï¼šè¶…é“¾æ¥ä¸‡ç»´ç½‘çš„æœ€åŸºæœ¬å•ä½ï¼Œæ˜¯å•ä¸ªé¡µé¢ï¼Œé¡µé¢æœ‰å†…å®¹ï¼Œä¹Ÿæœ‰å»å¾€å…¶ä»–é¡µé¢çš„é“¾æ¥ï¼Œè¿™äº›é“¾æ¥å«åšâ€è¶…é“¾æ¥â€œï¼Œå¤§å®¶éƒ½è§è¿‡ï¼šå¯ä»¥ç‚¹å‡»çš„æ–‡å­—æˆ–å›¾ç‰‡ï¼Œç‚¹å‡»åæŠŠä½ é€å¾€å¦ä¸€ä¸ªé¡µé¢ï¼Œè¿™äº›è¶…é“¾æ¥è¡Œæˆå·¨å¤§çš„äº’è”ç½‘ç»œï¼Œè¿™å°±æ˜¯ä¸‡ç»´ç½‘åå­—çš„ç”±æ¥ï¼Œç°åœ¨è¯´èµ·æ¥è§‰å¾—å¾ˆç®€å•ï¼Œä½†åœ¨è¶…é“¾æ¥åšå‡ºæ¥ä¹‹å‰ï¼Œè®¡ç®—æœºä¸Šæ¯æ¬¡æƒ³çœ‹å¦ä¸€ä¸ªä¿¡æ¯æ—¶ï¼Œä½ éœ€è¦åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æ‰¾åˆ°å®ƒï¼Œæˆ–æ˜¯æŠŠåœ°å€è¾“å…¥æœç´¢æ¡†ï¼Œä½†æœ‰äº†è¶…é“¾æ¥ï¼Œä½ å¯ä»¥åœ¨ç›¸å…³ä¸»é¢˜é—´è½»æ¾åˆ‡æ¢ï¼Œæ¯”å¦‚è¿™æ ·ï¼šï¼ˆå¯¹ï¼Œç‚¹ä¸€ä¸‹æˆ‘ï¼Œä½ å°±å¯ä»¥ç¦»å¼€æˆ‘å»ç™¾åº¦äº†ï¼‰ã€‚ è¶…é“¾æ¥çš„ä»·å€¼æ—©åœ¨1945å¹´å°±è¢«Vannevar Bushæ„è¯†åˆ°äº†ï¼Œä»–è§£é‡Šé“ï¼šå°†ä¸¤æ ·ä¸œè¥¿è”ç³»åˆ°ä¸€èµ·çš„è¿‡ç¨‹ååˆ†é‡è¦ï¼Œåœ¨ä»»ä½•æ—¶å€™ï¼Œå½“å…¶ä¸­ä¸€ä»¶ä¸œè¥¿è¿›å…¥è§†çº¿ï¼Œåªéœ€è¦ç‚¹ä¸€ä¸‹æŒ‰é’®ï¼Œç«‹é©¬å°±èƒ½å›å¿†èµ·å¦ä¸€ä»¶ï¼Œ1945å¹´çš„æ—¶å€™è®¡ç®—æœºè¿ä¸ªæ˜¾ç¤ºå±éƒ½æ²¡æœ‰ï¼Œæ‰€ä»¥è¿™ä¸ªæƒ³æ³•åœ¨å½“æ—¶æ˜¯éå¸¸è¶…å‰çš„ï¼Œå› ä¸ºæ–‡å­—è¶…é“¾æ¥æ˜¯å¦‚æ­¤çš„å¼ºå¤§ï¼Œå®ƒå¾—åˆ°äº†ä¸€ä¸ªåŒæ ·å‰å®³çš„åå­—ï¼šè¶…æ–‡æœ¬ã€‚ å¦‚ä»Šè¶…æ–‡æœ¬æœ€å¸¸æŒ‡å‘çš„ï¼Œæ˜¯å¦ä¸€ä¸ªç½‘é¡µï¼Œç„¶åç½‘é¡µç”±æµè§ˆå™¨æ¸²æŸ“ï¼ˆä¸‹é¢ä¼šè¯¦ç»†è®²ï¼‰ï¼Œä¸ºäº†ä½¿ç½‘é¡µèƒ½ç›¸äº’è¿æ¥ï¼Œæ¯ä¸ªç½‘é¡µéœ€è¦ä¸€ä¸ªå”¯ä¸€çš„åœ°å€ï¼Œè¿™ä¸ªåœ°å€å«â€ç»Ÿä¸€èµ„æºå®šä½å™¨â€œï¼Œç®€ç§°URLï¼ˆè¿™ä¸œè¥¿å¾ˆç†Ÿæ‚‰å§ï¼‰ã€‚ 1.3.3ï¼šå®šä½ä¸€ä¸ªè¶…æ–‡æœ¬é¡µé¢ç»“åˆæˆ‘ä»¬å‰é¢ä»‹ç»çš„ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æµè§ˆå™¨å¦‚ä½•å®šä½åˆ°ä¸€ä¸ªè¶…æ–‡æœ¬ä¿¡æ¯ï¼š å‡å¦‚ä½ è¦è®¿é—®ï¼šhttps://www.bilibili.com/anime è¿™ä¸ªæ—¶å€™ä¼šå†æ¬¡å¸®ä½ å·©å›ºä¸‹TCP/IPçš„ä½œç”¨ï¼Œæˆ‘ä»¬å¸¸è¯´çš„â€å»ºè¿â€œå…¶å®å°±æ˜¯æŒ‡TCP/IPè¿æ¥çš„å»ºç«‹ï¼Œæ²¡æœ‰TCP/IPè¿æ¥ï¼Œä½ çš„æ•°æ®å°±æ— æ³•å’ŒæœåŠ¡ç«¯è¿›è¡Œå‡†ç¡®çš„ç‚¹å¯¹ç‚¹çš„äº¤äº’ï¼Œè€Œè´Ÿè´£æŠŠä½ æ•°æ®è¾“é€åˆ°å¯¹ç«¯åˆæ˜¯é€šè¿‡åŸºäºIPåè®®çš„è·¯ç”±åŠŸèƒ½å®Œæˆçš„ï¼Œçœ‹ï¼Œåˆä¸²èµ·æ¥äº†ã€‚æ¯ä¸€å±‚ç½‘ç»œåè®®éƒ½åœ¨æˆ‘ä»¬ä¸Šç½‘æ—¶æ‰¿è½½ç€ä¸åŒçš„ä½œç”¨ã€‚ âš ï¸ æ³¨æ„ï¼šå›¾é‡Œè™½ç„¶ç®¡TCPå«é•¿è¿æ¥ï¼Œå› ä¸ºTCPåœ¨å¤§éƒ¨åˆ†åº”ç”¨å±‚åè®®ä¸‹éƒ½æ˜¯ä¸æ–­å¼€çš„ï¼Œä½†æ˜¯ï¼ä½†æ˜¯ï¼ä½†æ˜¯ï¼ç”±äºHTTPåè®®çš„å®ç°ï¼ŒTCPä¼šå¾ˆå¿«æ–­æ‰ï¼Œä½ çŸ¥é“å—ï¼ŸTCPæ¯æ¬¡å»ºè¿éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¸‹æ¬¡è®¿é—®æ—¶å‘ç°TCPå·²æ–­å¼€ï¼Œè®¿é—®å‰å°±ä¼šå†æ¬¡å»ºè¿ç»å†ä¸€éä¸‰æ¬¡æ¡æ‰‹ï¼Œç®€å•æ¥è¯´å°±æ˜¯å½±å“æ€§èƒ½ï¼Œè¿™ä¹Ÿæ˜¯HTTPåè®®çš„ä¸€ä¸ªå¼Šç«¯ï¼Œæ‰€ä»¥åæ¥HTTPåè®®é€šè¿‡keep-aliveçš„æ–¹å¼è¿›è¡Œä¼˜åŒ–ï¼Œè®©é•¿è¿æ¥åœ¨æ–­å¼€å‰å°½å¯èƒ½å¤šçš„è¢«å¤ç”¨ã€‚ ä¾ç…§è¿™ä¸ªæµç¨‹ï¼Œæˆ‘ä»¬é‡ç‚¹è®²ä¸€ä¸‹ä½äºæœ€ä¸Šå±‚çš„åè®®ï¼šHTTPè¶…æ–‡æœ¬ä¼ è¾“åè®®ã€‚ 1.3.4ï¼šHTMLã€HTTPåè®®é¦–å…ˆï¼Œå®ƒæ˜¯ä¸€ä¸ªåº”ç”¨å±‚åè®®ï¼Œä½äºç½‘ç»œé€šä¿¡çš„æœ€ä¸Šå±‚ï¼Œä¸‹å±‚ä»ç„¶é€šè¿‡TCP/IPåè®®å®Œæˆç½‘ç»œä¼ è¾“ï¼Œé‚£ä¹ˆHTTPæ˜¯ä»€ä¹ˆæ ·çš„ä¸€ç§åè®®å‘¢ï¼Ÿå®ƒåœ¨é€šä¿¡è¿‡ç¨‹é‡Œèµ·åˆ°çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ HTTPçš„ç¬¬ä¸€ä¸ªæ ‡å‡†ï¼ŒHTTP0.9ï¼Œåˆ›å»ºäº1991å¹´ï¼Œå½“æ—¶åªæœ‰ä¸€ä¸ªæŒ‡ä»¤ï¼šGETï¼Œå¹¸è¿çš„æ˜¯ï¼Œè¿™å¯¹å½“æ—¶æ¥è¯´ä¹Ÿå¤Ÿç”¨ï¼Œå¦‚å›¾21ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³è¦çš„æ˜¯bç«™çš„/animeé¡µé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å‘æœåŠ¡å™¨å‘é€æŒ‡ä»¤ï¼šGET /animeï¼Œè¯¥æŒ‡ä»¤ä»¥ASCIIç å‘é€è‡³WebæœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›è¯¥åœ°å€å¯¹åº”çš„ç½‘é¡µï¼Œç„¶åæµè§ˆå™¨å°†å…¶æ¸²æŸ“åˆ°å±å¹•ä¸Šï¼Œæ­¤æ—¶åœ¨è¯¥é¡µé¢ç”¨æˆ·å†æ¬¡ç‚¹äº†å¦ä¸€ä¸ªé“¾æ¥ï¼Œè®¡ç®—æœºä¼šé‡æ–°å‘é€ä¸€ä¸ªGETè¯·æ±‚ï¼Œä½ åœ¨æµè§ˆç½‘ç«™æ—¶ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šä¸æ–­é‡å¤ã€‚åœ¨ä¹‹åçš„ç‰ˆæœ¬ï¼ŒHTTPæ·»åŠ äº†çŠ¶æ€ç ï¼ŒçŠ¶æ€ç æ”¾åœ¨æœåŠ¡ç«¯è¿”å›æ¶ˆæ¯ä½“çš„å‰é¢ï¼Œä¸¾ä¾‹ï¼ŒçŠ¶æ€ç 200ä»£è¡¨â€ç½‘é¡µæ‰¾åˆ°äº†ï¼Œç»™ä½ â€œï¼ŒçŠ¶æ€ç 400~499ä»£è¡¨å®¢æˆ·ç«¯å‡ºé”™ï¼Œæ¯”å¦‚ç½‘é¡µä¸å­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯å¯æ€•çš„404é”™è¯¯ï¼ˆ-_-||ï¼‰ã€‚ è¶…æ–‡æœ¬çš„å­˜å‚¨å’Œå‘é€éƒ½æ˜¯ä»¥æ™®é€šæ–‡æœ¬å½¢å¼è¿›è¡Œï¼Œæ¯”å¦‚ï¼Œç¼–ç æœ‰å¯èƒ½æ˜¯ASCIIç æˆ–è€…UTF-16ï¼Œå› ä¸ºå¦‚æœåªæœ‰çº¯æ–‡æœ¬ï¼Œå°±æ— æ³•è¡¨æ˜ä»€ä¹ˆæ˜¯é“¾æ¥ï¼Œä»€ä¹ˆä¸æ˜¯é“¾æ¥ï¼Œæ‰€ä»¥æœ‰å¿…è¦å¼€å‘ä¸€ç§æ ‡è®°æ–¹æ³•ï¼Œäºæ˜¯è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€HTMLå°±è¿™æ ·è¯ç”Ÿäº†ï¼ˆçœ‹ï¼Œæˆ‘ä»¬ç”šè‡³è®²åˆ°äº†å‰ç«¯ï¼‰ï¼ŒHTMLç¬¬ä¸€ç‰ˆçš„ç‰ˆæœ¬å·æ˜¯0.8ï¼Œåˆ›å»ºäº1990å¹´ï¼Œæœ‰18ç§HTMLæŒ‡ä»¤ï¼Œä»…æ­¤è€Œå·²ï¼Œæˆ‘ä»¬æ¥åšä¸€ä¸ªç½‘é¡µå§ï¼ ä»£ç å—112&lt;h1&gt;è¿™æ˜¯æ ‡é¢˜&lt;/h1&gt;è¿™æ˜¯å†…å®¹ï¼Œ&lt;a href=\"http://www.bilibili.com\"&gt;è¿™æ˜¯è¶…é“¾æ¥&lt;/a&gt; h1å°±æ˜¯ä¸€ä¸ªHTMLæŒ‡ä»¤ï¼Œå®ƒå¯ä»¥å‘Šè¯‰æµè§ˆå™¨ï¼Œè¢«å®ƒåŒ…è£¹çš„å†…å®¹çš„å­—ä½“éœ€è¦å˜æˆ1å·æ ‡é¢˜å¤§å°ï¼Œè€ŒaæŒ‡ä»¤å¯ä»¥ä»¤è¢«åŒ…è£¹çš„å†…å®¹è·³åˆ°å…¶ä»–é¡µé¢ã€‚ è¿™æ ·ï¼Œæˆ‘ä»¬çš„HTMLé¡µé¢å°±å®Œæˆäº†ï¼ŒæŠŠå®ƒä¿å­˜åˆ°ä¸€ä¸ªè®°äº‹æœ¬é‡Œé¢ï¼Œç„¶åæŠŠè®°äº‹æœ¬çš„åç¼€æ”¹æˆ.htmlï¼Œå®ƒå°±å¯ä»¥è¿è¡Œåœ¨æµè§ˆå™¨ä¸Šäº†ï¼Œè¯´ç™½äº†ï¼Œä½ è¯·æ±‚ä¸€ä¸ªç½‘ç«™ä¹Ÿæ˜¯ç±»ä¼¼çš„é“ç†ï¼Œåªä¸è¿‡éœ€è¦èµ°ç½‘ç»œï¼Œå°†ç›®æ ‡ç½‘ç«™å¯¹åº”çš„HTMLé¡µé¢æ‹¿åˆ°ã€‚ æœ€æ–°ç‰ˆçš„HTMLã€HTML5ï¼Œæœ‰100å¤šç§æ ‡ç­¾æŒ‡ä»¤ï¼Œå›¾ç‰‡æ ‡ç­¾ã€è¡¨æ ¼æ ‡ç­¾ã€è¡¨å•æ ‡ç­¾ã€æŒ‰é’®æ ‡ç­¾ç­‰ç­‰ï¼Œè¿˜æœ‰å…¶ä»–ç›¸å…³æŠ€æœ¯å°±ä¸è¯´äº†ï¼Œæ¯”å¦‚å±‚å æ ·å¼è¡¨ï¼ˆCSSï¼‰å’ŒJavaScriptï¼Œè¿™ä¿©å¯ä»¥åŠ è¿›ç½‘é¡µï¼ŒåµŒå…¥è¿›ä½ çš„HTMLä»£ç é‡Œï¼Œåšä¸€äº›æ›´åŠ å‰å®³çš„äº‹æƒ…ã€‚ è®©æˆ‘ä»¬å›åˆ°æµè§ˆå™¨ï¼Œç½‘é¡µæµè§ˆå™¨å¯ä»¥å’Œç½‘é¡µæœåŠ¡å™¨ï¼ˆHTTPæœåŠ¡å™¨ï¼‰é€šä¿¡ï¼Œæµè§ˆå™¨ä¸ä»…è·å–ç½‘é¡µå’Œåª’ä½“ï¼Œè·å–åè¿˜è´Ÿè´£æ˜¾ç¤ºã€‚ 1.3.5ï¼šæµè§ˆå™¨ã€webæœåŠ¡å™¨çš„å‘å±•å²æµè§ˆå™¨ï¼šåŸºäºHTTPåè®®å®Œæˆå’ŒwebæœåŠ¡å™¨çš„ç½‘ç»œé€šä¿¡ï¼Œå¹¶å°†æœåŠ¡ç«¯è¿”å›çš„è¶…æ–‡æœ¬å†…å®¹è¿›è¡Œæ¸²æŸ“å±•ç¤ºã€‚ webæœåŠ¡å™¨ï¼šæ”¯æŒHTTPåè®®çš„ä¸€ä¸ªæœåŠ¡ç«¯ç¨‹åºï¼Œå¯¹ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæœåŠ¡å™¨ä¸Šè¿è¡Œçš„ä¸€ä¸ªæ‹¥æœ‰ç«¯å£å·çš„ç¨‹åºè€Œå·²ï¼Œå°±åƒå‰é¢è®²çš„ç½‘ç»œé€šä¿¡ä¸€æ ·ï¼Œå› ä¸ºå®ƒæ”¯æŒHTTPåè®®çš„è§£æå’Œå°è£…ä¼ è¾“ï¼Œå› æ­¤æµè§ˆå™¨å¯ä»¥å’Œå®ƒè¿›è¡Œæ— éšœç¢é€šä¿¡ï¼Œè¿™ä¸ªæµç¨‹ç®€å•ç”»ä¸€ä¸‹å°±æ˜¯ä¸‹é¢è¿™æ ·ï¼š ä¸Šé¢çœå»äº†DNSè¿™ä¸€æ­¥ï¼Œå¯¹æµè§ˆå™¨å’ŒwebæœåŠ¡å™¨ç¨‹åºé€šä¿¡çš„æ•´ä¸ªé€»è¾‘æµç¨‹ï¼Œä»”ç»†åˆ†æä¸‹ï¼Œä¸ºä»€ä¹ˆweb serverä¼šçŸ¥é“æµè§ˆå™¨æƒ³è¦è®¿é—®å“ªä¸ªæ–‡ä»¶å‘¢ï¼Ÿä»¥åŠæµè§ˆå™¨å¦‚ä½•çŸ¥é“æœåŠ¡ç«¯çš„å“åº”ç»“æœçš„ï¼Ÿä¸‡ä¸€æœåŠ¡ç«¯æ‰¾ä¸åˆ°è¯¥å’‹åŠï¼Ÿè¿™å°±æ˜¯HTTPåè®®èµ·åˆ°çš„ä½œç”¨ï¼ŒæŒ‰ç…§HTTPåè®®æ‰“åŒ…çš„æ•°æ®ï¼Œä¼šå‘Šè¯‰æœåŠ¡ç«¯å½“å‰è¯·æ±‚èµ„æºçš„æ–¹å¼ï¼ˆGETã€POSTï¼‰ï¼Œè¿˜ä¼šå‘Šè¯‰æœåŠ¡ç«¯è¯·æ±‚çš„è·¯å¾„å’Œå‚æ•°ï¼Œæ ¹æ®è·¯å¾„å’Œå‚æ•°æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶ï¼Œç„¶ååŒ…è£…æˆHTTPå“åº”æ•°æ®ï¼Œè¿”å›ç»™æµè§ˆå™¨ï¼Œå¦‚æœæ²¡æ‰¾åˆ°å¯¹åº”çš„è·¯å¾„ï¼Œåˆ™è¿”å›404é”™è¯¯ç ï¼Œè¿™æ—¶æµè§ˆå™¨å°±çŸ¥é“äº†æœåŠ¡ç«¯æ‰¾ä¸åˆ°å®ƒè¦è¯·æ±‚çš„ç•Œé¢ã€‚ çœ‹åˆ°è¿™é‡Œï¼ŒçŸ¥é“ä»€ä¹ˆæ˜¯åº”ç”¨å±‚åè®®äº†å§ï¼Ÿæ‰€è°“åº”ç”¨å±‚åè®®ï¼Œå…¶å®å°±æ˜¯è½¯ä»¶å†…éƒ¨å¤„ç†å¯¹ç«¯æ•°æ®æ—¶çº¦å®šå¥½çš„ä¸€ç§æ ¼å¼ï¼Œä¾¿äºç¬¦åˆåŒä¸€ç§é€šä¿¡åè®®çš„ä¸¤ç§è½¯ä»¶ç›¸äº’é€šä¿¡ï¼ˆæ¯”å¦‚æµè§ˆå™¨å’ŒwebæœåŠ¡å™¨ç¨‹åºéƒ½å±äºæŸç§è½¯ä»¶ï¼Œæˆ–ç§°åº”ç”¨ï¼Œå®ƒä»¬ä¸ºä»€ä¹ˆå¯ä»¥é¡ºåˆ©å¤„ç†å½¼æ­¤é€šè¿‡TCP/IPä¼ æ¥çš„æ•°æ®å‘¢ï¼Ÿå› ä¸ºå®ƒä»¬éƒ½æ”¯æŒHTTPè¿™ç§åº”ç”¨å±‚åè®®ï¼Œè§£æè§„åˆ™ä¸€è‡´ï¼Œæ‰€ä»¥å®ƒä»¬éƒ½å¯ä»¥ç†è§£å¯¹æ–¹ï¼Œæ¯”å–»æˆäººçš„è¯ï¼Œå°±æ˜¯ä»–ä»¬ä¿©è™½ç„¶ä¸æ˜¯åŒä¸€ç±»äººï¼Œä½†æ˜¯ä»–ä»¬ä¿©æ˜¯ä¸€ä¸ªå›½å®¶çš„äººï¼Œèƒ½å¤Ÿå¬æ‡‚å½¼æ­¤çš„è¯­è¨€ï¼Œè€Œè¯­è¨€ç›¸å¯¹äºäººç±»æ¥è®²ï¼Œä¹Ÿæ˜¯ä¸€ç§â€åè®®â€œæ€§çš„ä¸œè¥¿ï¼‰ã€‚ ç¬¬ä¸€ä¸ªæµè§ˆå™¨å’ŒæœåŠ¡å™¨ï¼Œæ˜¯Tim Berners-Leeåœ¨1990å¹´å†™çš„ï¼Œä¸€å…±èŠ±äº†2ä¸ªæœˆï¼Œé‚£æ—¶å€™ä»–åœ¨ç‘å£«çš„â€æ¬§æ´²æ ¸å­ç ”ç©¶æ‰€â€œå·¥ä½œï¼Œä¸ºäº†åšå‡ºæ¥ï¼Œä»–åŒæ—¶å»ºç«‹äº†å‡ ä¸ªæœ€åŸºæœ¬çš„ç½‘ç»œæ ‡å‡†ï¼šURLï¼ˆæ¦‚å¿µï¼‰ã€HTMLï¼ˆè¯­è¨€ï¼‰ã€HTTPï¼ˆåè®®ï¼‰ï¼Œä¸¤ä¸ªæœˆã€‚ã€‚å°±ã€‚ã€‚è¿‡äºä¼˜ç§€ï¼ä¸è¿‡å…¬å¹³ç‚¹è¯´ï¼Œä»–ç ”ç©¶è¶…æ–‡æœ¬ç³»ç»Ÿå·²ç»æœ‰åå‡ å¹´äº†ï¼Œå’ŒåŒäº‹åœ¨CERNå†…éƒ¨ä½¿ç”¨äº†ä¸€é˜µå­åï¼Œåœ¨1991å¹´å‘å¸ƒäº†å‡ºå»ï¼Œä¸‡ç»´ç½‘å°±æ­¤è¯ç”Ÿï¼é‡è¦çš„æ˜¯ï¼Œä¸‡ç»´ç½‘æœ‰å¼€æ”¾æ ‡å‡†ï¼Œå¤§å®¶éƒ½å¯ä»¥å¼€å‘æ–°çš„æœåŠ¡å™¨å’Œæ–°çš„æµè§ˆå™¨ï¼Œå› æ­¤â€ä¼Šåˆ©è¯ºä¼Šå¤§å­¦é¦™æ§Ÿåˆ†æ ¡â€œçš„ä¸€ä¸ªå°ç»„ï¼Œåœ¨1993å¹´åšäº†Mosaicæµè§ˆå™¨ï¼Œå®ƒæ˜¯ç¬¬ä¸€ä¸ªå¯ä»¥åœ¨æ–‡å­—æ—è¾¹æ˜¾ç¤ºå›¾ç‰‡çš„æµè§ˆå™¨ï¼Œä¹‹å‰çš„æµè§ˆå™¨è¦å•å¼€ä¸€ä¸ªé¡µé¢ä¸“é—¨å±•ç¤ºå›¾ç‰‡ï¼Œè¿˜å¼•è¿›äº†ä¹¦ç­¾ç­‰æ–°åŠŸèƒ½ï¼Œç•Œé¢å‹å¥½ï¼Œä½¿å®ƒä¸€åº¦å¾ˆå—æ¬¢è¿ï¼Œå®ƒé•¿è¿™æ ·ï¼š å°½ç®¡ä»¥ç°åœ¨çš„çœ¼å…‰çœ‹ä¸Šå»å¾ˆå‘†æ¿ï¼Œä½†å’Œå¦‚ä»Šçš„æµè§ˆå™¨é•¿å¾—ä¹Ÿå·®ä¸å¤šã€‚ 1990å¹´ä»£æœ«æœ‰è®¸å¤šæµè§ˆå™¨é¢ä¸–ï¼šIEã€Operaã€OmniWebã€Mozillaï¼Œå½“ç„¶ä¹Ÿæœ‰å¾ˆå¤šåŸºäºHTTPåè®®çš„webæœåŠ¡å™¨é¢ä¸–ï¼Œæ¯”å¦‚Apacheï¼ˆé‡ç‚¹ï¼‰å’Œå¾®è½¯äº’è”ç½‘ä¿¡æ¯æœåŠ¡ï¼ˆIISï¼‰ã€‚ åŸºäºè¿™äº›æˆæœï¼Œæ¯å¤©éƒ½æœ‰æ–°ç½‘ç«™å†’å‡ºæ¥ï¼Œå¦‚ä»Šçš„ç½‘ç»œå·¨å¤´ï¼Œæ¯”å¦‚äºšé©¬é€Šã€eBayï¼Œåˆ›å»ºäº1990å¹´ä»£ä¸­æœŸï¼Œè€Œåœ¨ä¸­å›½ï¼Œ1998å¹´è¯ç”Ÿäº†è…¾è®¯ï¼Œ1999å¹´è¯ç”Ÿäº†é˜¿é‡Œå·´å·´ï¼Œé‚£æ˜¯ä¸ªé»„é‡‘æ—¶ä»£ï¼ 1.3.6ï¼šç¬¬ä¸€ä¸ªçˆ¬è™«ç¨‹åº&amp;ç¬¬ä¸€ä¸ªæœç´¢å¼•æ“éšç€ä¸‡ç»´ç½‘æ—¥ç›Šç¹è£ï¼Œäººä»¬è¶Šæ¥è¶Šéœ€è¦æœç´¢ï¼Œå¦‚æœä½ çŸ¥é“ç½‘ç«™åœ°å€ï¼Œæ¯”å¦‚bilibili.comï¼Œç›´æ¥è¾“å…¥æµè§ˆå™¨å°±è¡Œï¼Œä½†å¦‚æœä¸çŸ¥é“åœ°å€å‘¢ï¼Ÿæ¯”å¦‚æƒ³æ‰¾å¯çˆ±çŒ«å’ªçš„å›¾ç‰‡ï¼Œç°åœ¨å°±è¦ï¼å»å“ªé‡Œæ‰¾å‘¢ï¼Ÿèµ·åˆäººä»¬ä¼šç»´æŠ¤ä¸€ä¸ªç›®å½•ï¼Œé“¾æ¥åˆ°å…¶å®ƒç½‘ç«™ï¼Œå…¶ä¸­æœ€æœ‰åçš„å«â€Jerryå’ŒDavidçš„ä¸‡ç»´ç½‘æŒ‡å—â€œï¼Œ1994å¹´æ”¹åä¸ºYahooï¼ˆæ²¡é”™ï¼Œå°±æ˜¯æ—©æœŸçš„é›…è™æœç´¢ï¼‰ï¼Œéšç€ç½‘ç»œè¶Šæ¥è¶Šå¤§ï¼Œäººå·¥ç¼–è¾‘çš„ç›®å½•å˜å¾—ä¸ä¾¿åˆ©ï¼Œæ‰€ä»¥å¼€å‘äº†æœç´¢å¼•æ“ã€‚ é•¿å¾—æœ€åƒç°ä»£æœç´¢å¼•æ“çš„æœ€æ—©æœç´¢å¼•æ“ï¼Œåå«JumpStationï¼Œç”±Jonathan Fletcheräº1993å¹´åœ¨æ–¯ç‰¹æ—å¤§å­¦åˆ›å»ºï¼Œå®ƒæœ‰3ä¸ªéƒ¨åˆ†ï¼š ç¬¬ä¸€ä¸ªæ˜¯çˆ¬è™«ï¼Œä¸€ä¸ªè·Ÿç€é“¾æ¥åˆ°å¤„è·‘çš„è½¯ä»¶ï¼Œæ¯åˆ°çœ‹åˆ°æ–°é“¾æ¥ï¼Œå°±åŠ è¿›è‡ªå·±çš„åˆ—è¡¨é‡Œ ç¬¬äºŒéƒ¨åˆ†æ˜¯ä¸æ–­æ‰©å¼ çš„ç´¢å¼•ï¼Œè®°å½•è®¿é—®è¿‡çš„ç½‘é¡µä¸Šï¼Œå‡ºç°è¿‡å“ªäº›è¯ æœ€åä¸€éƒ¨åˆ†ï¼Œæ˜¯æŸ¥è¯¢ç´¢å¼•çš„æœç´¢ç®—æ³•ï¼Œæ¯”å¦‚æˆ‘è¾“å…¥â€çŒ«â€œï¼Œé‚£ä¹ˆæ¯ä¸ªæœ‰â€çŒ«â€œè¿™ä¸ªè¯çš„ç½‘é¡µéƒ½ä¼šå‡ºç° æ—©æœŸæœç´¢å¼•æ“çš„æ’åæ–¹å¼éå¸¸ç®€å•ï¼Œå–å†³äºæœç´¢è¯åœ¨é¡µé¢ä¸Šçš„å‡ºç°æ¬¡æ•°ï¼Œåˆšå¼€å§‹è¿˜è¡Œï¼Œç›´åˆ°æœ‰äººå¼€å§‹é’»ç©ºå­ï¼Œæ¯”å¦‚åœ¨é¡µé¢ä¸Šå†™å‡ ç™¾ä¸ªâ€çŒ«â€œï¼ŒæŠŠäººä»¬å¸å¼•è¿‡æ¥ï¼Œè°·æ­Œçš„æˆåçš„å¾ˆå¤§ä¸€ä¸ªåŸå› æ˜¯åˆ›é€ äº†ä¸€ä¸ªèªæ˜çš„ç®—æ³•æ¥è§„é¿è¿™ä¸ªé—®é¢˜ã€‚ä¸å…¶ä¿¡ä»»ç½‘é¡µä¸Šçš„å†…å®¹ï¼Œæœç´¢å¼•æ“ä¼šçœ‹å…¶ä»–ç½‘ç«™ï¼Œæœ‰æ²¡æœ‰é“¾æ¥åˆ°è¿™ä¸ªç½‘ç«™ï¼Œå¦‚æœåªæ˜¯å†™æ»¡â€çŒ«â€œçš„åƒåœ¾ç½‘ç«™ï¼Œæ²¡äººä¼šæ„¿æ„æŒ‡å‘å®ƒï¼Œå¦‚æœæœ‰å…³äºâ€çŒ«â€œçš„æœ‰ç”¨å†…å®¹ï¼Œæœ‰ç½‘ç«™ä¼šæŒ‡å‘å®ƒï¼Œæ‰€ä»¥è¿™äº›â€åå‘é“¾æ¥â€œçš„æ•°é‡ï¼Œç‰¹åˆ«æ˜¯æœ‰ä¿¡èª‰çš„ç½‘ç«™ä¼šç‰¹åˆ«å¤šï¼Œåå‘é“¾æ¥çš„æ•°é‡ä»£è¡¨äº†ç½‘ç«™çš„è´¨é‡ã€‚ Googleä¸€å¼€å§‹æ—¶æ˜¯1996å¹´æ–¯å¦ç¦å¤§å­¦ä¸€ä¸ªå«BackRubçš„ç ”ç©¶é¡¹ç›®ï¼Œä¸¤å¹´ååˆ†ç¦»å‡ºæ¥ï¼Œæ¼”å˜æˆå¦‚ä»Šçš„è°·æ­Œã€‚ 1.4ï¼šæˆ‘è‡ªå·±çš„ä¸ªäººç”µè„‘è”é€šç½‘ç»œåå¯ä»¥è¢«åˆ«çš„ç”µè„‘é€šè¿‡ip+portè®¿é—®åˆ°å—ï¼Ÿæˆ‘ä»¬çš„å¸¸è¯†å‘Šè¯‰æˆ‘ä»¬ï¼Œä¸è¡Œï¼ ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå‰é¢è¯´åˆ°äº†å±€åŸŸç½‘ï¼Œæˆ–è€…è¯´æˆ‘ä»¬ç®¡å®ƒå«å†…ç½‘ï¼Œæˆ‘ä»¬çš„ä¸ªäººç”µè„‘åªæ˜¯æ¥åœ¨äº†å±€åŸŸç½‘é‡Œã€‚ä¸€ä¸ªå…¬å¸é‡Œçš„ç”µè„‘ï¼Œä¸€ä¸ªå­¦æ ¡é‡Œçš„ç”µè„‘ï¼Œéƒ½å¯ä»¥ç»„æˆä¸€ä¸ªå±€åŸŸç½‘ï¼Œè€Œä¸€ä¸ªå±€åŸŸç½‘å†…çš„è®¡ç®—æœºï¼Œéƒ½ä¼šæœ‰ä¸ªå†…ç½‘IPï¼Œå®ƒä»¬é€šè¿‡NATï¼ˆç½‘ç»œåœ°å€è½¬æ¢ï¼‰å®ç°å†…ç½‘çš„IPåœ°å€ä¸å…¬ç½‘çš„IPåœ°å€ä¹‹é—´çš„ç›¸äº’è½¬æ¢ï¼Œå°†å¤§é‡çš„å†…ç½‘IPåœ°å€è½¬æ¢ä¸ºä¸€ä¸ªæˆ–å°‘é‡çš„å…¬ç½‘IPåœ°å€ï¼Œå‡å°‘å¯¹å…¬ç½‘IPåœ°å€çš„å ç”¨ï¼ŒNATçš„æœ€å…¸å‹çš„åº”ç”¨æ˜¯ï¼šåœ¨ä¸€ä¸ªå±€åŸŸç½‘å†…ï¼Œåªéœ€è¦ä¸€å°è®¡ç®—æœºè¿æ¥ä¸ŠInternetï¼Œå°±å¯ä»¥åˆ©ç”¨NATå…±äº«Internetè¿æ¥ï¼Œä½¿å±€åŸŸç½‘å†…å…¶ä»–è®¡ç®—æœºä¹Ÿå¯ä»¥ä¸Šç½‘ã€‚ä½¿ç”¨NATåè®®ï¼Œå±€åŸŸç½‘å†…çš„è®¡ç®—æœºå¯ä»¥è®¿é—®Internetä¸Šçš„è®¡ç®—æœºï¼Œä½†Internetä¸Šçš„è®¡ç®—æœºæ— æ³•è®¿é—®å±€åŸŸç½‘å†…çš„è®¡ç®—æœºï¼Œè¿™å°±æ˜¯ä½ è¿ä¸Šå±€åŸŸç½‘çš„ç”µè„‘ä¸ºä»€ä¹ˆä¸å¯ä»¥è¢«åˆ«äººè®¿é—®çš„åŸå› ã€‚ é‚£ä¹ˆå¦‚ä½•è®©è‡ªå·±ç”µè„‘ä¸Šçš„æŸä¸ªç¨‹åºè®©åˆ«äººå¯ä»¥è®¿é—®åˆ°å‘¢ï¼Ÿéœ€è¦é…ç½®éƒ¨ç½²ä¸€ä¸ªå…¬ç½‘IPåœ°å€ï¼Œå…¬ç½‘IPæ˜¯æŒ‡ä»¥å…¬ç½‘è¿æ¥Internetä¸Šçš„éä¿ç•™åœ°å€ã€‚ å…¬ç½‘ã€å†…ç½‘æ˜¯ä¸¤ç§Internetçš„æ¥å…¥æ–¹å¼ï¼Œå…¬ç½‘çš„è®¡ç®—æœºå’ŒInternetä¸Šçš„å…¶ä»–è®¡ç®—æœºæ˜¯å¯ä»¥éšæ„äº’ç›¸è®¿é—®çš„ã€‚ âšœï¸ æ€»ç»“ï¼š é€šè¿‡å…¬ç½‘éƒ¨ç½²çš„è®¡ç®—æœºå¯ä»¥è®¿é—®äº’è”ç½‘é‡Œçš„ä»»æ„è®¡ç®—æœºã€‚ ä»…é“¾æ¥è¿›å±€åŸŸç½‘çš„è®¡ç®—æœºå¯ä»¥è¢«å…¬ç½‘è®¡ç®—æœºè¿æ¥å¹¶è®¿é—®ï¼Œä½†æ˜¯æ— æ³•è¢«åˆ«çš„è®¡ç®—æœºä¸»åŠ¨è¿æ¥è®¿é—®ã€‚ æ‰€ä»¥å¦‚æœä½ æƒ³è¦å»ºè®¾ä¸€ä¸ªä¸ªäººç«™ï¼Œé¦–å…ˆè¦æ‰¾åˆ°ä¸€ä¸ªæ¥å…¥å…¬ç½‘çš„è®¡ç®—æœºå½“åšæœåŠ¡å™¨ï¼Œå¦åˆ™åˆ«äººæ˜¯æ— æ³•è®¿é—®ä½ çš„ï¼Œè¿™ç§è®¡ç®—æœºåœ¨å“ªé‡Œä¹°åˆ°å‘¢ï¼Ÿå½“ç„¶æ˜¯é˜¿é‡Œäº‘å•Š~ï¼ˆä¸æ˜¯å¹¿å‘Šï¼Œè…¾è®¯äº‘ä¹Ÿæä¾›è¿™ç§æœåŠ¡ï¼Œè¿™äº›æœåŠ¡æŒ‰ç…§èŒèƒ½ä¸åŒè¿˜åˆ†äº†å¾ˆå¤šç§ç±»ï¼Œç›¸æ¯”é˜¿é‡Œäº‘è¿™ç§æä¾›å…¨æ–¹ä½æœåŠ¡å™¨çš„å•†æˆ·ï¼Œä¸ƒç‰›äº‘å’Œåˆæ‹äº‘å°±åªæä¾›äº‘å­˜å‚¨å’ŒCDNæœåŠ¡ï¼‰ å¦‚æœä½ åœ¨é˜¿é‡Œäº‘è´­ä¹°äº†ä¸€å°æœåŠ¡å™¨ï¼Œä»–ä¼šç»™ä½ ä¸¤ä¸ªipï¼Œä¸€ä¸ªæ˜¯å…¬ç½‘ipï¼Œä¸€ä¸ªæ˜¯å†…ç½‘ipï¼š ä½ å¦‚æœä¹Ÿæ³¨å†Œäº†åŸŸåï¼ˆåœ¨ä¸­å›½éœ€è¦ç»™åŸŸåå®Œæˆå¤‡æ¡ˆï¼Œç›¸å½“äºç»™ä½ çš„åŸŸåæä¸ªâ€œèº«ä»½è¯â€ï¼‰ï¼Œå°±å¯ä»¥å°†å…¬ç½‘ipç»‘å®šä½ çš„åŸŸåè®©åˆ«äººè®¿é—®äº†~ 1.5ï¼šç»“æŸè¯­ç¬¬ä¸€éƒ¨åˆ†çš„å†…å®¹åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œæœ€åæˆ‘æƒ³è®²ä¸€ä¸ªè¯ï¼Œä½ æœ€è¿‘å¯èƒ½ç»å¸¸å¬åˆ°ï¼Œç½‘ç»œä¸­ç«‹æ€§ï¼ˆNet Neutralityï¼‰ï¼Œç°åœ¨çš„ä½ å¯¹æ•°æ®åŒ…ã€è·¯ç”±ã€ä¸‡ç»´ç½‘åº”è¯¥æœ‰äº†ä¸ªå¤§ä½“çš„è®¤è¯†ï¼Œè¶³å¤Ÿä½ ç†è§£è¿™ä¸ªäº‰è®ºçš„æ ¸å¿ƒç‚¹ï¼Œè‡³å°‘ä»æŠ€æœ¯è§’åº¦ä¸Šæ¥è¯´ã€‚ ç®€å•è¯´ç½‘ç»œä¸­ç«‹æ€§æ˜¯åº”è¯¥å¹³ç­‰å¯¹å¾…æ‰€æœ‰æ•°æ®åŒ…ï¼Œä¸è®ºè¿™ä¸ªæ•°æ®åŒ…æ˜¯æˆ‘çš„é‚®ä»¶ï¼Œæˆ–è€…æ˜¯ä½ æ­£åœ¨çœ‹çš„è§†é¢‘ï¼Œé€Ÿåº¦å’Œä¼˜å…ˆçº§åº”è¯¥æ˜¯ä¸€æ ·çš„ï¼Œä½†å¾ˆå¤šå…¬å¸ä¼šä¹æ„è®©ä»–ä»¬çš„æ•°æ®ä¼˜å…ˆåˆ°è¾¾ï¼Œæ‹¿Comcastä¸¾ä¾‹ï¼Œä»–ä»¬ä¸ä»…æ˜¯å¤§å‹äº’è”ç½‘æœåŠ¡æä¾›å•†ï¼Œè€Œä¸”æ‹¥æœ‰å¾ˆå¤šå®¶ç”µè§†é¢‘é“ï¼Œæ¯”å¦‚NBCã€The Weather Channelç­‰ï¼Œå¯ä»¥åœ¨çº¿è§‚çœ‹ï¼Œæˆ‘ä¸æ˜¯ç‰¹æ„è¦æ‰¾Comcastéº»çƒ¦ï¼Œä½†è¦æ˜¯æ²¡æœ‰ç½‘ç»œä¸­ç«‹æ€§ï¼ŒComcastå¯ä»¥è®©è‡ªå·±çš„å†…å®¹ä¼˜å…ˆåˆ°è¾¾ï¼ŒèŠ‚æµå…¶ä»–çš„çº¿ä¸Šè§†é¢‘ï¼ˆèŠ‚æµæ˜¯æŒ‡æ•…æ„ç»™æ›´å°‘å¸¦å®½å’Œæ›´ä½çš„ä¼˜å…ˆçº§ï¼‰ã€‚ æ”¯æŒç½‘ç»œä¸­ç«‹æ€§çš„äººè¯´ï¼Œæ²¡æœ‰ä¸­ç«‹æ€§åï¼ŒæœåŠ¡å•†å¯ä»¥æ¨å‡ºæé€Ÿçš„â€é«˜çº§å¥—é¤â€œï¼Œç»™å‰¥å‰Šæ€§å•†ä¸šæ¨¡å¼åŸ‹ä¸‹ç§å­ï¼Œäº’è”ç½‘æœåŠ¡ä¾›åº”å•†ç§°ä¸ºä¿¡æ¯çš„â€å®ˆé—¨äººâ€œï¼Œä»–ä»¬æœ‰ç€å¼ºçƒˆçš„åŠ¨æœºå»ç¢¾å‹å¯¹æ‰‹ï¼Œå¦å¤–ï¼Œç½‘é£å’Œè°·æ­Œè¿™æ ·çš„å¤§å…¬å¸å¯ä»¥èŠ±é’±ä¹°ç‰¹æƒï¼Œè€Œå°å…¬å¸ï¼Œæ¯”å¦‚åˆšæˆç«‹çš„åˆ›ä¸šå…¬å¸å°†ä¼šå¤„äºåŠ£åŠ¿ï¼Œé˜»æ­¢äº†åˆ›æ–°ã€‚ å¦ä¸€æ–¹é¢ï¼Œä»æŠ€æœ¯åŸå› çœ‹ï¼Œä¹Ÿè®¸ä½ ä¼šå¸Œæœ›ä¸åŒçš„æ•°æ®ä¼ è¾“é€Ÿåº¦ä¸åŒï¼Œä½ å¸Œæœ›bç«™çœ‹è§†é¢‘ä¼˜å…ˆçº§æ›´é«˜ï¼Œè€Œä¼ä¸šå¾®ä¿¡å‘çš„é‚®ä»¶æ…¢å‡ ç§’æ²¡å…³ç³»ï¼Œè€Œåå¯¹ç½‘ç»œä¸­ç«‹æ€§çš„äººåˆ™è®¤ä¸ºï¼Œå¸‚åœºç«äº‰ä¼šé˜»ç¢ä¸è‰¯è¡Œä¸ºï¼Œå¦‚æœä¾›åº”å•†æŠŠå®¢æˆ·å–œæ¬¢çš„ç½‘ç«™é™é€Ÿï¼Œå®¢æˆ·ä¼šé€‰æ‹©ç¦»å¼€ä¾›åº”å•†ï¼Œè¿™åœºäº‰è¾©è¿˜ä¼šæŒç»­å¾ˆä¹…ï¼Œä½ åº”è¯¥å­¦ä¼šå»ç‹¬ç«‹æ€è€ƒï¼Œä¸»åŠ¨è·å–ä¸€äº›ä¿¡æ¯ä¹‹åå†å‘è¡¨è‡ªå·±çš„çœ‹æ³•ï¼Œå› ä¸ºç½‘ç»œä¸­ç«‹æ€§ååˆ†å¤æ‚å’Œå¹¿æ³›ã€‚ äºŒã€åºåˆ—åŒ–2.1ï¼šåºåˆ—åŒ–æ˜¯åšä»€ä¹ˆçš„ï¼Ÿå›åˆ°æˆ‘ä»¬ä¹‹å‰è®²è¿‡çš„TCP/IPä¼ é€’çš„æ•°æ®åŒ…çš„åŸºæœ¬ç»“æ„ï¼Œå®ƒé•¿ä¸‹é¢è¿™æ ·ï¼š æŠ›å»å¸¦é¢†æˆ‘ä»¬æ•°æ®è·¯ç”±çš„IPåè®®å¤´å’Œæ‰¾åˆ°å…·ä½“ç¨‹åºçš„TCPåè®®å¤´ï¼Œå‰©ä¸‹çš„éƒ¨åˆ†å°±æ˜¯æˆ‘ä»¬æ‰€è¦ä¼ è¾“çš„å…·ä½“æ•°æ®æµï¼Œæˆ‘ä»¬å‡è®¾ç°åœ¨æµè§ˆå™¨å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œä¸ºäº†æ–¹ä¾¿è¡¨è¿°ï¼Œè¿™ä¸ªè¯·æ±‚åªå‘ä¸€ä¸ªæ•°æ®åŒ…åˆ°æˆ‘ä»¬çš„web serverï¼ˆç«¯å£å·å‡è®¾ä¸º80ï¼‰ç¨‹åºä¸Šï¼Œå®ƒçš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š å‰é¢è¯´è¿‡ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨éƒ½æ˜¯æ”¯æŒè§£æHTTPåè®®çš„ï¼ˆè¿™é‡Œæ˜¯ä¸æ˜¯æ›´åŠ ç†è§£ä¸ºä»€ä¹ˆHTTPæ˜¯åº”ç”¨å±‚åè®®äº†å‘¢ï¼Ÿä½ çœ‹çœ‹ä¸Šå›¾é‡ŒHTTPçš„è§£æï¼Œéƒ½æ˜¯å‘ç”Ÿåœ¨å®é™…åº”ç”¨é‡Œè§£æçš„ï¼‰ï¼Œä½†æ˜¯å®é™…å‚ä¸ä¸¤ä¸ªåº”ç”¨åšä¸šåŠ¡å¤„ç†çš„è¿™äº›ä¸šåŠ¡æ•°æ®æ‰æ˜¯æˆ‘ä»¬æœ€ç»ˆæœ€ç»ˆéœ€è¦å…³å¿ƒçš„æ•°æ®ï¼Œå› ä¸ºå®ƒä»¬å…³ç³»ç€æˆ‘ä»¬çš„ä¸šåŠ¡ä»£ç çš„èµ°å‘ï¼Œé‚£ä¹ˆä¸šåŠ¡DATAä¹Ÿæ˜¯ä¸ªäºŒè¿›åˆ¶å­—èŠ‚æµå•Šï¼Œé‚£å¯æ€ä¹ˆåŠï¼Ÿè¿™æ„å‘³ç€æµè§ˆå™¨å’ŒæœåŠ¡ç«¯éƒ½æ— æ³•è§£æå‡ºæœ€ç»ˆçš„ä¸šåŠ¡æ•°æ®åº”è¯¥æ˜¯ä»€ä¹ˆï¼Œä¸¾ä¸ªæˆ‘ä»¬å¸¸ç”¨çš„ä¾‹å­ï¼ˆä¸ºäº†æ–¹ä¾¿æè¿°é—®é¢˜ï¼Œæˆ‘ä»¬çœå»äº†åº”ç”¨å±‚ä»¥ä¸‹çš„æµç¨‹ï¼‰ï¼š æˆ‘ä»¬æŠ½è±¡äº†ä¸¤ç§å¸¸ç”¨çš„HTTPè¯·æ±‚æ–¹å¼ï¼Œä¸€ç§æ˜¯è·å–ä¿¡æ¯çš„GETè¯·æ±‚ï¼Œä¸€ç§æ˜¯æäº¤è¡¨å•ä¿¡æ¯çš„POSTè¯·æ±‚ï¼Œä½†æ˜¯ä½ ä¼šå‘ç°ï¼ŒGETåœ¨æ ¹æ®idæŸ¥åˆ°seasonä¿¡æ¯åï¼Œéœ€è¦è¿”å›ç»™æµè§ˆå™¨ï¼Œè€Œæµè§ˆå™¨ä¹Ÿå¿…é¡»å¾—è¯†åˆ«åç«¯ç¨‹åºå‘è¿‡æ¥è¿™ä¸ªå­—èŠ‚æµçš„æ•°æ®ç»“æ„ï¼Œæ‰èƒ½è¿›ä¸€æ­¥åšä¸šåŠ¡å¤„ç†ï¼ŒåŒæ ·çš„ï¼ŒPOSTè¯·æ±‚è¿™ä¸ªé—®é¢˜åˆ™è¡¨ç°å¾—æ›´åŠ å½»åº•ï¼Œé¦–å…ˆæµè§ˆå™¨è¡¨å•å¡«å†™å®Œæˆåï¼Œä¼ çš„å‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼ŒæœåŠ¡ç«¯å¤„ç†å®Œæˆåä¹Ÿä¼šè¿”å›ä¸€ä¸ªåº”ç­”ç»“æ„ä½“ä¾›æµè§ˆå™¨åšè‡ªå·±çš„ä¸šåŠ¡å¤„ç†ã€‚ å¥½çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬æ¢³ç†äº†ä¸‹ï¼Œå›æƒ³ä¸‹ï¼Œæµè§ˆå™¨é‡Œè´Ÿè´£å‘è¯·æ±‚ä»¥åŠè§£æåç«¯è¿”å›æ•°æ®çš„è¯­è¨€å«å•¥ï¼Ÿå—¯ï¼Œå°±æ˜¯JavaScriptï¼Œè€Œæˆ‘ä»¬å‰é¢è¯´è¿‡ï¼Œweb serveråˆæ˜¯ç”±åˆ«çš„è¯­è¨€æ¥å®ç°çš„ï¼Œæ¯”å¦‚tomcatï¼Œå®ƒæ˜¯ç”±javaå¼€å‘çš„ï¼Œé‚£ç°åœ¨é—®é¢˜ç®€åŒ–å¤šäº†ï¼š ä¸Šå›¾çš„é—®é¢˜ï¼Œè¢«æˆ‘ä»¬ç”¨jsonè§£å†³äº†ï¼Œè¿™å°±æ˜¯jsonçš„æ„ä¹‰ï¼Œjsonæ˜¯ä¸€ä¸ªè·¨è¯­è¨€çš„åºåˆ—åŒ–æ–¹å¼ï¼Œjsæœ¬èº«å°±æ”¯æŒjsonç¼–è§£ç ï¼Œjavaä¹Ÿæœ‰è‡ªå·±çš„jsonç¼–è§£ç å·¥å…·ï¼šfastjsonã€gsonç­‰ç­‰ï¼Œè¿™æ ·ï¼ŒJSå¯ä»¥è§£æJAVAä¼ è¿‡æ¥çš„å­—èŠ‚æµï¼ŒJAVAä¹Ÿå¯ä»¥è§£æJSä¼ æ¥çš„å­—èŠ‚æµã€‚ æ ¹æ®ä¸Šå›¾ï¼Œç®€å•ç†è§£å°±æ˜¯ï¼š åºåˆ—åŒ–å°±æ˜¯ä»¥æŸç§ç®—æ³•æ–¹å¼è®©è‡ªå·±çš„æ•°æ®ç»“æ„å¯¹è±¡å˜æˆä¸€ä¸ªäºŒè¿›åˆ¶å­—èŠ‚æµ ååºåˆ—åŒ–å°±æ˜¯ä»¥æŸç§ç®—æ³•æ–¹å¼å°±æ˜¯è®©ä¸€ä¸ªä»¥åŒæ ·ç®—æ³•ç¼–ç çš„å­—èŠ‚æµå˜æˆè‡ªå·±çš„ä¸€ä¸ªæ•°æ®ç»“æ„å¯¹è±¡ è¯´äººè¯å°±æ˜¯ï¼Œjavaå¯ä»¥è®©æµè§ˆå™¨ä¼ æ¥çš„å­—èŠ‚æµå˜æˆè‡ªå·±çš„ä¸€ä¸ªç±»çš„å¯¹è±¡ï¼Œç±»å°±æ˜¯javaçš„æ•°æ®ç»“æ„ï¼Œè€Œjsä¹Ÿå¯ä»¥é€šè¿‡ajaxè·å–åˆ°çš„æœåŠ¡ç«¯å­—èŠ‚æµå˜æˆè‡ªå·±å¯è¯†åˆ«çš„å¯¹è±¡ç»“æ„ã€‚ è¿™ç§ç®—æ³•å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„åºåˆ—åŒ–ç®—æ³•ï¼Œç›®å‰æœ‰javaè‡ªå·±çš„åºåˆ—åŒ–ç®—æ³•ã€jsonã€protobufç­‰ã€‚ å‘æ•£ä¸‹æ€ç»´ï¼Œå¦‚æœå›¾27é‡Œæµè§ˆå™¨é€šä¿¡çš„ä¹Ÿæ˜¯JAVAä»£ç å†™çš„ç¨‹åºè€Œä¸æ˜¯JSï¼Œä¼šä¸ä¼šä¹Ÿæœ‰åºåˆ—åŒ–é—®é¢˜ï¼Ÿå½“ç„¶æœ‰å•¦ï¼Œè¯´åˆ°åº•ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–ååºåˆ—åŒ–ï¼Œè¿˜ä¸æ˜¯å› ä¸ºç½‘ç»œä¼ è¾“åªèƒ½æ˜¯äºŒè¿›åˆ¶å­—èŠ‚æµï¼Œåªè¦è·¨è¿›ç¨‹äº†ï¼Œè¿™ä¸ªé—®é¢˜å°±å›ºç„¶å­˜åœ¨ï¼Œæˆ‘ä»¬åˆšåˆšåˆ—ä¸¾äº†ä¸€äº›åºåˆ—åŒ–æ–¹å¼ï¼Œjsonåšåˆ°äº†è·¨è¯­è¨€ï¼Œæ¯”å¦‚jsæ”¯æŒï¼Œjavaä¹Ÿæ”¯æŒï¼Œgoä¹Ÿæ”¯æŒï¼Œphpä¹Ÿæ”¯æŒï¼Œæ‰€ä»¥jsonå¾ˆå‰å®³ï¼Œè€Œjavaä¹Ÿæœ‰è‡ªå·±çš„åºåˆ—åŒ–æ–¹å¼ï¼Œè¿™ç§æ–¹å¼è§£ç ç¨‹åºä»…é€‚ç”¨äºjavaç¨‹åºè‡ªå·±ï¼Œå®ƒåšä¸åˆ°è®©jsä¹Ÿç†è§£ã€‚ 2.2ï¼šJAVAæ˜¯å¦‚ä½•åšåºåˆ—åŒ–çš„ï¼Ÿé€šè¿‡ä¸Šä¸€èŠ‚çš„ç†è§£ï¼Œåºåˆ—åŒ–å°±æ˜¯è®©è‡ªå·±å˜æˆä¸€ä¸²äºŒè¿›åˆ¶å­—èŠ‚æµï¼Œååºåˆ—åŒ–å°±æ˜¯è®©ä¸€ä¸²äºŒè¿›åˆ¶å­—èŠ‚æµå˜æˆä¸€ä¸ªjavaå¯¹è±¡ï¼Œé‚£æˆ‘ä»¬ç°åœ¨ç”¨javaçš„ä¼ ç»Ÿè‰ºèƒ½æ¥åšä¸‹è¿™ä¸ªäº‹æƒ…ï¼Œè¿˜è®°å¾—ä¹‹å‰ç”»çš„java ioå®¶æ—ç»§æ‰¿å›¾å—ï¼Ÿjavaç”¨æ¥åºåˆ—åŒ–çš„å†…å®¹ä¹Ÿå±äºè¿™ä¸€å—çš„å†…å®¹ï¼Œå®ƒæ˜¯ç”±è¿™ä¿©ç±»æ¥å®Œæˆçš„ï¼š æˆ‘ä»¬ä¸èƒ½å› æ­¤åšä¸€ä¸ªç½‘ç»œä¼ è¾“ï¼Œå¤ªè´¹åŠ²äº†ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ–‡ä»¶ioæ¥åšè¿™ä¸ªäº‹æƒ…ï¼ˆæœ¬è´¨ä¸Šæ²¡ä»€ä¹ˆä¸åŒï¼Œè¯»ç½‘ç»œä¼ è¿›æ¥çš„ioå­—èŠ‚æµè·Ÿè¯»æ–‡ä»¶é‡Œé¢çš„å­—èŠ‚æµæ•ˆæœæ˜¯ä¸€è‡´çš„ï¼Œåªä¸è¿‡ä¸€ä¸ªæ˜¯ä»ç½‘å…³æ¥æ”¶æ•°æ®ï¼Œä¸€ä¸ªæ˜¯ä»æ–‡ä»¶æ¥æ”¶æ•°æ®ï¼‰ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç±»ï¼š ä»£ç å—21234567891011121314151617181920212223242526272829303132public class Season implements Serializable { //é€šè¿‡å®ç°Serializableæ¥å£ï¼Œæ¥æ ‡è®°è¯¥å¯¹è±¡æ˜¯å…è®¸è¢«åºåˆ—åŒ–çš„ private int season_id; private String title; private transient String index; //è¢«transientä¿®é¥°çš„å­—æ®µä¸å‚ä¸åºåˆ—åŒ–å’Œååºåˆ—åŒ– public int getSeason_id() { return season_id; } public void setSeason_id(int season_id) { this.season_id = season_id; } public String getTitle() { return title; } public void setTitle(String title) { this.title = title; } public String getIndex() { return index; } public void setIndex(String index) { this.index = index; }} ä»£ç å—3123456789101112131415161718192021222324252627282930313233public class Test { public static void main(String[] args) throws Exception { //newä¸€ä¸ªSeasonå¯¹è±¡ Season season = new Season(); season.setSeason_id(1); season.setTitle(\"å¯’è‰é¸£æ³£ä¹‹æ—¶\"); season.setIndex(\"ç´¢å¼•1\"); serializable(season); //æŠŠå®ƒåºåˆ—åŒ–åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œå» Season season2 = deSerializable(); //ä»æ–‡ä»¶è¯»å–è¢«åºåˆ—åŒ–å¥½çš„seasonå¯¹è±¡çš„å­—èŠ‚æµï¼Œç„¶åååºåˆ—åŒ–æˆä¸€ä¸ªæ–°çš„å¯¹è±¡ System.out.println(\"season_id = \" + season2.getSeason_id() + \" title = \" + season2.getTitle() + \" index = \" + season2.getIndex()); System.out.println(season == season2); //è¿™æ˜¯ä¿©ä¸åŒçš„å¯¹è±¡ï¼Œç»“æœä¸ºfalse } //åºåˆ—åŒ– public static void serializable(Season season) throws Exception { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(new File(\"/Users/sunqinwen/Documents/season.txt\"))); //æˆ‘ä»¬æŠŠè¿™ä¸ªå¯¹è±¡å†™è¿›å¯¹åº”çš„æ–‡ä»¶ oos.writeObject(season); System.out.println(\"å¯¹è±¡åºåˆ—åŒ–æˆåŠŸï¼\"); oos.close(); } //ååºåˆ—åŒ– public static Season deSerializable() throws Exception { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(new File(\"/Users/sunqinwen/Documents/season.txt\"))); //æˆ‘ä»¬æŠŠæ–‡ä»¶é‡Œçš„å­—èŠ‚æµè¯»å–è¿›æ¥è¿›è¡Œååºåˆ—åŒ– Season result = (Season) ois.readObject(); return result; } } è¿è¡Œç»“æœï¼š ä»£ç å—4123å¯¹è±¡åºåˆ—åŒ–æˆåŠŸï¼season_id = 1 title = å¯’è‰é¸£æ³£ä¹‹æ—¶ index = nullfalse å¯ä»¥çœ‹åˆ°ï¼Œè¢«transientä¿®é¥°çš„indexå­—æ®µå¹¶æ²¡æœ‰å‚ä¸åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸‹season.txtè¿™ä¸ªæ–‡ä»¶é‡Œçš„å†…å®¹ï¼š ä½ æ²¡æœ‰å¿…è¦è¯»æ‡‚è¿™æ®µå†…å®¹ï¼Œä½ åªéœ€è¦çŸ¥é“ï¼Œè¿™å—å†…å®¹æ˜¯javaæŒ‰ç…§æŸç§è§„åˆ™ç”Ÿæˆçš„å†…å®¹ï¼Œè¿™æ®µå†…å®¹è¢«ä»¥å­—èŠ‚æµçš„æ–¹å¼è¯»è¿›ä¸€ä¸ªjavaç¨‹åºé‡Œï¼Œå†é€šè¿‡javaååºåˆ—åŒ–ç±»è¿›è¡Œè§£ç ï¼Œå®ƒå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªä½ æƒ³è¦çš„å¯¹è±¡ã€‚ 2.3ï¼šFastJsonä¸jsonåºåˆ—åŒ–æˆ‘ä»¬åœ¨2.1é‡Œè®²è¿‡jsonæ˜¯ä¸€ä¸ªè·¨è¯­è¨€çš„åºåˆ—åŒ–æ–¹å¼ï¼Œå®ƒæœ‰ç€äººå¯ä»¥è¯»æ‡‚çš„å­—ç¬¦ä¸²ç»“æ„ï¼Œå°†è¿™äº›ç¬¦åˆjsonç»“æ„çš„å­—ç¬¦ç›´æ¥å½•å…¥æ–‡ä»¶ï¼Œç„¶åè®©javaè¯»å–å‡ºæ¥ï¼Œé€šè¿‡javaçš„fastjsonå·¥å…·åŒ…ï¼Œå°±å¯ä»¥å°†è¿™ä¸ªjsonå­—èŠ‚æµå˜æˆä½ javaç¨‹åºå†…å¯¹åº”çš„æ•°æ®ç»“æ„ï¼ˆç±»ï¼‰çš„å¯¹è±¡ï¼Œfastjsonæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œä½¿ç”¨å‰éœ€è¦åœ¨ä½ çš„gradleæ–‡ä»¶é‡Œå¼•å…¥å®ƒï¼š ä»£ç å—51compile group: 'com.alibaba', name: 'fastjson', version: '1.2.67' //åœ¨ä½ gradleæ–‡ä»¶çš„dependenciesä¸‹åŠ å…¥è¿™æ®µä»£ç ï¼Œgradleå°±ä¼šå¸®ä½ è‡ªåŠ¨ä¾èµ–è¿›æ¥å®ƒçš„jaråŒ… ç„¶åæˆ‘ä»¬å°†ä¸Šé¢çš„ä¾‹å­æ¥åˆ©ç”¨fastjsonæ”¹ç¼–ä¸‹ï¼š ä»£ç å—6123456789101112131415161718192021222324252627282930313233public class Test { public static void main(String[] args) throws Exception { //newä¸€ä¸ªSeasonå¯¹è±¡ Season season = new Season(); season.setSeason_id(1); season.setTitle(\"å¯’è‰é¸£æ³£ä¹‹æ—¶\"); season.setIndex(\"ç´¢å¼•1\"); serializable(season); //æŠŠå®ƒåºåˆ—åŒ–åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œå» Season season2 = deSerializable(); //ä»æ–‡ä»¶è¯»å–è¢«åºåˆ—åŒ–å¥½çš„seasonå¯¹è±¡çš„å­—èŠ‚æµï¼Œç„¶åååºåˆ—åŒ–æˆä¸€ä¸ªæ–°çš„å¯¹è±¡ System.out.println(\"season_id = \" + season2.getSeason_id() + \" title = \" + season2.getTitle() + \" index = \" + season2.getIndex()); System.out.println(season == season2); //è¿™æ˜¯ä¿©ä¸åŒçš„å¯¹è±¡ï¼Œç»“æœä¸ºfalse } //jsonåºåˆ—åŒ–ï¼Œæˆ‘ä»¬åˆ©ç”¨fastjsonå°†seasonå¯¹è±¡åºåˆ—åŒ–åˆ°æ–‡ä»¶é‡Œ public static void serializable(Season season) throws Exception { byte[] seasonByte = JSONObject.toJSONBytes(season); Path path = Paths.get(\"/Users\", \"sunqinwen\", \"Documents\", \"seasonJson.txt\"); if (!Files.exists(path)) { //è‹¥æ–‡ä»¶ä¸å­˜åœ¨ Files.createFile(path); //åˆ›å»ºæ–‡ä»¶ } Files.write(path, seasonByte); //å°†åºåˆ—åŒ–å¥½çš„å­—èŠ‚æµå­˜å…¥æ–‡ä»¶ } //jsonååºåˆ—åŒ–ï¼Œæˆ‘ä»¬åˆ©ç”¨fastjsonå°†æ–‡ä»¶é‡Œçš„å­—èŠ‚æµé‡æ–°è½¬æ¢æˆSeasonå¯¹è±¡ public static Season deSerializable() throws Exception { Path path = Paths.get(\"/Users\", \"sunqinwen\", \"Documents\", \"seasonJson.txt\"); byte[] seasonByte = Files.readAllBytes(path); //è¯»å–å‡ºæ¥æ‰€æœ‰çš„å­—èŠ‚ return JSONObject.parseObject(seasonByte, Season.class); //ååºåˆ—åŒ–æˆå¯¹åº”ç±»å‹çš„å¯¹è±¡ } } è¿è¡Œç»“æœï¼š ä»£ç å—712season_id = 1 title = å¯’è‰é¸£æ³£ä¹‹æ—¶ index = nullfalse è®©æˆ‘ä»¬æ¥çœ‹ä¸‹seasonJson.txtï¼š æˆ‘ä»¬ç»ˆäºå¯ä»¥çœ‹æ‡‚äº†ï¼Œè¿™å°±æ˜¯jsonæœ‰é­…åŠ›çš„åœ°æ–¹ï¼Œå®ƒå®é™…çš„æ ¼å¼å°±æ˜¯ä¾¿äºäººç±»é˜…è¯»çš„ï¼Œå®é™…ä¸Šå®ç°äº†jsonåºåˆ—åŒ–çš„å·¥å…·ä¹Ÿæ˜¯æŒ‰ç…§è¿™ç§æ ¼å¼æ¥è§£æè¿™äº›jsonä¸²çš„ï¼Œjsonå°±ä¸è¿‡å¤šä»‹ç»äº†ï¼Œå®é™…ä¸Šåœ¨æµ‹è¯•å½“ä¸­ï¼Œä½ å·²ç»è§è¿‡å¤ªå¤šå¤æ‚çš„ç»“æ„ä½“äº†ã€‚ ä½†æ˜¯ï¼Œjsonä¸²å¦‚ä½•å’Œæˆ‘ä»¬çš„javaå¯¹è±¡æ˜ å°„èµ·æ¥å‘¢ï¼Ÿæˆ‘ä»¬æ¥å†™ä¸€ä¸ªå¤æ‚ä¸€ç‚¹çš„javaç±»ï¼š ä»£ç å—8123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657public class Student { private int id; private String name; private int age; private int[] nos; private List&lt;Season&gt; seasons; private Map&lt;String, Season&gt; season_map; public int getId() { return id; } public void setId(int id) { this.id = id; } public String getName() { return name; } public void setName(String name) { this.name = name; } public int getAge() { return age; } public void setAge(int age) { this.age = age; } public int[] getNos() { return nos; } public void setNos(int[] nos) { this.nos = nos; } public List&lt;Season&gt; getSeasons() { return seasons; } public void setSeasons(List&lt;Season&gt; seasons) { this.seasons = seasons; } public Map&lt;String, Season&gt; getSeason_map() { return season_map; } public void setSeason_map(Map&lt;String, Season&gt; season_map) { this.season_map = season_map; }} ç„¶åæˆ‘ä»¬æ¥ç»™å®ƒçš„ä¸€ä¸ªå¯¹è±¡èµ‹å€¼åå†è½¬æˆjsonä¸²ï¼š ä»£ç å—9123456789101112131415161718192021222324252627282930313233343536public static void main(String[] args) { Student student = new Student(); student.setId(1); student.setName(\"è›¤è›¤\"); student.setAge(1000000); student.setNos(new int[]{1, 2, 3, 4, 5}); Map&lt;String, Season&gt; seasonMap = new HashMap&lt;&gt;(); Season season1 = new Season(); season1.setSeason_id(1); season1.setTitle(\"å¯’è‰é¸£æ³£ä¹‹æ—¶ ç¬¬ä¸€å­£\"); Season season2 = new Season(); season2.setSeason_id(2); season2.setTitle(\"å¯’è‰é¸£æ³£ä¹‹æ—¶ ç¬¬äºŒå­£\"); seasonMap.put(\"ç¬¬1å­£\", season1); seasonMap.put(\"ç¬¬2å­£\", season2); student.setSeason_map(seasonMap); List&lt;Season&gt; seasons = new ArrayList&lt;&gt;(); Season season3 = new Season(); season3.setSeason_id(3); season3.setTitle(\"ç«å½±å¿è€… ç–¾é£ä¼ \"); Season season4 = new Season(); season4.setSeason_id(4); season4.setTitle(\"å°‘å¥³ç»ˆæœ«æ—…è¡Œ\"); seasons.add(season3); seasons.add(season4); student.setSeasons(seasons); System.out.println(JSON.toJSONString(student)); //åˆ©ç”¨fastjsonè¿™ä¸ªJSONç±»çš„é™æ€æ–¹æ³•toJSONStringï¼Œå¯ä»¥æŠŠä¸€ä¸ªå¯¹è±¡è½¬æˆjsonä¸²} è¿è¡Œç»“æœï¼Œæˆ‘ä»¬æ ¼å¼åŒ–ä¸€ä¸‹ï¼Œæ˜¯ä¸‹é¢çš„å­—ç¬¦ä¸²ï¼š ä»£ç å—101234567891011121314151617181920212223{ \"age\": 1000000, \"id\": 1, \"name\": \"è›¤è›¤\", \"nos\": [1, 2, 3, 4, 5], \"season_map\": { \"ç¬¬1å­£\": { \"season_id\": 1, \"title\": \"å¯’è‰é¸£æ³£ä¹‹æ—¶ ç¬¬ä¸€å­£\" }, \"ç¬¬2å­£\": { \"season_id\": 2, \"title\": \"å¯’è‰é¸£æ³£ä¹‹æ—¶ ç¬¬äºŒå­£\" } }, \"seasons\": [{ \"season_id\": 3, \"title\": \"ç«å½±å¿è€… ç–¾é£ä¼ \" }, { \"season_id\": 4, \"title\": \"å°‘å¥³ç»ˆæœ«æ—…è¡Œ\" }]} ç°åœ¨ï¼Œä»”ç»†è§‚å¯Ÿè¿™ä¸ªjsonä¸²çš„æ¯ä¸€é¡¹ï¼Œç»™æˆ‘ä»¬çš„Studentç±»é‡Œçš„å±æ€§ä¸€ä¸€å¯¹æ¯”ï¼Œä½ å°±ä¼šå‘ç°å®ƒä»¬ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚ ä¸‰ã€Tomcatç»ˆäºåˆ°äº†æœ€ä»¤äººå…´å¥‹çš„æ—¶åˆ»äº†ï¼Œä¹‹å‰äº†è§£äº†é‚£ä¹ˆå¤šç½‘ç»œçŸ¥è¯†ï¼Œæ˜¯æˆ‘ä»¬å†™çš„ä¸šåŠ¡ä»£ç å‘æŒ¥å®ƒæ„ä¹‰çš„æ—¶åˆ»äº†~ 3.1ï¼šTomcatç®€ä»‹ç”¨ç»´åŸºç™¾ç§‘é‡Œçš„è§£é‡Šï¼š Tomcatæ˜¯ç”±Apacheè½¯ä»¶åŸºé‡‘ä¼šå±ä¸‹Jakartaé¡¹ç›®å¼€å‘çš„Servletå®¹å™¨ï¼ŒæŒ‰ç…§Sun Microsystemsæä¾›çš„æŠ€æœ¯è§„èŒƒï¼Œå®ç°äº†å¯¹Servletå’ŒJavaServer Pageï¼ˆJSPï¼‰çš„æ”¯æŒï¼Œå¹¶æä¾›äº†ä½œä¸ºWebæœåŠ¡å™¨çš„ä¸€äº›ç‰¹æœ‰åŠŸèƒ½ï¼Œå¦‚Tomcatç®¡ç†å’Œæ§åˆ¶å¹³å°ã€å®‰å…¨å±€ç®¡ç†å’ŒTomcaté˜€ç­‰ã€‚ç”±äºTomcatæœ¬èº«ä¹Ÿå†…å«äº†HTTPæœåŠ¡å™¨ï¼Œå› æ­¤ä¹Ÿå¯ä»¥è§†ä½œå•ç‹¬çš„WebæœåŠ¡å™¨ã€‚ è¯´äººè¯å°±æ˜¯ï¼šTomcatæ˜¯åŸºäºjavaè¯­è¨€å®ç°çš„ä¸€ä¸ªåŸºäºHTTPåè®®çš„webæœåŠ¡å™¨ç¨‹åºï¼Œä½ å†™çš„ä¸šåŠ¡ä»£ç å¯ä»¥æ”¾åˆ°è¿™ä¸ªæœåŠ¡ç¨‹åºä¸‹é¢ï¼Œç„¶åä½ çš„ä¸šåŠ¡ä»£ç å°±å¯ä»¥è¢«åˆ«äººé€šè¿‡http://xxx.xxx.xxx/pathçš„æ–¹å¼è°ƒç”¨åˆ°ï¼Œè§¦å‘åˆ°äº†ï¼è€Œè¿™èŠ‚è¯¾æ‰€è®²è¿°çš„HTTPåè®®ç¼–è§£ç ã€jsonåºåˆ—åŒ–ä½ å®Œå…¨ä¸éœ€è¦å…³å¿ƒï¼Œtomcatå·²ç»æ”¯æŒäº†ï¼Œä½ ç°åœ¨è¦åšçš„æ˜¯ï¼Œç¼–å†™è‡ªå·±çš„ä¸šåŠ¡ä»£ç ï¼ŒæŠŠå®ƒä»¬æ”¾è¿›å»ï¼Œæ”¾åˆ°tomcatçš„èº«ä½“é‡Œå°±å¥½äº†ï¼å¾ˆå¼€å¿ƒå§ï¼Ÿä½œä¸ºç¨‹åºå‘˜çš„å¹¸ç¦æ„Ÿæ²¹ç„¶è€Œç”Ÿï¼Œæ­£æ˜¯å› ä¸ºå‰è¾ˆä»¬ä¸æ–­çš„é“ºè·¯ï¼Œæˆ‘ä»¬ä¸ç”¨è‡ªå·±å¼€å‘ä¸€ä¸ªæ”¯æŒhttpåè®®çš„æœåŠ¡å™¨ç¨‹åºï¼Œå› ä¸ºå‰è¾ˆä»¬æä¾›äº†Springï¼Œæˆ‘ä»¬ä¸ç”¨è‡ªå·±æ·±å…¥ç†è§£IOCå’ŒAOPæ€æƒ³ï¼Œå› ä¸ºå‰è¾ˆä»¬æä¾›äº†Mybatisï¼Œæˆ‘ä»¬ä¸ç”¨è‹¦æ¼é€šè¿‡ä¼ ç»ŸJDBCè¯»å‡ºæ¥çš„æ•°æ®æ— æ³•ç›´æ¥è½¬æˆjavaå¯¹è±¡ã€‚è¿™é‡Œæåˆ°çš„Springå’ŒMybatisåˆæ˜¯åˆ‡å®å‚ä¸ä½ ä¸šåŠ¡ä»£ç ç¼–å†™çš„ç±»åº“é›†ï¼Œè¢«æˆ‘ä»¬ç§°ä¸ºâ€æ¡†æ¶â€œï¼Œæœ‰äº†å®ƒä»¬ï¼Œæˆ‘ä»¬å†™èµ·æ¥ä¼ä¸šçº§ä¸šåŠ¡ä»£ç ä¼šéå¸¸çš„å¼€å¿ƒï¼Œè¿™äº›åé¢ä¼šé€šè¿‡ä¸€ä¸ªç¨‹åºå¸¦å¤§å®¶æ…¢æ…¢äº†è§£ï¼Œæ­£æ˜¯å› ä¸ºå‰äººä¸æ–­çš„åŠªåŠ›ï¼Œæˆ‘ä»¬å…¶å®å·²ç»å¾ˆçœåŠ›äº†ï¼Œå–œæ¬¢æŠ˜è…¾çš„ç¨‹åºå‘˜è¿˜ä¼šé‡å¤é€ è½®å­ï¼Œè¯•å›¾æ’¼åŠ¨è¿™äº›ä¼ ç»Ÿæ¡†æ¶çš„åœ°ä½ï¼ˆä¸ªäººè§‚ç‚¹ï¼šå–œæ¬¢åˆ›æ–°æ˜¯å¥½äº‹ï¼Œä½†è¦æ‰¾å¯¹ç‚¹ï¼Œæ²¡æœ‰æŠ€æœ¯é©æ–°çš„é€ è½®å­å”¯ä¸€çš„æ„ä¹‰å°±æ˜¯å¸®åŠ©ä½ æ›´æ·±ç†è§£å‰è¾ˆä»¬çš„æ€æƒ³ï¼‰ã€‚ 3.2ï¼šServletä½ ä»¥ä¸ºä½ å†™çš„ä¸šåŠ¡ä»£ç å°±é‚£ä¹ˆå®¹æ˜“æ”¾è¿›Tomcatçš„èº«ä½“é‡Œå—ï¼Ÿä¸å­˜åœ¨çš„ï¼Œä¸Šé¢è¯´äº†ï¼ŒTomcatæ˜¯ä¸€ä¸ªServletå®¹å™¨ï¼Œä»€ä¹ˆæ„æ€ï¼Ÿå°±æ˜¯è¯´ä½ å†™çš„ä»£ç å¿…é¡»è¦ç¬¦åˆServletè§„èŒƒï¼Œè‡³å°‘ä½ çš„ç¨‹åºå…¥å£å¾—ç¬¦åˆServletï¼ŒåŒæ ·çš„ï¼Œæˆ‘ä»¬æ‘˜ä¸€æ®µç»´åŸºç™¾ç§‘é‡Œå¯¹å®ƒçš„æè¿°ï¼š Servletï¼ˆServer Appletï¼‰ï¼Œå…¨ç§°Java Servletï¼Œæœªæœ‰ä¸­æ–‡è¯‘æ–‡ã€‚æ˜¯ç”¨Javaç¼–å†™çš„æœåŠ¡å™¨ç«¯ç¨‹åºã€‚å…¶ä¸»è¦åŠŸèƒ½åœ¨äºäº¤äº’å¼åœ°æµè§ˆå’Œä¿®æ”¹æ•°æ®ï¼Œç”ŸæˆåŠ¨æ€Webå†…å®¹ã€‚ç‹­ä¹‰çš„Servletæ˜¯æŒ‡Javaè¯­è¨€å®ç°çš„ä¸€ä¸ªæ¥å£ï¼Œå¹¿ä¹‰çš„Servletæ˜¯æŒ‡ä»»ä½•å®ç°äº†è¿™ä¸ªServletæ¥å£çš„ç±»ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œäººä»¬å°†Servletç†è§£ä¸ºåè€…ã€‚ è¿˜è®°å¾—æˆ‘ä»¬å‰é¢è®²è¿‡çš„ç±»çš„ç»§æ‰¿å¤šæ€ä»¥åŠæ¥å£å—ï¼Ÿä½ å¯ä»¥è¿™æ ·ç†è§£ï¼Œä½ çš„ä¸šåŠ¡ä»£ç ç±»å¾—æ˜¯Servletçš„å®ç°ç±»ï¼Œå¹¶ä¸”å®ç°äº†å®ƒçš„ä¸€äº›æ–¹æ³•åæ‰å¯ä»¥è¢«Tomcatè¯†åˆ«å¹¶è¿›å…¥ï¼Œè¿™å°±æ˜¯javaå¤šæ€çš„å¥½å¤„ä¹‹ä¸€ï¼Œä½ åªè¦ç¬¦åˆæŸç§è§„èŒƒï¼Œå°±å¯ä»¥è¢«åˆ«çš„ç¬¦åˆåŒæ ·è§„èŒƒçš„ç¨‹åºï¼ˆæœ¬ä¾‹æŒ‡tomcatï¼‰æ‰€è¯†åˆ«ï¼Œä½ é‡å†™äº†é‡Œé¢çš„æ–¹æ³•ï¼Œåˆ«çš„ç¨‹åºä¼šè§¦å‘è¢«ä½ é‡å†™çš„æ–¹æ³•ï¼Œçœ‹ï¼ä½ çš„ä¸šåŠ¡ä»£ç å°±è¿™æ ·è¢«è§¦å‘äº†ï¼ 3.3ï¼šåŸºäºServletå®ç°ä¸€ä¸ªä¸šåŠ¡æ¥å£å‰é¢è¯´äº†ä¸€å¤§å †åºŸè¯ï¼Œå¤ªè™šäº†ï¼Œæˆ‘ä»¬æ¥æ–°å»ºä¸€ä¸ªgradleé¡¹ç›®ï¼Œç¼–å†™ä¸€ä¸ªè¿”å›ä¸€ä¸ªå¯¹è±¡jsonç»“æ„ä½“çš„ä¾‹å­ï¼ˆå…¶å®æ²ƒç‰¹ç›è‡ªå·±éƒ½å¿˜äº†å’‹å†™äº†ï¼Œå›å¤´å­¦ä¼šç”¨Spring Bootå†™ä¸€ä¸ªåŒæ ·çš„æ¥å£ï¼Œä½ ä¼šå”¾å¼ƒç°åœ¨è¿™ç§å¹²æ³•çš„ï¼‰ã€‚ 3.3.1ï¼šä¸‹ä¸€ä¸ªtomcatå…ˆtomcatä¸‹è½½åœ°å€ï¼šhttps://tomcat.apache.org/download-80.cgi æ‰¾åˆ°å±äºä½ è‡ªå·±å¹³å°çš„é‚£ä¸ªå³å¯ï¼Œtomcatæ˜¯ä¸éœ€è¦ç‰¹åˆ«å®‰è£…çš„ï¼Œç›´æ¥è§£å‹å°±èƒ½ç”¨ã€‚ å®ƒçš„ç›®å½•é•¿è¿™æ ·ï¼š åœˆå‡ºæ¥çš„æ˜¯æœ€é‡è¦çš„å‡ ä¸ªåŒ…ï¼Œbinå­˜æ”¾çš„æ˜¯tomcatçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œconfä¸‹æ”¾çš„æ˜¯tomcatæœ¬èº«çš„é…ç½®ï¼Œwebappså°±æ˜¯å­˜æ”¾ä½ ä¸šåŠ¡ä»£ç çš„åœ°æ–¹äº†~å½“ç„¶æ­£å¸¸å¼€å‘æ—¶ï¼Œä½ æ˜¯ä¸éœ€è¦æ‰‹åŠ¨å°†ä½ ç¼–è¯‘å¥½çš„ä¸šåŠ¡ä»£ç æ”¾è¿›å»çš„ï¼ŒIDEAå·²ç»å¸®ä½ åšåˆ°äº†ï¼Œä½ éœ€è¦åšçš„æ˜¯ç»™IDEAæŒ‡å®šä¸€ä¸ªtomcatè·¯å¾„ï¼Œè®©IDEAçŸ¥é“ä½ çš„tomcatç¨‹åºåœ¨å“ªé‡Œï¼Œè¿™æ ·ä½ çš„webç¨‹åºåœ¨å¯åŠ¨æ—¶ï¼ŒIDEAå°±å¯ä»¥å¸®ä½ æŠŠå®ƒç¼–è¯‘å¥½çš„ä»£ç æ”¾åˆ°webappsä¸‹é¢äº†ã€‚ 3.3.2ï¼šæ·»åŠ ä¾èµ–åŒ…æˆ‘ä»¬åœ¨æ„å»ºå¥½çš„gradleé¡¹ç›®é‡Œçš„build.gradleçš„dependenciesé‡Œå¼•å…¥ä»¥ä¸‹é…ç½®ï¼Œå¼•å…¥servletçš„jaråŒ…å’Œfastjsonçš„jaråŒ…ï¼š ä»£ç å—1112compileOnly (group: 'javax.servlet', name: 'javax.servlet-api', version: '4.0.1')compile (group: 'com.alibaba', name: 'fastjson', version: '1.2.67') è¿™æ ·ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨servletçš„åŒ…ç¼–å†™ä½ çš„ä¸šåŠ¡ç¨‹åºï¼Œä¹‹å‰è®²è¿‡ï¼Œé€šä¿¡æ—¶ä»¥å­—èŠ‚åšäº¤äº’çš„è¯éœ€è¦åºåˆ—åŒ–ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯ä¸€ä¸ªè¾“å‡ºä¿¡æ¯çš„æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©ä½¿ç”¨jsonæ–¹å¼å®Œæˆåºåˆ—åŒ–ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å¼•å…¥ä¸€ä¸ªjsonåºåˆ—åŒ–å·¥å…·fastjsonç”¨æ¥åšæ•°æ®çš„åºåˆ—åŒ–ã€‚ 3.3.3ï¼šç¼–å†™ä¸šåŠ¡ä»£ç æˆ‘ä»¬è¿™ä¸ªæ¥å£çš„ç›®æ ‡æ˜¯ï¼Œå°†ä¸€ä¸ªå¤æ‚çš„javaå¯¹è±¡ï¼Œä¼ è¾“ç»™æµè§ˆå™¨ï¼Œæˆ‘ä»¬ä»ç„¶ä½¿ç”¨ä¹‹å‰é‚£ä¸ªå¤æ‚çš„Studentåšï¼Œåªä¸è¿‡æˆ‘ä»¬è¦åˆ©ç”¨åˆ†å±‚æ€æƒ³æ¥åšï¼š è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰åœ¨åšä¸€ä¸ªç®€å•çš„å¢åˆ æ”¹æŸ¥æ—¶é‚£ä¸ªä¾‹å­é‡Œçš„ä¸šåŠ¡åˆ†å±‚æ¨¡å¼å—ï¼Ÿè¿™é‡Œä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡æˆ‘ä»¬æ²¡æœ‰åšserviceå±‚ï¼Œå› ä¸ºä¸éœ€è¦ï¼Œæˆ‘ä»¬åªæ˜¯è¦å°†ä¸€ä¸ªå¯¹è±¡è¾“é€å‡ºå»ï¼Œæ²¡æœ‰ä»»ä½•ç‰¹åˆ«çš„ä¸šåŠ¡é€»è¾‘æ“ä½œã€‚ æˆ‘ä»¬æ¥çœ‹ä¸‹Daoå±‚çš„ä»£ç ï¼š ä»£ç å—121234567891011121314151617181920212223242526272829303132333435363738394041public class StudentDao { //ä¹‹å‰ä¾‹å­é‡Œç»™Studentèµ‹å€¼çš„mainæ–¹æ³•é‡Œçš„é€»è¾‘ï¼Œè¢«æŠ½è±¡è¿›äº†Daoå±‚çš„ä¸€ä¸ªæ–¹æ³•é‡Œ public Student getStudentInfo() { Student student = new Student(); student.setId(1); student.setName(\"è›¤è›¤\"); student.setAge(1000000); student.setNos(new int[]{1, 2, 3, 4, 5}); Map&lt;String, Season&gt; seasonMap = new HashMap&lt;&gt;(); Season season1 = new Season(); season1.setSeason_id(1); season1.setTitle(\"å¯’è‰é¸£æ³£ä¹‹æ—¶ ç¬¬ä¸€å­£\"); Season season2 = new Season(); season2.setSeason_id(2); season2.setTitle(\"å¯’è‰é¸£æ³£ä¹‹æ—¶ ç¬¬äºŒå­£\"); seasonMap.put(\"ç¬¬1å­£\", season1); seasonMap.put(\"ç¬¬2å­£\", season2); student.setSeason_map(seasonMap); List&lt;Season&gt; seasons = new ArrayList&lt;&gt;(); Season season3 = new Season(); season3.setSeason_id(3); season3.setTitle(\"ç«å½±å¿è€… ç–¾é£ä¼ \"); Season season4 = new Season(); season4.setSeason_id(4); season4.setTitle(\"å°‘å¥³ç»ˆæœ«æ—…è¡Œ\"); seasons.add(season3); seasons.add(season4); student.setSeasons(seasons); return student; } } okï¼Œæˆªæ­¢ç›®å‰ï¼Œæˆ‘ä»¬çš„ç¨‹åºå·²ç»å†™å¥½äº†ï¼Œä½†æ˜¯ï¼Œtomcatæ˜¯å¦‚ä½•çŸ¥é“è¿™ä¸ªServletç±»æ‰€åœ¨çš„åœ°æ–¹å‘¢ï¼Ÿå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦ç»™è¿™ä¸ªé¡¹ç›®åŠ ä¸€ä¸ªå«web.xmlçš„é…ç½®æ–‡ä»¶ï¼Œå®ƒçš„ä½ç½®åœ¨ï¼š éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒWEB-INFæ˜¯æ²¡åŠæ³•çœç•¥çš„ï¼Œå¦åˆ™tomcatæ— æ³•è¯»å–åˆ°è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ–‡ä»¶é‡Œéƒ½æ”¾äº†ä»€ä¹ˆä¸œè¥¿å§ï¼š ä»£ç å—141234567891011121314151617&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;web-app xmlns=\"http://xmlns.jcp.org/xml/ns/javaee\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd\" version=\"4.0\"&gt; &lt;servlet&gt; &lt;!--æŒ‡å®šä¸€ä¸ªServletå—ï¼Œå¹¶ä¸”å‘Šè¯‰tomcatè¯¥Servletçš„è·¯å¾„--&gt; &lt;servlet-name&gt;StudentInfoController&lt;/servlet-name&gt; &lt;servlet-class&gt;com.bilibili.controller.StudentInfoController&lt;/servlet-class&gt; &lt;/servlet&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;StudentInfoController&lt;/servlet-name&gt; &lt;url-pattern&gt;/get/student/info&lt;/url-pattern&gt; &lt;!-- httpçš„urlæ˜ å°„--&gt; &lt;/servlet-mapping&gt; &lt;/web-app&gt; è¿™ä¸ªæ–‡ä»¶æ˜¯ç”¨æ¥å‘Šè¯‰tomcatï¼Œæˆ‘è‡ªå®šä¹‰çš„Servletç±»éƒ½åœ¨å“ªé‡Œï¼Œå¥½è®©tomcatè®¿é—®è°ƒç”¨åˆ°ï¼Œè€Œä¸‹é¢çš„æ˜ å°„å°±æ›´æœ‰æ„æ€äº†ï¼Œä½ çš„æµè§ˆå™¨åœ¨è¾“å…¥ä¸€ä¸ªurlæ—¶ï¼Œé™¤äº†åŸŸåï¼Œå°±æ˜¯pathäº†å¯¹å§ï¼Ÿè€Œè¿™ä¸ªæ˜ å°„çš„æ„æ€æ˜¯è¯´ï¼Œå½“ä½ åœ¨æµè§ˆå™¨é‡Œè¾“å…¥â€œwww.xx.com/get/student/infoâ€æ—¶ï¼Œè¿™ä¸ªurlä¼ åˆ°tomcatï¼Œtomcatå¯ä»¥æ ¹æ®pathæ˜ å°„å…³ç³»ï¼Œæ‰¾åˆ°è¿™ä¸ªå«StudentInfoControllerçš„Servletï¼Œè€Œè¿™ä¸ªServletå¯¹åº”å“ªä¸ªå®ç°ç±»å‘¢ï¼Ÿå½“ç„¶å°±æ˜¯ä½ è‡ªå®šä¹‰çš„å­ç±»StudentInfoControllerå•¦~ è‡³æ­¤ï¼Œä½ çš„è¿™ä¸ªç®€å•çš„ï¼Œåªæä¾›è¾“å‡ºStudentå¯¹è±¡çš„æ¥å£ï¼Œå°±å®Œæˆäº†ï¼Œä¸‹é¢è®©æˆ‘ä»¬ç‚¹å‡»ä¸‹tomcatçš„è¿è¡ŒæŒ‰é’®ï¼Œå°±å¯ä»¥å¯åŠ¨äº†ï¼Œå‡è®¾æˆ‘ä»¬ç°åœ¨å·²ç»å¯åŠ¨äº†ï¼Œåœ¨ä½ çš„æµè§ˆå™¨ï¼Œè¾“å…¥ï¼š127.0.0.1:8080/get/student/infoè¯•è¯•å§ï¼Œå®ƒçš„è¿è¡Œç»“æœå¦‚ä¸‹ï¼ˆæˆ‘è‡ªå·±æ”¹äº†ç«¯å£å·8081ï¼Œæ‰€ä»¥å›¾é‡Œæ˜¯8081 -_-||ï¼Œå…¶æ¬¡ï¼Œlocalhost = 127.0.0.1ï¼Œå®ƒè¡¨ç¤ºçš„æ˜¯ä½ æœ¬æœºçš„ipåœ°å€ï¼‰ï¼š ä½ å¯ä»¥æ‰“å¼€ä¸‹æµè§ˆå™¨çš„æ£€æŸ¥åŠŸèƒ½ï¼Œå¯ä»¥å…·ä½“çœ‹åˆ°HTTPåè®®å¤´ä¿¡æ¯ï¼š æˆ‘ä»¬è®¾ç½®çš„Content-Typeå®ƒç”Ÿæ•ˆäº†ï¼Œå®ƒé€šè¿‡HTTPåè®®å¤´æ¥å‘Šè¯‰æµè§ˆå™¨ï¼šâ€œæˆ‘ä¼ ç»™ä½ çš„ä¸šåŠ¡æ•°æ®æµæ˜¯ä»¥jsonåšçš„åºåˆ—åŒ–ï¼Œä½ ä¹Ÿå¾—ç”¨jsonåºåˆ—åŒ–â€ã€‚ ä½ å¯èƒ½ä¼šå¥½å¥‡ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­æ€ä¹ˆæ²¡è§mainæ–¹æ³•å•Šï¼Ÿå› ä¸ºè¿™ä¸ªè¿‡ç¨‹ä¸­ä½ çš„ç¨‹åºåªæ˜¯é™ªè¡¬ï¼ŒçœŸæ­£è¿è¡Œçš„ç¨‹åºæ˜¯åŒ…å«äº†ä½ çš„ä¸šåŠ¡ä»£ç çš„tomcatï¼Œæ‰€ä»¥å¯åŠ¨è¿™ä¸ªåŠ¨ä½œè‚¯å®šæ˜¯å‘ç”Ÿåœ¨äº†tomcatã€‚ 3.3.4ï¼šç»“æŸè¯­ä½ å†™çš„æ™®é€šçš„ä¸šåŠ¡ä»£ç ç»ˆäºå¯ä»¥å ‚å ‚æ­£æ­£çš„è®©æµè§ˆå™¨é€šè¿‡HTTPè¯·æ±‚è®¿é—®åˆ°äº†ï¼ï¼ç°åœ¨çŸ¥é“ä»€ä¹ˆæ˜¯java webäº†å§ï¼Ÿå…¶å®ä¸€å¼€å§‹å¤§å®¶åˆ†çš„å¾ˆç»†ï¼Œåƒä»€ä¹ˆJAVA SEã€JAVA EEï¼ŒJAVA EEå°±æ˜¯java webï¼Œä¹Ÿå«javaä¼ä¸šçº§å¼€å‘ï¼Œå…¶å®ä½ ä¸ç”¨è®¡è¾ƒè¿™ä¹ˆå¤šï¼Œjavaå°±æ˜¯javaï¼Œå› ä¸ºä½ å€ŸåŠ©ä¸€ä¸ªwebç¨‹åºtomcatå®Œæˆäº†ä½ è®©åˆ«äººé€šè¿‡HTTPè¯·æ±‚æ¥è§¦å‘ä½ çš„ä¸šåŠ¡ç¨‹åºï¼Œæ‰€ä»¥ä½ å†™çš„ç¨‹åºä¹Ÿè¢«å«æˆäº†java webï¼Œä»…æ­¤è€Œå·²ï¼Œä½ éœ€è¦å­¦ä¼šä»æ›´å®è§‚çš„è§’åº¦æ¥çœ‹å¾…è¿™äº›ç»†å¾®çš„å·®åˆ«ï¼Œè€Œä¸æ˜¯æ­»æŠ ä¸€äº›ä¸“æœ‰åè¯ã€‚ æœ€åè¿˜æ˜¯è¦è¯´ä¸€ä¸‹ï¼Œä½ æ²¡å‘ç°å†™ä¸€ä¸ªä¸Šé¢çš„ç¨‹åºï¼Œå¾ˆç‰¹ä¹ˆå¤æ‚å—ï¼Ÿè¿˜å¾—ä¸‹è½½é…ç½®tomcatï¼Œè¿˜å¾—é…ç½®ä½ çš„IDEAï¼Œè¿˜å¾—æŒ‡å®šå„ç±»åºåˆ—åŒ–æ–¹å¼ç­‰ç­‰ï¼Œè®©å®ƒå¯ä»¥ç»“åˆtomcatè¿è½¬ä½ çš„ç¨‹åºï¼Œäº‹å®ä¸Šï¼Œå¾ˆå¤šäº‹æƒ…å¤æ‚åˆ°ä¸€å®šç¨‹åº¦ï¼Œå°±ä¸€å®šä¼šæœ‰å·¥ç¨‹å¸ˆå»æä¸ªæ›´æ–¹ä¾¿çš„ä¸œè¥¿å‡ºæ¥ï¼Œè¿™ä¹Ÿæ˜¯æ¥ä¸‹æ¥è¦è®©ä½ ä»¬æ¥è§¦åˆ°çš„ä¸€ä¸ªä¸œè¥¿ï¼šspring bootã€‚ åˆ«å®³æ€•ï¼Œspring bootå¹¶ä¸æ˜¯å•ç‹¬ä¸€é—¨æŠ€æœ¯ï¼Œå®ƒå°±æ˜¯springï¼Œspringçš„ä¸€åˆ‡ç‰¹æ€§å®ƒéƒ½å…·å¤‡ï¼Œä½†æ˜¯å®ƒæ˜¯springçš„è¿›åŒ–æ€ï¼Œå®ƒé‡Œé¢åŒ…å«äº†ä¸€ä¸ªtomcatï¼spring bootå†™å¥½çš„ç¨‹åºï¼Œå°±è‡ªåŠ¨åŒ…å«äº†ä¸Šé¢ä¸€å †æœ‰å…³tomcatçš„é…ç½®ï¼Œä½ å†ä¹Ÿä¸ç”¨æ‹…å¿ƒtomcatçš„ä»»ä½•äº‹æƒ…ï¼Œå†™ä¸ªmainæ–¹æ³•å°±å¥½~","link":"/2020/03/27/LV4-5%EF%BC%9A%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E3%80%81%E5%8D%8F%E8%AE%AE%E3%80%81%E5%BA%8F%E5%88%97%E5%8C%96%E3%80%81%E7%A8%8B%E5%BA%8F%E4%B9%8B%E9%97%B4%E7%9A%84%E8%81%94%E7%B3%BB/"},{"title":"LV4-4ï¼šä½å›¾","text":"ä¸€ã€ç”¨æ³•å…ˆæ¥çœ‹çœ‹javaé‡Œå¯¹ä½å›¾æ•°æ®ç»“æ„çš„å®ç°ç±»ï¼šBitSet ç”¨æ³•å¦‚ä¸‹ï¼š ä»£ç å—1123456789101112131415public static void main(String[] args) { BitSet bitSet = new BitSet(); bitSet.set(78); //åªä¼ ä¸€ä¸ªå‚æ•°ä»£è¡¨å°†è¯¥ä½ç½®ä¸Šçš„æ•°å€¼ç½®ä¸º1ï¼ˆtrueï¼‰ bitSet.set(79, 82); //79ã€80ã€81ä½ä¸ºtrueï¼Œå³[79, 82) bitSet.set(83, true); //83ä½ç½®ä¸º1ï¼ˆtrueï¼‰ System.out.println(bitSet.get(78)); //true System.out.println(bitSet.get(79)); //true System.out.println(bitSet.get(80)); //true System.out.println(bitSet.get(81)); //true System.out.println(bitSet.get(82)); //82ä½ä¸ºfalse System.out.println(bitSet.get(83)); //true bitSet.set(83, false); //å†æ¬¡å°†ç¬¬83ä½ä¸Šçš„å€¼ç½®ä¸º0ï¼ˆå³falseï¼‰ System.out.println(bitSet.get(83)); //ç¬¬83ä½ä¸Šçš„å€¼ä¸º0ï¼ˆfalseï¼‰} æ‰“å°ç»“æœå¦‚ä¸‹ï¼š ä»£ç å—21234567truetruetruetruefalsetruefalse å¾ˆæ‡µé€¼å§ï¼Ÿä½å›¾åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿè¿™äº›â€ä½â€œä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿè®°å½•trueæˆ–falseæœ‰ä»€ä¹ˆç”¨ï¼Ÿç»§ç»­å¾€ä¸‹çœ‹ã€‚ äºŒã€ä½å›¾ å…¶å®ä½å›¾å°±æ˜¯ä¸ªæ•°ç»„ï¼Œæ‰€è°“çš„â€ä½â€œå°±æ˜¯æŒ‡æ•°ç»„é‡Œæ¯ä¸ªæ•°å€¼å…ƒç´ çš„äºŒè¿›åˆ¶ä½ï¼Œåƒä¸åƒæˆ‘ä»¬å¯¹å¼€å…³å­—æ®µçš„å¤„ç†æ–¹å¼ï¼Ÿæ ‡è®°åªæœ‰å­˜åœ¨æˆ–è€…ä¸å­˜åœ¨ï¼ˆå¯¹åº”äºŒè¿›åˆ¶çš„0å’Œ1ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥åšåˆ°ç”¨ä¸€ä¸ªlongå‹çš„æ•°å­—å°±å¯ä»¥äº§ç”Ÿå‡º64ä¸ªæ ‡è®°ä¿¡æ¯ï¼Œéå¸¸é€‚åˆæ•°æ®é‡åºå¤§è€Œåˆ¤æ–­çŠ¶æ€å°‘çš„åº”ç”¨åœºæ™¯ï¼Œæ¯”å¦‚åˆ¤æ–­ä¸€ä¸ªè¯è¯­æ˜¯å¦æ˜¯å±è”½è¯ï¼Œé¦–å…ˆå±è”½è¯çŠ¶æ€åªæœ‰ä¸¤ç§ï¼šå‘½ä¸­orä¸å‘½ä¸­ï¼Œä½†æ˜¯å±è”½è¯å¯èƒ½æ˜¯ä¸ªéå¸¸åºå¤§çš„é›†åˆï¼Œå¦‚æœä¸€ä¸ªä¸ªæ‹¿æ¥æ¯”è¾ƒï¼Œæ•ˆç‡å®Œå…¨ä¿è¯ä¸äº†ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ•°æ®ç»“æ„æ¥è§£å†³è¿™ç±»é—®é¢˜ï¼Œå¯ä»¥é¦–å…ˆæŠŠæ‰€æœ‰çš„å±è”½è¯æ”¾åˆ°ä¸€ä¸ªä½å›¾ç»“æ„é‡Œï¼Œå¦‚æœæœ‰ç›¸åŒçš„è¯è¯­ï¼Œåªéœ€è¦ç®€å•çš„ä¸¤éƒ¨è¿ç®—å°±å¯ä»¥æ‹¿åˆ°æ˜¯å¦å‘½ä¸­ç»“æœï¼Œæ„å»ºè¿™ä¸ªä½å›¾ç»“æ„çš„è¿‡ç¨‹å¦‚ä¸‹ï¼ˆâš ï¸ æ³¨ï¼šä¸‹æ–¹çš„hashç®—æ³•çº¯å±ä¸ºäº†æ–¹ä¾¿ä¸¾ä¾‹è€Œyyäº§ç”Ÿï¼‰ï¼š é€šè¿‡ä¸Šå›¾ï¼Œå±è”½è¯ä½å›¾ç»“æ„å°±æ„å»ºå¥½äº†ï¼Œå¦‚æœæœ‰ä¸ªè¯è¯­éœ€è¦åˆ¤å®šæ˜¯å¦å‘½ä¸­å±è”½è¯ï¼Œåªéœ€è¦è®©è¿™ä¸ªè¯è¯­é€šè¿‡ä¸Šé¢çš„å“ˆå¸Œç®—æ³•è®¡ç®—å‡ºå“ˆå¸Œå€¼ï¼Œç„¶åæ‰¾åˆ°å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ï¼Œé€šè¿‡ä½è¿ç®—ç®—å‡ºå…¶æ‰€åœ¨ä½ç½®ï¼Œå°†è¯¥ä½ç½®çš„å€¼å–å‡ºï¼Œå¦‚æœæ˜¯0ï¼Œåˆ™è®¤ä¸ºæ²¡æœ‰å‘½ä¸­ï¼Œ1åˆ™è®¤ä¸ºå‘½ä¸­ã€‚ æŠ½è±¡åˆ°ä»£ç å—1çš„ä¾‹å­ï¼Œå…¶å®å°±æ˜¯å°†ä¼ å…¥çš„indexï¼Œä¸longå‹çš„64ä½åšé™¤æ³•ï¼Œè®¡ç®—å‡ºè‡ªå·±å±äºæ•°ç»„çš„å“ªä¸ªä¸‹æ ‡å€¼ï¼Œè¿™æ ·å°±æ‰¾åˆ°äº†è‡ªå·±åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼Œç„¶åå†å°†ä¸‹æ ‡å€¼è·Ÿ64å–æ¨¡ï¼Œè®¡ç®—å‡ºå°†è¯¥åè¿›åˆ¶çš„å€¼çš„ç¬¬å‡ ä½æ ‡è®°ä¸º1æˆ–0.","link":"/2020/03/25/LV4-4%EF%BC%9A%E4%BD%8D%E5%9B%BE/"},{"title":"LV4-3ï¼šjavaé‡Œçš„Map","text":"ä»€ä¹ˆæ˜¯Mapç»“æ„å‘¢ï¼Ÿå…¶å®å°±æ˜¯é”®å€¼å¯¹å•¦ï¼Œè·Ÿç¼“å­˜å·®ä¸å¤šï¼Œå­˜å…¥ä¸€ä¸ªkey-valueï¼Œä¸‹æ¬¡æ‹¿ç€keyå¯ä»¥ç›´æ¥è·å–valueçš„å€¼ï¼š Mapç»“æ„çš„åŸºæœ¬ä½¿ç”¨123Map map = new XxxMap();map.put(\"b\", \"bilibili\"); //å­˜å…¥ä¸€ä¸ªk-vString value = map.get(\"b\"); //è¿™é‡Œå°±å¯ä»¥æ‹¿ç€bè¿™ä¸ªkeyå€¼ï¼Œç›´æ¥å–åˆ°valueçš„å€¼äº† ä¸€ã€Mapå®ç°ç±»å…³ç³»å›¾ äºŒã€Mapæä¾›äº†å“ªäº›ä¸»è¦æ–¹æ³•ï¼Ÿ ä¸‰ã€å‡ ç§Mapå®ç°ç±»çš„åŒºåˆ« ç±»å åº•å±‚ç»“æ„ æ˜¯å¦çº¿ç¨‹å®‰å…¨ æ˜¯å¦å…è®¸null key è¯´æ˜ HashMap 1.7ï¼šæ•°ç»„+é“¾è¡¨1.8ï¼šæ•°ç»„+é“¾è¡¨ï¼ˆè¿›åŒ–æ€ï¼šçº¢é»‘æ ‘ï¼‰ å¦ æ˜¯ æœ€åŸºæœ¬å¸¸ç”¨çš„ä¸€ä¸ªMapçš„å®ç°ï¼Œä½†å®ƒå¹¶éçº¿ç¨‹å®‰å…¨ï¼Œä½¿ç”¨æ—¶éœ€è¦æ³¨æ„å¹¶å‘é—®é¢˜ã€‚ LinkedHashMap æ•°ç»„+é“¾è¡¨ï¼ˆè¿›åŒ–æ€ï¼šçº¢é»‘æ ‘ï¼‰ å¦ æ˜¯ ç»§æ‰¿äº†HashMapï¼ŒåŸºæœ¬åŠŸèƒ½ä»ç„¶ç”±HashMapæŒç®¡ï¼Œåªæ˜¯å®ƒçš„keyæ˜¯æœ‰åºçš„ã€‚ TreeMap çº¢é»‘æ ‘ å¦ å¦ å®ƒçš„keyæ˜¯æœ‰åºçš„ï¼Œä¸”å®ƒåŒæ—¶å®ç°äº†SortedMapæ¥å£ã€‚ HashTable æ•°ç»„+é“¾è¡¨ æ˜¯ å¦ çº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½è¾ƒä½ï¼Œä¸å»ºè®®ä½¿ç”¨çš„mapã€‚ ConcurrentHashMap 1.7ï¼šSegmentã€æ•°ç»„+é“¾è¡¨ã€‘1.8ï¼šcas+æ•°ç»„+é“¾è¡¨ï¼ˆè¿›åŒ–æ€ï¼šçº¢é»‘æ ‘ï¼‰ æ˜¯ å¦ 1.7ï¼šçº¿ç¨‹å®‰å…¨ï¼Œç”±äºå…¶å†…éƒ¨åˆ†æ®µé”è®¾è®¡ï¼Œæ€§èƒ½ç›¸å¯¹HashTableè¾ƒé«˜ã€‚1.8ï¼šåŸºäºcasä¿è¯çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ—¶ç»“æ„ä¸1.8çš„HashMapä¸€è‡´ è¡¨1 âšœï¸ æˆ‘ä»¬ç°åœ¨çš„ç¨‹åºåŸºäºjava11è¿›è¡Œï¼Œæ‰€ä»¥ä»¥1.8çš„ä¼˜åŒ–ä¸ºå‡†ï¼Œ1.7åšä¸‹äº†è§£å³å¯ï¼Œå¯¹å†…éƒ¨æ•°æ®ç»“æ„æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥å‚ç…§æºç æˆ–è€…ä¸€äº›åšå®¢è¿›è¡Œæ·±å…¥ç†è§£ï¼Œå¯¹äºMapç»“æ„ï¼Œè‡³å°‘è¦åšåˆ°ä¼šç”¨ï¼Œå®ƒæ˜¯javaé‡Œç»å¸¸ç”¨åˆ°çš„ä¸€ç§ç»“æ„ï¼Œä¸»è¦ç”¨æ³•å‚è€ƒå›¾2çš„APIã€‚ å››ã€å®ä¾‹ä»£ç å—112345678910111213public static void main(String[] args) { Map&lt;String, String&gt; map = new HashMap&lt;&gt;(); Map&lt;String, String&gt; map2 = new LinkedHashMap&lt;&gt;(); Map&lt;String, String&gt; map3 = new TreeMap&lt;&gt;(); Map&lt;String, String&gt; map4 = new Hashtable&lt;&gt;(); Map&lt;String, String&gt; map5 = new ConcurrentHashMap&lt;&gt;(); map.put(null, \"sss\"); map2.put(null, \"sss\"); map3.put(null, \"sss\"); //æŠ¥é”™ map4.put(null, \"sss\"); //æŠ¥é”™ map5.put(null, \"sss\"); //æŠ¥é”™} å¦‚ä¸Šï¼Œè¯æ˜ä¸‹é¢ä¸‰ç§Mapå®ç°ç±»æ— æ³•æ¥æ”¶nullä½œä¸ºkeyçš„å‚æ•°ã€‚ ä»£ç å—21234567891011public static void main(String[] args) { //æ³›å‹æŒ‡å®škeyå’Œvalueéƒ½æ˜¯Stringç±»å‹ Map&lt;String, String&gt; map = new HashMap&lt;&gt;(); map.put(\"a\", \"AcFun\"); map.put(\"b\", \"å“”å“©å“”å“©\"); System.out.println(map.get(\"a\")); System.out.println(map.get(\"b\")); System.out.println(map.containsKey(\"b\")); System.out.println(map.containsKey(\"c\"));} ä¸Šé¢çš„ä»£ç è¾“å‡ºå¦‚ä¸‹ï¼š ä»£ç å—31234AcFunå“”å“©å“”å“©truefalse ä»£ç å—4123456789101112131415public static void main(String[] args) { Cat cat1 = new Cat(); cat1.setName(\"åŠ è²\"); cat1.setAge(8); Cat cat2 = new Cat(); cat2.setName(\"åŠ è²\"); cat2.setAge(8); Map&lt;Cat, String&gt; catMap = new HashMap&lt;&gt;(); catMap.put(cat1, \"cat1\"); catMap.put(cat2, \"cat2\"); System.out.println(catMap.size());} æˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œåˆ¤æ–­ä¸¤åªå±æ€§ç›¸åŒçš„çŒ«ç›¸ç­‰çš„åŠæ³•ï¼Œå°±æ˜¯é‡å†™å…¶equalsæ–¹æ³•ï¼Œé‚£ä¹ˆä»£ç å—4é‡Œçš„sizeåº”è¯¥ä¸º1æ‰å¯¹ï¼Œå› ä¸ºæˆ‘ä»¬è¯´è¿‡ï¼Œmapé‡Œç›¸åŒkeyä¼šç›¸äº’è¦†ç›–ï¼Œæ—¢ç„¶é‡å†™äº†Catç±»çš„equalsæ–¹æ³•ï¼Œé‚£ä¹ˆcat1å’Œcat2å±æ€§ç›¸åŒå°±åº”è¯¥è®¤ä¸ºæ˜¯ç›¸åŒçš„ä¸¤ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆæœ€ç»ˆç¬¬äºŒä¸ªä¼šè¦†ç›–æ‰ç¬¬ä¸€ä¸ªçš„å€¼ï¼Œæœ€ç»ˆsizeä¸º1ï¼Œä¸è¿‡å¯æƒœçš„æ˜¯ï¼Œè¿™ä¸ªç¨‹åºç»“æœæ˜¯2ï¼Œä½ å¯èƒ½ä¼šè¿·æƒ‘ï¼Œåœ¨å‰é¢çš„é›†åˆç±»é‡Œè¿™çš„ç¡®ç®—æ˜¯ç›¸åŒäº†ï¼Œå¯æƒœMapçš„åˆ¤å®šæ›´åŠ ä¸¥æ ¼ï¼Œéœ€è¦Objectçš„hashCodeæ–¹æ³•å‚ä¸ï¼Œæ‰€ä»¥æˆ‘ä»¬é™¤äº†è¦é‡å†™equalsæ–¹æ³•ï¼Œè¿˜è¦é‡å†™Catçš„hashCodeæ–¹æ³•ï¼š ä»£ç å—512345678910111213141516171819202122public class Cat extends Animal { @Override public void cry() { System.out.println(\"å–µå–µå–µ~\"); } public void catchMice() { //æ‰©å±•æ–¹æ³•ï¼šæ•é¼  System.out.println(\"æˆ‘ä¼šæ‰è€é¼ \"); } @Override public int hashCode() { return this.getAge() + this.getName().hashCode(); } @Override public boolean equals(Object obj) { Cat otherCat = (Cat) obj; //å¼ºè½¬ä¸‹ç±»å‹ï¼ˆæ‰€ä»¥è¿™é‡Œåªèƒ½ä¼ è¿›æ¥ä¸€ä¸ªCatå‹çš„æ•°æ®ï¼Œå¦åˆ™æŠ¥é”™ï¼‰ return otherCat.getAge() == this.getAge() &amp;&amp; otherCat.getName() == this.getName(); //å¦‚æœä¸€åªçŒ«çš„å¹´é¾„å’Œåå­—è·Ÿå¦ä¸€åªçŒ«ç›¸ç­‰ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºå®ƒä»¬ç›¸åŒ }} ç°åœ¨å†è¿è¡Œä¸‹ä»£ç å—4ï¼Œç»“æœä¸º1ï¼ŒhashCodeæ–¹æ³•åˆæ˜¯ä»€ä¹ˆï¼ŸhashCodeæ˜¯å¯¹è±¡äº§ç”Ÿåï¼Œå¯¹å…¶åœ°å€çš„hashè®¡ç®—å‡ºæ¥çš„ä¸€ä¸ªå“ˆå¸Œç ï¼Œå“ˆå¸Œç ç›¸åŒçš„å¯¹è±¡ä¸ä¸€å®šæ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯å“ˆå¸Œç ä¸åŒçš„ä¸¤ä¸ªå¯¹è±¡ä¸€å®šä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼ˆå› ä¸ºhashç®—æ³•ä¼šå†²çªï¼Œä¸ç„¶æ•£åˆ—è¡¨ä¹Ÿä¸ä¼šå­˜åœ¨è§£å†³å“ˆå¸Œå†²çªè¿™ç§é—®é¢˜äº†ï¼‰ã€‚","link":"/2020/03/23/LV4-3%EF%BC%9Ajava%E9%87%8C%E7%9A%84Map/"},{"title":"LV4-2ï¼šjavaå¸¸ç”¨çš„é›†åˆç±»ä»¥åŠå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«","text":"é›†åˆç±»ç”¨æ¥ä¿å­˜ä¸€å †å¯¹è±¡æˆ–è€…åŸºæœ¬æ•°æ®ï¼Œä½ å¯èƒ½ä¼šäº§ç”Ÿç–‘é—®ï¼Œæ•°ç»„ä¸ä¹Ÿæ˜¯åšè¿™ä¸ªçš„å—ï¼Ÿä¸ºä»€ä¹ˆè¿˜éœ€è¦æœ‰é›†åˆç±»å‘¢ï¼Ÿæ•°ç»„å’Œé›†åˆç±»çš„åŒºåˆ«åœ¨äºæ•°ç»„éœ€è¦é¢„å…ˆæŒ‡å®šå®¹ç§¯ï¼Œæ¯”å¦‚å£°æ˜ï¼š æ•°ç»„å£°æ˜1int[] a = new int[5]; è¿™é‡Œè¿™ä¸ªaåªèƒ½è£…5ä¸ªæ•°æ®ï¼Œè¶…è¿‡5ä¸ªå°±å¼€å§‹çˆ†ç‚¸ï¼Œé›†åˆç±»å°±è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä½ ä¸éœ€è¦äº‹å…ˆçŸ¥é“å…ƒç´ çš„æ€»ä¸ªæ•°ï¼Œåªéœ€è¦å¾€é‡Œé¢å¡æ•°æ®å°±å¥½ï¼Œåœ¨å®é™…å¼€å‘é‡Œï¼Œå¾ˆå°‘ä¼šé¢„å…ˆçŸ¥é“å…ƒç´ çš„ä¸ªæ•°ï¼Œå› æ­¤é›†åˆç±»ä½œä¸ºå¯ä»¥å®¹çº³ä»»æ„ä¸ªæ•°ä¸ªå…ƒç´ çš„å·¥å…·ç±»ï¼Œåœ¨å¼€å‘é‡Œå°±æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚ ä¸€ã€é›†åˆå®ç°ç±»å…³ç³»å›¾1.1ï¼šé›†åˆå®¶æ—çš„ç±»å…³ç³»å›¾å…ˆæ¥çœ‹ä¸‹é›†åˆç±»çš„ç»§æ‰¿å’Œå®ç°å…³ç³»ï¼š é¡¶ä¸Šçš„æ¥å£å«åšCollectionï¼Œæ´¾ç”Ÿå‡ºä¿©æ¥å£ï¼Œä¸€ä¸ªå«Listï¼Œä¸€ä¸ªå«Setï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹å®ƒä»¬çš„æ–¹æ³•éƒ½æœ‰å“ªäº›ï¼š 1.2ï¼šListçš„å‡ ä¸ªå®ç°ç±»åŠå®ƒä»¬ä¹‹é—´çš„åŒºåˆ« ç±»å åº•å±‚ç»“æ„ æ˜¯å¦çº¿ç¨‹å®‰å…¨ è¯´æ˜ ArrayList æ•°ç»„ å¦ ArrayListåŸºäºæ•°ç»„æ¥å®ç°é›†åˆçš„åŠŸèƒ½ï¼Œå…¶å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªå¯å˜é•¿çš„å¯¹è±¡æ•°ç»„ï¼Œé›†åˆå†…æ‰€æœ‰å¯¹è±¡å­˜å‚¨äºè¿™ä¸ªæ•°ç»„ä¸­ï¼Œå¹¶å®ç°è¯¥æ•°ç»„é•¿åº¦çš„åŠ¨æ€ä¼¸ç¼© LinkedList åŒå‘é“¾è¡¨ å¦ LinkedListåŸºäºé“¾è¡¨æ¥å®ç°é›†åˆçš„åŠŸèƒ½ï¼Œå…¶å®ç°äº†é™æ€ç±»Nodeï¼Œé›†åˆä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½ç”±ä¸€ä¸ªNodeä¿å­˜ï¼Œæ¯ä¸ªNodeéƒ½æ‹¥æœ‰åˆ°è‡ªå·±çš„å‰ä¸€ä¸ªå’Œåä¸€ä¸ªNodeçš„å¼•ç”¨ Vector æ•°ç»„ æ˜¯ çº¿ç¨‹å®‰å…¨ç‰ˆçš„ArrayListï¼ŒåŸºäºæ•°ç»„å®ç°çš„é›†åˆï¼Œå®ƒå¯è‡ªå®šä¹‰æ‰©å®¹å› å­ï¼ˆä½†å®ƒçš„æ–¹æ³•åŸºæœ¬éƒ½æ˜¯åŒæ­¥çš„ï¼Œæ€§èƒ½è¾ƒä½ï¼‰ CopyOnWriteArrayList æ•°ç»„ æ˜¯ ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨ç‰ˆçš„ArrayListï¼Œå®ƒå†™åŠ é”è¯»ä¸åŠ é”ï¼Œå†™çš„æ—¶å€™å¤åˆ¶å½“å‰é›†åˆç”Ÿæˆä¸€ä¸ªå‰¯æœ¬ï¼Œç„¶åç»™å‰¯æœ¬æ·»åŠ å…ƒç´ åä¿®æ”¹å¼•ç”¨å˜é‡æŒ‡å‘ï¼Œå› æ­¤å®ƒè¾ƒå å†…å­˜ï¼Œä½†æ˜¯æ•´ä½“æ€§èƒ½è¦æ¯”Vectoré«˜ è¡¨1 1.2.1ï¼šå¸¸ç”¨ç”¨æ³•åˆé›†çœ‹äº†ç±»ç»§æ‰¿ç»“æ„ï¼Œå¯ä»¥çŸ¥é“ï¼Œè¡¨1é‡Œé‚£ä¹ˆå¤šç±»ï¼Œéƒ½åªæ˜¯Listçš„å®ç°ç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œä»…é€šè¿‡ArrayListæ¥çœ‹ä¸‹Listçš„çš„ç”¨æ³•ï¼š ä»£ç å—11234567891011121314151617181920212223242526272829303132333435363738public static void main(String[] args) { //åˆå§‹åŒ–ä¸€ä¸ªlistå¯¹è±¡ï¼Œé›†åˆç±»æ˜¯æ³›å‹çš„å“¦ List&lt;String&gt; names = new ArrayList&lt;&gt;(); //è¿™å¥ä»£ç å°±åˆå§‹åŒ–äº†ä¸€ä¸ªArrayListçš„å¯¹è±¡ï¼ŒæŒ‡å®šæ³›å‹åªèƒ½å­˜å‚¨Stringç±»å‹çš„æ•°æ® names.add(\"sun1\"); names.add(\"sun2\"); //é€šè¿‡addå¾€é‡Œé¢åŠ æ•°æ®ï¼Œåªè¦ä½ æ„¿æ„ï¼Œå¯ä»¥å¾€é‡Œé¢åŠ nå¤šæ•°æ® names.add(\"sun3\"); List&lt;String&gt; names2 = new ArrayList&lt;&gt;(); //è¿™é‡Œå†æ¥æä¸ªæ–°çš„Listï¼Œå¹¶ç»™å®ƒåŠ ä¿©å€¼ names2.add(\"sun4\"); names2.add(\"sun5\"); names2.add(\"sun5\"); names2.add(\"sun5\"); //Listæ˜¯å…è®¸å…ƒç´ é‡å¤çš„ names.addAll(names2); //é€šè¿‡addAllå°†ä¸Šé¢çš„ListåŠ åˆ°ç¬¬ä¸€ä¸ªListå¯¹è±¡é‡Œ //åˆ é™¤æŸä¸ªå…ƒç´  names.remove(\"sun2\"); names.remove(\"sun5\"); //åˆ é™¤é‡å¤äº†ä¸‰æ¬¡çš„å…ƒç´ ä¸­çš„å…¶ä¸­ä¸€ä¸ª //forå¢å¼ºéå† for (String name : names) { System.out.println(name); } System.out.println(\"-------------------------\"); //java8çš„lambdaéå† names.forEach(name -&gt; { System.out.println(name); }); System.out.println(\"-------------------------\"); System.out.println(names.contains(\"sun2\")); //åˆ©ç”¨containsæ¥åˆ¤æ–­listé‡Œæ˜¯å¦åŒ…å«æŸå…ƒç´  System.out.println(names.contains(\"sun5\")); System.out.println(\"-------------------------\"); List&lt;String&gt; subNames = names.subList(1, 3); //ä»ä¸‹æ ‡1æˆªå–åˆ°ä¸‹æ ‡3çš„å…ƒç´ ï¼ŒåŒºé—´ä¸ºï¼š[1, 3) subNames.forEach(name -&gt; { System.out.println(name); });} ä¸Šé¢ä¾‹å­ä¸­æ¶µç›–äº†Listç³»é›†åˆå®ç°ç±»çš„å¸¸ç”¨æ–¹æ³•ã€‚ âš ï¸ æ³¨æ„ï¼šListæ˜¯æœ‰åºé›†åˆï¼ 1.2.2ï¼šcontainså’Œremoveï¼Œequalsæˆ‘ä»¬ä¸Šé¢è®²äº†removeå’Œcontainsçš„ç”¨æ³•ï¼Œè¿™ä¿©æ–¹æ³•ä¸€çœ‹å°±æ˜¯è¦éå†æŸ¥æ‰¾å¯¹åº”å…ƒç´ ï¼Œé‚£ä¹ˆæ—¢ç„¶æ˜¯è¿™ç§é€»è¾‘ï¼Œä¸€å®šä¼šæœ‰åˆ¤ç­‰é€»è¾‘ï¼šç›´æ¥ç”¨==è¿ç®—ç¬¦æˆ–è€…é€šè¿‡å¯¹è±¡çš„equalsæ–¹æ³•æ¥è¿›è¡Œåˆ¤ç­‰ã€‚ å…ˆæ¥çœ‹çœ‹==å’Œequalsï¼Œ==æˆ‘ä»¬åœ¨ä¹‹å‰è®²è¿‡ï¼Œå¯¹äºåŸºæœ¬ç±»å‹ï¼Œå®ƒç”¨æ¥ç®€å•åˆ¤æ–­å€¼æ˜¯å¦ç›¸åŒï¼Œä½†å¯¹äºå¼•ç”¨å˜é‡ï¼Œå®ƒåˆ™ç”¨æ¥åˆ¤æ–­åœ°å€ï¼š ä»£ç å—212345678910111213141516171819202122232425public static void main(String[] args) { Cat cat1 = new Cat(); cat1.setName(\"åŠ è²\"); cat1.setAge(8); Cat cat2 = new Cat(); cat2.setName(\"åŠ è²\"); cat2.setAge(8); List&lt;Cat&gt; cats = new ArrayList&lt;&gt;(); cats.add(cat1); cats.add(cat2); Cat cat3 = new Cat(); cat3.setName(\"åŠ è²\"); cat3.setAge(8); System.out.println(cats.size()); System.out.println(cats.contains(cat3)); cats.remove(cat3); System.out.println(cats.size());} è¿™ä¸ªç»“æœä¸ºï¼š ä»£ç å—31232false2 å¤§è‡´æ„æ€ä½ åº”è¯¥å·²ç»æ˜ç™½äº†ï¼Œä¹‹å‰ä¹Ÿè¯´è¿‡ï¼Œå¼•ç”¨å˜é‡ç”±äºæŒ‡å‘çš„æ˜¯ä¸€å—å†…å­˜ï¼Œå†…å­˜é‡Œå­˜æ”¾çš„å°±æ˜¯ç±»æ¨¡æ¿äº§ç”Ÿçš„ç±»å¯¹è±¡ï¼Œä¸€ä¸ªå¯¹è±¡é‡Œå³ä¾¿å±æ€§å€¼å®Œå…¨ä¸€è‡´ï¼Œå®ƒä¹Ÿæ˜¯ä¿©å¯¹è±¡ã€‚ é‚£ä¹ˆå¦‚ä½•è®©ä¿©åå­—å«åŠ è²ï¼Œéƒ½æ˜¯8å²çš„çŒ«å˜æˆåŒä¸€åªå‘¢ï¼Ÿè¿˜è®°å¾—Objectè¿™ä¸ªå¤§çˆ¶ç±»å—ï¼Ÿä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåˆ¤æ–­ä¿©å¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œéƒ½æ˜¯é€šè¿‡è¯¥æ–¹æ³•è¿›è¡Œçš„ï¼Œé»˜è®¤è¯¥æ–¹æ³•åˆ¤æ–­çš„æ˜¯ä¿©å¯¹è±¡çš„åœ°å€ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å¯ä»¥é€šè¿‡é‡å†™è¿™ä¸ªequalsæ–¹æ³•çš„æ–¹å¼ï¼Œæ¥é‡æ–°å®šä¹‰ä¿©å¯¹è±¡æ˜¯å¦ç›¸ç­‰è¿™ä¸ªæ¦‚å¿µå‘¢ï¼Ÿæˆ‘ä»¬æ¥é‡å†™ä¸‹Catç±»çš„equalsæ–¹æ³•ï¼š ä»£ç å—41234567891011121314151617public class Cat extends Animal { @Override public void cry() { System.out.println(\"å–µå–µå–µ~\"); } public void catchMice() { //æ‰©å±•æ–¹æ³•ï¼šæ•é¼  System.out.println(\"æˆ‘ä¼šæ‰è€é¼ \"); } @Override public boolean equals(Object obj) { Cat otherCat = (Cat) obj; //å¼ºè½¬ä¸‹ç±»å‹ï¼ˆæ‰€ä»¥è¿™é‡Œåªèƒ½ä¼ è¿›æ¥ä¸€ä¸ªCatå‹çš„æ•°æ®ï¼Œå¦åˆ™æŠ¥é”™ï¼‰ return otherCat.getAge() == this.getAge() &amp;&amp; otherCat.getName() == this.getName(); //å¦‚æœä¸€åªçŒ«çš„å¹´é¾„å’Œåå­—è·Ÿå¦ä¸€åªçŒ«ç›¸ç­‰ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºå®ƒä»¬ç›¸åŒ }} é‡å†™åï¼Œå†è¿è¡Œä¸‹ä»£ç å—2ï¼Œç»“æœä¸ºï¼š ä»£ç å—51232true1 å¯ä»¥çœ‹åˆ°ï¼Œå³ä¾¿ä¼ å…¥çš„å¯¹è±¡æ˜¯cat3ï¼Œä½†ç”±äºé‡å†™äº†equalsæ–¹æ³•ï¼Œä¿©å¯¹è±¡æ˜¯å¦ç›¸ç­‰ä¸å†æ˜¯æ ¹æ®å¯¹è±¡åœ°å€æ¥åˆ¤æ–­äº†ï¼Œè€Œæ˜¯æ ¹æ®å†…éƒ¨çš„å˜é‡å€¼æ˜¯å¦ä¸€è‡´ï¼Œå› ä¸ºcat3è·Ÿé›†åˆå¯¹è±¡é‡Œå­˜æ”¾çš„å…¶ä»–ä¿©å¯¹è±¡ä¸€æ ·ï¼Œå› æ­¤ä¼ å…¥cat3ï¼Œcontainsä¼šè¿”å›trueï¼ŒæŒ‰ç…§cat3æ¥è¿›è¡Œremoveä¹Ÿä¼šæˆåŠŸremoveæ‰é›†åˆé‡Œçš„ä¸€åªåŠ è²çŒ«ã€‚ 1.3ï¼šSetçš„å‡ ä¸ªå®ç°ç±»åŠå®ƒä»¬ä¹‹é—´çš„åŒºåˆ« ç±»å åº•å±‚ç»“æ„ æ˜¯å¦çº¿ç¨‹å®‰å…¨ è¯´æ˜ CopyOnWriteArraySet CopyOnWriteArrayList æ˜¯ å¯ä»¥ç®€å•ç†è§£ä¸ºï¼šçº¿ç¨‹å®‰å…¨çš„æœ‰åºSetã€‚ HashSet HashMap å¦ å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªHashMapç»“æ„ï¼Œå¯å…ˆä¸åšå¯¹è¯¥ç»“æ„çš„äº†è§£ï¼Œç›¸æ¯”Listï¼Œå®ƒä¸å…è®¸æœ‰é‡å¤å…ƒç´ ï¼ˆæ‰€è°“é‡å¤ä¸å¦ï¼Œä¹Ÿæ˜¯æ ¹æ®equalsæ¥çš„ï¼‰ï¼Œä¸”å®ƒæ˜¯æ— é¡ºåºçš„ã€‚ LinkedHashSet HashMap å¦ å†…éƒ¨ç»§æ‰¿HashSetï¼Œä½†å®ƒæ˜¯æœ‰åºçš„ï¼Œä½œä¸ºSetï¼Œå®ƒä»ç„¶ä¸å…è®¸å…ƒç´ é‡å¤ã€‚æ€§èƒ½è¾ƒHashSetå·®ã€‚ TreeSet TreeMap å¦ å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªTreeMapç»“æ„ï¼Œå¯å…ˆä¸åšå¯¹è¯¥ç»“æ„çš„äº†è§£ï¼Œå®ƒæ˜¯æœ‰åºçš„ï¼Œä½œä¸ºSetï¼Œå®ƒä»ç„¶ä¸å…è®¸å…ƒç´ é‡å¤ã€‚æ€§èƒ½è¾ƒHashSetå·®ã€‚ è¡¨2 ä¾‹å­ï¼š ä»£ç å—61234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950public static void main(String[] args) { Set&lt;String&gt; names = new HashSet&lt;&gt;(); Set&lt;String&gt; names2 = new LinkedHashSet&lt;&gt;(); Set&lt;String&gt; names3 = new TreeSet&lt;&gt;(); Set&lt;String&gt; names4 = new CopyOnWriteArraySet&lt;&gt;(); names.add(\"sun1\"); names.add(\"sun2\"); names.add(\"sun3\"); names.add(\"sun2\"); names2.add(\"sun1\"); names2.add(\"sun2\"); names2.add(\"sun3\"); names2.add(\"sun2\"); names3.add(\"sun1\"); names3.add(\"sun2\"); names3.add(\"sun3\"); names3.add(\"sun2\"); names4.add(\"sun1\"); names4.add(\"sun2\"); names4.add(\"sun3\"); names4.add(\"sun2\"); for (String name : names){ System.out.println(name); } System.out.println(\"------------\"); for (String name : names2){ System.out.println(name); } System.out.println(\"------------\"); for (String name : names3){ System.out.println(name); } System.out.println(\"------------\"); for (String name : names4){ System.out.println(name); } System.out.println(\"------------\");} è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š ä»£ç å—712345678910111213141516sun2sun3sun1------------sun1sun2sun3------------sun1sun2sun3------------sun1sun2sun3------------ å¯ä»¥çœ‹åˆ°ï¼ŒSetçš„ç‰¹ç‚¹æ˜¯ä¸èƒ½æœ‰é‡å¤çš„ä¸¤ä¸ªå…ƒç´ ï¼Œå¦åˆ™åªä¿ç•™ä¸€ä¸ªï¼Œå…¶æ¬¡ç›¸æ¯”LinkedHashSetã€TreeSetã€CopyOnWriteArraySetçš„å®ç°ï¼ŒHashSetä¸å…·å¤‡ä¿å­˜å…ƒç´ é¡ºåºçš„ç‰¹æ€§ã€‚ äºŒã€æ ˆ2.1ï¼šæ ˆæ˜¯æ€æ ·çš„ä¸€ç§ç»“æ„ï¼Ÿæ ˆç®€å•æ¥è¯´æ˜¯ä¸€ç§å…ˆè¿›åå‡ºçš„ç»“æ„ï¼š åè¢«åŠ è¿›æ¥çš„å…ƒç´ åœ¨å–çš„æ—¶å€™ä¼˜å…ˆè¢«å–å‡ºå»ã€‚ 2.2ï¼šjavaçš„æ ˆç»“æ„å¦‚å›¾1ï¼Œæ ˆçš„å®ç°æ˜¯åŸºäºVectorè¿›è¡Œçš„ï¼Œå› æ­¤å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬çœ‹çœ‹Stackç±»æ‹“å±•äº†å“ªäº›æ–¹æ³•ï¼š pushå°±æ˜¯å›¾3é‡Œå¾€æ ˆç»“æ„çš„æ ˆé¡¶åŠ å…ƒç´ ï¼Œpopå°±æ˜¯ç”¨æ¥å¼¹å‡ºä½äºæ ˆé¡¶çš„å…ƒç´ ï¼š ä»£ç å—812345678910111213141516public static void main(String[] args) { List&lt;String&gt; stack = new Stack&lt;&gt;(); stack.add(\"sun1\"); stack.add(\"sun2\"); stack.add(\"sun3\"); for (String name : stack) { System.out.println(name); } Stack&lt;String&gt; names = (Stack)stack; System.out.println(\"------------\"); names.push(\"sun4\"); //push/addéƒ½å¯ä»¥ç”¨æ¥ç»™æ ˆæ·»åŠ æ•°æ®ï¼Œæ–°æ·»åŠ çš„æ•°æ®æ€»æ˜¯ä½äºæ ˆé¡¶ System.out.println(names.pop()); //å¼¹å‡ºæ ˆé¡¶æ•°æ® System.out.println(names.size()); //è¾“å‡ºå½“å‰æ•°æ®é‡} ä¸Šè¿°ä»£ç è¾“å‡ºç»“æœï¼š ä»£ç å—9123456sun1sun2sun3------------sun43 å¯ä»¥çœ‹åˆ°ï¼Œä½œä¸ºListçš„ä¸€ä¸ªå®ç°ç±»ï¼Œå®ƒä»ç„¶å¯ä»¥è¢«Listæ¥æ”¶ï¼Œç”¨æ³•è·Ÿæ™®é€šé›†åˆä¸€è‡´ï¼Œä½†æ˜¯åˆ©ç”¨å®ƒä½œä¸ºStackç±»æ‹“å±•çš„æ–¹æ³•æ—¶ï¼Œå®ƒçš„æ ˆå±æ€§å¾—ä»¥ä½“ç°å‡ºæ¥ã€‚ è¿™é‡Œè¯´ä¸‹peekï¼Œpeekæ–¹æ³•ä»…ç”¨æ¥è¿”å›æ ˆé¡¶æ•°æ®ï¼Œå¹¶ä¸å…·å¤‡popé‚£ç§â€œå¼¹å‡ºâ€çš„æ•ˆæœã€‚","link":"/2020/03/23/LV4-2%EF%BC%9Ajava%E5%B8%B8%E7%94%A8%E7%9A%84%E9%9B%86%E5%90%88%E7%B1%BB%E4%BB%A5%E5%8F%8A%E5%AE%83%E4%BB%AC%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB/"},{"title":"LV4-1ï¼šioçš„ä»‹ç»&javaçš„io api","text":"ä¸€ã€I/Oå®¶æ—ä¸‹å›¾ä¸ºjavaè‡ªå¸¦çš„IOæ“ä½œçš„æ•´ä½“å®¶æ—æ ‘çŠ¶å›¾ï¼Œæ•´ä½“åˆ†ä¸ºå­—èŠ‚æµå’Œå­—ç¬¦æµä¸¤å¤§ç±»ï¼Œå®ƒä»¬çš„åŒºåˆ«åœ¨äºï¼š å­—èŠ‚æµæ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½æ¥ä¼ è¾“æ•°æ®ï¼Œå®ƒæŒ‰ç…§è¾“å…¥/è¾“å‡ºæ–¹å‘ä¸åŒåˆ†ä¸ºäº†ä¸¤ä¸ªå¤§çˆ¶ç±»ï¼šInputStreamå’ŒOutputStream å­—ç¬¦æµæ˜¯ä»¥å¤šä¸ªå­—èŠ‚ä¸ºå•ä½æ¥ä¼ è¾“æ•°æ®ï¼Œå®ƒæŒ‰ç…§è¾“å…¥/è¾“å‡ºæ–¹å‘ä¸åŒåˆ†ä¸ºäº†ä¸¤ä¸ªå¤§çˆ¶ç±»ï¼šReaderå’ŒWriter âš ï¸ æ³¨ï¼šæœ¬æ–‡ä»…è®²å­—èŠ‚æµå¸¸ç”¨çš„å‡ ç§è¯»å†™æ•°æ®çš„æ–¹å¼ä»¥åŠå¥½ç”¨çš„nio apiï¼Œå…¶ä½™æƒ³è¦è¯¦ç»†äº†è§£å¯ä»¥ç½‘ä¸ŠæŸ¥é˜…å…·ä½“çš„èµ„æ–™ã€‚ äºŒã€å¦‚ä½•åˆ©ç”¨å­—èŠ‚æµè¯»å†™æ•°æ®ï¼Ÿ2.1ï¼šå†™æˆ‘ä»¬ç°åœ¨å†™ä¸€ä¸ªç¨‹åºï¼Œè®©å®ƒæ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå‘½åä¸ºa.txtï¼Œå¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸å†åˆ›å»ºï¼Œç„¶åé€šè¿‡ç¨‹åºå¾€å®ƒçš„é‡Œé¢å†™å…¥ä¸€å¥è¯ï¼šâ€Javaæ˜¯ä¸–ç•Œä¸Šå å¼æ»´è¯­è¨€ï¼â€œï¼š ä»£ç å—11234567891011121314151617181920public static void main(String[] args) throws IOException { File aFile; //å£°æ˜æ–‡ä»¶ç±»å‹å˜é‡ OutputStream os = null; //å£°æ˜è¾“å‡ºæµç±»å‹å˜é‡ try { aFile = new File(\"/Users/sunqinwen/Documents/a.txt\"); if (!aFile.exists()) { //è‹¥æ–‡ä»¶ä¸å­˜åœ¨ if (!aFile.createNewFile()) { //åˆ©ç”¨createNewFileåˆ›å»ºæ–‡ä»¶ System.out.println(\"åˆ›å»ºæ–‡ä»¶å¤±è´¥ï¼\"); return; } } os = new FileOutputStream(aFile); //å’Œç›®æ ‡æ–‡ä»¶å»ºç«‹èµ·æ•°æ®æµç®¡é“ os.write(\"Javaæ˜¯ä¸–ç•Œä¸Šå å¼æ»´è¯­è¨€ï¼\".getBytes(StandardCharsets.UTF_8)); //ä½¿ç”¨UTF-8çš„ç¼–ç æ–¹å¼ï¼Œå†™å…¥åˆ°aæ–‡ä»¶ System.out.println(\"æ‰§è¡Œå®Œæ¯•ï¼\"); } finally { if (os != null) { os.close(); //ç®¡é“ç”¨å¥½äº†åˆ«å¿˜äº†å…³é—­ } }} 2.2ï¼šè¯»ä¸Šæ–¹è¿è¡Œç»“æœå°±æ˜¯aæ–‡ä»¶è¢«åˆ›å»ºäº†å‡ºæ¥ï¼Œå¹¶ä¸”é¡ºåˆ©å°†é‚£æ®µæ–‡æœ¬å†™äº†è¿›å»ï¼Œç°åœ¨æˆ‘ä»¬å†æ¥å†™ä¸€ä¸ªç¨‹åºï¼ŒæŠŠè¿™ä¸ªæ–‡ä»¶é‡Œçš„ä¿¡æ¯è¯»å…¥åˆ°ç¨‹åºä¸­ï¼Œè¿™æ—¶å°±è¦å€ŸåŠ©æˆ‘ä»¬çš„è¾“å…¥æµInputStreamäº†ï¼š ä»£ç å—21234567891011121314151617181920212223242526public static void main(String[] args) throws IOException { File aFile; //å£°æ˜æ–‡ä»¶ç±»å‹å˜é‡ InputStream is = null; //å£°æ˜è¾“å‡ºæµç±»å‹å˜é‡ try { aFile = new File(\"/Users/sunqinwen/Documents/a.txt\"); if (!aFile.exists()) { //è‹¥æ–‡ä»¶ä¸å­˜åœ¨ System.out.println(\"æ–‡ä»¶ä¸å­˜åœ¨ï¼\"); return; } is = new FileInputStream(aFile); //å’Œç›®æ ‡æ–‡ä»¶å»ºç«‹èµ·æ•°æ®æµç®¡é“ byte[] msg = new byte[1024]; //ä»¥1KBä¸ºå•ä½ï¼Œå°†æ–‡ä»¶é‡Œçš„æ•°æ®è¯»è¿›æ¥ StringBuilder sb = new StringBuilder(); int n; while ((n = is.read(msg)) &gt; 0) { //å½“readè¿”å›-1ï¼Œè¯´æ˜æ–‡ä»¶é‡Œçš„å†…å®¹å·²è¢«è¯»å®Œï¼Œé‚£ä¹ˆå¾ªç¯ç»ˆæ­¢ï¼Œå¦åˆ™è¿”å›çš„å°±æ˜¯æœ¬æ¬¡è¯»è¿›æ¥çš„å­—èŠ‚æ•° //ä¸€æ—¦è¿›å…¥è¿™é‡Œï¼Œmsgé‡Œçš„å­—èŠ‚ä¿¡æ¯å°±å·²ç»è¢«æ›´æ–°äº†ï¼Œè€Œä¸”æ˜¯æŒ‰ç…§1KBçš„å¤§å°è¯»å…¥çš„ sb.append(new String(msg, 0, n, StandardCharsets.UTF_8)); //æ¯æ¬¡æŠŠè¯»è¿›æ¥çš„å­—èŠ‚ç´¯åŠ åˆ°ç»“æœå­—ç¬¦ä¸²é‡Œ } System.out.println(sb); //ç›´æ¥æŠŠç»“æœè¾“å‡º } catch (IOException e) { //IOæ“ä½œéœ€è¦æ•è·å¤„ç†IOå¼‚å¸¸ e.printStackTrace(); } finally { if (is != null) { is.close(); //ç®¡é“ç”¨å¥½äº†åˆ«å¿˜äº†å…³é—­ } }} é€šè¿‡ä¸Šé¢çš„æ–¹å¼ï¼Œåˆ©ç”¨FileInputStreamï¼Œå¯ä»¥å°†æ–‡ä»¶é‡Œçš„ä¿¡æ¯è¯»å‡ºæ¥ã€‚ å¯¹äºæ–‡ä»¶è¯»å†™ã€åˆ›å»ºï¼Œç†è®ºä¸ŠæŒæ¡ä¸€ç§æ–¹å¼å°±å¯ä»¥ï¼Œä½†æ˜¯ä½ ä¼šå‘ç°ä¸Šé¢çš„å†™æ³•çœŸçš„å¾ˆå•°å—¦ï¼Œjavaæœ‰æ²¡æœ‰æ›´å¥½çš„è¯»å†™æ–‡ä»¶çš„æ–¹æ³•å‘¢ï¼Ÿæ¥çœ‹ä¸‹ä¸€èŠ‚ã€‚ ä¸‰ã€åˆ©ç”¨JAVA NIO APIåˆ›å»º&amp;è¯»å†™æ–‡ä»¶ä¸çŸ¥é“ä½ å‘ç°äº†æ²¡ï¼ŒMacç³»ç»Ÿçš„æ–‡ä»¶è·¯å¾„æ˜¯æ­£æ–œæ åˆ’åˆ†ï¼Œè€ŒWindowsç³»ç»Ÿå´æ˜¯åæ–œæ ï¼Œè¿™å°±æ„å‘³ç€ä½ ä¸Šé¢çš„ä»£ç å¯¹äºæ–‡ä»¶è·¯å¾„è¿™ä¸€å—åœ¨åŒç³»ç»Ÿä¸‹æ˜¯ä¸å…¼å®¹çš„ï¼Œè€Œä¸”ä¸Šé¢çš„ä»£ç å¾ˆç¹çï¼Œäºæ˜¯Javaæä¾›äº†æ›´å¥½ç”¨çš„NIO APIï¼Œè®©æˆ‘ä»¬æ¥æ”¹é€ ä¸‹ä¸Šé¢çš„ä»£ç ã€‚ 3.1ï¼šå†™å°†â€Javaæ˜¯ä¸–ç•Œä¸Šå å¼æ»´è¯­è¨€ï¼â€œå†™å…¥åŒè·¯å¾„çš„b.txtæ–‡ä»¶ï¼š ä»£ç å—312345678public static void main(String[] args) throws IOException { Path path = Paths.get(\"/Users\", \"sunqinwen\", \"Documents\", \"b.txt\"); if (!Files.exists(path)) { //è‹¥æ–‡ä»¶ä¸å­˜åœ¨ Files.createFile(path); //åˆ›å»ºæ–‡ä»¶ } Files.write(path, \"Javaæ˜¯ä¸–ç•Œä¸Šå å¼æ»´è¯­è¨€ï¼\".getBytes(StandardCharsets.UTF_8)); System.out.println(\"æ‰§è¡Œå®Œæ¯•ï¼\");} è¿™é‡Œç”¨Pathæ¥ç»„è£…è·¯å¾„ï¼Œåˆ©ç”¨Pathç»„è£…åçš„è·¯å¾„ä¼šæ™ºèƒ½è½¬æˆç¬¦åˆå½“å‰æ“ä½œç³»ç»Ÿçš„è·¯å¾„æ¨¡å¼ã€‚ç„¶ååˆ©ç”¨Fileså®Œæˆæ–‡ä»¶çš„åˆ›å»ºå’Œå†™å…¥ã€‚ 3.2ï¼šè¯»ç°åœ¨å°†è¿™å¥è¯ä»æ–‡ä»¶é‡Œè¯»å‡ºæ¥ï¼Œç›¸æ¯”2.2ï¼ŒçœŸçš„ç®€åŒ–äº†å¥½å¤šï¼š ä»£ç å—41234public static void main(String[] args) throws IOException { Path path = Paths.get(\"/Users\", \"sunqinwen\", \"Documents\", \"b.txt\"); System.out.println(Files.readString(path, StandardCharsets.UTF_8));} åŒæ ·åˆ©ç”¨Pathç»„è£…è·¯å¾„ï¼Œç„¶ååˆ©ç”¨Filesè¯»å–æ•°æ®ã€‚ Filesè¯»å–æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è¯¦ç»†æ¢ç´¢ä¸‹ï¼Œå®ƒæ˜¯å¾ˆæœ‰ç”¨çš„ä¸€ä¸ªå·¥å…·ç±»ï¼š","link":"/2020/03/20/LV4-1%EF%BC%9Aio%E7%9A%84%E4%BB%8B%E7%BB%8D&java%E7%9A%84io%20api/"},{"title":"LV3-4ï¼šåå°„[è½¬è½½]","text":"Java åå°„æœºåˆ¶åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•å’Œå±æ€§ã€‚è¿™ç§ åŠ¨æ€çš„è·å–ä¿¡æ¯ ä»¥åŠ åŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³• çš„åŠŸèƒ½ç§°ä¸º java çš„åå°„æœºåˆ¶ã€‚ æ–¹æ³•å¤§å…¨ï¼šhttps://zhuanlan.zhihu.com/p/27331449 ç”¨æ³•è¯·å‚è€ƒï¼šhttps://juejin.im/post/598ea9116fb9a03c335a99a4 å¦‚ä½•è·å–åˆ°æ–¹æ³•ä¸Šçš„æ³¨è§£ä¿¡æ¯ï¼Ÿ ä»£ç å—112Method method = teacherClass.getDeclaredMethod(\"method\"); //æ‹¿åˆ°Classå…·ä½“çš„åå«â€œmethodâ€çš„Methodå¯¹è±¡NeedPrint needPrint = method.getAnnotation(NeedPrint.class); //å°è¯•è·å–è¯¥æ–¹æ³•ä¸Šçš„NeedPrintæ³¨è§£","link":"/2020/03/17/LV3-4%EF%BC%9A%E5%8F%8D%E5%B0%84/"},{"title":"LV3-3ï¼šObject&æ³›å‹","text":"æ³›å‹ï¼Œå³â€œå‚æ•°åŒ–ç±»å‹â€ã€‚ä¸€æåˆ°å‚æ•°ï¼Œæœ€ç†Ÿæ‚‰çš„å°±æ˜¯å®šä¹‰æ–¹æ³•æ—¶æœ‰å½¢å‚ï¼ˆæ–¹æ³•å®šä¹‰é‡Œæ‹¬å·é‡Œçš„å‚æ•°å£°æ˜ï¼‰ï¼Œç„¶åè°ƒç”¨æ­¤æ–¹æ³•æ—¶ä¼ é€’å®å‚ï¼ˆå®é™…ä¼ ç»™æ–¹æ³•çš„å‚æ•°ï¼‰ã€‚é‚£ä¹ˆå‚æ•°åŒ–ç±»å‹æ€ä¹ˆç†è§£å‘¢ï¼Ÿé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°†ç±»å‹å‚æ•°åŒ–ï¼Œç±»ä¼¼äºæ–¹æ³•ä¸­çš„å˜é‡å‚æ•°ï¼Œæ­¤æ—¶ç±»å‹ä¹Ÿå®šä¹‰æˆå‚æ•°å½¢å¼ï¼ˆå¯ä»¥ç§°ä¹‹ä¸ºç±»å‹å½¢å‚ï¼‰ï¼Œç„¶ååœ¨ä½¿ç”¨/è°ƒç”¨æ—¶ä¼ å…¥å…·ä½“çš„ç±»å‹ï¼ˆç±»å‹å®å‚ï¼‰ã€‚æ³›å‹çš„æœ¬è´¨æ˜¯ä¸ºäº†å‚æ•°åŒ–ç±»å‹ï¼ˆåœ¨ä¸åˆ›å»ºæ–°çš„ç±»å‹çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡æ³›å‹æŒ‡å®šçš„ä¸åŒç±»å‹æ¥æ§åˆ¶å½¢å‚å…·ä½“é™åˆ¶çš„ç±»å‹ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨æ³›å‹ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæ“ä½œçš„æ•°æ®ç±»å‹è¢«æŒ‡å®šä¸ºä¸€ä¸ªå‚æ•°ï¼Œè¿™ç§å‚æ•°ç±»å‹å¯ä»¥ç”¨åœ¨ç±»ã€æ¥å£å’Œæ–¹æ³•ä¸­ï¼Œåˆ†åˆ«è¢«ç§°ä¸ºæ³›å‹ç±»ã€æ³›å‹æ¥å£ã€æ³›å‹æ–¹æ³•ã€‚ ä¸€ã€ä¸€ä¸ªä¾‹å­1.1ï¼šä½¿ç”¨Objectå®ç°å‡è®¾ç°åœ¨è®©æˆ‘ä»¬å¼€å‘ä¸€ä¸ªç”¨äºåœ¨åº”ç”¨ä¸­ä¼ é€’å¯¹è±¡çš„å®¹å™¨ã€‚ä½†å¯¹è±¡ç±»å‹å¹¶ä¸æ€»æ˜¯ç›¸åŒã€‚å› æ­¤ï¼Œéœ€è¦å¼€å‘ä¸€ä¸ªèƒ½å¤Ÿå­˜å‚¨å„ç§ç±»å‹å¯¹è±¡çš„å®¹å™¨ã€‚ä¸‹é¢æ¥è¯•ç€å¼€å‘ä¸€ä¸‹ï¼š å‰é¢çš„ç« èŠ‚æˆ‘ä»¬æåˆ°è¿‡ï¼ŒObjectæ˜¯æ‰€æœ‰ç±»çš„çˆ¶ç±»ï¼Œé‚£ä¹ˆæ„å‘³ç€å¯ä»¥ç”¨Objectç±»å‹çš„å‚æ•°å˜é‡æ¥æ¥æ”¶ä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼š ä»£ç å—1123456789101112public class ObjectContainer { private Object obj; public void setObj(Object obj) { //åªè¦ä½ å–œæ¬¢ï¼Œä½ å¯ä»¥æ”¾ä»»ä½•ç±»çš„å¯¹è±¡è¿›æ¥ this.obj = obj; } public Object getObj(){ //é€šè¿‡æ­¤æ–¹æ³•è·å–åˆ°å½“å‰å®¹å™¨å†…çš„å¯¹è±¡ return obj; }} æˆ‘ä»¬æ¥æµ‹è¯•ä¸‹çœ‹çœ‹ï¼š ä»£ç å—21234567public static void main(String[] args){ ObjectContainer container = new ObjectContainer(); //å…ˆæŠŠå®¹å™¨å¯¹è±¡åˆ›å»ºå‡ºæ¥ container.setObj(new Cat()); //å­˜ Cat cat = (Cat) container.getObj(); //å–ï¼Œä¹‹å‰è®²è¿‡ï¼Œå°ç±»å‹æ¥å¤§ç±»å‹éœ€è¦å¼ºè½¬ } è¿™æ®µä»£ç æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ï¼Œç°åœ¨è®©æˆ‘ä»¬æ”¹ä¸‹ä»£ç ï¼š ä»£ç å—31234567public static void main(String[] args){ ObjectContainer container = new ObjectContainer(); //å…ˆæŠŠå®¹å™¨å¯¹è±¡åˆ›å»ºå‡ºæ¥ container.setObj(new Cat()); //å­˜ Dog dog = (Dog) container.getObj(); //å–ï¼Œè¿™é‡Œå¼ºè½¬æˆDogå‹ } è¿™æ®µä»£ç åœ¨ç¼–è¯‘é˜¶æ®µä¸ä¼šæœ‰ä»»ä½•æŠ¥é”™ï¼Œä½†æ˜¯åœ¨è¿è¡Œæ—¶ï¼Œå°±ä¼šæŠ¥ç±»å‹è½¬æ¢é”™è¯¯ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬è®¾è®¡çš„è¿™ä¸ªå¯¹è±¡å®¹å™¨å°±é¢ä¸´ç€è¿™ç§é—®é¢˜ï¼Œå®ƒç¡®å®å¯ä»¥æ¥æ”¶å¹¶å‚¨è—ä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼Œä½†æ˜¯å¯¹äºä½¿ç”¨æ–¹æ¥è¯´ï¼Œä»–å¹¶ä¸çŸ¥é“ä½ è¿™é‡Œé¢å­˜çš„åˆ°åº•æ˜¯ä»€ä¹ˆç±»å‹ï¼ŒåªçŸ¥é“å®ƒæ˜¯ä¸ªObjectï¼Œä½¿ç”¨æ–¹åœ¨å¼ºè½¬æ—¶ä¹Ÿä¸ä¼šæœ‰ä»»ä½•æç¤ºè¯´å­˜åœ¨ç±»å‹è½¬æ¢é”™è¯¯çš„é£é™©ï¼Œè¿™æ ·ç¨€é‡Œç³Šæ¶‚ä¸Šäº†çº¿ï¼Œå°±ä¼šåœ¨è¿è¡ŒæœŸåŠ å¤§æŠ¥é”™çš„é£é™©ã€‚ 1.2ï¼šåˆ©ç”¨æ³›å‹æ”¹é€ æˆ‘ä»¬ç°åœ¨åˆ©ç”¨æ³›å‹æ”¹é€ ä¸‹ä»£ç ï¼š ä»£ç å—4123456789101112public class ObjectContainer&lt;T&gt; { //å°–æ‹¬å·å†…çš„å­—æ¯å°±æ˜¯ç±»å‹å£°æ˜ private T obj; //ç±»é‡Œå·²ç»å£°æ˜äº†çš„ç±»å‹ï¼Œåœ¨è¿™é‡Œå¯ä»¥ç›´æ¥æ›¿ä»£Object public void setObj(T obj) { //ç°åœ¨åªèƒ½æ¥æ”¶è¢«å£°æ˜çš„ç±»å‹ this.obj = obj; } public T getObj() { //é€šè¿‡æ­¤æ–¹æ³•è·å–åˆ°å½“å‰å®¹å™¨å†…çš„å¯¹è±¡ï¼Œè¿”å›çš„å˜æˆäº†è¢«å£°æ˜çš„ç±»å‹ return obj; }} ä¸Šé¢çš„æ³›å‹å£°æ˜æ”¾åˆ°äº†ç±»ä¸Šé¢ï¼Œè¿™ä¸ªç±»è¢«ç§°ä¸ºæ³›å‹ç±»ï¼Œç°åœ¨æ¥æµ‹è¯•ä»£ç å°±å¯ä»¥åœ¨å®ä¾‹åŒ–å®¹å™¨å¯¹è±¡çš„åŒæ—¶å£°æ˜å®¹å™¨å†…å­˜å‚¨çš„ç±»å‹äº†ï¼š å¯ä»¥çœ‹åˆ°ï¼Œæ³›å‹ç±»åœ¨å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®šå£°æ˜çš„å…·ä½“ç±»å‹ï¼Œè¢«æŒ‡å®šåï¼Œæ„å‘³ç€è¯¥å®¹å™¨å­˜æ”¾çš„å¯¹è±¡ç±»å‹å¿…é¡»æ˜¯Catæˆ–è€…å…¶å­ç±»å‹çš„å¯¹è±¡ï¼Œå› ä¸ºæœ‰äº†è¿™ä¸ªç‰¹æ€§ï¼Œä¸‹é¢getObjæ–¹æ³•è¿”å›çš„æ˜¯Catç±»å‹ç°åœ¨ä¹Ÿæ˜¯å·²çŸ¥çš„ï¼Œå› æ­¤å¼ºè½¬æˆDogä¼šåœ¨ç¼–è¯‘æœŸå°±æŠ¥é”™ï¼ŒIDEçš„è¯­æ³•æ£€æŸ¥ä¹Ÿè¿‡ä¸äº†ã€‚ æ³›å‹çš„å¥½å¤„å°±åœ¨äºè¿™é‡Œï¼Œå®ƒå¯ä»¥è§¦å‘æ›´åŠ ä¸¥è°¨çš„è¯­æ³•æ£€æŸ¥ï¼Œè®©ç¨‹åºå‘˜ç¼–å†™çš„ç±»ä¼¼å®¹å™¨çš„ä»£ç åœ¨å…è®¸æ¥æ”¶ä»»ä½•ç±»å‹å¯¹è±¡çš„åŒæ—¶ä¸å®¹æ˜“å‘ç”Ÿç±»å‹è½¬æ¢é”™è¯¯ã€‚ äºŒã€æ³›å‹çš„åˆ†ç±»2.1ï¼šæ³›å‹ç±»å³å£°æ˜åœ¨ç±»ä¸Šçš„æ³›å‹ï¼Œä¸Šé¢çš„ä¾‹å­å°±æ˜¯ï¼Œæˆ‘ä»¬åœ¨ç±»ååé¢åŠ ä¸Šæ³›å‹å£°æ˜ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å°±æ˜¯ä¸€ä¸ªæ³›å‹ç±»ï¼Œæ—¢ç„¶æ³›å‹æ˜¯ä¸€ç§ç±»ä¼¼æ–¹æ³•é‡Œå½¢å‚çš„ä¸€ç§å£°æ˜æ€§çš„ä¸œè¥¿ï¼Œé‚£ä¹ˆå®ƒå°±åº”è¯¥æ”¯æŒå£°æ˜å¤šä¸ªï¼š ä»£ç å—51234567891011121314151617181920212223242526272829303132public class ObjectContainer&lt;X, Y, Z&gt; { //è¯¥æ³›å‹ç±»å£°æ˜äº†ä¸‰ä¸ªç±»å‹ï¼ˆè¿™ä¸ªç±»ä¼¼æ–¹æ³•çš„å½¢å‚ï¼Œç†è®ºä¸Šå¯ä»¥æ— é™å£°æ˜ï¼‰ private X x; //Xç±»å‹çš„å¯¹è±¡ private Y y; //Yç±»å‹çš„å¯¹è±¡ private Z z; //Zç±»å‹çš„å¯¹è±¡ public void setX(X x) { //ç°åœ¨è¯¥æ–¹æ³•åªèƒ½æ¥æ”¶Xçš„ç±»å‹çš„å¯¹è±¡ this.x = x; } public X getX() { //é€šè¿‡æ­¤æ–¹æ³•åªèƒ½è·å–Xç±»å‹çš„å¯¹è±¡ return x; } public void setY(Y y) { //ç°åœ¨è¯¥æ–¹æ³•åªèƒ½æ¥æ”¶Yçš„ç±»å‹çš„å¯¹è±¡ this.y = y; } public Y getY() { //é€šè¿‡æ­¤æ–¹æ³•åªèƒ½è·å–Yç±»å‹çš„å¯¹è±¡ return y; } public void setZ(Z z) { //ç°åœ¨è¯¥æ–¹æ³•åªèƒ½æ¥æ”¶Zçš„ç±»å‹çš„å¯¹è±¡ this.z = z; } public Z getZ() { //é€šè¿‡æ­¤æ–¹æ³•åªèƒ½è·å–Zç±»å‹çš„å¯¹è±¡ return z; }} è¿™æ˜¯ä¸€ä¸ªå£°æ˜äº†ä¸‰ç§ç±»å‹çš„æ³›å‹ç±»ã€‚ ä½ ä¹Ÿå¯ä»¥æ§åˆ¶æ³›å‹çš„å–å€¼èŒƒå›´ï¼Œæ¯”å¦‚ä½ å¸Œæœ›æ‰€æœ‰çš„Xç±»å‹å¿…é¡»æ˜¯Animalçš„å­ç±»ï¼Œä½ å°±å¯ä»¥æŠŠå£°æ˜æ”¹æˆè¿™æ ·ï¼š ä»£ç å—61public class ObjectContainer&lt;X extends Animal, Y, Z&gt; //è¿™æ ·ä½ ä¼ å…¥Xå¯¹åº”çš„ç±»å‹å°±å¿…é¡»æ˜¯Animalæˆ–è€…å®ƒçš„å­ç±»ä»¬ï¼ˆå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸å¯ä»¥é€šè¿‡implementså…³é”®è¯é™å®šæ¥å£ï¼‰ 2.2ï¼šæ³›å‹æ–¹æ³•æ³›å‹é™¤äº†å¯ä»¥å£°æ˜åœ¨ç±»çš„å¼€å¤´ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥æ”¾åˆ°æ–¹æ³•çš„å£°æ˜å½“ä¸­å»ï¼š ä»£ç å—71234public &lt;K, V&gt; V getValue(K k) { //å£°æ˜è¯¥æ–¹æ³•æœ‰ä¿©æ³›å‹å˜é‡ï¼ŒKå’ŒV V value = (V) mc.getValue(k); return value;} æ­¤å¤–ï¼Œéœ€è¦æ³¨æ„ï¼Œæ–¹æ³•ä¸Šå£°æ˜çš„æ³›å‹ï¼Œå³ä¾¿å‘½åå’Œç±»é‡Œå£°æ˜çš„ä¸€è‡´ï¼Œå®ƒä»¬æ‰€ä»£è¡¨çš„çš„å«ä¹‰ä¹Ÿå®Œå…¨ä¸ä¸€æ ·ï¼š è·Ÿæ™®é€šçš„å£°æ˜ä¸€æ ·ï¼Œå£°æ˜ä½ç½®ä¸åŒï¼Œä½œç”¨åŸŸä¹Ÿä¸åŒã€‚æ–¹æ³•é‡Œå£°æ˜çš„æ³›å‹è·Ÿç±»é‡Œä¸€æ ·ï¼Œä¹Ÿå¯ä»¥é€šè¿‡extendså…³é”®è¯æ¥çº¦æŸæ¥æ”¶å¯¹è±¡çš„èŒƒå›´ã€‚ è®©æˆ‘ä»¬æ¥åŠ æ·±ä¸€ä¸‹æ–¹æ³•æ³›å‹çš„ç†è§£ï¼Œé‡æ–°å®šä¹‰ä¸€ä¸‹ä¸Šé¢çš„ç±»ï¼š ä»£ç å—81234567891011121314151617public class ObjectContainer2&lt;K, V&gt; { //è¿™é‡Œå£°æ˜çš„Kï¼ŒVæ˜¯ç±»å…¨å±€çš„ï¼Œè·Ÿæ–¹æ³•é‡Œçš„ä¸ä¸€æ · private K k; private V v; private Mc mc = new Mc(); //è¾…åŠ©ç±»ï¼Œå…ˆåˆ«å…³æ³¨ public &lt;K, V&gt; V getValue(K k) { //è¿™é‡Œå£°æ˜çš„KVæ˜¯æ–¹æ³•è‡ªå·±çš„ return getValue2(k); } public &lt;K, V&gt; V getValue2(K k) { //è¿™é‡Œå£°æ˜çš„KVæ˜¯æ–¹æ³•è‡ªå·±çš„ V value = (V) mc.getValue(k); return value; } } ç„¶åå†™ä¸ªæµ‹è¯•ç±»ï¼š ä»£ç å—912345678public static void main(String[] args) { ObjectContainer2&lt;Cat, Dog&gt; catDogObjectContainer2 = new ObjectContainer2&lt;&gt;(); String key = \"myKey\"; Cat cat = catDogObjectContainer2.getValue(key); } è¿™ä¸ªè¿‡ç¨‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿæ¥çœ‹ä¸‹åˆ†æå›¾ï¼š 2.3ï¼šæ³›å‹æ¥å£å³åœ¨æ¥å£é‡ŒåŠ ä¸Šæ³›å‹å£°æ˜ï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨å®šä¹‰ä¸€ä¸ªæ³›å‹æ¥å£ï¼Œå¦‚ä¸‹ï¼š ä»£ç å—10123456789public interface DataOp&lt;ID, DATA&gt; { //å£°æ˜ä¸€ä¸ªæ³›å‹ç±»å‹ï¼ŒIDè¡¨ç¤ºçš„æ˜¯æ•°æ®IDçš„ç±»å‹ï¼ŒDATAè¡¨ç¤ºçš„æ˜¯æ•°æ®ç±»å‹ boolean save(DATA data); //å­˜å‚¨æ•°æ® boolean del(ID id); //æ ¹æ®idåˆ é™¤æ•°æ® DATA selectById(ID id); //æ ¹æ®idæŸ¥è¯¢æ•°æ® } ç„¶åæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ä¸åŒçš„å®ç°ç±»æ¥å®šä¹‰æ³›å‹å…·ä½“çš„ç±»å‹ï¼š ä»£ç å—111234567891011121314151617public class CatDataOp implements DataOp&lt;Integer, Cat&gt; { //æŒ‡å®šè¿™ä¸ªå®ç°ç±»æ˜¯é’ˆå¯¹idä¸ºIntegerç±»å‹ä¸”æ•°æ®ä¸ºCatç±»å‹çš„æ•°æ®æ“ä½œå®ç° @Override public boolean save(Cat cat) { // å®ç°æ–¹æ³•è¿™é‡Œå¿…é¡»æ˜¯æŒ‡å®šç±»å‹ //ä¸šåŠ¡ä»£ç  return false; //å¤„ç†ç»“æœ } @Override public boolean del(Integer integer) { return false; } @Override public Cat selectById(Integer integer) { return null; }} å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä¸æŒ‡å®šæ³›å‹ï¼Œç»§ç»­è®©å…¶å®ç°ç±»ä¹Ÿæ˜¯ä¸ªæ³›å‹ç±»ï¼š ä»£ç å—1212345678910111213141516public class DataOpImpl&lt;ID, DATA&gt; implements DataOp&lt;ID, DATA&gt; { @Override public boolean save(DATA data) { return false; } @Override public boolean del(ID id) { return false; } @Override public DATA selectById(ID id) { return null; }} ç„¶åå†™ä¸€ä¸ªå­ç±»ç»§æ‰¿è¯¥ç±»æ—¶å†æŒ‡å®šå…·ä½“ç±»å‹ä¹Ÿå¯ä»¥ï¼š ä»£ç å—131234567public class DogDataOp extends DataOpImpl&lt;Integer, Dog&gt; { @Override public boolean save(Dog dog) { //é‡å†™çˆ¶ç±»æ–¹æ³•æ—¶ï¼Œç”±äºè¯¥å­ç±»æŒ‡å®šäº†å…·ä½“ç±»å‹ï¼Œæ‰€ä»¥è¿™é‡Œå‚æ•°å°±å˜æˆå…·ä½“çš„ç±»å‹äº† return super.save(dog); }} 2.4ï¼šé€šé…ç¬¦æ³›å‹è·Ÿå‰é¢çš„æœ‰å…³ç³»ï¼Œä½†ä¸å¤ªå¤§ï¼Œæˆ‘ä»¬æ¥é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è¯´ä¸‹ä»€ä¹ˆæ˜¯é€šé…ç¬¦æ³›å‹ã€‚ é¦–å…ˆå®šä¹‰ä¸€ä¸ªâ€çªâ€œç±»ï¼Œæ¯ä¸ªçªç››æ”¾ä¸€ä¸ªåŠ¨ç‰©ï¼š ä»£ç å—141234567891011121314//çªï¼Œå¯ä»¥å®¹çº³ä¸€ç§åŠ¨ç‰©ï¼Œåˆ©ç”¨æ³›å‹è§„èŒƒè‡ªå·±æ‰€æ¥æ”¶çš„å¯¹è±¡public class Den&lt;T extends Animal&gt; { private T animal; public void setAnimal(T animal) { this.animal = animal; } public T getAnimal() { return animal; } } ç„¶åæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåŠ¨ç‰©å›­ç±»ï¼ŒåŠ¨ç‰©å›­å¯ä»¥å®¹çº³å¤šä¸ªçªï¼š ä»£ç å—151234567891011121314151617181920public class Zoo { private Den[] dens = new Den[10]; private int i = 0; public void setDen(Den&lt;Animal&gt; animal) { //æ¥æ”¶Denå¯¹è±¡ï¼Œæ³›å‹å°±ç”¨åŠ¨ç‰©ä»¬çš„çˆ¶ç±»Animalèµ‹å€¼å¥½äº†~ this.dens[i++] = animal; } public void forEachAllDensAnimalCry() { //æ‰“å°å‡ºæ¥åŠ¨ç‰©å›­å†…æ¯ä¸ªçªé‡ŒåŠ¨ç‰©çš„å«å£° for (Den den : dens) { if (den != null) { Animal animal = den.getAnimal(); animal.cry(); } } } } æˆ‘ä»¬è®¾æƒ³çš„æ˜¯ï¼Œæ–°å»ºå¥½çš„å­˜æ”¾ç€æŸç§åŠ¨ç‰©çš„çªï¼Œé€šè¿‡setDenå»ºåˆ°åŠ¨ç‰©å›­é‡Œï¼Œæˆ‘ä»¬æœŸå¾…ç€setDenå¯ä»¥æ¥æ”¶Den&lt;Cat&gt;å’ŒDen&lt;Dog&gt;ç­‰æ³›å‹ç±»å¯¹è±¡ï¼Œä½†æ˜¯ï¼š å¯ä»¥çœ‹åˆ°ï¼ŒDen&lt;Cat&gt;å’ŒDen&lt;Dog&gt;æ— æ³•è¢«Den&lt;Animal&gt;æ‰€æ¥æ”¶ï¼Œè¿™å¹¶ä¸æ˜¯javaçš„å¤šæ€å‡ºäº†é—®é¢˜ï¼Œè€Œæ˜¯è¿™ç§æ³›å‹ç±»é‡Œçš„æ³›å‹ç±»å‹ï¼Œæ ¹æœ¬å°±æ²¡æœ‰ä»»ä½•ç±»çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å‰é¢è¯´è¿‡ï¼Œå®ƒä»¬ä»…ä»…æ˜¯ç±»ä¼¼äºæ–¹æ³•å£°æ˜é‡Œçš„å½¢å‚ä¸€æ ·çš„å‚æ•°ï¼Œåœ¨ç¼–è¯‘å™¨çœ¼é‡Œï¼ŒDen&lt;Cat&gt;ã€Den&lt;Dog&gt;ã€Den&lt;Animal&gt;æ˜¯ä¸‰ä¸ªä¸åŒçš„ç±»å®šä¹‰ï¼Œå®ƒä»¬ä¸‰ä¸ªä¸€ä¸ªé‡Œé¢æ”¾çš„æ˜¯Catå¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯Dogå¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯Animalå¯¹è±¡ï¼Œè¿™åˆæ€ä¹ˆå¯ä»¥ç§°ä¹‹ä¸ºä¸€ç§ç±»å®šä¹‰å‘¢ï¼Ÿ æˆ‘ä»¬å†æ¥æ”¹é€ ä¸‹setDenæ–¹æ³•ï¼š ä»£ç å—16123public void setDen(Den&lt;?&gt; animal) { this.dens[i++] = animal;} æ³›å‹ç±»ä½œä¸ºå‚æ•°æ¥æ”¶æ—¶ï¼Œå®šä¹‰&lt;?&gt;é€šé…ç¬¦å¯ä»¥è¡¨ç¤ºï¼Œä½ å¯ä»¥ä¼ å…¥ä»»æ„Denæ³›å‹å¯¹è±¡ï¼Œè¿™ä¸ªæ—¶å€™å†æ¬¡æŒ‰ç…§å›¾4é‡Œçš„ä¼ å‚æ–¹å¼ï¼ŒDen&lt;Cat&gt;å’ŒDen&lt;Dog&gt;å°±éƒ½å¯ä»¥è¢«æ¥æ”¶äº†ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬è¯´äº†ï¼Œ&lt;?&gt;æ„å‘³ç€ä½ å¯ä»¥ä¼ ä»»æ„ç¬¦åˆDenæ³›å‹çš„å¯¹è±¡ï¼Œå¦‚æœæˆ‘æƒ³è¦æä¸€ä¸ªåªæ¥æ”¶çŒ«æ—ç‰¹æƒçš„æ–¹æ³•ï¼Œè¯¥æ€ä¹ˆå®šä¹‰å‘¢ï¼Ÿå¦‚ä¸‹ï¼š ä»£ç å—17123public void setCatDen(Den&lt;? extends Cat&gt; cat) { //é€šé…ç¬¦ä»ç„¶å¯ä»¥æ§åˆ¶æ¥æ”¶æ³›å‹ç±»å‚æ•°çš„èŒƒå›´ï¼Œä½†ç›¸æ¯”DenåŸç±»ï¼ŒèŒƒå›´åªèƒ½ç¼©å° this.dens[i++] = cat;} çœ‹åˆ°äº†å—ï¼Ÿå°±ç®—æ˜¯&lt;?&gt;é€šé…ç¬¦ï¼Œä½ ä»ç„¶å¯ä»¥å®šåˆ¶å®ƒçš„æ¥æ”¶èŒƒå›´ï¼Œå½“ç„¶ï¼Œè¿™ä¸ªèŒƒå›´è‚¯å®šä¸å¯ä»¥æ¯”Denæœ¬èº«å¤§ï¼Œä¾‹å¦‚ä¾‹å­é‡Œçš„Den&lt;? extends Cat&gt;ï¼Œå®ƒç¡®å®åªèƒ½æ¥æ”¶CatåŠå…¶å­ç±»çš„çŒ«çªï¼Œä½†æ˜¯å®ƒä¹Ÿç¬¦åˆDenå®šä¹‰çš„Den&lt;T extends Animal&gt;è¿™ä¸ªè§„åˆ™ã€‚","link":"/2020/03/17/LV3-3%EF%BC%9AObject&%E6%B3%9B%E5%9E%8B/"},{"title":"LV3-2ï¼šå†…éƒ¨ç±»","text":"ä½ çŸ¥é“å—ï¼Ÿjavaé‡Œå…è®¸ä¸€ä¸ªç±»çš„å£°æ˜æ”¾åœ¨å¦å¤–ä¸€ä¸ªç±»çš„åŸŸé‡Œé¢ï¼ˆå†æ¬¡å¥—å¨ƒï¼‰ï¼Œå¦‚æœä¸€ä¸ªç±»è¢«å£°æ˜åœ¨äº†å¦å¤–ä¸€ä¸ªç±»é‡Œé¢ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œå†…éƒ¨ç±»æŒ‰ç…§è‡ªå·±çš„ä¿®é¥°ç¬¦å’Œå‡ºç°çš„åŒºåŸŸä¸åŒï¼Œåˆåˆ†æˆäº†ä»¥ä¸‹ç§ç±»ï¼š å¦‚å›¾ï¼Œæˆ‘ä»¬æŠŠåŒ…å«å†…éƒ¨ç±»çš„æ™®é€šç±»å«åšå¤–éƒ¨ç±»ã€‚å†…éƒ¨ç±»åˆæŒ‰ç…§é™æ€éé™æ€åšäº†åŒºåˆ†ï¼Œéé™æ€å†…éƒ¨ç±»åˆç»†åˆ†äº†ä¸‰ç±»ã€‚ä¸‹é¢ï¼Œè®©æˆ‘ä»¬æ¥èµ°è¿›å†…éƒ¨ç±»ã€‚ âš ï¸ æ³¨æ„ï¼šæœ¬èŠ‚å†…å®¹é»˜è®¤ä½ å·²ç»å¯¹ç±»æœ‰å¾ˆæ·±å…¥çš„ç†è§£ï¼Œå› æ­¤æœ¬èŠ‚çš„ä¾‹å­ç±»å‘½åä¸å†åƒå‰å‡ èŠ‚é‚£ä¹ˆâ€œè®²ç©¶â€ï¼Œä¸ºäº†æ–¹ä¾¿è¯´åé—®é¢˜ï¼Œæˆ‘ä»¬æŠŠå†…éƒ¨ç±»ä»¥InnerA/B/Cçš„å½¢å¼å‘½åï¼Œå¤–éƒ¨ç±»ä»¥OuterA/B/Cçš„æ–¹å¼å‘½åã€‚ ä¸€ã€é™æ€å†…éƒ¨ç±»1.1ï¼šé™æ€å†…éƒ¨ç±»çš„å®šä¹‰&amp;ç‰¹æ€§é™æ€å†…éƒ¨ç±»æ˜¯å†…éƒ¨ç±»çš„ä¸€ä¸ªå¤§åˆ†ç±»ï¼Œå®ƒå’Œéé™æ€å†…éƒ¨ç±»æœ‰ç€å¾ˆå¤§çš„å·®åˆ«ã€‚é™æ€å†…éƒ¨ç±»çš„å®šä¹‰æ–¹å¼å¦‚ä¸‹ï¼š ä»£ç å—112345678public class OuterA { //åœ¨OtherAè¿™ä¸ªç±»çš„åŸŸå†…ï¼Œå®šä¹‰å¦å¤–ä¸€ä¸ªä½¿ç”¨staticä¿®é¥°çš„ç±»ï¼Œè¿™ä¸ªç±»å°±è¢«ç§°ä½œOtherAçš„é™æ€å†…éƒ¨ç±» public static class InnerA { } } é™æ€å†…éƒ¨ç±»æœ‰å“ªäº›ç‰¹æ€§å‘¢ï¼Ÿ äº‹å®ä¸Šé™æ€å†…éƒ¨ç±»æ²¡æœ‰ä»»ä½•ä¸å…¶ä»–ç±»ä¸åŒçš„ç‰¹æ€§ï¼Œä½ åªéœ€è¦æŠŠå®ƒå½“æˆå¹³æ—¶çš„ç±»å³å¯ï¼Œåªä¸è¿‡å®ƒè¢«å®šä¹‰åœ¨å¦å¤–ä¸€ä¸ªç±»çš„åŸŸé‡Œè€Œå·²ï¼Œå®ƒçš„å®ä¾‹åŒ–æ–¹å¼éœ€è¦è¿™æ ·åšï¼š ä»£ç å—21234public static void main(String[] args) { OuterA outerA = new OuterA(); //å¤–éƒ¨ç±»çš„å®ä¾‹åŒ–è·Ÿæ™®é€šç±»æ²¡æœ‰ä»»ä½•åŒºåˆ« OuterA.InnerA innerA = new OuterA.InnerA(); //å†…éƒ¨ç±»çš„å®ä¾‹åŒ–æ–¹å¼} æ­¤å¤–ï¼Œæ™®é€šç±»çš„å®šä¹‰é‡Œï¼Œåªèƒ½æŠŠç±»å®šä¹‰æˆpublicç±»æˆ–è€…å¹²è„†ä¸å†™æƒé™ä¿®é¥°ç¬¦ï¼Œä¸”publicä¿®é¥°çš„ç±»è¢«ç§°ä¸ºå…¬å¼€ç±»ï¼Œè¦æ±‚æ¯ä¸ªjavaæ–‡ä»¶é‡Œæœ€å¤šåªèƒ½å­˜åœ¨ä¸€ä¸ªå…¬å¼€ç±»ï¼Œä¸”ç±»åå¿…é¡»è¦å’Œjavaæ–‡ä»¶åä¸€è‡´ï¼Œä½†æ˜¯åœ¨é™æ€å†…éƒ¨ç±»çš„ä¸–ç•Œï¼Œæ˜¯å…è®¸åŠ ä»»æ„æƒé™ä¿®é¥°ç¬¦çš„ï¼Œä¸”é™åˆ¶è·Ÿä¹‹å‰è®²çš„é‚£å¼ è¡¨ä¸­ä¸€è‡´ï¼š ä»£ç å—312345678public class OuterA { //é™æ€å†…éƒ¨ç±»çš„è®¿é—®æƒé™ä¿®é¥°ç¬¦å¯ä»¥æ˜¯publicã€protectedã€defaultã€privateé‡Œçš„ä»»æ„ä¸€ä¸ª private static class InnerA { } } ä½†æ˜¯æ”¹æˆprotectedæˆ–defaultåï¼Œå¯ä»¥å¼•ç”¨å¹¶è®¿é—®ã€‚è¿˜æœ‰ä¸€ç‚¹ï¼Œå¤–éƒ¨ç±»æ˜¯å¯ä»¥æ— è§†é™æ€å†…éƒ¨ç±»é‡Œèµ„æºçš„è®¿é—®æƒé™ä¿®é¥°ç¬¦çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¤–éƒ¨ç±»ç”šè‡³å¯ä»¥è®¿é—®é™æ€å†…éƒ¨ç±»çš„privateçº§åˆ«çš„å†…å®¹ã€‚ é™æ€å†…éƒ¨ç±»æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œä½ å¯ä»¥ç†è§£åªæ˜¯ä¸€ä¸ªç±»è¢«å®šä¹‰åœ¨äº†å¦å¤–ä¸€ä¸ªç±»é‡Œå¤´ï¼Œæ­¤å¤–å®ƒè·Ÿæ™®é€šç±»çš„ç”¨æ³•æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚ 1.2ï¼šé™æ€å†…éƒ¨ç±»çš„æ„ä¹‰å¦‚æœä½ è®¤çœŸçœ‹äº†1.1ï¼Œä½ ä¼šå‘ç°ï¼Œæ—¢ç„¶è¿™ä¸œè¥¿è·Ÿæ™®é€šç±»æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œä¸ºä»€ä¹ˆå®ƒè¿˜è¦å­˜åœ¨å‘¢ï¼Ÿæ˜¯çš„ï¼Œç¡®å®å®šä¹‰ä¸€ä¸ªæ™®é€šç±»é¿å…äº†é™æ€å†…éƒ¨ç±»é‚£ä¹ˆå¥‡æ€ªçš„å®ä¾‹åŒ–è¯­æ³•ï¼Œæ›´åŠ åˆ©äºç†è§£ï¼Œé™æ€å†…éƒ¨ç±»å­˜åœ¨å°±åªæ˜¯javaæ”¯æŒè¿™ç§å†™æ³•è€Œå·²ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå½“ç±»Bä»…ä¼šè¢«ç±»Aä½¿ç”¨ï¼Œä¸å­˜åœ¨åˆ«çš„åœ°æ–¹ä½¿ç”¨å®ƒçš„æƒ…å†µï¼Œè¿™æ—¶å°±å»ºè®®å°†ç±»Bå®šä¹‰ä¸ºç±»Açš„é™æ€å†…éƒ¨ç±»ä½¿ç”¨ï¼Œè¿™æ—¶è®¿é—®æƒé™å»ºè®®è®¾ç½®ä¸ºprivate â†è¿™æ˜¯è¾ƒå®˜æ–¹çš„è¯´æ³•ï¼Œå…¶å®javaæ”¯æŒè¿™ç§è§„åˆ™ï¼Œåœ¨å®é™…å¼€å‘ä¸­å¾€å¾€æœ‰æ›´å¤šç§å¤šæ ·çš„å†™æ³•ï¼Œæ¯”å¦‚æŸäº›æƒ…å†µä¸‹å°è£…æˆä¸€ä¸ªè´Ÿè´£æ”¶é›†å¤–éƒ¨ç±»å„ç§å±æ€§çš„å†…éƒ¨ç±»ï¼š ä»£ç å—41234567891011121314151617181920212223242526272829303132333435363738394041public class Student { private int id; private int age; private String name; private Student(int id, int age, String name) { this.id = id; this.age = age; this.name = name; } public static Builder newBuilder() { return new Builder(); //å®šä¹‰ä¸€ä¸ªå¯ä»¥è¿”å›å†…éƒ¨ç±»å¯¹è±¡çš„å¤–éƒ¨é™æ€æ–¹æ³• } public static class Builder { private int id; private int age; private String name; public Builder id(int id) { this.id = id; return this; } public Builder age(int age) { this.age = age; return this; } public Builder name(String name) { this.name = name; return this; } public Student build() { return new Student(id, age, name); //é™æ€å†…éƒ¨ç±»å¯ä»¥è°ƒç”¨å¤–éƒ¨ç±»çš„privateæ–¹æ³• } }} ä¸Šé¢çš„Builderå†…éƒ¨ç±»è´Ÿè´£ç»™å®ƒçš„å¤–éƒ¨ç±»æ”¶é›†å±æ€§å€¼ï¼Œæœ€ç»ˆé€šè¿‡buildæ„å»ºä¸€ä¸ªå¤–éƒ¨ç±»å®ä¾‹ï¼Œç„¶åStudentçš„æ„é€ å™¨è¢«æˆ‘ä»¬ææˆprivateäº†ï¼Œå› æ­¤Studentä¸å¯ä»¥é€šè¿‡æ„é€ å™¨çš„æ–¹å¼è¿›è¡Œå®ä¾‹åŒ–äº†ï¼Œä½†æ˜¯å´å¯ä»¥é€šè¿‡Builderè¿™ä¸ªå†…éƒ¨ç±»å®ä¾‹åŒ–ï¼š ä»£ç å—5123public static void main(String[] args) { Student student = Student.newBuilder().id(1).age(12).name(\"sssss\").build(); //â†é“¾å¼è°ƒç”¨èµ‹å€¼} å¦‚æœä¸€ä¸ªå¯¹è±¡å±æ€§è¿‡å¤šï¼Œç›¸æ¯”é‚£ç§å®šä¹‰ä¸€å †çš„setã€getæ–¹æ³•çš„æ–¹å¼ç»™å±æ€§èµ‹å€¼ï¼Œä¸å¦‚ä½¿ç”¨è¿™ç§é“¾å¼è°ƒç”¨çš„æ–¹å¼æ¥çš„ç®€æ´ã€‚ æ³¨æ„ï¼Œä¸¾è¿™ä¸ªä¾‹å­çš„ç›®çš„ä¸æ˜¯è®©ä½ ä¸€å®šè¦ç”¨é™æ€å†…éƒ¨ç±»æè¿™ç§äº‹æƒ…ï¼Œè€Œæ˜¯è¦å‘Šè¯‰ä½ ï¼Œjavaæ”¯æŒäº†è¿™ç§å®šä¹‰æ–¹å¼ï¼Œä½ å¯ä»¥åˆ©ç”¨è¿™ç§å®šä¹‰æ–¹å¼ï¼Œæ¥åšä½ è‡ªå·±è®¤ä¸ºæ­£ç¡®çš„ç±»æ‹†åˆ†ã€‚ äºŒã€éé™æ€å†…éƒ¨ç±»2.1ï¼šæˆå‘˜å†…éƒ¨ç±»å…ˆæ¥çœ‹çœ‹æˆå‘˜å†…éƒ¨ç±»æ€ä¹ˆå®šä¹‰ï¼š ä»£ç å—612345678public class OuterB { //åœ¨OtherBè¿™ä¸ªç±»çš„åŸŸå†…ï¼Œå®šä¹‰å¦å¤–ä¸€ä¸ªéé™æ€çš„ç±»ï¼Œè¿™ä¸ªç±»å°±è¢«ç§°ä½œOtherAçš„æˆå‘˜å†…éƒ¨ç±» public class InnerB { } } æˆå‘˜å†…éƒ¨ç±»è·Ÿé™æ€å†…éƒ¨ç±»å°±å®Œå…¨ä¸ä¸€æ ·äº†ï¼Œæ¥çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆå®Œæˆå®ä¾‹åŒ–çš„ï¼š ä»£ç å—71234public static void main(String[] args) { OuterB outerB = new OuterB(); //åŒæ ·çš„ï¼Œå¤–éƒ¨ç±»çš„å®ä¾‹åŒ–è·Ÿæ™®é€šç±»æ²¡æœ‰ä»»ä½•åŒºåˆ« OuterB.InnerB innerB = outerB.new InnerB(); //æˆå‘˜å†…éƒ¨ç±»å¿…é¡»ä¾é å¤–éƒ¨ç±»çš„å¼•ç”¨å˜é‡å®Œæˆåˆå§‹åŒ–} okï¼Œç°åœ¨æ¥ä»‹ç»ä¸‹æˆå‘˜å†…éƒ¨ç±»çš„ç‰¹æ€§ï¼š æˆå‘˜å†…éƒ¨ç±»ä¸å…è®¸æ‹¥æœ‰éfinalçš„é™æ€å±æ€§ï¼Œä¸å…è®¸æ‹¥æœ‰ä»»æ„å½¢å¼çš„é™æ€æ–¹æ³•ã€‚ æˆå‘˜å†…éƒ¨ç±»å¿…é¡»é€šè¿‡å¤–éƒ¨ç±»çš„å¼•ç”¨å˜é‡é€šè¿‡newå…³é”®è¯å»å®ä¾‹åŒ–ï¼ˆå¿…é¡»æ˜¯å¤–éƒ¨ç±»æœ¬ç±»çš„å¼•ç”¨å˜é‡æ‰è¡Œï¼Œå¤–éƒ¨ç±»çš„çˆ¶ç±»å¼•ç”¨å˜é‡å®ä¾‹åŒ–å†…éƒ¨ç±»æ˜¯ä¸å…è®¸çš„ï¼‰ æˆå‘˜å†…éƒ¨ç±»å¯ä»¥è®¿é—®ä»»æ„å¤–éƒ¨ç±»çš„èµ„æºï¼ˆæ— è§†è®¿é—®æƒé™ä¿®é¥°ç¬¦çš„è®¿é—®ï¼‰ æˆå‘˜å†…éƒ¨ç±»çš„å®šä¹‰è·Ÿé™æ€å†…éƒ¨ç±»ä¸€æ ·æ‹¥æœ‰æƒé™ä¿®é¥°ç¬¦ï¼Œæˆ‘ä»¬ä¸€èˆ¬å»ºè®®è®¾ç½®æˆprivateçš„ï¼Œç”±äºéé™æ€å†…éƒ¨ç±»çš„ç‰¹æ€§ï¼Œå®ƒå¯ä»¥è¢«å¤–éƒ¨ç±»newå‡ºæ¥ä¹‹åæ“ä½œå¤–éƒ¨ç±»é‡Œé¢ä»»æ„èµ„æºï¼Œå› æ­¤å®ƒå¸¸è¢«ç”¨æ¥éš”ç¦»ä¸€äº›å¤–éƒ¨ç±»çš„å¤æ‚æ“ä½œï¼Œä¾‹å¦‚ä¸€ä¸ªå¤–éƒ¨ç±»è¿‡äºåºå¤§ï¼ŒåŠŸèƒ½ç‚¹å¾ˆå¤šï¼Œä½ å°±å¯ä»¥æŒ‰ç…§ä¸åŒçš„åŠŸèƒ½ç‚¹è®¾ç½®ä¸åŒçš„æˆå‘˜å†…éƒ¨ç±»è¿›è¡Œé€»è¾‘å½’ç±»ã€‚ 2.2ï¼šå±€éƒ¨å†…éƒ¨ç±»å±€éƒ¨å†…éƒ¨ç±»å°±æ˜¯å®šä¹‰åœ¨ä¸€ä¸ªæ–¹æ³•æˆ–è€…ä¸€ä¸ªä½œç”¨åŸŸé‡Œé¢çš„ç±»ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š ä»£ç å—8123456789101112131415161718192021222324252627282930313233public class OuterC { static { //é™æ€å—é‡Œå®šä¹‰çš„å±€éƒ¨å†…éƒ¨ç±» class InnerC1 { } InnerC1 innerC1 = new InnerC1(); //åªèƒ½åœ¨é™æ€å—å†…ä½¿ç”¨ } public void method() { final int a = 1; final int b = 14; class InnerC2 { //æ–¹æ³•ä½“é‡Œå®šä¹‰çš„å±€éƒ¨å†…éƒ¨ç±» private int a = 2; //è‡ªå·±å†…éƒ¨ä¹Ÿå¯ä»¥å®šä¹‰ä¸åŒåŸŸå†…å‘½åç›¸åŒçš„å˜é‡ public void m() { a = 12; System.out.println(a); //é»˜è®¤ä½¿ç”¨çš„aæ˜¯å®ƒè‡ªå·±çš„ System.out.println(this.a); //è·Ÿä¸Šé¢ä¸€è‡´ï¼Œä¸Šé¢åªæ˜¯éšå¼çš„this.aï¼Œæˆ‘ä»¬å‘ç°ï¼Œå¦‚æœè‡ªå·±çš„æˆå‘˜å˜é‡è·Ÿå¤–é¢åŒåŸŸå†…å£°æ˜çš„å˜é‡å‘½åä¸€è‡´ï¼Œåˆ™å†ä¹Ÿæ— æ³•æŒ‡å®šå¤–éƒ¨åŸŸé‡Œé‚£ä¸ªå˜é‡äº† System.out.println(b); //å±€éƒ¨å†…éƒ¨ç±»å¯ä»¥ä½¿ç”¨å…¶å¤–é¢çš„åŒåŸŸå†…çš„æ•°æ®ï¼Œä½†æ˜¯è¦æ±‚æ•°æ®å¿…é¡»å£°æ˜æˆfinalä¿®é¥°çš„å¸¸é‡ } } InnerC2 innerC2 = new InnerC2(); //ä¸Šé¢æ˜¯å±€éƒ¨å†…éƒ¨ç±»çš„å£°æ˜ï¼Œå®Œæˆååœ¨ä¸‹é¢å³å¯å®ä¾‹åŒ–åä½¿ç”¨ innerC2.m(); } public static void method2() { class InnerC3 { //é™æ€æ–¹æ³•ä½“é‡Œå®šä¹‰çš„å±€éƒ¨å†…éƒ¨ç±» } } } æ¥æ€»ç»“ä¸‹å±€éƒ¨å†…éƒ¨ç±»çš„ç‰¹æ€§ï¼š æ— æ³•è®¿é—®ä»»ä½•å¤–éƒ¨ç±»çš„éé™æ€çš„èµ„æº ä¸å…è®¸å®šä¹‰è®¿é—®æƒé™ä¿®é¥°ç¬¦ ä½œä¸ºå®šä¹‰åœ¨æŸä¸ªä½œç”¨åŸŸå†…çš„å±€éƒ¨å†…éƒ¨ç±»ï¼Œå®ƒå¯ä»¥è®¿é—®åŒåŸŸçš„å˜é‡ï¼Œä½†æ˜¯åŒåŸŸå˜é‡å¿…é¡»åŠ ä¸Šfinalå…³é”®è¯ å…è®¸åœ¨ä»»æ„å±€éƒ¨åŸŸå†…å®šä¹‰ï¼Œå®šä¹‰åå³å¯åœ¨ä¸‹æ–¹ç›´æ¥ä½¿ç”¨ ç›®å‰é’ˆå¯¹å±€éƒ¨å†…éƒ¨ç±»åšä¸‹äº†è§£å³å¯ï¼ŒçœŸæ­£å¼€å‘ä¸­æå°‘ç”¨åˆ°ã€‚ 2.3ï¼šåŒ¿åå†…éƒ¨ç±»åŒ¿åå†…éƒ¨ç±»å³æ— åç§°çš„å†…éƒ¨ç±»ï¼Œæˆ‘ä»¬åœ¨å‰é¢å­¦è¿‡æŠ½è±¡ç±»å’Œæ¥å£ï¼Œå®ƒä»¬æ˜¯æ— æ³•è¢«å®ä¾‹åŒ–çš„ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨è¿™æ ·åšï¼š step1ï¼šå®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œè®©å®ƒæ‹¥æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œaå’Œb ä»£ç å—91234public interface A { void a(); void b();} step2ï¼šå®šä¹‰ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè®©å®ƒæ‹¥æœ‰æŠ½è±¡æ–¹æ³•c ä»£ç å—10123public abstract class B { abstract void c();} step3ï¼šå®šä¹‰ä¸€ä¸ªæ™®é€šçš„ç±»ï¼Œè®©å…¶æ‹¥æœ‰ä¸€ä¸ªæ¥å—Aå’ŒBç±»å‹å‚æ•°çš„æ–¹æ³•ï¼Œç„¶åè§¦å‘abcæ–¹æ³• ä»£ç å—111234567public class C { public void testInner(A a, B b) { a.a(); a.b(); b.c(); }} okï¼Œæˆ‘ä»¬å‰é¢è®²è¿‡ï¼Œæ¥å£å’ŒæŠ½è±¡ç±»éƒ½æ˜¯æ— æ³•è¢«ç›´æ¥å®ä¾‹åŒ–çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è°ƒç”¨testInnerè¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ä¸€å®šæ˜¯ä¼ çš„Açš„å®ç°ç±»å’ŒBçš„å­ç±»çš„å¯¹è±¡ï¼Œä½†æˆ‘ç°åœ¨å‘Šè¯‰ä½ ï¼Œæˆ‘æ²¡æœ‰å®ç°Açš„ç±»ï¼Œä¹Ÿæ²¡æœ‰Bçš„å­ç±»ï¼Œè¯¥ä¼ ä»€ä¹ˆå‘¢ï¼Ÿå¥½çš„ï¼Œæˆ‘ä»¬å¼€å§‹å¼•å…¥åŒ¿åå†…éƒ¨ç±»ï¼š ä»£ç å—1212345678910111213141516171819public static void main(String[] args){ C c = new C(); c.testInner(new A() { //è¿™é‡Œnewäº†Aï¼Œä¸‹æ–¹æ˜¯å¯¹å…¶çš„å®ç°ä»£ç ï¼Œè¿™ä¸ªä»£ç å—å°±æ˜¯ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»ï¼Œè¿™ä¸ªç±»å®ç°äº†Aæ¥å£ï¼Œå±äºAæ¥å£çš„å®ç°ç±»ï¼Œè¿™æ®µä»£ç ä½œä¸ºåŒ¿åå†…éƒ¨ç±»è¢«newäº†å‡ºæ¥ï¼Œèµ‹ç»™äº†testInnerçš„ç¬¬ä¸€ä¸ªå‚æ•° @Override public void a() { System.out.println(\"å®ç°äº†Aæ¥å£çš„åŒ¿åå†…éƒ¨ç±»aæ–¹æ³•é€»è¾‘å®ç°\"); } @Override public void b() { System.out.println(\"å®ç°äº†Aæ¥å£çš„åŒ¿åå†…éƒ¨ç±»bæ–¹æ³•é€»è¾‘å®ç°\"); } }, new B() { //åŒæ ·çš„ï¼Œè¿™é‡Œnewäº†Bï¼Œä¸‹æ–¹æ˜¯å¯¹å…¶æŠ½è±¡æ–¹æ³•çš„é‡å†™ï¼Œè¿™ä¸ªä»£ç å—ä¹Ÿæ˜¯ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»ï¼Œè¿™ä¸ªç±»ç»§æ‰¿äº†Bï¼Œå±äºBçš„å­ç±»ï¼Œè¿™æ®µä»£ç ä½œä¸ºåŒ¿åå†…éƒ¨ç±»è¢«newäº†å‡ºæ¥ï¼Œèµ‹ç»™äº†testInnerçš„ç¬¬äºŒä¸ªå‚æ•° @Override void c() { System.out.println(\"å®ç°äº†BæŠ½è±¡ç±»çš„åŒ¿åå†…éƒ¨ç±»cæ–¹æ³•é€»è¾‘å®ç°\"); } });} è¾“å‡ºå¦‚ä¸‹ï¼š ä»£ç å—13123å®ç°äº†Aæ¥å£çš„åŒ¿åå†…éƒ¨ç±»aæ–¹æ³•é€»è¾‘å®ç°å®ç°äº†Aæ¥å£çš„åŒ¿åå†…éƒ¨ç±»bæ–¹æ³•é€»è¾‘å®ç°å®ç°äº†BæŠ½è±¡ç±»çš„åŒ¿åå†…éƒ¨ç±»cæ–¹æ³•é€»è¾‘å®ç° å¯ä»¥çœ‹åˆ°ï¼ŒåŒ¿åå†…éƒ¨ç±»é‡Œçš„å®ç°é€»è¾‘å·²è¢«æˆåŠŸè§¦å‘ã€‚ è¿™æ˜¯åœ¨å¹²ä»€ä¹ˆå‘¢ï¼Ÿä¸ºä»€ä¹ˆå¥½å¥½çš„å®ç°ç±»å’Œå­ç±»ä½ ä¸å†™ï¼Œéè¦ç”¨åŒ¿åå†…éƒ¨ç±»å†™æˆè¿™æ ·ï¼Ÿå…¶å®è¿™æ˜¯ä¸€ç§å·æ‡’çš„å†™æ³•ï¼Œæœ‰äº›ç±»ä½ ä¸æƒ³ä¸“é—¨ç»™å®ƒå†™å®ç°å’Œå­ç±»çš„è¯ï¼Œåˆ«çš„åœ°æ–¹åˆéœ€è¦ç”¨åˆ°å®ƒä»¬çš„å¯¹è±¡ï¼Œé‚£å°±å¯ä»¥åˆ©ç”¨åŒ¿åå†…éƒ¨ç±»æ¥â€œå·æ‡’â€","link":"/2020/03/12/LV3-2%EF%BC%9A%E5%86%85%E9%83%A8%E7%B1%BB/"},{"title":"LV3-1ï¼šä½œç”¨åœ¨ç±»ã€å˜é‡ã€æ–¹æ³•ä¸Šçš„å…¶å®ƒä¿®é¥°ç¬¦","text":"ä¸€ã€staticå…³é”®è¯ ç®€å•è§£é‡Šï¼šstaticå…³é”®è¯æ”¾åˆ°è®¿é—®æƒé™ä¿®é¥°è¯çš„åé¢ï¼Œç”¨æ¥ä¿®é¥°ç±»çš„å±æ€§ã€æ–¹æ³•ï¼Œè¢«staticä¿®é¥°äº†çš„å±æ€§å’Œæ–¹æ³•è¢«ç§°ä¸ºé™æ€å±æ€§å’Œé™æ€æ–¹æ³•ï¼Œé™æ€å±æ€§å’Œé™æ€æ–¹æ³•å¯ä»¥åœ¨ä¸å®ä¾‹åŒ–å¯¹è±¡çš„æƒ…å†µä¸‹ç›´æ¥é€šè¿‡â€œç±»å.å±æ€§/æ–¹æ³•â€çš„æ–¹å¼è§¦å‘ã€‚ ç°åœ¨å¼€å§‹æˆ‘ä»¬çš„è¯¦ç»†ä»‹ç»ï¼š æˆ‘ä»¬åœ¨ä¹‹å‰å­¦ç±»çš„æ—¶å€™ä¼šå‘ç°ï¼Œæ‰€æœ‰çš„æ–¹æ³•å’Œå±æ€§å¿…é¡»è¦åœ¨ç±»åšå®ä¾‹åŒ–äº§ç”Ÿè‡ªå·±çš„å¯¹è±¡ä¹‹åï¼Œé€šè¿‡å¯¹è±¡çš„å¼•ç”¨å˜é‡æ¥è§¦å‘è°ƒç”¨ï¼Œç®€å•æ¥è¯´ï¼Œéstaticçš„å†…å®¹ï¼Œéƒ½æ˜¯å±äºç±»å¯¹è±¡çš„ï¼Œæ²¡æœ‰äº§ç”Ÿå…·ä½“å¯¹è±¡çš„ç±»é‡Œçš„è¿™äº›éstaticå†…å®¹æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œé‚£staticå‘¢ï¼Ÿè¢«staticä¿®é¥°çš„å†…å®¹å±äºç±»æœ¬èº«çš„å†…å®¹ï¼Œé™æ€æ–¹æ³•å’Œé™æ€å±æ€§æ˜¯å¯ä»¥ç›´æ¥ç”¨ç±»è°ƒç”¨çš„ï¼Œä½ å¯ä»¥ç†è§£é™æ€å±æ€§å’Œæ–¹æ³•å°±æ˜¯ç±»å®šä¹‰æœ¬èº«çš„å±æ€§å’Œæ–¹æ³•ï¼Œä¸ä¾èµ–äº§ç”Ÿçš„å¯¹è±¡è€Œè®©è‡ªå·±å˜å¾—æœ‰æ„ä¹‰ï¼Œåªè¦ç±»å­˜åœ¨ï¼Œä¸”è¢«åŠ è½½è¿›jvmï¼Œå®ƒå°±æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå®ƒå°±æ˜¯å¯ä»¥é€šè¿‡ç±»æœ¬èº«å»è§¦å‘ä½¿ç”¨çš„ï¼Œè®©æˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­ï¼š è®©æˆ‘ä»¬æŠŠå‰é¢Animalçš„ç±»æ”¹é€ ä¸‹ï¼Œæˆ‘ä»¬çŸ¥é“ï¼ŒAnimalæ˜¯ä¸ºäº†æè¿°åŠ¨ç‰©çš„ä¸€ä¸ªè¶…å¤§çˆ¶ç±»ï¼Œé‡Œé¢å®šä¹‰äº†ä¸€äº›ä½œä¸ºåŠ¨ç‰©åº”è¯¥æœ‰çš„ç±»å±æ€§ï¼Œæ¯”å¦‚nameã€ageï¼Œè¿™äº›å±æ€§ä½ ä¼šå‘ç°ä¸€ä¸ªç‰¹ç‚¹ï¼Œé‚£å°±æ˜¯å®ƒä»¬å¿…é¡»è¦ä¾èµ–å…·ä½“æŸä¸€ä¸ªåŠ¨ç‰©ä¸ªä½“æ‰æœ‰æ„ä¹‰ï¼Œæ¢å¥è¯è¯´ï¼Œæ¯ä¸ªåŠ¨ç‰©çš„ageã€nameå„ä¸ç›¸åŒï¼Œè¿™ä¸ªå…·ä½“çš„ä¸ªä½“å°±æ˜¯æˆ‘ä»¬åˆ©ç”¨Animaläº§ç”Ÿçš„å¯¹è±¡ï¼Œnameã€ageç¦»å¼€äº†å¯¹è±¡ä¸ªä½“æ²¡æœ‰æ„ä¹‰ï¼Œç°åœ¨æˆ‘ä»¬å†æ¥å‘æ•£ä¸‹æ€ç»´ï¼Œå¦‚æœéœ€è¦æœ‰ä¸€ä¸ªå­—æ®µæ¥æè¿°Animalè¿™ä¸ªç±»ï¼Œæ¯”å¦‚Animalæ˜¯åŠ¨ç‰©ç±»ï¼Œå‡å¦‚æˆ‘ä»¬æœªæ¥è¿˜ä¼šæœ‰æ¤ç‰©ç±»ï¼Œæˆ‘ä»¬ç°åœ¨éœ€è¦ä¸€ä¸ªå­—æ®µç”¨æ¥åŒºåˆ†å®ƒä»¬ï¼Œè¿™æ—¶æˆ‘ä»¬æ–°å¢ä¸€ä¸ªå­—æ®µå«â€œç”Ÿç‰©åˆ†ç±»â€çš„å­—æ®µï¼ŒAnimalé‡Œè¿™ä¸ªå­—æ®µçš„å€¼æ’ç­‰äºâ€œåŠ¨ç‰©â€ï¼Œè¿™ä¸ªå­—æ®µæˆ‘ä»¬å‘ç°æ˜¯ä¸“é—¨ç”¨æ¥å½¢å®¹ç±»çš„ï¼Œä½ è®©è¿™ä¸ªå­—æ®µå˜æˆä¸€ä¸ªæ™®é€šçš„ç±»å±æ€§ï¼Œé‚£å®ƒæ¯æ¬¡newä¸€ä¸ªAnimalå¯¹è±¡ï¼Œè¿™ä¸ªå±æ€§å°±è·Ÿç€å­˜åˆ°å¯¹åº”çš„å¯¹è±¡ä¸€æ¬¡ï¼Œæ˜¯ä¸æ˜¯è§‰å¾—å¾ˆæµªè´¹èµ„æºï¼Ÿè¿™æ—¶å°±å¯ä»¥æŠŠè¿™ä¸ªå±æ€§å®šä¹‰æˆä¸€ä¸ªé™æ€å˜é‡ï¼š ä»£ç å—11234567891011121314151617181920212223242526public class Animal { //è¿™é‡Œå®šä¹‰ä¸€ä¸ªé™æ€å˜é‡ï¼Œç”¨æ¥æ ‡è®°è¯¥ç±»å±äºé‚£ç§ç”Ÿç‰©åˆ†ç±» public static String taxonomy = \"åŠ¨ç‰©ç±»\"; private String name = \"xx\"; public int age; public void cry() { System.out.println(\"å«å£°ä¸ºï¼šæœªçŸ¥\"); } public void eat() { System.out.println(this.name + \"æ­£åœ¨åƒä¸œè¥¿\"); } public void setName(String name) { this.name = name; } public void setAge(int age) { this.age = age; } } æˆ‘ä»¬æ€ä¹ˆè®¿é—®è¿™ä¸ªå­—æ®µå‘¢ï¼Ÿæˆ‘ä»¬å‰é¢å·²ç»è¯´è¿‡ï¼Œé€šè¿‡â€œç±»å.å±æ€§/æ–¹æ³•â€å³å¯è§¦å‘ï¼š ä»£ç å—2123public static void main(String[] args) { System.out.println(Animal.taxonomy);} çœ‹ï¼Œè¿™æ ·å°±å¯ä»¥è®¿é—®åˆ°é™æ€å±æ€§äº†ï¼Œä¸å…‰å±æ€§æ˜¯è¿™æ ·ï¼Œæ–¹æ³•è°ƒç”¨ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œç°åœ¨æˆ‘ä»¬åŠ ä¸€ä¸ªå·¥å…·æ–¹æ³•ï¼Œç”¨æ¥åˆ¤æ–­ä¸€ä¸ªåŠ¨ç‰©çš„å¹´é¾„æ˜¯å¦åˆæ³•ï¼š ä»£ç å—312345678910111213141516public class Animal { //è¿™é‡Œå®šä¹‰ä¸€ä¸ªé™æ€å˜é‡ï¼Œç”¨æ¥æ ‡è®°è¯¥ç±»å±äºé‚£ç§ç”Ÿç‰©åˆ†ç±» public static String taxonomy = \"åŠ¨ç‰©ç±»\"; private String name = \"xx\"; public int age; ...çœç•¥... public static boolean isAgeTooLong(int age) { //è¿™ä¸ªé™æ€æ–¹æ³•ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªå¹´é¾„å¯¹äºä¸€ä¸ªåŠ¨ç‰©æ¥è®²æ˜¯å¦åˆç† return age &gt; 10000; } } æ–¹æ³•çš„è°ƒç”¨ä¹Ÿæ˜¯ç±»ä¼¼ï¼š ä»£ç å—41234public static void main(String[] args) { System.out.println(Animal.taxonomy); //è®¿é—®é™æ€å±æ€§ System.out.println(Animal.isAgeTooLong(1)); //è°ƒç”¨é™æ€æ–¹æ³•} é‚£é™æ€çš„å˜é‡/æ–¹æ³•è·Ÿæ™®é€šçš„å˜é‡/æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸‹æµç¨‹å›¾ï¼š æŒ‰ç…§è¿™ä¸ªç‰¹æ€§ï¼Œéé™æ€æ–¹æ³•ä»ç„¶å¯ä»¥è°ƒç”¨é™æ€æ–¹æ³•ï¼š åœ¨Animalå†…éƒ¨è°ƒç”¨ç”šè‡³å¯ä»¥çœç•¥Animalï¼Œæƒ³æƒ³è¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºé€šè¿‡å›¾1å¯ä»¥çŸ¥é“ï¼Œé™æ€å†…å®¹æ˜¯å±äºç±»æ¨¡æ¿æœ¬èº«çš„ï¼Œè€Œéé™æ€å†…å®¹åˆ™æ˜¯ç±»å¯¹å…¶å¯¹è±¡æ‰€åšçš„çº¦æŸå®šä¹‰ï¼Œé€šè¿‡è¿™äº›éé™æ€çš„å†…å®¹è§„å®šäº†å®ƒäº§ç”Ÿçš„å¯¹è±¡æ‰€åŒ…å«çš„å†…å®¹ï¼Œæ‰€ä»¥å¯¹äºé™æ€å†…å®¹æ¥è¯´ï¼Œåªè¦æœ‰è®¿é—®æƒé™ï¼ˆæ˜¯çš„ï¼Œé™æ€å†…å®¹ä¹Ÿå—è®¿é—®æƒé™ä¿®é¥°ç¬¦çš„å½±å“ï¼Œè§„åˆ™è·Ÿä¹‹å‰ç›¸ç¬¦ï¼‰ï¼Œä¸ç®¡åœ¨å“ªé‡Œï¼Œéƒ½å¯ä»¥é€šè¿‡ç±»åè°ƒç”¨ã€‚ staticä¸»è¦ç”¨æ¥å®šä¹‰ä¸€äº›å·¥å…·æ–¹æ³•æˆ–è€…å±æ€§ï¼Œè¿™äº›æ–¹æ³•å’Œå±æ€§ä»…ä¸ºäº†å¤„ç†ä¸€äº›éå¯¹è±¡çº§åˆ«çš„æ“ä½œï¼Œæ¯”å¦‚ä¾‹å­é‡Œåˆ¤æ–­å¹´é¾„å¯¹äºåŠ¨ç‰©æ˜¯å¦åˆæ³•çš„æ–¹æ³•ï¼Œä½ å¯ä»¥è®¤ä¸ºå®ƒå°±æ˜¯ä¸€ä¸ªå·¥å…·æ–¹æ³•ï¼Œå› ä¸ºå®ƒè·Ÿå…·ä½“çš„åŠ¨ç‰©å¯¹è±¡æ²¡æœ‰å…³ç³»ï¼Œè€Œæ˜¯å¯¹æ•´ä¸ªåŠ¨ç‰©åœˆéƒ½æœ‰æ•ˆï¼Œé‚£ä½ å°±å¯ä»¥æŠŠå®ƒææˆä¸€ä¸ªé™æ€å·¥å…·ç±»ã€‚ âš ï¸ staticæ˜¯ä¸å¯ä»¥ç›´æ¥ä¿®é¥°ç±»çš„ï¼Œåªèƒ½ä¿®é¥°å†…éƒ¨ç±»ï¼Œè¢«staticä¿®é¥°çš„å†…éƒ¨ç±»è¢«ç§°ä½œé™æ€å†…éƒ¨ç±»ï¼Œæœ‰å…³å†…éƒ¨ç±»çš„å†…å®¹åœ¨åé¢çš„æ–‡æ¡£ï¼Œè¿™é‡Œå…ˆä¸åšäº†è§£ã€‚ äºŒã€finalå…³é”®è¯åœ¨Javaä¸­ï¼Œfinalå…³é”®å­—å¯ä»¥ç”¨æ¥ä¿®é¥°ç±»ã€æ–¹æ³•å’Œå˜é‡ï¼ˆåŒ…æ‹¬æˆå‘˜å˜é‡å’Œå±€éƒ¨å˜é‡ï¼‰ã€‚ä¸‹é¢å°±ä»è¿™ä¸‰ä¸ªæ–¹é¢æ¥äº†è§£ä¸€ä¸‹finalå…³é”®å­—çš„åŸºæœ¬ç”¨æ³•ã€‚ 2.1ï¼šfinalä¿®é¥°ç±»å½“ç”¨finalä¿®é¥°ä¸€ä¸ªç±»æ—¶ï¼Œè¡¨æ˜è¿™ä¸ªç±»ä¸èƒ½è¢«ç»§æ‰¿ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªç±»ä½ æ°¸è¿œä¸ä¼šè®©ä»–è¢«ç»§æ‰¿ï¼Œå°±å¯ä»¥ç”¨finalè¿›è¡Œä¿®é¥°ã€‚finalç±»ä¸­çš„æˆå‘˜å˜é‡å¯ä»¥æ ¹æ®éœ€è¦è®¾ä¸ºfinalï¼Œä½†æ˜¯è¦æ³¨æ„finalç±»ä¸­çš„æ‰€æœ‰æˆå‘˜æ–¹æ³•éƒ½ä¼šè¢«éšå¼åœ°æŒ‡å®šä¸ºfinalæ–¹æ³•ã€‚ ä¾‹å¦‚ä½ ä¸å¸Œæœ›Animaläº§ç”Ÿä»»ä½•çš„å­ç±»ï¼Œé‚£ä¹ˆå¯ä»¥è¿™æ ·å®šä¹‰Animalï¼š ä½¿ç”¨finalä¿®é¥°äº†Animalä¹‹åï¼ŒCatè¿™é‡Œå°±ä¼šæŠ¥é”™ï¼š å› ä¸ºè¢«finalä¿®é¥°çš„classï¼Œä¸å…è®¸è¢«ç»§æ‰¿ã€‚ â“ æ€è€ƒï¼šabstractå…³é”®è¯å¯ä»¥å’Œfinalä¸€èµ·ä½¿ç”¨å—ï¼Ÿ 2.2ï¼šfinalä¿®é¥°æ–¹æ³•è¢«finalä¿®é¥°çš„æ–¹æ³•ï¼Œä¸å…è®¸è¢«è¦†ç›–é‡å†™ï¼Œæ¯”å¦‚æˆ‘ä»¬æŠŠAnimalé‡Œçš„cryæ–¹æ³•æ”¹æˆfinalçš„ï¼š è¿™æ—¶Catç±»é‡Œå°±ä¼šæŠ¥é”™ï¼š å¯ä»¥çœ‹åˆ°ï¼ŒIDEä¼šæç¤ºè¢«finalä¿®é¥°çš„æ–¹æ³•æ— æ³•è¢«é‡å†™ã€‚ âš ï¸ åœ¨ç»§æ‰¿å…³ç³»ä¸­ï¼Œçˆ¶ç±»é™¤äº†finalæ–¹æ³•ä¸å…è®¸è¢«å­ç±»é‡å†™ï¼Œprivateçš„æ–¹æ³•åŒæ ·ä¸å…è®¸ï¼Œprivateæ–¹æ³•ä¼šè¢«éšå¼çš„æŒ‡å®šä¸ºfinalæ–¹æ³•ã€‚ 2.3ï¼šfinalä¿®é¥°å˜é‡finalå¯ä»¥ä¿®é¥°æˆå‘˜å˜é‡ã€å±€éƒ¨å˜é‡ï¼Œè¢«finalä¿®é¥°äº†çš„å˜é‡ï¼Œä¸å¯ä»¥è¢«å†æ¬¡èµ‹å€¼ï¼Œä¾‹å¦‚ï¼š è¢«finalä¿®é¥°çš„æˆå‘˜å˜é‡å’Œå±€éƒ¨å˜é‡çš„åˆå§‹å€¼èµ‹å€¼ä¹Ÿæ˜¯æœ‰åŒºåˆ«çš„ï¼š å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆå‘˜å˜é‡è®¾ç½®ä¸ºfinalæ—¶å¦‚æœä¸èµ‹åˆå§‹å€¼ï¼Œåˆ™ä¼šæç¤ºæŠ¥é”™ï¼Œè€Œå±€éƒ¨å˜é‡åˆ™ä¸ä¼šï¼Œå±€éƒ¨å˜é‡åªéœ€è¦åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨å‰èµ‹åˆå§‹å€¼å³å¯ï¼Œèµ‹å®Œä¹‹åå†æ¬¡èµ‹å€¼æ‰ä¼šæç¤ºé‡å¤èµ‹å€¼çš„é”™è¯¯ã€‚ ç»“è®ºå°±æ˜¯finalå…³é”®è¯çš„ç›®æ ‡å°±æ˜¯ä¿è¯å˜é‡å†…å®¹ä»…å¯ä»¥è¢«èµ‹å€¼ä¸€æ¬¡ï¼Œè¢«finalä¿®é¥°çš„å˜é‡æ›´åƒæ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œå› ä¸ºå®ƒå¹¶ä¸ä¼šå†æ¬¡å‘ç”Ÿæ”¹å˜äº†ã€‚ finalåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­é€šå¸¸å’Œstaticä¸€èµ·ä½¿ç”¨ï¼Œç”¨æ¥ä¿å­˜ä¸€ä¸ªç±»é‡Œçš„å¸¸é‡ï¼š è¯•æƒ³ä¸€ä¸‹ä¸ºä»€ä¹ˆï¼Œé¦–å…ˆè¿™æ˜¯ä¸ªé™æ€æ•°æ®ï¼Œè¿˜æ˜¯ä¸ªpublicçš„ï¼Œè¿™å°±æ„å‘³ç€ä»»æ„ç±»ä»»æ„åœ°æ–¹éƒ½æœ‰å¯èƒ½æŠŠå®ƒçš„å€¼ç»™æ”¹æ‰ï¼Œè¿™å°±ä¸ç¬¦åˆå¸¸é‡è¿™ä¸€æ ‡å‡†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨finalæŠŠå®ƒé”èµ·æ¥ã€‚ æˆ‘ä»¬å†æ¥å‘æ•£ä¸‹æ€ç»´ï¼Œfinalæ§åˆ¶æ•°æ®ä¸è¢«å†æ¬¡èµ‹å€¼ï¼Œé‚£ä¹ˆå¼•ç”¨å˜é‡ä¼šä¸ä¼šæ”¹å˜ï¼Ÿ æˆ‘ä»¬ä¹‹å‰è®²è¿‡ï¼Œå¼•ç”¨å˜é‡å†…éƒ¨ä¿å­˜äº†ä¸€ä¸ªå¯¹è±¡çš„åœ°å€ä¿¡æ¯ï¼Œè€Œè¢«finalä¿®é¥°çš„å˜é‡ä¸å¯ä»¥è¢«å†æ¬¡èµ‹å€¼ï¼Œæˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼š æ‰€ä»¥finalä»…ä»…ä¿è¯ä¸€ä¸ªå˜é‡ä¸ä¼šå†æ¬¡è¢«èµ‹å€¼ï¼Œä½†ä¸ä¿è¯å¼•ç”¨å˜é‡å¼•ç”¨çš„å¯¹è±¡å†…å®¹ä¸å‘ç”Ÿæ”¹å˜ã€‚","link":"/2020/03/12/LV3-1%EF%BC%9A%E4%BD%9C%E7%94%A8%E5%9C%A8%E7%B1%BB%E3%80%81%E5%8F%98%E9%87%8F%E3%80%81%E6%96%B9%E6%B3%95%E4%B8%8A%E7%9A%84%E5%85%B6%E5%AE%83%E4%BF%AE%E9%A5%B0%E7%AC%A6/"},{"title":"LV2-7ï¼šã€æ¡ˆä¾‹ã€‘å­¦ç”Ÿä¿¡æ¯ç®¡ç†ç³»ç»Ÿ","text":"å­¦å®Œäº†ç±»ï¼Œæˆ‘ä»¬åˆ©ç”¨ç±»ï¼Œç»“åˆç°æœ‰çš„è½¯ä»¶è®¾è®¡çš„åˆ†å±‚æ€æƒ³ï¼Œæ¥åšä¸€ä¸ªåŸºæœ¬çš„å­¦ç”Ÿä¿¡æ¯ç®¡ç†ç³»ç»Ÿï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰æ¥è§¦æ•°æ®åº“ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨æ•°ç»„æ¥åšåŸºæœ¬çš„å­˜å‚¨ï¼Œè¯¥ç³»ç»Ÿæ‹¥æœ‰çš„åŠŸèƒ½å¦‚ä¸‹ï¼š æ¬¢è¿é¡µé¢ï¼Œä»‹ç»åŠŸèƒ½ç‚¹ã€æŒ‡ä»¤ æŒ‡ä»¤1ï¼Œæ–°å¢å­¦ç”Ÿä¿¡æ¯ï¼Œè¾“å…¥å®Œæœ€åä¸€ä¸ªå­¦ç”Ÿå±æ€§åï¼Œè¾“å‡ºâ€œokï¼Œå·²å®Œæˆå½•å…¥â€çš„ä¿¡æ¯ï¼Œç„¶åå›åˆ°æ¬¢è¿é¡µ æŒ‡ä»¤2ï¼Œä¿®æ”¹å­¦ç”Ÿä¿¡æ¯ï¼Œè·Ÿ1ä¸€æ ·ï¼Œè¾“å…¥å­¦ç”Ÿidç¡®å®šéœ€è¦ä¿®æ”¹çš„å­¦ç”Ÿï¼Œé¦–å…ˆè¾“å‡ºå…¶ä¿¡æ¯ï¼Œç„¶åè¾“å…¥ä¸€ä¸ªä¸ªçš„æ–°å±æ€§å€¼ç›´åˆ°å®Œæœ€åä¸€ä¸ªå­¦ç”Ÿå±æ€§åï¼Œè¾“å‡ºâ€œokï¼Œå·²å®Œæˆä¿®æ”¹â€çš„ä¿¡æ¯ï¼Œç„¶åå›åˆ°æ¬¢è¿é¡µ æŒ‡ä»¤3ï¼Œåˆ é™¤å­¦ç”Ÿä¿¡æ¯ï¼Œè¾“å…¥å­¦ç”Ÿidï¼Œåˆ é™¤å¯¹åº”çš„å­¦ç”Ÿä¿¡æ¯ï¼Œåˆ é™¤åï¼Œè¾“å‡ºâ€œokï¼Œå·²åˆ é™¤â€ï¼Œç„¶åå›åˆ°æ¬¢è¿é¡µ æŒ‡ä»¤4ï¼Œæ ¹æ®idæŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯ï¼Œè¾“å…¥å­¦ç”Ÿidï¼Œæ‰¾åˆ°å…¶ä¿¡æ¯ï¼Œç„¶åè¾“å‡ºå…¶ä¿¡æ¯ï¼Œç„¶åå›åˆ°æ¬¢è¿é¡µ æŒ‡ä»¤5ï¼Œè¾“å‡ºæ‰€æœ‰å­¦ç”Ÿçš„ä¿¡æ¯ï¼Œæœ€å¥½ä»¥ä¸€ä¸ªè¡¨æ ¼çš„å½¢å¼å±•ç¤ºï¼Œç„¶åå›åˆ°æ¬¢è¿é¡µ æŒ‡ä»¤0ï¼Œç»ˆæ­¢ç¨‹åº é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸‹é¡¹ç›®çš„åŸºæœ¬ç»“æ„ï¼š ä¸€ã€Modelå±‚é¦–å…ˆæŠ½è±¡å¥½ä¸€ä¸ªPersonç±»æ¥åšStudentçš„çˆ¶ç±»ï¼š ä»£ç å—11234567891011121314151617181920212223242526272829303132333435363738394041424344454647package student.system.model;//è¿™é‡Œå®šä¹‰ä¸€ä¸ªçˆ¶ç±»ï¼Œå®šä¹‰äººæœ€åŸºæœ¬çš„å±æ€§ï¼Œä¸ºä»€ä¹ˆè¦æŠŠäººç‹¬ç«‹å‡ºæ¥åšçˆ¶ç±»ï¼Ÿå¦‚æœä»¥åè¿˜æœ‰è€å¸ˆç±»ï¼Œå°±ä¸ç”¨å†å†™ä¸€éä¸‹é¢çš„å±æ€§äº†å•Šï¼Œç›´æ¥ç»§æ‰¿å³å¯public class Person { //åå­— private String name; //å¹´é¾„ private int age; //æ€§åˆ«ï¼š0å¥³æ€§ï¼Œ1ç”·æ€§ private int gender; //ä½å€ private String address; //ä¸‹é¢å°±æ˜¯ç”¨æ¥è®¾ç½®å±æ€§å€¼å’Œè·å–å±æ€§å€¼çš„æ–¹æ³• public String getName() { return name; } public void setName(String name) { this.name = name; } public int getAge() { return age; } public void setAge(int age) { this.age = age; } public int getGender() { return gender; } public void setGender(int gender) { this.gender = gender; } public String getAddress() { return address; } public void setAddress(String address) { this.address = address; }} è¿™é‡Œé¢å­˜æ”¾å­¦ç”Ÿä½œä¸ºã€Œäººã€çš„åŸºæœ¬å±æ€§ã€‚ å®šä¹‰ä¸€ä¸ªç­çº§ç±»ï¼Œç”¨æ¥è¡¨ç¤ºå­¦ç”Ÿæ‰€åœ¨çš„ç­çº§ï¼Œæœ€ç»ˆå®ƒè¦å’Œå­¦ç”Ÿç±»å…³è”èµ·æ¥ï¼š ä»£ç å—2123456789101112131415161718192021222324252627package student.system.model;//ç­çº§ä¿¡æ¯ç±»public class Grade { //ç­çº§ç¼–å· private int id; //ç­çº§åç§° private String name; //ä¸‹é¢å°±æ˜¯ç”¨æ¥è®¾ç½®å±æ€§å€¼å’Œè·å–å±æ€§å€¼çš„æ–¹æ³• public int getId() { return id; } public void setId(int id) { this.id = id; } public String getName() { return name; } public void setName(String name) { this.name = name; }} æœ€åå®šä¹‰å‡ºæ¥å­¦ç”Ÿç±»ï¼š ä»£ç å—3123456789101112131415161718192021222324252627282930313233343536package student.system.model;//å­¦ç”Ÿç±»ï¼Œæœ€ç»ˆå­˜æ”¾å­¦ç”Ÿä¿¡æ¯çš„ç±»ï¼Œå­¦ç”Ÿæ˜¯äººï¼Œæ‰€ä»¥ä»–ä»¬å…·å¤‡æ‰€æœ‰äººçš„å±æ€§ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä»–ä»¬æœ‰è‡ªå·±çš„ä¸€äº›æ‹“å±•å±æ€§public class Student extends Person { //å­¦å· private int id; //å¹³å‡æˆç»© private float avg_score; //æ‰€å±ç­çº§ private Grade grade; //ä¸‹é¢å°±æ˜¯ç”¨æ¥è®¾ç½®å±æ€§å€¼å’Œè·å–å±æ€§å€¼çš„æ–¹æ³• public int getId() { return id; } public void setId(int id) { this.id = id; } public float getAvg_score() { return avg_score; } public void setAvg_score(float avg_score) { this.avg_score = avg_score; } public Grade getGrade() { return grade; } public void setGrade(Grade grade) { this.grade = grade; }} å¯ä»¥çœ‹åˆ°ï¼Œå­¦å·ã€æˆç»©è¿™äº›éƒ½æ˜¯å­¦ç”Ÿç‰¹æœ‰çš„ï¼Œåƒä»€ä¹ˆæ€§åˆ«å¹´é¾„è¿™äº›ï¼Œéƒ½æ˜¯ä½œä¸ºã€Œäººã€å…±æœ‰çš„ï¼Œä¸ºäº†è¾¾åˆ°å¤ç”¨ï¼Œæˆ‘ä»¬æŠŠå®ƒä»¬æŠ½äº†å‡ºæ¥æ”¾åˆ°Personç±»ï¼Œæ—¥åå¦‚æœéœ€è¦æ‹“å±•ä¸€ä¸ªè€å¸ˆç±»ï¼Œé‚£ä¹ˆè€å¸ˆä¹Ÿç¬¦åˆè¿™äº›ä¿¡æ¯ï¼Œç›´æ¥ç»§æ‰¿å¤ç”¨å³å¯ã€‚ äºŒã€Daoå±‚è¿™ä¸€å±‚ç”¨æ¥æ¨¡æ‹Ÿæ•°æ®åº“å­˜å‚¨ï¼Œä¸»è¦ç”¨æ¥å®ç°å¢åˆ æ”¹æŸ¥æœ€åŸºæœ¬çš„å…ƒæ“ä½œï¼š ä»£ç å—4123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778package student.system.dao;import student.system.model.Student;//è¿™ä¸ªç±»ä½äºæˆ‘ä»¬å®šä¹‰çš„daoå±‚ï¼Œdaoå±‚ä¸€èˆ¬è´Ÿè´£å’Œæ•°æ®åº“äº¤äº’è¿›è¡Œæœ€åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥æ“ä½œ//ç”±äºæˆ‘ä»¬æ²¡æœ‰æ•°æ®åº“ï¼Œå°±åœ¨daoå±‚è¿™ä¸ªç±»é‡Œå®šä¹‰ä¸€ä¸ªæ•°ç»„ç”¨æ¥ä¿å­˜studentä¿¡æ¯å§public class StudentDao { //åœ¨å®é™…çš„é¡¹ç›®é‡Œï¼Œä½ å¯ä»¥ç†è§£è¿™ä¸ªæ•°ç»„ç›¸å½“äºæŸä¸ªæ•°æ®åº“çš„studentè¡¨ private Student[] students = new Student[10]; //å‡å¦‚æ•°æ®åº“çš„å®¹é‡ä»…ä¸º10ï¼Œè¶…è¿‡è¿™ä¸ªé‡ï¼Œå°±ä¼šæŠ¥é”™ private int studentsNum = 0; //æ•°ç»„ä¸‹æ ‡ //å¢ï¼šç”¨æ¥æ·»åŠ studentä¿¡æ¯è¿›studentsé‡Œ public boolean add(Student student) { //æ¥æ”¶ä¸€ä¸ªStudentç±»å‹çš„å‚æ•°ï¼Œè¿™ä¸ªstudentå°±æ˜¯éœ€è¦addæ–¹æ³•åšå­˜å‚¨å¤„ç†çš„ if (isOverflow()) { System.out.println(\"æ•°æ®åº“å·²æ»¡ï¼Œæ·»åŠ å¤±è´¥ï¼\"); return false; } else { students[studentsNum] = student; //ä¿å­˜è¿™ä¸ªstudent studentsNum++; //ä¸ºäº†ä¾¿äºä¸‹ä¸€ä¸ªæ•°æ®çš„å­˜å‚¨ä¸”ä¸è¦†ç›–å½“å‰ä½ç½®çš„æ•°æ®ï¼Œè¿™é‡Œä¸‹æ ‡è‡ªå¢1 return true; } } //åˆ ï¼šæŒ‰ç…§å­¦ç”Ÿçš„idè¿›è¡Œåˆ é™¤è¯¥å­¦ç”Ÿä¿¡æ¯ public boolean del(int id) { //psï¼šæ•°ç»„åšåˆ é™¤æ˜¯ä»¶éå¸¸éº»çƒ¦çš„äº‹æƒ…-_-||ï¼Œè¿™é‡Œå·æ‡’äº†ï¼Œåªéœ€è¦çŸ¥é“è¯¥æ–¹æ³•å¯ä»¥å®Œæˆä¸€ä¸ªæ•°æ®çš„åˆ é™¤å³å¯ Student[] newArray = new Student[10]; int j = 0; for (int i = 0; i &lt; studentsNum; i++) { if (students[i].getId() != id) { newArray[j] = students[i]; j++; } } students = newArray; studentsNum--; //åˆ é™¤æ‰ä¸€ä¸ªæ•°æ®ï¼Œä¸‹æ ‡è‡ªå‡1 return true; } //æ”¹ï¼šæ ¹æ®è¾“å…¥çš„æ–°çš„å­¦ç”Ÿä¿¡æ¯ï¼ŒæŒ‰ç…§idæ›¿æ¢æ‰åŸå…ˆå¯¹åº”çš„å­¦ç”Ÿä¿¡æ¯ public boolean update(Student student) { boolean result = false; for (int i = 0; i &lt; studentsNum; i++) { if (students[i] != null &amp;&amp; students[i].getId() == student.getId()) { students[i] = student; result = true; break; //ç»ˆæ­¢å¾ªç¯ } } return result; } //æŸ¥ï¼šæŒ‰ç…§å­¦ç”Ÿidï¼ŒæŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯ public Student getStudentById(int id) { for (int i = 0; i &lt; studentsNum; i++) { if (students[i] != null &amp;&amp; students[i].getId() == id) { return students[i]; //æ‰¾åˆ°äº†ç›´æ¥è¿”å›å‡ºå» } } return null; //æ‰¾ä¸åˆ°å°±è¿”å›ç©ºå¯¹è±¡ } //åˆ—è¡¨ï¼šè¿”å›å½“å‰æ‰€æœ‰çš„å­¦ç”Ÿä¿¡æ¯ public Student[] getAllStudents() { Student[] nowStudents = new Student[studentsNum]; //è¿™ä¸ªæ“ä½œä¼šæŠŠstudentsé‡Œä¸‹æ ‡ä¸º0~studentsNumçš„å…ƒç´ copyç»™nowStudents System.arraycopy(students, 0, nowStudents, 0, studentsNum); return nowStudents; } //ç”¨äºå†…éƒ¨åˆ¤æ–­å½“å‰æ•°æ®åº“æ˜¯ä¸æ˜¯å·²ç»å­˜æ»¡æ•°æ®äº† private boolean isOverflow() { return studentsNum == 10; }} ä¸‰ã€Serviceå±‚è¿™ä¸€å±‚ä¸»è¦è·ŸDaoå±‚äº¤äº’ï¼Œé€šå¸¸ä¼šåˆ©ç”¨Daoå±‚é‡Œçš„å…ƒæ“ä½œæ¥å®Œæˆæ›´åŠ å¤æ‚çš„ä¸šåŠ¡æ€§è´¨çš„æ“ä½œï¼š ä»£ç å—512345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152package student.system.service;import student.system.dao.StudentDao;import student.system.model.Student;//serviceå±‚çš„ç±»ï¼Œå®ƒè§¦å‘Daoå±‚çš„åŸºæœ¬æ“ä½œçš„åŒæ—¶ï¼Œè¿˜ä¼šç”¨æ¥å¤„ç†æ›´åŠ å¤æ‚çš„ä¸šåŠ¡é€»è¾‘public class StudentService { private StudentDao studentDao = new StudentDao(); //å› ä¸ºserviceå±‚éœ€è¦åšåŸºæœ¬çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œå› æ­¤å®ƒæŒæœ‰ä¸€ä¸ªStudentDaoç±»å‹çš„å±æ€§ //è¿™ä¸ªæ–¹æ³•ç”¨æ¥è§¦å‘Daoå±‚çš„\"å¢\"æ–¹æ³• public boolean add(Student student) { if (student == null) { System.out.println(\"è¯·è¾“å…¥åˆç†çš„studentï¼\"); return false; } //ä½ ä¼šå‘ç°ä¸å°±æ˜¯ç®€å•è§¦å‘ä¸€ä¸‹Daoå±‚çš„addæ–¹æ³•å—ï¼Ÿä¸ºå•¥éœ€è¦å•ç‹¬æ‹†ä¸€ä¸ªServiceå±‚æ¥å¥—å¨ƒå‘¢ï¼Ÿå› ä¸ºæˆ‘ä¸Šé¢è§£é‡Šè¿‡äº†ï¼Œserviceæ˜¯ç”¨æ¥å¤„ç†å¤æ‚ä¸šåŠ¡é€»è¾‘çš„ //çœŸæ­£çš„serviceå±‚å¯èƒ½ä¼šå¼•å¾ˆå¤šDaoå±‚è¿›è¡Œæ··åˆæ“ä½œï¼Œæœ¬ä¾‹ä¹‹æ‰€ä»¥è¿™ä¹ˆç®€å•æ˜¯å› ä¸ºè¿™ä¸ªç³»ç»Ÿæœ¬èº«å°±å¾ˆç®€å•å•Šã€‚ã€‚ç†è§£è¿™ä¸ªç‚¹å°±å¥½~ return studentDao.add(student); } //è¿™ä¸ªæ–¹æ³•ç”¨æ¥è§¦å‘Daoå±‚çš„\"åˆ \"æ–¹æ³• public boolean del(int id) { if (id &lt;= 0) { System.out.println(\"è¯·è¾“å…¥åˆç†çš„idï¼\"); return false; } return studentDao.del(id); } //è¿™ä¸ªæ–¹æ³•ç”¨æ¥è§¦å‘Daoå±‚çš„\"æ”¹\"æ–¹æ³• public boolean update(Student student) { if (student == null) { //è¿™å—ä»£ç è·Ÿaddé‡Œçš„é‡å¤ï¼Œç†è®ºä¸Šå¯ä»¥å°è£…æˆä¸€ä¸ªç‹¬ç«‹çš„æ–¹æ³•ï¼Œä½†è¿™é‡Œæˆ‘ä»¬ä¸è¿™ä¹ˆå¹²äº†ã€‚ã€‚æ‰€ä»¥è¯´æœ‰äº›è§„åˆ™åªæ˜¯ç†æƒ³åŒ–ä¸‹ä¼šé€‰æ‹©è¿™ä¹ˆåšï¼Œä½†å®é™…å¼€å‘ä¸­å¯èƒ½å¹¶æ²¡æœ‰è¿™ä¹ˆä¸¥æ ¼ System.out.println(\"è¯·è¾“å…¥åˆç†çš„studentï¼\"); return false; } return studentDao.update(student); } //è¿™ä¸ªæ–¹æ³•ç”¨æ¥è§¦å‘Daoå±‚çš„\"æŸ¥\"æ–¹æ³• public Student getStudentById(int id) { if (id &lt;= 0) { return null; } return studentDao.getStudentById(id); } //è¿™ä¸ªæ–¹æ³•ç”¨æ¥è§¦å‘Daoå±‚çš„\"åˆ—è¡¨\"æ–¹æ³• public Student[] getAllStudents() { return studentDao.getAllStudents(); }} å››ã€Viewå±‚è¿™ä¸€å±‚è´Ÿè´£å’Œç”¨æˆ·äº¤äº’ï¼Œå°†ç”¨æˆ·è¾“å…¥çš„æŒ‡ä»¤ä¼ è¾¾ç»™Serviceï¼Œå¹¶å°†Serviceçš„å¤„ç†ç»“æœé€šçŸ¥ç»™ç”¨æˆ·ï¼Œè¿™ä¸€å±‚åœ¨ä¼ä¸šçº§è½¯ä»¶è®¾è®¡é‡Œè¢«ç§°ä¸ºè§†å›¾å±‚ï¼ˆè™½ç„¶MVCåœ¨å¾ˆå¤šåœºæ™¯ä¸‹å·²ç»â€œè¿‡æ—¶â€ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶å¯ä»¥ä»ä¸­å­¦åˆ°ä¼ä¸šçº§å¼€å‘æ—¶æ‰€éœ€è¦çš„åˆ†å±‚æ€æƒ³ï¼‰ï¼š ä»£ç å—6123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174package student.system.view;import student.system.model.Grade;import student.system.model.Student;import student.system.service.StudentService;import java.util.Scanner;//è§†å›¾å±‚ï¼Œç”¨æ¥å±•ç¤ºç»™ç”¨æˆ·çœ‹çš„public class StudentSystemView { //å› ä¸ºè§†å›¾å±‚éœ€è¦è¯·æ±‚åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œå› æ­¤å®ƒæŒæœ‰ä¸€ä¸ªStudentServiceç±»å‹çš„å±æ€§ private StudentService studentService = new StudentService(); public static void main(String[] args) { StudentSystemView view = new StudentSystemView(); while (true) { int opNum = view.home(); if (opNum == 0) { //ç»ˆæ­¢ç¨‹åº break; } else if (opNum == 1) { //éœ€è¦æ–°å¢å­¦ç”Ÿä¿¡æ¯ view.addStudent(); } else if (opNum == 2) { view.updateStudent(); } else if (opNum == 3) { view.delStudent(); } else if (opNum == 4) { view.getStudentById(); } else if (opNum == 5) { view.getAllStudents(); } else { System.out.println(\"è¯·è¾“å…¥æœ‰æ•ˆçš„æŒ‡ä»¤ï¼\"); } } } //é¦–é¡µ public int home() { System.out.println(\"+----------------------------------\"); System.out.println(\"| Så¤§å­¦-å­¦ç”Ÿä¿¡æ¯ç®¡ç†ç³»ç»Ÿ\"); System.out.println(\"+----------------------------------\"); System.out.println(\"| æŒ‡ä»¤é›†ï¼š\"); System.out.println(\"| 1.æ–°å¢\"); System.out.println(\"| 2.ä¿®æ”¹\"); System.out.println(\"| 3.åˆ é™¤\"); System.out.println(\"| 4.æŸ¥æ‰¾\"); System.out.println(\"| 5.å­¦ç”Ÿåˆ—è¡¨\"); System.out.println(\"| 0.ç»ˆæ­¢ç¨‹åº\"); System.out.println(\"+----------------------------------\"); System.out.println(\"è¯·è¾“å…¥æ‚¨çš„æ“ä½œï¼š\"); Scanner s = new Scanner(System.in); return s.nextInt(); } //æ·»åŠ å­¦ç”Ÿä¿¡æ¯ public void addStudent() { System.out.println(\"æ‚¨ç°åœ¨æ­£åœ¨æ·»åŠ ä¸€ä¸ªå­¦ç”Ÿçš„ä¿¡æ¯ï¼Œè¯·æŒ‰ç…§æŒ‡ä»¤è¾“å…¥å­¦ç”Ÿçš„å„é¡¹ä¿¡æ¯ï¼š\"); Student student = scannerStudent(); boolean result = studentService.add(student); //æœ€åæˆ‘ä»¬é€šè¿‡studentServiceå°†è¿™ä¸ªå­¦ç”Ÿä¿¡æ¯åŠ åˆ°\"æ•°æ®åº“\"é‡Œå» //æŒ‰ç…§serviceå±‚çš„å¤„ç†ç»“æœï¼Œè¾“å‡ºä¸åŒçš„æ–‡æ¡ˆ if (result) { System.out.println(\"æ•°æ®æ·»åŠ æˆåŠŸï¼\"); } else { System.out.println(\"æ•°æ®æ·»åŠ å¤±è´¥ï¼\"); } } //åˆ é™¤å­¦ç”Ÿä¿¡æ¯ public void delStudent() { System.out.println(\"æ‚¨ç°åœ¨æ­£åœ¨åˆ é™¤ä¸€ä¸ªå­¦ç”Ÿçš„ä¿¡æ¯ï¼Œè¯·è¾“å…¥éœ€è¦åˆ é™¤å­¦ç”Ÿçš„idï¼š\"); Scanner s = new Scanner(System.in); int id = s.nextInt(); boolean result = studentService.del(id); //æœ€åæˆ‘ä»¬é€šè¿‡studentServiceå°†è¿™ä¸ªå­¦ç”Ÿä¿¡æ¯åŠ åˆ°\"æ•°æ®åº“\"é‡Œå» //æŒ‰ç…§serviceå±‚çš„å¤„ç†ç»“æœï¼Œè¾“å‡ºä¸åŒçš„æ–‡æ¡ˆ if (result) { System.out.println(\"æ•°æ®åˆ é™¤æˆåŠŸï¼\"); } else { System.out.println(\"æ•°æ®åˆ é™¤å¤±è´¥ï¼\"); } } //ä¿®æ”¹å­¦ç”Ÿä¿¡æ¯ public void updateStudent() { System.out.println(\"æ‚¨ç°åœ¨æ­£åœ¨ä¿®æ”¹ä¸€ä¸ªå­¦ç”Ÿçš„ä¿¡æ¯ï¼Œè¯·æŒ‰ç…§æŒ‡ä»¤è¾“å…¥å­¦ç”Ÿçš„å„é¡¹ä¿¡æ¯ï¼š\"); Student student = scannerStudent(); boolean result = studentService.update(student); //æœ€åæˆ‘ä»¬é€šè¿‡studentServiceå°†å¯¹åº”çš„å­¦ç”Ÿä¿¡æ¯ä¿®æ”¹æ‰ //æŒ‰ç…§serviceå±‚çš„å¤„ç†ç»“æœï¼Œè¾“å‡ºä¸åŒçš„æ–‡æ¡ˆ if (result) { System.out.println(\"æ•°æ®ä¿®æ”¹æˆåŠŸï¼\"); } else { System.out.println(\"æ•°æ®ä¿®æ”¹å¤±è´¥ï¼\"); } } //æŒ‰ç…§idæŸ¥æ‰¾å­¦ç”Ÿä¿¡æ¯ public void getStudentById() { System.out.println(\"è¯·è¾“å…¥éœ€è¦æŸ¥æ‰¾å­¦ç”Ÿçš„idï¼š\"); Scanner s = new Scanner(System.in); int id = s.nextInt(); Student result = studentService.getStudentById(id); //æœ€åæˆ‘ä»¬é€šè¿‡studentServiceæŸ¥æ‰¾åˆ°å¯¹åº”çš„å­¦ç”Ÿä¿¡æ¯ //æŒ‰ç…§serviceå±‚çš„å¤„ç†ç»“æœï¼Œè¾“å‡ºä¸åŒçš„æ–‡æ¡ˆ if (result != null) { printStudentInfo(result); } else { System.out.println(\"æœªæŸ¥åˆ°å¯¹åº”æ•°æ®ï¼\"); } } //è¾“å‡ºå½“å‰\"æ•°æ®åº“\"å†…æ‰€æœ‰å­¦ç”Ÿçš„ä¿¡æ¯ public void getAllStudents() { Student[] result = studentService.getAllStudents(); //æœ€åæˆ‘ä»¬é€šè¿‡studentServiceå°†æ‰€æœ‰çš„å­¦ç”Ÿä¿¡æ¯æ‹¿åˆ° //æŒ‰ç…§serviceå±‚çš„å¤„ç†ç»“æœï¼Œè¾“å‡ºä¸åŒçš„æ–‡æ¡ˆ if (result != null) { for (Student student : result) { printStudentInfo(student); } } else { System.out.println(\"æœªæŸ¥åˆ°å¯¹åº”æ•°æ®ï¼\"); } } //ç”¨æ¥è®©ç”¨æˆ·è¾“å…¥ä¸€ä¸ªå­¦ç”Ÿçš„ä¿¡æ¯ï¼Œç”±äºä¿®æ”¹ä¿¡æ¯é‚£é‡Œä»¥åŠæ–°å¢ä¿¡æ¯é‚£é‡Œéƒ½éœ€è¦è¿™ä¸ªæ“ä½œï¼Œè€Œä¸”è¿™ä¸ªæ“ä½œä»£ç åˆå¾ˆé•¿ï¼Œå› æ­¤ä¸ºäº†å¤ç”¨è¿™å—çš„ä»£ç ï¼Œæˆ‘ä»¬æŠŠå®ƒå°è£…å‡ºæ¥ï¼Œä»¥ä¾›åˆ«äººé‡å¤ä½¿ç”¨ private Student scannerStudent() { System.out.println(\"è¯·è¾“å…¥å­¦ç”Ÿçš„idï¼š\"); Scanner s = new Scanner(System.in); int id = s.nextInt(); System.out.println(\"è¯·è¾“å…¥å­¦ç”Ÿçš„åå­—ï¼š\"); String name = s.next(); System.out.println(\"è¯·è¾“å…¥å­¦ç”Ÿçš„å¹´é¾„ï¼š\"); int age = s.nextInt(); System.out.println(\"è¯·è¾“å…¥å­¦ç”Ÿçš„æ€§åˆ«ï¼ˆ0å¥³1ç”·ï¼‰ï¼š\"); int gender = s.nextInt(); System.out.println(\"è¯·è¾“å…¥å­¦ç”Ÿçš„ä½å€ï¼š\"); String address = s.next(); System.out.println(\"è¯·è¾“å…¥å­¦ç”Ÿçš„å¹³å‡åˆ†ï¼š\"); float avgScore = s.nextFloat(); System.out.println(\"è¯·è¾“å…¥å­¦ç”Ÿæ‰€å±ç­çº§çš„idï¼š\"); int gradeId = s.nextInt(); System.out.println(\"è¯·è¾“å…¥å­¦ç”Ÿæ‰€å±ç­çº§çš„åç§°ï¼š\"); String gradeName = s.next(); //å¼€å§‹æ ¹æ®è¾“å…¥çš„ä¿¡æ¯ç»„è£…å­¦ç”Ÿå¯¹è±¡ Student student = new Student(); student.setId(id); student.setName(name); student.setAge(age); student.setGender(gender); student.setAddress(address); student.setAvg_score(avgScore); //æ„å»ºä¸€ä¸ªç­çº§ç±» Grade grade = new Grade(); grade.setId(gradeId); grade.setName(gradeName); student.setGrade(grade); //ç»™studentå¯¹è±¡é‡ŒæŒæœ‰çš„gradeå±æ€§èµ‹å€¼ return student; } //æŒ‰ç…§æŸç§æ ¼å¼æ‰“å°å‡ºæ¥ä¸€ä¸ªstudentä¿¡æ¯çš„æ–¹æ³•ï¼Œåœ¨getStudentByIdå’ŒgetAllStudentsä¸­å‡æœ‰ä½¿ç”¨ private void printStudentInfo(Student student) { System.out.println(\"id = \" + student.getId() + \"\\t name = \" + student.getName() + \"\\t age = \" + student.getAge() + \"\\t address = \" + student.getAddress() + \"\\t gender = \" + (student.getGender() == 1 ? \"ç”·\" : \"å¥³\") + \"\\t avg_score = \" + student.getAvg_score() + \"\\t address = \" + student.getAddress() + \"\\t grade_id = \" + student.getGrade().getId() + \"\\t grade_name = \" + student.getGrade().getName()); }} å…­ã€è¿è¡Œç»“æœç›´æ¥è¿è¡Œviewå±‚ä»£ç çš„mainæ–¹æ³•ï¼Œå¼€å§‹å½•å…¥å­¦ç”Ÿå¹¶å®Œæˆä¸€æ¬¡æŸ¥æ‰¾ï¼š å½•å…¥å­¦ç”Ÿä¿¡æ¯&æŸ¥æ‰¾å­¦ç”Ÿä¿¡æ¯1234567891011121314151617181920212223242526272829303132333435363738394041424344454647+----------------------------------| Så¤§å­¦-å­¦ç”Ÿä¿¡æ¯ç®¡ç†ç³»ç»Ÿ+----------------------------------| æŒ‡ä»¤é›†ï¼š| 1.æ–°å¢| 2.ä¿®æ”¹| 3.åˆ é™¤| 4.æŸ¥æ‰¾| 5.å­¦ç”Ÿåˆ—è¡¨| 0.ç»ˆæ­¢ç¨‹åº+----------------------------------è¯·è¾“å…¥æ‚¨çš„æ“ä½œï¼š1æ‚¨ç°åœ¨æ­£åœ¨æ·»åŠ ä¸€ä¸ªå­¦ç”Ÿçš„ä¿¡æ¯ï¼Œè¯·æŒ‰ç…§æŒ‡ä»¤è¾“å…¥å­¦ç”Ÿçš„å„é¡¹ä¿¡æ¯ï¼šè¯·è¾“å…¥å­¦ç”Ÿçš„idï¼š1è¯·è¾“å…¥å­¦ç”Ÿçš„åå­—ï¼šsè¯·è¾“å…¥å­¦ç”Ÿçš„å¹´é¾„ï¼š26è¯·è¾“å…¥å­¦ç”Ÿçš„æ€§åˆ«ï¼ˆ0å¥³1ç”·ï¼‰ï¼š1è¯·è¾“å…¥å­¦ç”Ÿçš„ä½å€ï¼šshanghaiè¯·è¾“å…¥å­¦ç”Ÿçš„å¹³å‡åˆ†ï¼š100è¯·è¾“å…¥å­¦ç”Ÿæ‰€å±ç­çº§çš„idï¼š1è¯·è¾“å…¥å­¦ç”Ÿæ‰€å±ç­çº§çš„åç§°ï¼š2.1æ•°æ®æ·»åŠ æˆåŠŸï¼+----------------------------------| Så¤§å­¦-å­¦ç”Ÿä¿¡æ¯ç®¡ç†ç³»ç»Ÿ+----------------------------------| æŒ‡ä»¤é›†ï¼š| 1.æ–°å¢| 2.ä¿®æ”¹| 3.åˆ é™¤| 4.æŸ¥æ‰¾| 5.å­¦ç”Ÿåˆ—è¡¨| 0.ç»ˆæ­¢ç¨‹åº+----------------------------------è¯·è¾“å…¥æ‚¨çš„æ“ä½œï¼š4è¯·è¾“å…¥éœ€è¦æŸ¥æ‰¾å­¦ç”Ÿçš„idï¼š1id = 1 name = s age = 26 address = shanghai gender = ç”· avg_score = 100.0 address = shanghai grade_id = 1 grade_name = 2.1 ä½ å¯ä»¥è‡ªå·±æ¨¡ä»¿ç€å†™ä¸€ä¸ªç±»ä¼¼è¿™ç§æŒ‡ä»¤è¾“å…¥æ–¹å¼çš„â€œxxxç®¡ç†ç³»ç»Ÿâ€ï¼Œç„¶åè‡ªå·±å¯ä»¥è¿è¡Œä¸‹ï¼Œæ„Ÿå—ä¸‹ã€‚","link":"/2020/03/12/LV2-7%EF%BC%9A%E3%80%90%E6%A1%88%E4%BE%8B%E3%80%91%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/"},{"title":"LV2-6ï¼šjavaåŸç”Ÿç±»&ç¬¬ä¸‰æ–¹åŒ…ä¾èµ–","text":"æˆªæ­¢åˆ°ç›®å‰ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†ç±»å®šä¹‰ã€ç±»çš„ç‰¹æ€§ã€å°è£…ç­‰æ¦‚å¿µï¼Œå°±ç›®å‰è€Œè¨€ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥è‡ªå®šä¹‰ä¸€äº›è‡ªå·±çš„ç±»äº†ï¼Œä½ ç”šè‡³å¯ä»¥ä»ç»§æ‰¿å¤šæ€ã€æŠ½è±¡å°è£…çš„è§’åº¦ä¸Šï¼Œæ¥è®¾è®¡ä½ çš„ç±»ã€‚ ä½†æ˜¯javaä½œä¸ºä¸€ä¸ªé«˜çº§è¯­è¨€ï¼Œå¹¶ä¸”ç¤¾åŒºä¹‹åºå¤§ï¼Œæ˜¯å…¶å®ƒè¯­è¨€æ‰€ä¸èƒ½æ¯”çš„ï¼Œæˆ‘ä»¬é™¤äº†å¯ä»¥ä½¿ç”¨è‡ªå·±å®šä¹‰çš„ç±»ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç°æˆçš„ç±»ï¼Œæ¯”å¦‚Stringï¼ŒStringå°±æ˜¯javaè‡ªå¸¦çš„ä¸€ä¸ªç±»ï¼Œå®ƒçš„å†…éƒ¨å±æ€§åŒ…å«ä¸€ä¸ªbyteæ•°ç»„ã€‚åŒæ ·çš„ï¼Œåƒåé¢è®²çš„é›†åˆç±»ï¼Œä½å›¾ç­‰æ•°æ®ç»“æ„ï¼Œéƒ½æ˜¯javaè‡ªå¸¦çš„å·¥å…·ç±»ï¼Œæˆ‘ä»¬éƒ½æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨çš„ã€‚ æŠ›å»è¿™äº›javaè‡ªå¸¦çš„ç±»ï¼Œæˆ‘ä»¬è¿˜æƒ³è¦å…¶ä»–æ›´åŠ é«˜çº§çš„åŠŸèƒ½ï¼Œå°±éœ€è¦å¼•ç¬¬ä¸‰æ–¹åŒ…äº†ï¼Œå¼•å…¥ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä»–ä»¬å®šä¹‰çš„ç±»äº†ã€‚ æ¯”å¦‚ï¼Œä½ ç°åœ¨éœ€è¦ç”¨åˆ°guavaè¿™ä¸ªç¬¬ä¸‰æ–¹åŒ…é‡Œçš„ç±»ï¼Œé‚£ä½ å°±æŠŠå®ƒä¸‹è½½ä¸‹æ¥ï¼Œå¯¼å…¥åˆ°ä½ çš„javaé¡¹ç›®é‡Œå³å¯ã€‚ https://mvnrepository.com ä¸Šé¢è¿™ä¸ªç½‘ç«™ç”¨æ¥æœç´¢å’Œä¸‹è½½ç¬¬ä¸‰æ–¹jaråŒ…ã€‚ ç„¶åæ€ä¹ˆå¯¼å…¥å‘¢ï¼Ÿ æˆ‘ä»¬ä»¥Ideaä¸ºä¾‹ï¼š ç„¶ååœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†é‡Œè¿™æ ·é€‰ï¼š ç„¶åé€‰æ‹©ä½ éœ€è¦å¯¼å…¥çš„jaræ–‡ä»¶å¯¼å…¥åç‚¹å³ä¸‹è§’çš„OKé”®å³å¯ã€‚ guavaçš„jaråŒ…é‡Œæ”¾çš„å°±æ˜¯guavaç›¸å…³çš„æ‰€æœ‰ä»£ç ï¼ˆå…¶å®æ˜¯æ‰€æœ‰ä»£ç ç¼–è¯‘åçš„å­—èŠ‚ç ï¼Œç„¶åå‹ç¼©æˆçš„jaræ–‡ä»¶ï¼‰ï¼Œä½ é¡¹ç›®é‡Œå¼•å…¥äº†ï¼Œä¾¿å¯ä»¥ä½¿ç”¨å®ƒä»¬äº†ã€‚","link":"/2020/03/12/LV2-6%EF%BC%9Ajava%E5%8E%9F%E7%94%9F%E7%B1%BB&%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8C%85%E4%BE%9D%E8%B5%96/"},{"title":"LV2-5ï¼šæ¥å£","text":"æ¥å£ï¼ˆè‹±æ–‡ï¼šInterfaceï¼‰ï¼Œåœ¨JAVAç¼–ç¨‹è¯­è¨€ä¸­æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»å‹ï¼Œæ˜¯æŠ½è±¡æ–¹æ³•çš„é›†åˆï¼Œæ¥å£é€šå¸¸ä»¥interfaceæ¥å£°æ˜ã€‚ä¸€ä¸ªç±»é€šè¿‡ç»§æ‰¿æ¥å£çš„æ–¹å¼ï¼Œä»è€Œæ¥ç»§æ‰¿æ¥å£çš„æŠ½è±¡æ–¹æ³•ã€‚æ¥å£å¹¶ä¸æ˜¯ç±»ï¼Œç¼–å†™æ¥å£çš„æ–¹å¼å’Œç±»å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯å®ƒä»¬å±äºä¸åŒçš„æ¦‚å¿µã€‚ç±»æè¿°å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ã€‚æ¥å£åˆ™åŒ…å«ç±»è¦å®ç°çš„æ–¹æ³•ã€‚é™¤éå®ç°æ¥å£çš„ç±»æ˜¯æŠ½è±¡ç±»ï¼Œå¦åˆ™è¯¥ç±»è¦å®šä¹‰æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•ã€‚æ¥å£æ— æ³•è¢«å®ä¾‹åŒ–ï¼Œä½†æ˜¯å¯ä»¥è¢«å®ç°ã€‚ä¸€ä¸ªå®ç°æ¥å£çš„ç±»ï¼Œå¿…é¡»å®ç°æ¥å£å†…æ‰€æè¿°çš„æ‰€æœ‰æ–¹æ³•ï¼Œå¦åˆ™å°±æœ‰å¿…è¦å£°æ˜ä¸ºæŠ½è±¡ç±»ã€‚ ç®€å•æ¥æ€»ç»“ä¸‹ï¼šæ¥å£ç±»ä¼¼ä¸€ä¸ªåªæœ‰æŠ½è±¡æ–¹æ³•çš„æŠ½è±¡ç±»ï¼Œå°±åƒæŠ½è±¡ç±»ä¸€æ ·ï¼Œå®ƒæ— æ³•è¢«å®ä¾‹åŒ–ï¼Œå¿…é¡»è¦æœ‰å®ç°ç±»å®ƒæ‰ä¼šæœ‰æ„ä¹‰ã€‚ ä¸€ã€æ¥å£çš„å®šä¹‰&amp;ç”¨æ³•1.1ï¼šä¾‹å­&amp;ç”¨æ³•ç”¨æœ€ç®€å•æœ€å¥½ç†è§£çš„æ–¹å¼æ¥è¯´ï¼Œæ‰€è°“æ¥å£å°±æ˜¯ä¸€ä¸ªåªæœ‰æŠ½è±¡æ–¹æ³•çš„â€æŠ½è±¡ç±»â€œï¼ˆè¿™é‡Œåªæ˜¯ç±»æ¯”ï¼Œæ¥å£ä¸æ˜¯ç±»ï¼‰ï¼Œæ¥å£è·ŸæŠ½è±¡ç±»ã€æŠ½è±¡ç±»è·Ÿæ™®é€šç±»ä¹‹é—´çš„åŒºåˆ«å’Œæ„ä¹‰ï¼Œæˆ‘ä»¬æ”¾åˆ°ç¬¬äºŒèŠ‚æ¥è®²ï¼Œè¿™é‡Œçœ‹ä¸ªæ¡ˆä¾‹ï¼š ä»£ç å—1123456789101112131415161718192021222324252627282930313233343536373839404142434445464748//é€šè¿‡interfaceå…³é”®è¯å®šä¹‰æ¥å£public interface TrafficTools { //äº¤é€šå·¥å…·æ¥å£ï¼Œç”¨æ¥æŠ½è±¡ç¬¦åˆäº¤é€šå·¥å…·æ‰€å…·å¤‡çš„ä¸€ç³»åˆ—è¡Œä¸ºæ ‡å‡† String move(); //æ‰€æœ‰çš„äº¤é€šå·¥å…·éƒ½å…·å¤‡ç§»åŠ¨è¿™ä¸€æ ‡å‡† } //ä¸‹é¢æ˜¯å®ç°äº†è¯¥æ¥å£çš„ä¸¤ç§å…·ä½“çš„äº¤é€šå·¥å…·//------------------------------------------------------------------------------------------------ //ä½¿ç”¨implementså…³é”®è¯å®ç°æ¥å£public class HighSpeedRailway implements TrafficTools { //é«˜é“æ˜¯ä¸€ç§äº¤é€šå·¥å…·ï¼Œç¬¦åˆäº¤é€šå·¥å…·æ‰€å®šä¹‰çš„æ ‡å‡† private String speed = \"306km/h\"; //é«˜é“å±æ€§ä½ å°±éšæ„æŠ½è±¡ï¼Œè¿™é‡ŒæŠ½è±¡äº†ä¸€ä¸ªå«é€Ÿåº¦çš„å±æ€§å‡ºæ¥ @Override public String move() { return \"é è¡Œèµ°åœ¨\" + railway() + \"ä¸Šçš„ç«è½¦ï¼Œä»¥\" + speed + \"çš„é€Ÿåº¦\"; } public String railway() { //é«˜é“æ˜¯èµ°åœ¨é«˜é“é“è½¨ä¸Šçš„ return \"é«˜é€Ÿè½¨é“é“è·¯\"; } public void setSpeed(String speed) { this.speed = speed; }} public class Plane implements TrafficTools { //é£æœºæ˜¯ä¸€ç§äº¤é€šå·¥å…·ï¼Œç¬¦åˆäº¤é€šå·¥å…·æ‰€å®šä¹‰çš„æ ‡å‡† private String company = \"åèˆª\"; //é£æœºå±æ€§ä½ å°±éšæ„æŠ½è±¡ï¼Œæ¯”å¦‚é£æœºå‹å·ã€åç§°ã€æ‰€å±å…¬å¸ï¼ŒæŒ‰éœ€å®šä¹‰ @Override public String move() { //å®ç°moveæ–¹æ³• return \"é \" + company + \"çš„é£æœºï¼Œä»¥\" + fly() + \"çš„æ–¹å¼\"; } public String fly() { //å…·ä½“çš„ç§»åŠ¨æ–¹å¼ï¼Œé£æœºå½“ç„¶æ˜¯é é£äº† return \"é£è¡Œ\"; } public void setCompany(String company) { this.company = company; }} æ¥å£ä¸å…è®¸æœ‰å±æ€§ï¼Œå¯ä»¥ç®€å•ç†è§£æ¥å£æ˜¯å®šä¹‰ä¸€ç³»åˆ—åŠ¨ä½œï¼ˆå³æ–¹æ³•ï¼‰çš„æ ‡å‡†ï¼Œä»»æ„ç¬¦åˆè¿™ä¸ªæ ‡å‡†çš„ç±»éƒ½å¯ä»¥å®ç°è¿™ä¸ªæ¥å£ï¼Œæ¯”å¦‚ä¾‹å­ä¸­çš„é£æœºå’Œé«˜é“ç±»ï¼Œéƒ½å¯ä»¥å®ç°TrafficToolsæ¥å£ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯äº¤é€šå·¥å…·ï¼Œéƒ½æœ‰moveè¿™ä¸€åŸºæœ¬æ ‡å‡†ã€‚ç°åœ¨å®šä¹‰å¥½äº†äº¤é€šå·¥å…·ï¼Œè®©æˆ‘ä»¬å†å®šä¹‰æ—…æ¸¸ç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼ŒæŠ½è±¡å‡ºæ¥äº†æ—…è¡Œæ‰€å…·å¤‡çš„å±æ€§å’Œæ–¹æ³•ï¼š ä»£ç å—2123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869public abstract class Tour { private String start; //å‡ºå‘ç‚¹ private String end; //ç»ˆç‚¹ private String name; //ä¸»è§’ä»¬çš„åå­— private TrafficTools tools; //æ—…è¡Œéœ€è¦ä¸€ç§äº¤é€šå·¥å…· public abstract String kind(); //æ—…è¡Œæ–¹å¼ï¼Œè¿™ä¸ªéœ€è¦å­ç±»å»å®ç°ï¼Œæ—…æ¸¸ç§ç±»ï¼šåº¦å‡ã€èœœæœˆã€æ¢äº²ç­‰ public abstract String play(); //ç©äº†ä»€ä¹ˆï¼ŸåŒæ ·æ—…è¡Œç±»æ— æ³•å®ç°ï¼Œåªèƒ½é å­ç±»å»å®ç° public String getTour() { //è¾“å‡ºå¯¹è¿™æ¬¡æ—…è¡Œçš„æè¿° return kind() + tools.move() + \"ï¼Œä»\" + start + \"å‡ºå‘ï¼ŒæŠµè¾¾\" + end + play(); } //å±æ€§çš„è®¾ç½®æ–¹æ³• public void setStart(String start) { this.start = start; } public void setEnd(String end) { this.end = end; } public void setName(String name) { this.name = name; } public String getName() { return name; } public void setTools(TrafficTools tools) { this.tools = tools; }} //ä¸‹é¢æ˜¯ä¸¤ä¸ªå®ç°äº†æ—…è¡Œç±»çš„å­ç±»ï¼Œåˆ†åˆ«ä»£è¡¨ç€ä¸åŒçš„æ—…è¡Œç±»å‹//----------------------------------------------------------------------------------------------------------------public class AloneTour extends Tour { //ä¸ªäººæ—…è¡Œæ˜¯æ—…è¡Œçš„ä¸€ç§ @Override public String kind() { return super.getName() + \"çš„ä¸ªäººæ—…è¡Œ\"; } @Override public String play() { return \"å®Œæˆäº†è‡ªå·±çš„ä¸ªäººæ—…è¡Œï¼Œé¡ºä¾¿ä¿®äº†ä¸ªä»™å„¿~\"; }} public class HoneyMoonTour extends Tour { //èœœæœˆæ—…è¡Œæ˜¯æ—…è¡Œçš„ä¸€ç§ @Override public String kind() { return super.getName() + \"çš„èœœæœˆæ—…è¡Œ\"; } @Override public String play() { return \"ç©äº†ä¸“ä¸ºæƒ…ä¾£å‡†å¤‡çš„èœœæœˆé¡¹ç›®\"; }} è®©æˆ‘ä»¬æ¥å…·ä½“æµ‹è¯•ä¸‹ï¼š ä»£ç å—312345678910111213141516171819public static void main(String[] args) { Tour myAloneTour = new AloneTour(); //æ‰“ç®—å¼€å§‹ä¸€æ¬¡ä¸ªäººæ—…è¡Œ myAloneTour.setStart(\"ä¸œäº¬éƒ½\"); //å§‹å‘åœ° myAloneTour.setEnd(\"é›è§æ³½\"); //ç›®çš„åœ° myAloneTour.setName(\"å‰åŸåœ­ä¸€\"); //éœ€è¦è¿›è¡Œè¿™æ¬¡æ—…è¡Œçš„ä¸»è§’åå­— //é€‰æ‹©ä¸€ç§äº¤é€šå·¥å…· TrafficTools tools = new HighSpeedRailway(); //é€‰æ‹©é«˜é“ï¼ˆå¯ä»¥çœ‹åˆ°ï¼Œæ¥å£ç±»çš„å¼•ç”¨å˜é‡ä¹Ÿå¯ä»¥æ¥æ”¶è‡ªå·±å®ç°ç±»çš„å¯¹è±¡å®ä¾‹ï¼‰ myAloneTour.setTools(tools); System.out.println(myAloneTour.getTour()); //è¾“å‡ºè¿™æ¬¡æ—…è¡Œçš„å†…å®¹ Tour hmTour = new HoneyMoonTour(); //æ‰“ç®—å¼€å§‹ä¸€åœºèœœæœˆæ—…è¡Œ hmTour.setStart(\"æœ¨å¶å¿è€…æ‘\"); //å§‹å‘åœ° hmTour.setEnd(\"æ¶¡ã®å›½\"); //ç›®çš„åœ° hmTour.setName(\"æ¼©æ¶¡é¸£äºº&amp;æ—¥å‘é›ç”°\"); //éœ€è¦è¿›è¡Œè¿™æ¬¡æ—…è¡Œçš„ä¸»è§’åå­— //é€‰æ‹©ä¸€ç§äº¤é€šå·¥å…· TrafficTools tools2 = new Plane(); //é€‰æ‹©é£æœº hmTour.setTools(tools2); System.out.println(hmTour.getTour()); //è¾“å‡ºè¿™æ¬¡æ—…è¡Œçš„å†…å®¹} ä¸Šæ–¹ä»£ç è¾“å‡ºå¦‚ä¸‹ï¼š ä»£ç å—412å‰åŸåœ­ä¸€çš„ä¸ªäººæ—…è¡Œé è¡Œèµ°åœ¨é«˜é€Ÿè½¨é“é“è·¯ä¸Šçš„ç«è½¦ï¼Œä»¥306km/hçš„é€Ÿåº¦ï¼Œä»ä¸œäº¬éƒ½å‡ºå‘ï¼ŒæŠµè¾¾é›è§æ³½å®Œæˆäº†è‡ªå·±çš„ä¸ªäººæ—…è¡Œï¼Œé¡ºä¾¿ä¿®äº†ä¸ªä»™å„¿~æ¼©æ¶¡é¸£äºº&amp;æ—¥å‘é›ç”°çš„èœœæœˆæ—…è¡Œé åèˆªçš„é£æœºï¼Œä»¥é£è¡Œçš„æ–¹å¼ï¼Œä»æœ¨å¶å¿è€…æ‘å‡ºå‘ï¼ŒæŠµè¾¾æ¶¡ã®å›½ç©äº†ä¸“ä¸ºæƒ…ä¾£å‡†å¤‡çš„èœœæœˆé¡¹ç›® çœ‹å®Œæœ¬ä¾‹ï¼Œä½ å¯ä»¥äº†è§£æ¥å£çš„åŸºæœ¬ç”¨æ³•ã€‚ éå¸¸é‡è¦çš„ä¸€ç‚¹ï¼šæ¥å£æ”¯æŒå¤šç»§æ‰¿ï¼Œä¸€ä¸ªç±»å¯ä»¥åŒæ—¶å®ç°å¤šä¸ªæ¥å£ ä¸¾ä¸ªéå¸¸ç®€å•çš„ä¾‹å­ï¼š ä»£ç å—5123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990public interface A { void a(); } public interface B { void b(); } public interface C extends A, B { //æ¥å£çš„å¤šç»§æ‰¿ï¼Œè¿™æ—¶å¦‚æœä¸€ä¸ªç±»è¦æƒ³å®ç°Cï¼Œåˆ™éœ€è¦åŒæ—¶å®ç°ABCé‡Œçš„æ–¹æ³• void c(); } public interface D { void d(); } public class E implements C, D { //ä¸€ä¸ªç±»å¯ä»¥åŒæ—¶å®ç°å¤šä¸ªæ¥å£ï¼Œæ¥å£é‡Œæ‰€æœ‰çš„æ–¹æ³•å‡éœ€è¦å®ç° @Override public void c() { } @Override public void a() { } @Override public void b() { } @Override public void d() { }} public abstract class F implements C, D { //åŒæ ·çš„ï¼ŒæŠ½è±¡ç±»ä¹Ÿå¯ä»¥åŒæ—¶å®ç°å¤šä¸ªæ¥å£ï¼Œä½†ç”±äºæŠ½è±¡ç±»çš„ç‰¹æ€§ï¼Œå®ƒå¯ä»¥ä¸ç”¨å®ç°æ¥å£é‡Œçš„æ–¹æ³•ï¼Œå…¨å‘˜å«ç»™å®ƒçš„å­ç±»å»åšï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å®ç°ï¼Œå¦‚ä¸‹æ–¹cæ–¹æ³• abstract void f(); void f2() { } @Override public void c() { }} public class G extends F { //ç»§æ‰¿äº†ä¸Šæ–¹æŠ½è±¡ç±»çš„å­ç±»ï¼Œéœ€è¦åŒæ—¶å®ç°çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•fä»¥åŠçˆ¶ç±»ç»§æ‰¿äº†çš„æ¥å£ä¸”æ²¡æœ‰è¿›è¡Œå®ç°çš„æ–¹æ³• @Override void f() { } @Override public void a() { } @Override public void b() { } @Override public void d() { }} æ¥å£ã€æŠ½è±¡ç±»ã€ç±»ä¹‹é—´çš„å…³ç³»ä¸ç®¡ä¾èµ–å¤šä¹ˆå¤æ‚ï¼Œå½“æ–¹æ³•å‘ç”Ÿè°ƒç”¨æ—¶ï¼Œå‡éµå¾ªä¸Šä¸€ç« èŠ‚è®²çš„â€å°±è¿‘è°ƒç”¨â€œè§„åˆ™ã€‚ 1.2ï¼šæ¥å£ä¸ç±»ç›¸ä¼¼ç‚¹ ä¸€ä¸ªæ¥å£å¯ä»¥æœ‰å¤šä¸ªæ–¹æ³•ã€‚ æ¥å£æ–‡ä»¶ä¿å­˜åœ¨.javaç»“å°¾çš„æ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶åä½¿ç”¨æ¥å£åã€‚ æ¥å£çš„å­—èŠ‚ç æ–‡ä»¶ä¿å­˜åœ¨.classç»“å°¾çš„æ–‡ä»¶ä¸­ã€‚ æ¥å£ç›¸åº”çš„å­—èŠ‚ç æ–‡ä»¶å¿…é¡»åœ¨ä¸åŒ…åç§°ç›¸åŒ¹é…çš„ç›®å½•ç»“æ„ä¸­ã€‚ 1.3ï¼šæ¥å£ä¸ç±»çš„åŒºåˆ« æ¥å£ä¸èƒ½ç”¨äºå®ä¾‹åŒ–å¯¹è±¡ã€‚ æ¥å£æ²¡æœ‰æ„é€ æ–¹æ³•ã€‚ æ¥å£ä¸­æ‰€æœ‰çš„æ–¹æ³•å¿…é¡»æ˜¯æŠ½è±¡æ–¹æ³•ã€‚ æ¥å£ä¸èƒ½åŒ…å«æˆå‘˜å˜é‡ï¼Œé™¤äº†staticå’Œfinalå˜é‡ã€‚ æ¥å£ä¸æ˜¯è¢«ç±»ç»§æ‰¿äº†ï¼Œè€Œæ˜¯è¦è¢«ç±»å®ç°ã€‚ æ¥å£æ”¯æŒå¤šç»§æ‰¿ã€‚ äºŒã€ç±»ã€æŠ½è±¡ç±»ã€æ¥å£ä¹‹é—´çš„åŒºåˆ«åœ¨javaçš„ä¸–ç•Œé‡Œï¼Œä¸€åˆ‡çš†å¯¹è±¡ï¼Œè€Œå¯¹è±¡åˆæ˜¯æ ¹æ®ç±»çš„æ¨¡æ¿ç”Ÿæˆçš„ç¬¦åˆç±»å®šä¹‰çš„ä¸€ä¸ªä¸ªä½“ï¼Œæ‰€ä»¥ç±»æ˜¯å¯¹ä¸€ç±»äº‹ç‰©çš„å…·ä½“æŠ½è±¡ã€‚ æŠ½è±¡ç±»æ— æ³•è¢«å®ä¾‹åŒ–ï¼Œå®ƒæ˜¯ä¸ºæ™®é€šç±»æœåŠ¡çš„ï¼Œç®€å•æ¥è¯´ï¼Œæ™®é€šç±»ç”¨æ¥æŠ½è±¡çœŸå®å­˜åœ¨çš„äº‹ç‰©ï¼Œç»™å®ƒä»¬åˆ†ç±»ï¼ˆçŒ«ã€ç‹—ã€æ•°æ®åº“å¯¹è±¡ç­‰ï¼‰ï¼Œè€ŒæŠ½è±¡ç±»æ˜¯ä½äºæ™®é€šç±»ä¸Šå±‚çš„ç”¨æ¥ç»™ç±»åˆ†ç±»çš„ï¼Œæ¯”å¦‚çŒ«ç‹—ï¼Œéƒ½å¯ä»¥æ‹†åˆ†æˆçŒ«ç±»ï¼Œç‹—ç±»ï¼Œä½†æ˜¯çŒ«å’Œç‹—å…·æœ‰ç›¸åŒæ„ä¹‰çš„å±æ€§å’Œæ–¹æ³•ï¼Œä¾‹å¦‚å¹´é¾„ã€åƒé¥­ç¡è§‰ç­‰ï¼Œè¿™äº›å°±å¯ä»¥å†æ¬¡è¢«åˆ†ç±»ï¼Œæˆä¸ºçŒ«å’Œç‹—çš„çˆ¶ç±»ï¼Œæ¯”å¦‚åŠ¨ç‰©ï¼Œä½ ä¼šå‘ç°ä¸å…‰çŒ«ç‹—å…·å¤‡è¿™äº›è¢«æŠ½è±¡å‡ºæ¥çš„å±æ€§å’Œæ–¹æ³•ï¼Œæ—¥åå¦‚æœå®šä¹‰ä¸€ä¸ªäººç±»ï¼ŒåŒæ ·ä¹Ÿæ˜¯ç¬¦åˆçš„ï¼ŒæŠ½è±¡ç±»å°±æ˜¯ä¸ºç±»åˆ†ç±»è€Œç”Ÿçš„ï¼Œå®ƒå¿…é¡»è¦æœ‰å­ç±»ç»§æ‰¿æ‰æœ‰æ„ä¹‰ï¼ŒæŠ½è±¡ç±»å¯ä»¥è‡ªå·±å®šä¹‰æ–¹æ³•çš„å®ç°ï¼Œä¹Ÿå¯ä»¥æŠŠä¸€äº›æ–¹æ³•å…¨éƒ¨äº¤ç»™å­ç±»å»å®ç°ï¼Œå¦‚æœä¸€ä¸ªæŠ½è±¡ç±»é‡Œå¹¶ä¸å­˜åœ¨è¢«æŠ½è±¡å‡ºæ¥çš„å±æ€§ï¼Œåªæœ‰ä¸€äº›è¡Œä¸ºè§„èŒƒï¼Œè€Œä¸”è¿™äº›è¡Œä¸ºè§„èŒƒæŠ½è±¡ç±»è‡ªå·±å®ç°æ²¡æœ‰æ„ä¹‰ï¼Œåªèƒ½äº¤ç»™å­ç±»å»å®ç°ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥å°†æŠ½è±¡ç±»é‡Œçš„æ–¹æ³•å…¨éƒ¨å®šä¹‰æˆæŠ½è±¡æ–¹æ³•ï¼ˆç°åœ¨å¾ˆåƒæ¥å£äº†å¯¹å§ï¼‰ï¼Œè€Œæ¥å£å°±æ˜¯è¿™ç§ä½äºä¸Šå±‚é‡Œä»…å®šä¹‰è¡Œä¸ºè§„èŒƒçš„ä¸€ç§ç»“æ„ã€‚","link":"/2020/03/12/LV2-5%EF%BC%9A%E6%8E%A5%E5%8F%A3/"},{"title":"LV2-4ï¼šç±»çš„ç‰¹æ€§ã€å…³ç³»","text":"ä¸€ã€ç»§æ‰¿å’Œå¤šæ€1.1ï¼šä¸€ä¸ªä¾‹å­å‚è€ƒä¹‹å‰çš„Catç±»ï¼Œå¦‚æœæˆ‘ç°åœ¨è®©ä½ è®¾è®¡ä¸€ä¸ªDogç±»ï¼Œå®ƒä»ç„¶å…·å¤‡çœ¼ç›ã€æ€§åˆ«ç­‰å±æ€§ï¼Œä¹Ÿä¼šè·‘ã€åƒç­‰åŠ¨ä½œï¼Œè¿™ä¸ªæ—¶å€™ä½ ä¸€å®šä¼šå‘ç°ï¼Œå•ç‹¬å†ä¸ºDogæä¸€å¥—è·ŸCatå·®ä¸å¤šçš„ç±»å®šä¹‰å—ï¼Ÿå°±æ²¡æœ‰æ›´èªæ˜çš„åŠæ³•å—ï¼Ÿ æ­¤æ—¶javaé‡Œå…è®¸çš„ç±»ç»§æ‰¿å°±å¯ä»¥èµ·åˆ°ä½œç”¨äº†ï¼Œæƒ³æƒ³æˆ‘ä»¬çš„ç›®æ ‡ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è®©è¿™äº›é‡å¤çš„å±æ€§ä¸å†é‡å¤å®šä¹‰ä¸€éï¼Œé‚£ä¹ˆåƒçœ¼ç›ã€æ¯›è‰²è¿™ç§å±æ€§ï¼Œæˆ–è€…è·‘ã€åƒé¥­è¿™ç±»çš„æ“ä½œå°±å¯ä»¥å†æ‹†å‡ºä¸€ä¸ªç±»ï¼šåŠ¨ç‰©ç±» ç°åœ¨æˆ‘ä»¬æ¥å®šä¹‰ä¸‹åŠ¨ç‰©ç±»ï¼š ä»£ç å—1123456789101112131415161718192021222324public class Animal { private String name = \"xx\"; //åŠ¨ç‰©å­¦åï¼ŒåŠ¨ç‰©ä»¬éƒ½æœ‰å­¦åï¼Œè¿™é‡Œé»˜è®¤ä¸ºxxï¼Œå› ä¸ºåŠ¨ç‰©ç±»æ˜¯ç”¨æ¥æè¿°åŠ¨ç‰©çš„ï¼ŒåŠ¨ç‰©æœ‰å­¦åï¼Œä½†ä½ å¹¶ä¸çŸ¥é“æ˜¯é‚£ç§åŠ¨ç‰©ï¼Œnameåªèƒ½æœªçŸ¥ private int age; //åŠ¨ç‰©ä»¬çš„å¹´é¾„ public void cry() { //æ§åˆ¶å«å£°çš„æ–¹æ³• System.out.println(\"å«å£°ä¸ºï¼šæœªçŸ¥\"); } public void eat() { //è´Ÿè´£åƒé¥­çš„æ–¹æ³• System.out.println(name + \"æ­£åœ¨åƒä¸œè¥¿\"); } //ç”¨æ¥ç»™nameèµ‹å€¼çš„æ–¹æ³• public void setName(String name) { this.name = name; } //ç”¨æ¥ç»™ageèµ‹å€¼çš„æ–¹æ³• public void setAge(int age) { this.age = age; } } ç„¶åå†å®šä¹‰ä¸€ä¸‹Catå’ŒDogç±»ï¼š ä»£ç å—2123public class Cat extends Animal { //è®©Catç±»ç»§æ‰¿Animalç±» } ä»£ç å—3123public class Dog extends Animal { //è®©Dogç±»ç»§æ‰¿Animalç±» } Catå’ŒDogéƒ½æ˜¯ä¸€ä¸ªâ€ç©ºâ€œç±»ï¼Œä½†æ˜¯åˆ†åˆ«åˆ©ç”¨extendså…³é”®è¯ç»§æ‰¿äº†Animalç±»ï¼Œç°åœ¨è®©æˆ‘ä»¬è¿›è¡Œå¦‚ä¸‹æµ‹è¯•ï¼š ä»£ç å—412345678910111213141516171819202122232425public static void main(String[] args) { //é€ ä¸€åª9å²çš„çŒ« Cat cat = new Cat(); cat.setAge(9); cat.setName(\"çŒ«\"); //è®©è¿™åªçŒ«å«ä¸€å£°ï¼Œå†åƒä¸€å£ä¸œè¥¿ cat.cry(); cat.eat(); //é€ ä¸€åª10å²çš„ç‹— Dog dog = new Dog(); dog.setAge(10); dog.setName(\"ç‹—\"); //è®©è¿™åªç‹—å«ä¸€å£°ï¼Œå†åƒä¸€å£ä¸œè¥¿ dog.cry(); dog.eat(); //é€ ä¸€åª10å²çš„ç‹—ï¼Œä½†ä¸è®¾ç½®å­¦å Dog dog2 = new Dog(); dog2.setAge(10); //è®©è¿™åªç‹—å«ä¸€å£°ï¼Œå†åƒä¸€å£ä¸œè¥¿ dog2.cry(); dog2.eat();} ä¸Šè¿°ç¨‹åºè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š ä»£ç å—5123456å«å£°ä¸ºï¼šæœªçŸ¥çŒ«æ­£åœ¨åƒä¸œè¥¿å«å£°ä¸ºï¼šæœªçŸ¥ç‹—æ­£åœ¨åƒä¸œè¥¿å«å£°ä¸ºï¼šæœªçŸ¥xxæ­£åœ¨åƒä¸œè¥¿ å¯ä»¥çœ‹åˆ°ï¼ŒCatå’ŒDogè™½ç„¶å•¥éƒ½æ²¡å®šä¹‰ï¼Œä½†ä»ç„¶å¯ä»¥ä½¿ç”¨Animalç±»é‡Œçš„æ–¹æ³•ï¼Œæˆ‘ä»¬æ­¤æ—¶ç®¡Catå’ŒDogå«åšAnimalçš„å­ç±»ï¼Œç›¸åçš„Animalå«åšCatå’ŒDogçš„çˆ¶ç±»ã€‚ å¯ä»¥é€šè¿‡è¿™ä¸ªä¾‹å­å‘ç°ï¼Œå­ç±»é€šè¿‡ç»§æ‰¿ï¼Œå¯ä»¥å¾—åˆ°çˆ¶ç±»çš„ä¸€äº›åŠŸèƒ½ï¼Œéœ€è¦ç¡®è®¤çš„ä¸€ä¸ªç‚¹æ˜¯ï¼šåœ¨åˆå§‹åŒ–å®Œæˆä¸€ä¸ªå­ç±»åˆå§‹åŒ–çš„åŒæ—¶å…¶çˆ¶ç±»ä¿¡æ¯ä¹Ÿä¼šè‡ªåŠ¨åŠ è½½è¿›å­ç±»ï¼Œç„¶åå­ç±»å¯ä»¥å…±äº«çˆ¶ç±»é‡Œçš„æ–¹æ³•å’Œå±æ€§ã€‚ è¿™é‡Œè¯´ä¸€ä¸‹thiså…³é”®è¯ï¼Œå®ƒè¡¨ç¤ºçš„æ˜¯æœ¬ç±»æ‰€äº§ç”Ÿçš„å…·ä½“å¯¹è±¡å¯¹å…¶å†…éƒ¨å†…å®¹åšè®¿é—®æ—¶ç”¨çš„ä¸€ä¸ªæ ‡è¯†ï¼Œä½ ç”šè‡³å¯ä»¥çœç•¥ä¸å†™ã€‚ 1.2ï¼šçˆ¶ç±»æ–¹æ³•è¦†ç›–é€šè¿‡ä¸Šé¢çš„è¾“å‡ºï¼Œæˆ‘ä»¬å‘ç°ï¼ŒçŒ«ç‹—çš„cryæ–¹æ³•è¾“å‡ºçš„æ˜¯Animalé»˜è®¤çš„å†…å®¹ï¼Œè¿™æ—¶æˆ‘ä»¬éœ€è¦çŒ«å’Œç‹—èƒ½æœ‰è‡ªå·±çš„å«å£°ï¼Œé‚£ä¹ˆè¿™æ—¶å°±å¯ä»¥é€‰æ‹©é‡å†™çˆ¶ç±»çš„æ–¹æ³•ï¼š Catç±»é‡å†™çˆ¶ç±»çš„cryæ–¹æ³•ï¼š ä»£ç å—61234567public class Cat extends Animal { @Override //åŠ ä¸Š@Overrideæ ‡è¯†ä¸ºæ–¹æ³•é‡å†™ public void cry() { System.out.println(\"å–µå–µå–µ~\"); //è¿™é‡Œé‡æ–°å®šä¹‰æ–¹æ³•çš„å®ç° }} Dogç±»é‡å†™çˆ¶ç±»cryæ–¹æ³•ï¼š ä»£ç å—712345678public class Dog extends Animal { @Override public void cry() { System.out.println(\"æ±ªæ±ªæ±ª~\"); } } ç°åœ¨å†è¿è¡Œä¸‹æµ‹è¯•ä»£ç è¾“å‡ºå¦‚ä¸‹ï¼š ä»£ç å—81234å–µå–µå–µ~çŒ«æ­£åœ¨åƒä¸œè¥¿æ±ªæ±ªæ±ª~ç‹—æ­£åœ¨åƒä¸œè¥¿ é€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå¦‚æœå­ç±»ä¸æƒ³è¦çˆ¶ç±»é‡Œçš„å®ç°ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡é‡å†™çš„æ–¹å¼é‡æ–°è®¾è®¡å¯¹åº”çš„æ–¹æ³•ï¼Œä¾‹å­ä¸­é€šè¿‡é‡å†™cryæ–¹æ³•ï¼Œè®©Catå’ŒDogéƒ½æ‹¥æœ‰äº†è‡ªå·±çš„cryæ–¹æ³•ã€‚ 1.3ï¼šå­ç±»æ–¹æ³•æ‰©å±•ç»è¿‡ä¸Šé¢ä¸€æ­¥ï¼Œæˆ‘ä»¬çŸ¥é“çŒ«å’Œç‹—éƒ½æ˜¯åŠ¨ç‰©ï¼Œæ‰€ä»¥å®ƒä»¬ç¦»ä¸å¼€åŠ¨ç‰©ç±»é‡Œå®šä¹‰çš„å±æ€§å’Œæ–¹æ³•ï¼Œä½†æ˜¯çŒ«å’Œç‹—ä»å­˜åœ¨ä¸€äº›ä¸å¤ªä¸€æ ·çš„åœ°æ–¹ï¼Œæ¯”å¦‚çŒ«å…·æœ‰æ•é¼ çš„èƒ½åŠ›ï¼Œä½†ä¸å…·å¤‡çœ‹å®¶çš„èƒ½åŠ›ï¼Œè€Œç‹—å…·æœ‰çœ‹å®¶èƒ½åŠ›ï¼Œå´æ²¡æœ‰æ•é¼ çš„èƒ½åŠ›ï¼Œè¿™ç§ç›¸å¯¹æ¯”è¾ƒç‹¬ç«‹çš„èƒ½åŠ›å°±å¯ä»¥ç”¨æ¥æ‰©å±•ï¼š Catç±»æ–°å¢æ•é¼ æ–¹æ³• ä»£ç å—9123456789101112public class Cat extends Animal { @Override //åŠ ä¸Š@Overrideæ ‡è¯†ä¸ºæ–¹æ³•é‡å†™ public void cry() { System.out.println(\"å–µå–µå–µ~\"); //è¿™é‡Œé‡æ–°å®šä¹‰æ–¹æ³•çš„å®ç° } public void catchMice() { //æ‰©å±•æ–¹æ³•ï¼šæ•é¼  System.out.println(\"æˆ‘ä¼šæ‰è€é¼ \"); } } Dogç±»æ–°å¢çœ‹å®¶æ–¹æ³•ï¼š ä»£ç å—10123456789101112public class Dog extends Animal { @Override public void cry() { System.out.println(\"æ±ªæ±ªæ±ª~\"); } public void houseKeeping() { //æ‰©å±•æ–¹æ³•ï¼šçœ‹å®¶ System.out.println(\"æˆ‘ä¼šçœ‹å®¶\"); }} é€šè¿‡æœ¬ä¾‹æˆ‘ä»¬çŸ¥é“ï¼Œå­ç±»æ˜¯å¯ä»¥è‡ªç”±æ‰©å±•çš„ï¼Œé€šè¿‡å­ç±»çš„å¼•ç”¨å˜é‡ä¾ç„¶å¯ä»¥å®Œæˆè°ƒç”¨ï¼š ä»£ç å—1112345678public static void main(String[] args) { Cat cat = new Cat(); cat.catchMice(); Dog dog = new Dog(); dog.houseKeeping();} è¾“å‡ºï¼š ä»£ç å—1212æˆ‘ä¼šæ‰è€é¼ æˆ‘ä¼šçœ‹å®¶ 1.4ï¼šå¤šæ€ç°åœ¨æ¥ä»‹ç»ä¸‹å¤šæ€ï¼Œå¤šæ€æ˜¯ä¸€ç§ç±»å’Œç±»ä¹‹é—´çš„ä¸€ç§å¼•ç”¨å…³ç³»ï¼Œå› ä¸ºæœ‰äº†ç»§æ‰¿ï¼Œæ‰æœ‰äº†å¤šæ€è¿™ç§ç‰¹æ€§ï¼Œæˆ‘ä»¬ç°åœ¨æ¥æ”¹é€ ä¸‹ä»£ç å—4ï¼š ä»£ç å—131234567891011121314151617public static void main(String[] args) { Animal cat = new Cat(); //å£°æ˜å˜é‡æ—¶ï¼Œæ”¹æˆçˆ¶ç±»ç±»å‹ cat.setAge(9); cat.setName(\"çŒ«\"); cat.cry(); cat.eat(); Animal dog = new Dog(); //å£°æ˜å˜é‡æ—¶ï¼Œæ”¹æˆçˆ¶ç±»ç±»å‹ dog.setAge(10); dog.setName(\"ç‹—\"); dog.cry(); dog.eat(); } è¿è¡Œå¦‚ä¸‹ï¼š ä»£ç å—141234å–µå–µå–µ~çŒ«æ­£åœ¨åƒä¸œè¥¿æ±ªæ±ªæ±ª~ç‹—æ­£åœ¨åƒä¸œè¥¿ ä»ç„¶å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œå¹¶ä¸”è¢«é‡å†™çš„æ–¹æ³•cryä»ç„¶æ‰§è¡Œçš„æ˜¯å­ç±»é‡Œçš„é‚£ä¸ªã€‚ è¿™å°±æ˜¯å¤šæ€ï¼Œå¦‚æœä¸å¤ªå¥½ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹å›¾æ¥åŠ æ·±ä¸€ä¸‹è®°å¿†ï¼š è¿™ç§ä½¿ç”¨çˆ¶ç±»ä¿®é¥°çš„å¼•ç”¨å˜é‡ï¼Œå¯ä»¥æŒ‡å‘å…¶ä»»æ„å­ç±»å¯¹è±¡çš„è¡Œä¸ºï¼Œæˆ‘ä»¬ç§°ä¸ºç±»çš„å¤šæ€ï¼Œå¯ä»¥å‘ç°çˆ¶ç±»æ¥æ”¶çš„å­ç±»å¯¹è±¡æ— æ³•è®¿é—®æ‰©å±•å†…å®¹ï¼Œä½†ä»ç„¶å¯ä»¥è®¿é—®çˆ¶ç±»æ‰€å…·å¤‡çš„å†…å®¹ï¼Œå“ªæ€•è¢«é‡å†™çš„æ–¹æ³•cryï¼Œä½†è¿™æ—¶ç”±äºçˆ¶ç±»æŒ‡å‘çš„è¿˜æ˜¯å­ç±»å¯¹è±¡ï¼Œå› æ­¤æ‰€è§¦å‘çš„å†…å®¹å‡å±äºå­ç±»ï¼Œè¿™é‡Œå…ˆä¸æ¢è®¨å¤šæ€çš„å¥½å¤„ï¼Œä½ åªéœ€è¦åŠ æ·±å¯¹ä»£ç å—13å’Œå›¾1çš„ç†è§£ç±»çš„è¿™ç§ç‰¹æ€§å³å¯ã€‚ â“ ç–‘é—®ç‚¹1ï¼šä¸ºä»€ä¹ˆé€šè¿‡Animalçš„å¼•ç”¨å˜é‡æŒ‡å‘çš„Catå¯¹è±¡ï¼Œæ— æ³•è°ƒç”¨å…¶catchMiceæ–¹æ³•ï¼Ÿä¸ºä»€ä¹ˆcryæ–¹æ³•å¯ä»¥è°ƒç”¨è§¦å‘çš„å´æ˜¯Caté‡Œçš„cryæ–¹æ³•ï¼Ÿ 1.5ï¼šå¦‚ä½•ç›´æ¥è®¿é—®çˆ¶ç±»çš„å†…å®¹ï¼Ÿ1.5.1ï¼šç›´æ¥newçˆ¶ç±»ä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šçš„ç±»å˜›ï¼Œè¦æƒ³ä¸å—å­ç±»çš„ä»»ä½•å½±å“ï¼Œç›´æ¥newä¸å°±å®Œäº‹å„¿äº†ã€‚ä½†ä¸€èˆ¬çˆ¶ç±»éƒ½ä¸å¤ªå¯èƒ½ç›´æ¥newï¼Œåœ¨å¤šå­ç±»çš„æƒ…å†µä¸‹ï¼Œåˆè¯¥æ€æ ·ç›´æ¥è®¿é—®è‡ªå·±çš„èµ„æºå‘¢ï¼Ÿæ¥æ¥ç€å¾€ä¸‹çœ‹1.5.2å§ã€‚ 1.5.2ï¼šsuperå…³é”®è¯é€šè¿‡ä¸Šé¢çš„ä»‹ç»ï¼Œæˆ‘ä»¬äº†è§£äº†ç±»çš„ç»§æ‰¿å’Œå¤šæ€ï¼Œå­ç±»åœ¨ç»§æ‰¿äº†çˆ¶ç±»çš„åŠŸèƒ½å’Œå±æ€§ä¹‹åï¼Œå¯ä»¥è‡ªå®šä¹‰æ–¹æ³•å®ç°å¯¹çˆ¶ç±»çš„æ‰©å±•ï¼Œé’ˆå¯¹å®ç°ä¸åˆå­ç±»è¦æ±‚çš„æ–¹æ³•ï¼Œå­ç±»ä¹Ÿå¯ä»¥é€šè¿‡æ–¹æ³•é‡å†™æ¥è¦†ç›–åŸçˆ¶ç±»æ–¹æ³•ï¼Œç„¶åå°±æ˜¯å¤šæ€ï¼Œå¤šæ€ç®€å•æ¥è¯´å°±æ˜¯é€šè¿‡ä¸€ä¸ªçˆ¶ç±»å¼•ç”¨å˜é‡ç›´æ¥æŒ‡å‘ä¸€ä¸ªå­ç±»å¯¹è±¡ï¼Œè¿˜æ˜¯ç»“åˆå›¾1ç†è§£ã€‚ é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å†æ¥åšä¸€ä¸ªå®éªŒï¼Œç°åœ¨æˆ‘æƒ³è®©Catå’ŒDogåœ¨åƒé¥­çš„æ—¶å€™è‡ªå¸¦å«å£°ï¼Œç°åœ¨æˆ‘ä»¬æ¥ç»§ç»­æ”¹é€ ä¸‹è¿™äº›ç±»ï¼š é¦–å…ˆæŠŠAnimalé‡Œçš„eatæ–¹æ³•æ”¹é€ ä¸‹ï¼Œè®©å®ƒçš„é€»è¾‘æ‰§è¡Œä¹‹å‰ï¼Œå…ˆè°ƒç”¨ä¸‹cryæ–¹æ³•ï¼š ä»£ç å—151234567891011121314151617181920212223public class Animal { private String name = \"xx\"; private int age; public void cry() { System.out.println(\"å«å£°ä¸ºï¼šæœªçŸ¥\"); } public void eat() { this.cry(); //åƒé¥­ä¹‹å‰å…ˆå«ä¸¤å—“å­ System.out.println(name + \"æ­£åœ¨åƒä¸œè¥¿\"); } public void setName(String name) { this.name = name; } public void setAge(int age) { this.age = age; } } åˆ«çš„ä»£ç ä¸åŠ¨ï¼Œå•ç‹¬æµ‹è¯•ä¸‹eatæ–¹æ³•ï¼š ä»£ç å—161234567public static void main(String[] args) { Animal cat = new Cat(); cat.eat(); Animal dog = new Dog(); dog.eat();} æœ€ç»ˆè¾“å‡ºï¼š ä»£ç å—171234å–µå–µå–µ~xxæ­£åœ¨åƒä¸œè¥¿æ±ªæ±ªæ±ª~xxæ­£åœ¨åƒä¸œè¥¿ è¿™é‡Œè¯´ä¸€ä¸‹ï¼Œå³ä¾¿ä»£ç å—16ç›´æ¥ç”¨Catå’ŒDogæ¥æ”¶å¯¹åº”çš„ç±»å¯¹è±¡ï¼Œç»“æœéƒ½æ˜¯ä¸€è‡´çš„ã€‚ ğŸ¦© ç»“è®ºï¼šnewå‡ºæ¥å…·ä½“çš„å­ç±»ä¹‹åï¼Œçˆ¶ç±»é‡Œå³ä¾¿ä½¿ç”¨thisè°ƒç”¨å®ƒå†…éƒ¨çš„è¢«å­ç±»é‡å†™çš„æ–¹æ³•ï¼Œå®é™…è§¦å‘çš„ä»ç„¶æ˜¯å­ç±»çš„æ–¹æ³•ã€‚ â“ ç–‘é—®ç‚¹2ï¼šä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘æ˜æ˜æ˜¯åœ¨Animalå¯¹è±¡é‡Œè°ƒç”¨çš„this.cryï¼Œä¸ºä»€ä¹ˆæ‰§è¡Œçš„å´æ˜¯å­ç±»çš„ï¼Ÿ okï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆç›´æ¥è®¿é—®çˆ¶ç±»é‡Œçš„æ–¹æ³•å‘¢ï¼Ÿå€ŸåŠ©superå…³é”®è¯å³å¯ï¼ŒåŒthiså…³é”®è¯ä¸€æ ·ç”¨æ¥æè¿°ç±»å¯¹è±¡å†…éƒ¨å¼•ç”¨çš„ï¼Œä¸thisä¸åŒçš„æ˜¯ï¼Œå­ç±»åˆ©ç”¨superå¯ä»¥è°ƒç”¨çˆ¶ç±»èµ„æºï¼Œæ³¨æ„ï¼Œè¿™é‡Œè¯´äº†ï¼Œæƒ³ç”¨superï¼Œå°±å¾—åœ¨æŸå­ç±»å†…ï¼Œæˆ‘ä»¬ç°åœ¨å¦‚æœæƒ³è°ƒç”¨Animalæœ¬èº«çš„cryæ–¹æ³•ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨Catæˆ–Dogé‡Œï¼Œé€šè¿‡superè§¦å‘ï¼š é¦–å…ˆæŠŠAnimalé‡Œé¢çš„eatæ–¹æ³•è¿˜åŸï¼š ä»£ç å—181234567891011public class Animal { ...çœç•¥... public void eat() { //è´Ÿè´£åƒé¥­çš„æ–¹æ³• System.out.println(name + \"æ­£åœ¨åƒä¸œè¥¿\"); } ...çœç•¥...} ç„¶åæ”¹é€ ä¸‹Catç±»ï¼Œè®©å®ƒé‡å†™eatæ–¹æ³•ï¼Œæˆ‘ä»¬ç›®æ ‡æ˜¯è®©è¿™ä¸ªeatæ–¹æ³•å…ˆè°ƒç”¨ä¸€éçˆ¶ç±»åŸå§‹çš„cryæ–¹æ³•ï¼Œå†è°ƒç”¨ä¸€æ¬¡çˆ¶ç±»åŸå§‹çš„eatæ–¹æ³•ï¼š ä»£ç å—1912345678910111213public class Cat extends Animal { ...çœç•¥... @Override public void eat() { //è¿™é‡Œé‡å†™eatï¼ŒåŒæ—¶ä½¿ç”¨superç›´æ¥è°ƒç”¨çˆ¶ç±»çš„cryå’Œeatæ–¹æ³• super.cry(); super.eat(); } ...çœç•¥... } ç°åœ¨å†æ¬¡è°ƒç”¨eatæ–¹æ³•ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š ä»£ç å—2012å«å£°ä¸ºï¼šæœªçŸ¥xxæ­£åœ¨åƒä¸œè¥¿ ä½ ä¼šå‘ç°ï¼Œç°åœ¨çš„è°ƒç”¨å°±æ˜¯çˆ¶ç±»é‡Œé¢åŸç”Ÿçš„æ–¹æ³•ã€‚ ç°åœ¨ï¼Œè®©æˆ‘ä»¬æŠŠä»£ç å—19é‡Œçš„cryçš„superå…³é”®è¯å»æ‰ï¼ˆä¹‹å‰è¯´è¿‡ï¼Œå»æ‰ç›¸å½“äºä½¿ç”¨thiså…³é”®è¯è°ƒç”¨ï¼‰ï¼š ä»£ç å—2112345678910111213public class Cat extends Animal { ...çœç•¥... @Override public void eat() { cry(); //è¿™é‡ŒæŠŠsuperå»æ‰ super.eat(); //ç­‰çœ‹å®Œè¿™ä¸€å—çš„å†…å®¹ä¹‹åï¼Œç»“åˆCatç±»çš„ä»£ç ï¼Œåˆ†æä¸€ä¸‹è¿™é‡Œeatçš„superå…³é”®è¯å»æ‰ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ } ...çœç•¥... } ç„¶åè°ƒç”¨eatçš„ç»“æœå¦‚ä¸‹ï¼š ä»£ç å—2212å–µå–µå–µ~xxæ­£åœ¨åƒä¸œè¥¿ å¯è§ï¼ŒCaté‡Œä½¿ç”¨thisè°ƒç”¨cryæ–¹æ³•ï¼Œå½“ç„¶æ˜¯è°ƒç”¨çš„å®ƒè‡ªå·±çš„å’¯ã€‚ â“ ç–‘é—®ç‚¹3ï¼šä¸ºä»€ä¹ˆçˆ¶ç±»çš„è¢«å­ç±»é‡å†™è¿‡çš„æ–¹æ³•å¯æ€œåˆ°åªèƒ½é€šè¿‡å­ç±»çš„superå…³é”®è¯æ‰èƒ½è§¦å‘ï¼Ÿä¸ºä»€ä¹ˆçˆ¶ç±»é‡Œä¹Ÿæœ‰çš„æ–¹æ³•è¦ä¼˜å…ˆæ‰§è¡Œå­ç±»é‡Œé‡å†™åçš„ï¼Ÿä¸ç®¡åœ¨çˆ¶ç±»è¿˜æ˜¯å­ç±»ï¼Œç”¨thiså…³é”®è¯è°ƒç”¨çš„èµ„æºéƒ½æ˜¯ä¼˜å…ˆä»¥å­ç±»ä¸ºå‡†å—ï¼Ÿæ‰¾ä¸åˆ°çš„èµ„æºæ‰å»è€ƒè™‘æ‰¾çˆ¶ç±»å—ï¼Ÿ 1.6ï¼šç»§æ‰¿é“¾é¦–å…ˆè¯·è®°ä½ç°åœ¨çš„Animalç±»ï¼š ä»£ç å—2312345678910111213141516171819202122232425public class Animal { private String name = \"xx\"; //åŠ¨ç‰©å­¦åï¼ŒåŠ¨ç‰©ä»¬éƒ½æœ‰å­¦åï¼Œè¿™é‡Œé»˜è®¤ä¸ºxxï¼Œå› ä¸ºåŠ¨ç‰©ç±»æ˜¯ç”¨æ¥æè¿°åŠ¨ç‰©çš„ï¼ŒåŠ¨ç‰©æœ‰å­¦åï¼Œä½†ä½ å¹¶ä¸çŸ¥é“æ˜¯é‚£ç§åŠ¨ç‰©ï¼Œnameåªèƒ½æœªçŸ¥ private int age; //åŠ¨ç‰©ä»¬çš„å¹´é¾„ public void cry() { //æ§åˆ¶å«å£°çš„æ–¹æ³• System.out.println(\"å«å£°ä¸ºï¼šæœªçŸ¥\"); } public void eat() { //è´Ÿè´£åƒé¥­çš„æ–¹æ³• System.out.println(name + \"æ­£åœ¨åƒä¸œè¥¿\"); } //ç”¨æ¥ç»™nameèµ‹å€¼çš„æ–¹æ³• public void setName(String name) { this.name = name; } //ç”¨æ¥ç»™ageèµ‹å€¼çš„æ–¹æ³• public void setAge(int age) { this.age = age; } } Catç±»æ¸…ç†ä¸€ä¸‹ä¹‹å‰çš„æµ‹è¯•ä»£ç ï¼Œè®°ä½ç°åœ¨çš„Catç±»ï¼š ä»£ç å—24123456789101112public class Cat extends Animal { @Override //åŠ ä¸Š@Overrideæ ‡è¯†ä¸ºæ–¹æ³•é‡å†™ public void cry() { System.out.println(\"å–µå–µå–µ~\"); //è¿™é‡Œé‡æ–°å®šä¹‰æ–¹æ³•çš„å®ç° } public void catchMice() { //æ‰©å±•æ–¹æ³•ï¼šæ•é¼  System.out.println(\"æˆ‘ä¼šæ‰è€é¼ \"); } } javaè¯­æ³•é‡Œï¼Œåªå…è®¸ä¸€ä¸ªç±»ç»§æ‰¿ä¸€ä¸ªç±»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œextendså…³é”®è¯åªèƒ½åœ¨ä¸€ä¸ªç±»å®šä¹‰é‡Œå‡ºç°ä¸€æ¬¡ï¼Œæ ¹æ®è¿™ä¸ªè§„åˆ™ï¼Œçˆ¶ç±»ä¹Ÿæ˜¯ä¸€ä¸ªç±»ï¼Œç±»å…è®¸ç»§æ‰¿ä¸€ä¸ªåˆ«çš„ç±»ï¼ˆå¥—å¨ƒè­¦å‘Šï¼‰ï¼Œæè¿°èµ·æ¥æ˜¯è¶Šæ¥è¶Šä¹±ï¼Œä¸å¦‚å†æ”¹é€ ä¸‹å‰é¢çš„ä¾‹å­æ¥è¯´æ˜é—®é¢˜ï¼›ç°åœ¨æˆ‘ä»¬å‘ç°Catä¹Ÿåªæ˜¯å®šä¹‰äº†çŒ«çš„åŸºæœ¬æ¦‚å¿µï¼ŒåŒ…æ‹¬è¢«å®ƒé‡å†™åçš„cryï¼Œç¡®å®ï¼ŒçŒ«éƒ½æ˜¯å–µå–µå–µçš„å«ï¼ŒçŒ«éƒ½ä¼šæ•é¼ ï¼Œä½†æ˜¯ä¸åŒå“ç§çš„çŒ«ï¼Œä¹Ÿå­˜åœ¨å·®å¼‚ï¼Œä¾‹å¦‚ç›¸æ¯”å…¶å®ƒçŒ«ï¼Œæ©˜çŒ«çš„é£Ÿé‡æƒŠäººï¼Œå®ƒè¿˜å¯ä»¥æ‰®çŒªï¼Œå¦‚æœè¿™æ—¶å®šä¹‰ä¸€ä¸ªæ©˜çŒ«ç±»ï¼Œé¦–å…ˆå®ƒä¹Ÿæ˜¯çŒ«ï¼Œé‚£å°±è®©å®ƒç»§æ‰¿Catç±»ï¼Œé‚£ä¹ˆeatè¿™ä¸ªæ–¹æ³•å°±å¯ä»¥å•ç‹¬æ‹å‡ºæ¥å†è¢«é‡å†™ä¸€æ¬¡ï¼Œä»¥æ˜¾ç¤ºæ©˜çŒ«ç‰¹æœ‰çš„é£Ÿé‡ï¼Œå…¶æ¬¡åº”è¯¥å•ç‹¬åŠ ä¸€ä¸ªæ©˜çŒ«ç‰¹æœ‰æŠ€èƒ½ï¼šæ‰®çŒªï¼Œçœ‹ä»£ç ï¼š ä»£ç å—25123456789101112public class OrangeCat extends Cat { @Override public void eat() { //é‡å†™eatæ–¹æ³• System.out.println(\"æˆ‘å¯»æ€ä½ ä¸èƒ½å› ä¸ºæˆ‘åƒçš„å¤šå°±ä¸“é—¨ä¸ºæˆ‘é‡èº«å®šåšä¸€ä¸ªeatæ–¹æ³•å§ï¼Ÿã€‚ã€‚ã€‚ã€‚ã€‚ã€‚è‰¾ç›çœŸé¦™~\"); } //å‡è£…è‡ªå·±æ˜¯å¤´çŒª public void playAPig() { System.out.println(\"æˆ‘è¯´æˆ‘æ˜¯ğŸ·ï¼Œä½ èƒ½æ€ä¹ˆåŠï¼Ÿï¼ˆğŸ¤ªï¼‰\"); }} okï¼Œè‡³å°‘é€šè¿‡æ©˜çŒ«ç±»ï¼Œæˆ‘ä»¬çŸ¥é“äº†ï¼Œjavaè™½ç„¶ä¸å…è®¸ä¸€ä¸ªç±»ç»§æ‰¿å¤šä¸ªç±»ï¼Œä½†å¯ä»¥é—´æ¥ç»§æ‰¿å¤šä¸ªç±»ï¼Œç°åœ¨çš„ç»§æ‰¿é“¾ä¸ºï¼š é‚£ä¹ˆä¸€æ ·çš„ï¼Œæˆ‘ä»¬å‰é¢äº†è§£äº†javaçš„ç»§æ‰¿å’Œå¤šæ€ï¼Œè¿™ç§ç»§æ‰¿é“¾ä¹Ÿæ˜¯ç¬¦åˆä¸Šè¿°æ‰€æœ‰çš„ç»§æ‰¿ç›¸å…³çš„ç‰¹æ€§ï¼Œæ¯”å¦‚æˆ‘ä»¬æ¥åˆ©ç”¨OrangeCatåšä¸ªè¯•éªŒï¼š ä»£ç å—26123456789101112131415public static void main(String[] args) { //ç»§æ‰¿é“¾ä»ç¬¦åˆå¤šæ€è§„åˆ™ï¼Œçœ‹ä¸‹æ–¹çš„ä»£ç ï¼Œæˆ‘ç”¨Animalå’ŒCatéƒ½å¯ä»¥æ¥æ”¶OrangeCatå¯¹è±¡ï¼Œå› ä¸ºå®ƒä»¬ä¿©éƒ½æ˜¯OrangeCatçš„çˆ¶ç±» Animal orangeCat1 = new OrangeCat(); Cat orangeCat2 = new OrangeCat(); OrangeCat orangeCat3 = new OrangeCat(); orangeCat1.cry(); orangeCat1.eat(); orangeCat2.cry(); orangeCat2.eat(); orangeCat3.cry(); orangeCat3.eat();} ç»“æœå¦‚ä¸‹ï¼š ä»£ç å—27123456å–µå–µå–µ~æˆ‘å¯»æ€ä½ ä¸èƒ½å› ä¸ºæˆ‘åƒçš„å¤šå°±ä¸“é—¨ä¸ºæˆ‘é‡èº«å®šåšä¸€ä¸ªeatæ–¹æ³•å§ï¼Ÿã€‚ã€‚ã€‚ã€‚ã€‚ã€‚è‰¾ç›çœŸé¦™~å–µå–µå–µ~æˆ‘å¯»æ€ä½ ä¸èƒ½å› ä¸ºæˆ‘åƒçš„å¤šå°±ä¸“é—¨ä¸ºæˆ‘é‡èº«å®šåšä¸€ä¸ªeatæ–¹æ³•å§ï¼Ÿã€‚ã€‚ã€‚ã€‚ã€‚ã€‚è‰¾ç›çœŸé¦™~å–µå–µå–µ~æˆ‘å¯»æ€ä½ ä¸èƒ½å› ä¸ºæˆ‘åƒçš„å¤šå°±ä¸“é—¨ä¸ºæˆ‘é‡èº«å®šåšä¸€ä¸ªeatæ–¹æ³•å§ï¼Ÿã€‚ã€‚ã€‚ã€‚ã€‚ã€‚è‰¾ç›çœŸé¦™~ å¯ä»¥çœ‹åˆ°ï¼Œä¸ç®¡ç”¨è°å»æ¥æ”¶OrangeCatå¯¹è±¡ï¼Œæœ€ç»ˆè¾“å‡ºç»“æœéƒ½æ˜¯æ­£ç¡®çš„ï¼Œé¦–å…ˆOrangeCatæ²¡æœ‰é‡å†™cryæ–¹æ³•ï¼Œå› æ­¤è§¦å‘çš„æ˜¯çˆ¶ç±»Caté‡Œçš„cryæ–¹æ³•ï¼Œåˆå› ä¸ºè‡ªå·±é‡å†™äº†eatå¯¹è±¡ï¼Œæ‰€ä»¥eatè°ƒç”¨æ—¶å°±ç›´æ¥è§¦å‘äº†è‡ªå·±çš„eatæ–¹æ³•ã€‚ åŒæ ·çš„ï¼ŒplayAPigæ–¹æ³•å±äºOrangeCatè‡ªå®šä¹‰çš„æ‰©å±•æ–¹æ³•ï¼Œå®ƒåªèƒ½ç”±OrangeCatç±»å‹çš„å¼•ç”¨å˜é‡è§¦å‘ï¼Œå› æ­¤ä»£ç å—26é‡Œï¼Œåªæœ‰orangeCat3å¯ä»¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œç”±äºOrangeCatç»§æ‰¿äº†Catï¼Œæ‰€ä»¥å®ƒä¹Ÿä¼šæ•é¼ ï¼ˆcatchMiceï¼‰äº†ã€‚ æˆ‘ä»¬å†æ¥çœ‹çœ‹OrangeCatå…·å¤‡äº†å“ªäº›èƒ½åŠ›ï¼š ä»£ç å—28123456789public static void main(String[] args) { OrangeCat orangeCat3 = new OrangeCat(); orangeCat3.setAge(9); //å…¶ç›´ç³»çˆ¶ç±»Catç»§æ‰¿äº†Animalï¼Œå› æ­¤å®ƒä¹Ÿå¯ä»¥è°ƒç”¨Animalçš„setAgeæ–¹æ³• orangeCat3.setName(\"æ©˜çŒ«\"); //åŒä¸Š orangeCat3.cry(); //å…¶ç›´ç³»çˆ¶ç±»Catæœ‰cryæ–¹æ³•ï¼ˆè™½ç„¶æ˜¯é‡å†™Animalçš„cryæ¥çš„ï¼‰ï¼Œå› æ­¤è¿™é‡Œè§¦å‘çš„æ˜¯Caté‡Œé‚£ä¸ªcryæ–¹æ³• orangeCat3.eat(); //å› ä¸ºè‡ªå·±æœ‰eatæ–¹æ³•ï¼Œå› æ­¤è¿™é‡Œè§¦å‘çš„æ˜¯è‡ªå·±çš„eatæ–¹æ³• orangeCat3.catchMice(); //å…¶ç›´ç³»çˆ¶ç±»Catæœ‰catchMiceæ–¹æ³•ï¼Œå› æ­¤è¿™é‡Œè§¦å‘çš„æ˜¯Caté‡Œé‚£ä¸ªcatchMiceæ–¹æ³• orangeCat3.playAPig(); //è¿™æ˜¯OrangeCatç‰¹æœ‰çš„æ–¹æ³•ï¼Œè‡ªç„¶å¯ä»¥è°ƒç”¨} çœ‹åˆ°äº†å—ï¼Œç»è¿‡ä¸€å±‚å±‚çš„ç»§æ‰¿ï¼ŒOrangeCatæ‹¥æœ‰çš„æŠ€èƒ½è¦æ¯”ä¿©çˆ¶ç±»åŠ èµ·æ¥è¿˜å¤šï¼Œè¿™æ˜¯å› ä¸ºç»§æ‰¿çš„ç‰¹æ€§ï¼Œå°±æ˜¯çˆ¶ç±»æ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯å¯ä»¥ç»™å­ç±»çš„ï¼ˆå½“ç„¶èƒ½ä¸èƒ½è®¿é—®å°±æ˜¯å¦ä¸€å›äº‹äº†ï¼Œä¸‹é¢ä¼šè¯´è®¿é—®æƒé™ç›¸å…³çš„å†…å®¹ï¼‰ï¼Œè€Œå­ç±»åˆå¯ä»¥é‡å†™çˆ¶ç±»çš„æ–¹æ³•ï¼Œå¦‚æœä¸é‡å†™ï¼Œåˆ™æŒ‰ç…§å°±è¿‘åŸåˆ™è§¦å‘å¯¹åº”çš„æ–¹æ³•ï¼Œæ¯”å¦‚ä¾‹å­é‡Œè™½ç„¶OrangeCatæ²¡æœ‰é‡å†™cryæ–¹æ³•ï¼Œä½†å®ƒè°ƒç”¨cryçš„è¾“å‡ºç»“æœå´æ˜¯Catç±»é‡Œçš„é‚£ä¸ªï¼Œå› æ­¤ï¼Œåœ¨é‡å†™æ–¹æ³•è°ƒç”¨ä¸Šï¼Œä¸€èˆ¬éµå¾ªå°±è¿‘åŸåˆ™ï¼Œæ­¤å¤–å­ç±»ä¹Ÿå¯ä»¥æ‰©å±•è‡ªå·±çš„å†…å®¹ï¼Œæ¯”å¦‚Catç›¸æ¯”Animalï¼Œå¯ä»¥æ•é¼ ï¼Œå†æ¯”å¦‚OrangeCatç›¸æ¯”Catå’ŒAnimalï¼Œå¯ä»¥æ‰®çŒªã€‚ 1.7ï¼šå·©å›ºç»§æ‰¿&amp;å¤šæ€å‰é¢è®²äº†é‚£ä¹ˆå¤šï¼Œç°åœ¨æˆ‘ä»¬é€šè¿‡ç”»å›¾çš„æ–¹å¼ï¼Œç³»ç»Ÿçš„è§£é‡Šä¸€éç»§æ‰¿å’Œå¤šæ€ã€‚ 1.7.1ï¼šç»§æ‰¿å…³ç³»ä¸‹ï¼Œé‡å¤æ–¹æ³•çš„å°±è¿‘è°ƒç”¨è§„åˆ™å…ˆçœ‹ä¸‹æˆ‘ä»¬åœ¨å‰é¢ç•™ä¸‹çš„3ä¸ªé—®é¢˜ï¼š â“ ç–‘é—®ç‚¹1ï¼šä¸ºä»€ä¹ˆé€šè¿‡Animalçš„å¼•ç”¨å˜é‡æŒ‡å‘çš„Catå¯¹è±¡ï¼Œæ— æ³•è°ƒç”¨å…¶catchMiceæ–¹æ³•ï¼Ÿä¸ºä»€ä¹ˆcryæ–¹æ³•å¯ä»¥è°ƒç”¨è§¦å‘çš„å´æ˜¯Caté‡Œçš„cryæ–¹æ³•ï¼Ÿ â“ ç–‘é—®ç‚¹2ï¼šä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘æ˜æ˜æ˜¯åœ¨Animalå¯¹è±¡é‡Œè°ƒç”¨çš„this.cryï¼Œä¸ºä»€ä¹ˆæ‰§è¡Œçš„å´æ˜¯å­ç±»çš„ï¼Ÿ â“ ç–‘é—®ç‚¹3ï¼šä¸ºä»€ä¹ˆçˆ¶ç±»çš„è¢«å­ç±»é‡å†™è¿‡çš„æ–¹æ³•å¯æ€œåˆ°åªèƒ½é€šè¿‡å­ç±»çš„superå…³é”®è¯æ‰èƒ½è§¦å‘ï¼Ÿä¸ºä»€ä¹ˆçˆ¶ç±»é‡Œä¹Ÿæœ‰çš„æ–¹æ³•è¦ä¼˜å…ˆæ‰§è¡Œå­ç±»é‡Œé‡å†™åçš„ï¼Ÿä¸ç®¡åœ¨çˆ¶ç±»è¿˜æ˜¯å­ç±»ï¼Œç”¨thiså…³é”®è¯è°ƒç”¨çš„èµ„æºéƒ½æ˜¯ä¼˜å…ˆä»¥å­ç±»ä¸ºå‡†å—ï¼Ÿæ‰¾ä¸åˆ°çš„èµ„æºæ‰å»è€ƒè™‘æ‰¾çˆ¶ç±»å—ï¼Ÿ å…ˆä¸ç”¨æ€¥ç€çœ‹é—®é¢˜ï¼Œæˆ‘ä»¬å…ˆæ¥åˆ†æä¸‹ä¸€ä¸ªç±»æ–¹æ³•æˆ–å±æ€§åœ¨è°ƒç”¨æ—¶ï¼Œéƒ½ç»å†äº†äº›ä»€ä¹ˆã€‚ åœ¨LV2-1çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±çŸ¥é“äº†ï¼Œå¯¹è±¡å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œè¢«ä¿å­˜åœ¨äº†å†…å­˜é‡Œï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå¼•ç”¨å˜é‡æ¥æŒ‡å‘å®ƒï¼Œç„¶åå°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªå¼•ç”¨å˜é‡æ¥æ“çºµå®ƒäº†ï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸‹ï¼Œæ­£å¸¸æ²¡æœ‰ç»§æ‰¿ä»»ä½•ç±»çš„ç±»ï¼Œæ˜¯å¦‚ä½•è®¿é—®æ–¹æ³•çš„ï¼š ğŸ¦œ è¿™é‡Œè¯´æ˜ä¸€ä¸‹ï¼Œä¸‹é¢çš„æµç¨‹å›¾åªæ˜¯ä¸ºäº†ä¾¿äºè®©å¤§å®¶ç†è§£å¹¶è®°ä½javaç»§æ‰¿å…³ç³»ä¸‹çš„è®¿é—®è§„åˆ™ï¼ŒçœŸå®çš„javaå¯¹è±¡åœ¨å†…å­˜é‡Œå¹¶ä¸é•¿è¿™æ ·ï¼ˆè™½ç„¶ç¡®å®åŒ…å«å±æ€§å€¼ï¼‰ï¼Œæ–¹æ³•çš„è°ƒç”¨åœ¨javaåº•å±‚ä¹Ÿå¾ˆå¤æ‚ï¼Œè¿™äº›éƒ½è¦å¯¹jvmæœ‰æ·±å…¥äº†è§£æ‰è¡Œã€‚ å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰ä»»ä½•çˆ¶ç±»ï¼Œé‚£ä¹ˆå®ƒçš„æ–¹æ³•è°ƒç”¨å°±å¾ˆçº¯ç²¹ï¼Œæ²¡æœ‰ä»»ä½•æ‚¬å¿µï¼Œç°åœ¨è®©æˆ‘ä»¬çš„çœ‹çœ‹Catç±»ï¼š è®©æˆ‘ä»¬å†æ¥çœ‹çœ‹æ›´å¤æ‚çš„æ©˜çŒ«ï¼š æˆ‘ä»¬ä»ç„¶å¯ä»¥æ‰¾åˆ°ä¸€äº›è§„åˆ™ï¼Œæ¥è¯´æ˜åœ¨ç»§æ‰¿é‡Œæ–¹æ³•çš„è°ƒç”¨å’Œæœ€ç»ˆè§¦å‘å“ªä¸ªæ–¹æ³•çš„é—®é¢˜ã€‚ å¥½çš„ï¼Œæˆªæ­¢ç›®å‰ï¼Œé›†åˆå›¾4å’Œå›¾5ï¼Œæˆ‘ä»¬è§£å†³äº†ç–‘é—®ç‚¹2å’Œç–‘é—®ç‚¹3ï¼Œé€šè¿‡å›¾4ï¼Œæˆ‘ä»¬çŸ¥é“äº†thiså…³é”®è¯å–å†³äºå½“å‰çš„å¯¹è±¡ç©¶ç«Ÿå±äºå“ªä¸ªç±»ï¼Œä»ç„¶ç¬¦åˆå°±è¿‘è°ƒç”¨è§„åˆ™ï¼Œä¾‹å¦‚Animalé‡Œé¢ä½¿ç”¨this.cryè°ƒç”¨cryï¼Œå¦‚æœå½“å‰å¯¹è±¡æ˜¯Animalè‡ªå·±ï¼Œé‚£ä¹ˆæ¯«æ— ç–‘é—®ï¼Œæœ€ç»ˆè§¦å‘çš„ä¼šæ˜¯å®ƒè‡ªå·±çš„cryæ–¹æ³•ï¼Œä½†å¦‚æœå½“å‰å¯¹è±¡æ˜¯Catï¼Œé‚£ä¹ˆthisè°ƒç”¨cryæ—¶å°±éµå¾ªå°±è¿‘è§„åˆ™ï¼Œä¼˜å…ˆè§¦å‘è‡ªå·±æ‰€å±ç±»ï¼ˆä¹Ÿå°±æ˜¯Catç±»ï¼‰é‡Œçš„cryæ–¹æ³•ã€‚ å›¾4å‘Šè¯‰æˆ‘ä»¬ï¼Œsuperå…³é”®å­—åœ¨å­ç±»é‡Œå¯ç”¨æ¥ç›´æ¥è°ƒç”¨å…¶çˆ¶ç±»é‡Œçš„æ–¹æ³•ï¼š è¿™ä¸ªå¯ä»¥è§£ç­”ç–‘é—®ç‚¹3. ç°åœ¨è®©æˆ‘ä»¬è§£ç­”ä¸‹ç–‘é—®ç‚¹1ï¼Œä¸ºä»€ä¹ˆçˆ¶ç±»å¼•ç”¨å˜é‡å¯ä»¥æ¥æ”¶å­ç±»å¯¹è±¡ï¼Ÿ è¿˜è®°å¾—è®²åŸºæœ¬ç±»å‹æ—¶ï¼Œå­˜åœ¨å¤§ç±»å‹å’Œå°ç±»å‹å—ï¼Ÿå¤§ç±»å‹å¯ä»¥è‡ªåŠ¨æ¥æ”¶å°ç±»å‹ï¼Œè€Œå°ç±»å‹æƒ³è¦å˜æˆå¤§ç±»å‹å°±å¾—å¼ºè½¬ï¼Œç±»åŒæ ·æ‹¥æœ‰ç±»ä¼¼çš„è§„åˆ™ï¼Œæ¯”å¦‚ä½ å¯ä»¥æŠŠçˆ¶ç±»ç†è§£æˆæ¯”è¾ƒå¤§çš„ç±»ï¼Œå­ç±»æ˜¯æ¯”è¾ƒå°çš„ç±»ï¼Œé‚£ä¹ˆçˆ¶ç±»å½“ç„¶å¯ä»¥è‡ªåŠ¨æ¥æ”¶å­ç±»å’¯ï¼Œåªä¸è¿‡ç±»æœ‰ä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œä¸€ä¸ªå­ç±»è¢«çˆ¶ç±»æ¥æ”¶ä»¥åï¼Œè®¿é—®åŸŸå°±å—çˆ¶ç±»é™åˆ¶äº†ï¼š æ—¢ç„¶è§„åˆ™è·ŸåŸºæœ¬ç±»å‹å·®ä¸å¤šï¼Œå½“ç„¶ä¹Ÿæœ‰ç±»å‹å¼ºè½¬å•¦ï¼š ä»£ç å—2912Animal cat = new Cat();Cat cat2 = (Cat)cat; çœ‹å§ï¼Œè¿å†™æ³•éƒ½è·ŸåŸºæœ¬ç±»å‹çš„å¼ºè½¬ä¸€æ ·ï¼Œæ‹¬å·é‡ŒåŠ ä¸Šè¦è½¬çš„ç›®æ ‡ç±»å‹å³å¯ã€‚ ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ«çè½¬ï¼Œæ¯”å¦‚ä½ çŸ¥é“è¿™ä¸ªAnimalçš„ç¡®æ˜¯ä¸€ä¸ªCatï¼Œç„¶ååƒä»£ç å—29é‡Œé‚£æ ·è½¬æˆCatç±»å‹å³å¯ï¼Œä½†å¦‚æœå¯¹è±¡å¹¶ä¸æ˜¯Catï¼Œé‚£æ ·å¼ºè½¬è¯­æ³•é‡Œæ˜¯å…è®¸çš„ï¼Œä½†æ˜¯è¿è¡Œæ—¶ä¼šæŠ¥ç±»å‹è½¬æ¢é”™è¯¯ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ ·ï¼š ä»£ç å—3012Animal dog = new Dog();Cat cat = (Cat)dog; ä¸Šé¢çš„ä»£ç åœ¨è¯­æ³•é‡Œä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†å®é™…ä¸Šè¿è¡Œæ—¶ä¾¿ä¼šæŠ¥é”™ï¼Œå³ç±»å‹è½¬æ¢é”™è¯¯ã€‚ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæœ‰å…³é—®é¢˜1ã€2ã€3éƒ½è¯´å®Œäº†ï¼Œç»§æ‰¿å’Œå¤šæ€è¿™ä¸€å—ç¡®å®å¾ˆå¤æ‚ï¼Œæœ€å¥½èƒ½ç»“åˆæœ¬èŠ‚æµç¨‹å›¾è®°ä¸‹æ¥è¿™ä¸ªè§„åˆ™ï¼Œä»¥ååšåˆ†ææ—¶å°±ä¸ä¼šä¹±äº†ã€‚ 1.7.2ï¼šå±æ€§åœ¨ç»§æ‰¿å…³ç³»ä¸‹çš„è®¿é—®è§„åˆ™ä¸Šé¢åªæ˜¯è¯´äº†æ–¹æ³•çš„è°ƒç”¨è§„åˆ™ï¼Œå´æ²¡æœ‰è¯´å±æ€§ï¼Œæˆ‘ä»¬æ¥åšä¸ªè¯•éªŒï¼š ç°åœ¨è®©Catç±»é‡Œä¹Ÿæœ‰ä¸€ä¸ªå«ageçš„å±æ€§ï¼š ä»£ç å—3112345678910111213141516public class Cat extends Animal { public int age = 12; //æ–°å¢ä¸€ä¸ªè·Ÿçˆ¶ç±»ä¸€æ ·çš„å±æ€§ï¼Œåˆå§‹å€¼ä¸º12 @Override public void cry() { System.out.println(this.age); //é€šè¿‡thiså…³é”®è¯è®¿é—®age System.out.println(super.age); //é€šè¿‡superå…³é”®è¯è®¿é—®çˆ¶ç±»é‡Œçš„age System.out.println(\"å–µå–µå–µ~\"); } public void catchMice() { //æ‰©å±•æ–¹æ³•ï¼šæ•é¼  System.out.println(\"æˆ‘ä¼šæ‰è€é¼ \"); } } ç„¶åè®©çˆ¶ç±»é‡Œçš„ageè®¿é—®æƒé™å˜æˆpublicï¼ˆè¯¦ç»†çœ‹ä¸‹æ–¹1.8ï¼Œè¿™é‡Œæ”¹æˆpublicçš„ç›®çš„æ˜¯ä¸ºäº†è®©Catå¯ä»¥ç›´æ¥è®¿é—®è¿™ä¸ªå±æ€§ï¼‰ï¼Œç„¶åè®©å…¶åˆå§‹å€¼ä¸º15ï¼Œå¹¶ä¸”åœ¨å…¶eatæ–¹æ³•é‡Œä½¿ç”¨thiså…³é”®è¯è®¿é—®ageï¼š ä»£ç å—321234567891011121314public class Animal { ...çœç•¥... public int age = 15; //åŠ¨ç‰©ä»¬çš„å¹´é¾„ï¼Œåˆå§‹å€¼ä¸º15 public void eat() { System.out.println(this.age); //è¾“å‡ºage System.out.println(this.name + \"æ­£åœ¨åƒä¸œè¥¿\"); } ...çœç•¥...} ç°åœ¨è®©æˆ‘ä»¬æ¥æµ‹è¯•ä¸‹ï¼š ä»£ç å—3312345public static void main(String[] args){ Animal cat = new Cat(); cat.cry(); cat.eat();} è¾“å‡ºå¦‚ä¸‹ï¼š ä»£ç å—34123451215å–µå–µå–µ~15xxæ­£åœ¨åƒä¸œè¥¿ ğŸ‘ ç»“è®ºï¼šç”±è¿è¡Œç»“æœæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œä¸æ–¹æ³•çš„é‡å†™ä¸åŒï¼Œç±»çš„å±æ€§æœ¬èº«è¯¥å±äºå“ªä¸ªç±»è¿˜æ˜¯å±äºå“ªä¸ªç±»ï¼Œè®°ä½è¿™ä¸ªè§„åˆ™ã€‚ å¥½äº†ï¼Œä¸Šé¢çš„è¿™ä¸ªè¯•éªŒæœ‰ç”»è›‡æ·»è¶³çš„å«Œç–‘ï¼Œå› ä¸ºageçˆ¶ç±»é‡Œå°±æœ‰ï¼Œä¸ºä»€ä¹ˆCaté‡Œè¿˜è¦åŠ ä¸Šä¸€ä¸ªåŒåçš„ageå‘¢ï¼Ÿæ˜¯çš„ï¼ŒçœŸå®è®¾è®¡ç±»çš„æ—¶å€™æ²¡äººä¼šè¿™æ ·è®¾è®¡çš„ï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®ä¸€ä¸ªç‚¹ï¼Œæ–¹æ³•æ˜¯è¡Œä¸ºï¼Œæ–¹æ³•åœ¨ç»§æ‰¿å…³ç³»é‡Œå…è®¸å„ç§é‡å†™ï¼Œä½†æ˜¯å±æ€§ä½œä¸ºä¸€ç§æ²¡æœ‰ä»»ä½•è¡Œä¸ºæ–¹å¼çš„ä¸œè¥¿ï¼Œä½ é‡å¤å®šä¹‰å®ƒçš„æ„ä¹‰å¤§å—ï¼Ÿæ˜¾ç„¶æ˜¯ä¸å¤§çš„ï¼Œè€Œä¸”ææ˜“è·Ÿçˆ¶ç±»æ··æ·†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¯´å­ç±»å¯ä»¥é‡å†™çˆ¶ç±»çš„æ–¹æ³•ï¼Œç»§æ‰¿å…³ç³»é‡Œï¼Œæ–¹æ³•è°ƒç”¨ç¬¦åˆä»¥å¯¹è±¡æ‰€å±ç±»ä¸ºå‚ç…§å°±è¿‘è°ƒç”¨çš„è§„åˆ™ï¼Œå­ç±»è¿˜å¯ä»¥è‡ªå·±æ‹“å±•çˆ¶ç±»é‡Œæ²¡æœ‰çš„æ–¹æ³•ï¼Œå­ç±»çš„å¯¹è±¡è¿˜å¯ä»¥è¢«çˆ¶ç±»å¼•ç”¨å˜é‡æ¥æ”¶ï¼Œåªæ˜¯è¿™æ ·ä¼šå½±å“å­ç±»å¯¹è±¡çš„è®¿é—®åŸŸï¼ˆå›¾7ï¼‰ï¼Œå­ç±»è¿˜å¯ä»¥æ‹“å±•çˆ¶ç±»é‡Œæ²¡æœ‰çš„å±æ€§ï¼Œä½†ä¸å»ºè®®å­ç±»è¦†ç›–çˆ¶ç±»çš„å±æ€§ï¼Œè¿™ç§è¦†ç›–æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œé€šè¿‡ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬ä¹Ÿå‘ç°äº†ï¼ŒåŒåå±æ€§åœ¨ç±»ç»§æ‰¿é“¾é‡Œæ˜¯ç›¸äº’éš”ç¦»çš„ã€‚ 1.8ï¼šè®¿é—®æƒé™é€šè¿‡1.7ï¼Œä½ åº”è¯¥çŸ¥é“äº†æŸç§ç±»ä¸çˆ¶ç±»è®¿é—®è§„åˆ™ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨LV2-2çš„è®¿é—®æƒé™ç¬¦çš„ä»‹ç»é‡Œï¼Œä»‹ç»äº†è®¿é—®æƒé™ä¿®é¥°ç¬¦ä»¥åŠè¢«å®ƒä»¬ä¿®é¥°äº†çš„èµ„æºçš„è®¿é—®æƒé™ï¼Œä¹Ÿå°±æ˜¯è¯´ç†æƒ³çŠ¶æ€ä¸‹1.7çš„æµç¨‹å›¾éƒ½æ˜¯æˆç«‹çš„ï¼Œä½†æ˜¯ä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œè¿™äº›æ–¹æ³•çš„æƒé™ä¿®é¥°ç¬¦éƒ½æ˜¯publicçš„ï¼Ÿæ˜¯çš„ï¼Œpublicè¡¨ç¤ºèµ„æºå…¬å¼€ï¼Œæ¯”å¦‚Animalç±»é‡Œçš„ageå’Œnameä¸¤ä¸ªå±æ€§éƒ½æ˜¯privateç±»å‹çš„ï¼Œå­ç±»å¯ä»¥é€šè¿‡superç›´æ¥è®¿é—®è¿™ä¿©å±æ€§å—ï¼Ÿæ˜¾ç„¶æ˜¯ä¸è¡Œçš„ï¼Œå¿…é¡»å¾—é€šè¿‡publicçš„setNameå’ŒsetAgeä¿©æ–¹æ³•å®Œæˆå¯¹nameå’Œageçš„èµ‹å€¼ï¼Œè¿™å°±æ˜¯è®¿é—®æƒé™ç¬¦çš„æ„ä¹‰äº†ï¼Œè‡³äºæ€ä¹ˆåŒºåˆ†èƒ½ä¸èƒ½è®¿é—®å‘¢ï¼Ÿæˆ‘ä»¬å†æŠŠé‚£å¼ è¡¨é‡Œæœ‰å…³ä¿®é¥°ç¬¦è®¿é—®ç­‰çº§çš„è¡¨è´´æ¥ï¼š åªéœ€è¦è®°ä½ï¼Œå¦‚æœä¿©ç±»ä¸ºç»§æ‰¿å…³ç³»ï¼Œåˆ™protectedå…³é”®è¯æ— è§†åŒ…ç›®å½•ï¼Œå‡å¯è®¿é—®ï¼Œå…¶ä½™è§„åˆ™å…¨éƒ¨è·Ÿæ™®é€šç±»ä¸€æ ·ï¼Œç”±äºä¹‹å‰è®²è¿‡æƒé™ä¿®é¥°ç¬¦ï¼Œå› æ­¤è¿™é‡Œä¸å†åšè¯¦ç»†ä»‹ç»ã€‚ 1.9ï¼šç»§æ‰¿å’Œå¤šæ€çš„å¥½å¤„é€šè¿‡å‰é¢å¯¹ç»§æ‰¿å’Œå¤šæ€çš„äº†è§£ï¼Œæˆ‘ä»¬å¤§ä½“ä¸Šå¯¹è¿™ä¿©ç‰¹æ€§æœ‰äº†ä¸€ä¸ªè®¤è¯†ï¼Œé¦–å…ˆç»§æ‰¿æ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜çš„ï¼Ÿ å›å½’åˆ°æˆ‘ä»¬çš„ä¾‹å­ä¸Šï¼ŒAnimalé‡Œå®šä¹‰äº†ç¬¦åˆåŠ¨ç‰©ç‰¹æ€§ä¸€äº›è¡Œä¸ºå’Œå±æ€§ï¼ŒCatæ˜¯ä¸€ç§åŠ¨ç‰©ï¼Œç¬¦åˆAnimalå®šä¹‰çš„è¡Œä¸ºå’Œå±æ€§ï¼Œå®ƒä»¬ä¿©å»ºç«‹èµ·çˆ¶å­å…³ç³»åï¼ŒCatå°±å¯ä»¥ç›´æ¥ä½¿ç”¨çˆ¶ç±»é‡Œå®šä¹‰çš„å±æ€§å’Œæ–¹æ³•äº†ï¼Œè¿™æ ·åƒeatè¿™ç§æ–¹æ³•ï¼ŒCatå’ŒDogéƒ½ä¸éœ€è¦è‡ªå·±å®šä¹‰äº†ï¼Œè¿™æ ·ä¼šè®©æˆ‘ä»¬çš„ä»£ç çœ‹èµ·æ¥å¾ˆç®€æ´ï¼Œè€Œä¸”åŒæ ·çš„ä»£ç é€»è¾‘å—ï¼Œä¸éœ€è¦é‡å¤å®šä¹‰å¤šæ¬¡ï¼Œæœ‰éœ€è¦å¯ä»¥é‡å†™ï¼Œå­ç±»è¿˜å¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„è¡Œä¸ºæ–¹æ³•ã€‚ å¤šæ€å‘¢ï¼Ÿå®ƒæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ å¤šæ€å°±æ˜¯æŒ‡ä½¿ç”¨ä¸€ä¸ªçˆ¶ç±»å¼•ç”¨å˜é‡ï¼Œå¯ä»¥æ¥æ”¶å­ç±»å¯¹è±¡å¹¶å…è®¸è§¦å‘å®ƒå†…éƒ¨çš„æ–¹æ³•ï¼Œå‚è§å›¾1ï¼Œé‚£ä¹ˆè¿™æ ·çš„ä¸€ç§ç‰¹æ€§çš„å¥½å¤„ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬æœ¬èŠ‚å…ˆä¸ä¼šæ¶‰åŠï¼Œä¹‹åè®²JDBCæ—¶å¯ä»¥æä¸€å˜´ï¼Œç°åœ¨ä½ è¦åšçš„æ˜¯ï¼Œç‰¢è®°javaçš„è¿™ç§æœºåˆ¶ã€‚ 1.10ï¼šæŠ½è±¡ç±»äº†è§£å®Œäº†ç»§æ‰¿å’Œå¤šæ€ï¼Œæˆ‘ä»¬å†æ¥äº†è§£ä¸€ç§ç‰¹æ®Šçš„ç±»ï¼šæŠ½è±¡ç±» ä»€ä¹ˆæ˜¯æŠ½è±¡ç±»ï¼Ÿè®©æˆ‘ä»¬æ¥æ”¹é€ ä¸‹Animalæ–¹æ³•ï¼Œä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œç”±Animalæ´¾ç”Ÿå‡ºæ¥çš„å­ç±»Catå’ŒDogéƒ½é‡å†™äº†cryæ–¹æ³•ï¼Œè¯´æ˜å¤§éƒ¨åˆ†æ—¶å€™ï¼ŒAnimalé‡Œçš„cryæ–¹æ³•éƒ½ä¸ä¼šä¸»åŠ¨ç”Ÿæ•ˆï¼Œå› ä¸ºæ„ä¹‰ä¸å¤§ï¼Œè¿™æ—¶æˆ‘ä»¬è®¤ä¸ºcryæ–¹æ³•åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯éœ€è¦è¢«é‡å†™çš„ï¼Œåƒè¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå®ƒå®šä¹‰æˆä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼ŒåŒ…å«æŠ½è±¡æ–¹æ³•çš„ç±»è¢«ç§°ä½œæŠ½è±¡ç±»ï¼Œæ™®é€šçš„ç±»æ˜¯ä¸èƒ½æœ‰æŠ½è±¡æ–¹æ³•çš„ï¼Œå› æ­¤æƒ³è¦cryå˜æˆæŠ½è±¡æ–¹æ³•ï¼Œé¦–å…ˆè¦æŠŠAnimalå˜æˆæŠ½è±¡ç±»ï¼š ä»£ç å—351234567891011121314151617181920212223//åˆ©ç”¨abstractä¿®é¥°çš„classï¼Œè¢«ç§°ä¸ºæŠ½è±¡ç±»public abstract class Animal { private String name = \"xx\"; //åŠ¨ç‰©å­¦åï¼ŒåŠ¨ç‰©ä»¬éƒ½æœ‰å­¦åï¼Œè¿™é‡Œé»˜è®¤ä¸ºxxï¼Œå› ä¸ºåŠ¨ç‰©ç±»æ˜¯ç”¨æ¥æè¿°åŠ¨ç‰©çš„ï¼ŒåŠ¨ç‰©æœ‰å­¦åï¼Œä½†ä½ å¹¶ä¸çŸ¥é“æ˜¯é‚£ç§åŠ¨ç‰©ï¼Œnameåªèƒ½æœªçŸ¥ public int age = 15; //åŠ¨ç‰©ä»¬çš„å¹´é¾„ //è¢«abstractä¿®é¥°çš„æ–¹æ³•è¢«ç§°ä¸ºæŠ½è±¡æ–¹æ³• public abstract void cry(); //åŠ¨ç‰©ä¼šå«ï¼Œä½†æ¯ä¸ªåŠ¨ç‰©çš„å«å£°éƒ½å®Œå…¨ä¸ä¸€æ ·ï¼Œæœ‰çš„ç”šè‡³ä¸ä¼šå«ï¼Œé‚£\"å«\"å°±åº”è¯¥æ˜¯ä¸€ä¸ªæ ‡å‡†ï¼Œä½œä¸ºåŠ¨ç‰©çš„æ ‡å‡†ï¼ŒåŠ¨ç‰©æœ¬èº«åªè¦å®šä¹‰å¥½è¿™ä¸ªæ ‡å‡†å°±å¥½äº†ï¼Œå…¶ä½™äº¤ç»™å…·ä½“çš„åŠ¨ç‰©ï¼ˆå­ç±»ï¼‰å»å®ç° public void eat() { //è´Ÿè´£è¿›é£Ÿçš„æ–¹æ³• System.out.println(this.name + \"æ­£åœ¨è¿›é£Ÿ\"); } public void setName(String name) { this.name = name; } public void setAge(int age) { this.age = age; } } æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒæŠ½è±¡æ–¹æ³•æ²¡æœ‰ä»»ä½•å®ç°ï¼Œæ‰€ä»¥ç§°å®ƒä¸ºä¸€ä¸ªæ ‡å‡†ï¼Œæ‰€æœ‰ç›´ç³»å­ç±»éƒ½å¿…é¡»å®ç°è¿™ä¸ªæ ‡å‡†ï¼Œè¿™æ—¶Catç±»ç»§æ‰¿äº†Animalç±»ï¼Œå¦‚æœä¸å®ç°cryæ–¹æ³•ï¼Œè¯­æ³•ä¸Šå°±ä¼šæŠ¥é”™ï¼š ç°åœ¨æˆ‘ä»¬åªèƒ½è®©Catç±»å®ç°è¿™ä¸ªæŠ½è±¡æ–¹æ³•ï¼š è¿™å°±ç›¸å½“äºå¼ºåˆ¶è®©å­ç±»å»é‡å†™cryæ–¹æ³•ï¼Œäº‹å®ä¸Šç¡®å®éœ€è¦æ¯ä¸ªåŠ¨ç‰©éƒ½å®ç°è‡ªå·±çš„cryæ–¹æ³•ï¼Œä½†æ˜¯åƒeatè¿™ç§æ–¹æ³•å°±æ²¡æœ‰å¿…è¦è¿™æ ·åšï¼Œå› ä¸ºå¤§éƒ¨åˆ†åŠ¨ç‰©éƒ½éœ€è¦è¿›é£Ÿä¸”éƒ½æ˜¯ç”¨å˜´è¿›é£Ÿçš„ï¼Œå¤§åŒå°å¼‚ï¼Œå¦‚æœçœŸçš„å­˜åœ¨ä¸ä¸€æ ·çš„åƒä¸œè¥¿çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå°±è·Ÿä¹‹å‰ä¸€æ ·é‡å†™å°±å¥½äº†ï¼Œä½†å¤§éƒ¨åˆ†åŠ¨ç‰©éƒ½ä¸éœ€è¦é‡å†™eatæ–¹æ³•ï¼Œçˆ¶ç±»Animalé‡Œçš„å·²ç»å¤Ÿç”¨äº†ï¼Œè¿™æ˜¯åœ¨å‘Šè¯‰ä½ ä»€ä¹ˆæ—¶å€™éœ€è¦ææŠ½è±¡æ–¹æ³•ï¼Œä»€ä¹ˆæ—¶å€™ä¸éœ€è¦ã€‚ ç°åœ¨ä½ çŸ¥é“äº†ï¼Œæœ‰çš„æ–¹æ³•éœ€è¦è¢«æŠ½è±¡ï¼Œé‚£å°±å®šä¹‰æŠ½è±¡æ–¹æ³•ï¼Œå› ä¸ºå­˜åœ¨æŠ½è±¡æ–¹æ³•ï¼Œæ‰€ä»¥ç±»å¿…é¡»è¢«å£°æ˜ä¸ºæŠ½è±¡ç±»ï¼ˆabstractå…³é”®è¯ï¼‰ã€‚ æŠ½è±¡ç±»çš„ç‰¹ç‚¹ï¼š æŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼ˆä¹Ÿå°±æ˜¯è¯´ä¸å¯ä»¥åˆ©ç”¨newå…³é”®è¯å®ä¾‹åŒ–ä¸€ä¸ªæŠ½è±¡ç±»ï¼‰ ç”±äº1çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬è®¤ä¸ºï¼ŒæŠ½è±¡ç±»æ˜¯ä¸ºç»§æ‰¿è€Œç”Ÿçš„ï¼Œå¦‚æœä½ å®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè€Œå®ƒæ²¡æœ‰ä»»ä½•å­ç±»ï¼Œé‚£ä¹ˆè¿™ä¸ªæŠ½è±¡ç±»å°±æ²¡æœ‰ä»»ä½•æ„ä¹‰ æŠ½è±¡ç±»ä¸ä¸€å®šæœ‰æŠ½è±¡æ–¹æ³•ï¼Œä½†æœ‰æŠ½è±¡æ–¹æ³•çš„ç±»ä¸€å®šæ˜¯æŠ½è±¡ç±» æŠ½è±¡ç±»å¯ä»¥ç»§æ‰¿æŠ½è±¡ç±»ï¼Œå½“ç»§æ‰¿äº†æŠ½è±¡ç±»æ—¶ï¼Œå­ç±»æŠ½è±¡ç±»ä¹Ÿå¯ä»¥ä¸å®ç°å…¶çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•ï¼Œå…¨éƒ¨äº¤ç»™éæŠ½è±¡çš„å­ç±»å»åš æŠ½è±¡ç±»ä¹Ÿå¯ä»¥ç»§æ‰¿æ™®é€šç±»ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©é‡å†™æ™®é€šç±»çš„æ–¹æ³•ï¼Œæ›´ç¥å¥‡çš„æ˜¯ï¼Œå®ƒè¿˜å¯ä»¥è®©é€šè¿‡é‡å†™ï¼Œè®©æ™®é€šç±»çš„æ–¹æ³•å˜æˆä¸€ä¸ªæŠ½è±¡æ–¹æ³• æŠ½è±¡ç±»è™½ç„¶ä¸å¯ä»¥è¢«å®ä¾‹åŒ–ï¼Œä½†æ˜¯å®ƒä»ç„¶å­˜åœ¨æ„é€ å™¨ï¼ˆè¿™æ˜¯å¥åºŸè¯ï¼ŒæŠ½è±¡ç±»æ˜¯å¤©ç”Ÿçš„çˆ¶ç±»ï¼Œçˆ¶ç±»æ„é€ å™¨åœ¨å­ç±»è¢«å®ä¾‹åŒ–çš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨ä¸€æ¬¡ï¼Œæ‰€ä»¥ä½œä¸ºå¤©ç”Ÿçš„çˆ¶ç±»ï¼Œå®ƒå¿…æœ‰æ„é€ å™¨ï¼‰ ğŸŒµ æ€è€ƒï¼š ç°åœ¨Animalå®šä¹‰å¦‚ä¸‹ï¼š Catç±»æ˜¯å®ƒçš„å­ç±»ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š ç»“åˆå‰é¢å¯¹ç»§æ‰¿å’Œå¤šæ€ä»¥åŠæœ¬éƒ¨åˆ†å¯¹æŠ½è±¡ç±»çš„ç†è§£ï¼Œè¯·é—®å¦‚ä¸‹æµ‹è¯•ä»£ç è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ 1.11ï¼šä¸‡ç±»ã®çˆ¶-Objectä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œä»»ä½•å¯¹è±¡éƒ½è‡ªåŠ¨æœ‰è¿™äº›æ–¹æ³•ï¼š è¿™æ˜¯å› ä¸ºç±»è¢«å®šä¹‰å‡ºæ¥ï¼Œå°±éšè—ç»§æ‰¿äº†ä¸€ä¸ªçˆ¶ç±»ï¼Œåå«Objectï¼Œè¿™æ˜¯javaè‡ªå¸¦çš„ç±»ï¼Œä¸éœ€è¦æ˜¾å¼çš„extendså‡ºæ¥ã€‚ äºŒã€å°è£…å°è£…å……æ»¡æˆ‘ä»¬ä»£ç ï¼Œè¿˜æ˜¯ä»¥å‰é¢çš„ä¾‹å­ä¸ºå‡†ï¼Œæˆ‘ä»¬è®¤ä¸ºå¯¹ä¸€ç±»æ“ä½œä½¿ç”¨ä¸€ä¸ªæ–¹æ³•å®šä¹‰æ¥åœˆèµ·æ¥ï¼Œå°±æ˜¯å°è£…ï¼Œæ¯”å¦‚eatã€cryç­‰æ–¹æ³•ï¼Œä¾‹å­é‡Œé¢å¾ˆç®€å•ï¼Œåªæ‰“å°äº†ä¸€å¥è¯ï¼Œä½†å®é™…å¼€å‘ä¸­ï¼Œä¸€ä¸ªæ–¹æ³•å¯èƒ½ä¼šå®Œæˆå¾ˆå¤æ‚çš„æ“ä½œï¼Œè¿™é‡Œæ‹¿ä¹‹å‰ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜é—®é¢˜ï¼š ä»£ç å—36123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354public class Cat { public int gender; protected int age; int color; private String name; public Cat(int gender, int age, int color, String name) { this.gender = gender; this.age = age; this.color = color; this.name = name; } public void cry(Cat cat) { if (this.tooOld()) { //é€šè¿‡tooOldæ¥åˆ¤æ–­å½“å‰è¿™åªçŒ«æ˜¯å¦å¹´é¾„å¤ªå¤§äº† System.out.println(\"å«ä¸åŠ¨äº†...\"); } else { System.out.println(\"å–µå–µå–µ~\"); } } public void eat() { System.out.println(\"è¦æ°é¥­çš„å˜›\"); } protected void emm() { if (this.tooOld()) { //é€šè¿‡tooOldæ¥åˆ¤æ–­å½“å‰è¿™åªçŒ«æ˜¯å¦å¹´é¾„å¤ªå¤§äº† System.out.println(\"éªšä¸åŠ¨äº†...\"); } else { System.out.println(\"çŒªè‚‰å·å’Œåƒå±‚é¢ä¸å­˜åœ¨äºŒé€‰ä¸€ï¼Œæˆ‘å…¨éƒ½è¦ï¼\"); } } void run() { if (tooOld()) { //é€šè¿‡tooOldæ¥åˆ¤æ–­å½“å‰è¿™åªçŒ«æ˜¯å¦å¹´é¾„å¤ªå¤§äº† System.out.println(\"è·‘ä¸åŠ¨äº†...\"); } else if (age &gt; 10) { System.out.println(\"å¥”è·‘é€Ÿåº¦ï¼š10km/h\"); } else { System.out.println(\"å¥”è·‘é€Ÿåº¦ï¼š15km/h\"); } } ...çœç•¥... //è¢«æ‹†å‡ºæ¥çš„é€»è¾‘å—ï¼Œå› ä¸ºè¿™æ®µé€»è¾‘ä¼šå‡ºç°åœ¨å¤šä¸ªæ–¹æ³•é‡Œï¼Œå› æ­¤å•æ‹†å‡ºæ¥å°è£…æˆä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•å»ºè®®è®¾ç½®æˆprivateæƒé™çš„ï¼Œå› ä¸ºä»…é™æœ¬ç±»å†…è°ƒç”¨ private boolean tooOld() { return this.age &gt; 15; //ç»è¿‡æœ¬å±‚å°è£…ï¼Œåªè¦éœ€è¦è¿™æ®µé€»è¾‘çš„åœ°æ–¹ï¼Œç›´æ¥è°ƒç”¨ä¸‹è¿™ä¸ªæ–¹æ³•å³å¯ï¼Œæœ¬ä¾‹å¤ªç®€å•ï¼Œå› ä¸ºåªåšäº†ageå¤§å°åˆ¤æ–­ï¼Œå®é™…å¼€å‘é‡Œå¯ä»¥æŠŠæ›´å¤æ‚çš„ä¸”é‡å¤åº¦è¿‡é«˜çš„ä»£ç å—åƒè¿™æ ·æ‹†å‡ºæ¥ï¼Œå°è£…æˆä¸€ä¸ªæ–¹æ³•æä¾›æœåŠ¡ }} é€šè¿‡æœ¬ä¾‹ï¼Œæˆ‘ä»¬çŸ¥é“äº†å°è£…çš„ç›®çš„æ˜¯å‡å°‘ä»£ç çš„é‡å¤åº¦ï¼Œæé«˜å¤ç”¨ç‡ï¼Œè¿™ç‚¹æ˜¯ä¸æ˜¯è·Ÿç»§æ‰¿ä¹Ÿå¾ˆåƒï¼Ÿç»§æ‰¿çš„æ„ä¹‰ä¹‹ä¸€ä¹Ÿæ˜¯ä¸ºäº†è§£å†³ä»£ç é‡å¤åº¦çš„ã€‚ å°è£…ä»…ä»…åªæ˜¯ä¸ºäº†è§£å†³é‡å¤åº¦å—ï¼Ÿå¹¶ä¸æ˜¯ï¼Œé€šè¿‡ä¹‹å‰çš„Animalçš„ä¾‹å­ï¼Œæˆ‘ä»¬å‘ç°åƒageã€nameè¿™ç§å±æ€§çš„èµ‹å€¼æ“ä½œä¹Ÿè¢«å°è£…æˆäº†ä¸€ä¸ªä¸ªæ–¹æ³•ï¼ˆsetNameå’ŒsetAgeï¼‰ï¼Œè€ŒAnimalé‡Œçš„nameå’Œageå…¨æ˜¯privateçš„ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿä¸ºä»€ä¹ˆä¸è®©ageå’Œnameå˜æˆprotectedæˆ–publicè¿™ç§æƒé™å‘¢ï¼Ÿè®©åˆ«çš„ç±»ç›´æ¥èµ‹å€¼ä¸æ˜¯æ›´å¥½ï¼Ÿä¸ºå•¥è¿˜è¦å¤šæ­¤ä¸€ä¸¾æä¿©ä¸“é—¨èµ‹å€¼çš„æ–¹æ³•ï¼Ÿ è¿™å°±ä½“ç°äº†å°è£…çš„å¦å¤–ä¸€å±‚æ„ä¹‰ï¼šéš”ç¦» ç°åœ¨æˆ‘ä»¬è¯•ç€å°†Animalé‡Œçš„ageå˜æˆpublicçš„ï¼Œæ¥çœ‹çœ‹ä¸‹é¢ï¼š ä»£ç å—3712Animal animal = new Animal();animal.age = 10000; //ç”±äºAnimalçš„ageå˜æˆpublicå…¬å¼€äº†ï¼Œå› æ­¤åœ¨å¤–ç•Œå¯ä»¥éšæ„å¯¹å…¶èµ‹å€¼ ä½†æ˜¯Animalè¿™æ—¶ä¸å¹²äº†ï¼Œä½ è§è¿‡èƒ½æ´»10000å²çš„ç”Ÿç‰©å—ï¼Ÿï¼Ÿå› æ­¤AnimalæŠŠè‡ªå·±çš„ageå°äº†èµ·æ¥ï¼Œé¦–å…ˆæŠŠè®¿é—®æƒé™å˜æˆprivateï¼Œç„¶åæä¾›ä¸€ä¸ªsetAgeæ–¹æ³•ç”¨æ¥ç»™ageèµ‹å€¼ï¼ŒsetAgeå°±æ˜¯Animalå¯¹å¤–å°è£…çš„ä¸€ä¸ªä¸“é—¨ç»™ageèµ‹å€¼çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™Animalå°±ç”±ä¹‹å‰çš„è¢«åŠ¨çŠ¶æ€å˜æˆä¸»åŠ¨çŠ¶æ€äº†ï¼Œå¦‚æœä½ ä¸æƒ³è®©åˆ«äººè®¾ç½®çš„ageå¤ªè¿‡åˆ†ï¼Œå°±å¯ä»¥åœ¨setAgeé‡Œåšé™åˆ¶ï¼Œåæ­£æ˜¯è‡ªå·±çš„æ–¹æ³•å˜›ï¼Œè¿˜ä¸æ˜¯æƒ³æ€ä¹ˆè®¾è®¡æ€ä¹ˆè®¾è®¡ï¼Œè®©æˆ‘ä»¬æ¥æ”¹ä¸€ä¸‹Animalé‡ŒsetAgeçš„é€»è¾‘ï¼š ä»£ç å—381234567public void setAge(int age) { if (age &gt; 10000) { //å½“ä¼ å…¥çš„ageè¶…è¿‡1wæ—¶ï¼Œè¾“å‡ºè¿™å¥è¯åé—®å¯¹æ–¹ System.out.println(\"è¿™ç§ç”Ÿç‰©ä½ ç»™æˆ‘æ‰¾æ¥ä¸ªåº·åº·ï¼Ÿ\"); } else { //å¦åˆ™çš„è¯å°±ç»™è‡ªå·±çš„ageèµ‹å€¼ this.age = age; }} çœ‹çœ‹ï¼Œè¿™æ ·ageçš„èµ‹å€¼å°±å®Œå…¨è¢«éš”ç¦»è¿›æœ¬ç±»å†…äº†ï¼Œå¤–ç•Œè¿›è¡Œèµ‹å€¼æ—¶å°±ä¸æ•¢é‚£ä¹ˆæ”¾è‚†äº†~ å°è£…çš„æ„ä¹‰ï¼š å°è£…çš„æ„ä¹‰åœ¨äºä¿æŠ¤æˆ–è€…é˜²æ­¢ä»£ç ï¼ˆæ•°æ®ï¼‰è¢«æˆ‘ä»¬æ— æ„ä¸­ç ´åã€‚ ä¿æŠ¤æˆå‘˜å±æ€§ï¼Œä¸è®©ç±»ä»¥å¤–çš„ç¨‹åºç›´æ¥è®¿é—®å’Œä¿®æ”¹ï¼› éšè—æ–¹æ³•ç»†èŠ‚ è¿™ä¹Ÿæ˜¯ä¸ºå•¥æˆ‘ä»¬åœ¨å®šä¹‰ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå±æ€§ç»å¸¸è¢«è®¾ç½®æˆprivateè®¿é—®çº§åˆ«çš„ï¼Œç„¶åé€šè¿‡å®šä¹‰èµ‹å€¼æ–¹æ³•æ¥è®©å¤–ç•Œç»™è‡ªå·±çš„å±æ€§èµ‹å€¼ã€‚ å…³äºå¯¹è±¡å°è£…çš„åŸåˆ™: å†…èšï¼šå†…èšæ˜¯æŒ‡ä¸€ä¸ªæ¨¡å—å†…éƒ¨å„ä¸ªéƒ¨åˆ†ä¹‹é—´çš„å…³è”ç¨‹åº¦ è€¦åˆï¼šè€¦åˆæŒ‡å„ä¸ªæ¨¡å—ä¹‹å‰çš„å…³è”ç¨‹åº¦ å°è£…åŸåˆ™ï¼šéšè—å¯¹è±¡çš„å±æ€§å’Œå®ç°ç»†èŠ‚ï¼Œä»…å¯¹å¤–å…¬å¼€è®¿é—®æ–¹æ³•ï¼Œå¹¶ä¸”æ§åˆ¶è®¿é—®çº§åˆ« åœ¨é¢å‘å¯¹è±¡æ–¹æ³•ä¸­ï¼Œç”¨ç±»æ¥å®ç°ä¸Šé¢çš„è¦æ±‚ã€‚ç”¨ç±»å®ç°å°è£…ï¼Œç”¨å°è£…æ¥å®ç°é«˜å†…èšï¼Œä½è€¦åˆã€‚ â†‘ä¸Šé¢çš„è¯å…ˆè¯»ä¸€ä¸‹ï¼Œåšå¤šäº†ä¸œè¥¿è‡ªç„¶å°±æ‡‚äº†ï¼Œæˆ‘ä»¬åšå¼€å‘æ—¶æ‰€ä½œçš„å°è£…ã€å¤šæ€ç­‰ï¼Œéƒ½æ˜¯ä¸ºäº†è¿™ä¸€ä¸ªç›®æ ‡ï¼šé«˜å†…èšã€ä½è€¦åˆæ¥è¿›è¡Œçš„ã€‚","link":"/2020/03/10/LV2-4%EF%BC%9A%E7%B1%BB%E7%9A%84%E7%89%B9%E6%80%A7%E3%80%81%E5%85%B3%E7%B3%BB/"},{"title":"LV2-3ï¼šå˜é‡çš„ä½œç”¨åŸŸ","text":"é€šè¿‡å¯¹å‰é¢å¾ˆå¤šä»£ç çš„äº†è§£ï¼Œæˆ‘ä»¬å‘ç°å˜é‡çš„å£°æ˜é€šå¸¸å‘ç”Ÿåœ¨ä¸€ä¸ªå¤§æ‹¬å·å†…ï¼Œè¢«å£°æ˜åœ¨æŸä¸ªå¤§æ‹¬å·å†…çš„å˜é‡ï¼Œå®ƒçš„ä½œç”¨åŸŸå°±å¯¹åº”çš„å¤§æ‹¬å·å†…ï¼Œä¸å¤Ÿç›´è§‚ï¼Ÿæˆ‘ä»¬æ¥é€šè¿‡ä¸€å¼ å›¾æ¥è¯´æ˜ä¸€ä¸‹ï¼š å¦‚å›¾æ‰€ç¤ºï¼Œä¸€ä¸ªç±»å®šä¹‰ä»£ç ï¼Œè¯·ä»”ç»†æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºä»”ç»†é˜…è¯»æ¯ä¸€æ®µè¯´æ˜ã€‚ æ¯ä¸€ä¸ªâ€{}â€çœ‹åšä¸€ä¸ªåŸŸï¼Œå˜é‡åœ¨å“ªä¸ªåŸŸåšçš„å£°æ˜ï¼Œåˆ™åœ¨å“ªä¸ªåŸŸç”Ÿæ•ˆï¼Œä¸Šå›¾å·²ç»æŒ‰ç…§é¢œè‰²æ ‡æ˜ä¸åŒçš„åŸŸäº†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå˜é‡çš„å£°æ˜æ˜¯åœ¨åŒåŸŸå†…ä¸å…è®¸é‡åçš„ï¼Œä¸Šè¿°çš„loopTestçš„æ–¹æ³•åŸŸé‡Œçš„ageè·Ÿç±»åŸŸé‡Œçš„ageé‡åï¼Œä½†æ˜¯ç¨‹åºå¹¶ä¸ä¼šæŠ¥é”™ï¼Œå› ä¸ºä»–ä¿©ä½œç”¨åŸŸä¸ä¸€æ ·ã€‚","link":"/2020/03/05/LV2-3%EF%BC%9A%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F/"},{"title":"LV2-2ï¼šåŒ…çš„å®šä¹‰ã€ç±»çš„åŸºæœ¬ç»„æˆã€è®¿é—®æƒé™ä¿®é¥°ç¬¦","text":"ä¸€ã€åŒ…åŒ…è¯´ç™½äº†å°±æ˜¯ä¸€ä¸ªä¸ªçš„æ–‡ä»¶å¤¹ï¼Œåœ¨javaä¸­ï¼Œæ‰€æœ‰çš„ç±»æŒ‰ç…§å…¶ç‰¹ç‚¹ï¼Œä»¥åŒ…çš„å½¢å¼è¿›è¡ŒåšåŒºåˆ†ï¼ŒåŒ…çš„ç›®å½•å±‚çº§å‘½åè§„åˆ™ä¸€èˆ¬æ˜¯å…¬å¸çš„ç½‘å€å€’è¿‡æ¥ï¼Œä¾‹å¦‚ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œ.javaæ–‡ä»¶å†…å°±æ˜¯å­˜æ”¾çš„javaä»£ç ï¼Œä¾‹å¦‚Cat.javaæ–‡ä»¶é‡Œé¢æ”¾çš„å°±æ˜¯ä¸Šä¸€èŠ‚é‡Œé‚£åªçŒ«çš„Catç±»çš„ä»£ç ï¼Œç”±äºç°åœ¨Catç±»æœ‰äº†ç›®å½•ï¼Œæ‰€ä»¥å®ƒå°±éœ€è¦åœ¨å¤´éƒ¨åŠ ä¸Šä¸€å¥è¯ï¼š ä»£ç å—112345package com.bilibili.pet; //è¿™å¥è¯ä½äºä»£ç é¦–éƒ¨ï¼Œç”¨äºæ ‡è¯†å½“å‰ç±»çš„javaæ–‡ä»¶åœ¨å“ªä¸ªç›®å½•ä¸‹public class Cat { //ä»£ç çœç•¥..} å› ä¸ºCatæœ‰äº†ç›¸å¯¹ç›®å½•ï¼Œè¿™é‡Œå°±éœ€è¦åŠ ä¸Špackageæ¥æ ‡è®°è‡ªå·±æ‰€åœ¨çš„ç›®å½•å±‚çº§ï¼Œå¦åˆ™æŠ¥é”™ã€‚ å†å›åˆ°å›¾1ä¸­ï¼Œæˆ‘ä»¬çœ‹ä¸‹åˆ†åŒ…çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Œä»å›¾1å¯ä»¥çœ‹åˆ°ï¼ŒåŸºç¡€åŒ…ä¸ºcom.bilibiliï¼ˆè¿™é‡Œæä¸€ä¸‹ï¼Œjavaä»£ç é‡Œçš„åŒ…ç›®å½•å¼•ç”¨éƒ½æ˜¯ä»¥â€œ.â€åšåˆ†éš”çš„ï¼Œè€Œä¸æ˜¯æ–œæ ï¼‰ï¼Œç„¶ååŸºç¡€åŒ…ä¸‹ç»†åˆ†äº†ä¿©åŒ…ï¼Œä¸€ä¸ªæ˜¯petï¼ˆå® ç‰©ï¼‰ï¼Œä¸€ä¸ªæ˜¯humanï¼ˆäººç±»ï¼‰ï¼Œè¿™ä¿©åŒ…ä¸‹åˆ†åˆ«æœ‰ä¸¤ä¸ªjavaæ–‡ä»¶ï¼Œpetä¸‹æ”¾çš„æ˜¯Catå’ŒDogï¼Œè€Œhumanä¸‹æ”¾çš„æ˜¯Boyå’ŒGirlï¼Œæ‰€ä»¥å…¶å®åŒ…å°±æ˜¯ç”¨æ¥ç»™ç±»åˆ†ç±»çš„ï¼ˆå¥—å¨ƒè­¦å‘Šï¼‰ï¼Œè¿™é‡Œå¯èƒ½ä¼šæ™•ï¼Œå› ä¸ºä¹‹å‰è¯´è¿‡ï¼Œç±»æ˜¯ç”¨æ¥æè¿°ä¸€ç±»äº‹ç‰©çš„å•å…ƒï¼Œé‚£ä¹ˆæ—¢ç„¶è¿™æ ·ï¼Œä¸ºå•¥è¿˜éœ€è¦ç”¨ç›®å½•å†åˆ†å‰²ä¸€å±‚åšåˆ†ç±»å‘¢ï¼Ÿè¿™å…¶å®æ˜¯ä¸€ä¸ªåˆ†ç±»å¤§å°æ–¹å‘çš„åˆ’åˆ†ï¼Œä¾‹å¦‚ï¼Œç²—ç•¥åˆ’åˆ†äººç±»åŒ…ä¸‹çš„ç±»å¯ä»¥åŒ…å«ç”·ç”Ÿã€å¥³ç”Ÿã€å­¦ç”Ÿã€è€å¸ˆï¼Œä½†æ˜¯åƒçŒ«ç‹—æ˜æ˜¾å’Œäººç±»ä¸æ˜¯ä¸€å›äº‹ï¼Œè¿™æ—¶å€™å°±éœ€è¦ç”¨ä¸€ç§æ›´é«˜å±‚çº§çš„ä¸œè¥¿æ¥åšéš”ç¦»ï¼ŒåŒ…å°±è¿™æ ·äº§ç”Ÿäº†ï¼Œå½“ç„¶è¿™ä¸ªæ˜¯æ²¡æœ‰ç»å¯¹æ ‡å‡†çš„ï¼Œåªè¦ä½ å–œæ¬¢ï¼Œå¯ä»¥æŒ‰ç…§ä½ çš„æ–¹å¼åšåˆ†åŒ…ï¼Œæ¯”å¦‚ï¼Œä½ ä»ç„¶å¯ä»¥è®¤ä¸ºï¼Œpetå’Œhumanä¸¤ä¸ªåŒ…å¯ä»¥åˆå¹¶ä¸ºbiologyï¼ˆç”Ÿç‰©ï¼‰ï¼Œå› ä¸ºä¸ç®¡ä½ æ˜¯äººç±»è¿˜æ˜¯å® ç‰©ï¼Œéƒ½æ˜¯ç”Ÿç‰©ï¼Œæ‰€ä»¥å¯¹äºåŒ…çš„åˆ’åˆ†ï¼Œæ˜¯ä¸ªâ€œå“²å­¦â€é—®é¢˜ï¼Œä¸è¿‡å…ˆä¸ç”¨æ‹…å¿ƒï¼Œç­‰å†™çš„å¤šäº†ï¼Œè‡ªç„¶å°±ä¼šåˆ’åˆ†äº†ï¼Œè¿™ä¸€éƒ¨åˆ†ä½ åªéœ€è¦çŸ¥é“åŒ…æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Œä»¥åŠåœ¨å­˜åœ¨åŒ…ç›®å½•çš„æƒ…å†µä¸‹ç±»è¦åŠ packageå£°æ˜å¤´å³å¯ã€‚ äºŒã€å¦‚ä½•ä½¿ç”¨ä»£ç å®šä¹‰ä¸€ä¸ªç±»ï¼Ÿ2.1ï¼šç±»çš„å®šä¹‰å’Œjavaæ–‡ä»¶ä¸Šä¸€èŠ‚å·²ç»çŸ¥é“Catç±»çš„ä»£ç äº†ï¼Œåªæ˜¯æ²¡æœ‰ç»†è¯´ä¸€ä¸ªç±»è¯¥å¦‚ä½•å®šä¹‰ï¼Œè¿™æ¬¡æˆ‘ä»¬æ¥è®²ä¸‹ç±»æ˜¯å¦‚ä½•å®šä¹‰çš„ï¼Œä»¥åŠå®ƒå’Œjavaæ–‡ä»¶æ˜¯ä»€ä¹ˆå…³ç³»ã€‚ é¦–å…ˆï¼Œæ–°å»ºä¸€ä¸ªå«Cat.javaçš„æ–‡ä»¶ï¼Œç„¶ååœ¨è¿™ä¸ªæ–‡ä»¶é‡Œå†™å…¥ä»¥ä¸‹ä»£ç ï¼š ä»£ç å—2123public class Cat { } ä¿å­˜ï¼Œè¿™æ ·ä¸€ä¸ªCatç±»å°±å°±å»ºå¥½äº†ï¼Œè¯¶ï¼Ÿï¼Ÿå°±è¿™ï¼Ÿ æ˜¯çš„ï¼Œæˆ‘ä»¬æ¥æ‹†è§£å’Œåˆ†æä¸€ä¸‹è¿™æ®µä»£ç ï¼š publicæ˜¯ä¸€ç§æƒé™ä¿®é¥°ç¬¦ï¼Œå¯ä»¥æ§åˆ¶è¢«ä¿®é¥°å†…å®¹çš„è®¿é—®æƒé™ï¼Œåœ¨ä»‹ç»å®Œç±»çš„æ‰€æœ‰æ¦‚å¿µä¹‹å‰ï¼Œä¸ä¼šæ¶‰åŠå®ƒçš„æ¦‚å¿µï¼Œè¿™é‡Œåªéœ€è¦è®°ä½ï¼Œä¸€ä¸ªjavaæ–‡ä»¶å…è®¸å®šä¹‰å¤šä¸ªclassï¼Œä½†åªå…è®¸æœ‰ä¸€ä¸ªpublicç±»ï¼Œè€Œä¸”è¿™ä¸ªpublicçš„ç±»åå­—ä¸€å®šè¦å’Œè¿™ä¸ªjavaæ–‡ä»¶çš„å‘½åä¸€è‡´ï¼Œæ¯”å¦‚ä¾‹å­é‡Œçš„publicçš„Catç±»å°±å®šä¹‰åœ¨Cat.javaé‡Œï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨ä¸€ä¸ªjavaæ–‡ä»¶é‡ŒåŠ å¤šä¸ªclassï¼Œä½†æ˜¯publicçš„åªèƒ½æœ‰ä¸€ä¸ªã€‚ ä»£ç å—2é‡Œåªæ˜¯å®šä¹‰äº†ä¸€ä¸ªç©ºç±»ï¼Œé€šè¿‡ä¸Šä¸€èŠ‚å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ä¸€ä¸ªç±»æ‰€åŒ…å«çš„å†…å®¹å¤§æ¦‚æœ‰ä¸¤å¤§ç±»ï¼Œä¸€ä¸ªæ˜¯å±æ€§ï¼Œä¸€ä¸ªæ˜¯æ–¹æ³•ï¼ˆä¹Ÿå«å‡½æ•°ï¼Œæˆ‘ä»¬åé¢ç»Ÿç§°æ–¹æ³•ï¼‰ï¼Œæ‰€æœ‰çš„ç±»éƒ½ç¬¦åˆè¿™ä¸ªç»“æ„ï¼Œç±»å¯ä»¥ä¸å®šä¹‰ä»»ä½•å±æ€§ï¼Œä¹Ÿå¯ä»¥ä¸å®šä¹‰ä»»ä½•æ–¹æ³•ï¼Œè¿™ä¸ªæ²¡æœ‰ç¡¬æ€§è¦æ±‚ã€‚ 2.2ï¼šç±»çš„å±æ€§å’Œæ–¹æ³•ä¸Šä¸€èŠ‚ä»‹ç»è¿‡ï¼Œè¿™ä¸€èŠ‚ç»†åˆ†æä¸‹ã€‚ é€šè¿‡ä¸Šä¸€èŠ‚çš„Catæˆ‘ä»¬ä¼šå‘ç°ç±»çš„å±æ€§å…¶å®ä¹Ÿæ˜¯å„ç§å˜é‡ç»„æˆçš„ï¼Œè¿™ç§å˜é‡åœ¨ç±»å®šä¹‰é‡Œå«åšç±»çš„å±æ€§ï¼ˆä¹‹å‰ä¹Ÿè¯´è¿‡ï¼Œç±»æœ¬èº«æ˜¯ä¸€ç§ä¿¡æ¯æ¨¡æ¿ï¼Œè€Œç±»äº§ç”Ÿçš„å¯¹è±¡æ‰æ˜¯æˆ‘ä»¬éœ€è¦è®¿é—®çš„å®é™…æ•°æ®ï¼‰ï¼Œè€Œåœ¨ç±»äº§ç”Ÿçš„å¯¹è±¡é‡Œå«åšå¯¹è±¡çš„æˆå‘˜å˜é‡ï¼Œæˆå‘˜å˜é‡åœ¨å¯¹è±¡å†…éƒ¨æ˜¯å¯ä»¥åœ¨ä»»æ„åœ°æ–¹éšæ„è®¿é—®çš„ï¼Œæ¯”å¦‚Catç±»é‡Œæ‰€æœ‰æ–¹æ³•éƒ½æ˜¯å¯ä»¥ç›´æ¥è®¿é—®åˆ°å¯¹è±¡å†…çš„æˆå‘˜å˜é‡çš„ã€‚æˆå‘˜å˜é‡çš„ä½œç”¨åŸŸå°±æ˜¯æ•´ä¸ªç±»å¯¹è±¡ï¼Œå¦‚æœåˆ«çš„åœ°æ–¹éœ€è¦ç”¨åˆ°å®ƒä»¬ï¼Œåˆ™éœ€è¦é€šè¿‡å…¶å¯¹åº”çš„å¼•ç”¨å˜é‡è¿›è¡Œè®¿é—®ã€‚ æˆ‘ä»¬ç°åœ¨å†æŠŠCatç±»æ”¹é€ ä¸‹ï¼š ä»£ç å—31234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677//çŒ«ç±»çš„å®šä¹‰public class Cat { //æ€§åˆ«ï¼š0é›Œï¼Œ1é›„ private int gender; //å¹´é¾„ private int age; //æ¯›è‰²ï¼š1é»‘ï¼Œ2ç™½ private int color; //æ˜µç§° private String name; //æ„é€ æ–¹æ³•ï¼Œç”¨äºæ„é€ ä¸€ä¸ªç±»å¯¹è±¡ public Cat(int gender, int age, int color, String name) { //é€šè¿‡ä¼ å…¥çš„å‚æ•°ï¼Œåˆå§‹åŒ–è‡ªå·±å¯¹è±¡å†…çš„æ¯ä¸€ä¸ªæˆå‘˜å˜é‡ this.gender = gender; this.age = age; this.color = color; this.name = name; } public void cry() { if (this.tooOld()) { //é€šè¿‡æœ¬ç±»çš„ç§æœ‰æ–¹æ³•æ¥åˆ¤æ–­å½“å‰è¿™åªçŒ«æ˜¯å¦å¹´é¾„å¤ªå¤§äº† System.out.println(\"å«ä¸åŠ¨äº†...\"); } else { System.out.println(\"å–µå–µå–µ~\"); } } public void eat() { System.out.println(\"è¦æ°é¥­çš„å˜›\"); } public void emm() { if (this.tooOld()) { System.out.println(\"éªšä¸åŠ¨äº†...\"); } else { System.out.println(\"çŒªè‚‰å·å’Œåƒå±‚é¢ä¸å­˜åœ¨äºŒé€‰ä¸€ï¼Œæˆ‘å…¨éƒ½è¦ï¼\"); } } public void run() { if (tooOld()) { System.out.println(\"è·‘ä¸åŠ¨äº†...\"); } else if (age &gt; 10) { System.out.println(\"å¥”è·‘é€Ÿåº¦ï¼š10km/h\"); } else { System.out.println(\"å¥”è·‘é€Ÿåº¦ï¼š15km/h\"); } } //è¿™ä¸ªæ–¹æ³•ç”¨æ¥ä»‹ç»è‡ªå·± public String intro() { String gender = this.gender == 0 ? \"æ¯\" : \"å…¬\"; String color = this.color == 1 ? \"é»‘è‰²\" : \"ç™½è‰²\"; //å°†è¿™äº›å±æ€§å€¼æ‹¼æˆä¸€å¥é—´æ¥è¿”å›å‡ºå» String result = \"æˆ‘æ˜¯ä¸€åªåå«\" + name + \"æœ‰ç€\" + color + \"çš®æ¯›çš„\" + age + \"å²\" + gender + \"çŒ«\"; return result; } //ç»™çŒ«åŠ å¹´é¾„çš„æ–¹æ³• public void plusAge(int plusCount) { this.age += plusCount; } //è¿”å›çŒ«å½“å‰çš„å¹´é¾„ public int getCurrentAge() { return this.age; } //privateä¿®é¥°çš„ç§æœ‰æ–¹æ³•ï¼Œç§æœ‰æ–¹æ³•ä»…å…è®¸æœ¬ç±»å†…è®¿é—® private boolean tooOld() { return this.age &gt; 15; //å¦‚æœå¹´é¾„è¶…è¿‡15å²ï¼Œåˆ™è¿”å›true }} æˆ‘ä»¬æ”¹é€ äº†ä¹‹å‰çš„æ—§æ–¹æ³•ï¼Œè®©çŒ«çš„è¡Œä¸ºæ ¹æ®è‡ªå·±çš„å¹´é¾„çš„ä¸åŒå†æ¬¡å‘ç”Ÿæ”¹å˜ï¼Œæ­¤å¤–æ–°å¢äº†introæ–¹æ³•ç”¨æ¥è¿”å›å‡ºå»è‡ªå·±çš„ç®€ä»‹ï¼ŒplusAgeç”¨æ¥å¢åŠ çŒ«çš„å¹´é¾„ï¼ŒgetCurrentAgeç”¨æ¥è¿”å›çŒ«å½“å‰çš„å¹´é¾„ï¼ŒtooOldä½¿ç”¨äº†privateä¿®é¥°ï¼Œè·Ÿpublicä¸€æ ·å±äºè®¿é—®æƒé™ï¼ŒåŠ äº†è¿™ä¸ªè®¿é—®æƒé™æ„å‘³ç€åœ¨åˆ«çš„åœ°æ–¹é€šè¿‡å¯¹è±¡æ— æ³•è°ƒç”¨è¯¥æ–¹æ³•ï¼Œåªèƒ½ç”±å¯¹è±¡å†…éƒ¨è§¦å‘è°ƒç”¨ï¼Œåé¢ä¼šç€é‡ä»‹ç»è®¿é—®æƒé™ä¿®é¥°ç¬¦ã€‚æ­¤å¤–ï¼Œæ–¹æ³•åˆåˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œæ¯”å¦‚getCurrentAgeï¼Œä¸€ç§æ˜¯æ²¡æœ‰è¿”å›å€¼çš„ï¼Œæ¯”å¦‚plusAgeï¼Œå®ƒä»¬çš„åŒºåˆ†æ–¹å¼åœ¨äºè®¿é—®æƒé™ä¿®é¥°ç¬¦publicåé¢æ˜¯voidè¿˜æ˜¯å…¶å®ƒç±»å‹ï¼Œå¦‚æœæ˜¯voidåˆ™è¯´æ˜æ­¤æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œå¦åˆ™å°±æ˜¯è¿”å›å€¼å¯¹åº”çš„ç±»å‹ï¼ˆå¦‚intã€longï¼Œè¿”å›ç»“æœä¸ºå¼•ç”¨å˜é‡çš„è¯ï¼Œåˆ™ä¸ºå¯¹åº”çš„ç±»ï¼Œä¾‹å¦‚Stringã€Catç­‰ï¼‰ã€‚ ç°åœ¨æ‹¿ç€è¿™ä¸ªCatç±»æ¥åšä¸ªè¯•éªŒï¼Œæˆ‘ä»¬ä¹‹å‰æœ‰è¯´è¿‡ï¼Œè®¿é—®å¯¹è±¡é‡Œé¢çš„æ–¹æ³•æˆ–è€…å±æ€§æ—¶ï¼Œéœ€è¦é€šè¿‡å¼•ç”¨å˜é‡æ¥è¿›è¡Œè®¿é—®ï¼Œå¼•ç”¨å˜é‡åˆæ˜¯é€šè¿‡åˆå§‹åŒ–ç±»å¯¹è±¡æ¥çš„ï¼Œåˆå§‹åŒ–ç±»å¯¹è±¡ä¹‹å‰è¯´è¿‡ï¼Œé€šè¿‡newåé¢åŠ ä¸Šæ„é€ æ–¹æ³•æ¥è¿›è¡Œæ„é€ ä¸€ä¸ªç±»å¯¹è±¡ï¼š ä»£ç å—41234567891011121314151617181920212223242526272829303132public static void main(String[] args) { //é€ å‡ºä¸¤åªçŒ«ï¼Œç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸¤ä¸ªå¼•ç”¨å˜é‡ï¼Œå¯ä»¥åˆ©ç”¨å®ƒä»¬è®¿é—®å¯¹è±¡å®ä½“äº† Cat cat1 = new Cat(0, 1, 0, \"å’²å·\"); Cat cat2 = new Cat(1, 5, 1, \"é¾Ÿç”°å¿—æ–Œ\"); String cat1Into = cat1.intro(); //è¿™ä¸ªæ–¹æ³•ä¼šè¿”å›å¯¹åº”çŒ«å’ªçš„ç®€ä»‹ï¼Œè¿™é‡Œç”¨ä¸€ä¸ªå˜é‡æ¥æ”¶ String cat2Into = cat2.intro(); System.out.println(cat1Into); //æ‰“å°ç¬¬ä¸€åªçŒ«çš„ç®€ä»‹ System.out.println(cat2Into); //æ‰“å°ç¬¬äºŒåªçŒ«çš„ç®€ä»‹ System.out.println(\"------------------------------------\"); //ä¸ºæ–¹ä¾¿è§‚å¯Ÿï¼Œè¿™é‡Œç”¨åˆ†å‰²çº¿éš”å¼€ cat1.emm(); //ç”±äºè¿™é‡Œcat1å¯¹åº”çš„çŒ«å¯¹è±¡é‡Œçš„ageä¸º1ï¼Œå› æ­¤è¿™é‡Œä»ç„¶å¯ä»¥æ‰“å°è¿·æƒ‘è¯­å½• cat2.emm(); //ç”±äºè¿™é‡Œcat2å¯¹åº”çš„çŒ«å¯¹è±¡é‡Œçš„ageä¸º5ï¼Œå› æ­¤è¿™é‡Œä»ç„¶å¯ä»¥æ‰“å°è¿·æƒ‘è¯­å½• System.out.println(\"------------------------------------\"); cat1.plusAge(15); //è®©å·æ¡‘è€15å²ï¼Œç”±äºplusAgeçš„é€»è¾‘ä¸ºåŸageåŠ ä¸Šä¼ å…¥çš„å¹´é¾„å¢é‡ï¼Œæ‰€ä»¥ç°åœ¨çš„å’²å·åº”ä¸º16å² cat2.plusAge(6); //è®©é¾Ÿç”°è€6å²ï¼Œç”±äºplusAgeçš„é€»è¾‘ä¸ºåŸageåŠ ä¸Šä¼ å…¥çš„å¹´é¾„å¢é‡ï¼Œç°åœ¨çš„é¾Ÿç”°å¿—æ–Œåº”ä¸º11å² //é€šè¿‡getCurrentAgeæŠŠäºŒä½çš„å¹´é¾„æ‹¿åˆ° int cat1Age = cat1.getCurrentAge(); int cat2Age = cat2.getCurrentAge(); System.out.println(\"å’²å·å½“å‰å¹´é¾„ä¸ºï¼š\" + cat1Age + \" \" + \"é¾Ÿç”°å¿—æ–Œå½“å‰å¹´é¾„ä¸ºï¼š\" + cat2Age); //è¿™é‡Œå†æ¬¡æ‰“å°å‡ºäºŒä½å½“å‰çš„å¹´é¾„å€¼ System.out.println(\"------------------------------------\"); //å†è§¦å‘ä¸€ä¸‹å®ƒä»¬çš„è¿·æƒ‘è¡Œä¸º cat1.emm(); //ç”±äºå’²å·ç°åœ¨ä¸º16å²ï¼Œç¬¦åˆtooOldä¸ºtrueï¼Œå› æ­¤è¿™é‡Œæ‰“å°éªšä¸åŠ¨äº†... cat2.emm(); //ç”±äºé¾Ÿç”°å¿—æ–Œç°åœ¨ä¸º11å²ï¼Œç¬¦åˆtooOldä¸ºfalseï¼Œå› æ­¤è¿™é‡Œä»ç„¶æ‰“å°è¿·æƒ‘è¯­å½•} ä¸Šæ–¹ä»£ç å—æ‰“å°ï¼š ä»£ç å—512345678910æˆ‘æ˜¯ä¸€åªåå«å’²å·æœ‰ç€ç™½è‰²çš®æ¯›çš„1å²æ¯çŒ«æˆ‘æ˜¯ä¸€åªåå«é¾Ÿç”°å¿—æ–Œæœ‰ç€é»‘è‰²çš®æ¯›çš„5å²å…¬çŒ«------------------------------------çŒªè‚‰å·å’Œåƒå±‚é¢ä¸å­˜åœ¨äºŒé€‰ä¸€ï¼Œæˆ‘å…¨éƒ½è¦ï¼çŒªè‚‰å·å’Œåƒå±‚é¢ä¸å­˜åœ¨äºŒé€‰ä¸€ï¼Œæˆ‘å…¨éƒ½è¦ï¼------------------------------------å’²å·å½“å‰å¹´é¾„ä¸ºï¼š16 é¾Ÿç”°å¿—æ–Œå½“å‰å¹´é¾„ä¸ºï¼š11------------------------------------éªšä¸åŠ¨äº†...çŒªè‚‰å·å’Œåƒå±‚é¢ä¸å­˜åœ¨äºŒé€‰ä¸€ï¼Œæˆ‘å…¨éƒ½è¦ï¼ é€šè¿‡è¿™ä¸ªä¾‹å­æˆ‘ä»¬ä¼šå‘ç°ï¼š ç±»åœ¨äº§ç”Ÿå¯¹è±¡ä»¥åï¼Œå¯ä»¥åˆ©ç”¨å¼•ç”¨å˜é‡æ¥æ“çºµå®ƒï¼Œå…·ä½“å¼•ç”¨å˜é‡å¯ä»¥è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ï¼Œç”šè‡³å¯ä»¥ç›´æ¥è®¿é—®å®ƒçš„å±æ€§ï¼ˆèƒ½ä¸èƒ½è®¿é—®å…·ä½“çœ‹è®¿é—®æƒé™ä¿®é¥°ç¬¦ï¼Œpublicæˆ–privateç­‰ï¼Œåé¢è®²ï¼‰ ç±»åœ¨äº§ç”Ÿå¯¹è±¡åï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æŒæœ‰è‡ªå·±çš„å±æ€§å’Œæ–¹æ³•ï¼Œäº’ä¸å¹²æ‰° å¯¹è±¡å†…çš„æ–¹æ³•å¯ä»¥è®¿é—®å¯¹è±¡å†…çš„ä»»æ„æˆå‘˜å˜é‡ä»¥åŠå…¶ä»–æ–¹æ³•ï¼ˆæ— è§†è®¿é—®æƒé™ä¿®é¥°ç¬¦ï¼‰ å¯¹è±¡å†…æŸäº›æ–¹æ³•å¯ä»¥æ”¹å˜æˆå‘˜å˜é‡çš„å€¼ï¼Œæ¯”å¦‚plusAgeï¼Œå®ƒä¼šé‡æ–°ç»™è‡ªå·±çš„æˆå‘˜å˜é‡èµ‹å€¼ï¼Œè€Œæœ‰äº›æ–¹æ³•åˆ™ä¸ä¼šï¼Œä¾‹å¦‚introï¼Œå®ƒä»…ä»…æ˜¯æ‹¼æ¥è‡ªå·±å†…éƒ¨çš„æˆå‘˜å˜é‡ 2.3ï¼šæ„é€ å™¨æ„é€ å™¨æ˜¯ç±»é‡Œçš„ä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ³•ï¼Œæ³¨æ„ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œæ„é€ å™¨ç‰¹æ®Šçš„åŸå› åœ¨äºå®ƒæœ‰ä¸”ä»…è¢«è§¦å‘ä¸€æ¬¡ï¼Œå°±æ˜¯åœ¨ç±»æ„é€ ç±»å¯¹è±¡çš„æ—¶å€™ï¼Œä¸€èˆ¬ä½ å®šä¹‰äº†ä¸€ä¸ªç±»å¦‚æœä¸å†™æ„é€ å™¨ï¼Œé‚£å°±ä¼šé»˜è®¤ä¸€ä¸ªæ„é€ å™¨ï¼Œä¾‹å¦‚ä»£ç å—2é‡Œï¼Œè™½ç„¶æ˜¯ä¸ªç©ºç±»ï¼Œä½†å®ƒæœ‰ä¸€ä¸ªéšè—çš„æ„é€ å™¨ï¼Œå³ï¼š ä»£ç å—6123456public class Cat { public Cat() { //ä¸å®šä¹‰æ„é€ å™¨ï¼Œåˆ™é»˜è®¤æœ‰è¿™æ ·ä¸€ä¸ªæ„é€ å™¨ï¼Œç”±äºå®ƒå¹¶æ²¡æœ‰ä»€ä¹ˆå®é™…æ„ä¹‰ï¼ˆå› ä¸º{}å†…æ²¡æœ‰ä»»ä½•å®è´¨æ€§çš„é€»è¾‘ä»£ç ï¼‰ï¼Œæ‰€ä»¥javaè¯­æ³•é‡Œå…è®¸ä¸å†™ }} è€Œåœ¨ä»£ç å—4é‡Œçš„æ„é€ å™¨æ²¡æœ‰çœç•¥ï¼Œå› ä¸ºå®ƒæ˜¯æœ‰å®é™…æ„ä¹‰çš„ï¼Œå®ƒçš„æ„ä¹‰åœ¨äºç»™æˆå‘˜å˜é‡èµ‹å€¼ï¼š ä»£ç å—712345678//æ„é€ æ–¹æ³•ï¼Œç”¨äºæ„é€ ä¸€ä¸ªç±»å¯¹è±¡public Cat(int gender, int age, int color, String name) { //é€šè¿‡ä¼ å…¥çš„å‚æ•°ï¼Œåˆå§‹åŒ–è‡ªå·±å¯¹è±¡å†…çš„æ¯ä¸€ä¸ªæˆå‘˜å˜é‡ this.gender = gender; this.age = age; this.color = color; this.name = name;} é€šè¿‡ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥å‘ç°æ„é€ å™¨çš„ç‰¹ç‚¹ï¼Œåç§°å’Œç±»åä¸€è‡´ï¼Œæ²¡æœ‰æ ‡è®°è¿”å›ç»“æœçš„ä¿®é¥°ç¬¦ï¼ˆvoidå…³é”®è¯æˆ–å…¶ä»–è¿”å›ç±»å‹ï¼‰ï¼Œä¸”åœ¨æ„é€ ä¸€ä¸ªå¯¹è±¡æ—¶å¿…é¡»è¦é€šè¿‡è°ƒç”¨æ„é€ æ–¹æ³•å®Œæˆã€‚ ä¸‰ã€è®¿é—®æƒé™ä¿®é¥°ç¬¦3.1ï¼šè®¿é—®æƒé™ç¬¦ä»‹ç»åœ¨å‰é¢æ‰€ä»‹ç»çš„ç±»å®šä¹‰ã€ç±»å±æ€§å®šä¹‰ã€ç±»æ–¹æ³•çš„å®šä¹‰çš„æœ€å‰ç«¯ï¼Œéƒ½ä¼šæœ‰ç±»ä¼¼publicã€privateè¿™ç§ä¿®é¥°ç¬¦ï¼Œå®ƒä»¬çš„æ„ä¹‰å’Œä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ é¦–å…ˆæˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹å®ƒä»¬ï¼Œå®ƒä»¬æ˜¯ç”¨æ¥æ§åˆ¶è®¿é—®æƒé™çš„ä¿®é¥°ç¬¦ï¼Œæ˜¯ç¼–è¯‘å™¨åšè®¿é—®è¯­æ³•æ£€æŸ¥æ—¶æ‰€åšçš„åˆ¤æ–­ä¾æ®ï¼Œä¸€èˆ¬æ”¾åˆ°ä»£ç é¦–éƒ¨ï¼Œå¯ä»¥ç”¨æ¥ä¿®é¥°ç±»ã€ç±»çš„å±æ€§å˜é‡ã€ç±»çš„æ–¹æ³•ï¼Œç”¨æ¥çº¦å®šå®ƒä»¬çš„è®¿é—®æƒé™ã€‚ å…³äºè¡¨é‡Œçˆ¶å­ç±»ç›¸å…³å†…å®¹éœ€è¦äº†è§£è¿‡ç»§æ‰¿åå†å»çœ‹ psï¼šè¿™ä¸ªè®¿é—®æƒé™ï¼Œä»…ä»…æ˜¯æ ¹æ®ç±»å®šä¹‰çš„ä¸Šä¸‹æ–‡æ¥åˆ¤å®šçš„ã€‚ å•çœ‹è¡¨å’Œæè¿°æ˜¯å¾ˆéš¾å‘ç°å®ƒä»¬çš„åŒºåˆ«çš„ï¼Œç°åœ¨æˆ‘ä»¬æ¥ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œæˆ‘ä»¬ç°åœ¨å†æ¥æ”¹é€ ä¸‹Catç±»ï¼ˆä¿®æ”¹äº†ä¸€äº›å†…å®¹çš„è®¿é—®æƒé™ï¼Œé¡ºå¸¦ç²¾ç®€äº†ä¸‹ä»£ç ï¼‰ï¼š ä»£ç å—812345678910111213141516171819202122232425262728293031323334353637383940414243public class Cat { public int gender; //genderå­—æ®µæ”¹ä¸ºpublicè®¿é—®æƒé™ protected int age; //ageå­—æ®µæ”¹ä¸ºprotectedè®¿é—®æƒé™ int color; //colorå­—æ®µæ”¹æˆé»˜è®¤ï¼ˆdefaultå…³é”®å­—å¯ä»¥çœç•¥ä¸å†™ï¼‰çš„è®¿é—®æƒé™ private String name; //nameä»ç„¶æ˜¯privateè®¿é—®æƒé™ public Cat(int gender, int age, int color, String name) { this.gender = gender; this.age = age; this.color = color; this.name = name; } public void eat() { //eatæ–¹æ³•ä»ä¸ºpublicè®¿é—®æƒé™ System.out.println(\"è¦æ°é¥­çš„å˜›\"); } protected void emm() { //emmæ–¹æ³•æ”¹ä¸ºprotectedè®¿é—®æƒé™ if (this.tooOld()) { System.out.println(\"éªšä¸åŠ¨äº†...\"); } else { System.out.println(\"çŒªè‚‰å·å’Œåƒå±‚é¢ä¸å­˜åœ¨äºŒé€‰ä¸€ï¼Œæˆ‘å…¨éƒ½è¦ï¼\"); } } void run() { //runæ–¹æ³•æ”¹ä¸ºé»˜è®¤è®¿é—®æƒé™ if (tooOld()) { System.out.println(\"è·‘ä¸åŠ¨äº†...\"); } else if (age &gt; 10) { System.out.println(\"å¥”è·‘é€Ÿåº¦ï¼š10km/h\"); } else { System.out.println(\"å¥”è·‘é€Ÿåº¦ï¼š15km/h\"); } } private boolean tooOld() { //tooOldæ–¹æ³•ä»ä¸ºprivateè®¿é—®æƒé™ return this.age &gt; 15; //å¦‚æœå¹´é¾„è¶…è¿‡15å²ï¼Œåˆ™è¿”å›true }} 3.2ï¼šä¸¾ä¾‹è¯´æ˜ï¼šåŒä¸€ä¸ªç±»okï¼Œç°åœ¨è®©æˆ‘ä»¬åŸºäºæ”¹é€ å¥½çš„Catç±»ï¼Œä»ç¬¬1åˆ—çš„å†…å®¹è¯•èµ·ï¼š æˆ‘ä»¬åœ¨å†™ä»£ç çš„æ—¶å€™ä¹Ÿå‘ç°äº†ï¼ŒåŒä¸€ä¸ªç±»å†…éƒ¨çš„æ‰€æœ‰å±æ€§ã€æ–¹æ³•æ— è§†å…¶è®¿é—®æƒé™ï¼Œç›´æ¥è·å–&amp;è®¿é—®å³å¯ï¼Œç°åœ¨å†æ¥è¯•è¯•è¿™æ ·ï¼š ç”±ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼ŒåŒä¸€ä¸ªç±»å®šä¹‰å†…ï¼Œå¦‚æœå­˜åœ¨å¦å¤–ä¸€ä¸ªç›¸åŒç±»äº§ç”Ÿçš„å¯¹è±¡ï¼Œä»ç„¶å¯ä»¥é€šè¿‡å…¶å¼•ç”¨å˜é‡æ— è§†è®¿é—®æƒé™è¿›è¡Œè®¿é—®ï¼Œå› ä¸ºå®ƒä»¬å±äºåŒä¸€ä¸ªç±»ï¼Œåˆ†æå¦‚ä¸‹ï¼š é¦–å…ˆcryæ˜¯Catç±»çš„æ–¹æ³•ï¼Œæ¥æ”¶çš„å‚æ•°æ˜¯Catç±»äº§ç”Ÿçš„å¼•ç”¨å˜é‡ï¼Œå› æ­¤åœ¨cryå†…å¯ä»¥æ— è§†è®¿é—®æƒé™ï¼Œç›´æ¥é€šè¿‡catè¿™ä¸ªå˜é‡è®¿é—®åˆ°æ‰€æœ‰çš„å†…å®¹ã€‚ 3.3ï¼šä¸¾ä¾‹è¯´æ˜ï¼šåŒä¸€ä¸ªåŒ…æˆ‘ä»¬ç°åœ¨å†åœ¨åŒä¸€ä¸ªåŒ…åˆ›å»ºä¸€ä¸ªTestç±»ï¼Œåœ¨å…¶mainæ–¹æ³•é‡Œåšå®éªŒï¼š è¿™æ˜¯ç¬¦åˆé¢„æœŸçš„ï¼ŒTestå’ŒCatä¸å±äºåŒä¸€ä¸ªç±»å®šä¹‰ï¼Œä½†å®ƒä»¬åœ¨åŒä¸€ä¸ªåŒ…å†…ï¼Œå› æ­¤é™¤äº†privateçš„å†…å®¹ï¼Œå‡å¯è®¿é—®ã€‚ 3.4ï¼šä¸¾ä¾‹è¯´æ˜ï¼šåŒåŒ…/ä¸åŒåŒ…çš„çˆ¶å­ç±»åé¢è®²ç»§æ‰¿çš„æ—¶å€™ä¼šè®²ã€‚ 3.5ï¼šä¸¾ä¾‹è¯´æ˜ï¼šä¸åŒåŒ…çš„ç±»è·Ÿ3.3ç›¸åï¼Œæˆ‘ä»¬ç°åœ¨æ–°å»ºä¸€ä¸ªè·ŸCatä¸åŒåŒ…çš„Testç±»ï¼Œç„¶åç”¨å…¶mainæ–¹æ³•åšå®éªŒï¼š è¿™æ˜¯ç¬¦åˆé¢„æœŸçš„ï¼ŒTestå’ŒCatä¸å±äºåŒä¸€ä¸ªç±»å®šä¹‰ï¼Œä¸”å®ƒä»¬ä¸åœ¨åŒä¸€ä¸ªåŒ…å†…ï¼Œå› æ­¤é™¤äº†publicçš„å†…å®¹ï¼Œå‡ä¸å¯è®¿é—®ã€‚","link":"/2020/03/05/LV2-2%EF%BC%9A%E5%8C%85%E7%9A%84%E5%AE%9A%E4%B9%89%E3%80%81%E7%B1%BB%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90%E3%80%81%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90%E4%BF%AE%E9%A5%B0%E7%AC%A6/"},{"title":"LV2-1ï¼šç±»&å¼•ç”¨å˜é‡çš„ç®€å•ä»‹ç»","text":"ä¸€ã€ç±»çš„ç®€å•ä»‹ç»ã€ä»€ä¹ˆæ˜¯å¼•ç”¨å˜é‡å‰é¢è®²è¿°å®ŒåŸºæœ¬å˜é‡ç±»å‹ï¼Œç°åœ¨è¯´ä¸‹å¼•ç”¨å˜é‡ç±»å‹ï¼Œè¿™é‡Œå…ˆç®€å•ä»‹ç»ä¸‹javaé‡Œéå¸¸é‡è¦çš„ä¸€ä¸ªæ¦‚å¿µï¼šç±» 1.1ï¼šä»€ä¹ˆæ˜¯ç±»ï¼Ÿjavaæ˜¯ä¸€ä¸ªé¢å‘å¯¹è±¡è¯­è¨€ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯å¯¹è±¡ï¼Ÿç±»åˆå’Œå¯¹è±¡æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ ä¹‹å‰äº†è§£äº†æ‰€æœ‰çš„åŸºç¡€ç±»å‹æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒä»¬æ¥æä¸ªäº‹æƒ…ï¼Œç°åœ¨ï¼Œè®©æˆ‘ä»¬ç”¨è¿™äº›åŸºæœ¬ç±»å‹é€ åªçŒ«ã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬ç°åœ¨éœ€è¦æç‚¼å‡ºæ¥çŒ«æ‰€å…·å¤‡çš„ä¸€äº›å±æ€§ï¼Œæ¯”å¦‚ï¼Œæ¯åªçŒ«éƒ½æœ‰è‡ªå·±çš„ç”Ÿç†æ€§åˆ«ï¼Œé‚£ä¹ˆæ€§åˆ«å°±å¯ä»¥æ˜¯ä¸€ä¸ªå±æ€§ï¼Œæ¯åªçŒ«å¯èƒ½è¿˜ä¼šæœ‰ä¸€ä¸ªæ˜µç§°ï¼Œæ¯åªçŒ«è¿˜ä¼šæœ‰å®ƒçš„å¹´é¾„ï¼Œå½“ç„¶ï¼Œéšä¾¿ä»€ä¹ˆå±æ€§éƒ½å¯ä»¥ï¼Œè‡ªå·±å–œæ¬¢å°±å¥½ï¼Œéƒ½å¯ä»¥åŠ è¿›ä½ çš„è®¾è®¡é‡Œï¼Œå‰ææ˜¯è¿™äº›å±æ€§æ˜¯å®¢è§‚å­˜åœ¨çš„äº‹å®ã€‚é™¤äº†ä¸€äº›å±æ€§ï¼ŒçŒ«è¿˜ä¼šæœ‰ä¸€äº›è¡Œä¸ºï¼Œæ¯”å¦‚åƒé¥­ã€å¥”è·‘ã€å«ã€æ— æ³•å½’ç±»çš„è¿·æƒ‘è¡Œä¸ºç­‰ï¼ŒæŠŠå±æ€§åŠ ä¸Šè¿™äº›è¡Œä¸ºï¼Œä¸€ä¸ªçŒ«ç±»å°±è¢«æˆ‘ä»¬æŠ½è±¡å‡ºæ¥äº†ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒæŠ½è±¡åçš„æ•°æ®ç»“æ„ï¼Œè¢«æˆ‘ä»¬ç§°ä½œä¸€ä¸ªç±»ï¼Œç±»åœ¨javaä¸­æ— å¤„ä¸åœ¨ï¼Œç±»å†…æŒ‰ç…§ç‰¹æ€§åˆ†ä¸ºäº†ä¸¤ç±»ï¼Œä¸Šæ–¹çº¢è‰²éƒ¨åˆ†ï¼Œæˆ‘ä»¬ç§°å®ƒä¸ºç±»çš„å±æ€§ï¼Œå±æ€§ä¸»è¦ç”¨æ¥æè¿°ä¸€äº›å®¢è§‚å­˜åœ¨çš„äº‹å®ï¼Œæ¯”å¦‚çŒ«ç¡®å®æœ‰å¹´é¾„ï¼ŒçŒ«ç¡®å®æœ‰ç”Ÿç†æ€§åˆ«ç­‰ï¼Œè€ŒçŒ«ä¼šå«ï¼Œä¼šè·‘ç­‰è¿™äº›å«ä¸»è§‚æ„è¯†æ„æˆçš„ç‰¹æ€§ï¼Œæˆ‘ä»¬ç®¡å®ƒå«ç±»çš„æ–¹æ³•ï¼Œç±»æ–¹æ³•å¯ä»¥ç”¨æ¥æè¿°è¿™ä¸ªç±»é‡Œæ‰€å…·å¤‡çš„å…·ä½“åŠŸèƒ½ï¼Œæ¯”å¦‚ä¾‹å­é‡Œçš„çŒ«ï¼Œå…·å¤‡åƒé¥­çš„åŠŸèƒ½ï¼Œå…·å¤‡è·‘çš„åŠŸèƒ½ç­‰ï¼Œè€Œå¾ˆå¤šæ—¶å€™ï¼Œè¿™äº›åŠŸèƒ½ç‰¹æ€§è¿˜ä¼šä¾èµ–è‡ªå·±çš„å±æ€§æ¥å†³å®šåŠŸèƒ½çš„è¿è¡Œæ–¹å¼ï¼Œæ¯”å¦‚çŒ«åœ¨å¥”è·‘çš„æ—¶å€™å¯èƒ½ä¼šä¾èµ–è‡ªå·±çš„å¹´é¾„ï¼Œå¹´é¾„å¤§çš„çŒ«å¥”è·‘é€Ÿåº¦å¯èƒ½èµ¶ä¸ä¸Šå¹´é¾„å°çš„çŒ«ï¼Œè¿™ä¸ªæ—¶å€™å¥”è·‘è¿™ä¸ªåŠŸèƒ½ä¾¿ä¼šå—çŒ«çš„å¹´é¾„å±æ€§çš„å½±å“ã€‚ è¿™é‡Œç®€å•äº†è§£ä¸‹æ–¹æ³•åœ¨javaä¸­çš„å®šä¹‰æ–¹å¼ï¼šç±»é‡Œçš„æ–¹æ³•åˆå«å‡½æ•°ï¼ˆfunctionï¼‰ï¼Œå®ƒçš„åŸºæœ¬å®šä¹‰ç»“æ„å¦‚ä¸‹ï¼š ä¸Šé¢æ˜¯ä¸€ä¸ªç®€å•çš„æ±‚ä¸¤ä¸ªæ•°ä¹‹å’Œçš„æ–¹æ³•ï¼ˆå‡½æ•°ï¼‰ï¼Œå®ƒçš„é€»è¾‘æ˜¯ï¼Œè®¡ç®—è¾“å…¥çš„ä¸¤ä¸ªå‚æ•°çš„å’Œï¼Œå¹¶å°†å…¶è¿”å›å‡ºå»ã€‚ 1.2ï¼šä»€ä¹ˆæ˜¯å¯¹è±¡ï¼Ÿé€šè¿‡å¯¹1.1çš„ç†è§£ï¼Œæˆ‘ä»¬çŸ¥é“äº†ç±»çš„åŸºæœ¬æ¦‚å¿µï¼Œé‚£ä¹ˆç±»å°±è·Ÿå®ƒçš„åå­—ä¸€æ ·ï¼Œå±äºå¯¹ä¸€ç±»äº‹ç‰©çš„æè¿°ï¼Œæ¯”å¦‚çŒ«ï¼ŒçŒ«æ˜¯ä¸€ä¸ªç§ç¾¤ï¼Œå› ä¸ºçŒ«éƒ½å…·å¤‡å›¾1ä¸­çš„ç‰¹æ€§ï¼Œæ‰€ä»¥çŒ«è¿™ä¸ªç§ç¾¤å¯ä»¥ç”¨Catç±»æ¥æè¿°ï¼Œä½†æ˜¯æ—¢ç„¶æ˜¯ç§ç¾¤ï¼Œè‚¯å®šå­˜åœ¨ä¸ªä½“å·®å¼‚ï¼Œæ¯”å¦‚ï¼Œä½ å®¶çš„çŒ«æ˜¯æ¯çŒ«ï¼Œä»–å®¶çš„çŒ«æ˜¯å…¬çŒ«ï¼Œä½ å®¶çš„æ˜¯ç™½çŒ«ï¼Œä»–å®¶çš„æ˜¯é»‘çŒ«ï¼Œè¿™ç§ä¸ªä½“çš„å·®å¼‚æ²¡æœ‰è¶Šè¿‡ç±»çš„æè¿°ï¼Œä¸ç®¡æ˜¯å…¬è¿˜æ˜¯æ¯ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€ç§ç”Ÿç†æ€§åˆ«ï¼ˆgenderï¼‰ï¼Œé‚£ä¹ˆå¦‚ä½•è§£å†³è¿™ç§ç»†å¾®çš„ä¸ªä½“å·®å¼‚æ€§å‘¢ï¼Ÿ è¿™æ—¶å¯¹è±¡å°±å‡ºæ¥äº†ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä¸‹é¢è¿™ä¸ªå›¾ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåˆ©ç”¨Catè¿™ä¸ªç±»çš„ä¿¡æ¯ï¼Œå¯¹å…¶å†…éƒ¨å±æ€§èµ‹å€¼ï¼Œå°±å¯ä»¥é€ å‡ºå„ç§å„æ ·â€œç¬¦åˆç±»è§„åˆ™â€çš„çŒ«äº†ï¼Œäº§ç”Ÿçš„è¿™åªçŒ«ï¼Œå°±å«åšç±»çš„å¯¹è±¡ï¼Œæ¯ä¸ªç±»éƒ½å¯ä»¥äº§ç”Ÿè®¸å¤šè®¸å¤šä¸ªå¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡ç¬¦åˆç±»çš„åŸºæœ¬å®šä¹‰ï¼Œä½†æ˜¯å´å„ä¸ç›¸åŒã€‚ 1.3ï¼šåˆ©ç”¨javaå®ç°ä¸€ä¸ªç±»ã€è®¤è¯†å¹¶ç†è§£å¼•ç”¨å˜é‡ æœ¬ç¯‡æ–‡ç« æ—¨åœ¨ç®€å•ä»‹ç»javaç±»æ˜¯ä»€ä¹ˆï¼Œé‡ç‚¹ä»‹ç»å¼•ç”¨å˜é‡ï¼Œä¸»è¦ç»“åˆå›¾ç‰‡ç†è§£ï¼Œå¯ä»¥å¯¹ç±»å¯ä»¥æœ‰ä¸ªåŸºæœ¬çš„è®¤è¯†ä»¥åŠæ›´æ·±å±‚æ¬¡çš„ç†è§£å¼•ç”¨å˜é‡ã€‚ é€šè¿‡å‰é¢æ‰€æœ‰å†…å®¹çš„äº†è§£ï¼Œæˆ‘ä»¬åˆ©ç”¨javaä»£ç æ¥å®ç°ä¸‹Catï¼š ä»£ç å—112345678910111213141516171819202122232425262728293031323334353637383940//çŒ«ç±»çš„å®šä¹‰public class Cat { //æ€§åˆ«ï¼š0é›Œï¼Œ1é›„ private int gender; //å¹´é¾„ private int age; //æ¯›è‰²ï¼š1é»‘ï¼Œ2ç™½ private int color; //æ˜µç§° private char name; //æ„é€ å™¨ï¼šå…³é”®æ–¹æ³•ï¼Œç”¨æ¥åˆ¶é€ å¯¹è±¡ï¼Œä¼ å…¥çš„è¿™äº›å±æ€§å€¼å¾—ä»¥èµ‹å€¼åˆ°å¯¹è±¡å†…éƒ¨ public Cat(int gender, int age, int color, char name) { this.gender = gender; this.age = age; this.color = color; this.name = name; } //å« public void cry() { //çŒ«å«å£°çš„å®ç° System.out.println(\"å–µå–µå–µ~\"); } //åƒ public void eat() { System.out.println(\"è¦æ°é¥­çš„å˜›\"); } //æ— æ³•å½’ç±»çš„è¿·æƒ‘è¡Œä¸º public void emm() { System.out.println(\"çŒªè‚‰å·å’Œåƒå±‚é¢ä¸å­˜åœ¨äºŒé€‰ä¸€ï¼Œæˆ‘å…¨éƒ½è¦ï¼\"); } public void run() { if (age &gt; 10) { //å‡å¦‚å¥”è·‘é€Ÿåº¦è·Ÿå¹´é¾„æœ‰å…³ï¼Œå¹´é¾„è¶…è¿‡10å²ï¼Œåˆ™é€Ÿåº¦å˜æ…¢ System.out.println(\"å¥”è·‘é€Ÿåº¦ï¼š10km/h\"); } else { System.out.println(\"å¥”è·‘é€Ÿåº¦ï¼š15km/h\"); } }} ç»è¿‡ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†1.1ä¸­ï¼Œæœ‰å…³çŒ«ç±»çš„æŠ½è±¡ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å®Œæˆ1.2ä¸­çš„é€ å¯¹è±¡è¿‡ç¨‹ï¼Œç°åœ¨æ–°é€ ä¸€ä¸ªTestç±»ç”¨äºæµ‹è¯•ï¼ˆæ³¨ï¼šjavaæ‰€æœ‰çš„ç¨‹åºï¼Œéƒ½æ˜¯ä»¥ä¸€ä¸ªmainæ–¹æ³•å¼€å§‹çš„ï¼Œè¿™é‡Œé€šè¿‡Testç±»é‡Œçš„mainæ–¹æ³•æ¥å¼€å§‹æµ‹è¯•ï¼‰ï¼š ä»£ç å—21234567891011121314public class Test { public static void main(String[] args) { //ä¸‹é¢éƒ½æ˜¯åŸºæœ¬ç±»å‹ int gender = 1; int age = 5; int color = 1; char name = 'A'; //è¿™é‡Œå°†ä¸Šæ–¹èµ‹å¥½å€¼çš„æ•°æ®ï¼Œé€å…¥æ„é€ å™¨ï¼Œç„¶åæ„é€ å™¨æ„é€ å‡ºæ¥å¯¹åº”çš„å¯¹è±¡ Cat cat = new Cat(gender, age, color, name); cat.run(); //åˆ©ç”¨è¿™ä¸ªå¯¹è±¡ï¼Œè°ƒç”¨å®ƒè‡ªèº«çš„runæ–¹æ³• }} ä¾‹å­ä¸­é€šè¿‡newæ„é€ å™¨æ¥æ„é€ ä¸€ä¸ªå…·ä½“çš„å¯¹è±¡ï¼Œå‘½åä¸ºcatï¼Œè¿™ä¸ªcatæ˜¯ä¸€ä¸ªå˜é‡ï¼Œè¿™ç§éåŸºæœ¬ç±»å‹çš„å˜é‡ï¼Œå«åšå¼•ç”¨å˜é‡ï¼Œå¼•ç”¨å˜é‡ç›¸æ¯”åŸºæœ¬ç±»å‹ï¼Œè¾ƒä¸ºå¤æ‚ï¼Œå®ƒå†…éƒ¨å…¶å®å­˜å‚¨çš„æ˜¯ä¸€æ®µåœ°å€ï¼Œè¿™æ®µåœ°å€æŒ‡å‘äº†å…·ä½“çš„å¯¹è±¡ä½“ï¼Œä¾‹å­é‡Œå°±æ˜¯é€šè¿‡æ„é€ å™¨æ„é€ å‡ºæ¥çš„å¯¹è±¡æœ¬èº«ï¼Œè€Œcat.run()å°±æ˜¯åœ¨åˆ©ç”¨è¿™ä¸ªå¼•ç”¨å˜é‡catè®¿é—®å…·ä½“çš„å¯¹è±¡çš„runæ–¹æ³•ï¼Œé€šè¿‡ä»£ç å—1ï¼Œå¯ä»¥çŸ¥é“åœ¨age&lt;=10çš„æ—¶å€™ï¼Œè¾“å‡ºåº”è¯¥æ˜¯15km/hï¼Œäº‹å®ä¸Šè¿è¡Œä¸€ä¸‹è¿™æ®µä»£ç ç¡®å®æ˜¯è¿™ä¸ªç»“æœï¼š 1å¥”è·‘é€Ÿåº¦ï¼š15km/h ç›®å‰åšç®€å•äº†è§£å°±å¥½ï¼Œåé¢ä¼šä»”ç»†è®²ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç”¨ä¸‹æ–¹æµç¨‹å›¾ç®€å•è¯´æ˜ä¸€ä¸‹ï¼š éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸åŸºæœ¬å˜é‡ä¸åŒï¼Œå¼•ç”¨å˜é‡ä¸å­˜åœ¨é»˜è®¤å€¼ï¼Œå¦‚æœä¸€ä¸ªå¼•ç”¨å˜é‡ä¸è¿›è¡Œèµ‹å€¼æ“ä½œï¼Œé‚£ä¹ˆå®ƒçš„â€œé»˜è®¤å€¼â€æ˜¯nullï¼Œå³å¼•ç”¨å˜é‡å¹¶æ²¡æœ‰æŒ‡å‘ä»»ä½•å¯¹è±¡å®ä½“ï¼Œå¦‚æœä¹‹å‰æœ‰å¬è¯´è¿‡javaé¼é¼å¤§åçš„ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼ˆæˆ–ç§°npeå¼‚å¸¸ï¼‰ï¼Œé‚£ä¹ˆç©ºæŒ‡é’ˆå¼‚å¸¸åœ¨å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯å› ä¸ºä½¿ç”¨äº†ä¸€ä¸ªå€¼ä¸ºnullçš„å¼•ç”¨å˜é‡å»è®¿é—®æŸä¸ªå¯¹è±¡æœ¬ä½“å¯¼è‡´çš„ã€‚ é€šè¿‡ä¸Šè¿°çš„ä¾‹å­ä¼šå‘ç°ï¼ŒçŒ«çš„åå­—æ˜¯charç±»å‹ï¼Œä½†æ˜¯charç±»å‹ä»…èƒ½ä¿å­˜ä¸€ä¸ªå­—ç¬¦ï¼Œå¦‚æœæˆ‘çš„çŒ«åå­—å«â€œåŠ è²â€ï¼Œå¯¹äºCatç±»ï¼Œå°±æ˜¯ä¸€ä»¶å¾ˆæ£˜æ‰‹çš„äº‹æƒ…äº†ï¼Œå› ä¸ºâ€œåŠ è²â€æ˜¯ç”±ä¸¤ä¸ªæ±‰å­—å­—ç¬¦ç»„æˆçš„è¯è¯­ï¼Œé‚£ä¹ˆè¿™æ—¶å€™æœ‰æ²¡æœ‰ä¸€ç§ç±»å‹å¯ä»¥ç”¨æ¥æ¥æ”¶å®ƒå‘¢ï¼Ÿ å­—ç¬¦ä¸²ç±»å‹Stringå°±æ˜¯ç”¨æ¥åšè¿™ä¸ªçš„ï¼ŒLV1-2é‡Œè¯´è¿‡ï¼Œå®ƒå¹¶éåŸºæœ¬ç±»å‹ï¼Œå®ƒçš„å£°æ˜æ–¹å¼å¦‚ä¸‹ï¼š ä»£ç å—3123String a; //å£°æ˜åç§°ä¸ºaçš„Stringç±»å‹å˜é‡ï¼ˆç”±äºå…¶éåŸºæœ¬ç±»å‹ï¼Œå› æ­¤aå±äºå¼•ç”¨å˜é‡ï¼Œä¸èµ‹å€¼çš„æƒ…å†µä¸‹é»˜è®¤å€¼ä¸ºnullï¼‰String b = \"åŠ è²\"; //å£°æ˜åç§°ä¸ºbçš„Stringç±»å‹å˜é‡ï¼ˆåˆå§‹å€¼ä¸ºï¼šåŠ è²ï¼‰String c = new String(\"åŠ è²\"); //ä¸å»ºè®®çš„å†™æ³•ï¼Œå£°æ˜åç§°ä¸ºcçš„Stringç±»å‹å˜é‡ï¼ˆåˆå§‹å€¼ä¸ºï¼šåŠ è²ï¼‰ è¿™æ ·ï¼Œå°†Catç±»æ”¹é€ ä¸‹ï¼Œå°†å…¶å†…éƒ¨çš„nameæ”¹æˆStringç±»å‹ï¼š ä»£ç å—41234567891011121314public class Cat { private int gender; private int age; private int color; private String name; //æ”¹æˆStringç±»å‹ public Cat(int gender, int age, int color, String name) { //æ¥æ”¶nameå‚æ•°æ—¶ä½¿ç”¨Stringç±»å‹æ¥æ”¶ this.gender = gender; this.age = age; this.color = color; this.name = name; } ...æ–¹æ³•çœç•¥ï¼Œå‚è€ƒä»£ç å—1...} æ­¤æ—¶çš„mainæ–¹æ³•æ”¹æˆå¦‚ä¸‹ï¼š ä»£ç å—51234567int gender = 1;int age = 5;int color = 1;String name = \"åŠ è²\"; //å£°æ˜ä¸€ä¸ªå«nameçš„å­—ç¬¦ä¸²ï¼Œåˆå§‹åŒ–å€¼ä¸ºâ€åŠ è²â€œ Cat cat = new Cat(gender, age, color, name);cat.run(); ç”±äºnameä¹Ÿå˜æˆäº†ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œæ‰€ä»¥å›¾4å°±å˜æˆäº†ä¸‹æ–¹çš„æµç¨‹ï¼š Stringä¸ºjavaè‡ªå¸¦çš„åŸç”Ÿç±»ï¼Œè€ŒCatæ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ç±»ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯ç±»ï¼Œæœªæ¥ç¼–å†™javaç¨‹åºæ—¶ï¼Œä¼šç”¨åˆ°å¾ˆå¤šç±»ä¼¼Stringè¿™æ ·çš„javaç°æˆçš„ç±»ï¼Œè‡ªå·±å®ç°ä¸€äº›ä¸šåŠ¡é€»è¾‘æ—¶ï¼Œéœ€è¦åˆ›é€ è‡ªå·±çš„ç±»ï¼Œè‡ªå·±çš„ç±»é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨åˆ«çš„ç±»ï¼Œç±»ä¼¼ä¸Šè¿°ä¾‹å­ä¸­ï¼ŒCatç±»å°±æ˜¯ç”¨äº†Stringç±»ï¼Œåªè¦æ˜¯ç±»äº§ç”Ÿçš„å¯¹è±¡ï¼Œå¯¹åº”å®ƒçš„å˜é‡ä¸€å®šæ˜¯ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œå¼•ç”¨å˜é‡æ°¸è¿œæ˜¯ä¸€æ®µè®¿é—®å®é™…å¯¹è±¡æ—¶çš„å†…å­˜åœ°å€ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡åœ¨å†…å­˜é‡Œå¤±å»äº†å˜é‡å¼•ç”¨ï¼Œåˆ™è®¤ä¸ºè¯¥å¯¹è±¡åºŸå¼ƒï¼Œè¿™æ—¶JVMå°±ä¼šå°†å…¶å›æ”¶ï¼Œè¿™å°±æ˜¯javaçš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œè¿™é‡Œä¸éœ€è¦çŸ¥é“å¤ªå¤šï¼Œåæ­£åé¢éƒ½ä¼šè®²ï¼Œå…ˆäº†è§£ä¸‹å³å¯ã€‚","link":"/2020/03/02/LV2-1%EF%BC%9A%E7%B1%BB&%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F%E7%9A%84%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/"},{"title":"LV1-4ï¼šæ¡ä»¶è¯­å¥&å¾ªç¯è¯­å¥","text":"é€šè¿‡å‰é¢çš„ä»‹ç»ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†å˜é‡å’Œè¿ç®—ç¬¦ï¼Œé€šè¿‡è¿ç®—ç¬¦å¯ä»¥å°†å¤šä¸ªå˜é‡è¿›è¡Œä¸åŒçš„è¿ç®—ï¼Œè¿™å·²ç»å¯ä»¥åšå‡ºä¸€ä¸ªè®¡ç®—å™¨äº†ï¼Œå¯æ˜¯ä¸€æ®µå…·å¤‡å„ç§é€»è¾‘çš„ç¨‹åºï¼Œä»…é ç®€å•çš„è¿ç®—æ˜¯æ— æ³•å®Œæˆçš„ï¼Œäºæ˜¯ï¼Œæˆ‘ä»¬ä¾¿æœ‰äº†å„ç§æ¡ä»¶è¯­å¥å’Œå¾ªç¯è¯­å¥ï¼Œç”¨æ¥ç»„åˆè¿ç®—é€»è¾‘ï¼Œä»è€Œå®ç°æ›´ä¸ºå¤æ‚çš„ä¸šåŠ¡é€»è¾‘ã€‚ .heimu { color: #000; background-color: #000; } .heimu:hover { color: #fff; } ä¸€ã€æ¡ä»¶è¯­å¥1.1ï¼šifã€else ifã€elseå…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š ä»£ç å—112345678910111213141516171819202122public static void main(String[] args) { int a = 1; if (a == 1) { //è¿™é‡Œæ”¾aç­‰äº1æ—¶çš„é€»è¾‘ä»£ç  } else if (a == 2) { //è¿™é‡Œæ”¾aç­‰äº2æ—¶çš„é€»è¾‘ä»£ç  } else if (a == 3) { //è¿™é‡Œæ”¾aç­‰äº3çš„é€»è¾‘ä»£ç  } else { //å¦‚æœaä¸æ»¡è¶³ä¸Šé¢ä»»æ„ä¸€ä¸ªæ¡ä»¶ï¼Œåˆ™èµ°è¿™é‡Œçš„é€»è¾‘ }} è¿™å°±æ˜¯ifæ¡ä»¶è¯­å¥çš„åŸºæœ¬ç”¨æ³•ï¼Œå®ƒä¸€å®šæ˜¯ä»¥ifå¼€å¤´çš„ï¼Œå¦‚æœé™¤äº†ifå¤´çš„æ¡ä»¶ä¸æ»¡è¶³ï¼Œè¿˜éœ€è¦åˆ«çš„åˆ¤æ–­æ¡ä»¶ï¼Œåˆ™ä½¿ç”¨else ifï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•æ»¡è¶³çš„æ¡ä»¶æ—¶éœ€è¦åšè¿›ä¸€æ­¥å¤„ç†ï¼Œåˆ™ä½¿ç”¨elseï¼Œæ¡ä»¶è¯­å¥æ‹¬å·å†…çš„è¯­å¥ï¼Œä¸€å®šæ˜¯ä¸€ä¸ªå…³ç³»è¿ç®—å¼ï¼Œç»“æœä¸ºtrueæˆ–falseï¼Œç»“æœä¸ºtrueï¼Œåˆ™èµ°å¯¹åº”çš„ä»£ç å—ï¼Œå®ƒçš„è¿è¡Œæ¨¡å¼å¦‚ä¸‹ï¼š ç”±å›¾çŸ¥ï¼šifè¯­å¥ä»ä¸Šåˆ°ä¸‹å¼€å§‹åˆ¤æ–­ï¼Œä¸€æ—¦ç¢°åˆ°æ¡ä»¶æ»¡è¶³çš„ï¼Œå°±æ‰§è¡Œæ»¡è¶³æ¡ä»¶çš„ä»£ç å—ï¼Œå…¶ä½™ä»£ç å—ä¸å†è¿è¡Œï¼Œæ€è€ƒï¼Œä¸‹æ–¹å“ªä¸ªä»£ç å—ä¼šæ‰§è¡Œï¼Ÿ ä»£ç å—21234567891011121314public static void main(String[] args) { int a = 3; if (a == 1) { //ä»£ç å—1 } else if (a == 2 || a == 3) { //ä»£ç å—2 } else if (a == 3) { //ä»£ç å—3 } else { //ä»£ç å—4 }} é¦–å…ˆï¼Œç¬¬äºŒä¸ªæ¡ä»¶è¯­å¥ï¼ˆa == 2 || a == 3ï¼‰å’Œï¼ˆa == 3ï¼‰éƒ½æ˜¯trueï¼Œé‚£ä¹ˆç©¶ç«Ÿæ˜¯æ‰§è¡Œä»£ç å—2è¿˜æ˜¯æ‰§è¡Œä»£ç å—3å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä»£ç å—2ï¼Œå› ä¸ºä¸Šé¢å·²ç»è¯´è¿‡äº†ï¼Œåˆ¤æ–­æ—¶åªè¦é‡åˆ°ä¸€ä¸ªtrueï¼Œå°±ç›´æ¥æ‰§è¡Œå¯¹åº”çš„ä»£ç å—äº†ï¼Œå…¶ä½™çš„ä»£ç å—éƒ½ä¸ä¼šç”Ÿæ•ˆã€‚ okï¼Œçœ‹å®Œä¸Šé¢çš„æ¡ˆä¾‹ï¼Œå†æ¥è¯´ä¸‹ifè¯­å¥æœ¬èº«ï¼Œifè¯­å¥çš„elseæˆ–è€…else ifæ˜¯å¯ä»¥ä¸å­˜åœ¨çš„ï¼Œæ¯”å¦‚æˆ‘ç°åœ¨ä»…åšä¸€ä¸ªæœ€åŸºæœ¬çš„åˆ¤æ–­ï¼š ä»£ç å—31234567int a = 3; if (a == 1) { //ä»£ç å—1} //å…¶å®ƒä»£ç  è¿™æ®µä»£ç çš„æ„æ€æ˜¯è¯´ï¼Œåªè¦açš„å€¼ä¸º1ï¼Œå°±ä¼šæ‰§è¡Œä»£ç å—1ï¼Œå…¶å®ƒä¸éœ€è¦åšä»»ä½•åˆ¤æ–­ï¼ŒåŒæ ·çš„ï¼Œifå¯ä»¥è·Ÿä¸€ä¸ªelseä½¿ç”¨ï¼š ä»£ç å—4123456789int a = 3; if (a == 1) { //ä»£ç å—1} else { //ä»£ç å—2} //å…¶å®ƒä»£ç  è¿™æ®µä»£ç çš„æ„æ€æ˜¯è¯´ï¼Œå¦‚æœaçš„å€¼ä¸º1ï¼Œåˆ™è¿è¡Œä»£ç å—1ï¼Œå¦‚æœaçš„å€¼ä¸ç­‰äº1ï¼Œåˆ™è¿è¡Œä»£ç å—2. ifä¹Ÿå¯ä»¥å•ç‹¬è·Ÿä¸€ä¸ªæˆ–å¤šä¸ªelse ifä¸€å—ä½¿ç”¨ï¼š ä»£ç å—512345678910int a = 3; if (a == 1) { //ä»£ç å—1} else if(a == 2) { //ä»£ç å—2} //å…¶å®ƒä»£ç  è¿™æ®µä»£ç çš„æ„æ€æ˜¯è¯´ï¼Œå¦‚æœaçš„å€¼ä¸º1ï¼Œåˆ™è¿è¡Œä»£ç å—1ï¼Œå¦‚æœaçš„å€¼ä¸º2ï¼Œåˆ™è¿è¡Œä»£ç å—2ã€‚ 1.2ï¼šswitchã€caseè¯­æ³•å¦‚ä¸‹ï¼š ä»£ç å—6123456789101112131415161718public static void main(String[] args) { int a = 2; switch (a){ case 1: //ä»£ç å—1 break; case 2: //ä»£ç å—2 break; case 3: //ä»£ç å—3 break; default: //ä»£ç å—4 }} è¯­æ³•è§„èŒƒï¼šswitchæ‹¬å·å†…çš„ç±»å‹åªèƒ½æ˜¯åŸºæœ¬ç±»å‹ã€æšä¸¾ç±»ã€Stringï¼Œä¸€ä¸ªswitché‡Œå¯ä»¥åŒ…å«å¤šä¸ªcaseï¼Œdefaultå¯ä»¥å†™ä¹Ÿå¯ä»¥ä¸å†™ã€‚ å®ƒæ˜¯ç”¨æ¥åšä»€ä¹ˆçš„å‘¢ï¼Ÿ å…¶å®å®ƒæœ‰äº›åƒifè¯­å¥ï¼Œç”¨æ¥åŒ¹é…ç¬¦åˆè§„åˆ™çš„ä»£ç å—ï¼Œä»¥ä»£ç å—6ä¸ºä¾‹ï¼Œå®ƒçš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°ï¼Œswitchä¹Ÿæ˜¯è‡ªä¸Šåˆ°ä¸‹æ ¹æ®æ¡ä»¶åˆ¤æ–­å‡ºéœ€è¦æ‰§è¡Œçš„ä»£ç å—ï¼Œé‚£ä¹ˆè¿™ä¸ªbreakåˆæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæ ¹æ®å›¾2å¯ä»¥å‘ç°å®ƒæ˜¯ç”¨æ¥ç»ˆæ­¢ç¨‹åºç”¨çš„ï¼Œå¦‚æœå°‘äº†breakä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿå¦‚ä¸‹å›¾ï¼Œç°åœ¨æˆ‘ä»¬æŠŠç¨‹åºé‡Œçš„breakå»æ‰ï¼š å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœåœ¨case2çš„ä»£ç é‡Œæ²¡æœ‰åšç¨‹åºç»ˆæ­¢ï¼Œåˆ™ä»case2å¼€å§‹å¾€ä¸‹çš„æ¯ä¸€é¡¹éƒ½ä¼šè§¦å‘æ‰§è¡Œã€‚ é‚£ä¹ˆï¼Œdefaultè¿™ä¸€é¡¹æ˜¯å¹²å˜›çš„ï¼Ÿè¿™ä¸ªå…¶å®è·Ÿifé‡Œçš„elseç±»ä¼¼ï¼Œå°±æ˜¯switchå†…çš„å€¼åœ¨caseå†…æ²¡æœ‰ä»»ä½•åŒ¹é…é¡¹çš„æ—¶å€™ï¼Œé»˜è®¤è§¦å‘çš„ä»£ç å—ï¼Œæ­¤å¤–switchæ˜¯å…è®¸ä¸å®šä¹‰æ­¤é¡¹çš„ã€‚ okï¼Œäº†è§£äº†switchçš„æ‰§è¡Œæµç¨‹ï¼Œé‚£ä¹ˆè¯·æ€è€ƒä¸€ä¸‹ä¸‹æ–¹è¿™ä¸ªç»“æœåº”è¯¥è¾“å‡ºå¤šå°‘ï¼Ÿ ä»£ç å—71234567891011121314int a = 2; switch (a){ case 1: System.out.println(1); break; case 2: System.out.println(2); case 3: System.out.println(3); break; default: System.out.println(\"default\");} ç­”æ¡ˆï¼šè¾“å‡º2å’Œ3 é‚£ä¹ˆä¸‹é¢è¿™ä¸ªè¾“å‡ºä»€ä¹ˆå‘¢ï¼Ÿ ä»£ç å—8123456789101112131415int a = 233; //æ³¨æ„è¿™é‡Œaçš„å€¼å˜äº† switch (a){ case 1: System.out.println(1); break; case 2: System.out.println(2); break; case 3: System.out.println(3); break; default: System.out.println(\"default\");} ç­”æ¡ˆï¼šdefault äºŒã€å¾ªç¯è¯­å¥2.1ï¼šforå¾ªç¯è¯­å¥è¯­æ³•å¦‚ä¸‹ï¼š ä»£ç å—91234567public static void main(String[] args) { for (int i = 0; i &lt; 10; i++) { System.out.println(i + \"å“”å“©å“”å“©å¹²æ¯\"); } } ä¸Šé¢è¿™ä¸ªç¨‹åºä¼šè¾“å‡º10ä¸ªå­—ç¬¦ä¸²ï¼Œå³ï¼š0å“”å“©å“”å“©å¹²æ¯ ~ 9å“”å“©å“”å“©å¹²æ¯ï¼Œforå¾ªç¯æ˜¯å¦‚ä½•è¿è¡Œçš„ï¼Ÿå®ƒæ˜¯ä»¥ä»€ä¹ˆä¸ºä¾æ®è¿è¡Œ10éçš„ï¼Ÿä¸‹é¢æˆ‘ä»¬æ¥æ‹†è§£ä¸‹å®ƒçš„è¯­æ³•ï¼š å¦‚å›¾4ï¼Œæ ¹æ®å¯¹æ‹¬å·å†…çš„äº†è§£ï¼Œæˆ‘ä»¬æ¥æ¢³ç†ä¸‹ä»£ç å—9é‡Œçš„æ‰§è¡Œè¿‡ç¨‹ï¼š è¯·ä»”ç»†é˜…è¯»å›¾5ä¸­çš„æµç¨‹ï¼Œè¿™æ˜¯æ¨åŠ¨forå¾ªç¯æ‰§è¡Œçš„æµç¨‹ã€‚ å­¦å®Œäº†ifè¯­å¥å’Œforå¾ªç¯ï¼Œæˆ‘ä»¬æ¥å†™ä¸€ä¸ªç¨‹åºï¼Œç¨‹åºè¦æ±‚ï¼šè¾“å‡º0~9é‡Œçš„å¥‡æ•°å’Œå¶æ•°ï¼Œæœ€åå°†å®ƒä»¬æŒ‰ç…§ç©ºæ ¼åˆ†å¼€æ‰“å°å‡ºæ¥ï¼š ä»£ç å—101234567891011121314151617public static void main(String[] args) { String odd = \"\"; //å£°æ˜å­˜æ”¾å¥‡æ•°æ•°æ®çš„å­—ç¬¦ä¸² String even = \"\"; //å£°æ˜å­˜æ”¾å¶æ•°æ•°æ®çš„å­—ç¬¦ä¸² for (int i = 0; i &lt; 10; i++) { //å¾ªç¯è¿è¡Œï¼Œæ¯æ¬¡i+1ï¼Œä¸€å…±å¾ªç¯10æ¬¡ï¼Œiçš„èµ‹å€¼èŒƒå›´ä¸º0~9 if (i % 2 == 0) { even += i + \" \"; //å¦‚æœè¢«2æ•´é™¤ï¼Œåˆ™è¯´æ˜æ˜¯å¶æ•°ï¼ŒåŠ ç©ºæ ¼åæ‹¼åœ¨evenåé¢ } else { odd += i + \" \"; //å¦‚æœä¸èƒ½è¢«2æ•´é™¤ï¼Œåˆ™è¯´æ˜æ˜¯å¥‡æ•°ï¼ŒåŠ ç©ºæ ¼åæ‹¼åœ¨oddåé¢ } } System.out.println(\"0~9ä¸­çš„å¥‡æ•°ä¸ºï¼š\" + odd); System.out.println(\"0~9ä¸­çš„å¶æ•°ä¸ºï¼š\" + even); } è¾“å‡ºç»“æœä¸ºï¼š ä»£ç å—11120~9ä¸­çš„å¥‡æ•°ä¸ºï¼š1 3 5 7 90~9ä¸­çš„å¶æ•°ä¸ºï¼š0 2 4 6 8 2.2ï¼šwhileã€do whilewhileå¾ªç¯çš„è¯­æ³•å¦‚ä¸‹ï¼š ä»£ç å—1212345678910public static void main(String[] args) { int i=0; while (i&lt;10){ System.out.println(i + \"å“”å“©å“”å“©å¹²æ¯\"); i++; } } è¿™ä¸ªè·Ÿä»£ç å—9è¾“å‡ºä¸€æ ·ï¼Œä¹Ÿæ˜¯ï¼š0å“”å“©å“”å“©å¹²æ¯ ~ 9å“”å“©å“”å“©å¹²æ¯ï¼Œå…ˆæ¥è¯´ä¸‹whileè¿™ä¸ªå•è¯æœ¬èº«çš„æ„æ€ï¼Œå®ƒçš„æ„æ€æ˜¯â€œå½“â€¦.çš„æ—¶å€™â€ï¼Œæ‰€ä»¥while(i&lt;10)è¿™å¥è¯å°±å¾ˆå¥½ç†è§£äº†ï¼Œå°±æ˜¯å½“içš„å€¼å°äº10çš„æ—¶å€™ï¼Œè¿è¡Œwhileå¾ªç¯ä½“é‡Œçš„ä»£ç ï¼Œç›¸æ¯”forå¾ªç¯ï¼Œwhileç†è§£èµ·æ¥ç›¸å¯¹ç®€å•ï¼Œå®ƒçš„è¿è¡Œæµç¨‹å›¾ä¸å†ç”»ã€‚ do whileè·Ÿwhileç±»ä¼¼ï¼Œå°†ä»£ç å—12é‡Œçš„ä»£ç åˆ©ç”¨do whileæ”¹é€ ä¸€ä¸‹ï¼š ä»£ç å—1312345678910public static void main(String[] args) { int i = 0; do { System.out.println(i + \"å“”å“©å“”å“©å¹²æ¯\"); i++; } while (i &lt; 10); } è¾“å‡ºç»“æœè·Ÿwhileä¸€è‡´ï¼Œé‚£ä½ å¯èƒ½è¦é—®äº†ï¼Œwhileå’Œdo whileæœ‰å•¥åŒºåˆ«ï¼Ÿ æ¥çœ‹ä¸‹å®ƒä»¬çš„æ‰§è¡Œæµç¨‹å›¾ï¼š è¿™å°±æ˜¯å®ƒä»¬çš„åŒºåˆ«ï¼Œwhileä¸Šå»å°±ä¼šåˆ¤æ–­æ¡ä»¶æ˜¯å¦æ»¡è¶³ï¼Œä»è€Œå†³å®šæ˜¯å¦èµ°ä¸‹å»ï¼Œè€Œdo whileå¾€å¾€ä¸Šå»å°±ä¼šè§¦å‘ä¸€æ¬¡å¾ªç¯ä½“ï¼Œç„¶åæ‰åšåˆ¤æ–­å†³å®šæ˜¯å¦å†æ¬¡è§¦å‘å¾ªç¯ä½“ã€‚ æŒ‰ç…§ä»£ç å—13çš„é€»è¾‘æ¥è¯´ï¼Œwhileå’Œdo whileç¡®å®æ²¡å·®åˆ«ï¼Œå› ä¸ºiä¸€å¼€å§‹ç¡®å®å°äº10ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡çš„æ—¶å€™æ— è®ºå¦‚ä½•éƒ½ä¼šè§¦å‘ä¸€æ¬¡å¾ªç¯ä½“é‡Œçš„é€»è¾‘ï¼Œæ˜¯å¦å…ˆåˆ¤æ–­æ¡ä»¶å·²ç»æ— æ‰€è°“äº†ï¼Œæˆ‘ä»¬æ¥ä¸¾ä¸€ä¸ªä¸ä¸€æ ·çš„ä¾‹å­ï¼š ä»£ç å—1412345678910public static void main(String[] args) { int i = 10; do { i--; System.out.println(i + \"å“”å“©å“”å“©å¹²æ¯\"); } while (i &gt; 0 &amp;&amp; i &lt; 10); } è¿™æ®µä»£ç è¾“å‡ºä¸ºï¼š9å“”å“©å“”å“©å¹²æ¯ ~ 0å“”å“©å“”å“©å¹²æ¯ æˆ‘ä»¬ç°åœ¨ç”¨whileæ”¹é€ ä¸€ä¸‹ï¼š ä»£ç å—1512345678910public static void main(String[] args) { int i = 10; while (i &gt; 0 &amp;&amp; i &lt; 10) { i--; System.out.println(i + \"å“”å“©å“”å“©å¹²æ¯\"); } } è¿™æ®µä»£ç å•¥ä¹Ÿä¸ä¼šè¾“å‡ºï¼Œå› ä¸ºwhileä¼šå…ˆåˆ¤æ–­å¾ªç¯æ¡ä»¶æ˜¯å¦æˆç«‹ï¼Œå†å†³å®šèµ°ä¸èµ°å¾ªç¯ä½“ï¼Œè€Œéœ€è¦i&lt;10æˆç«‹çš„iâ€“æ“ä½œå´åœ¨å¾ªç¯ä½“å†…ï¼Œå› æ­¤ä»£ç å—14æˆåŠŸæ‰§è¡Œï¼Œè€Œä»£ç å—15æœªæˆåŠŸã€‚ ä¸‰ã€æ•°ç»„&amp;forå¢å¼º3.1ï¼šæ•°ç»„æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬å‰é¢è®²åŸºæœ¬ç±»å‹å˜é‡æ—¶è¯´è¿‡ï¼Œè®¾ç½®ä¸€ä¸ªå˜é‡çš„æ­¥éª¤æ˜¯ï¼šâ‘ å£°æ˜ã€â‘¡èµ‹å€¼ã€â‘¢ä½¿ç”¨ï¼Œä½†æ˜¯å½“æ—¶çš„å˜é‡éƒ½æ˜¯æˆ‘ä»¬ä¸€ä¸ªä¸ªå£°æ˜çš„ï¼Œæœ‰æ²¡æœ‰ä¸€ç§æ–¹å¼å¯ä»¥ä¸€æ¬¡æ€§å£°æ˜nä¸ªå˜é‡å‘¢ï¼Ÿæ•°ç»„å°±æ˜¯è¿™æ ·ä¸€ç§ç»“æ„ï¼Œå®ƒå…è®¸ä¸€æ¬¡æ€§å£°æ˜nä¸ªå˜é‡ï¼Œå¹¶ä¸”æ”¯æŒé€ä¸ªèµ‹å€¼ï¼Œæ•°ç»„è·ŸåŸºæœ¬ç±»å‹ä¸€æ ·ï¼Œä¹Ÿéœ€è¦å£°æ˜ï¼Œå£°æ˜æ–¹å¼ä¸ºï¼š ä»£ç å—1612int[] nums = new int[10]; //è¿™ç§å£°æ˜æ–¹å¼åªæ˜¯ç®€å•çš„å®šä¹‰äº†ä¸€ä¸ªå®¹é‡ä¸º10çš„intå‹æ•°ç»„ï¼Œå¹¶æœªç»™å†…éƒ¨çš„å…ƒç´ èµ‹å€¼int[] nums2 = {1, 222, 334, 566, 256}; //è¿™ç§å£°æ˜æ–¹å¼å°±æ˜¯è¿å¸¦ç€åˆå§‹å€¼ç»™æ¯ä¸ªå…ƒç´ éƒ½èµ‹ä¸Šäº†ï¼Œè¿™é‡Œæ˜¯æŒ‡ä»0~5çš„ä¸‹æ ‡çš„å…ƒç´ å€¼åˆ†åˆ«ä¸ºï¼š1, 222, 334, 566, 256 ä¸Šè¿°çš„ä»£ç çš„ç¬¬ä¸€æ®µå°±æ˜¯å£°æ˜äº†ä¸€ä¸ªåŒæ—¶å£°æ˜äº†10ä¸ªintå‹å˜é‡çš„æ•°ç»„å˜é‡ï¼ˆå¥—å¨ƒä¸­â€¦ï¼‰ï¼Œä¹Ÿæ˜¯å¸¸ç”¨çš„æ•°ç»„å£°æ˜æ–¹å¼ï¼Œé‚£ä¹ˆä¹‹å‰ä¹Ÿè¯´è¿‡äº†ï¼Œjavaé™¤äº†åŸºæœ¬å˜é‡ä¹‹å¤–ï¼Œå…¶ä½™å…¨éƒ½æ˜¯å¼•ç”¨å˜é‡ï¼Œå› æ­¤ï¼Œæ•°ç»„ç±»å‹ä¹Ÿæ˜¯ä¸€ç§å¼•ç”¨å˜é‡ï¼Œå¼•ç”¨å˜é‡çš„åŸç†æ€§è´¨çš„ä¸œè¥¿åˆ°è®²ç±»çš„æ—¶å€™ä¼šç»†è¯´ã€‚ æ•°ç»„åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿä»£ç å—16é‚£æ ·çš„åšæ³•ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ å…ˆè¯´ä¸‹æ•°ç»„çš„ç»“æ„ï¼Œæ•°ç»„å°±æ˜¯åŒ…å«äº†å¤šä¸ªå…ƒç´ çš„é›†åˆï¼Œä¾‹å¦‚ä»£ç ä¸­çš„numsï¼Œæœ¬èº«å°±ä¸€æ¬¡æ€§å£°æ˜äº†10ä¸ªintå‹å…ƒç´ ï¼Œé‚£ä¹ˆæˆ‘ä»¬çŸ¥é“intå‹å¦‚æœä¸ç»™èµ‹å€¼çš„è¯ï¼Œå®ƒçš„é»˜è®¤å€¼æ˜¯0ï¼Œå¦‚ä½•ç»™æ•°ç»„é‡Œçš„å…ƒç´ èµ‹å€¼å‘¢ï¼Ÿè¿™é‡Œå°±è¦å¼•å‡ºä¸€ä¸ªå«åšä¸‹æ ‡çš„ä¸œè¥¿ï¼Œä¸‹æ ‡çš„å«ä¹‰å°±æ˜¯æŒ‡å…ƒç´ æœ¬èº«åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼Œä¸‹æ ‡ä»0å¼€å§‹è®¡ç®—ï¼Œnumsåœ¨å®Œæˆå£°æ˜åçš„ç»“æ„å¦‚ä¸‹ï¼š é‚£ä¹ˆç°åœ¨æˆ‘å¦‚æœè¦ç»™ä¸‹æ ‡5çš„æ•°èµ‹å€¼ä¸º256ï¼Œè¯¥å¦‚ä½•æ“ä½œå‘¢ï¼Ÿçœ‹ä»£ç ï¼š ä»£ç å—171nums[5] = 256; åˆ©ç”¨æ•°ç»„å˜é‡ï¼Œå°†ä¸‹æ ‡å€¼æ”¾è¿›å»ï¼Œå³è®¤ä¸ºæ“ä½œçš„å°±æ˜¯å¯¹åº”å…ƒç´ æœ¬èº«ï¼Œå› æ­¤åˆ©ç”¨ç­‰å·èµ‹å€¼å³å¯ï¼Œèµ‹å®Œå€¼çš„numså¦‚ä¸‹ï¼š ä¸‹æ ‡ä¸º5çš„intå‹æ•°æ®å…ƒç´ å·²ç»è¢«æˆåŠŸèµ‹å€¼äº†ã€‚ é‚£ä¹ˆå¦‚ä½•æ‰¹é‡èµ‹å€¼å‘¢ï¼Ÿè¿™æ ·ä¸€ä¸ªä¸ªçš„èµ‹å€¼å¤ªéº»çƒ¦äº†ï¼Œå¦‚æœç°åœ¨æœ‰ä¸€ä¸ªsizeä¸º10000çš„æ•°ç»„ï¼Œè¿™æ ·ä¸€ä¸ªä¸ªèµ‹å€¼ä¼šæ­»äººçš„~è¿˜è®°å¾—æœ¬èŠ‚æ‰€å­¦çš„å†…å®¹å—ï¼Ÿå¾ªç¯å•Šï¼Œå°±ä¸èƒ½åˆ©ç”¨å¾ªç¯èµ‹å€¼å—ï¼Ÿæ¯”å¦‚forå¾ªç¯ï¼Œå®Œå…¨å¯ä»¥æŠŠå¾ªç¯ä½“é‡Œçš„iå˜é‡å½“æˆä¸‹æ ‡è®¿é—®æ•°ç»„é‡Œçš„å…ƒç´ å“‡ï¼Œç°åœ¨æˆ‘ä»¬åˆ©ç”¨å¾ªç¯æ“ä½œï¼Œæ¥ç»™numsè¿™ä¸ªæ•°ç»„çš„æ¯ä¸ªå…ƒç´ éƒ½èµ‹ä¸Š256ï¼š ä»£ç å—18123456789public static void main(String[] args) { int[] nums = new int[10]; for (int i = 0; i &lt; 10; i++) { nums[i] = 256; //åˆ©ç”¨iå½“åšnumsçš„ä¸‹æ ‡æ¥è®¿é—®å®ƒé‡Œé¢çš„å…ƒç´  } } è¿™æ ·numsé‡Œé¢çš„æ¯ä¸€ä¸ªå…ƒç´ çš„å€¼å°±éƒ½æ˜¯256äº†~ å†æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œè¿™é‡Œå› ä¸ºæˆ‘ä»¬äº‹å…ˆçŸ¥é“äº†numsçš„å…ƒç´ ä¸ªæ•°æ˜¯10ä¸ªï¼Œä¸‹æ ‡æ˜¯0~9ï¼Œæ‰€ä»¥forå¾ªç¯é‡Œçš„iåˆå§‹åŒ–ä¸º0ï¼Œæ¯æ¬¡è‡ªå¢1ï¼Œä¸”è‡ªå¢è‡³9ç»ˆæ­¢å¾ªç¯ï¼Œæ­£å¥½æŠŠnumsé‡Œçš„æ¯ä¸ªå…ƒç´ èµ‹å€¼ä¸€éï¼Œé‚£å¦‚æœæˆ‘ä»¬äº‹å…ˆä¸çŸ¥é“æ•°ç»„å¤§å°è¯¥æ€ä¹ˆåŠï¼Ÿè¿™æ—¶å¯ä»¥åˆ©ç”¨æ•°ç»„å˜é‡è‡ªå¸¦çš„æ–¹æ³•lengthæ¥è·å–æ•°ç»„çš„å¤§å°ï¼š ä»£ç å—19123for (int i = 0; i &lt; nums.length; i++) { //nums.lengthè¿”å›çš„å°±æ˜¯æ•°ç»„å¤§å°ï¼Œæœ¬ä¾‹ä¸­å°±æ˜¯10 nums[i] = 256;} æˆ‘ä»¬ç°åœ¨çŸ¥é“äº†æ ¹æ®æ•°ç»„çš„ä¸‹æ ‡å¯ä»¥è®¿é—®æ•°ç»„å†…å…·ä½“çš„å…ƒç´ ï¼Œé€šè¿‡å¾ªç¯ä½“å¯ä»¥æŒ‰ç…§å¾ªç¯è‡ªå¢çš„iå€¼å¿«é€Ÿè®¿é—®æ•´ä¸ªæ•°ç»„ï¼ˆè¿™ä¸ªè¿‡ç¨‹å«åšâ€œéå†â€ï¼‰ï¼Œé‚£ä¹ˆç°åœ¨æˆ‘æƒ³è¦è¾“å‡ºæ•´ä¸ªæ•°ç»„é‡Œæ¯ä¸€ä¸ªå…ƒç´ çš„å€¼å°±å˜å¾—å¾ˆç®€å•äº†ï¼Œä¾ç„¶æ˜¯forå¾ªç¯ï¼š ä»£ç å—20123for (int i = 0; i &lt; nums.length; i++) { System.out.println(nums[i]); //ä»ç„¶æ˜¯iå½“ä¸‹æ ‡ï¼Œå°†å¯¹åº”çš„æ•°å€¼è¾“å‡ºå³å¯} 3.2ï¼šforå¢å¼ºéå†æ•°ç»„å…¶å®é™¤äº†ä¸Šè¿°çš„æ–¹å¼ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§å¢å¼ºæ–¹å¼ï¼Œå†™æ³•å¦‚ä¸‹ï¼š ä»£ç å—21123for (int num : nums) { System.out.println(num);} å¯ä»¥çœ‹åˆ°ï¼Œforå¢å¼ºè¿ä¸‹æ ‡éƒ½çœå»äº†ï¼Œç›´æ¥ä½¿ç”¨æ•°ç»„çš„åŸºæœ¬ç±»å‹æ¥æ”¶éƒ½è¡Œï¼Œå®ƒæ˜¯ç”¨æ¥ç®€åŒ–æ•°ç»„éå†çš„ä¸€ç§æ–¹å¼ã€‚ 3.3ï¼šäºŒç»´æ•°ç»„&amp;foråµŒå¥—ä¸Šé¢ä»‹ç»äº†æ•°ç»„ï¼Œæ•°ç»„å°±æ˜¯ç®€å•ä¸€æ‰¹æ•°æ®ï¼Œé‚£ä¹ˆäºŒç»´æ•°ç»„åˆæ˜¯å•¥ï¼Ÿ ç›¸æ¯”ä¸€ç»´æ•°ç»„ï¼ŒäºŒç»´æ•°ç»„è·Ÿå®ƒçš„åå­—ä¸€æ ·ï¼Œå…·æœ‰æ¨ªç«–ä¸¤ä¸ªç»´åº¦çš„å…ƒç´ ï¼Œå®ƒçš„ç»“æ„å¦‚ä¸‹ï¼š å¯è§ï¼Œç›¸æ¯”ä¸€ç»´æ•°ç»„ï¼ŒäºŒç»´æ•°ç»„å®šä½åˆ°ä¸€ä¸ªå…ƒç´ éœ€è¦ä¸¤ä¸ªä¸‹æ ‡ï¼Œé‚£ä¹ˆç»™äºŒç»´æ•°ç»„é‡Œçš„æ¯ä¸€ä¸ªå…ƒç´ èµ‹å€¼å°±ä¸èƒ½ç”¨ä¸€ä¸ªforå¾ªç¯æ¥è¿›è¡Œäº†ï¼Œè¿™æ—¶éœ€è¦å€ŸåŠ©æˆ‘ä»¬çš„foråµŒå¥—ï¼š ä»£ç å—221234567891011121314151617181920212223public static void main(String[] args) { int[][] a = new int[5][5]; //è·å–æ¨ªå‘çš„é•¿åº¦ int lenX = a.length; //è·å–çºµå‘çš„é•¿åº¦ int lenY = a[0].length; for (int i = 0; i &lt; lenX; i++) { for (int j = 0; j &lt; lenY; j++) { a[i][j] = 1; } } //éå†ä¸æ‰“å° for (int i = 0; i &lt; lenX; i++) { for (int j = 0; j &lt; lenY; j++) { System.out.print(a[i][j]); } //æ¯éå†å®Œä¸€éæ¨ªè½´çš„å…ƒç´ ï¼Œåˆ™æ¢ä¸€æ¬¡è¡Œ System.out.println(); }} â“ æ€è€ƒï¼šè¯·ä»”ç»†é˜…è¯»ä¸Šé¢çš„ä»£ç ï¼Œæ ¹æ®è‡ªå·±å­¦è¿‡çš„forå¾ªç¯ï¼Œæƒ³è±¡ä¸€ä¸‹foråµŒå¥—çš„æ‰§è¡Œé¡ºåºã€‚","link":"/2020/03/02/LV1-4%EF%BC%9A%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5&%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5/"},{"title":"LV1-3ï¼šjavaä¸­çš„è¿ç®—ç¬¦","text":".heimu { color: #000; background-color: #000; } .heimu:hover { color: #fff; } ä¸€ã€è¿ç®—ç¬¦1.1ï¼šç®—æœ¯è¿ç®—ç¬¦ç®—æœ¯è¿ç®—ç¬¦ä¸»è¦åŒ…å«ï¼š è¿ç®—ç¬¦ è¯´æ˜ ç¤ºä¾‹ å¤‡æ³¨ + åŠ æ³• a + b è®¡ç®—å˜é‡é—´çš„å’Œ - å‡æ³• a - b è®¡ç®—å˜é‡é—´çš„å·® * ä¹˜æ³• a * b è®¡ç®—å˜é‡é—´çš„ç§¯ / é™¤æ³• a / b è®¡ç®—å˜é‡é—´çš„å•† % å–ä½™ a % b è®¡ç®—å˜é‡é—´çš„ä½™ ++ è‡ªå¢1 a++ æˆ– ++a ç­‰æ•ˆäºï¼ša = a + 1; æˆ–è€… a += 1;(+=åœ¨ä¸‹é¢èµ‹å€¼è¿ç®—ç¬¦ä¼šä»‹ç»)++æ”¾å˜é‡å‰é¢å’Œåé¢ï¼Œæ˜¯æœ‰åŒºåˆ«çš„ï¼Œå…·ä½“è¯·å‚è€ƒç¬¬äºŒéƒ¨åˆ†çš„ä¾‹3 â€“ è‡ªå‡1 a-- æˆ– --a ç­‰æ•ˆäºï¼ša = a - 1; æˆ–è€… a-=1;(-=åœ¨ä¸‹é¢èµ‹å€¼è¿ç®—ç¬¦ä¼šä»‹ç»)è·Ÿ++ä¸€æ ·ï¼Œä¹Ÿæœ‰å‰åä¹‹åˆ†ã€‚ è¡¨1 1.2ï¼šä½è¿ç®—ç¬¦ä½è¿ç®—ç¬¦åŒ…å«ï¼š è¿ç®—ç¬¦ è¯´æ˜ ç¤ºä¾‹ ç‰¹æ€§ &amp; ä¸è¿ç®— a &amp; b 1&amp;1=1ã€1&amp;0=0ã€0&amp;1=0ã€0&amp;0=0 | æˆ–è¿ç®— a | b `1 ~ å–å ~a ~1=0ã€~0=1 ^ å¼‚æˆ–è¿ç®— a ^ b 1^1=0ã€1^0=1ã€0^1=1ã€0^0=0 &gt;&gt;&gt; æ— ç¬¦å·å³ç§» a &gt;&gt;&gt; b å‚è€ƒæ³¨1 &gt;&gt; å³ç§»è¿ç®— a &gt;&gt; b å‚è€ƒæ³¨1 &lt;&lt; å·¦ç§»è¿ç®— a &lt;&lt; b å‚è€ƒæ³¨1 è¡¨2 âšœï¸ æ³¨1ï¼š å…³äºä½è¿ç®—çš„ä¸€åˆ‡ï¼Œè¯·å‚è€ƒï¼šJAVAæœ‰å…³ä½è¿ç®—çš„å…¨å¥—æ¢³ç† 1.3ï¼šèµ‹å€¼è¿ç®—ç¬¦èµ‹å€¼è¿ç®—ç¬¦ä¸»è¦åŒ…å«ï¼š è¿ç®—ç¬¦ è¯´æ˜ ç¤ºä¾‹ å¤‡æ³¨ = èµ‹å€¼ a = 1 è®©ç­‰å·å·¦è¾¹çš„å€¼ç­‰äºå³è¾¹çš„å€¼ï¼Œè¿™åœ¨ä¹‹å‰çš„ç¤ºä¾‹ä»£ç é‡Œå·²ç»ä½“ç°è¿‡å¾ˆå¤šæ¬¡äº†ï¼Œç®€å•ä¸€ä¸ªå˜é‡å£°æ˜çš„åˆå§‹åŒ–å€¼éƒ½éœ€è¦ç”¨åˆ°èµ‹å€¼è¿ç®—ç¬¦ï¼šint a = 1; += åšåŠ æ³•æ“ä½œåå¹¶ä¸”èµ‹å€¼ç»™è‡ªèº« a += 2 ç­‰æ•ˆäºï¼ša = a + 2è¿™ç§ç­‰å¼ä¸€èˆ¬æ˜¯ä»å³å¾€å·¦æ‰§è¡Œï¼Œæ‰€ä»¥è¯¥è¡¨è¾¾å¼çš„æ„æ€æ˜¯ï¼šå…ˆè®©aè‡ªèº«åŠ ä¸Š2ï¼Œç„¶åå†æŠŠè¿™ä¸ªç»“æœé‡æ–°èµ‹å€¼ç»™aã€‚ -= åšå‡æ³•æ“ä½œåå¹¶ä¸”èµ‹å€¼ç»™è‡ªèº« a -= 2 åŒä¸Šï¼Œåªä¸è¿‡æ¢æˆå‡æ³• *= åšä¹˜æ³•æ“ä½œåå¹¶ä¸”èµ‹å€¼ç»™è‡ªèº« a *= 2 åŒä¸Šï¼Œåªä¸è¿‡æ¢æˆä¹˜æ³• /= åšé™¤æ³•æ“ä½œåå¹¶ä¸”èµ‹å€¼ç»™è‡ªèº« a s/= 2 åŒä¸Šï¼Œåªä¸è¿‡æ¢æˆé™¤æ³• %= åšå–ä½™è¿ç®—å¹¶ä¸”èµ‹å€¼ç»™è‡ªèº« a %= 2 åŒä¸Šï¼Œåªä¸è¿‡æ¢æˆå–ä½™è¿ç®— &lt;&lt;= åšå·¦ç§»è¿ç®—å¹¶ä¸”èµ‹å€¼ç»™è‡ªèº« a &lt;&lt;= 2 ç­‰åŒäºï¼ša = a &lt;&lt; 2 &gt;&gt;= åšå³ç§»è¿ç®—å¹¶ä¸”èµ‹å€¼ç»™è‡ªèº« a &gt;&gt;= 2 ç­‰åŒäºï¼ša = a &gt;&gt; 2 &gt;&gt;&gt;= åšæ— ç¬¦å·å·¦ç§»è¿ç®—å¹¶ä¸”èµ‹å€¼ç»™è‡ªèº« a &gt;&gt;&gt;= 2 ç­‰åŒäºï¼ša = a &gt;&gt;&gt;2 &amp;= åšä¸è¿ç®—å¹¶ä¸”èµ‹å€¼ç»™è‡ªèº« a &amp;= 2 ç­‰åŒäºï¼ša = a &amp; 2 |= åšæˆ–è¿ç®—å¹¶ä¸”èµ‹å€¼ç»™è‡ªèº« `a = 2` ^= åšå¼‚æˆ–è¿ç®—å¹¶ä¸”èµ‹å€¼ç»™è‡ªèº« a ^= 2 ç­‰åŒäºï¼ša = a ^ 2 è¡¨3 1.4ï¼šå…³ç³»è¿ç®—ç¬¦å…³ç³»è¿ç®—ç¬¦ç”¨æ¥è¿ç®—ä¸¤ä¸ªå€¼çš„å¤§å°ã€æ˜¯å¦ç›¸ç­‰ç­‰å…³ç³»ï¼Œç»è¿‡å…³ç³»è¿ç®—ç¬¦è¿ç®—åçš„ä¸¤ä¸ªå€¼çš„ç»“æœä¸€å®šæ˜¯booleanç±»å‹çš„ï¼Œç»“æœåªæœ‰çœŸæˆ–å‡ã€‚ å…³ç³»è¿ç®—ç¬¦ä¸»è¦åŒ…å«ï¼š è¿ç®—ç¬¦ è¯´æ˜ ç¤ºä¾‹ å¤‡æ³¨ &gt; å¤§äº a &gt; b å‚è€ƒæ³¨2 &gt;= å¤§äºç­‰äº a &gt;= b åŒä¸Šï¼Œåˆ¤æ–­å…³ç³»ä¸ºå¤§äºç­‰äº &lt;= å°äºç­‰äº a &lt;= b åŒä¸Šï¼Œåˆ¤æ–­å…³ç³»ä¸ºå°äºç­‰äº &lt; å°äº a &lt; b åŒä¸Šï¼Œåªä¸è¿‡åˆ¤æ–­å…³ç³»ä¸ºå°äº == ç­‰äº a == b å‚è€ƒæ³¨3 != ä¸ç­‰äº a != b å‚è€ƒæ³¨4 è¡¨4 âšœï¸ æ³¨2ï¼š ç”¨äºåˆ¤æ–­ä¸¤ä¸ªå€¼å¤§å°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯”è¾ƒå¤§å°çš„å…³ç³»è¿ç®—ç¬¦æ— æ³•ç”¨æ¥æ¯”è¾ƒå¤§éƒ¨åˆ†çš„å¼•ç”¨å˜é‡ï¼Œå› æ­¤ä¸å­˜åœ¨cat1 &gt; cat2è¿™ç§ä»£ç ã€‚ ä»£ç å—1123char a = 'æˆ‘';int b = 25105;boolean d = a &gt; b; ä¸Šé¢ç»“æœä¸ºfalse âšœï¸ æ³¨3ï¼š ç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªå˜é‡æ˜¯å¦ç›¸ç­‰ï¼š ä»£ç å—21234567//å£°æ˜aã€bã€cï¼Œå¹¶ä¸ºå®ƒä»¬èµ‹åˆå§‹å€¼int a = 1;int b = 1;int c = 2;//è¿ç®—ç¬¦==è¿”å›çš„æ˜¯å¸ƒå°”å‹æ•°æ®ï¼Œå› ä¸ºå…¶åˆ¤å®šç»“æœåªæœ‰çœŸæˆ–å‡ä¸¤ç§çŠ¶æ€boolean d = a == b;boolean e = a == c; å¦‚ä¸Šä»£ç ï¼Œdçš„ç»“æœä¸ºtrueï¼Œeçš„ç»“æœä¸ºfalse ç®€å•çš„åŸºæœ¬ç±»å‹ï¼Œåˆ¤ç­‰æ–¹å¼æ˜¯å¾ˆç®€å•çš„ï¼Œå€¼ä¸€æ ·ï¼Œå°±ç›¸ç­‰ï¼Œå“ªæ€•ç±»å‹ä¸ä¸€è‡´ï¼š ä»£ç å—3123char a = 'æˆ‘';int b = 25105;boolean d = a == b; dçš„ç»“æœå€¼ä¾ç„¶æ˜¯trueï¼Œå› ä¸ºæ±‰å­—â€œæˆ‘â€å¯¹åº”çš„Unicodeç å€¼å°±æ˜¯25105ã€‚ é€šè¿‡ä¸Šé¢ä¸¤ä¸ªä¾‹å­ï¼Œå¯ä»¥å‘ç°åŸºæœ¬ç±»å‹çš„åˆ¤ç­‰å¾ˆå•çº¯ï¼Œå°±æ˜¯çœ‹æ•°å€¼æ˜¯å¦ç›¸ç­‰è€Œå·²ã€‚ âš ï¸ä¸‹é¢çš„å†…å®¹å»ºè®®çœ‹å®ŒLV3-1åå†æ¥é˜…è¯» æ—¢ç„¶==æ˜¯ç”¨æ¥ä¸ºå˜é‡åˆ¤ç­‰çš„ï¼Œé‚£å®ƒæ˜¯å¦ä¹Ÿèƒ½ç”¨æ¥åˆ¤æ–­å¤æ‚çš„å¼•ç”¨å˜é‡æ˜¯å¦ç›¸ç­‰å‘¢ï¼Ÿ ç°åœ¨è®©æˆ‘ä»¬å›å¿†ä¸€ä¸‹LV3-1é‡Œçš„é‚£åªçŒ«ï¼Œé€šè¿‡é‚£åªçŒ«çš„ä¾‹å­ï¼Œæˆ‘ä»¬çŸ¥é“äº†å¼•ç”¨å˜é‡å…¶å®æ˜¯ä¸€ä¸ªä¿å­˜äº†æŸä¸ªå†…å­˜åœ°å€çš„å˜é‡ï¼Œå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªå®é™…çš„å¯¹è±¡ï¼Œå®ƒåªæ˜¯ä¿å­˜äº†å®é™…å¯¹è±¡çš„åœ°å€ï¼Œæ–¹ä¾¿é€šè¿‡å®ƒåœ¨å†…å­˜ä¸­è®¿é—®åˆ°é‚£å—å¯¹è±¡æ•°æ®ï¼Œæˆ‘ä»¬è¿˜çŸ¥é“ï¼Œå½“ä¸€ä¸ªç±»åˆ©ç”¨å…¶æ„é€ æ–¹æ³•è¢«newå‡ºæ¥çš„æ—¶å€™ï¼Œå®ƒå°±äº§ç”Ÿäº†ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡å°±ä¼šå­˜åœ¨ä¸€å—å†…å­˜åŒºåŸŸå†…ï¼Œæ­¤æ—¶å¯¹è±¡è‡ªç„¶å°±æœ‰äº†å¯¹åº”çš„å†…å­˜åœ°å€ï¼Œè€Œå°†è¯¥åœ°å€èµ‹å€¼ç»™å¯¹åº”çš„å¼•ç”¨å˜é‡ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡æ­¤å¼•ç”¨å˜é‡è®¿é—®å…·ä½“çš„å¯¹è±¡å†…å®¹äº†ï¼Œå¦‚æœè¿˜æ˜¯ä¸å¤ªç†Ÿæ‚‰è¿™ä¸ªè¿‡ç¨‹ï¼Œè¯·å†æ¬¡ç¿»çœ‹LV1-2ä¸­çš„å›¾7ã€‚ ç°åœ¨æˆ‘ä»¬ä»ç„¶ç”¨é‚£ä¸ªçŒ«ç±»æ¥è¯´æ˜é—®é¢˜ï¼š ä»£ç å—4123456789101112public static void main(String[] args) { int gender = 1; int age = 5; int color = 1; String name = \"åŠ è²\"; Cat cat1 = new Cat(gender, age, color, name); Cat cat2 = new Cat(gender, age, color, name); boolean result = cat1 == cat2; System.out.println(result);} ç”±ä¸Šé¢çš„ä»£ç å¯çŸ¥ï¼Œæˆ‘ä»¬é€ å‡ºæ¥äº†ä¸¤åªçŒ«ï¼Œå®ƒä»¬çš„å„é¡¹å±æ€§å…¨éƒ¨ä¸€è‡´ï¼Œé‚£ä¹ˆç°åœ¨è¯·æ€è€ƒä¸€ä¸‹ï¼Œå¼•ç”¨å˜é‡cat1å’Œå¼•ç”¨å˜é‡cat2æ˜¯å¦ç›¸ç­‰å‘¢ï¼Ÿä¸Šé¢çš„ç»“æœåº”è¯¥æ˜¯trueè¿˜æ˜¯falseï¼Ÿ è¾“å‡ºç»“æœä¸ºfalseã€‚ ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå®ƒä»¬æ˜æ˜ä»€ä¹ˆéƒ½ä¸€æ ·ï¼ï¼å›å¿†ä¸€ä¸‹æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚æœ‰å…³å¼•ç”¨å˜é‡çš„è§£é‡Šï¼Œå¼•ç”¨å˜é‡ä¿å­˜çš„æ˜¯å†…å­˜åœ°å€ï¼Œè€Œæˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€ å‡ºäº†ä¸¤åªçŒ«ï¼Œå°½ç®¡å®ƒä»¬å•¥éƒ½ä¸€è‡´ï¼Œä½†äº‹å®ä¸Šï¼Œè¿™ç§ä¸€è‡´ä½ å¯ä»¥ç†è§£æˆâ€œå·§åˆâ€ï¼Œç¢°å·§æœ‰ä¸¤åªåå­—éƒ½å«åŠ è²çš„5å²é»‘è‰²å…¬çŒ«ï¼Œ æ‰€ä»¥å®é™…ä¸Šå®ƒä»¬æ˜¯ä¸åŒçš„ä¸¤ä¸ªå¯¹è±¡ï¼Œå®ƒä»¬åœ¨åœ°çƒä¸Šæ‰€å¤„çš„ä½ç½®ä¸å¯èƒ½ç©¿é€å¯¹æ–¹çš„èº«ä½“é‡åˆå­˜åœ¨ï¼ŒæŠ½è±¡åˆ°è®¡ç®—æœºå±‚é¢ï¼Œå®ƒä»¬éœ€è¦å­˜å‚¨åœ¨ä¸åŒçš„å­˜å‚¨å•å…ƒå†…ï¼Œå­˜å‚¨å•å…ƒä¸åŒï¼Œè‡ªç„¶å­˜å‚¨åœ°å€ä¸åŒï¼Œé‚£ä¹ˆcat1å’Œcat2åˆæ€ä¹ˆä¼šç›¸ç­‰å‘¢ã€‚ é‚£ä¹ˆç°åœ¨å†æ€è€ƒä¸‹ï¼Œå¦‚ä½•è®©cat1å’Œcat2ç›¸ç­‰ï¼Ÿ ç°åœ¨è®©æˆ‘ä»¬æ”¹é€ ä¸‹ä¸Šé¢çš„ä»£ç ï¼š ä»£ç å—5123456789101112public static void main(String[] args) { int gender = 1; int age = 5; int color = 1; String name = \"åŠ è²\"; Cat cat1 = new Cat(gender, age, color, name); Cat cat2 = cat1; //è¿™é‡ŒæŠŠcat1ç›´æ¥èµ‹å€¼ç»™cat2 boolean result = cat1 == cat2; System.out.println(result);} è¿™æ—¶ç»“æœå°±ä¸ºtrueï¼Œè¿™é‡Œåº”è¯¥éƒ½ç†è§£ä¸ºä»€ä¹ˆäº†ï¼Œå› ä¸ºcat1æœ¬èº«æ˜¯å¼•ç”¨å˜é‡ï¼Œä¿å­˜çš„æ˜¯newå‡ºæ¥é‚£ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œç°åœ¨ç›´æ¥æŠŠå®ƒçš„å€¼èµ‹å€¼ç»™cat2ï¼Œå› æ­¤cat2é‡Œä¿å­˜çš„åœ°å€è·Ÿcat1ä¸­æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å®ƒä»¬ä¸€å®šæ˜¯ç›¸ç­‰çš„ã€‚ âšœï¸ æ³¨4ï¼š è·Ÿ==æ€§è´¨ä¸€æ ·ï¼Œåªä¸è¿‡å®ƒç”¨æ¥è¡¨ç¤ºä¸ç­‰äºï¼Œè¿ç®—æ–¹å¼è·Ÿ==ç›¸åã€‚ æ‰€ä»¥ï¼š ä»£ç å—6123char a = 'æˆ‘';int b = 25105;boolean d = a != b; è¿™ä¸ªä¾‹å­æŠŠ==æ¢æˆ!=åï¼Œè¾“å‡ºç»“æœå°±ä¸ºfalseäº†ï¼Œå¼•ç”¨å˜é‡å°±ä¸ä¸¾ä¾‹äº†ã€‚ 1.5ï¼šé€»è¾‘è¿ç®—ç¬¦è®²å®Œäº†å…³ç³»è¿ç®—ç¬¦ï¼Œç°åœ¨å†æ¥è®¤è¯†ä¸‹é€»è¾‘è¿ç®—ç¬¦ï¼Œé€»è¾‘è¿ç®—ç¬¦ä¸»è¦ç”¨æ¥è¿ç®—ä¸¤ä¸ªæˆ–å¤šä¸ªå¸ƒå°”å€¼é—´çš„çœŸå‡ï¼Œå› æ­¤é€»è¾‘è¿ç®—ç¬¦ä¸¤è¾¹è¿æ¥çš„å˜é‡å¿…é¡»æ˜¯booleanç±»å‹çš„æ•°æ®ã€‚ è¿ç®—ç¬¦ è¯´æ˜ ç¤ºä¾‹ å¤‡æ³¨ &amp; ä¸è¿ç®— a &amp; b å‚è€ƒæ³¨5 | æˆ–è¿ç®— `a b` ^ å¼‚æˆ– a ^ b åŒä¸Šï¼Œåªæ˜¯é€»è¾‘åŒâ€œå¼‚æˆ–â€ ! é !a å‚è€ƒæ³¨6 &amp;&amp; çŸ­è·¯ä¸ a &amp;&amp; b å‚è€ƒæ³¨7 || çŸ­è·¯æˆ– `a è¡¨5 âšœï¸ æ³¨5ï¼š æ²¡é”™ï¼Œåˆæ˜¯è¿™ä¸ªç¬¦å·ï¼Œæˆ‘ä»¬åœ¨1.2é‡Œçš„ä½è¿ç®—ç¬¦é‡Œå·²ç»ç¢°åˆ°è¿‡äº†ï¼Œåªä¸è¿‡1.2é‡Œå®ƒè¿æ¥ä¸¤ä¸ªébooleanç±»å‹çš„å˜é‡ï¼Œç”¨æ¥è¡¨ç¤ºä¸¤ä¸ªå˜é‡çš„äºŒè¿›åˆ¶æ•°çš„ä¸è¿ç®—ï¼Œ è¿™é‡Œå®ƒè¢«ç”¨æ¥è¿æ¥ä¸¤ä¸ªbooleanç±»å‹çš„å˜é‡æ—¶ï¼Œç”±äºbooleanç±»å‹çš„æ•°æ®ä»…æœ‰çœŸå’Œå‡ä¸¤ç§çŠ¶æ€ï¼Œå› æ­¤å®ƒä»…ç”¨æ¥åšç®€å•çš„ä¸é—¨è½¬æ¢ï¼š ä»£ç å—7123456boolean a = true;boolean b = false; boolean c = a &amp; b; //aå’Œbç›¸ä¸ System.out.println(c); ç»“æœä¸ºfalseï¼Œå› ä¸ºtrue &amp; false = false ç»“åˆ1.4é‡Œçš„å…³ç³»è¿ç®—ç¬¦ï¼Œå¯ä»¥çŸ¥é“ä»»æ„å…³ç³»è¿ç®—ç¬¦è¿æ¥çš„å¼å­ï¼Œå…¶ç»“æœä¸€å®šæ˜¯ä¸€ä¸ªbooleanå€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å†™æ›´ä¸ºå¤æ‚çš„ç›¸ä¸ä»£ç ï¼š ä»£ç å—8123456789int a = 1;int b = 1; int c = 5;int d = 6; boolean r = (a == b) &amp; (c != d); System.out.println(r); ç»“æœä¸ºtrueï¼Œå› ä¸ºä½¿ç”¨å…³ç³»è¿ç®—ç¬¦==è¿æ¥çš„aã€bç»“æœä¸ºtrueï¼Œè€Œç”¨!=è¿æ¥çš„cã€dçš„ç»“æœä¹Ÿä¸ºtrueï¼Œé‚£ä¹ˆæœ€ç»ˆç¬¦å·&amp;è¿æ¥çš„booleanå€¼å°±è¢«ç®€åŒ–æˆäº†ï¼štrue &amp; true ç»“æœè‡ªç„¶æ˜¯trueï¼Œåˆ©ç”¨è¿™ç§ç‰¹æ€§æˆ‘ä»¬åç»­åœ¨javaç¨‹åºé‡Œå¯ä»¥åšå¾ˆå¤šé€»è¾‘åˆ¤å®šï¼Œæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰ä¸¾å¾—Catç±»é‡Œçš„runæ–¹æ³•ï¼š ä»£ç å—91234567public void run() { if (age &gt; 10) { //è¿™é‡Œå°±æ˜¯ä¸€ä¸ªé€»è¾‘åˆ¤å®šï¼Œåˆ©ç”¨å…³ç³»è¿ç®—ç¬¦&gt;è¿æ¥ä¸¤ä¸ªæ•°ï¼Œå½“ageå¤§äº10çš„æ—¶å€™æ¡ä»¶æˆç«‹ä¸ºtrueï¼Œè¾“å‡º10km/hï¼Œå¦åˆ™è¾“å‡ºä¸‹é¢çš„15km/h System.out.println(\"å¥”è·‘é€Ÿåº¦ï¼š10km/h\"); } else { System.out.println(\"å¥”è·‘é€Ÿåº¦ï¼š15km/h\"); }} âšœï¸ æ³¨6ï¼š ç±»ä¼¼ä½è¿ç®—é‡Œçš„æŒ‰ä½å–å~ï¼Œå³è®©è‡ªå·±çš„ç»“æœå€¼åè¿‡æ¥ï¼Œä¾‹å¦‚ï¼š ä»£ç å—10123456int a = 1;int b = 1; boolean c = !(a == b); System.out.println(c); a == bè¿™ä¸ªå…³ç³»è¯­å¥çš„ç»“æœè‚¯å®šæ˜¯trueï¼Œä½†æ˜¯å®ƒåœ¨å¤–å±‚åŠ äº†!ï¼Œæ„å‘³ç€ç»“æœè¦è·Ÿå®é™…å€¼åè¿‡æ¥ï¼Œå› æ­¤cçš„ç»“æœä¸ºfalseã€‚ âšœï¸ æ³¨7ï¼š ç›¸æ¯”&amp;ï¼ŒçŸ­è·¯ä¸æ›´åŠ â€œæ™ºèƒ½â€ï¼Œå¦‚æœç¬¬ä¸€ä¸ªæ¡ä»¶ä¸æˆç«‹ï¼Œåˆ™ç›´æ¥è¿”å›ç»“æœï¼Œè¿™ä¹ˆè¯´ä¸å®¹æ˜“ç†è§£ï¼Œä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ï¼š ä»£ç å—111234567891011int a = 1;int b = 1; int c = 5;int d = 6; boolean r1 = (a != b) &amp; (c != d);boolean r2 = (a != b) &amp;&amp; (c != d); System.out.println(r1);System.out.println(r2); ä¸Šé¢r1å’Œr2çš„æ‰§è¡Œç»“æœæ˜¯ä¸€è‡´çš„ï¼Œéƒ½æ˜¯falseï¼Œä½†æ‰§è¡Œçš„æ–¹å¼å´ä¸ä¸€æ ·ï¼š ä¸Šè¿°å°±æ˜¯çŸ­è·¯ä¸å’Œæ­£å¸¸ä¸å‚ä¸è¿ç®—æ—¶çš„åŒºåˆ«ï¼Œä½†æ˜¯å¦‚æœç¬¬ä¸€ä¸ªæ¡ä»¶æˆç«‹(true)ï¼Œä»ç„¶éœ€è¦è¿›è¡Œåç»­æ¡ä»¶çš„åˆ¤æ–­ï¼Œè¿™æ—¶ä¸&amp;æ— å¼‚ï¼Œä½†çŸ­è·¯ä¸æ€»æ˜¯å°½å¯èƒ½çš„å‡å°‘å…³ç³»è¿ç®—çš„æ¬¡æ•°ã€‚ ä¸€èˆ¬å»ºè®®ä½¿ç”¨çŸ­è·¯ä¸åšä¸é€»è¾‘è¿ç®—ã€‚ 1.6ï¼šä¸‰å…ƒè¿ç®—ç¬¦é€šè¿‡å¯¹ä¸Šé¢å…³ç³»è¿ç®—ç¬¦çš„äº†è§£åï¼Œç°åœ¨æ¥äº†è§£ä¸€ç§ç‰¹æ®Šçš„è¿ç®—ç¬¦ï¼šä¸‰å…ƒè¿ç®—ç¬¦ï¼ˆxx ? yy : zzï¼‰ã€‚ ä¸‰å…ƒè¿ç®—ç¬¦ä¼šç»“åˆèµ‹å€¼è¿ç®—ç¬¦å’Œå…³ç³»è¿ç®—ç¬¦åˆè®¡ä½¿ç”¨ï¼Œæ—¨åœ¨æŒ‘é€‰ç¬¦åˆè‡ªå·±é¢„æœŸçš„å€¼ï¼ˆå…¶å®è·Ÿåé¢è¦è®²çš„æ¡ä»¶è¯­å¥if/elseæœ‰äº›åƒï¼‰ã€‚ ç°åœ¨æ¥ç®€å•äº†è§£ä¸‹å…¶ç»“æ„ï¼š ä¸Šå›¾å±•ç¤ºäº†ä¸€ä¸ªä¸‰å…ƒè¡¨è¾¾å¼ä»¥åŠå…¶ç»„æˆéƒ¨åˆ†ã€‚ æœ€ç»ˆsçš„å€¼ä¸º11ï¼› æˆ‘ä»¬è¿˜å¯ä»¥åµŒå¥—ä¸‰å…ƒè¡¨è¾¾å¼ï¼š ä»£ç å—1212345678//å£°æ˜å˜é‡&amp;èµ‹å€¼int a = 1;int b = 2;int c = 5;int d = 6; int s = (a &gt; b) ? 10 : ((c &lt; d) ? 66 : 77); é¦–å…ˆåˆ¤æ–­a&gt;bæ˜¯å¦æˆç«‹ï¼Œç”±aå’Œbçš„å€¼å¯çŸ¥æ˜¯ä¸æˆç«‹çš„ï¼Œæ‰€ä»¥ä¼šè·³è¿‡10è¿™ä¸ªç»“æœï¼Œé€‰å–å†’å·åé¢çš„å€¼ï¼Œè€Œå†’å·åé¢ä»ç„¶æ˜¯ä¸€ä¸ªä¸‰å…ƒè¡¨è¾¾å¼ï¼Œè¿™ä¸ªä¸‰å…ƒè¡¨è¾¾å¼çš„å€¼ä¸º66ï¼Œå› æ­¤sæœ€ç»ˆç­‰äº66ã€‚ç†è®ºä¸Šjavaå…è®¸ä½ æ— é™å¥—å¨ƒï¼Œä½†ä¸ºä¿è¯ä»£ç å¯è¯»æ€§ï¼Œä¸å»ºè®®åµŒå¥—ä¸‰å…ƒè¡¨è¾¾å¼ äºŒã€è¿ç®—ç¬¦é—´çš„ä¼˜å…ˆçº§2.1ï¼šè¿ç®—é¡ºåºçŒœæƒ³æˆ‘ä»¬åœ¨ä¹‹å‰çš„ç¤ºä¾‹ä»£ç é‡Œç»å¸¸ä¼šçœ‹åˆ°ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„ä»£ç ï¼š ä»£ç å—13123int a = 1; //å£°æ˜å˜é‡aï¼Œå¹¶é€šè¿‡èµ‹å€¼è¿ç®—ç¬¦ä¸ºå…¶èµ‹å€¼int b = 2; //å£°æ˜å˜é‡bï¼Œå¹¶é€šè¿‡èµ‹å€¼è¿ç®—ç¬¦ä¸ºå…¶èµ‹å€¼int c = a + b; //å£°æ˜å˜é‡cï¼Œç„¶åé€šè¿‡èµ‹å€¼è¿ç®—ç¬¦ä¸ºå…¶èµ‹å€¼ï¼Œå€¼ä¸ºaå’Œbé€šè¿‡ç®—æœ¯è¿ç®—ç¬¦â€+â€œè¿ç®—åçš„ç»“æœå€¼ é‚£ä¹ˆç±»ä¼¼int c = a + b;è¿™ç§è¯­å¥ï¼Œå®ƒçš„æ‰§è¡Œé¡ºåºä¸ºä»€ä¹ˆä¸æ˜¯ç›´æ¥ç»™cé€šè¿‡â€=â€œè¿ç®—ç¬¦èµ‹ä¸Šaçš„å€¼ï¼Œç„¶åå†è®¡ç®—aå’Œbçš„â€+â€œè¿ç®—å‘¢ï¼Ÿå³ï¼š å¦‚å›¾ï¼Œå¦‚æœæˆ‘ä»¬æŠŠint c = a + b;è¿™ç§è¯­å¥æŒ‰ç…§ä¸Šå›¾çš„æ‹†åˆ†æ–¹å¼è¿›è¡Œè¿ç®—ï¼Œé‚£ä¹ˆè¿™æ®µä»£ç çš„æœ€ç»ˆè¿è¡Œç»“æœå°†æ˜¯cç­‰äºaçš„å€¼ï¼Œå…¶ä½™æ— äº‹å‘ç”Ÿï¼Œç„¶è€Œç»è¿‡å‰é¢é‚£ä¹ˆå¤šç¤ºä¾‹ï¼Œæˆ‘ä»¬çŸ¥é“è¿™æ˜¯ä¸å¯¹çš„ï¼Œcçš„å€¼åº”è¯¥ç­‰äºa+bçš„è¿è¡Œç»“æœæ‰å¯¹ï¼Œé‚£ä¹ˆè¿™å°±æ„å‘³ç€åŠ æ³•è¿ç®—å‘ç”Ÿåœ¨èµ‹å€¼è¿ç®—ä¹‹å‰ï¼Œå³ï¼š çœŸæ­£çš„æ‰§è¡Œè¿‡ç¨‹åº”è¯¥æ˜¯å›¾4ä¸­çš„è¿‡ç¨‹ï¼Œè¿™æ ·çš„ç»“æœä¼¼ä¹åœ¨å‘Šè¯‰æˆ‘ä»¬ï¼Œè¿ç®—ç¬¦ä¹‹é—´å­˜åœ¨ç€æŸç§ç­‰çº§ï¼Œç­‰çº§é«˜çš„å…ˆæ‰§è¡Œï¼Œç­‰çº§ä½çš„å¾€åç¨ç¨ï¼Œè¿™å°±æ˜¯è¿ç®—ç¬¦ä¹‹é—´çš„æ‰§è¡Œä¼˜å…ˆçº§ï¼Œé€šè¿‡æˆ‘ä»¬å¯¹int c = a + b;è¿™ç§è¯­å¥çš„äº†è§£ï¼Œæˆ‘ä»¬è‡³å°‘å·²ç»çŸ¥é“äº†â€+â€œåº”è¯¥å‘ç”Ÿåœ¨â€=â€œä¹‹å‰ï¼Œå³ç®—æœ¯è¿ç®—ç¬¦åº”å‘ç”Ÿåœ¨èµ‹å€¼è¿ç®—ç¬¦ä¹‹å‰æ‰§è¡Œã€‚ 2.2ï¼šè¿ç®—ç¬¦çš„ä¼˜å…ˆçº§åˆ—è¡¨é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å°±æ¥åˆ—ä¸€ä¸‹æ‰€æœ‰è¿ç®—ç¬¦çš„æ‰§è¡Œä¼˜å…ˆçº§ï¼š ä¼˜å…ˆçº§ï¼ˆä»é«˜è‡³ä½æ’åºï¼‰ è¿ç®—ç¬¦ ç»“åˆæ€§ 1 ( ) [ ] . å·¦â†’å³ 2 ! ~ ++ â€“ å³â†’å·¦ 3 * / % å·¦â†’å³ 4 + - å·¦â†’å³ 5 &lt;&lt; &gt;&gt; &gt;&gt;&gt; å·¦â†’å³ 6 &lt; &lt;= &gt; &gt;= instanceof å·¦â†’å³ 7 == != å·¦â†’å³ 8 &amp; å·¦â†’å³ 9 ^ å·¦â†’å³ 10 | å·¦â†’å³ 11 &amp;&amp; å·¦â†’å³ 12 || å·¦â†’å³ 13 ? : å³â†’å·¦ 14 = += -= *= /= &amp;= |= ^= ~= &lt;&lt;= &gt;&gt;= &gt;&gt;&gt;= å³â†’å·¦ è¡¨6 2.3ï¼šå®ä¾‹ç»“åˆä¸Šé¢çš„è¡¨ï¼Œæˆ‘ä»¬é€šè¿‡å‡ ä¸ªä¾‹å­æ¥å›ºåŒ–ä¸€ä¸‹æˆ‘ä»¬çš„è®°å¿†ï¼š ä¾‹1ï¼šæ‹¬å·çš„è¿ç®—ç­‰çº§æ˜¯æœ€é«˜çš„ä»£ç å—14123int a = 1;int b = (a + 1) * 2; //è¿™é‡Œç”±äºæ‹¬å·è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§é«˜äºä¸€åˆ‡ï¼Œæ‰€ä»¥æ‹¬å·å†…çš„å†…å®¹a+1å…ˆè¢«æ‰§è¡Œint c = (a + b) + (22 + 5); //å¦‚æœæœ‰å¤šä¸ªæ‹¬å·ï¼Œåˆ™ä¾æ®\"ç»“åˆæ€§\"å¯çŸ¥ï¼Œåº”è¯¥ç”±å·¦è‡³å³æ‰§è¡Œï¼Œå› æ­¤è¿™é‡Œçš„æ‰§è¡Œé¡ºåºä¸ºå…ˆæ‰§è¡Œa+bï¼Œå†æ‰§è¡Œ22+5 è¿™ä¸ªç¬¦åˆæ•°å­¦é‡Œçš„è¿ç®—è§„åˆ™ï¼Œä¾‹å¦‚ï¼š ä¹˜é™¤æ³•çš„ä¼˜å…ˆçº§é«˜äºåŠ å‡æ³•ï¼Œæ‰€ä»¥ç±»ä¼¼â€œint c = a + b * 2â€ï¼Œé¦–å…ˆè®¡ç®—çš„æ˜¯b2çš„å€¼ï¼Œç„¶åå†æ‹¿ç€b2çš„ç»“æœè·Ÿaç›¸åŠ ï¼Œä½†æ˜¯å¦‚æœæ”¹æˆâ€œint c = (a + b) *2â€çš„è¯ï¼Œå°±å˜æˆå…ˆæ‰§è¡Œæ‹¬å·å†…çš„åŠ æ³•è¿ç®—ï¼Œç„¶åæ‹¿ç€å’Œå»å’Œ2ç›¸ä¹˜ã€‚ ä¾‹2ï¼šæ‹¬å·ã€éè¿ç®—ã€ä¸è¿ç®—ã€æˆ–è¿ç®—ç»“åˆæ™®é€šéè¿ç®—+æ‹¬å·ï¼š ä»£ç å—151234//éint a = 1;int b = 2;boolean s = !(a &lt; b); // æŒ‰ç…§ä¼˜å…ˆçº§ï¼Œæ‹¬å·å†…çš„å…ˆè¿ç®—ï¼Œa&lt;bç»“æœä¸ºtrueï¼Œç„¶åå†è¿ç®—ä»…æ¬¡äºæ‹¬å·çš„è¿ç®—ç¬¦!ï¼Œæœ€åèµ‹å€¼ç»™sï¼Œsçš„å€¼ä¸ºfalse åµŒå¥—éè¿ç®—ï¼š ä»£ç å—16123456int a = 1;int b = 2; boolean s = !!(a &lt; b);// â†‘é¦–å…ˆè®¡ç®—ä¼˜å…ˆçº§é«˜çš„æ‹¬å·å†…çš„å€¼ï¼Œä¸ºtrueï¼Œç„¶ååŒçº§éè¿ç®—çš„ç»“åˆæ€§æŒ‰ç…§ä»å³åˆ°å·¦ï¼Œå› æ­¤å³ä¾§çš„\"!\"é¦–å…ˆå‚ä¸è¿ç®—ï¼Œ// ç»“æœä¸ºfalseï¼Œç„¶åæ‹¿ç€ç»“æœå†ç”¨æœ€å¤–ä¾§çš„\"!\"å‚ä¸è¿ç®—ï¼Œç»“æœä¸ºtrue æ‹¬å·ã€åµŒå¥—éè¿ç®—ã€ä¸ã€æˆ–è¿ç®—ç»“åˆï¼š ä»£ç å—17123456int a = 1;int b = 2;boolean c = false;boolean d = true;boolean e = true;boolean s = !!(a &lt; b) &amp; c &amp; d | !!!e; è¿™ä¸ªçœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œæˆ‘ä»¬å€ŸåŠ©æµç¨‹å›¾æ¥æ¢³ç†ä¸‹ï¼š ä¾‹3ï¼ši++ã€++ié—®é¢˜ç”±è¡¨6å¯çŸ¥++è¿ç®—ç¬¦ä¼˜å…ˆçº§ä»…æ¬¡äºæ‹¬å·ã€‚ ç±»ä¼¼è¿™ç§++çš„æ–¹å¼ï¼Œæœ‰ä¸¤ç§å†™æ³•ï¼ša++å’Œ++a ++ä½äºå˜é‡çš„å‰é¢å’Œåé¢æœ€ç»ˆå˜é‡çš„ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼š ä»£ç å—18123456789//å£°æ˜å˜é‡aå’Œbï¼Œå®ƒä»¬çš„å€¼éƒ½æ˜¯1int a = 1;int b = 1; a++; //aè‡ªå¢1ï¼Œ++æ”¾å…¶åé¢++b; //bè‡ªå¢1ï¼Œ++æ”¾å…¶å‰é¢ System.out.println(a);System.out.println(b); æœ€ç»ˆè¾“å‡ºç»“æœéƒ½æ˜¯2ï¼Œé‚£ä¹ˆ++æ”¾å‰é¢å’Œæ”¾åé¢æœ‰ä½•åŒºåˆ«å‘¢ï¼Ÿ ä»£ç å—1912345678910111213//å£°æ˜å˜é‡aå’Œbï¼Œå®ƒä»¬çš„å€¼éƒ½æ˜¯1int a = 1;int b = 1; int c = a++; //aè‡ªå¢1ï¼Œ++æ”¾å…¶åé¢ï¼Œå°†açš„å€¼èµ‹å€¼ç»™cint d = ++b; //bè‡ªå¢1ï¼Œ++æ”¾å…¶å‰é¢ï¼Œå°†bçš„å€¼èµ‹å€¼ç»™d System.out.println(a);System.out.println(b); System.out.println(c);System.out.println(d); ä¸Šé¢è¾“å‡ºç»“æœï¼Œaå’Œbè‡ªç„¶è¿˜æ˜¯ç­‰äº2ï¼Œä½†æ˜¯cå’Œdå´ä¸ç›¸åŒï¼š cæœ€ç»ˆç­‰äº1ï¼Œdæœ€ç»ˆç­‰äº2. é¦–å…ˆæˆ‘ä»¬çŸ¥é“++æ“ä½œç›¸å½“äºå˜é‡è‡ªå¢ï¼Œa++ç›¸å½“äºa = a+1ï¼Œæ‰€ä»¥ç±»ä¼¼è¿™ç§è¯­å¥ï¼š int c = a++; ç›¸å½“äºæœ‰ä¸¤ä¸ªèµ‹å€¼è¿ç®—ç¬¦ï¼š å…ˆè®°ä½è¿™ä¸ªæµç¨‹ï¼Œä¸‹é¢æ¥çœ‹ä¸‹++æ”¾åˆ°å˜é‡åé¢å’Œå‰é¢çš„åŒºåˆ«ï¼š æ‰€ä»¥ int c = a ++;è¿™æ®µä»£ç æ˜¯å…ˆæ‰§è¡Œçš„èµ‹å€¼è¿ç®—ç¬¦ï¼Œå› æ­¤cçš„å€¼ç­‰äºè¿˜æ²¡å®Œæˆè‡ªå¢å‰çš„aã€‚ç›¸åçš„ï¼Œå¦‚æœ++æ”¾åˆ°è‡ªå¢å˜é‡å‰é¢ï¼Œåˆ™æ„å‘³ç€å®ƒçš„æ‰§è¡Œä¼˜å…ˆçº§é«˜äºèµ‹å€¼è¿ç®—ç¬¦ï¼Œæ‰€ä»¥ int c = ++ a;è¿™æ®µä»£ç æ˜¯å…ˆæ‰§è¡Œ++æ“ä½œï¼Œç„¶åå†å°†++åçš„å€¼èµ‹å€¼ç»™cã€‚ â“ æ€è€ƒï¼šè¯·é—®ä¸‹æ–¹çš„aã€bã€cçš„æœ€ç»ˆå€¼åˆ†åˆ«ç­‰äºå¤šå°‘ï¼Ÿ ä»£ç å—2012345int a = 1;int b = a++ + 1;int c = ++b + 1;System.out.println(b);System.out.println(c); ç­”æ¡ˆï¼ša=2ï¼Œb=3ï¼Œc=4 ä¸‰ã€è¿ç®—ç¬¦ä¸‹çš„è‡ªåŠ¨è½¬å‹æˆ‘ä»¬é€šè¿‡LV-2-å››å¯ä»¥çŸ¥é“åŸºæœ¬ç±»å‹æ˜¯ä¼šåŒºåˆ†æŒ‰ç…§å–å€¼èŒƒå›´æ¥åŒºåˆ†å¤§å°çš„ï¼Œæˆ‘ä»¬å†æ¬¡æŠŠå®ƒä»¬çš„å¤§å°ç­‰çº§è´´å‡ºæ¥ï¼š æˆ‘ä»¬è¿˜çŸ¥é“äº†å°ç±»å‹ä¸å¯ä»¥æ¥æ”¶å¤§ç±»å‹çš„æ•°æ®ï¼Œå¦‚å¿…é¡»è¦æ¥æ”¶ï¼Œéœ€è¦åšå¼ºè½¬ï¼Œè€Œå¦‚æœä½¿ç”¨ä¸€ä¸ªå¤§ç±»å‹æ¥ä¸€ä¸ªå°ç±»å‹çš„å€¼ï¼Œåˆ™è¿™ä¸ªå°ç±»å‹çš„å€¼ä¼šè‡ªåŠ¨è½¬æ¢æˆå¯¹åº”çš„å¤§ç±»å‹ï¼Œè¿™ç§ç±»å‹çš„è½¬æ¢å«ç±»å‹è‡ªåŠ¨è½¬æ¢ï¼Œè´´ä¸€ä¸‹å½“æ—¶çš„ä¾‹å­ã€‚ ä¾‹1ï¼šä»£ç å—2112int Î± = 1; //å£°æ˜intå‹çš„å˜é‡Î±ï¼Œå€¼ä¸º1long Î² = Î±; //å£°æ˜longå‹çš„å˜é‡Î²ï¼Œä½¿å…¶å€¼ç­‰äºÎ±çš„å€¼ï¼Œç”±äºlongå‹è¡¨ç¤ºèŒƒå›´æ¯”intå‹å¤§ï¼Œå› æ­¤Î±çš„å€¼ä¸éœ€è¦åšç±»å‹å¼ºè½¬ï¼Œä½†å…¶å®æ˜¯Î±çš„å€¼ç±»å‹å·²ç»è‡ªåŠ¨è½¬æˆlongäº† ç°åœ¨ç»“åˆæœ¬èŠ‚çš„è¿ç®—ç¬¦çŸ¥è¯†å†æ¥çœ‹ä¸‹è¿™ä¸ªç±»å‹è‡ªåŠ¨è½¬æ¢æ˜¯å¦‚ä½•å‘ç”Ÿçš„ï¼š é¦–å…ˆå£°æ˜çš„Î±æ˜¯ä¸€ä¸ªintå‹ï¼Œç„¶åä½¿ç”¨å¤§ç±»å‹çš„Î²æ¥æ”¶ï¼Œæ­¤æ—¶Î±çš„å€¼ï¼ˆä¹Ÿå°±æ˜¯1ï¼‰å·²ç»è‡ªåŠ¨è½¬æˆäº†longå‹ï¼Œè¿™å°±æ˜¯è¿ç®—ç¬¦å¯¼è‡´äº†ç±»å‹çš„è½¬æ¢ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œ=å°±æ˜¯è¿™ä¸ªè¿ç®—ç¬¦ï¼ˆèµ‹å€¼è¿ç®—ç¬¦ï¼‰ï¼Œå› ä¸ºÎ±çš„å€¼è¢«èµ‹ç»™äº†Î²ï¼Œå› æ­¤Î±å€¼çš„ç±»å‹è‡ªåŠ¨æå‡ä¸ºlongã€‚ ç»“è®ºï¼šè¿ç®—ç¬¦å¯ä»¥å¯¼è‡´æŸäº›æ•°æ®å˜é‡å€¼çš„ç±»å‹è½¬æ¢ã€‚ ä¾‹2ï¼šä»£ç å—22123int a = 1;float b = 1;int s = a + b; //è¿™æ˜¯ä¸å…è®¸çš„ï¼Œç»è¿‡åŠ æ³•è¿ç®—ï¼Œaçš„å€¼å·²ç»è¢«è‡ªåŠ¨æå‡ä¸ºfloatå‹ï¼Œå› æ­¤a+bçš„å€¼æ˜¯ä¸€ä¸ªfloatå‹ï¼Œè¾ƒå°çš„intæ˜¯ä¸èƒ½æ¥æ”¶è¾ƒå¤§çš„floatå‹çš„ ä¸Šè¿°æ³¨é‡Šå†…çš„å†…å®¹ç”¨ä¸‹å›¾æ¥æè¿°ï¼š å…¶å®æœ€ç»ˆéƒ½è¦å›å½’åˆ°å¼ºåˆ¶ç±»å‹è½¬æ¢é‚£ä¸€éƒ¨åˆ†å†…å®¹æ¥ã€‚ ç°åœ¨æ”¹ä¸€ä¸‹ä»£ç ï¼Œè§£å†³ä¸Šè¿°é—®é¢˜ï¼š ä»£ç å—23123456int a = 1;float b = 1; float s = a + b; //è¿™ç§æ”¹æ³•å°±æ˜¯ç›´æ¥ç”¨å¤§ç±»å‹æ¥æ”¶æˆ–ï¼šint s = a + (int)b; //è¿™ç§æ”¹æ³•å°±æ˜¯å°†å¤§ç±»å‹å¼ºè½¬æˆå°ç±»å‹ï¼Œè¿™æ ·å®ƒä»¬ç»è¿‡åŠ æ³•è¿ç®—åç±»å‹ä¸ä¼šæå‡ï¼Œè¿˜æ˜¯int å‚è€ƒæ³¨é‡Šï¼Œæœ€ç»ˆè¿˜æ˜¯å›å½’åˆ°è¦ä¹ˆç”¨å¤§ç±»å‹æ¥æ”¶å°ç±»å‹ï¼Œè¦ä¹ˆå¼ºè½¬çš„è§£å†³æ–¹æ³•ä¸Šæ¥ï¼Œé’ˆå¯¹ä¾‹1ï¼Œæˆ‘ä»¬å¯ä»¥è¯´æ˜¯â€œ=â€è¿ç®—ç¬¦è®©å˜é‡Î±çš„å€¼ç±»å‹æå‡ï¼Œè€Œåœ¨æœ¬ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥è¯´æ˜¯â€œ+â€è¿ç®—ç¬¦è®©açš„å€¼ç±»å‹å¾—åˆ°æå‡ã€‚ ä¸ºäº†å·©å›ºè¿™å—çš„çŸ¥è¯†ï¼Œå†è®©æˆ‘ä»¬æ”¹é€ ä¸‹ä¸Šé¢çš„ä»£ç ï¼š ä»£ç å—24123456int a = 5;int b = 2; float s = a / b; System.out.println(s); è¿™ä¸ªç»“æœæ˜¯2.5å—ï¼Ÿç­”æ¡ˆå¹¶ä¸æ˜¯ï¼Œæœ€ç»ˆç»“æœæ˜¯2. ä¸ºä»€ä¹ˆï¼Ÿï¼Ÿæ˜æ˜5/2æ˜¯2.5å•Šï¼Œè¿™é‡Œç»“åˆå‰é¢çš„ä¾‹å­ï¼Œä½ åªéœ€è¦ç¨å¾®æ€è€ƒä¸€ä¸‹å°±å¯ä»¥å¾—åˆ°ç­”æ¡ˆï¼š â“ æ€è€ƒï¼šé‚£å¦‚ä½•æ‰èƒ½å¾—åˆ°è‡ªå·±æƒ³è¦çš„2.5å‘¢ï¼Ÿ ç­”æ¡ˆï¼šå¾ˆç®€å•ï¼Œåªéœ€è¦æå‡a+bçš„ç±»å‹å°±è¡Œäº†ï¼Œå³ï¼š(float)a+b æˆ– a+(float)bï¼Œå½“ç„¶ï¼Œä¸¤ä¸ªéƒ½å¼ºè½¬ä¹Ÿè¡Œï¼š(float)a+(float)bï¼Œè¿™æ ·åœ¨ä¸Šå›¾â‘ å¤„åœ¨é™¤æ³•è¿ç®—æ—¶å°±ä¼šå°†a/bçš„ç»“æœæå‡ä¸ºfloatï¼Œè‡ªç„¶å°±ä¸ä¼šå¤±ç²¾ã€‚","link":"/2020/02/28/LV1-3%EF%BC%9Ajava%E4%B8%AD%E7%9A%84%E8%BF%90%E7%AE%97%E7%AC%A6/"},{"title":"LV1-2ï¼šjavaä¸­çš„å˜é‡ç±»å‹","text":"ä¸€ã€åŸºç¡€å˜é‡ç±»å‹1.1ï¼šæ•´å‹å³æ•´æ•°ç±»å‹ï¼Œå¦‚1ï¼Œ2ï¼Œ0ï¼Œ-1ï¼Œ-2è¿™ç§ã€‚ æ•´å‹å˜é‡åœ¨javaä¸­çš„å£°æ˜æ–¹å¼å¦‚ä¸‹ï¼š ä»£ç å—112int a; //å£°æ˜åç§°ä¸ºaçš„æ•´å‹å˜é‡ï¼ˆé»˜è®¤å€¼ä¸º0ï¼‰int b = 5; //å£°æ˜åç§°ä¸ºbçš„æ•´å‹å˜é‡ï¼ˆåˆå§‹åŒ–å€¼ä¸º5ï¼‰ æ•´å‹å˜é‡åœ¨å†…å­˜ä¸­å æ®32ä¸ªbitä½ï¼ˆ4å­—èŠ‚ï¼‰ï¼Œæ¯ä¸ªbitä½å¯å­˜å‚¨0å’Œ1ï¼Œé€šå¸¸ç¬¬ä¸€ä½ä¸ºç¬¦å·ä½ï¼ˆÂ±ï¼‰ï¼Œæ‰€ä»¥æœ‰æ•ˆæ•°å­—éƒ¨åˆ†å°±å äº†31ä½ï¼Œå¦‚å›¾ï¼ˆå›¾ä¸­è¡¨ç¤ºåè¿›åˆ¶æ•°å­—+6ï¼‰ï¼š æŒ‰ç…§è¿™ä¸ªç‰¹æ€§ï¼Œæ•´å‹çš„å–å€¼èŒƒå›´ä¸ºï¼š (-2^31) ~ (2^31)-1 å³ï¼š-2147483648 ~ 2147483647 é™¤äº†æµ®ç‚¹å‹ï¼Œå…¶ä½™åªè¦æœ‰ç¬¦å·ä½çš„ç±»å‹ï¼Œéƒ½ç¬¦åˆè¿™ä¸ªèŒƒå›´è§„åˆ™ã€‚ ä¸ºä»€ä¹ˆè´Ÿæ•°çš„æ•°å€¼ä½æ¯”æ­£æ•°å¤š1ï¼Œè®¡ç®—æœºæ˜¯å¦‚ä½•åšå‡æ³•è¿ç®—çš„ï¼Ÿè¯·å‚è€ƒï¼šJAVAæœ‰å…³ä½è¿ç®—çš„å…¨å¥—æ¢³ç† 1.2ï¼šé•¿æ•´å‹é•¿æ•´å‹å˜é‡åœ¨javaä¸­çš„å£°æ˜æ–¹å¼å¦‚ä¸‹ï¼š ä»£ç å—212long a; //å£°æ˜åç§°ä¸ºaçš„é•¿æ•´å‹å˜é‡ï¼ˆé»˜è®¤å€¼ä¸º0ï¼‰long b = 5; //å£°æ˜åç§°ä¸ºbçš„é•¿æ•´å‹å˜é‡ï¼ˆåˆå§‹åŒ–å€¼ä¸º5ï¼‰ è¿™ç§ç±»å‹æ‰€è¡¨ç¤ºçš„æ•°å€¼èŒƒå›´ç›¸æ¯”æ•´å‹çš„ä½æ•°ï¼Œå¤šäº†ä¸€å€ï¼Œå æ®64ä¸ªbitä½ï¼ˆ8å­—èŠ‚ï¼‰ï¼Œå› æ­¤å…¶å–å€¼èŒƒå›´ä¸ºï¼š (-2^64) ~ (2^64)-1 å³ï¼š-9223372036854775808 ~ 9223372036854775807 1.3ï¼šçŸ­æ•´å‹çŸ­æ•´å‹å˜é‡åœ¨javaä¸­çš„å£°æ˜æ–¹å¼å¦‚ä¸‹ï¼š ä»£ç å—312short a; //å£°æ˜åç§°ä¸ºaçš„é•¿æ•´å‹å˜é‡ï¼ˆé»˜è®¤å€¼ä¸º0ï¼‰short b = 5; //å£°æ˜åç§°ä¸ºbçš„é•¿æ•´å‹å˜é‡ï¼ˆåˆå§‹åŒ–å€¼ä¸º5ï¼‰ è¿™ç§ç±»å‹æ‰€è¡¨ç¤ºçš„æ•°å€¼èŒƒå›´ç›¸æ¯”æ•´å‹çš„ä½æ•°ï¼Œå°‘äº†ä¸€å€ï¼Œåªå æ®16ä¸ªbitä½ï¼ˆ2å­—èŠ‚ï¼‰ï¼Œå–å€¼èŒƒå›´ä¸ºï¼š (-2^15) ~ (2^15)-1 å³ï¼š-32768 ~ 32767 å·©å›ºï¼š è¿™é‡Œè¯´æ˜ä¸‹ï¼Œshortã€intã€longæœ¬è´¨ä¸Šéƒ½è¡¨ç¤ºæ•´æ•°ï¼Œå› æ­¤åƒä¸‹é¢è¿™ç§å†™æ³•éƒ½æ˜¯okçš„ï¼š short a = 1; int a = 1; long a = 1; é‚£ä¸ºä»€ä¹ˆè¦å¦‚æ­¤åŒºåˆ†å‘¢ï¼Ÿè¿™å°±å­˜åœ¨ä¸€ä¸ªå–å€¼èŒƒå›´çš„é—®é¢˜ï¼Œå› ä¸ºè¿™ä¸‰ç§ç±»å‹çš„äºŒè¿›åˆ¶ä½æ•°ä¸ä¸€æ ·ï¼Œæ‰€ä»¥ä»–ä»¬æ‰€èƒ½å®¹ä¸‹çš„æ•°å€¼èŒƒå›´ä¹Ÿä¸åŒï¼Œå…·ä½“å‚è€ƒä¸‹å›¾ï¼š æ‰€ä»¥ä»Šååœ¨å†™ç¨‹åºæ—¶ï¼Œéœ€è¦ä¸¥æ ¼æ¨æ–­æ•°å€¼çš„æç«¯å¯èƒ½æ€§ï¼Œç„¶åè®¾è®¡å‡ºåˆç†æ¥æ”¶æ•°æ®çš„ç±»å‹ã€‚ ä¸¾ä¸ªåä¾‹ï¼šæ¯”å¦‚æŸä¸ªç³»ç»Ÿçš„idï¼Œidå¢é•¿ç‰¹åˆ«è¿…é€Ÿï¼Œå¼€å§‹è®¾è®¡ç”¨intç±»å‹æ¥æ”¶idï¼Œåæ¥idå€¼è¶…è¿‡äº†intè¡¨ç¤ºæ•°æ®çš„æœ€å¤§èŒƒå›´ï¼Œå°±ä¼šå‡ºç°å¾ˆä¸¥é‡çš„é—®é¢˜ã€‚ 1.4ï¼šå•ç²¾åº¦æµ®ç‚¹å‹æµ®ç‚¹å‹å˜é‡åœ¨javaä¸­çš„å£°æ˜æ–¹å¼å¦‚ä¸‹ï¼š ä»£ç å—412float a; //å£°æ˜åç§°ä¸ºaçš„å•ç²¾åº¦æµ®ç‚¹å‹å˜é‡ï¼ˆé»˜è®¤å€¼ä¸º0.0ï¼‰float b = 5.0f; //å£°æ˜åç§°ä¸ºbçš„å•ç²¾åº¦æµ®ç‚¹å‹å˜é‡ï¼ˆåˆå§‹åŒ–å€¼ä¸º5.0ï¼‰ å•ç²¾åº¦æµ®ç‚¹å‹å˜é‡åœ¨å†…å­˜ä¸­å æ®32ä¸ªbitä½ï¼ˆ4å­—èŠ‚ï¼‰ï¼Œç›¸æ¯”æ•´å‹ï¼Œå®ƒå­˜åœ¨æŒ‡æ•°ä½ï¼Œåˆ†å¸ƒå¦‚ä¸‹ï¼š å–å€¼èŒƒå›´ä¸ºï¼š-2^128 ~ 2^127 å³ï¼š-3.40E+38 ~ +3.40E+38 æ³¨ï¼šjavaä¸­å¦‚æœå•ç‹¬å†™ä¸€ä¸ªç±»ä¼¼0.1è¿™æ ·çš„å°æ•°ï¼Œé»˜è®¤æ˜¯åŒç²¾åº¦ï¼Œå¦‚æœç”¨floatæ¥æ”¶ï¼Œä¼šæŠ¥é”™ï¼Œä¸€èˆ¬éœ€è¦åœ¨å°æ•°åé¢åŠ ä¸ªfä¿®é¥°ç¬¦ï¼ˆéšå¼ç±»å‹è½¬æ¢ï¼‰ã€‚ 1.5ï¼šåŒç²¾åº¦æµ®ç‚¹å‹åŒç²¾åº¦å˜é‡åœ¨javaä¸­çš„å£°æ˜æ–¹å¼å¦‚ä¸‹ï¼š ä»£ç å—512float a; //å£°æ˜åç§°ä¸ºaçš„æµ®ç‚¹å‹å˜é‡ï¼ˆé»˜è®¤å€¼ä¸º0.0ï¼‰float b = 5.0; //å£°æ˜åç§°ä¸ºbçš„æµ®ç‚¹å‹å˜é‡ï¼ˆåˆå§‹åŒ–å€¼ä¸º5.0ï¼‰ åŒç²¾åº¦æµ®ç‚¹å‹å˜é‡åœ¨å†…å­˜ä¸­å æ®64ä¸ªbitä½ï¼ˆ8å­—èŠ‚ï¼‰ï¼Œç›¸æ¯”å•ç²¾åº¦æµ®ç‚¹å‹æ•°æ®ï¼Œå®ƒç”¨æ¥å­˜æ”¾æŒ‡æ•°å’Œå°¾æ•°çš„ä½æ•°æ˜æ˜¾æ›´å¤šï¼Œåˆ†å¸ƒå¦‚ä¸‹ï¼š 1.6ï¼šå­—ç¬¦å‹å­—ç¬¦å˜é‡åœ¨javaä¸­çš„å£°æ˜æ–¹å¼å¦‚ä¸‹ï¼š ä»£ç å—612char a; //å£°æ˜åç§°ä¸ºaçš„å­—ç¬¦å‹å˜é‡ï¼ˆé»˜è®¤å€¼ä¸º0ï¼Œå¯¹åº”çš„å­—ç¬¦ä¸ºç©ºå­—ç¬¦ï¼ŒBLANKï¼‰char b = 'æˆ‘'; //å£°æ˜åç§°ä¸ºbçš„å­—ç¬¦å‹å˜é‡ï¼ˆåˆå§‹åŒ–å€¼ä¸ºæ±‰å­—'æˆ‘'ï¼Œå¯¹åº”çš„Unicodeç ä¸º25105ï¼‰ å­—ç¬¦å‹å˜é‡åœ¨å†…å­˜ä¸­å æ®16ä¸ªbitä½ï¼ˆ2å­—èŠ‚ï¼‰ï¼Œjavaè¯­è¨€çš„å­—ç¬¦åŸºäºUnicodeï¼Œæ— è®ºæ˜¯æ•°å­—ã€å­—æ¯ï¼Œè¿˜æ˜¯æ±‰å­—ï¼Œå‡å 2ä¸ªå­—èŠ‚ã€‚ æŒ‰ç…§16ä½çš„ä¿å­˜æ–¹å¼ï¼Œcharçš„æ•°å­—å–å€¼åŒºé—´ä¸ºï¼š0 ~ 65535 1.7ï¼šå­—èŠ‚å­—èŠ‚å˜é‡åœ¨javaä¸­çš„å£°æ˜æ–¹å¼å¦‚ä¸‹ï¼š ä»£ç å—712byte a; //å£°æ˜åç§°ä¸ºaçš„å­—èŠ‚å˜é‡ï¼ˆé»˜è®¤å€¼ä¸º0ï¼‰byte b = 5; //å£°æ˜åç§°ä¸ºbçš„å­—ç¬¦å‹å˜é‡ï¼ˆåˆå§‹åŒ–å€¼ä¸º5ï¼‰ å­—èŠ‚å˜é‡åœ¨å†…å­˜ä¸­å æ®8ä¸ªbitä½ å–å€¼åŒºé—´ä¸ºï¼š(-2^7) ~ (2^7)-1 å³ï¼š-128~127 ä¸€ä¸ªå­—èŠ‚å°±æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå­—èŠ‚å­˜å‚¨çš„æ•°å­—èšåˆåœ¨ä¸€èµ·å°±å˜æˆäº†å­—èŠ‚æµï¼ˆbyte[]ï¼‰å­—èŠ‚æµå¯ä»¥è¢«ä¸åŒçš„ç¼–ç æ–¹å¼è§£ç æˆå…·ä½“æŸä¸€ä¸ªå­—ç¬¦æˆ–è€…æŸä¸€æ®µè¯­å¥ï¼Œç°æœ‰çš„æ–‡æœ¬ä¿¡æ¯ï¼Œåœ¨è®¡ç®—æœºä¸­ä»¥å­—èŠ‚çš„æ–¹å¼è¿›è¡Œå­˜å‚¨ï¼Œå­˜å‚¨å‰é€šè¿‡æŸç§ç¼–ç æ–¹å¼ç¼–ç ï¼Œè·å–åˆ°æ—¶é€šè¿‡åŒæ ·çš„ç¼–ç æ–¹å¼è§£ç å³å¯è·å–åˆ°å…·ä½“çš„æ–‡æœ¬ä¿¡æ¯ã€‚ 1.8ï¼šå¸ƒå°”å€¼å¸ƒå°”ç±»å‹çš„å˜é‡åœ¨javaä¸­çš„å£°æ˜æ–¹å¼å¦‚ä¸‹ï¼š ä»£ç å—812boolean a; //å£°æ˜åç§°ä¸ºaçš„å¸ƒå°”å˜é‡ï¼ˆæ— åˆå§‹åŒ–å€¼æ—¶ï¼Œé»˜è®¤å€¼ä¸ºfalseï¼‰boolean b = true; //å£°æ˜åç§°ä¸ºbçš„å¸ƒå°”å˜é‡ï¼ˆåˆå§‹åŒ–å€¼ä¸ºtrueï¼‰ è¿™ç§ç±»å‹çš„å˜é‡åªæœ‰trueæˆ–falseä¸¤ç§å€¼ï¼Œç”¨æ¥è¡¨ç¤ºçœŸæˆ–å‡ã€‚ å¸ƒå°”å˜é‡åœ¨å†…å­˜ä¸­å æ®8ä¸ªbitä½ï¼ˆ1ä¸ªå­—èŠ‚ï¼Œå­˜åœ¨äº‰è®®ï¼ŒJVMè§„èŒƒä¸­æåˆ°åº”å 4ä¸ªå­—èŠ‚ï¼‰ã€‚ äºŒã€å­—ç¬¦ä¸²ç±»å‹&amp;å¼•ç”¨å˜é‡ä¸Šé¢æ‰€æœ‰çš„ç±»å‹ï¼Œå‡ä¸ºjavaçš„åŸºæœ¬ç±»å‹ï¼Œé™¤äº†åŸºæœ¬ç±»å‹å˜é‡ï¼Œå…¶ä»–çš„æ‰€æœ‰å˜é‡å‡ä¸ºå¼•ç”¨å˜é‡ï¼Œè¿™é‡Œä»‹ç»ä¸€ç§å¼•ç”¨å˜é‡ï¼šString Stringç›¸æ¯”charåªèƒ½è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦æ¥è¯´ï¼Œå®ƒå¯ä»¥ç”¨æ¥è¡¨è¾¾ä¸€æ®µè¯ï¼Œå®ƒçš„å£°æ˜æ–¹å¼å¦‚ä¸‹ï¼š ä»£ç å—9123String a; //å£°æ˜åç§°ä¸ºaçš„Stringç±»å‹å˜é‡ï¼ˆç”±äºå…¶éåŸºæœ¬ç±»å‹ï¼Œå› æ­¤aå±äºå¼•ç”¨å˜é‡ï¼Œå¼•ç”¨ç±»å‹å˜é‡åœ¨ä¸èµ‹å€¼çš„æƒ…å†µä¸‹é»˜è®¤å€¼ä¸ºnullï¼‰String b = \"è¿™æ˜¯ä¸€æ®µè¯\"; //å£°æ˜åç§°ä¸ºbçš„Stringç±»å‹å˜é‡ï¼ˆåˆå§‹å€¼ä¸ºï¼šè¿™æ˜¯ä¸€æ®µè¯ï¼‰ï¼Œå¸¸ç”¨çš„å£°æ˜å­—ç¬¦ä¸²çš„æ–¹å¼String c = new String(\"è¿™æ˜¯ä¸€æ®µè¯\"); //å£°æ˜åç§°ä¸ºcçš„Stringç±»å‹å˜é‡ï¼ˆåˆå§‹å€¼ä¸ºï¼šè¿™æ˜¯ä¸€æ®µè¯ï¼‰è¿™ç§å†™æ³•ä¸å»ºè®® å­—ç¬¦ä¸²çš„æ‹¼æ¥ä¹Ÿå¾ˆç®€å•ï¼š ä»£ç å—10123String a = \"å“”å“©å“”å“© \";String b = \"ä¹¾æ¯~\";String c = a + b; //cæœ€ç»ˆçš„ç»“æœä¸ºï¼šå“”å“©å“”å“© ä¹¾æ¯~ ä¸‰ã€åŸºæœ¬ç±»å‹è½¬æ¢æˆ‘ä»¬æŒ‰ç…§åŸºæœ¬ç±»å‹æ‰€èƒ½è¡¨ç¤ºçš„æ•°å€¼èŒƒå›´æ¥åŒºåˆ†å®ƒä»¬çš„å¤§å°ï¼Œç°å¯ä»¥åšå‡ºå¦‚ä¸‹æ’åºï¼š æ‰€è°“ç±»å‹è½¬æ¢ï¼Œå°±æ˜¯javaè¯­æ³•é‡Œä¸ºäº†ç¨‹åºä¸¥è°¨æ€§æ‰€åšçš„ä¸€å±‚ä¿æŠ¤ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªæ¯”è¾ƒå¤§çš„ç±»å‹longï¼Œå£°æ˜äº†ä¸€ä¸ªå˜é‡ï¼Œæˆ‘ä»¬è®°ä¸ºÎ±ï¼Œç°åœ¨ç”¨ä¸€ä¸ªæ¯”è¾ƒå°çš„ç±»å‹intæ¥æ¥æ”¶Î±ï¼Œè¿™åœ¨javaçš„è¯­æ³•é‡Œæ˜¯ä¸å…è®¸çš„ï¼Œå› ä¸ºä½ ä¸çŸ¥é“Î±çš„å¤§å°æ˜¯ä¸æ˜¯å·²ç»è¶…å‡ºintå‹æ‰€èƒ½è¡¨è¾¾çš„èŒƒå›´å€¼äº†ï¼Œä½†æ˜¯ç›¸åçš„ï¼Œå¦‚æœç°åœ¨å£°æ˜ä¸€ä¸ªintå‹çš„å˜é‡ï¼Œæˆ‘ä»¬è®°ä¸ºÎ²ï¼Œè¿™æ—¶ä½¿ç”¨longå‹æ¥æ”¶Î²åœ¨javaçš„è¯­æ³•é‡Œæ˜¯å…è®¸çš„ï¼Œå› ä¸ºintå‹çš„æ•°é¡¶å¤©äº†ä¹Ÿä¸å¯èƒ½è¶…è¿‡longå‹æ‰€èƒ½è¡¨è¾¾çš„èŒƒå›´ï¼Œæ‰€è°“åŸºæœ¬ç±»å‹çš„è½¬æ¢å°±æ˜¯è¿™ä¹ˆå›äº‹ï¼Œä¸‹é¢æ¥çœ‹çœ‹å…·ä½“çš„åœºæ™¯ã€‚ æ³¨ï¼šå¸ƒå°”ç±»å‹æ˜¯ä¸å‚ä¸ç±»å‹è½¬æ¢çš„ 4.1ï¼šå¼ºåˆ¶è½¬æ¢é€šè¿‡ä¸Šé¢ç®€çŸ­çš„ä»‹ç»ï¼Œå·²ç»çŸ¥é“äº†javaä¸ºä»€ä¹ˆè¦åšä¸€äº›ç±»å‹è½¬æ¢çš„æ“ä½œï¼Œé‚£ä¹ˆå“ªäº›æƒ…å†µä¸‹éœ€è¦åšå¼ºåˆ¶ç±»å‹è½¬æ¢å‘¢ï¼Ÿ æŒ‰ç…§ç±»å‹å¤§å°æ’åˆ—ï¼Œlongå‹å¯ä»¥æ¥æ”¶intå‹æ•°æ®ï¼Œè€Œintå‹è¦æƒ³æ¥æ”¶longå‹æ•°æ®ï¼Œå°±éœ€è¦åšå¼ºè½¬ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š ä»£ç å—1012345long Î³ = 1; //å£°æ˜longå‹çš„å˜é‡Î³int Î» = (int) Î³; //å£°æ˜intå‹çš„å˜é‡Î»ï¼Œç”±äºintå‹è¡¨ç¤ºèŒƒå›´æ¯”longå‹å°ï¼Œå› æ­¤æœ‰è¶…èŒƒå›´çš„é£é™©ï¼Œå› æ­¤javaè¦æ±‚å¿…é¡»åšä¸€å±‚å¼ºè½¬ int Î± = 1; //å£°æ˜intå‹çš„å˜é‡Î±long Î² = Î±; //å£°æ˜longå‹çš„å˜é‡Î²ï¼Œä½¿å…¶å€¼ç­‰äºÎ±ï¼Œç”±äºlongå‹è¡¨ç¤ºèŒƒå›´æ¯”intå‹å¤§ï¼Œå› æ­¤Î±ä¸éœ€è¦åšç±»å‹å¼ºè½¬ æ¯”è¾ƒç‰¹æ®Šçš„å°±æ˜¯shortå’Œcharå‹å˜é‡ï¼Œå®ƒä»¬ä¿©ç”±äºä½æ•°ç›¸åŒï¼Œè™½ç„¶è¡¨è¾¾çš„å–å€¼èŒƒå›´ä¸åŒï¼Œä½†æ˜¯å…¶ç±»å‹å¤§å°åœ¨javaçœ¼é‡Œæ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥å®ƒä»¬ä¿©éœ€è¦äº’è½¬ï¼Œä¸å­˜åœ¨è°æ¯”è°å¤§çš„æƒ…å†µï¼š ä»£ç å—11123456//shortå’Œcharä¸ç®¡ç”±è°æ¥æ”¶è°ï¼Œå‡éœ€è¦å¼ºè½¬short Î³ = 1;char Î» = (char) Î³; char Î± = 1;short Î² = (short) Î±; è¿™ä¸ªè§„åˆ™æ”¾åˆ°æ–¹æ³•ä¼ å‚æ—¶åŒæ ·æ˜¯é€‚ç”¨çš„ï¼š ä»£ç å—121234567891011public static void main(String[] args) { short param1 = 1; method(param1); //methodæ¥æ”¶çš„å‚æ•°æ˜¯intå‹ï¼Œå£°æ˜çš„å‚æ•°å€¼å´æ˜¯shortå‹ï¼Œshortæ¯”intè¡¨è¾¾èŒƒå›´å°ï¼Œå› æ­¤è°ƒç”¨methodæ—¶ï¼Œä¸éœ€è¦å¼ºè½¬ long param2 = 1; method((int) param2); //methodæ¥æ”¶çš„å‚æ•°æ˜¯intå‹ï¼Œå£°æ˜çš„å‚æ•°å€¼å´æ˜¯longå‹ï¼Œè°ƒç”¨methodæ—¶ï¼Œéœ€è¦å¼ºè½¬}//è¿™æ˜¯ä¸€ä¸ªæ¥æ”¶intå‹å‚æ•°çš„æ–¹æ³•public static void method(int param) { //æ–¹æ³•é€»è¾‘çœç•¥...} 4.2ï¼šè‡ªåŠ¨è½¬æ¢è‡ªåŠ¨è½¬æ¢å°±æ˜¯æŒ‡å–å€¼èŒƒå›´å°çš„æ•°æ®ç±»å‹å¯ä»¥è‡ªåŠ¨è½¬æ¢æˆå–å€¼èŒƒå›´å¤§çš„æ•°æ®ç±»å‹ã€‚ éœ€è¦ç»“åˆ4.1ç†è§£ï¼Œ4.1ä»‹ç»äº†å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä¾‹å­ä¸­ä¸éœ€è¦å¼ºè½¬çš„ç»Ÿç»Ÿéƒ½æ˜¯è‡ªåŠ¨è½¬æ¢çš„ï¼Œå¦‚ä»£ç å—10ä¸­çš„Î±å’ŒÎ²çš„ç±»å‹è½¬æ¢ï¼š ä»£ç å—1312int Î± = 1; //å£°æ˜intå‹çš„å˜é‡Î±ï¼Œå€¼ä¸º1long Î² = Î±; //å£°æ˜longå‹çš„å˜é‡Î²ï¼Œä½¿å…¶å€¼ç­‰äºÎ±çš„å€¼ï¼Œç”±äºlongå‹è¡¨ç¤ºèŒƒå›´æ¯”intå‹å¤§ï¼Œå› æ­¤Î±çš„å€¼ä¸éœ€è¦åšç±»å‹å¼ºè½¬ï¼Œä½†å…¶å®æ˜¯Î±çš„å€¼ç±»å‹å·²ç»è‡ªåŠ¨è½¬æˆlongäº† å››ã€å°ç»“é€šè¿‡æœ¬èŠ‚ï¼Œæˆ‘ä»¬çŸ¥é“äº†javaé‡Œçš„åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼Œä»¥åŠå¼•ç”¨å˜é‡çš„ç®€å•ä»‹ç»ã€‚ ä¸‹ä¸€èŠ‚å°†ä¼šä»‹ç»javaä¸­çš„è¿ç®—ç¬¦ï¼Œè®©æœ¬èŠ‚é‡Œçš„æ•°æ®é€šè¿‡è¿ç®—â€æ´»èµ·æ¥â€œã€‚","link":"/2020/02/26/LV1-2%EF%BC%9Ajava%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F%E7%B1%BB%E5%9E%8B/"},{"title":"LV1-1ï¼šå®‰è£…javaç¯å¢ƒ&ç¬¬ä¸€ä¸ªjavaç¨‹åº","text":"ä¸€ã€javaç¯å¢ƒç»„æˆ JREï¼šjavaè¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒ…å«äº†javaè™šæ‹Ÿæœºï¼ŒjavaåŸºç¡€ç±»åº“ã€‚æ˜¯ä½¿ç”¨javaè¯­è¨€ç¼–å†™çš„ç¨‹åºè¿è¡Œæ‰€éœ€è¦çš„è½¯ä»¶ç¯å¢ƒï¼Œç®€å•æ¥è¯´ï¼Œå¦‚æœä½ åªæ˜¯æƒ³è¿è¡Œä½ çš„javaç¨‹åºï¼Œåªå®‰è£…JREå°±è¡Œäº†ã€‚ JDKï¼šjavaå¼€å‘å·¥å…·åŒ…ï¼Œæä¾›äº†å…¨å¥—JREã€ç¼–è¯‘å™¨ã€ä¸€äº›å¼€å‘å·¥å…·åŒ…ï¼Œå¦‚æœä½ æƒ³è¦å¼€å‘javaç¨‹åºï¼Œéœ€è¦å®‰è£…ä¸€ä¸ªJDKã€‚ äºŒã€javaç¯å¢ƒå®‰è£…ä¸Šç½‘æŸ¥ï¼Œå¤ªå¤šäº† æš‚æ—¶è¿™ä¸ªå§~https://www.jianshu.com/p/efef80171a4a ä¸‰ã€ç¬¬ä¸€ä¸ªjavaç¨‹åºjavaç¨‹åºçš„å…¥å£ï¼Œéƒ½æ˜¯ä»mainæ–¹æ³•å¼€å§‹çš„ï¼Œæ‰€ä»¥åœ¨åˆæœŸåšå®éªŒçš„æ—¶å€™ï¼Œè‡³å°‘è¦å®šä¹‰ä¸€ä¸ªpublicç±»ï¼Œé‡Œé¢æ”¾å…¥ä¸€ä¸ªmainæ–¹æ³•ï¼ˆä¸ç†è§£å•¥æ˜¯ç±»ï¼Ÿå•¥æ˜¯æ–¹æ³•ï¼Ÿä¸è¦ç´§ï¼Œå…ˆè®°ä½ä¸‹é¢çš„å†™æ³•å³å¯ï¼Œåæ­£åé¢éƒ½ä¼šä»‹ç»åˆ°ï¼‰ï¼š å›¾é‡Œå¯èƒ½è¦ç´ è¿‡å¤šï¼Œç›®å‰äº†è§£å³å¯ï¼Œç­‰å­¦å®Œç±»å’Œæ–¹æ³•éƒ¨åˆ†çš„å†…å®¹ï¼Œå†ç¿»è¿‡æ¥çœ‹è¿™ä¸ªå›¾ï¼Œå°±ä¼šå¾ˆå®¹æ˜“ç†è§£äº†ã€‚ ç»è¿‡ç¬¬äºŒæ­¥ï¼Œå‡è®¾æˆ‘ä»¬å·²ç»å®‰è£…å¥½äº†javaç¯å¢ƒï¼Œå¹¶ä¸”é…ç½®å¥½äº†ç¯å¢ƒå˜é‡ï¼Œç°åœ¨åœ¨ç»ˆç«¯æ‰§è¡Œä¸‹è¿™ä¸ªæŒ‡ä»¤ï¼š ä»£ç å—11java -version å°±ä¼šæ‰“å°å‡ºjavaçš„ç‰ˆæœ¬å·ä¿¡æ¯ï¼Œä¸€æ—¦æ‰“å°å‡ºç‰ˆæœ¬å·ä¿¡æ¯ï¼Œè¯´æ˜ä½ å®‰è£…çš„javaç¯å¢ƒæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼š ä»£ç å—2123java version \"11.0.2\" 2019-01-15 LTSJava(TM) SE Runtime Environment 18.9 (build 11.0.2+9-LTS)Java HotSpot(TM) 64-Bit Server VM 18.9 (build 11.0.2+9-LTS, mixed mode) ç°åœ¨æ¥å†™ä¸€ä¸ªæœ€åŸºæœ¬çš„ç¨‹åºï¼š ä»£ç å—312345public class Test{ public static void main(String[] args){ System.out.println(\"Hello world!\"); }} æ–°å»ºä¸€ä¸ªå«Test.javaçš„æ–‡ä»¶ï¼Œå°†è¿™æ®µä»£ç æ‹·è´è¿›å»ã€‚ ç„¶åç°åœ¨è¾“å…¥è¿™ä¸ªæŒ‡ä»¤ï¼Œç”¨æ¥ç¼–è¯‘ä»£ç ï¼š ä»£ç å—41javac Test.java ç„¶åä½ å°±å¾—åˆ°äº†ä¸€ä¸ªå­—èŠ‚ç æ–‡ä»¶ï¼šTest.class å­—èŠ‚ç æ–‡ä»¶æ‰å¯ä»¥è¢«javaç›´æ¥è¿è¡Œï¼Œé€šè¿‡ä¸‹é¢è¿™ä¸ªæŒ‡ä»¤ï¼ˆæ³¨ï¼š.classåç¼€æ˜¯å¯ä»¥çœç•¥ä¸å†™çš„ï¼‰ï¼š å¯ä»¥çœ‹åˆ°ï¼Œå·²ç»æˆåŠŸè¿è¡Œäº†ã€‚ é€šè¿‡æœ¬ä¾‹å­å¯ä»¥çŸ¥é“ï¼Œjavaæƒ³è¦æ‰§è¡Œä¸€ä¸ªjavaç¨‹åºï¼Œéœ€è¦å°†javaæºä»£ç æ–‡ä»¶ï¼ˆä¾‹å­ä¸­çš„Test.javaï¼‰ï¼Œé€šè¿‡javacæŒ‡ä»¤ç¼–è¯‘æˆå­—èŠ‚ç æ–‡ä»¶ï¼ˆä¾‹å­ä¸­çš„Test.classï¼‰ï¼Œç„¶åé€šè¿‡javaæŒ‡ä»¤è¿è¡Œå¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶å³å¯ã€‚","link":"/2020/02/25/LV1-1%EF%BC%9A%E5%AE%89%E8%A3%85java%E7%8E%AF%E5%A2%83&%E7%AC%AC%E4%B8%80%E4%B8%AAjava%E7%A8%8B%E5%BA%8F/"},{"title":"JAVAè¿›åŒ–è®ºï¼ˆåºï¼‰","text":"åºç«  æœ€è¿‘æœ‰ä¸€é¡¹å·¥ä½œï¼Œè®©æµ‹è¯•åŒå­¦å¯¹javaè¿™é—¨è¯­è¨€è¿›è¡Œå…¥é—¨ï¼Œå¹¶ä¸”å¯ä»¥ç‹¬ç«‹reviewå¼€å‘å†™å‡ºæ¥çš„ä»£ç ï¼Œè¿˜å¯ä»¥æœç€æµ‹è¯•å¼€å‘å·¥ç¨‹å¸ˆå»åšã€‚æƒ³ç€è‡ªå·±æ­£å¼åšjavaå¼€å‘å·²ç»å¿«4å¹´äº†ï¼Œä¸çŸ¥ä¸è§‰æ¥è§¦javaè¿™é—¨è®¡ç®—æœºè¯­è¨€ä¹Ÿå·²ç»6å¹´å¤šäº†ï¼Œæƒ³ç€ç»™åˆ«äººè®²ä¸€äº›åŸºç¡€åšä¸‹å…¥é—¨åº”è¯¥æ²¡å•¥å¤§é—®é¢˜äº†å§ï¼Œä½†å…¶å®åœ¨æ•´ç†è¿‡ç¨‹ä¸­å‘ç°ï¼Œæœ‰äº›ä¸œè¥¿æƒ³è¦æ•´ç†çš„å¾ˆé€šä¿—è¯¦ç»†è¿˜æ˜¯å¾ˆéš¾çš„ï¼Œä¸è¿‡åŸºç¡€ç¯‡çš„æ•™ç¨‹æœ€åè¿˜æ˜¯åšæŒä¸‹æ¥äº†ï¼Œè‡ªå·±æ”¶è·ä¹Ÿä¸å°‘ï¼Œå¾ˆå¤šåŸºç¡€çŸ¥è¯†åœ¨è‡ªå·±æ•´ç†çš„è¿‡ç¨‹ä¸­åˆåŠ æ·±äº†ä¸€éè®°å¿†ï¼ŒåŒæ—¶ï¼Œä½œä¸ºä¸€ç§ä¸ªäººç»å†ï¼Œæˆ‘ä¹Ÿæƒ³æŠŠè¿™äº›æ–‡æ¡£æ”¾åˆ°ä¸ªäººåšå®¢é‡Œã€‚å…³äºè¿›é˜¶ç¯‡ï¼Œæ²¡æœ‰ç»§ç»­æ›´æ–°ï¼Œå› ä¸ºæ•´ç†çš„å¤ªç»†ï¼Œè¯¾ç¨‹è€—æ—¶ä¼šå¾ˆä¹…ï¼Œå°±é‡‡ç”¨äº†å¦å¤–ä¸€ç§é€Ÿæˆçš„æ–¹å¼äº¤ç»™ä»–ä»¬è¿™äº›è¿›é˜¶çš„çŸ¥è¯†ç‚¹äº†ï¼Œæ‰€ä»¥è¯¾ç¨‹æ–‡æ¡£æœ¬èº«åˆ°åŸºç¡€ç¯‡å°±æ–­æ‰äº†ã€‚ ä¸‹é¢çš„è„‘å›¾æ˜¯å¯¹javaåŸºç¡€çŸ¥è¯†&amp;è¿›é˜¶çŸ¥è¯†çš„æ¢³ç†ï¼ˆå¯èƒ½æœ‰äº›åœ°æ–¹æ¼æ‰äº†ï¼‰","link":"/2020/02/24/JAVA%E8%BF%9B%E5%8C%96%E8%AE%BA%EF%BC%88%E5%BA%8F%EF%BC%89/"},{"title":"JVMåŸºç¡€å›é¡¾è®°å½•ï¼ˆäºŒï¼‰ï¼šåƒåœ¾æ”¶é›†","text":"ä¸Šä¸€ç¯‡ä»‹ç»äº†jvmçš„å†…å­˜æ¨¡å‹ï¼Œæœ¬ç¯‡å°†ä»‹ç»è™šæ‹Ÿæœºä¸­æœ€ä¸ºå¤æ‚çš„ä¸€éƒ¨åˆ†ï¼šåƒåœ¾æ”¶é›†ï¼Œæœ¬ç¯‡ä¼šä»åƒåœ¾å›æ”¶å‰çš„å‡†å¤‡å·¥ä½œåˆ°åé¢çš„æ”¶é›†é˜¶æ®µçš„æ–¹å¼ä»¥åŠHotSpotè™šæ‹Ÿæœºå¯¹è¿™äº›å·¥ä½œçš„å®ç°åšä¸ªè¾ƒä¸ºç³»ç»Ÿçš„è®°å½•ï¼Œæ–¹ä¾¿è‡ªå·±ä»¥åæŸ¥æ‰¾é˜…è¯»ã€‚ ä¸€ã€æ ˆå¸§ã€å˜é‡ç±»å‹ã€å¼•ç”¨åˆ†æè®²è§£åƒåœ¾æ”¶é›†å™¨çš„å®ç°ä¹‹å‰ï¼Œç»“åˆä¹‹å‰è®²çš„jvmå†…å­˜åŒºåŸŸåˆ’åˆ†ï¼Œå…ˆæ¥çœ‹ä¸‹HotSpotè™šæ‹Ÿæœºä¸­å¯¹äºå¯¹è±¡çš„è®¿é—®å®šä½æ˜¯æ€æ ·çš„ï¼Œå¯¹è±¡è®¿é—®å®šä½å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªæ–¹æ³•è§†ä¸ºä¸€ä¸ªæ ˆå¸§ï¼Œæ ˆå¸§å†…ä¼šå­˜æ”¾å½“å‰æ–¹æ³•æ‰€æœ‰çš„å˜é‡ï¼Œè¿™å°±æ˜¯æ ˆçš„æœ¬åœ°å˜é‡è¡¨ï¼Œå˜é‡åˆ†ä¸ºåŸºæœ¬ç±»å‹å˜é‡å’Œå¼•ç”¨ç±»å‹å˜é‡ï¼ŒåŸºæœ¬ç±»å‹æ˜¯ç›´æ¥åœ¨æ ˆç©ºé—´åˆ†é…å­˜å‚¨ç©ºé—´çš„ï¼ˆä¹Ÿå³æ˜¯å½“å‰æ ˆå¸§å†…ï¼Œå—-Xssä¸€å®šçš„å½±å“ï¼‰ï¼Œè€Œå¼•ç”¨ç±»å‹åˆ™æ˜¯é¢„å…ˆæ— æ³•çŸ¥æ™“å…¶å†…å­˜å ç”¨é‡ä¸ºå¤šå¤§ï¼Œå› æ­¤éœ€è¦åŠ¨æ€åˆ†é…å†…å­˜ï¼Œè¿™å°±éœ€è¦å€ŸåŠ©å †åŒºçš„å­˜å‚¨ï¼Œè¿™ç§ä¸€èˆ¬æ˜¯å †åŒºåˆ›å»ºå¯¹è±¡å®ä¾‹ï¼Œè€Œæ ˆå¸§å†…åˆ›å»ºä¸€ä¸ªå¼•ç”¨referenceï¼Œå…¶å­˜æ”¾çš„å®é™…ä¸Šæ˜¯æŒ‡å‘å †åŒºå®ä¾‹å¯¹è±¡çš„åœ°å€ï¼Œå®ä¾‹å¯¹è±¡çš„å†…éƒ¨ä¹Ÿæœ‰å¾ˆå¤šæˆå‘˜å˜é‡ï¼Œå…¶æ¬¡å®ä¾‹å¯¹è±¡ä¹Ÿä¼šæœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘æ–¹æ³•åŒºé‡Œçš„å±äºè¯¥å¯¹è±¡çš„ç±»å‹æ•°æ®ï¼ˆè¿™ä¸€æ­¥å°±æ ‡è®°äº†å½“å‰å®ä¾‹å±äºå“ªä¸ªClassï¼‰ã€‚ å…ˆæ¥çœ‹ä¸€æ®µç¨‹åºï¼š 123456789101112131415161718192021222324public class Student { private int id; private int age; private Teacher teacher;}public class Teacher { private int id;}public static void main(String[] args) { int a = 1; long b = 2L; Student student = new Student(); student.setId(1); student.setAge(2); Teacher teacher = new Teacher(); teacher.setId(1); student.setTeacher(teacher);} ä»£ç å—1 ä¸Šé¢æ˜¯å¾ˆç®€å•çš„ä¸€ä¸ªç¨‹åºï¼Œmainæ–¹æ³•é‡Œå£°æ˜äº†ä¸€äº›å˜é‡ä»¥åŠåˆå§‹åŒ–äº†ä¸€äº›å¯¹è±¡ï¼Œé‚£ä¹ˆä¸Šé¢çš„ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­çš„å¼•ç”¨å…³ç³»è¡¨ç¤ºä¸ºä¸‹å›¾ï¼š ä¸Šå›¾å°±æ˜¯æ‰§è¡Œåˆ°mainæ–¹æ³•å°¾éƒ¨çš„æœ€ç»ˆå¼•ç”¨å…³ç³»ï¼Œæˆ‘ä»¬çŸ¥é“åƒæ ˆå¸§é‡Œçš„æ•°æ®ï¼ˆæœ¬åœ°å˜é‡è¡¨ï¼‰éšç€æ–¹æ³•çš„æ‰§è¡Œç»“æŸï¼Œè‡ªç„¶å°±è¢«é‡Šæ”¾äº†ï¼Œå› æ­¤åƒmainæ–¹æ³•é‡Œçš„aã€bã€studentã€teacheræ˜¯ä¸éœ€è¦GCæ¥å…³å¿ƒçš„ï¼ŒGCéœ€è¦å…³å¿ƒçš„æ˜¯å›¾2é‡Œå †åŒºçš„ä¿©å®ä¾‹å¯¹è±¡ï¼Œè¿™ä¿©å®ä¾‹å¯¹è±¡æ˜¯ä¸ä¼šéšç€æ ˆå¸§çš„ç»“æŸè€Œè¢«å›æ”¶æ‰çš„ï¼Œå› æ­¤éœ€è¦å€ŸåŠ©GCæ¥è¿›è¡Œå›æ”¶ï¼Œé‚£ä¹ˆä»€ä¹ˆæ ·çš„å¯¹è±¡å¯ä»¥è¢«å›æ”¶å‘¢ï¼Ÿè¿™åˆå›åˆ°ä¸Šä¸€ç¯‡é‡Œå¯¹å¯è¾¾æ€§åˆ†æç®—æ³•çš„æè¿°äº†ï¼Œå…¶å®å°±æ˜¯çœ‹çœ‹å½“å‰å®ä¾‹è¿˜æœ‰æ²¡æœ‰è¢«GC Rootå¼•ç”¨ï¼Œé’ˆå¯¹ä¸Šä¾‹ï¼ŒGC Rootå°±æ˜¯studentå’Œteacherï¼Œè¿™ä¿©å¼•ç”¨æ²¡äº†ï¼Œå¼•ç”¨å±€é¢å°±å˜æˆäº†ä¸‹é¢è¿™æ ·ï¼š å¾ˆæ˜¾ç„¶ï¼Œä¸¤ä¸ªå®ä¾‹å·²ç»å¤±å»äº†GC Rootçš„å¼•ç”¨ï¼Œå°½ç®¡Teacherå®ä¾‹è¿˜å­˜åœ¨ä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œä½†æ˜¯åŸºäºå¯è¾¾æ€§åˆ†æç®—æ³•çš„ç‰¹æ€§ï¼Œä¹Ÿä¼šè¢«åˆ¤å®šä¸ºâ€œä¸å¯è¾¾â€å¯¹è±¡ï¼Œæœ€ç»ˆä¿©å®ä¾‹ä¼šè¢«GCå›æ”¶æ‰ã€‚ åˆ°è¿™é‡Œæ€»ç»“ä¸€ä¸‹ï¼Œæ ˆå¸§é‡Œå­˜æ”¾çš„æœ¬åœ°å˜é‡è¡¨ï¼Œå­˜åœ¨ä¸¤ç§ç±»å‹çš„å˜é‡ï¼šåŸºæœ¬ç±»å‹&amp;å¼•ç”¨ç±»å‹ï¼ŒåŸºæœ¬ç±»å‹ç”±äºé¢„å…ˆçŸ¥é“è¦ä¸ºå…¶åˆ†é…å¤šå¤§å†…å­˜ï¼Œå› æ­¤ä¼šç›´æ¥åœ¨æ ˆå¸§å†…åˆ›å»ºï¼Œåˆ›å»ºå®Œæ¯•åéšç€æ ˆå¸§çš„ç»“æŸè€Œé”€æ¯ï¼Œå¼•ç”¨å˜é‡ï¼ˆéåŸºæœ¬ç±»å‹çš„å…¶ä»–ç±»å‹å˜é‡ï¼‰ç”±äºé¢„å…ˆå¹¶ä¸æ¸…æ¥šéœ€è¦åˆ†é…å¤šå¤§çš„å†…å­˜ï¼Œå¯èƒ½åç»­éœ€è¦åŠ¨æ€æ‰©å®¹ç­‰ï¼Œéœ€è¦æ”¾å…¥å †ç©ºé—´ï¼Œæ ˆå¸§å†…ä¿ç•™ä¸€ä¸ªæŒ‡å‘å…¶å†…å­˜åœ°å€çš„å¼•ç”¨å˜é‡ï¼Œè€Œæ”¾å…¥å †ç©ºé—´æ„å‘³ç€å®ä¾‹æœ¬èº«æ— æ³•éšç€æ ˆå¸§çš„æ¶ˆå¤±è€Œè¢«é‡Šæ”¾ï¼Œéœ€è¦å€ŸåŠ©GCæ¥å®Œæˆå›æ”¶ã€‚ äºŒã€é¢„å›æ”¶é˜¶æ®µ2.1ï¼šå›æ”¶å‰çš„å¯¹è±¡åˆ¤æ´»é€šè¿‡ç¬¬ä¸€éƒ¨åˆ†ï¼Œå¤§è‡´äº†è§£äº†ä¸¤ç§å˜é‡ç±»å‹ï¼Œè€ŒGCéœ€è¦å…³å¿ƒçš„åˆ™æ˜¯GC Rootï¼Œå…¸å‹çš„ä½œä¸ºGC Rootçš„ç±»å‹ï¼Œåˆ™æ˜¯å¼•ç”¨ç±»å‹ï¼Œè€Œåˆ¤å®šå˜é‡æ˜¯å¦ä¸ºå¼•ç”¨ç±»å‹å˜é‡ï¼Œå¾€å¾€å½±å“ç€GCçš„å®ç°ã€‚ è¿™é‡Œæ‰€å¤„çš„é˜¶æ®µæ˜¯é¢„å›æ”¶é˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µçš„GCä¸ä¼šå‘ç”Ÿå›æ”¶ï¼Œæ‰€ä»¥å…ˆä¸è¯´å›æ”¶é˜¶æ®µçš„ç®—æ³•ï¼ˆä¸‹é¢å°†è¦ä»‹ç»çš„æ ‡è®°-æ¸…é™¤ç®—æ³•ã€æ ‡è®°-å‹ç¼©ç®—æ³•ã€å¤åˆ¶ç®—æ³•ï¼‰ï¼ŒGCè¦è¿›å…¥å›æ”¶é˜¶æ®µï¼Œé¦–å…ˆè¦åšçš„äº‹æƒ…å°±æ˜¯åˆ¤æ–­å‡ºâ€œå“ªäº›å¯¹è±¡è¿˜æ˜¯æ´»ç€çš„â€ï¼Œé‚£ä¹ˆè¿™ä¸ªé˜¶æ®µéœ€è¦åšçš„äº‹æƒ…æ˜¯åˆ†æå‡ºå¯¹è±¡çš„å­˜æ´»çŠ¶æ€ï¼Œæœ‰å“ªäº›æ–¹å¼å¯ä»¥åˆ¤æ–­å‡ºå¯¹è±¡çš„æ´»æ€§å‘¢ï¼Ÿè¿™é‡Œæœ‰ä¸¤ç§ä¸»è¦æ–¹å¼ï¼šå¼•ç”¨è®¡æ•°&amp;å¯è¾¾æ€§åˆ†æç®—æ³•ï¼Œå…¶ä¸­å¯è¾¾æ€§åˆ†æç®—æ³•æ˜¯æ ¹æ®GC Rootæ¥è¿›è¡Œåˆ¤æ–­çš„ï¼Œæ‰€ä»¥éœ€è¦å…³å¿ƒæ ˆå¸§é‡Œçš„å¼•ç”¨ç±»å‹å˜é‡ï¼Œè¿™ä¸ªåˆ¤æ–­å¼•ç”¨å˜é‡çš„æ–¹å¼ï¼Œåˆåˆ†ä¸ºä¿å®ˆå¼å’Œå‡†ç¡®å¼ï¼Œè¿™äº›åˆ¤å®šæ–¹æ³•çš„é€‰æ‹©å¾€å¾€ä¼šå½±å“GCçš„å®ç°ã€‚ 2.1.1ï¼šå¼•ç”¨è®¡æ•°æ³•è¿™ç§åˆ¤å®šç®—æ³•éå¸¸ç®€å•ï¼Œç»™å¯¹è±¡æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒï¼Œå°±åŠ 1ï¼Œæ¯å½“ä¸€ä¸ªå¼•ç”¨å¤±æ•ˆï¼Œå°±å‡1ï¼Œå½“å¼•ç”¨è®¡æ•°å™¨ä¸º0çš„æ—¶å€™ï¼Œå°±è®¤ä¸ºè¯¥å¯¹è±¡å¤±æ´»ï¼Œå¤„äºå¯å›æ”¶çŠ¶æ€ã€‚ä½†æ˜¯è¿™ç§ç®—æ³•æ˜¯æœ‰ç¼ºé™·çš„ï¼Œæ¯”å¦‚å¯¹è±¡çš„å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œå¦‚ä¸‹ï¼š 123456A a = new A();B b = new B();a.b = b;b.a = a;a = null;b = null; å¦‚ä¸Šä»£ç ï¼Œé¦–å…ˆAã€Bçš„å®ä¾‹é¦–å…ˆè¢«aã€bå¼•ç”¨ï¼Œè¿™æ—¶åŠ 1ï¼Œç„¶ååˆè¢«a.bã€b.aå¼•ç”¨ä¸€æ¬¡ï¼Œå†æ¬¡åŠ 1ï¼Œç„¶åaã€bæŒ‡å‘nullï¼ŒAã€Bå®ä¾‹å¤±å»äº†ä¸€ä¸ªå¼•ç”¨ï¼Œä½†æ˜¯è®¡æ•°å™¨é‡Œçš„å¼•ç”¨æ•°è¿˜æ˜¯1ï¼Œå•çœ‹ä¸Šé¢çš„ä»£ç ï¼ŒAã€Bå¯¹è±¡çš„å®ä¾‹åº”è¯¥æ˜¯éœ€è¦è¢«å›æ”¶çš„çš„ï¼Œå› ä¸ºä¸å­˜åœ¨ä»»ä½•æ–¹æ³•æ ˆçš„å¼•ç”¨ï¼Œåè€Œæ˜¯å®ƒä»¬å†…éƒ¨çš„å±æ€§äº’ç›¸å¼•ç”¨ç€å½¼æ­¤ï¼Œå› æ­¤åˆ©ç”¨è¿™ä¸ªç®—æ³•ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šä¼šé€ æˆå†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚jvmåœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œä¹Ÿæ˜¯ä¼šæŠŠAå’ŒBçš„å®ä¾‹å¯¹è±¡ç»™å›æ”¶æ‰çš„ï¼Œå› æ­¤JVMå¹¶ä¸æ˜¯é‡‡ç”¨è¿™ç§æ–¹æ³•åˆ†æå¯¹è±¡æ´»æ€§çš„ã€‚ 2.1.2ï¼šå¯è¾¾æ€§åˆ†æç®—æ³•è¿™ä¸ªç®—æ³•çš„åŸºæœ¬æ€è·¯å°±æ˜¯é€šè¿‡ä¸€ç³»åˆ—çš„GC Rootsçš„å¯¹è±¡ä½œä¸ºèµ·ç‚¹ï¼Œç„¶åä»è¿™äº›èŠ‚ç‚¹å¾€ä¸‹æœç´¢ï¼Œæœç´¢èµ°è¿‡çš„è·¯å¾„è¢«ç§°ä½œâ€œå¼•ç”¨é“¾â€ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ°GC Rootsæ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿æ—¶ï¼Œåˆ™è®¤ä¸ºè¯¥å¯¹è±¡æ­»äº¡ï¼ŒGC Rootsé€šå¸¸åŒ…å«ï¼šè™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ã€æ–¹æ³•åŒºä¸­çš„ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ä»¥åŠå¸¸é‡å¼•ç”¨çš„å¯¹è±¡ã€æœ¬åœ°æ–¹æ³•æ ˆä¸­çš„nativeæ–¹æ³•å¼•ç”¨çš„å¯¹è±¡ã€‚ é‚£ä¹ˆå†åˆ©ç”¨æ­¤ç®—æ³•æ¥çœ‹çœ‹ä¸Šè¿°ABå¾ªç¯ä¾èµ–é—®é¢˜ä¾‹å­çš„å¼•ç”¨å˜åŒ–ï¼š é€šè¿‡å›¾4å¯ä»¥çœ‹åˆ°ï¼Œæœ€åå¤±å»GC Rootsçš„å¼•ç”¨åï¼ŒAã€Bçš„å®ä¾‹å¯¹è±¡åˆ°GC Rootsæ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿ï¼Œå› æ­¤æœ€ç»ˆä¼šè¢«åˆ¤å®šä¸ºæ­»äº¡å¯¹è±¡ï¼Œè¿›è€Œè¢«å›æ”¶ã€‚ ç›®å‰JVMçš„å¯¹è±¡æ­»äº¡åˆ¤å®šä¹Ÿæ˜¯é€šè¿‡è¯¥ç®—æ³•æ¥è¿›è¡Œåˆ¤æ–­çš„ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ°GC Rootsâ€œä¸å¯è¾¾â€æ—¶ï¼Œå³è¢«è®¤ä¸ºâ€œå¯å›æ”¶â€ã€‚ é€šè¿‡ä¹‹å‰å¯¹å¯è¾¾æ€§åˆ†æç®—æ³•çš„ä»‹ç»ï¼Œè¿™ç§åˆ¤æ´»æ–¹æ³•ä¸»è¦æ ¹æ®åˆ¤å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦ç›´æ¥æˆ–é—´æ¥è¢«ä¸€ä¸ªGC Rootå¼•ç”¨ï¼Œè€Œå¼•ç”¨ç±»å‹çš„å˜é‡æ‰ä¼šä½œä¸ºGC Rootï¼Œå› æ­¤é‡‡ç”¨è¿™ç§åˆ¤æ´»ç®—æ³•ï¼Œå¾€å¾€è¦å…ˆåˆ†æå‡ºå“ªäº›å˜é‡å±äºå¼•ç”¨ç±»å‹ï¼Œå› ä¸ºæœ‰äº†è¿™ä¸€æ­¥ï¼Œæ‰€ä»¥å¯è¾¾æ€§åˆ†æç®—æ³•åˆæ ¹æ®JVMçš„å®ç°ä¸åŒï¼Œå½±å“ç€GCçš„å®ç°æ–¹å¼ï¼Œå› è€ŒGCåˆè¢«åˆ†ä¸ºäº†ä¸¤ç§åˆ†ææ–¹å¼ï¼š 2.1.2.1ï¼šå¯è¾¾æ€§åˆ†æç®—æ³•-ä¿å®ˆå¼GCå¦‚æœJVMä¸é€‰æ‹©è®°å½•ä¸‹æ¥æ ˆå¸§ä¸­çš„å˜é‡å“ªäº›æ˜¯å¼•ç”¨ç±»å‹ï¼Œå“ªäº›æ˜¯åŸºæœ¬ç±»å‹ï¼Œå¯¹äºGCè€Œè¨€ï¼Œæ˜¯æ— æ³•çŸ¥é“å˜é‡ç±»å‹ï¼Œäºæ˜¯GCåœ¨å›æ”¶å‰å¤•ï¼Œéœ€è¦éå†æ ˆå¸§é‡Œçš„æ¯ä¸€ä¸ªå˜é‡ï¼Œé€šè¿‡ä¸€äº›åˆ¤å®šæ¡ä»¶æ¥åˆ†æå‡ºå½“å‰å˜é‡æ˜¯å¦æ˜¯å¼•ç”¨å˜é‡ï¼Œè¿™äº›æ¡ä»¶åŒ…æ‹¬è¾¹ç•Œæ£€æŸ¥ã€å¯¹é½æ£€æŸ¥ç­‰ï¼Œç¬¦åˆæ ‡å‡†çš„ï¼Œä¼šè¢«è§†ä¸ºå¼•ç”¨ç±»å‹å˜é‡ï¼Œå¦åˆ™ä¸ºåŸºæœ¬ç±»å‹å˜é‡ï¼Œè¿™ç§åˆ¤å®šæ–¹å¼æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯å­˜åœ¨ç¼ºç‚¹ï¼Œæ¯”å¦‚ä¸€ä¸ªå¯¹è±¡å®é™…ä¸Šæ²¡æœ‰ä»»ä½•å¼•ç”¨å­˜åœ¨äº†ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨â€œç–‘ä¼¼æŒ‡å‘â€å®ƒçš„æŒ‡é’ˆï¼Œä½¿å¾—å…¶é€ƒè¿‡è¢«GCçš„å‘½è¿ï¼Œè¿™é‡Œâ€œç–‘ä¼¼æŒ‡å‘â€çš„æ„æ€æ˜¯è¯´ï¼Œæ ˆå¸§é‡Œå¯èƒ½æ°å¥½å­˜åœ¨ä¸€ä¸ªé€šè¿‡äº†æ¡ä»¶æ£€æŸ¥ï¼ˆè¾¹ç•Œã€å¯¹é½ç­‰æ£€æŸ¥éƒ½ç¬¦åˆå¼•ç”¨ç±»å‹æ•°æ®çš„æ¡ä»¶ï¼‰çš„å˜é‡ï¼Œè¿™æ—¶GCä¼šè®¤ä¸ºå®ƒå°±æ˜¯ä¸€ä¸ªGC Rootï¼Œè¢«è®¤ä¸ºæ˜¯GC Rootåï¼Œå…¶å€¼æ­£å¥½å¯¹åº”ä¸Šè¿™ä¸ªæ— ç”¨å¯¹è±¡çš„åœ°å€ï¼Œé‚£ä¹ˆè¿™ä¸ªæ­»å¯¹è±¡ä»ç„¶è¢«è®¤ä¸ºâ€œå¯è¾¾â€ï¼Œæ­¤æ—¶å°±ä¼šç»•è¿‡äº†ä¸€æ¬¡GCã€‚ 2.1.2.2ï¼šå¯è¾¾æ€§åˆ†æç®—æ³•-å‡†ç¡®å¼GCè¿™æ˜¯ç›®å‰HotSpotè™šæ‹Ÿæœºä¼šé‡‡ç”¨çš„ä¸€ç§æšä¸¾GC Rootsçš„æ–¹å¼ï¼ˆä¸‹é¢â‘¢ä¼šä»‹ç»å®ç°æ–¹å¼ï¼‰ï¼Œå‡†ç¡®å¼GCä¸åŒäºä¿å®ˆå¼GCï¼Œå‡†ç¡®å¼GCæ˜¯åœ¨æšä¸¾GC Rootsæ—¶ï¼ŒGCå·²ç»çŸ¥é“äº†æ ˆå¸§é‡Œæ‰€æœ‰å¯¹è±¡çš„ç±»å‹ï¼Œè¿™å°±å…å»äº†ä¸Šé¢çš„ä¸ç¡®å®šæ£€æŸ¥ï¼Œå› ä¸ºé¢„å…ˆçŸ¥é“æ ˆå¸§é‡Œçš„å˜é‡æ˜¯å¼•ç”¨ç±»å‹è¿˜æ˜¯åŸºæœ¬ç±»å‹ï¼Œé‚£ä¹ˆæšä¸¾GC Rootså°±å˜çš„éå¸¸å‡†ç¡®ï¼Œè¿™å°±æ˜¯å‡†ç¡®å¼GCã€‚ 2.1.2.3ï¼šHotSpotå¯¹äºå‡†ç¡®å¼GCçš„å®ç°-OopMapHotSpotè™šæ‹Ÿæœºæ˜¯é‡‡ç”¨OopMapæ¥å®ç°å¼•ç”¨ç±»å‹æ ‡è®°çš„ï¼ŒOopMapå¯ä»¥è®°å½•ä¸‹å½“å‰æ ˆå¸§é‡Œæ‰€æœ‰å¼•ç”¨ç±»å‹å˜é‡ï¼ŒGCæ—¶ï¼Œåªéœ€è¦è¯»å–è¿™é‡Œé¢çš„å˜é‡å³å¯ï¼Œå¾ˆå¤šèµ„æ–™ä¼šæåˆ°OopMapæ˜¯æé«˜äº†æšä¸¾GC Rootsçš„æ•ˆç‡ï¼Œå…¶å®è¿™ä¸æ˜¯OopMapçœŸæ­£çš„ç›®çš„ï¼ŒOopMapçš„å®ç°æ˜¯HotSpotç”¨æ¥å®ç°å‡†ç¡®å¼GCçš„ï¼Œè€Œè¿™æ ·å¤„ç†ï¼Œæ°å¥½å¯¹æšä¸¾æ•ˆç‡çš„æå‡ä¹Ÿèµ·åˆ°ä¸€å®šçš„å¸®åŠ©ï¼ˆæ¯”å¦‚æšä¸¾æ—¶å®Œå…¨å¯ä»¥å¿½ç•¥æ‰é‚£äº›åŸºæœ¬ç±»å‹å˜é‡äº†ï¼Œå› ä¸ºä»–ä»¬ä¸ä¼šè¢«è®°åˆ°OopMapé‡Œï¼‰ã€‚ 2.2ï¼šSTWä¸Šé¢è¯´äº†GCå¼€å§‹å‰é’ˆå¯¹å¯¹è±¡çš„åˆ¤æ´»æ–¹æ³•ï¼ŒHotSpoté€šè¿‡OopMapå®ç°äº†å‡†ç¡®å¼GCï¼Œç°åœ¨æ¥è®²ä¸‹GCå‰çš„å‡†å¤‡å·¥ä½œï¼ŒGCå‰å¾€å¾€éœ€è¦å°†æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æŒ‚èµ·ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢ä¸€äº›å¼•ç”¨åœ¨GCè¿‡ç¨‹ä¸­è¿˜åœ¨ä¸åœçš„å‘ç”Ÿå˜åŒ–è€Œåšçš„ä¸€è‡´æ€§ä¿æŠ¤ï¼Œè¿™ç§è¡Œä¸ºå«åšSTWï¼ˆStop The Worldï¼‰ï¼Œä¸€èˆ¬æ¥è¯´ï¼ŒSTWå‘ç”Ÿæ—¶çš„çº¿ç¨‹ä¸­æ–­ï¼ŒHotSpotè™šæ‹Ÿæœºéœ€è¦æ¯ä¸ªçº¿ç¨‹å°†è‡ªå·±çš„ç¨‹åºæ‰§è¡Œåˆ°æŒ‡å®šä½ç½®ï¼Œæ ¹æ®çº¿ç¨‹æ˜¯å¦å·²ç»è®©å‡ºCPUèµ„æºï¼ˆå³çº¿ç¨‹çŠ¶æ€ï¼‰è€Œåˆ†ä¸ºä¸¤ç§æ„ä¹‰ä¸Šçš„ä½ç½®ï¼š 2.2.1ï¼šå®‰å…¨ç‚¹ï¼ˆSafe Pointï¼‰é’ˆå¯¹çš„æ˜¯GCå‘ç”Ÿæ—¶è¿˜åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Œè¿™æ—¶å€™éœ€è¦ç­‰å¾…è¯¥çº¿ç¨‹ä¸»åŠ¨è¿è¡Œåˆ°æŒ‡å®šä½ç½®æ‰ä¸­æ–­çº¿ç¨‹ï¼Œè¿™äº›æŒ‡å®šçš„ä½ç½®ï¼Œè¢«ç§°ä¸ºå®‰å…¨ç‚¹ï¼Œå®‰å…¨ç‚¹çš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸Šé¢è¯´åˆ°HotSpoté€šè¿‡OopMapæ¥å®Œæˆå‡†ç¡®å¼GCï¼Œä½†æ˜¯å¼•ç”¨å…³ç³»çš„å˜åŒ–æ˜¯ä¸å¯é¿å…çš„ï¼Œæ¯å˜åŒ–ä¸€æ¬¡ï¼Œå°±æ›´æ–°ä¸€æ¬¡OopMapæ˜¾ç„¶æ•ˆç‡ä¸é«˜ï¼Œå› æ­¤JVMæ›´æ–°OopMapçš„å®ç°å°±ç”¨åˆ°äº†å®‰å…¨ç‚¹ï¼Œå½“çº¿ç¨‹è¿è¡Œåˆ°å®‰å…¨ç‚¹ï¼Œè®°å½•ä¸‹å½“å‰å¼•ç”¨ï¼Œæ›´æ–°è‡³OopMapå³å¯ï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆç¨‹åºä¸­æ–­å‰å¿…é¡»è¦åœé åœ¨æœ€è¿‘çš„å®‰å…¨ç‚¹ä¸Šã€‚å¯ä½œä¸ºå®‰å…¨ç‚¹çš„ä½ç½®æœ‰ï¼šå¾ªç¯æœ«å°¾ã€æ–¹æ³•ä¸´è¿‘è¿”å›å‰ã€æ–¹æ³•è°ƒç”¨åã€æŠ›å‡ºå¼‚å¸¸çš„ä½ç½®ã€‚ 2.2.2ï¼šå®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰æ„ä¹‰ç±»ä¼¼å®‰å…¨ç‚¹ï¼Œè¿™ä¸ªæ¦‚å¿µæ˜¯é’ˆå¯¹GCå‘ç”Ÿå‰ï¼Œç¨‹åºçº¿ç¨‹å¤„äºâ€œCPUè®©å‡ºçŠ¶æ€â€ï¼Œæ¯”å¦‚çº¿ç¨‹çš„sleepçŠ¶æ€æˆ–è€…blockedçŠ¶æ€ï¼Œè¿™æ—¶è¯¥çº¿ç¨‹æ˜¯æ²¡æœ‰èƒ½åŠ›è¿è¡Œåˆ°å°±è¿‘çš„å®‰å…¨ç‚¹çš„ï¼Œé’ˆå¯¹æ­¤æƒ…å†µï¼Œä¾¿æœ‰äº†å®‰å…¨åŒºåŸŸæ¦‚å¿µï¼Œå®‰å…¨åŒºåŸŸæ˜¯æŒ‡åœ¨ä¸€æ®µä»£ç åŒºåŸŸä¸­ï¼Œå¼•ç”¨å…³ç³»æ˜¯ä¸ä¼šå‘ç”Ÿå˜åŒ–çš„ï¼Œåœ¨æ­¤åŒºåŸŸçš„ä»»æ„ä½ç½®å¼€å§‹GCéƒ½æ˜¯å®‰å…¨çš„ã€‚çº¿ç¨‹åœ¨è¿è¡Œåˆ°å®‰å…¨åŒºåŸŸå†…ï¼Œé¦–å…ˆä¼šæ ‡è®°è‡ªå·±å·²ç»åˆ°è¾¾äº†å®‰å…¨åŒºåŸŸï¼Œé‚£ä¹ˆå½“JVMéœ€è¦GCæ—¶ï¼Œå‘ç°è¯¥çº¿ç¨‹å·²ç»è¿›å…¥å®‰å…¨åŒºåŸŸï¼Œåˆ™ä¸ä¼šå†å»ç®¡å…¶çŠ¶æ€ï¼ˆæ— è§†sleepã€blockedç­‰è®©å‡ºCPUçš„çŠ¶æ€ï¼‰ï¼Œç›´æ¥å¯¹å…¶å†…éƒ¨è¿›è¡ŒOopMapæ›´æ–°ï¼Œå®ŒæˆGC Rootsçš„æšä¸¾ï¼Œå½“ç„¶ï¼Œå¦‚æœçº¿ç¨‹ç¦»å¼€å®‰å…¨åŒºåŸŸæ—¶ï¼Œå°±éœ€è¦åˆ¤æ–­æ˜¯å¦å·²ç»å®Œæˆäº†GCæˆ–è€…GC Rootsæšä¸¾ï¼Œè‹¥å®Œæˆåˆ™ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™å°±å¿…é¡»ç­‰å¾…ç›´åˆ°æ”¶åˆ°å¯ä»¥ç¦»å¼€å®‰å…¨åŒºåŸŸçš„ä¿¡å·ä¸ºæ­¢ã€‚ 2.2.3ï¼šSTWä¸­æ–­çº¿ç¨‹çš„ä¸¤ç§æ–¹å¼å®‰å…¨ç‚¹å’Œå®‰å…¨åŒºåŸŸå‡ä¸ºHotSpotè™šæ‹Ÿæœºä¸ºäº†ä¿è¯æšä¸¾GC Rootsçš„å‡†ç¡®æ€§è€Œåšå‡ºçš„å®ç°ï¼Œç»“åˆå®‰å…¨ç‚¹ã€å®‰å…¨åŒºåŸŸï¼Œåœ¨è¾¾åˆ°å®‰å…¨ç‚¹æ—¶GCå¯¹çº¿ç¨‹çš„ä¸­æ–­ï¼ˆSTWï¼‰åˆåˆ†ä¸ºä¸¤ç§ä¸­æ–­æ–¹å¼ï¼š 2.2.3.1ï¼šæŠ¢å…ˆå¼ä¸­æ–­åœ¨GCå‘ç”Ÿæ—¶ï¼Œé¦–å…ˆä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼Œç„¶åæ£€æŸ¥å„ä¸ªçº¿ç¨‹æ˜¯å¦æ‰§è¡Œåˆ°äº†å®‰å…¨ç‚¹ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æ¢å¤å¯¹åº”çº¿ç¨‹è®©å…¶è¿è¡Œåˆ°å®‰å…¨ç‚¹å†æ¬¡å®Œæˆä¸­æ–­ã€‚ 2.2.3.2ï¼šä¸»åŠ¨å¼ä¸­æ–­åœ¨GCå‘ç”Ÿæ—¶ï¼Œä¸ç›´æ¥æ“ä½œçº¿ç¨‹ä¸­æ–­ï¼Œè€Œæ˜¯ç®€å•è®¾ç½®ä¸€ä¸ªæ ‡è®°ï¼Œè®©å„ä¸ªçº¿ç¨‹å»è½®è¯¢è¿™ä¸ªæ ‡è®°ï¼Œå¦‚æœè½®è¯¢åˆ°è¯¥æ ‡è®°ï¼Œåˆ™è‡ªå·±ä¸»åŠ¨ä¸­æ–­æŒ‚èµ·è‡ªå·±ã€‚JVMå°±é‡‡ç”¨è¯¥ä¸­æ–­æ–¹å¼ï¼Œè½®è¯¢æ ‡è®°çš„ä½ç½®å’Œå®‰å…¨ç‚¹çš„ä½ç½®ä¸€èˆ¬æ˜¯é‡åˆçš„ã€‚ ä¸‰ã€å›æ”¶é˜¶æ®µ-åƒåœ¾å›æ”¶ç®—æ³•ç¬¬äºŒéƒ¨åˆ†è®²çš„æ˜¯GCå‰çš„å‡†å¤‡å·¥ä½œï¼Œä»¥åŠHotSpotåœ¨GCå‰é’ˆå¯¹æšä¸¾GC Rootsçš„å®ç°ï¼Œä¸‹é¢æ¥çœ‹ä¸‹å®ŒæˆGC Rootsæšä¸¾åçš„å›æ”¶é˜¶æ®µçš„å‡ ç§å›æ”¶ç®—æ³•ã€‚ 3.1ï¼šæ ‡è®°-æ¸…é™¤ç®—æ³•è¿™æ˜¯ä¸€ç§æœ€åŸºç¡€çš„æ”¶é›†ç®—æ³•ï¼Œè¿™ç§ç®—æ³•åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š æ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼ˆè¿™é‡Œçš„æ ‡è®°ä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•è¿›è¡Œåˆ¤å®šï¼‰ æ ‡è®°å®Œæˆåç»Ÿä¸€å›æ”¶æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ è¿™ä¸ªç®—æ³•ä¸¤ä¸ªé˜¶æ®µçš„æ•ˆç‡éƒ½ä¸é«˜ï¼Œè€Œä¸”ä¼šäº§ç”Ÿå¤§é‡çš„å†…å­˜ç¢ç‰‡ï¼Œç¢ç‰‡è¿‡å¤šå¯èƒ½ä¼šå¯¼è‡´æ— æ³•æ‰¾åˆ°è¿ç»­å†…å­˜å­˜å‚¨è¾ƒå¤§çš„å¯¹è±¡ï¼Œæ‰€ä»¥ä¼šè¢«è¿«æå‰è§¦å‘ä¸€æ¬¡GCï¼Œå›¾ç¤ºå¦‚ä¸‹ï¼š ç”±ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å›æ”¶åï¼Œäº§ç”Ÿäº†å¤§é‡ä¸è¿ç»­çš„å†…å­˜å•å…ƒç¢ç‰‡ã€‚å•çº¯ä»å›¾5çœ‹ï¼Œåªèƒ½çŸ¥é“è¿™ä¸ªç®—æ³•ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œå¹¶ä¸èƒ½äº†è§£æ•´ä¸ªç®—æ³•çš„ç»†èŠ‚ï¼Œå› æ­¤å•çº¯é€šè¿‡ä¸Šå›¾ï¼Œæ˜¯æ²¡åŠæ³•ä½“ç°è¯¥ç®—æ³•æ•ˆç‡é—®é¢˜çš„ï¼Œå›¾5æ˜¯å¤§éƒ¨åˆ†èµ„æ–™é‡Œéƒ½ä¼šå±•ç¤ºçš„ä¸€ä¸ªæœ€ç»ˆæ€ï¼Œç®—æ³•ç»†èŠ‚åˆ™å…¨éƒ¨çœç•¥ï¼Œå¯¼è‡´å¾ˆå¤šæ—¶å€™ï¼Œæ ‡è®°-æ¸…é™¤ç®—æ³•ç›¸æ¯”å¤åˆ¶ç®—æ³•çš„æ•ˆç‡ç©¶ç«Ÿå¼±åœ¨å“ªé‡Œæ²¡æœ‰å¾ˆæ¸…æ™°çš„è®¤çŸ¥ï¼Œä¸‹é¢ï¼Œé€šè¿‡ä¸€å¹…å›¾æ¥è¯´æ˜ä¸‹å…¶å…·ä½“çš„æ‰§è¡Œç»†èŠ‚ï¼š ä¸Šå›¾å°±æ˜¯æ ‡è®°-æ¸…é™¤ç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œé¦–å…ˆä»æ ‡è®°é˜¶æ®µåˆ°æ¸…é™¤é˜¶æ®µï¼ŒGCæ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š æŠŠä»rootå¼€å§‹çš„å¯èƒ½è¢«å¼•ç”¨çš„å¯¹è±¡ï¼ˆå¯è¾¾å¯¹è±¡ï¼‰è¿›è¡Œä¸€ä¸ªä¸ªçš„æ ‡è®°ï¼Œå›¾ä¸­çš„â€œæ ‡è®°é˜¶æ®µâ€å°±æ˜¯åœ¨å¹²è¿™ä»¶äº‹ï¼Œè¢«æ ‡è®°çš„å¯¹è±¡å›¾é‡Œå·²æŸ“æˆç»¿è‰²ã€‚ é‡å¤1æ­¥éª¤å°±å¯ä»¥æŠŠæ‰€æœ‰ä»rootå‡ºå‘çš„è¢«å¼•ç”¨æˆ–é—´æ¥å¼•ç”¨çš„å¯¹è±¡å…¨éƒ¨æ‰“ä¸Šæ ‡è®° åœ¨ä¸Šè¿°ä¸¤ä¸ªè¿‡ç¨‹å®Œæˆåï¼Œæ ‡è®°é˜¶æ®µå°±ç®—å‘Šä¸€æ®µè½ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ¸…é™¤é˜¶æ®µï¼Œæ¸…é™¤é˜¶æ®µå°†ä¸Šè¿°è¢«æ ‡è®°çš„å¯¹è±¡è§†ä¸ºâ€œå­˜æ´»å¯¹è±¡â€ï¼Œè¿™æ—¶ä¼šæ‰«æå…¨éƒ¨å¯¹è±¡ï¼Œå°†æ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡æ¸…é™¤ï¼ŒåŒæ—¶å°†æœ‰æ ‡è®°çš„å¯¹è±¡çš„æ ‡è®°å»é™¤ï¼Œæ–¹ä¾¿ä¸‹æ¬¡GCä½¿ç”¨ã€‚ äº†è§£å®Œè¿™ä¸ªç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå¤§è‡´ä¸Šå°±çŸ¥é“äº†ä¸ºä»€ä¹ˆè¿™ä¸ªç®—æ³•çš„æ•ˆç‡ä¼šå¾ˆä½äº†ï¼Œå¦‚æœç³»ç»Ÿä¸­ä¼šåˆ›å»ºå¤§é‡çš„å¯¹è±¡ï¼Œä½†åªæœ‰å¾ˆå°‘çš„å¯¹è±¡ä¼šå­˜æ´»çš„æ¯”è¾ƒä¹…ï¼Œè¿™æ—¶å€™è¯¥ç®—æ³•çš„æ•ˆç‡åœ¨æ¸…é™¤é˜¶æ®µçš„æ—¶å€™ï¼Œè€—æ—¶å°±ä¼šå¾ˆä¹…ï¼Œå› ä¸ºè¦æ•´ä½“éå†ï¼Œè€Œä¸”è¿˜è¦è¿›è¡Œå¤§é‡å›æ”¶ã€‚ 3.2ï¼šå¤åˆ¶ç®—æ³•è¿™ç§ç®—æ³•å°†å¯ç”¨å†…å­˜åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€å—ï¼ŒGCè§¦å‘æ—¶ï¼Œå°±å°†è¯¥å—å†…å­˜é‡Œè¿˜å­˜æ´»ç€çš„å¯¹è±¡æ•´ä½“å¤åˆ¶åˆ°å¦å¤–ä¸€å—å†…å­˜ä¸Šå»ï¼Œç„¶åå†æŠŠå·²ä½¿ç”¨çš„å†…å­˜ä¸€æ¬¡æ€§æ¸…é™¤æ‰ï¼Œä¸‹é¢æ¥å±•ç¤ºä¸‹å›æ”¶çŠ¶æ€ï¼š åŒæ ·çš„ï¼Œè¿™å¼ å›¾ä»…ç”¨æ¥è¡¨ç°æ¸…ç†è¿‡ç¨‹å’Œæœ€ç»ˆæ€ï¼Œä¸‹é¢ï¼Œé€šè¿‡å›¾8æ¥è¯´æ˜ä¸‹è¿™ç§ç®—æ³•çš„æ‰§è¡Œæµç¨‹ï¼š ä¸Šå›¾å°±æ˜¯å¤åˆ¶ç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼š æ ¹æ®rootï¼Œæ‰¾å‡ºæ¥æ‰€æœ‰çš„å¯è¾¾å¯¹è±¡ï¼ˆå­˜æ´»å¯¹è±¡ï¼‰ï¼Œæ•´ä½“å¤åˆ¶åˆ°æ–°ç©ºé—´é‡Œï¼ˆè¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼æ ‡è®°-æ¸…é™¤ç®—æ³•é‡Œçš„æ ‡è®°é˜¶æ®µï¼‰ã€‚ å°†åŸæ¥çš„æ—§ç©ºé—´é‡Œçš„æ‰€æœ‰å¯¹è±¡æ•´ä½“æ¸…é™¤æ‰ï¼ˆå®Œæˆå¤åˆ¶åï¼Œå¯ä»¥è®¤ä¸ºåŸæ¥çš„æ—§ç©ºé—´é‡Œçš„æ‰€æœ‰å¯¹è±¡éƒ½å¯ä»¥å›æ”¶ï¼‰ï¼Œä¸‹æ¬¡GCçš„æ—¶å€™ï¼Œæœ¬æ¬¡GCæ„ä¹‰ä¸Šçš„â€œæ–°ç©ºé—´â€å°±å˜æˆäº†ä¸‹æ¬¡GCæ„ä¹‰ä¸Šçš„â€œæ—§ç©ºé—´â€ï¼Œä»¥æ­¤ç±»æ¨ã€‚ ç›¸æ¯”æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œå¤åˆ¶ç®—æ³•è™½ç„¶å†…å­˜è¢«ä¸€åˆ†ä¸ºäºŒï¼Œä½†æ˜¯èŠ‚çœäº†æ•´ä½“éå†æ‰€æœ‰å¯¹è±¡è¿™ä¸€æ­¥æ“ä½œï¼Œå¯¹äºé‚£ç§äº§ç”Ÿå¤§é‡å¯¹è±¡ï¼Œä½†æ˜¯å¯¹è±¡ç”Ÿå‘½å‘¨æœŸæçŸ­çš„æƒ…å†µï¼Œè¿™ä¸ªç®—æ³•ç›¸æ¯”æ ‡è®°-æ¸…é™¤ç®—æ³•æ•ˆç‡é«˜äº†ä¸æ­¢ä¸€ä¸ªæ¡£æ¬¡ï¼Œå› ä¸ºæ¯æ¬¡ä»…å¤åˆ¶ä¸€å°æ‰¹å­˜æ´»çš„å¯¹è±¡ï¼Œæ²¡å¿…è¦æ•´ä½“éå†æ‰€æœ‰çš„å¯¹è±¡è¿›è¡Œæ ‡è®°åˆ¤æ–­+æ¸…ç†çš„æ“ä½œã€‚æ‰€ä»¥è¿™ç§ç®—æ³•é€‚åˆé‚£ç§å¯¹è±¡å¤šï¼Œä½†å¤§éƒ¨åˆ†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­çš„æƒ…å†µï¼Œå¦‚æœå¯¹è±¡å¤šï¼Œç”Ÿå‘½å‘¨æœŸé•¿ï¼Œé‚£ä¹ˆæ„å‘³ç€å¤åˆ¶ç®—æ³•æ¯æ¬¡å¯¹å¤åˆ¶è¿™ä¸ªåŠ¨ä½œçš„å¼€é”€ï¼Œæ˜¯éå¸¸å¤§çš„ï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº†ï¼Œä¸ºä»€ä¹ˆjvmæ–°ç”Ÿä»£çš„å›æ”¶ç®—æ³•é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œè€Œè€å¹´ä»£åˆ™ä¸ç”¨ã€‚ 3.3ï¼šæ ‡è®°-å‹ç¼©ç®—æ³•ä¹Ÿåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š æ ‡è®°é˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µè·Ÿæ ‡è®°-æ¸…é™¤ç®—æ³•ä¸€è‡´ï¼Œå…·ä½“æµç¨‹å¯ä»¥å‚è€ƒå›¾6 å‹ç¼©é˜¶æ®µï¼Œç›¸æ¯”æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œè¯¥ç®—æ³•ä¸å†æ•´ä½“éå†æ‰€æœ‰çš„å¯¹è±¡ï¼Œè€Œæ˜¯å°†å¸¦æœ‰æ ‡è®°çš„â€œå­˜æ´»å¯¹è±¡â€ä¾æ¬¡å‹ç¼©æ’åˆ—ï¼Œæ’åˆ—å®Œæˆåï¼Œå­˜æ´»å¯¹è±¡å°†ç´§ç´§æŒ¨åœ¨ä¸€èµ·ï¼Œæ¸…é™¤æ—¶åªéœ€è¦å°†å­˜æ´»å¯¹è±¡è¾¹ç•Œä»¥å¤–çš„åŒºåŸŸå…¨éƒ¨æ¸…ç†å³å¯ã€‚ è¿‡ç¨‹å¦‚å›¾æ‰€ç¤ºï¼š è¿™é‡Œä¸å†ç”»ç®—æ³•çš„æ‰§è¡Œæµç¨‹å›¾ï¼Œæ ‡è®°æ­¥éª¤å‚è€ƒå›¾6ï¼Œå‹ç¼©è¿‡ç¨‹å‚è€ƒå›¾9å³å¯ã€‚ è¿™ä¸ªç®—æ³•çš„å¥½å¤„å°±æ˜¯ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œä¸ä¼šå¤§é‡å¤åˆ¶ï¼Œç›¸æ¯”å¤åˆ¶ç®—æ³•ï¼Œå†…å­˜ä¹Ÿä¸ä¼šå‡åŠï¼Œç”±äºå°‘äº†ä¸€å±‚éå†æ‰€æœ‰å¯¹è±¡çš„æ“ä½œï¼Œå› æ­¤ä¸€èˆ¬æ•ˆç‡ä¹Ÿè¦æ¯”æ ‡è®°-æ¸…é™¤ç®—æ³•é«˜ã€‚ 3.4ï¼šåˆ†ä»£æ”¶é›†ç®—æ³•ç›®å‰å•†ä¸šè™šæ‹Ÿæœºçš„åƒåœ¾å›æ”¶éƒ½é‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œè¿™ç§ç®—æ³•åŸºäºä¸Šè¿°å‡ ä¸ªåŸºæœ¬çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œé€šè¿‡ã€Œåˆ†ä»£ã€çš„æ–¹å¼åˆ†ç±»ä¸åŒç”Ÿå‘½å‘¨æœŸç‰¹å¾çš„å¯¹è±¡ï¼Œå°†ä¸åŒã€Œä»£ã€ä½¿ç”¨é€‚åˆçš„æ”¶é›†ç®—æ³•æ¥å®ç°å›æ”¶ï¼Œæ¯”å¦‚jvmæ–°ç”Ÿä»£ï¼Œæ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡ç‰¹å¾ä¸ºç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œæ¯æ¬¡å›æ”¶åªæœ‰å°‘é‡å¯¹è±¡å­˜æ´»ï¼Œä¸”è¦æ±‚å¿«é€Ÿï¼Œå› æ­¤é€‚åˆç”¨å¤åˆ¶-æ”¶é›†ç®—æ³•æ¥å®ç°ï¼ˆæ¯”å¦‚æ–°ç”Ÿä»£é‡Œçš„EdenåŒºå’Œä¸¤ä¸ªSurvivoråŒºï¼Œå°±æ˜¯ä¸ºå¤åˆ¶ç®—æ³•è€Œæ‹†åˆ†å‡ºæ¥çš„ï¼‰ï¼Œè€Œè€å¹´ä»£é‡Œçš„å¯¹è±¡å› ä¸ºç”Ÿå‘½å‘¨æœŸé•¿ï¼Œæ¯æ¬¡å›æ”¶å¤§é‡çš„å¯¹è±¡è¿˜å¤„äºå­˜æ´»æœŸï¼Œå¦‚æœå†ä½¿ç”¨å¤åˆ¶-æ”¶é›†ç®—æ³•æ¥å®ç°ï¼Œé‚£ä¹ˆå¤åˆ¶æˆæœ¬æ˜¯å¾ˆé«˜çš„ï¼Œå› æ­¤è€å¹´ä»£åˆ™é€‚åˆä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ï¼Œè¿™ç§ä¸ä½¿ç”¨å•ä¸€ç®—æ³•ï¼Œä¼šæ ¹æ®å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç‰¹å¾è¿›è¡Œç®—æ³•éš”ç¦»åˆ†åŒºçš„æ–¹å¼å°±å«åšã€Œåˆ†ä»£æ”¶é›†ã€ã€‚","link":"/2019/05/07/JVM%E5%9F%BA%E7%A1%80%E5%9B%9E%E9%A1%BE%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/"},{"title":"Kingdom Rush Origins","text":"ä¸­å­¦æ—¶ç©çš„ä¸€æ¬¾æ¸¸æˆï¼Œå½“æ—¶ç©çš„åº”è¯¥æ˜¯åˆç‰ˆï¼Œä»Šå¤©ä¸‹åˆåœ¨steamä¸‹è½½äº†æœ€æ–°ç‰ˆ-èµ·æºï¼Œæ„Ÿè§‰æ¸¸æˆç”»é¢å¾ˆèˆ’æœï¼Œé£æ ¼ä¹Ÿæ˜¯ä»¥å‰çš„æ ·å­ï¼Œä¸€æ¬¾ä¼‘é—²çš„å¡”é˜²æ¸¸æˆ Kingdom Rushå‘å±•å²ï¼š Kingdom Rush Originsæ¸¸æˆæˆªå›¾ï¼š","link":"/2019/04/13/Kingdom%20Rush%20Origins/"},{"title":"JVMåŸºç¡€å›é¡¾è®°å½•ï¼ˆä¸€ï¼‰ï¼šJVMçš„å†…å­˜æ¨¡å‹","text":"ä¸€ã€JAVAç¨‹åºæ‰§è¡Œæµç¨‹JAVAç¨‹åºæ‰§è¡Œçš„åŸºæœ¬æµç¨‹ï¼ˆåŸºäºHotSpotï¼‰ï¼š äºŒã€å†…å­˜æ¨¡å—åˆ’åˆ†2.1ï¼šç¨‹åºè®¡æ•°å™¨ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œæ˜¯å½“å‰çº¿ç¨‹æ‰§è¡Œå­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ï¼Œå­—èŠ‚ç è§£é‡Šå™¨å°±æ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥è·å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œå…¶ä¸­åˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬å’Œå¼‚å¸¸å¤„ç†ï¼Œçº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½å‡éœ€è¦ä¾èµ–è¯¥è®¡æ•°å™¨å®Œæˆã€‚ç”±äºjvmçš„å¤šçº¿ç¨‹æ˜¯é€šè¿‡çº¿ç¨‹è½®æµåˆ‡æ¢å¹¶åˆ†é…CPUæ‰§è¡Œæ—¶é—´çš„æ–¹å¼å®ç°ï¼Œåœ¨ä»»ä½•æ—¶åˆ»ï¼Œä¸€ä¸ªCPUéƒ½åªä¼šæ‰§è¡Œå…¶ä¸­ä¸€æ¡çº¿ç¨‹é‡Œçš„æŒ‡ä»¤ï¼Œä¸ºäº†ä½¿çº¿ç¨‹å‘ç”Ÿåˆ‡æ¢åå¯ä»¥é¡ºåˆ©çš„å®šä½åˆ°ä¸Šæ¬¡å‘ç”Ÿåˆ‡æ¢æ—¶çš„æ‰§è¡Œä½ç½®ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œæ¯æ¡çº¿ç¨‹çš„è®¡æ•°å™¨ç›¸äº’ç‹¬ç«‹ï¼Œè¿™å—å­˜å‚¨åŒºåŸŸè¢«ç§°ä¸ºçº¿ç¨‹ç§æœ‰å†…å­˜ã€‚ 2.2ï¼šæ–¹æ³•åŒºä¹Ÿæ˜¯çº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸï¼Œè¿™å—åŒºåŸŸä¸»è¦ç”¨æ¥å­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ï¼ŒHotSpotè™šæ‹Ÿæœºå®ç°è¯¥åŒºåŸŸæ—¶é‡‡ç”¨å †çš„ä¸€å—åŒºåŸŸå®ç°ï¼Œç›®çš„æ˜¯ä¸ºäº†è®©GCåˆ†ä»£æ”¶é›†æ‰©å±•è‡³æ–¹æ³•åŒºï¼ˆæ¯”å¦‚ç±»å¸è½½æ—¶æ˜¯éœ€è¦GCå‚ä¸çš„ï¼‰ï¼Œå› æ­¤åœ¨å †ç©ºé—´é‡Œåˆ’åˆ†å‡ºä¸€ä¸ªä»£æ¥å­˜å‚¨æ–¹æ³•åŒºé‡Œçš„å†…å®¹ï¼Œè¿™å—åŒºåŸŸé€šå¸¸è¢«ç§°ä½œâ€œæ°¸ä¹…ä»£â€ï¼Œè¯¥å—åŒºåŸŸå¤§å°é€šè¿‡-XX:MaxPermSizeæ¥è®¾ç½®ï¼ˆå› æ­¤å¯èƒ½ä¼šå‡ºç°OOMçš„æƒ…å†µï¼‰ï¼Œä¸è¿‡éœ€è¦è¯´æ˜çš„æ˜¯ï¼ŒJ8å·²ç»æ²¡æœ‰è¿™å—åŒºåŸŸäº†ï¼Œè€Œä¸”J7çš„æ—¶å€™å·²ç»å°†å¸¸é‡æ± ç”±è¯¥å—åŒºåŸŸè½¬ç§»åˆ°å®é™…çš„å †å†…å­˜é‡Œäº†ï¼ˆå®éªŒè¯æ˜ï¼ŒJ7å’ŒJ8çš„æ—¶å€™ï¼Œå¸¸é‡æ± å·²ç»è¢«å­˜è¿›äº†å®é™…çš„å †å†…å­˜ï¼Œä½†åŒºåˆ«æ˜¯J7çš„ç±»ä¿¡æ¯ç­‰è¿˜æ”¾åœ¨æ°¸ä¹…ä»£ä¸­ï¼‰ã€‚J8æœ‰äº†å…ƒæ•°æ®å­˜å‚¨ï¼Œå·²ç»å½»åº•å»é™¤äº†æ°¸ä¹…ä»£çš„æ¦‚å¿µï¼Œå…·ä½“äº†è§£ï¼šJava8å†…å­˜åˆ’åˆ† 2.3ï¼šå †jvmç®¡ç†çš„æœ€å¤§ä¸€å—åŒºåŸŸï¼Œjvmå¯åŠ¨æ—¶åˆ›å»ºï¼Œç”¨æ¥å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ï¼Œé€šè¿‡-Xmxå’Œ-Xmsæ§åˆ¶å…¶å¤§å°ã€‚è¿™å—åŒºåŸŸæ˜¯GCç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œä»å†…å­˜å›æ”¶è§’åº¦æ¥çœ‹ï¼Œç°åœ¨çš„å†…å­˜å›æ”¶åŸºæœ¬éƒ½é‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œæ‰€ä»¥è¯¥åŒºåŸŸè¿˜å¯ä»¥ç»†åˆ†ï¼ˆå¦‚å›¾1å †ç©ºé—´ç»†åˆ†ï¼‰ï¼Œè¿›ä¸€æ­¥åˆ’åˆ†çš„ç›®çš„æ˜¯ä¸ºäº†æ›´å¥½çš„å›æ”¶å†…å­˜æˆ–æ›´å¿«çš„åˆ†é…å†…å­˜ã€‚è¿™é‡Œåˆ—ä¸€ä¸‹ä¾‹å­é‡Œç”¨åˆ°çš„å‚æ•°ï¼ˆä¹Ÿæ˜¯æ¯”è¾ƒå¸¸ç”¨çš„å‚æ•°ï¼‰ï¼š åç§° å«ä¹‰ -xms å †åˆå§‹åŒ–å¤§å° -xmx å †æœ€å¤§å¤§å°ï¼ˆä¸€èˆ¬æ¥è¯´ï¼Œ-xmså’Œ-xmxè®¾ç½®å¤§å°ä¸€è‡´ï¼Œä»¥é¿å…æ¯æ¬¡åƒåœ¾å›æ”¶å®ŒæˆåJVMé‡æ–°åˆ†é…å†…å­˜ï¼‰ -xmn æ–°ç”Ÿä»£å¤§å°ï¼ˆç»“åˆå›¾1ç†è§£ï¼‰ï¼Œè¿™é‡Œéœ€è¦æä¸€ä¸‹-XX:newSizeã€-XX:MaxnewSizeè¿™ä¿©å‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æŒ‡æ–°ç”Ÿä»£åˆå§‹å¤§å°ï¼Œç¬¬äºŒä¸ªæ˜¯æŒ‡æ–°ç”Ÿä»£æœ€å¤§å¤§å°ï¼ŒåŒæ ·ä¸ºäº†é¿å…JVMé‡æ–°åˆ†é…å†…å­˜ï¼Œè¿™ä¿©æ•°å€¼ä¸€èˆ¬è®¾ç½®ä¸ºä¸€æ ·çš„ï¼Œæ‰€ä»¥jdk4å‡ºæ¥äº†-xmnï¼Œä¸€ä¸ªé…ç½®ï¼Œå¯ä»¥å¯¹ä¸Šè¿°ä¿©å‚æ•°åŒæ—¶ç”Ÿæ•ˆ -XX:NewRatio æ–°ç”Ÿä»£ï¼ˆEden+2Survivorsï¼‰ä¸è€å¹´ä»£çš„å¤§å°æ¯”å€¼ï¼Œå¦‚æœå€¼ä¸º2ï¼Œåˆ™æ–°ç”Ÿä»£:è€å¹´ä»£=1:2ï¼ˆå¦‚æœè®¾ç½®äº†-xmnæŒ‡å®šäº†æ–°ç”Ÿä»£å¤§å°ï¼Œåˆ™æ— éœ€è®¾ç½®æ­¤é¡¹ï¼Œä¸¤ä¸ªéƒ½è®¾ç½®ï¼Œåªç”Ÿæ•ˆä¸€ä¸ªï¼‰ -XX:SurvivorRatio æ–°ç”Ÿä»£ä¸­ï¼ŒEdenåŒºä¸ä¸¤ä¸ªSurvivorçš„å¤§å°æ¯”å€¼ï¼Œå¦‚æœè®¾ç½®ä¸º4ï¼Œåˆ™eden:survivor1:survivor2 = 4:1:1ï¼‰ -xss æ ˆå¤§å°ï¼Œä¸€èˆ¬é»˜è®¤128kï¼Œå¦‚æœè°ƒç”¨æ ˆä¸æ˜¯å¾ˆæ·±ï¼ˆæ¯”å¦‚å¾ˆæ·±çš„é€’å½’ç¨‹åºï¼‰ï¼Œä¿æŒé»˜è®¤å³å¯ è¡¨1 2.3.1ï¼šå †é…ç½®è¯¦è§£ç°åœ¨è®©æˆ‘ä»¬æŠŠå›¾1ä¸­çš„â€œå †ç©ºé—´ç»†åˆ†â€éƒ¨åˆ†æ”¾å¤§ï¼Œç»“åˆä¸‹é¢çš„é…ç½®ä¿¡æ¯å’Œè¡¨1ä¸­çš„å«ä¹‰ï¼ˆ-Xsså’Œæ°¸ä¹…ä»£ä¸ä¼šä½“ç°åœ¨å›¾é‡Œï¼‰ï¼Œæ¥ç”¨å›¾è¯´æ˜ä¸‹ï¼š é…ç½®1ï¼š-Xmx3072m -Xms3072m -Xmn2g -XX:SurvivorRatio=4 -Xss128k ä¸Šé¢çš„é…ç½®è¡¨ç¤ºå †åŒºæ€»å¤§å°ä¸º3550Mï¼Œæ–°ç”Ÿä»£å¤§å°ä¸º2Gï¼ˆ2048Mï¼Œè¿™é‡Œåªæ˜¯è¯´æ˜é—®é¢˜æ‰é…ç½®è¿™ä¹ˆå¤§ï¼Œå®é™…ç”Ÿäº§ä¸­ï¼Œæ–°ç”Ÿä»£è¦å°äºè€å¹´ä»£ï¼‰ï¼Œæ–°ç”Ÿä»£EdenåŒºå’Œä¸¤ä¸ªSurvivoråŒºçš„æ¯”ä¾‹ä¸º4:1:1ï¼Œç”¨å›¾æ¥ç›´è§‚çš„è¡¨è¾¾ä¸€ä¸‹è¿™ä¸ªé…ç½®ï¼š é…ç½®2ï¼š-Xmx3072m -Xms3072m -XX:NewRatio=2 -XX:SurvivorRatio=4 -Xss128k ä¸Šé¢çš„é…ç½®è¡¨ç¤ºå †åŒºæ€»å¤§å°ä¸º3550mï¼Œæ–°ç”Ÿä»£:è€å¹´ä»£=1:2ï¼ˆHotSpoté»˜è®¤ï¼‰ï¼Œæ–°ç”Ÿä»£edenåŒºå’Œä¸¤ä¸ªsurvivoråŒºçš„æ¯”ä¾‹ä¸º4:1:1ï¼Œç”¨å›¾æ¥ç›´è§‚çš„è¡¨è¾¾ä¸€ä¸‹è¿™ä¸ªé…ç½®ï¼š 2.4ï¼šè™šæ‹Ÿæœºæ ˆä¹Ÿå°±æ˜¯å¸¸è¯´çš„æ ˆï¼Œçº¿ç¨‹ç§æœ‰ï¼Œç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒï¼Œè™šæ‹Ÿæœºæ ˆç”¨æ¥æè¿°javaæ–¹æ³•ï¼ˆjava methodï¼‰æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼Œæ¯ä¸ªæ–¹æ³•æ‰§è¡Œæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ï¼Œä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨åˆ°å…¶å®Œæˆè°ƒç”¨å¯¹åº”ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºçš„å…¥æ ˆåˆ°å‡ºæ ˆã€‚ å±€éƒ¨å˜é‡è¡¨é‡Œå­˜æ”¾ç€ç¼–è¯‘æœŸå¯çŸ¥çš„åŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡å¼•ç”¨Referenceï¼ˆå¯èƒ½æ˜¯æŒ‡å‘å®ä¾‹å¯¹è±¡åœ°å€çš„ä¸€ä¸ªå¼•ç”¨æŒ‡é’ˆï¼Œä¹Ÿå¯èƒ½æ˜¯ä»£è¡¨å®ä¾‹å¯¹è±¡çš„ä¸€ä¸ªå¥æŸ„ï¼‰ã€ä»¥åŠreturnAddressï¼ˆæŒ‡å‘ä¸€æ¡å­—èŠ‚ç çš„æ‰§è¡Œå‘½ä»¤çš„åœ°å€ï¼‰ã€‚åœ¨æ­¤åŒºåŸŸï¼Œå¦‚æœçº¿ç¨‹çš„è¯·æ±‚æ·±åº¦å¤§äºè™šæ‹Ÿæœºå…è®¸çš„æ·±åº¦ï¼Œå°†ä¼šæŠ›å‡ºStackOverFlowErrorå¼‚å¸¸ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡ä¸€ä¸ªæ— é™åˆ¶é€’å½’æˆ–è€…é€’å½’æ·±åº¦è®¾ç½®ä¸€ä¸ªå¾ˆå¤§çš„æ•°æ¥è¯æ˜ï¼š 123456789101112131415161718public class Recursion { public static int i = 0; public static void main(String[] args) { Recursion t = new Recursion(); t.recursion(); System.out.println(\"ç¨‹åºæ­£å¸¸ç»“æŸ~\"); } public void recursion(){ i++; if(i &gt; 30000){ //è¿™é‡Œåšé€‚å½“è°ƒæ•´ï¼Œå‡å°åˆ™ä¸æŠ¥æ ˆæº¢å‡ºå¼‚å¸¸ï¼Œæ‰©å¤§ï¼ˆæ¯”å¦‚è¿™é‡Œçš„3wï¼‰å°±ä¼šæŠ¥æ ˆæº¢å‡º return; } recursion(); }} ä»£ç å—1 çœ‹æ³¨é‡Šé‚£é‡Œè°ƒæ•´å³å¯è¯æ˜ã€‚æ ˆå¤§å°é€šè¿‡-Xsså‚æ•°æ¥è°ƒæ•´ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªå‚æ•°æ˜¯å¯¹æ¯ä¸ªçº¿ç¨‹ç”Ÿæ•ˆçš„ï¼ˆæ ˆå¸§ï¼‰ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè®¾ç½®çš„å€¼è¶Šå°ï¼Œæ”¯æŒåˆ›å»ºçš„çº¿ç¨‹æ•°å°±è¶Šå¤šï¼ˆå¹¶éå¯ä»¥æ— é™å¤šï¼Œæœ€ç»ˆå—æ“ä½œç³»ç»Ÿé™åˆ¶ï¼Œæ“ä½œç³»ç»Ÿé’ˆå¯¹æ¯ä¸ªè¿›ç¨‹ä¹Ÿæœ‰ä¸ªæœ€å¤§çº¿ç¨‹æ•°çš„é™åˆ¶ï¼‰ï¼Œæ ˆé‡Œå­˜å‚¨çš„å¤§éƒ¨åˆ†æ•°æ®ï¼Œéƒ½ä¼šéšç€æ ˆå¸§çš„ç»“æŸï¼ˆå³methodè°ƒç”¨å®Œæˆï¼‰è€Œè¢«å›æ”¶ï¼Œæ‰€ä»¥ä¸€èˆ¬é€’å½’æ›´å®¹æ˜“é€ æˆæ ˆæº¢å‡ºé—®é¢˜ã€‚ 2.5ï¼šæœ¬åœ°æ–¹æ³•æ ˆæ„ä¹‰ç±»ä¼¼è™šæ‹Ÿæœºæ ˆï¼Œåªä¸è¿‡æœ¬åœ°æ–¹æ³•æ ˆæœåŠ¡äºæœ¬åœ°nativeæ–¹æ³•è°ƒç”¨ï¼ˆJNIï¼‰ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„è™šæ‹ŸæœºHotSpotå·²å°†è¯¥åŒºå’Œè™šæ‹Ÿæœºæ ˆåšäº†åˆå¹¶ã€‚","link":"/2019/04/06/JVM%E5%9F%BA%E7%A1%80%E5%9B%9E%E9%A1%BE%E8%AE%B0%E5%BD%95%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9AJVM%E7%9A%84%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/"},{"title":"é¡¾æ‘çš„æ¨±èŠ±-20190323","text":"è®°å½•äº2019å¹´3æœˆ23æ—¥ï¼Œä¸Šæµ·ï¼Œå¤šäº‘ï¼Œ7~16â„ƒ ä¸‹åˆä»æ¨æµ¦å‡ºå‘å»é¡¾æ‘å…¬å›­ï¼Œæ®è¯´æ’’è‹¦è¾£å¼€äº†ï¼Œå…´å¥‹çš„éª‘è½¦è¿‡å»ï¼Œéª‘è¡Œ1.5å°æ—¶ï¼Œé€›äº†1.5å°æ—¶ï¼Œå›æ¥æ—¶æ‰¾ä¸åˆ°å…±äº«å•è½¦ï¼Œåäº†528è·¯å…¬äº¤ï¼Œå› ä¸ºé¡¾æ‘è¿ä¸ªåœ°é“ç«™éƒ½æ²¡æœ‰==ï¼Œå…¬äº¤åˆ°ç«™ï¼Œåˆéª‘äº†ä¸€å°æ—¶çš„è½¦å›å®¶ã€‚ BGMï¼šå¤œã®å‘æ—¥è‘µ","link":"/2019/03/23/%E9%A1%BE%E6%9D%91%E7%9A%84%E6%A8%B1%E8%8A%B1-20190323/"},{"title":"ä¸€Vanâ™‚å¹´ä»¥å","text":"ä¸€VANâ™‚å¹´ä»¥åï¼ˆè§†é¢‘æ’å…¥æµ‹è¯•ï¼‰","link":"/2019/03/10/%E4%B8%80Van%E2%99%82%E5%B9%B4%E4%BB%A5%E5%90%8E/"},{"title":"è‡´åå¹´åçš„æˆ‘-æ­Œè¯","text":"è¿™æ˜¯ç”±dorikoåˆ¶ä½œã€åˆéŸ³ãƒŸã‚¯æ¼”å”±çš„ä¸€é¦–æ­Œï¼Œ2015å¹´åˆé‡è¿™é¦–æ­Œï¼Œè½¬çœ¼é—´åˆ°äº†2019å¹´ã€‚ æ­Œè¯ å¥½ããªäººã¨æ­©ã„ãŸå ´æ‰€ã‚‚æ›¾å’Œå–œæ¬¢çš„äººä¸€èµ·èµ°è¿‡çš„åœ°æ–¹ãã®æ™‚è¦‹ãŸæ™¯è‰²ã‚‚é‚£æ—¶æ›¾çœ‹åˆ°çš„æ™¯è‰²æŒ¯ã‚Šè¿”ã‚‰ãš ä»Šã‚’é§†ã‘æŠœã‘ç»Ÿç»ŸæŠ›æ‰ ä¸å†å›å¤´ å‘å‰é£å¥”ç§ã¯ä½•ã¨å‡ºä¼šã†ã®æˆ‘å°†ä¼šé‡è§äº›ä»€ä¹ˆå‘¢ ç«‹ã¡æ­¢ã¾ã‚‹ã»ã©é©»è¶³ä¸å‰æ„å‘³ã‚’å•ã†ã»ã©æ¢ç´¢æ„ä¹‰ãã£ã¨ã¾ã å¤§äººã§ã¯ãªãã¦ä¸€å®šæ˜¯æˆ‘è¿˜ä¸å¤Ÿæˆç†Ÿä»Šè¦‹ã¦ã‚‹ã‚‚ã®ç°åœ¨çœ‹åˆ°çš„äº‹ç‰©ä»Šå‡ºä¼šã†äººç°åœ¨é‡è§çš„äººãã®ä¸­ã§ãŸã å‰ã ã‘ã‚’è¦‹ã¦ã‚‹åœ¨è¿™ç‰‡çº·ç¹å–§åš£ä¹‹ä¸­ æˆ‘åªä¼šçœ‹å‘å‰æ–¹10å¹´å¾Œã®ç§ã¸è‡´åå¹´ä»¥åçš„æˆ‘ä»Šã¯å¹¸ã›ã§ã—ã‚‡ã†ã‹ç°åœ¨çš„ä½ æ„Ÿåˆ°å¹¸ç¦ä¹ˆï¼Ÿãã‚Œã¨ã‚‚æ‚²ã—ã¿ã§è¿˜æ˜¯æ­£æ²‰æµ¸åœ¨æ‚²ä¼¤ä¸­æ³£ã„ã¦ã„ã‚‹ã®ã§ã—ã‚‡ã†ã‹é»˜é»˜åœ°æµç€æ³ªï¼Ÿã‘ã©ã‚ãªãŸã®å‚ã«ä¸è¿‡åœ¨ä½ çš„èº«æ—å¤‰ã‚ã‚‰ãªã„ã‚‚ã®ãŒã‚ã‚Šä¾ç„¶ä¼šæœ‰ä¸å˜çš„å­˜åœ¨æ°—ä»˜ã„ã¦ã„ãªã„ã ã‘ã§æœªèƒ½å¯Ÿè§‰çš„ä½ å®ˆã‚‰ã‚Œã¦ã„ã¾ã›ã‚“ã‹ä¾ç„¶åœ¨è¢«å®ˆæŠ¤ç€å§éãã—æ—¥ã€…ã« æƒ³ã„ã‚’é¢„ã‘æŠŠæ€å¿µå¯„æ‰˜äºæµé€çš„æ—¥å­é‡Œæ™‚é–“ã ã‘ ãŸã è¿½ã„ã‹ã‘ã¦ãåªæœ‰æ—¶é—´åœ¨ä¸åœçš„è¿½èµ¶èƒŒã«å¯„ã‚Šæ·»ã£ãŸ èª°ã‹ã®å¤¢ã«æ‰˜ä»˜åœ¨æˆ‘è‚©ä¸Šçš„ æ˜¯è°çš„æ¢¦æƒ³æŒ¯ã‚Šå‘ã‘ã‚‹æ—¥ãŒã„ã¤ã‹æ¥ã‚‹ã®ã‹ãªæ€»æœ‰ä¸€å¤©å¿…é¡»è¦é¢å¯¹çš„å§10å¹´å¾Œã®ç§ã¸è‡´åå¹´ä»¥åçš„æˆ‘ä»Šã¯èª°ã‚’å¥½ãã§ã™ã‹ç°åœ¨çš„ä½ å–œæ¬¢ç€è°å‘¢ï¼Ÿãã‚Œã¨ã‚‚å¤‰ã‚ã‚‰ãšã«è¿˜æ˜¯å’Œä»¥å‰ä¸€æ ·ã‚ã®äººãŒå¥½ãã§ã™ã‹ç»§ç»­å–œæ¬¢ç€é‚£ä¸ªäººå‘¢ï¼Ÿã‘ã©ã„ã¤ã‹ä¸è¿‡ ç°åœ¨çš„ä½ çŸ¥ã‚‰ãªã„èª°ã‹ã‚’çˆ±ã™ã‚‹å‰ã«åœ¨çˆ±ä¸ŠæŸä¸ªäººä¹‹å‰è‡ªåˆ†ã®ã“ã¨ã‚’å¥½ãã¨â€œå–œæ¬¢è‡ªå·±â€è¿™å¥è¯è¨€ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã‹èƒ½å¦å…ˆè¯´å‡ºæ¥å‘¢å¤§åˆ‡ãªäººãŸã¡ã¯æˆ‘æ‰€ççˆ±çš„æœ‹å‹ä»¬ä»Šã‚‚å¤‰ã‚ã‚‰ãšã„ã¾ã™ã‹ä¾ç„¶åœ¨åå¤å¹³å‡¡çš„ç”Ÿæ´»å—ï¼Ÿãã‚Œã¨ã‚‚é ãé›¢ã‚Œè¿˜æ˜¯å·²ç»è¿œå»ãã‚Œãã‚Œæ­©ã‚“ã§ã¾ã™ã‹è¸ä¸Šäº†å„è‡ªçš„æ—…é€”ã‘ã© ãã‚“ãªå‡ºä¼šã„ã‚’ä½†æ˜¯åœ¨é‡å¤äº†æ— æ•°æ¬¡çš„ç›¸é‡åˆ«ã‚Œã‚’ ç¼²ã‚Šè¿”ã—ã¦å’Œç¦»åˆ«ä¹‹åä»Šã®ç§ã‚ˆã‚Šã‚‚æ˜¯å¦æ¯”ç°åœ¨çš„æˆ‘ã™ã¦ãã«ãªã£ã¦ã„ã¾ã™ã‹æ›´æœ‰é­…åŠ›å‘¢ï¼Ÿ10å¹´å¾Œã®ç§ã¸è‡´åå¹´åçš„æˆ‘ä»ŠãŒã‚‚ã—å¹¸ã›ãªã‚‰å¦‚æœç°åœ¨çš„ä½ æ˜¯å¹¸ç¦çš„ã‚ã®æ—¥ã®ç§ã®ã“ã¨ä»å‰çš„æˆ‘æ€ã„å‡ºã—ã¦ãã‚Œã¾ã™ã‹èƒ½å¦è¯·ä½ æƒ³èµ·æ¥å‘¢ãã“ã«ã¯ã¤ã‚‰ã„ã“ã¨ã«å›å¿†ä¸­çš„æˆ‘æ³£ã„ãŸç§ãŒã„ã‚‹ã‘ã©ä¸€å®šåœ¨ä¼¤å¿ƒçš„å“­æ³£å§ãã®æ¶™ã‚’å„ªã—ãè¯·å°†è¿™æ¸©æŸ”çš„æ³ªæ°´æ€ã„å‡ºã«å¤‰ãˆã¦ãã ã•ã„èå…¥è®°å¿†çš„æµ·æ´‹","link":"/2019/02/12/%E8%87%B4%E5%8D%81%E5%B9%B4%E5%90%8E%E7%9A%84%E6%88%91-%E6%AD%8C%E8%AF%8D/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","link":"/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"TSDB","slug":"TSDB","link":"/tags/TSDB/"},{"name":"InfluxDB","slug":"InfluxDB","link":"/tags/InfluxDB/"},{"name":"IDEA","slug":"IDEA","link":"/tags/IDEA/"},{"name":"IDEAæ’ä»¶å¼€å‘","slug":"IDEAæ’ä»¶å¼€å‘","link":"/tags/IDEA%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/"},{"name":"ä½è¿ç®—","slug":"ä½è¿ç®—","link":"/tags/%E4%BD%8D%E8%BF%90%E7%AE%97/"},{"name":"æ•™ç¨‹","slug":"æ•™ç¨‹","link":"/tags/%E6%95%99%E7%A8%8B/"},{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","link":"/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"},{"name":"JVM","slug":"JVM","link":"/tags/JVM/"},{"name":"æ± åŒ–æŠ€æœ¯","slug":"æ± åŒ–æŠ€æœ¯","link":"/tags/%E6%B1%A0%E5%8C%96%E6%8A%80%E6%9C%AF/"},{"name":"è¿æ¥æ± ","slug":"è¿æ¥æ± ","link":"/tags/%E8%BF%9E%E6%8E%A5%E6%B1%A0/"},{"name":"Druid","slug":"Druid","link":"/tags/Druid/"},{"name":"GC","slug":"GC","link":"/tags/GC/"},{"name":"NIO","slug":"NIO","link":"/tags/NIO/"},{"name":"ç½‘ç»œç¼–ç¨‹","slug":"ç½‘ç»œç¼–ç¨‹","link":"/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"},{"name":"æ¸¸æˆ","slug":"æ¸¸æˆ","link":"/tags/%E6%B8%B8%E6%88%8F/"},{"name":"çš‡åŸçªè¢­","slug":"çš‡åŸçªè¢­","link":"/tags/%E7%9A%87%E5%9F%8E%E7%AA%81%E8%A2%AD/"},{"name":"Kingdom Rush","slug":"Kingdom-Rush","link":"/tags/Kingdom-Rush/"},{"name":"å†…éƒ¨ç±»","slug":"å†…éƒ¨ç±»","link":"/tags/%E5%86%85%E9%83%A8%E7%B1%BB/"},{"name":"é›†åˆç±»","slug":"é›†åˆç±»","link":"/tags/%E9%9B%86%E5%90%88%E7%B1%BB/"},{"name":"map","slug":"map","link":"/tags/map/"},{"name":"æ•£åˆ—è¡¨","slug":"æ•£åˆ—è¡¨","link":"/tags/%E6%95%A3%E5%88%97%E8%A1%A8/"},{"name":"ä½å›¾","slug":"ä½å›¾","link":"/tags/%E4%BD%8D%E5%9B%BE/"},{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","link":"/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","link":"/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"},{"name":"çº¿ç¨‹é€šä¿¡","slug":"çº¿ç¨‹é€šä¿¡","link":"/tags/%E7%BA%BF%E7%A8%8B%E9%80%9A%E4%BF%A1/"},{"name":"çº¿ç¨‹è°ƒåº¦","slug":"çº¿ç¨‹è°ƒåº¦","link":"/tags/%E7%BA%BF%E7%A8%8B%E8%B0%83%E5%BA%A6/"},{"name":"juc","slug":"juc","link":"/tags/juc/"},{"name":"åˆ†å¸ƒå¼ç¼“å­˜","slug":"åˆ†å¸ƒå¼ç¼“å­˜","link":"/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98/"},{"name":"redis","slug":"redis","link":"/tags/redis/"},{"name":"nosql","slug":"nosql","link":"/tags/nosql/"},{"name":"ThreadLocal","slug":"ThreadLocal","link":"/tags/ThreadLocal/"},{"name":"ç†”æ–­","slug":"ç†”æ–­","link":"/tags/%E7%86%94%E6%96%AD/"},{"name":"Resilience4j","slug":"Resilience4j","link":"/tags/Resilience4j/"},{"name":"æ ‘","slug":"æ ‘","link":"/tags/%E6%A0%91/"},{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","link":"/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"ç«ç„°å›¾","slug":"ç«ç„°å›¾","link":"/tags/%E7%81%AB%E7%84%B0%E5%9B%BE/"},{"name":"é¬¼ç•œ","slug":"é¬¼ç•œ","link":"/tags/%E9%AC%BC%E7%95%9C/"},{"name":"CompletableFuture","slug":"CompletableFuture","link":"/tags/CompletableFuture/"},{"name":"é˜»å¡é˜Ÿåˆ—","slug":"é˜»å¡é˜Ÿåˆ—","link":"/tags/%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97/"},{"name":"ReentrantLock","slug":"ReentrantLock","link":"/tags/ReentrantLock/"},{"name":"spring","slug":"spring","link":"/tags/spring/"},{"name":"ioc","slug":"ioc","link":"/tags/ioc/"},{"name":"aop","slug":"aop","link":"/tags/aop/"},{"name":"é“¾è¡¨","slug":"é“¾è¡¨","link":"/tags/%E9%93%BE%E8%A1%A8/"},{"name":"memcache","slug":"memcache","link":"/tags/memcache/"},{"name":"mysql","slug":"mysql","link":"/tags/mysql/"},{"name":"äº‹åŠ¡","slug":"äº‹åŠ¡","link":"/tags/%E4%BA%8B%E5%8A%A1/"},{"name":"æµæº","slug":"æµæº","link":"/tags/%E6%B5%8E%E6%BA%90/"},{"name":"é»„æ²³ä¸‰å³¡","slug":"é»„æ²³ä¸‰å³¡","link":"/tags/%E9%BB%84%E6%B2%B3%E4%B8%89%E5%B3%A1/"},{"name":"ç‹å±‹å±±","slug":"ç‹å±‹å±±","link":"/tags/%E7%8E%8B%E5%B1%8B%E5%B1%B1/"},{"name":"æ—…è¡Œ","slug":"æ—…è¡Œ","link":"/tags/%E6%97%85%E8%A1%8C/"},{"name":"HikariCP","slug":"HikariCP","link":"/tags/HikariCP/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","link":"/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼","slug":"ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼","link":"/tags/%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%BC%8F/"},{"name":"å·¥å‚æ¨¡å¼","slug":"å·¥å‚æ¨¡å¼","link":"/tags/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/"},{"name":"ç­–ç•¥æ¨¡å¼","slug":"ç­–ç•¥æ¨¡å¼","link":"/tags/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/"},{"name":"miku","slug":"miku","link":"/tags/miku/"},{"name":"letter song","slug":"letter-song","link":"/tags/letter-song/"},{"name":"JDBC","slug":"JDBC","link":"/tags/JDBC/"},{"name":"é“¾è·¯è¿½è¸ª","slug":"é“¾è·¯è¿½è¸ª","link":"/tags/%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA/"},{"name":"OpenTracing","slug":"OpenTracing","link":"/tags/OpenTracing/"},{"name":"é¡¾æ‘å…¬å›­","slug":"é¡¾æ‘å…¬å›­","link":"/tags/%E9%A1%BE%E6%9D%91%E5%85%AC%E5%9B%AD/"},{"name":"æ¨±èŠ±","slug":"æ¨±èŠ±","link":"/tags/%E6%A8%B1%E8%8A%B1/"},{"name":"åºåˆ—åŒ–","slug":"åºåˆ—åŒ–","link":"/tags/%E5%BA%8F%E5%88%97%E5%8C%96/"}],"categories":[{"name":"DB","slug":"DB","link":"/categories/DB/"},{"name":"IDEAæ’ä»¶å¼€å‘","slug":"IDEAæ’ä»¶å¼€å‘","link":"/categories/IDEA%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/"},{"name":"JAVAåŸºç¡€","slug":"JAVAåŸºç¡€","link":"/categories/JAVA%E5%9F%BA%E7%A1%80/"},{"name":"InfluxDB","slug":"DB/InfluxDB","link":"/categories/DB/InfluxDB/"},{"name":"æ± åŒ–æŠ€æœ¯","slug":"æ± åŒ–æŠ€æœ¯","link":"/categories/%E6%B1%A0%E5%8C%96%E6%8A%80%E6%9C%AF/"},{"name":"JVM","slug":"JAVAåŸºç¡€/JVM","link":"/categories/JAVA%E5%9F%BA%E7%A1%80/JVM/"},{"name":"JAVAè¿›åŒ–è®º","slug":"JAVAåŸºç¡€/JAVAè¿›åŒ–è®º","link":"/categories/JAVA%E5%9F%BA%E7%A1%80/JAVA%E8%BF%9B%E5%8C%96%E8%AE%BA/"},{"name":"ç½‘ç»œç¼–ç¨‹","slug":"ç½‘ç»œç¼–ç¨‹","link":"/categories/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"},{"name":"æ—¥å¸¸","slug":"æ—¥å¸¸","link":"/categories/%E6%97%A5%E5%B8%B8/"},{"name":"è¿æ¥æ± ","slug":"æ± åŒ–æŠ€æœ¯/è¿æ¥æ± ","link":"/categories/%E6%B1%A0%E5%8C%96%E6%8A%80%E6%9C%AF/%E8%BF%9E%E6%8E%A5%E6%B1%A0/"},{"name":"NIOåŸºç¡€","slug":"ç½‘ç»œç¼–ç¨‹/NIOåŸºç¡€","link":"/categories/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/NIO%E5%9F%BA%E7%A1%80/"},{"name":"åˆ†å¸ƒå¼ç¼“å­˜","slug":"DB/åˆ†å¸ƒå¼ç¼“å­˜","link":"/categories/DB/%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98/"},{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","link":"/categories/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"},{"name":"æœåŠ¡æ²»ç†","slug":"æœåŠ¡æ²»ç†","link":"/categories/%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/"},{"name":"æ¸¸æˆ","slug":"æ—¥å¸¸/æ¸¸æˆ","link":"/categories/%E6%97%A5%E5%B8%B8/%E6%B8%B8%E6%88%8F/"},{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","link":"/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"æ‚è®°","slug":"æ‚è®°","link":"/categories/%E6%9D%82%E8%AE%B0/"},{"name":"åˆ’æ°´","slug":"æ—¥å¸¸/åˆ’æ°´","link":"/categories/%E6%97%A5%E5%B8%B8/%E5%88%92%E6%B0%B4/"},{"name":"æ¡†æ¶","slug":"æ¡†æ¶","link":"/categories/%E6%A1%86%E6%9E%B6/"},{"name":"MySQL","slug":"DB/MySQL","link":"/categories/DB/MySQL/"},{"name":"æ—…è¡Œ","slug":"æ—¥å¸¸/æ—…è¡Œ","link":"/categories/%E6%97%A5%E5%B8%B8/%E6%97%85%E8%A1%8C/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","link":"/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"ThreadLocal","slug":"å¹¶å‘ç¼–ç¨‹/ThreadLocal","link":"/categories/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ThreadLocal/"},{"name":"ç†”æ–­","slug":"æœåŠ¡æ²»ç†/ç†”æ–­","link":"/categories/%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/%E7%86%94%E6%96%AD/"},{"name":"æ ‘","slug":"æ•°æ®ç»“æ„/æ ‘","link":"/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%A0%91/"},{"name":"ç«ç„°å›¾","slug":"æœåŠ¡æ²»ç†/ç«ç„°å›¾","link":"/categories/%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/%E7%81%AB%E7%84%B0%E5%9B%BE/"},{"name":"JUC","slug":"å¹¶å‘ç¼–ç¨‹/JUC","link":"/categories/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/"},{"name":"Spring","slug":"æ¡†æ¶/Spring","link":"/categories/%E6%A1%86%E6%9E%B6/Spring/"},{"name":"é“¾è¡¨","slug":"æ•°æ®ç»“æ„/é“¾è¡¨","link":"/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E9%93%BE%E8%A1%A8/"},{"name":"å›¾è§£å¤šçº¿ç¨‹è®¾è®¡æ¨¡å¼","slug":"å¹¶å‘ç¼–ç¨‹/å›¾è§£å¤šçº¿ç¨‹è®¾è®¡æ¨¡å¼","link":"/categories/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%9B%BE%E8%A7%A3%E5%A4%9A%E7%BA%BF%E7%A8%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"æ•£åˆ—è¡¨","slug":"æ•°æ®ç»“æ„/æ•£åˆ—è¡¨","link":"/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%95%A3%E5%88%97%E8%A1%A8/"},{"name":"ç”Ÿäº§&æ¶ˆè´¹æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼/ç”Ÿäº§-æ¶ˆè´¹æ¨¡å¼","link":"/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%94%9F%E4%BA%A7-%E6%B6%88%E8%B4%B9%E6%A8%A1%E5%BC%8F/"},{"name":"æ¨¡å¼å¯¹æ¯”","slug":"è®¾è®¡æ¨¡å¼/æ¨¡å¼å¯¹æ¯”","link":"/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%A8%A1%E5%BC%8F%E5%AF%B9%E6%AF%94/"},{"name":"é“¾è·¯è¿½è¸ª","slug":"æœåŠ¡æ²»ç†/é“¾è·¯è¿½è¸ª","link":"/categories/%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA/"},{"name":"Framework","slug":"æ¡†æ¶/Spring/Framework","link":"/categories/%E6%A1%86%E6%9E%B6/Spring/Framework/"}]}